/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.3.5 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, https://github.com/requirejs/requirejs/blob/master/LICENSE
 */
var requirejs,require,define;!function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){var i;if(e)for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}function eachReverse(e,t){var i;if(e)for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,n){return t&&eachProp(t,function(t,s){!i&&hasProp(e,s)||(!n||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[s]=t:(e[s]||(e[s]={}),mixin(e[s],t,i,n)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,n){var s=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return s.requireType=e,s.requireModules=n,i&&(s.originalError=i),s}function newContext(e){function t(e,t,i){var n,s,r,a,o,l,d,u,c,h,p=t&&t.split("/"),f=A.map,v=f&&f["*"];if(e&&(l=(e=e.split("/")).length-1,A.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&p&&(e=p.slice(0,p.length-1).concat(e)),function(e){var t,i;for(t=0;t<e.length;t++)if("."===(i=e[t]))e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}(e),e=e.join("/")),i&&f&&(p||v)){e:for(r=(s=e.split("/")).length;r>0;r-=1){if(o=s.slice(0,r).join("/"),p)for(a=p.length;a>0;a-=1)if((n=getOwn(f,p.slice(0,a).join("/")))&&(n=getOwn(n,o))){d=n,u=r;break e}!c&&v&&getOwn(v,o)&&(c=getOwn(v,o),h=r)}!d&&c&&(d=c,u=h),d&&(s.splice(0,u,d),e=s.join("/"))}return getOwn(A.pkgs,e)||e}function i(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===m.contextName)return t.parentNode.removeChild(t),!0})}function n(e){var t=getOwn(A.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),m.require.undef(e),m.makeRequire(null,{skipMap:!0})([e]),!0}function s(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function r(e,i,n,r){var a,o,l,d,u=null,c=i?i.name:null,h=e,p=!0,f="";return e||(p=!1,e="_@r"+(P+=1)),u=(d=s(e))[0],e=d[1],u&&(u=t(u,c,r),o=getOwn(C,u)),e&&(u?f=n?e:o&&o.normalize?o.normalize(e,function(e){return t(e,c,r)}):-1===e.indexOf("!")?t(e,c,r):e:(u=(d=s(f=t(e,c,r)))[0],f=d[1],n=!0,a=m.nameToUrl(f))),{prefix:u,name:f,parentMap:i,unnormalized:!!(l=!u||o||n?"":"_unnormalized"+(M+=1)),url:a,originalName:h,isDefine:p,id:(u?u+"!"+f:f)+l}}function a(e){var t=e.id,i=getOwn(S,t);return i||(i=S[t]=new m.Module(e)),i}function o(e,t,i){var n=e.id,s=getOwn(S,n);!hasProp(C,n)||s&&!s.defineEmitComplete?(s=a(e)).error&&"error"===t?i(s.error):s.on(t,i):"defined"===t&&i(C[n])}function l(e,t){var i=e.requireModules,n=!1;t?t(e):(each(i,function(t){var i=getOwn(S,t);i&&(i.error=e,i.events.error&&(n=!0,i.emit("error",e)))}),n||req.onError(e))}function d(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(m.defQueueMap[t]=!0),D.push(e)}),globalDefQueue=[])}function u(e){delete S[e],delete b[e]}function c(){var e,t,s=1e3*A.waitSeconds,r=s&&m.startTime+s<(new Date).getTime(),a=[],o=[],d=!1,u=!0;if(!g){if(g=!0,eachProp(b,function(e){var s=e.map,l=s.id;if(e.enabled&&(s.isDefine||o.push(e),!e.error))if(!e.inited&&r)n(l)?(t=!0,d=!0):(a.push(l),i(l));else if(!e.inited&&e.fetched&&s.isDefine&&(d=!0,!s.prefix))return u=!1}),r&&a.length)return(e=makeError("timeout","Load timeout for modules: "+a,null,a)).contextName=m.contextName,l(e);u&&each(o,function(e){!function e(t,i,n){var s=t.map.id;t.error?t.emit("error",t.error):(i[s]=!0,each(t.depMaps,function(s,r){var a=s.id,o=getOwn(S,a);!o||t.depMatched[r]||n[a]||(getOwn(i,a)?(t.defineDep(r,C[a]),t.check()):e(o,i,n))}),n[s]=!0)}(e,{},{})}),r&&!t||!d||!isBrowser&&!isWebWorker||y||(y=setTimeout(function(){y=0,c()},50)),g=!1}}function h(e){hasProp(C,e[0])||a(r(e[0],null,!0)).init(e[1],e[2])}function p(e,t,i,n){e.detachEvent&&!isOpera?n&&e.detachEvent(n,t):e.removeEventListener(i,t,!1)}function f(e){var t=e.currentTarget||e.srcElement;return p(t,m.onScriptLoad,"load","onreadystatechange"),p(t,m.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function v(){var e;for(d();D.length;){if(null===(e=D.shift())[0])return l(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));h(e)}m.defQueueMap={}}var g,_,m,E,y,A={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},S={},b={},T={},D=[],C={},I={},R={},P=1,M=1;return E={require:function(e){return e.require?e.require:e.require=m.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?C[e.map.id]=e.exports:e.exports=C[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(A.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},(_=function(e){this.events=getOwn(T,e.id)||{},this.map=e,this.shim=getOwn(A.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,i,n){n=n||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,m.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();m.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;I[e]||(I[e]=!0,m.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,n=this.depExports,s=this.exports,r=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(r)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{s=m.execCb(i,r,n,s)}catch(t){e=t}else s=m.execCb(i,r,n,s);if(this.map.isDefine&&void 0===s&&((t=this.module)?s=t.exports:this.usingExports&&(s=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",l(this.error=e)}else s=r;if(this.exports=s,this.map.isDefine&&!this.ignore&&(C[i]=s,req.onResourceLoad)){var a=[];each(this.depMaps,function(e){a.push(e.normalizedMap||e)}),req.onResourceLoad(m,this.map,a)}u(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(m.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,i=e.id,n=r(e.prefix);this.depMaps.push(n),o(n,"defined",bind(this,function(n){var s,d,c,h=getOwn(R,this.map.id),p=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null,v=m.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(p=n.normalize(p,function(e){return t(e,f,!0)})||""),o(d=r(e.prefix+"!"+p,this.map.parentMap,!0),"defined",bind(this,function(e){this.map.normalizedMap=d,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((c=getOwn(S,d.id))&&(this.depMaps.push(d),this.events.error&&c.on("error",bind(this,function(e){this.emit("error",e)})),c.enable()))):h?(this.map.url=m.nameToUrl(h),void this.load()):((s=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[i],eachProp(S,function(e){0===e.map.id.indexOf(i+"_unnormalized")&&u(e.map.id)}),l(e)}),s.fromText=bind(this,function(t,n){var o=e.name,d=r(o),u=useInteractive;n&&(t=n),u&&(useInteractive=!1),a(d),hasProp(A.config,i)&&(A.config[o]=A.config[i]);try{req.exec(t)}catch(e){return l(makeError("fromtexteval","fromText eval for "+i+" failed: "+e,e,[i]))}u&&(useInteractive=!0),this.depMaps.push(d),m.completeLoad(o),v([o],s)}),void n.load(e.name,v,s,A))})),m.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){b[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,n,s;if("string"==typeof e){if(e=r(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,s=getOwn(E,e.id))return void(this.depExports[t]=s(this));this.depCount+=1,o(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?o(e,"error",bind(this,this.errback)):this.events.error&&o(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,n=S[i],hasProp(E,i)||!n||n.enabled||m.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(S,e.id);t&&!t.enabled&&m.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},(m={config:A,contextName:e,registry:S,defined:C,urlFetched:I,defQueue:D,defQueueMap:{},Module:_,makeModuleMap:r,nextTick:req.nextTick,onError:l,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,i){return(-1===i.indexOf("?")?"?":"&")+t}}var i=A.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){n[t]?(A[t]||(A[t]={}),mixin(A[t],e,!0,!0)):A[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(R[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=m.makeShimExports(e)),i[t]=e}),A.shim=i),e.packages&&each(e.packages,function(e){var t;t=(e="string"==typeof e?{name:e}:e).name,e.location&&(A.paths[t]=e.location),A.pkgs[t]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(S,function(e,t){e.inited||e.map.unnormalized||(e.map=r(t,null,!0))}),(e.deps||e.callback)&&m.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}},makeRequire:function(n,s){function o(t,i,d){var u,h;return s.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof t?isFunction(i)?l(makeError("requireargs","Invalid require call"),d):n&&hasProp(E,t)?E[t](S[n.id]):req.get?req.get(m,t,n,o):(u=r(t,n,!1,!0).id,hasProp(C,u)?C[u]:l(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(n?"":". Use require([])")))):(v(),m.nextTick(function(){v(),(h=a(r(null,n))).skipMap=s.skipMap,h.init(t,i,d,{enabled:!0}),c()}),o)}return s=s||{},mixin(o,{isBrowser:isBrowser,toUrl:function(e){var i,s=e.lastIndexOf("."),r=e.split("/")[0];return-1!==s&&(!("."===r||".."===r)||s>1)&&(i=e.substring(s,e.length),e=e.substring(0,s)),m.nameToUrl(t(e,n&&n.id,!0),i,!0)},defined:function(e){return hasProp(C,r(e,n,!1,!0).id)},specified:function(e){return e=r(e,n,!1,!0).id,hasProp(C,e)||hasProp(S,e)}}),n||(o.undef=function(e){d();var t=r(e,n,!0),s=getOwn(S,e);s.undefed=!0,i(e),delete C[e],delete I[t.url],delete T[e],eachReverse(D,function(t,i){t[0]===e&&D.splice(i,1)}),delete m.defQueueMap[e],s&&(s.events.defined&&(T[e]=s.events),u(e))}),o},enable:function(e){getOwn(S,e.id)&&a(e).enable()},completeLoad:function(e){var t,i,s,r=getOwn(A.shim,e)||{},a=r.exports;for(d();D.length;){if(null===(i=D.shift())[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);h(i)}if(m.defQueueMap={},s=getOwn(S,e),!t&&!hasProp(C,e)&&s&&!s.inited){if(!(!A.enforceDefine||a&&getGlobal(a)))return n(e)?void 0:l(makeError("nodefine","No define call for "+e,null,[e]));h([e,r.deps||[],r.exportsFn])}c()},nameToUrl:function(e,t,i){var n,s,r,a,o,l,d=getOwn(A.pkgs,e);if(d&&(e=d),l=getOwn(R,e))return m.nameToUrl(l,t,i);if(req.jsExtRegExp.test(e))a=e+(t||"");else{for(n=A.paths,r=(s=e.split("/")).length;r>0;r-=1)if(o=getOwn(n,s.slice(0,r).join("/"))){isArray(o)&&(o=o[0]),s.splice(0,r,o);break}a=s.join("/"),a=("/"===(a+=t||(/^data\:|^blob\:|\?/.test(a)||i?"":".js")).charAt(0)||a.match(/^[\w\+\.\-]+:/)?"":A.baseUrl)+a}return A.urlArgs&&!/^blob\:/.test(a)?a+A.urlArgs(e,a):a},load:function(e,t){req.load(m,e,t)},execCb:function(e,t,i,n){return t.apply(n,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=f(e);m.completeLoad(t.id)}},onScriptError:function(e){var t=f(e);if(!n(t.id)){var i=[];return eachProp(S,function(e,n){0!==n.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===t.id)return i.push(n),!0})}),l(makeError("scripterror",'Script error for "'+t.id+(i.length?'", needed by: '+i.join(", "):'"'),e,[t.id]))}}}).require=m.makeRequire(),m}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.5",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,n){var s,r,a=defContextName;return isArray(e)||"string"==typeof e||(r=e,isArray(t)?(e=t,t=i,i=n):e=[]),r&&r.context&&(a=r.context),(s=getOwn(contexts,a))||(s=contexts[a]=req.s.newContext(a)),r&&s.configure(r),s.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick=void 0!==setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],(baseElement=document.getElementsByTagName("base")[0])&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var n=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return n.type=e.scriptType||"text/javascript",n.charset="utf-8",n.async=!0,n},req.load=function(e,t,i){var n,s=e&&e.config||{};if(isBrowser)return(n=req.createNode(s,t,i)).setAttribute("data-requirecontext",e.contextName),n.setAttribute("data-requiremodule",t),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",e.onScriptLoad,!1),n.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",e.onScriptLoad)),n.src=i,s.onNodeCreated&&s.onNodeCreated(n,s,t,i),currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),e.completeLoad(t)}catch(n){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,n,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,i){var n,s;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript())&&(e||(e=n.getAttribute("data-requiremodule")),s=contexts[n.getAttribute("data-requirecontext")]),s?(s.defQueue.push([e,t,i]),s.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,"undefined"==typeof setTimeout?void 0:setTimeout),define("libs/require-2.3.5",function(){}),function(){"use strict";var e=null;define("version",{version:"1.0",load:function(t,i,n,s){var r=s.config.version;if(!r)throw new Error("A version config has not been setup");if(!r[t])throw new Error("A version was not specified for module: "+t);e&&r[t],i([t+"-"+s.config.version[t]],function(e){n(e)})},normalize:function(t){var i=/\(([^)]*)\)/.exec(t);return e=null,i&&(e=i[1],t=t.substring(0,i.index)),t}})}(),requirejs.config({config:{version:{"fly/libs/base64":"0.3.0","fly/libs/easy-xdm-cbsi":"2.4.19.3","fly/libs/jquery.widget":"1.9.2","fly/libs/jquery.cookie":"1.2","fly/libs/jquery.mobile":"1.3.2","fly/libs/jquery.throttle-debounce":"1.1","fly/libs/js-cookie":"2.2.0","fly/libs/omniture.s-code":"1.0","fly/libs/urs":"1.0","fly/utils/data-prefix":"1.0","fly/utils/data-selector":"1.0","fly/utils/function-natives":"1.0","fly/utils/guid":"1.0","fly/utils/log":"1.0","fly/utils/object-helper":"1.0","fly/utils/string-helper":"2.0","fly/utils/string-vars":"1.0","fly/utils/url-helper":"2.0","fly/managers/components":"1.0","fly/managers/cookie":"2.0","fly/managers/debug":"2.0","fly/managers/ad":"2.0","fly/managers/gpt":"4.3","fly/managers/geo":"2.0","fly/managers/image-resolution":"1.0","fly/managers/recurly":"1.0","fly/managers/recurly-billing":"1.0","fly/managers/social-authentication":"1.0","fly/managers/tracking":"1.0","fly/managers/user":"1.0","fly/components/accordion":"1.0","fly/components/alert":"1.0","fly/components/base":"1.0","fly/components/carousel":"1.0","fly/components/credspark":"1.0","fly/components/dependent-field":"1.0","fly/components/dropdown":"1.0","fly/components/form-validate":"1.0","fly/components/iframe-messenger":"1.1","fly/components/image-gallery":"1.0","fly/components/loading":"1.0","fly/components/load-more":"1.0","fly/components/nrelate":"1.0","fly/components/modal":"1.0","fly/components/modal-async":"1.0","fly/components/modal-iframe":"1.0","fly/components/scrollbar":"1.0","fly/components/social-button":"1.0","fly/components/social-counts":"1.1","fly/components/social-links":"1.0","fly/components/tabs":"1.0","fly/managers/clicktale":"1.0","fly/components/poll":"1.0","fly/managers/history":"1.0","libs/fontfaceobserver":"2.0.7","libs/hls":"0.12.4.light.min","libs/require":"2.3.5","libs/riot":"2.6.2"}},shim:{tealium:["jquery"]},map:{"*":{urs:"https://urs.cbsnews.com/sdk/urs.js"}},waitSeconds:30}),define("require.config",function(){}),require(["version!libs/require","require.config"]),define("requireLib",function(){}),define("fly/utils/string-helper-2.0",[],function(){return{capitalize:function(e){return e.replace(/\b[a-z]/g,function(e){return e.toUpperCase()})},lowerFirst:function(e){return e.charAt(0).toLowerCase()+e.slice(1)},toBool:function(e){return!0===e||"true"===e||"1"===e},toCleanArray:function(e,t){return t=t||",",e=(e="string"==typeof e?e.split(t).map(function(e){return e.trim()}):Array.prototype.slice.call(e)).filter(function(e){return e})},toCamelCase:function(e,t){return t=t||"-",e.replace(new RegExp("(\\"+t+"[a-z])","g"),function(e){return e.toUpperCase().replace(t,"")})},fromCamelCase:function(e,t){return t=t||"-",e.replace(/[A-Z]/g,function(e){return t+e.toLowerCase()})},toEventName:function(e){return e.replace(/^on([A-Z])/,function(e){return e.charAt(2).toLowerCase()})},isEventOption:function(e){return/^on([A-Z])/.test(e)}}}),define("fly/utils/url-helper-2.0",[],function(){return{buildUrl:function(e,t,i,n){var s=e+t;return(i=this._stringifyObject(i))&&(s+="?"+i),(n=this._stringifyObject(n))&&(s+="#"+n),s},getParam:function(e,t){var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t||window.location);return i?i[1]:null},getParamAsArray:function(e){var t=this.getParam(e);return t?t.split(","):null},getAllParams:function(e){var t=(e?this._getParsableUrl(e):window.location).search.substring(1),i=t.split("&"),n={};if(""===t)return{};for(var s=0;s<i.length;s++){var r=i[s].split("=");n[unescape(r[0])]=unescape(r[1])}return n},getHashParam:function(e,t){var i=(t||window.location.hash).substring(1),n="",s="";if(-1!=i.indexOf(e)){if(-1!=(n=i.substring(i.indexOf(e))).indexOf("&"))s=n.split("&")[0].split("=");else s=n.split("=");return s[1]}return!1},paramExists:function(e,t){return!!(t||window.location.href).match("[\\?&]"+e+"([=&#]|$)")},getOrigin:function(e){var t=e?this._getParsableUrl(e):window.location;return t.origin||t.protocol+"//"+t.host},getPath:function(e){var t=(e?this._getParsableUrl(e):window.location).pathname;return-1===[void 0,"/"].indexOf(t[0])&&(t="/"+t),t},_getParsableUrl:function(e){var t=document.createElement("a");return t.href=e,t},_stringifyObject:function(e,t,i){var n="";if(t=t||"&",i=i||"=",null==e||[]==e||{}==e);else if(Array.isArray(e))n=e.join(t);else if("object"==typeof e){for(var s in e){n+=s+i+e[s]+t}n=n.substring(0,n.length-1)}else"string"==typeof e&&(n=e);return n}}}),function(e){var t;if("function"==typeof define&&define.amd&&(define("fly/libs/js-cookie-2.2.0",e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var i=window.Cookies,n=window.Cookies=e();n.noConflict=function(){return window.Cookies=i,n}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function i(n){function s(){}function r(t,i,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},s.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var a=JSON.stringify(i);/^[\{\[]/.test(a)&&(i=a)}catch(e){}i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o="";for(var l in r)r[l]&&(o+="; "+l,!0!==r[l]&&(o+="="+r[l].split(";")[0]));return document.cookie=t+"="+i+o}}function a(e,i){if("undefined"!=typeof document){for(var s={},r=document.cookie?document.cookie.split("; "):[],a=0;a<r.length;a++){var o=r[a].split("="),l=o.slice(1).join("=");i||'"'!==l.charAt(0)||(l=l.slice(1,-1));try{var d=t(o[0]);if(l=(n.read||n)(l,d)||t(l),i)try{l=JSON.parse(l)}catch(e){}if(s[d]=l,e===d)break}catch(e){}}return e?s[e]:s}}return s.set=r,s.get=function(e){return a(e,!1)},s.getJSON=function(e){return a(e,!0)},s.remove=function(t,i){r(t,"",e(i,{expires:-1}))},s.defaults={},s.withConverter=i,s}(function(){})}),define("fly/managers/cookie-2.0",["fly/libs/js-cookie-2.2.0"],function(e){var t={domains:{default:null}};return{init:function(e){this.setConfig(e)},setConfig:function(e){"object"==typeof e&&null!==e&&Object.assign(t,e)},set:function(i,n,s){s=s||{},("object"==typeof n&&null!==n||Array.isArray(n))&&(n=JSON.stringify(n)),s.domain?s.domain in t.domains&&(s.domain=t.domains[s.domain]):s.domain=t.domains.default,s.domain||delete s.domain,e.set(i,n,s)},get:function(t){var i,n=e.get(t);try{i=JSON.parse(n)}catch(e){i=n}return i},remove:function(t,i){e.remove(t,i)}}}),define("fly/managers/debug-2.0",["module","version!fly/utils/string-helper","version!fly/utils/url-helper","version!fly/managers/cookie"],function(e,t,i,n){var s,r,a,o={},l={queryParam:"jsDebug",cookie:{name:"fly_js_debug",domain:"default"}},d=!1,u=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};return Object.assign(l,e.config()),(r=i.getParamAsArray(l.queryParam)||[])?n.set(l.cookie.name,r,{path:"/",domain:l.cookie.domain}):a=n.get(l.cookie.name)||[],(r.indexOf("true")>-1||r.indexOf("all")>-1)&&(n.set(l.cookie.name,!0,{path:"/",domain:l.cookie.domain}),d=!0),(s=function(e){this.name=e,this.color="hsl("+u(0,360)+","+u(35,80)+"%,"+u(20,45)+"%)",(!0===a||Array.isArray(r)&&r.indexOf(this.name)>-1||Array.isArray(a)&&a.indexOf(this.name)>-1)&&this.enable()}).prototype={constructor:s,enabled:!1,_call:function(e,t){if(window.console&&(this.enabled||d)){t.callee=t.callee.caller;var i=[].slice.call(t);-1<["error","info","log","trace","warn"].indexOf(e)&&i.unshift("%c "+this.name+" ","color:#fff;border-radius:3px;background-color:"+this.color+";"),"object"==typeof window.console&&"function"==typeof window.console[e]&&window.console[e].apply(window.console,i)}return this},disable:function(){return this.enabled=!1,this},enable:function(){return this.enabled=!0,this},error:function(){return this._call("error",arguments)},info:function(){return this._call("info",arguments)},log:function(){return this._call("log",arguments)},profile:function(){return this._call("profile",arguments)},profileEnd:function(){return this._call("profileEnd",arguments)},timeStamp:function(){return this._call("timeStamp",arguments)},trace:function(){return this._call("trace",arguments)},warn:function(){return this._call("warn",arguments)}},{init:function(e){var t=new s(e);return o[e]=t,t},get:function(e){return o[e]||this.init(e)}}}),define("libs/hls-video",["version!fly/managers/debug"],function(e){return function(t){var i=e.init("hls-wrapper");i.log("Prepare to initialize");var n,s=null,r=function(e,t,n){return i.log("togglePlayback",t?"pause":"play",n),t&&e.paused?void i.log("Video is already paused",n):t?(i.log("PAUSE video",n),e.pause(),s&&s.stopLoad(),!0):e.paused?(i.log("PLAY video",n),e.play(),s&&s.startLoad(-1),!0):void i.log("Video IS not paused",n)},a=function(e,t,n,a){if(void 0!==document.hidden||void 0!==document.webkitHidden){document.addEventListener(n,function(){i.log("onPageVisibilityChange","Page is",document[a]?"hidden":"visible"),r(e,document[a],t,s)},!1)}},o=function(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return i&&n},l=function(e){return e.defaultPrevented||"VIDEO"!=e.nodeName||!e.hasAttribute("data-hls-wrapper")}(t)?null:function(e){var t=e;return t.muted=t.hasAttribute("muted"),t.autoplay=t.hasAttribute("autoplay"),t.disableRemotePlayback=!0,t.onerror=function(e){i.error("Error "+t.error.code+"; details: "+t.error.message),t.getAttribute("data-poster")&&t.setAttribute("poster",t.getAttribute("data-poster"))},t}(t),d=l?function(e){var t=e.getAttribute("src"),n=e.getAttribute("data-src"),s=e.querySelector("source"),r=s&&s.getAttribute("data-src");return t=t||n||(s&&s.src?s.src:r||null),i.log("Found video source",t),t}(l):null;return function(e){if(!e)return i.error("No video source available"),!0}(d)?null:(n=function(){var e=function(){var e,t;return void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange",pageVisibilitySupported=!0),[e,t]}(),t=e[0],n=e[1];a(l,d,n,t),l.hasAttribute("data-hls-wrapper-no-observer")?i.log("IntersectionObserver is disabled on this video"):function(e,t){try{new IntersectionObserver(function(n){i.log("intersectionObserver",n[0].intersectionRatio,e),r(e,0==n[0].intersectionRatio,t)}).observe(e)}catch(e){i.error(e)}}(l,d),function(e){var t=e.querySelector("source");return!(t&&e.canPlayType(t.type)||e.canPlayType("application/vnd.apple.mpegURL")||!o())||(i.log("native playback is supported or HLS.js is not supported"),!1)}(l)&&(s=function(e,t){return(s=new Hls({capLevelToPlayerSize:!0,enableWebVTT:!1,enableCEA708Captions:!1,autoLevelCapping:2})).attachMedia(e),s.on(Hls.Events.MEDIA_ATTACHED,function(){s.loadSource(t),s.on(Hls.Events.MANIFEST_PARSED,function(){r(e,!e.hasAttribute("autoplay"),t)})}),s.on(Hls.Events.ERROR,function(e,t){if(t.fatal)switch(t.type){case Hls.ErrorTypes.NETWORK_ERROR:i.error("fatal network error encountered, try to recover",t),s.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:i.error("fatal media error encountered, try to recover",t),s.recoverMediaError();break;default:i.error("cannot recover, destroy",t),s.destroy()}}),s}(l,d))},void(window.Hls?(i.log("Hls.js is available"),setTimeout(n,0)):(i.log("Hls.js is not available"),require(["version!libs/hls"],function(e){window.Hls=window.Hls||e,n()}))))}}),window.lazySizesConfig=window.lazySizesConfig||{},window.lazySizesConfig.init=!1,window.lazySizesConfig.loadMode=1,window.lazySizesConfig.preloadAfterLoad=!!parseInt(CBSNEWS.features.getFeatureValue("lazysizes.preloadAfterLoad"));var userAgent=navigator.userAgent.toLowerCase(),isSafari=/^((?!chrome).)*safari/.test(userAgent);define("libs/lazysizes.plugins",["libs/hls-video"],function(e){"use strict";addEventListener("lazybeforeunveil",function(t){if(!t.defaultPrevented){if(t.target.getAttribute("data-component")){if("string"==typeof(i=t.target.getAttribute("data-component"))&&(i=[i]),i[0]&&i[0].match(/^\[/))var i=JSON.parse(i[0]);else i=i;i.forEach(function(e,i){var n=JSON.parse(t.target.getAttribute("data-"+e+"-options")||{});require(["components/"+e],function(e){e(t.target,n)})})}var n=["videoPreview"];if(l=t.target.getAttribute("data-preview-url"),"VIDEO"==t.target.nodeName&&l&&(l.indexOf("splice.amlg.io")>=0&&n.push("splice"),CBSNEWS.features.executeIfEnabled(n,function(i){t.target.setAttribute("src",i),e(t.target)},window,[l])),l=t.target.getAttribute("data-poster"),"VIDEO"==t.target.nodeName&&l&&CBSNEWS.features.executeIfDisabled(n,function(e){t.target.setAttribute("poster",l)},window,[l]),"IFRAME"==t.target.nodeName){var s=t.target,r=s.parentElement.querySelector(".embed__resizer"),a=(s.getAttribute("data-width")||"").replace("px",""),o=(s.getAttribute("data-height")||"").replace("px","");if(r&&r.hasAttribute("data-resized")||(r&&o>0&&a>0?r.setAttribute("style","padding-top:"+o/a*100+"%"):(a&&s.setAttribute("width",a),o&&s.setAttribute("height",o),r&&o&&r.setAttribute("style","padding-top:"+o+"px"))),/^\/embed\/video\//.test(s.getAttribute("src")||s.getAttribute("data-src"))&&!document.body.classList.contains("has__video-player")&&document.body.classList.add("has__video-player"),t.target.getAttribute("data-src")){t.preventDefault();var l=t.target.getAttribute("data-src"),d="social";/^(?:https?:)?\/\/.+?cbsnews.com/i.test(l)||/^\/[^\/]/.test(l)?d="essential":t.target.hasAttribute("data-optanon-category")&&(d=t.target.getAttribute("data-optanon-category")),CBSNEWS.features.executeWithConsent(["iframe"],d,function(e){var t=e.getAttribute("data-src");if(t){var i=e.cloneNode();i.setAttribute("src",t),i.removeAttribute("data-src"),e.parentElement.replaceChild(i,e)}},this,[t.target,l])}}if(l=t.target.getAttribute("href"),"LINK"==t.target.nodeName&&l){var u=new XMLHttpRequest;u.open("GET",l,!0),u.send(),u.onload=function(){if(u.responseXML&&"image/svg+xml"===u.responseXML.contentType)document.head.insertAdjacentHTML("beforeend",u.responseText);else if("application/json"===u.getResponseHeader("Content-Type")){var e=JSON.parse(u.responseText);t.target.insertAdjacentHTML("afterend",e.html)}else t.target.insertAdjacentHTML("afterend",u.responseText)}}if((l=t.target.getAttribute("data-require"))&&window.require){var c=t.target.getAttribute("data-require-callback"),h=JSON.parse(t.target.getAttribute("data-require-arguments"));require([l],function(e,t){return function(){e&&"function"==typeof window[e]&&window[e].apply(window,t||arguments)}}(c,h))}if((l=t.target.getAttribute("data-lazy-taboola"))&&t.target.setAttribute("data-taboola",l),(l=t.target.getAttribute("data-taboola"))&&window.CBSNEWS.taboola&&window.CBSNEWS.taboola.push(t.target,!0),l=t.target.getAttribute("data-ad-unit")){var p=JSON.parse(l),f=document.querySelectorAll('[id="'+t.target.id+'"]').length;Array.isArray(p)&&f>1&&(p[1]+=document.querySelectorAll('[id^="'+p[0]+'"]').length-f+1,t.target.setAttribute("id",p.join("")),t.target.setAttribute("data-ad-unit",JSON.stringify(p)),console.log("ADS: incremental ad",p,"is clashing with another, updated id to",t.target.id)),console.log("ADS: queuing to lazyload",t.target.getAttribute("id")),window.cbsiGptDivIds=window.cbsiGptDivIds||[],cbsiGptDivIds.push(p)}}},!1)}),function(e){var t=function(e,t,i){"use strict";var n,s;if(function(){var t,i={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};for(t in s=e.lazySizesConfig||e.lazysizesConfig||{},i)t in s||(s[t]=i[t])}(),!t||!t.getElementsByClassName)return{init:function(){},cfg:s,noSupport:!0};var r=t.documentElement,a=e.HTMLPictureElement,o="addEventListener",l="getAttribute",d=e[o].bind(e),u=e.setTimeout,c=e.requestAnimationFrame||u,h=e.requestIdleCallback,p=/^picture$/i,f=["load","error","lazyincluded","_lazyloaded"],v={},g=Array.prototype.forEach,_=function(e,t){return v[t]||(v[t]=new RegExp("(\\s|^)"+t+"(\\s|$)")),v[t].test(e[l]("class")||"")&&v[t]},m=function(e,t){_(e,t)||e.setAttribute("class",(e[l]("class")||"").trim()+" "+t)},E=function(e,t){var i;(i=_(e,t))&&e.setAttribute("class",(e[l]("class")||"").replace(i," "))},y=function(e,t,i){var n=i?o:"removeEventListener";i&&y(e,t),f.forEach(function(i){e[n](i,t)})},A=function(e,i,s,r,a){var o=t.createEvent("Event");return s||(s={}),s.instance=n,o.initEvent(i,!r,!a),o.detail=s,e.dispatchEvent(o),o},S=function(t,i){var n;!a&&(n=e.picturefill||s.pf)?(i&&i.src&&!t[l]("srcset")&&t.setAttribute("srcset",i.src),n({reevaluate:!0,elements:[t]})):i&&i.src&&(t.src=i.src)},b=function(e,t){return(getComputedStyle(e,null)||{})[t]},T=function(e,t,i){for(i=i||e.offsetWidth;i<s.minSize&&t&&!e._lazysizesWidth;)i=t.offsetWidth,t=t.parentNode;return i},D=function(){var e,i,n=[],s=[],r=n,a=function(){var t=r;for(r=n.length?s:n,e=!0,i=!1;t.length;)t.shift()();e=!1},o=function(n,s){e&&!s?n.apply(this,arguments):(r.push(n),i||(i=!0,(t.hidden?u:c)(a)))};return o._lsFlush=a,o}(),C=function(e,t){return t?function(){D(e)}:function(){var t=this,i=arguments;D(function(){e.apply(t,i)})}},I=function(e){var t,n=0,r=s.throttleDelay,a=s.ricTimeout,o=function(){t=!1,n=i.now(),e()},l=h&&a>49?function(){h(o,{timeout:a}),a!==s.ricTimeout&&(a=s.ricTimeout)}:C(function(){u(o)},!0);return function(e){var s;(e=!0===e)&&(a=33),t||(t=!0,(s=r-(i.now()-n))<0&&(s=0),e||s<9?l():u(l,s))}},R=function(e){var t,n,s=function(){t=null,e()},r=function(){var e=i.now()-n;e<99?u(r,99-e):(h||s)(s)};return function(){n=i.now(),t||(t=u(r,99))}},P=function(){var a,h,f,v,T,P,O,L,w,N,k,B,U=/^img$/i,j=/^iframe$/i,x="onscroll"in e&&!/(gle|ing)bot/.test(navigator.userAgent),F=0,G=0,V=-1,H=function(e){G--,(!e||G<0||!e.target)&&(G=0)},W=function(e){return null==B&&(B="hidden"==b(t.body,"visibility")),B||!("hidden"==b(e.parentNode,"visibility")&&"hidden"==b(e,"visibility"))},K=function(e,i){var n,s=e,a=W(e);for(L-=i,k+=i,w-=i,N+=i;a&&(s=s.offsetParent)&&s!=t.body&&s!=r;)(a=(b(s,"opacity")||1)>0)&&"visible"!=b(s,"overflow")&&(n=s.getBoundingClientRect(),a=N>n.left&&w<n.right&&k>n.top-1&&L<n.bottom+1);return a},z=function(){var e,i,o,d,u,c,p,f,g,_,m,E,y=n.elements;if((v=s.loadMode)&&G<8&&(e=y.length)){for(i=0,V++;i<e;i++)if(y[i]&&!y[i]._lazyRace)if(!x||n.prematureUnveil&&n.prematureUnveil(y[i]))$(y[i]);else if((f=y[i][l]("data-expand"))&&(c=1*f)||(c=F),_||(_=!s.expand||s.expand<1?r.clientHeight>500&&r.clientWidth>500?500:370:s.expand,n._defEx=_,m=_*s.expFactor,E=s.hFac,B=null,F<m&&G<1&&V>2&&v>2&&!t.hidden?(F=m,V=0):F=v>1&&V>1&&G<6?_:0),g!==c&&(P=innerWidth+c*E,O=innerHeight+c,p=-1*c,g=c),o=y[i].getBoundingClientRect(),(k=o.bottom)>=p&&(L=o.top)<=O&&(N=o.right)>=p*E&&(w=o.left)<=P&&(k||N||w||L)&&(s.loadHidden||W(y[i]))&&(h&&G<3&&!f&&(v<3||V<4)||K(y[i],c))){if($(y[i]),u=!0,G>9)break}else!u&&h&&!d&&G<4&&V<4&&v>2&&(a[0]||s.preloadAfterLoad)&&(a[0]||!f&&(k||N||w||L||"auto"!=y[i][l](s.sizesAttr)))&&(d=a[0]||y[i]);d&&!u&&$(d)}},Y=I(z),q=function(e){var t=e.target;t._lazyCache?delete t._lazyCache:(H(e),m(t,s.loadedClass),E(t,s.loadingClass),y(t,J),A(t,"lazyloaded"))},X=C(q),J=function(e){X({target:e.target})},Q=function(e){var t,i=e[l](s.srcsetAttr);(t=s.customMedia[e[l]("data-media")||e[l]("media")])&&e.setAttribute("media",t),i&&e.setAttribute("srcset",i)},Z=C(function(e,t,i,n,r){var a,o,d,c,h,v;(h=A(e,"lazybeforeunveil",t)).defaultPrevented||(n&&(i?m(e,s.autosizesClass):e.setAttribute("sizes",n)),o=e[l](s.srcsetAttr),a=e[l](s.srcAttr),r&&(c=(d=e.parentNode)&&p.test(d.nodeName||"")),v=t.firesLoad||"src"in e&&(o||a||c),h={target:e},m(e,s.loadingClass),v&&(clearTimeout(f),f=u(H,2500),y(e,J,!0)),c&&g.call(d.getElementsByTagName("source"),Q),o?e.setAttribute("srcset",o):a&&!c&&(j.test(e.nodeName)?function(e,t){try{e.contentWindow.location.replace(t)}catch(i){e.src=t}}(e,a):e.src=a),r&&(o||c)&&S(e,{src:a})),e._lazyRace&&delete e._lazyRace,E(e,s.lazyClass),D(function(){var t=e.complete&&e.naturalWidth>1;v&&!t||(t&&m(e,"ls-is-cached"),q(h),e._lazyCache=!0,u(function(){"_lazyCache"in e&&delete e._lazyCache},9)),"lazy"==e.loading&&G--},!0)}),$=function(e){if(!e._lazyRace){var t,i=U.test(e.nodeName),n=i&&(e[l](s.sizesAttr)||e[l]("sizes")),r="auto"==n;(!r&&h||!i||!e[l]("src")&&!e.srcset||e.complete||_(e,s.errorClass)||!_(e,s.lazyClass))&&(t=A(e,"lazyunveilread").detail,r&&M.updateElem(e,!0,e.offsetWidth),e._lazyRace=!0,G++,Z(e,t,r,n,i))}},ee=R(function(){s.loadMode=3,Y()}),te=function(){3==s.loadMode&&(s.loadMode=2),ee()},ie=function(){h||(i.now()-T<999?u(ie,999):(h=!0,s.loadMode=3,Y(),d("scroll",te,!0)))};return{_:function(){T=i.now(),n.elements=t.getElementsByClassName(s.lazyClass),a=t.getElementsByClassName(s.lazyClass+" "+s.preloadClass),d("scroll",Y,!0),d("resize",Y,!0),d("pageshow",function(e){if(e.persisted){var i=t.querySelectorAll("."+s.loadingClass);i.length&&i.forEach&&c(function(){i.forEach(function(e){e.complete&&$(e)})})}}),e.MutationObserver?new MutationObserver(Y).observe(r,{childList:!0,subtree:!0,attributes:!0}):(r[o]("DOMNodeInserted",Y,!0),r[o]("DOMAttrModified",Y,!0),setInterval(Y,999)),d("hashchange",Y,!0),["focus","mouseover","click","load","transitionend","animationend"].forEach(function(e){t[o](e,Y,!0)}),/d$|^c/.test(t.readyState)?ie():(d("load",ie),t[o]("DOMContentLoaded",Y),u(ie,2e4)),n.elements.length?(z(),D._lsFlush()):Y()},checkElems:Y,unveil:$,_aLSL:te}}(),M=function(){var e,i=C(function(e,t,i,n){var s,r,a;if(e._lazysizesWidth=n,n+="px",e.setAttribute("sizes",n),p.test(t.nodeName||""))for(r=0,a=(s=t.getElementsByTagName("source")).length;r<a;r++)s[r].setAttribute("sizes",n);i.detail.dataAttr||S(e,i.detail)}),n=function(e,t,n){var s,r=e.parentNode;r&&(n=T(e,r,n),(s=A(e,"lazybeforesizes",{width:n,dataAttr:!!t})).defaultPrevented||(n=s.detail.width)&&n!==e._lazysizesWidth&&i(e,r,s,n))},r=R(function(){var t,i=e.length;if(i)for(t=0;t<i;t++)n(e[t])});return{_:function(){e=t.getElementsByClassName(s.autosizesClass),d("resize",r)},checkElems:r,updateElem:n}}(),O=function(){!O.i&&t.getElementsByClassName&&(O.i=!0,M._(),P._())};return u(function(){s.init&&O()}),n={cfg:s,autoSizer:M,loader:P,init:O,uP:S,aC:m,rC:E,hC:_,fire:A,gW:T,rAF:D}}(e,e.document,Date);"object"==typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define("common/../../../../../../../node_modules/lazysizes/lazysizes-umd.min",t):e.lazySizes=t}(window),require(["libs/lazysizes.plugins","common/../../../../../../../node_modules/lazysizes/lazysizes-umd.min"],function(e,t){t.init()}),define("common/lazysizes",function(){});var CBSNEWS=CBSNEWS||{};CBSNEWS.consentStates={targeting:null,performance:null,functional:null,social:null},CBSNEWS.updateConsentStates=function(e,t,i,n){CBSNEWS.consentStates.targeting=e,CBSNEWS.consentStates.performance=t,CBSNEWS.consentStates.functional=i,CBSNEWS.consentStates.social=n,window.console&&console.log("cbsoptanon::addOnConsentChangedHandler","getState",JSON.parse(JSON.stringify(CBSNEWS.consentStates)))},window.cbsoptanon=window.cbsoptanon?window.cbsoptanon:{},cbsoptanon.cmd=cbsoptanon.cmd?cbsoptanon.cmd:[],cbsoptanon.config=cbsoptanon.config?cbsoptanon.config:[],["onIframesReady","onFormsReady","onScriptsReady","onAdsReady"].forEach(function(e){cbsoptanon[e]=cbsoptanon[e]||function(){var t=arguments;cbsoptanon.cmd.push(function(){cbsoptanon[e].apply(cbsoptanon,t)})}}),window.cbsoptanon.onScriptsReady(function(e){e.leavebehind.bannerCloseListener(function(){"none"===document.getElementById(e.constants.OT_LEAVEBEHIND_ID).style.display?document.body.classList.remove("manage-cookies-btn--is-visible"):document.body.classList.add("manage-cookies-btn--is-visible")})}),window.cbsoptanon.config.push({enableServices:!1,setNpaOnConsentChange:!0}),CBSNEWS.frameElement;try{CBSNEWS.frameElement=window.frameElement}catch(e){CBSNEWS.frameElement=null}if(CBSNEWS.features.isFeatureDisabled("consent"));else if(window===window.top||/optanonConsent/.test(window.location.search)){cbsoptanon.cmd.push(function(e){e.ot.addOnConsentChangedHandler(function(){e.ot.getState(CBSNEWS.updateConsentStates)})});var script=document.createElement("script");script.src=CBSNEWS.oneTrustPath,script.async=!0,script.setAttribute("data-domain-script",CBSNEWS.oneTrustScriptId),document.head.appendChild(script);var script=document.createElement("script");script.src=CBSNEWS.optAnonPath,script.async=!0,script.setAttribute("id","bb-cbsoptanon"),document.head.appendChild(script)}else CBSNEWS.frameElement?(CBSNEWS.consentStates=window.parent.CBSNEWS.consentStates,window.parent.cbsoptanon?window.cbsoptanon_=window.cbsoptanon=window.parent.cbsoptanon:window.cbsoptanon_=window.parent.cbsoptanon=window.cbsoptanon,function(e){cbsoptanon.cmd.push(function(t){window.console&&console.log("cbsoptanon::cmd","check reference",e.cbsoptanon===t),e.cbsoptanon!==t&&(e.cbsoptanon=t,e.cbsoptanon_.cmd.forEach(function(e){t.cmd.push(e)}))})}(window)):CBSNEWS.features.consent=!1;function popupHandler(e){var t=screen.width/2-480,i=screen.height/2-275.5,n=window.open(e,"securePopup","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=no, width=960, height=551, top="+i+", left="+t);if(-1!=navigator.userAgent.indexOf("Edge")||-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Trident")){window.setTimeout(function e(){n.closed?location.reload():window.setTimeout(e,1e3)},1e3)}else{var s=window.addEventListener?"addEventListener":"attachEvent";(0,window[s])("attachEvent"==s?"onmessage":"message",function(e){e.origin.indexOf("cbsnews")<-1||"loginWindow"!==e.data||(location.href=addParameterToURL(location.href,"login=1"))},!1)}}define("common/consent",function(){}),define("common/dynamic-css-classes",[],function(){"use strict";var e=/flipboard/i,t=/nytimes/i,i=[],n=navigator.userAgent;/(Android|iOS)\s+App\s+\[CBS[^\]]+\]/i.test(n)&&(CBSNEWS.isApp=!0,i.push("viewer--app")),(window.matchMedia("(display-mode: standalone)").matches||navigator.standalone)&&(CBSNEWS.isPWA=!0,i.push("viewer--pwa"));var s=document.referrer;if(s){var r=document.createElement("A");r.href=s;var a=r.hostname;"t.co"===a&&(a="twitter.com"),!s&&/pinterest/i.test(n)?a="www.pinterest.com":e.test(s)||e.test(n)?a="flipboard.com":t.test(s)||t.test(n)?a="nytimes.com":CBSNEWS.isApp&&(a="www.cbsnews.com");var o="";i=i.concat(a.split(".").reduceRight(function(e,t){return o&&(t+="."+o),o=t,e.push(t),e},[]).map(function(e){return"referrer--"+e.replace(/\./g,"-")}))}document.documentElement.className+=" "+i.join(" ")}),window.uuid||(window.uuid={}),void 0===window.uuid.v4&&(window.uuid.v4=function(){var e,t,i="";for(e=0;e<32;e++)t=16*Math.random()|0,8!=e&&12!=e&&16!=e&&20!=e||(i+="-"),i+=(12==e?4:16==e?3&t|8:t).toString(16);return i}),define("fly/libs/uuid.v4",function(){}),define("utils/clean-url",["version!fly/managers/debug"],function(e){"use strict";var t=e.init("cleanUrl");return{include:function(e){var i=new URLSearchParams(window.location.search);Array.from(i.keys()).forEach(function(n){t.log("cleanUrl::include","evaluate key",n),"chromeless"===n&&(CBSNEWS.chromeless=!0),"adobe_mc"===n&&(window.location.hash="adobe_mc="+i.get(n)),-1===e.indexOf(n)&&(t.log("cleanUrl::include","delete key",n),i.delete(n))}),history.replaceState(null,"",window.location.origin+window.location.pathname+"?"+i.toString())},exclude:function(e){var i=new URLSearchParams(window.location.search);Array.from(i.keys()).forEach(function(n){t.log("cleanUrl::exclude","evaluate key",n),-1!==e.indexOf(n)&&(t.log("cleanUrl::exclude","delete key",n),i.delete(n))}),history.replaceState(null,"",window.location.origin+window.location.pathname+"?"+i.toString())}}}),window.addEventListener("message",function(e){if(e.origin===window.location.origin&&e.data&&"resize"===e.data.event){var t=e.source.frameElement.closest(".embed").querySelector(".embed__resizer");t.style.paddingTop=e.data.height+"px",t.setAttribute("data-resized","")}},!1),define("common/iframe-resizer",function(){}),
/**
 * Copyright 2018 The AMP HTML Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
define("common/amp-linker-parser",[],function(){"use strict";function e(e){if("undefined"!=typeof TextDecoder)return new TextDecoder("utf-8").decode(e);var t=function(e){for(var t=new Array(e.length),i=0;i<e.length;i++)t[i]=String.fromCharCode(e[i]);return t.join("")}(new Uint8Array(e.buffer||e));return decodeURIComponent(escape(t))}function t(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++){var n=e.charCodeAt(i);n<=255&&console.warn("Characters must be in range [0,255]"),t[i]=n}return t}var i={"-":"+",_:"/",".":"="};function n(n){return e(function(e){return t(atob(e.replace(/[-_.]/g,function(e){return i[e]})))}(n))}var s=3988292384,r=null;function a(e){r||(r=function(){for(var e=new Array(256),t=0;t<256;t++){for(var i=t,n=0;n<8;n++)1&i?i=i>>>1^s:i>>>=1;e[t]=i}return e}());for(var i,n=(i=e,"undefined"!=typeof TextEncoder?new TextEncoder("utf-8").encode(i):t(unescape(encodeURIComponent(i)))),a=-1>>>0,o=0;o<n.length;o++){var l=255&(a^n[o]);a=a>>>8^r[l]}return(-1^a)>>>0}var o="*",l=/^[a-zA-Z0-9\-_.]+$/,d=1,u=1,c="amp-analytics/linker";function h(e,t){var i,n,s=t||0;return a([(i=(new Date).getTimezoneOffset(),n=window.navigator.userLanguage||window.navigator.language,[window.navigator.userAgent,i,n].join(o)),Math.floor(Date.now()/6e4)-s,e].join(o)).toString(36)}function p(e){return n(String(e))}return function(e){var t=function(e){var t=e.split(o),i=t.length%2==0;if(t.length<4||!i)return console.error(c,"Invalid linker_param value "+e),null;var n=parseInt(t.shift());if(n!==u)return console.error(c,"Invalid version number "+n),null;var s=t.shift(),r=t.join(o);return{checksum:s,serializedIds:r}}(e);if(!t)return null;var i=t.checksum,n=t.serializedIds;return function(e,t){for(var i=0;i<=d;i++){var n=h(e,i);if(n==t)return!0}return!1}(n,i)?function(e){for(var t={},i=e.split(o),n=0;n<i.length;n+=2){var s=i[n],r=l.test(s);if(r){var a=p(i[n+1]);t[s]=a}else console.error(c,"Invalid linker key "+s+", value ignored")}return t}(n):(console.error(c,"LINKER_PARAM value checksum not valid"),null)}}),define("common/s-vid-override",["common/amp-linker-parser"],function(e){var t=window.location.search.match(/[?&]_amp=([^&]+)/);if(t){var i=e(t[1]);i&&i.s_vid&&(window.s_vid=CBSNEWS.tracking.visitorID=i.s_vid)}}),/(\/user\/|\/embed\/)/.test(window.location.href)||CBSNEWS.features.executeIfEnabled(["cedexis"],setTimeout,this,[require,parseInt(CBSNEWS.features.cedexis)||15e3,["https://radar.cedexis.com/1/55171/radar.js#"]]),define("third-party/cedexis",function(){}),CBSNEWS.features.executeWithConsent(["chartbeat"],"performance",function(){window._sf_startpt=window._sf_startpt||(new Date).getTime(),window._sf_async_config=window._sf_async_config||{},_sf_async_config.uid="64660",_sf_async_config.domain="cbsnews.com",_sf_async_config.autoDetect=!1;var e=function(){_sf_async_config.flickerControl=!1,_sf_async_config.useCanonical=!0,_sf_async_config.authors=CBSNEWS.tracking.articleAuthorName,window===window.top&&(_sf_async_config.playerdomain=window.location.hostname),"app"===CBSNEWS.device&&(_sf_async_config.mobileApp=!0),_sf_async_config.sections=CBSNEWS.tracking.siteHier,_sf_async_config.sections=["page-"+CBSNEWS.tracking.pageType].concat(CBSNEWS.tracking.siteHier,CBSNEWS.tracking.allTopics||[],CBSNEWS.tracking.collectionName||[],CBSNEWS.tracking.hasVideo?[]:"novideo").map(function(e){return e.replace(/\s+/g,"-")}).filter(function(e,t,i){return i.indexOf(e)===t}).join(","),_sf_async_config.type=CBSNEWS.tracking.pageType,_sf_async_config.virtual_page_path=window.location.pathname,_sf_async_config.virtual_page_title=document.title};CBSNEWS.tracking.noViewTrack||(e(),window.addEventListener("tracking:view",function(){e(),pSUPERFLY&&pSUPERFLY.virtualPage(_sf_async_config.virtual_page_path,_sf_async_config.virtual_page_title)})),/(front_door|collection_door|show_door|topic_door)/.test(CBSNEWS.tracking.pageType)&&window===top?require(["https://static.chartbeat.com/js/chartbeat_mab.js#"],function(){require(["https://static.chartbeat.com/js/chartbeat_video.js#"],function(){_sf_endpt=(new Date).getTime()})}):require(["https://static.chartbeat.com/js/chartbeat_video.js#"],function(){_sf_endpt=(new Date).getTime()})}),define("third-party/chartbeat",function(){}),CBSNEWS.features.executeIfEnabled(["mpulse"],function(){var e=CBSNEWS.mpulse.keys,t=/(\w+\.\w+)$/.exec(window.location.host),i=e["cbsnews.com"];if(t&&t[0]&&t[0]in e&&(i=e[t[0]]),!(window.BOOMR&&(window.BOOMR.version||window.BOOMR.snippetExecuted)||/MRA58N/i.test(navigator.userAgent))){window.BOOMR=window.BOOMR||{},window.BOOMR.snippetStart=(new Date).getTime(),window.BOOMR.snippetExecuted=!0,window.BOOMR.snippetVersion=12,window.BOOMR_config=window.BOOMR_config||{},window.BOOMR_config.History={enabled:!1},/(Android 6\.0\.1|Lighthouse)/i.test(navigator.userAgent)&&(window.BOOMR_config.Errors=window.BOOMR_config.Errors||{},window.BOOMR_config.Errors.monitorTimeout=!1,window.BOOMR_config.Errors.monitorEvents=!1),window.BOOMR.url="https://c.go-mpulse.net/boomerang/"+i;var n=document.currentScript||document.getElementsByTagName("script")[0],s=!1,r=document.createElement("link");r.relList&&"function"==typeof r.relList.supports&&r.relList.supports("preload")&&"as"in r?(window.BOOMR.snippetMethod="p",r.href=window.BOOMR.url,r.rel="preload",r.as="script",r.addEventListener("load",function(){if(!s){var e=document.createElement("script");e.id="boomr-scr-as",e.src=window.BOOMR.url,e.async=!0,n.parentNode.appendChild(e),s=!0}}),r.addEventListener("error",function(){a(!0)}),setTimeout(function(){s||a(!0)},3e3),BOOMR_lstart=(new Date).getTime(),n.parentNode.appendChild(r)):a(!1),window.addEventListener?window.addEventListener("load",o,!1):window.attachEvent&&window.attachEvent("onload",o)}function a(e){s=!0;var t,i,r,a,o=document,l=window;if(window.BOOMR.snippetMethod=e?"if":"i",i=function(e,t){var i=o.createElement("script");i.id=t||"boomr-if-as",i.src=window.BOOMR.url,BOOMR_lstart=(new Date).getTime(),(e=e||o.body).appendChild(i)},!window.addEventListener&&window.attachEvent&&navigator.userAgent.match(/MSIE [67]\./))return window.BOOMR.snippetMethod="s",void i(n.parentNode,"boomr-async");(r=document.createElement("IFRAME")).src="about:blank",r.title="",r.role="presentation",r.loading="eager",(a=(r.frameElement||r).style).width=0,a.height=0,a.border=0,a.display="none",n.parentNode.appendChild(r);try{l=r.contentWindow,o=l.document.open()}catch(e){t=document.domain,r.src="javascript:var d=document.open();d.domain='"+t+"';void(0);",l=r.contentWindow,o=l.document.open()}t?(o._boomrl=function(){this.domain=t,i()},o.write("<body onload='document._boomrl();'>")):(l._boomrl=function(){i()},l.addEventListener?l.addEventListener("load",l._boomrl,!1):l.attachEvent&&l.attachEvent("onload",l._boomrl)),o.close()}function o(e){window.BOOMR_onload=e&&e.timeStamp||(new Date).getTime()}}),define("third-party/mpulse",function(){}),CBSNEWS.features.executeWithConsent(["PnGpixel"],"performance",function(){CBSNEWS.features.PnGpixel=!1,/\/(embed|user|elections|live)\//.test(window.location.pathname)||(window.setUpAgknTag=function(e){e.setBpId("cbsinteractive")},setTimeout(require,parseInt(CBSNEWS.features.PnGpixel)||15e3,["https://js.agkn.com/prod/v0/tag.js#"]))},window),define("third-party/png-pixel",function(){}),CBSNEWS.features.executeWithConsent(["qualtrics"],"performance",function(){var e=window.location.href;if(window===window.parent&&("desktop"===CBSNEWS.device||"mobile"===CBSNEWS.device)&&!/(\/user\/|\/embed\/)/.test(e)){window.ZN_77YCxjAq1e0122V_ed="",window.ZN_77YCxjAq1e0122V_sampleRate=100,window.ZN_77YCxjAq1e0122V_url="https://"+"ZN_77YCxjAq1e0122V".toLowerCase()+"-cbs.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_77YCxjAq1e0122V&Q_LOC="+encodeURIComponent(e)+"#";var t=document.createElement("div");t.setAttribute("id","ZN_77YCxjAq1e0122V"),document.body.appendChild(t),setTimeout(require,parseInt(CBSNEWS.features.qualtrics)||15e3,[window.ZN_77YCxjAq1e0122V_url])}}),define("third-party/qualtrics",function(){}),CBSNEWS.features.executeWithConsent(["trueAnthem"],"performance",function(){!/\/embed\//.test(window.location.pathname)&&CBSNEWS.tracking&&["content_article","content_gallery","content_guide","content_live_blog","content_media_post","content_updating_story","content_video"].indexOf(CBSNEWS.tracking.articleType)>-1&&setTimeout(function(){var e=new XMLHttpRequest;e.open("POST","https://beacon.tru.am/beacon"),e.withCredentials=!1,e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send("clientID="+encodeURIComponent(["1081","1192","1193"])+"&version=14&canonical="+encodeURIComponent(CBSNEWS.tracking._pageCanonicalUrl)+"&ogURL="+encodeURIComponent(CBSNEWS.tracking._pageCanonicalUrl)+"&search="+encodeURIComponent(window.location.search.replace(/^\?/,""))+"&referrer="+encodeURIComponent(document.referrer))},parseInt(CBSNEWS.features.trueAnthem)||15e3),CBSNEWS.features.trueAnthem=!1},window),define("third-party/true-anthem",function(){}),require(["common/s-vid-override"]),require(["third-party/cedexis"]),require(["third-party/chartbeat"]),require(["third-party/mpulse"]),require(["third-party/png-pixel"]),require(["third-party/qualtrics"]),require(["third-party/true-anthem"]),define("common/tracking",function(){}),function(){"use strict";var e={"element.closest":function(){return!!Element.prototype.closest},fetch:function(){return!!window.fetch},"function.prototype.bind":function(){return!!Function.prototype.bind},"intersection-observer":function(){return"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype},lineclamp:function(){return void 0!==document.body.style.webkitLineClamp},"object.assign":function(){return"function"==typeof Object.assign},objectfit:function(){return void 0===document.body.style.msTouchAction},Promise:function(){return!!("Promise"in window)},sendBeacon:function(){return"function"==typeof window.navigator.sendBeacon},"window.CustomEvent":function(){return!(!window.CustomEvent||"object"==typeof window.CustomEvent)}};define("polyfill",{version:"1.0",load:function(t,i,n,s){if(!e)throw new Error("A polyfill config has not been setup");if(!e[t])throw new Error("A polyfill for "+t+" was not specified");s.isBuild||!0===e[t]()?n():i(["polyfills/"+t],function(e){n(e)})}})}(),define("third-party/bidbarrel",["polyfill!Promise","polyfill!fetch"],function(){CBSNEWS.features.executeWithConsent(["ads","adsBidBarrel"],"essential",function(){window.BidBarrel=window.BidBarrel||{},BidBarrel.queue=BidBarrel.queue||[];var e=/((CPU[ +]OS|iPhone[ +]OS|CPU[ +]iPhone|CPU IPhone OS)[ +]+(10[_\.]0|10[_\.](2|3)|11[_\.]0|11[_\.](2|3|4)|12[_\.](0|1))(?:[_\.]\d+)?)|(CFNetwork\/808\.(\d))|(CFNetwork\/8.* Darwin\/16\.5\.\d+)|(CFNetwork\/8.* Darwin\/16\.6\.\d+)|(CFNetwork\/8.* Darwin\/16\.7\.\d+)|(CFNetwork\/8.* Darwin\/16\.\d+)|(CFNetwork\/8.* Darwin\/17\.0\.\d+)|(CFNetwork\/8.* Darwin\/17\.2\.\d+)|(CFNetwork\/8.* Darwin\/17\.3\.\d+)|(CFNetwork\/8.* Darwin\/17\.\d+)|(CrMo\/([4-9]|1\d|[2-6]\d|7[0-6])\.0\.\d+\.\d+([\d.]+$|.*Safari\/(?![\d.]+ Edge\/[\d.]+$)))|(Edge\/(1[2-8](?:\.0)?|79(?:\.0)?))|((Chromium|Chrome)\/([4-9]|1\d|[2-6]\d|7[0-6])\.0(?:\.\d+)?([\d.]+$|.*Safari\/(?![\d.]+ Edge\/[\d.]+$)))|(Version\/(10\.(0|1)|11\.(0|1)|12\.0)(?:\.\d+)? Safari\/)|(Trident\/7\.0)|(([MS]?IE) 11\.0)/.test(navigator.userAgent);CBSNEWS.features.isFeatureEnabled("consent")?require([e?CBSNEWS.bidBarrelPath:CBSNEWS.bidBarrelModernPath]):require([e?CBSNEWS.bidBarrelWithoutOptanonPath:CBSNEWS.bidBarrelModernWithoutOptanonPath])},this)}),define("third-party/gpt",[],function(){CBSNEWS.features.adsGPTloaded=null,CBSNEWS.features.executeIfEnabled(["ads","adsGPT"],function(){CBSNEWS.features.adsGPTloaded=!1,require(["https://securepubads.g.doubleclick.net/tag/js/gpt.js#"],function(){CBSNEWS.features.adsGPTloaded=!0})},this)}),define("managers/bidbarrel-ads",["version!fly/managers/debug"],function(e){"use strict";var t=e.init("ads");function i(e){BidBarrel.queue.push(function(i){Array.isArray(e)&&e.length?(t.log("bidBarrel::auction",e),BidBarrel.auction(e)):t.log("bidBarrel::auction","no ad units defined",e),i()})}function n(e,i){var n="";"app"==e.slotVars.platform||/(Android|iOS) App/i.test(navigator.userAgent)?n="app":"mobile"==e.slotVars.platform&&(n="m");var s=Object.assign({dfpPath:{device:n,network:e.slotVars.network,pagePath:e.slotVars.topics,region:e.region||"aw"},pageTargeting:e.targeting},i||{});return t.log("bidBarrel::getConfig",s,e),s}function s(e){return!0}return t.log("bidBarrel::init","Prepare to initialize"),window.BidBarrel=window.BidBarrel||{},BidBarrel.queue=BidBarrel.queue||[],window.cbsiGptDivIds=window.cbsiGptDivIds||[],{auctionAdUnits:i,clearAdSlots:function(e){BidBarrel.queue.push(function(i){Array.isArray(e)?(t.log("bidBarrel::clearAdSlots","Clear ad units",e),BidBarrel.clearSlots(e)):(t.log("bidBarrel::clearAdSlots","Clear all ad units"),BidBarrel.clearSlots()),i()})},destroyAdSlots:function(e){BidBarrel.queue.push(function(i){Array.isArray(e)?(t.log("bidBarrel::destroyAdSlots","Destroy ad units",e),BidBarrel.destroySlots(e)):(t.log("bidBarrel::destroyAdSlots","Destroy all ad units"),BidBarrel.destroyAllSlots()),i()})},init:function(e,r){BidBarrel.queue.push(function(i){BidBarrel.initialize(Object.assign({targeting:{auto:!0,cookie:{consolidate:!0}}},n(e,r))),t.log("bidBarrel::init","Initialized"),i()});var a=Array.prototype.slice.call(document.querySelectorAll("[data-ad-unit]:not(.lazyload):not(.lazyloaded)")).map(function(e){return console.log("ADS: queuing",e.getAttribute("id")),JSON.parse(e.getAttribute("data-ad-unit"))}).concat(window.cbsiGptDivIds).filter(s);t.log("displaying ads for any existing cbsiGptDivIds:",a),i(a),t.log("setting future cbsiGptDivIds ads to lazy load"),window.cbsiGptDivIds={push:function(e){console.log("ADS: queuing",e),s(e)&&i([e])}}},refresh:function(e){BidBarrel.queue.push(function(i){Array.isArray(e)?(t.log("bidBarrel::refresh","Refresh ad units",e),BidBarrel.auction(e)):(t.log("bidBarrel::refresh","Refresh all ad units"),BidBarrel.auctionAll()),i()})},setCallback:function(e,i,n){e&&i&&(t.log("bidBarrel::on","set callback for",e),BidBarrel.queue.push(function(t){BidBarrel.on(e,i),t()}))},setConfig:function(e,i){BidBarrel.queue.push(function(s){var r=n(e,i);t.log("bidBarrel::setConfig",r),BidBarrel.setConfig(r),s()})},setIsAdUnitEnabled:function(e){s=e}}}),define("utils/get-cookie",[],function(){"use strict";return function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}}),define("utils/on-first-interaction",[],function(){return function(e,t){var i,n=function(){clearTimeout(i),document.body.removeEventListener("mousemove",n),document.body.removeEventListener("scroll",n),document.body.removeEventListener("keydown",n),document.body.removeEventListener("click",n),document.body.removeEventListener("touchstart",n),e()};document.body.addEventListener("mousemove",n),document.body.addEventListener("scroll",n),document.body.addEventListener("keydown",n),document.body.addEventListener("click",n),document.body.addEventListener("touchstart",n),t&&(i=setTimeout(n,t))}}),window===window.top&&!document.body.hasAttribute("data-suppress-ads")&&CBSNEWS.features.isFeatureEnabled("ads")?(require(["third-party/bidbarrel"]),require(["third-party/gpt"]),require(["managers/bidbarrel-ads","utils/get-cookie","utils/on-first-interaction","version!fly/managers/debug","polyfill!element.closest"],function(e,t,i,n){var s=n.init("ads");"1"===t("CBS_INTERNAL")&&require(["https://adops.cbsinteractive.com/static_tools/watson/Watson.js?"+Date.now()]);var r=CBSNEWS.ad.gpt;r.targeting.vguid=CBSNEWS.tracking.pageViewGuid;var a=null,o=t("fly_geo");o?a=JSON.parse(o).countryCode:(a="US",s.log("Failed to get countryCode from fly geo cookie")),r.adConfig.regions.forEach(function(e){e.countries.indexOf(a)>-1&&(r.region=e.region,s.log("Set ad region to ",r.region,e,a))}),window.addEventListener("ads:setConfig",function(t){var i,n=CBSNEWS.ad.gpt;n.targeting.vguid=CBSNEWS.tracking.pageViewGuid,t.detail&&"customConfig"in t.detail&&(i=t.detail.customConfig),e.setConfig(n,i)}),window.addEventListener("ads:reloadAds",function(t){e.refresh()}),window.addEventListener("ads:destroySlots",function(t){e.destroyAdSlots()}),e.setIsAdUnitEnabled(function(e){var t=Array.isArray(e)?e[0]:e,i=CBSNEWS.features.isFeatureEnabled(t);return i||s.log("Ad unit is disabled on this page: ",t),i});var l=!1,d=CBSNEWS.features.getFeatureValue("initializeAdsTimeout")||5e3,u=function(){l||(l=!0,e.init(r))},c=function(){"visible"==document.visibilityState&&(i(u,d),document.removeEventListener("visibilitychange",c))};c(),document.addEventListener("visibilitychange",c);var h,p=function(e,t){return e.map(function(e){return e+"."+t}).join(",")},f=document.querySelector(".top-ad-container"),v=document.querySelector('.top-ad-container [data-ad]:not([data-ad*="intromercial"])');if(v){var g=v.getAttribute("data-ad");e.setCallback(p([g],"identified"),function(e,t,i){s.log("identified",g,e,t,i),document.documentElement.classList.add("has__top-ad-container--"+e.type),"display"===e.type&&(s.log("Make",g,"sticky"),f.classList.add("is-sticky"))})}var _=["mpu-plus-native-top"],m=function(){s.log("[Auto-refresh timeout]",h?"Clear existing timeout":"Previous timeout does not exist"),clearTimeout(h),s.log("[Auto-refresh timeout]","Auto refresh ",_,"in","32000ms"),h=setTimeout(e.refresh,32e3,_)};e.setCallback(p(_,"requested"),function(){s.log("[Auto-refresh timeout]","Clear auto-refresh timeout"),clearTimeout(h)}),e.setCallback(p(_,"rendered"),function(){"visible"==document.visibilityState?(s.log("[Auto-refresh timeout]","Page is visible"),m()):(s.log("[Auto-refresh timeout]","Page is not visible"),document.addEventListener("visibilitychange",function(){"visible"!=document.visibilityState?s.log("[Auto-refresh timeout]","Page is still not visible"):(s.log("[Auto-refresh timeout]","Page is now visible"),m())}))}),window.addEventListener("message",function(e){if(e.origin===window.location.protocol+"//"+window.location.host&&"string"==typeof e.data&&0===e.data.indexOf("nativeAdBlankServed_"))for(var t=window.frames,i=0;i<t.length;i++){var n,s=t[i];s!=e.source.parent||((n=s.frameElement.closest(".card--type-html-native-ad"))?(n.style.display="none",n.parentNode.classList.add("card__wrapper--no-ad")):s.frameElement.parentNode.style.display="none")}},!1)})):console.log("ads are disabled"),define("common/site-ads",function(){}),define("third-party/tealium",[],function(){CBSNEWS.features.executeWithConsent(["tealium"],"essential",function(){require([CBSNEWS.tealiumPath])},this)}),define("managers/tealium",["version!fly/managers/debug","fly/libs/uuid.v4","third-party/tealium"],function(e){var t=e.get("tealium");return{trackingData:{},viewGuid:null,resetGuidEnabled:!0,init:function(e){this.trackingData=e,t.log("tealium::init:","loading tracking data",this.trackingData)},explicitTrackView:function(e){e=void 0===e?{}:e;utag.view(e,function(){var t=new CustomEvent("tracking:view",{detail:e});window.dispatchEvent(t)}.bind(this))},explicitTrackLink:function(e){e=void 0===e?{}:e;t.log(e),utag.link(e)},setViewGuid:function(e){this.viewGuid=e,CBSNEWS.tracking.pageViewGuid=this.viewGuid,t.log("tealium::setViewGuid",this.viewGuid)},resetViewGuid:function(){if(this.resetGuidEnabled){this.viewGuid=uuid.v4(),CBSNEWS.tracking.pageViewGuid=this.viewGuid;var e=document.createEvent("Event");e.initEvent("cbsnews.tealium.resetViewGuid",!0,!0),window.dispatchEvent(e)}return t.log("tealium::resetViewGuid",this.viewGuid),this.viewGuid},getViewGuid:function(){return this.viewGuid},syncResetViewGuid:function(){var e;return e=this.resetViewGuid(),this.resetGuidEnabled=!this.resetGuidEnabled,e},getTrackingData:function(){return this.trackingData}}}),
/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */
define("domReady",[],function(){"use strict";var e,t,i,n="undefined"!=typeof window&&window.document,s=!n,r=n?document:null,a=[];function o(){var e=a;s&&e.length&&(a=[],function(e){var t;for(t=0;t<e.length;t+=1)e[t](r)}(e))}function l(){s||(s=!0,i&&clearInterval(i),o())}if(n){if(document.addEventListener)document.addEventListener("DOMContentLoaded",l,!1),window.addEventListener("load",l,!1);else if(window.attachEvent){window.attachEvent("onload",l),t=document.createElement("div");try{e=null===window.frameElement}catch(e){}t.doScroll&&e&&window.external&&(i=setInterval(function(){try{t.doScroll(),l()}catch(e){}},30))}"complete"===document.readyState&&l()}function d(e){return s?e(r):a.push(e),d}return d.version="2.0.1",d.load=function(e,t,i,n){n.isBuild?i(null):d(i)},d}),define("utils/load-script",[],function(){"use strict";return function(e,t,i){var n=document.createElement("script");n.setAttribute("async",!0),n.setAttribute("src",e),t&&n.setAttribute("id",t),document.head.appendChild(n),n.onerror=function(e){i&&i()}}}),define("managers/taboola-rem",["domReady","utils/load-script","polyfill!object.assign"],function(e,t){"use strict";var i={front_door:"home",collection_door:"category",topic_door:"category",topic_list:"category",show_door:"category",video_door:"category",live_blog:"article",news_item:"article",media_post:"article",moneywatch:"article",updating_story:"article",image_gallery:"photo",live_streaming_player:"video",video:"video",error_page:"-2",search:"-2"}[CBSNEWS.tracking.pageType]||"other",n=window._taboola=window._taboola||[],s=!1,r={init:function(e){var t={};t[i]="auto",t.referrer=document.referrer,t.url=window.location.href,e=Object.assign({},t,e),n.push(e),CBSNEWS.features.executeWithConsent(["taboola"],"targeting",r.load,r)},load:function(){if(!s){var e,i,n=CBSNEWS.chromeless;"ios"===CBSNEWS.tracking.deviceOs?n?(e="//cdn.taboola.com/libtrc/cbsinteractive-cbsnewsmobileappios/mobile-loader.js",_taboola.mobile=window._taboola.mobile||[],_taboola.mobile.push({publisher:"cbsinteractive-cbsnewsmobileappios"}),i="tb-mobile-loader-script"):(e="//cdn.taboola.com/libtrc/cbsinteractive-cbsnewsmobileappios/loader.js",i="tb_loader_script"):"android"===CBSNEWS.tracking.deviceOs?n?(e="//cdn.taboola.com/libtrc/cbsinteractive-cbsnewsmobileappandroid/mobile-loader.js",_taboola.mobile=window._taboola.mobile||[],_taboola.mobile.push({publisher:"cbsinteractive-cbsnewsmobileappandroid"}),i="tb-mobile-loader-script"):(e="//cdn.taboola.com/libtrc/cbsinteractive-cbsnewsmobileappandroid/loader.js",i="tb_loader_script"):(e="//cdn.taboola.com/libtrc/cbsinteractive-cbsnews/loader.js",i="tb_loader_script");var r=function(){t(e,i),window.removeEventListener("scroll",r,!1)};window.addEventListener("scroll",r,!1),("desktop"==CBSNEWS.device&&"image_gallery"==CBSNEWS.tracking.pageType||"android"===CBSNEWS.tracking.deviceOs)&&r(),s=!0}},display:function(){var e=document.querySelectorAll("[data-taboola]");if(e.length){r.init();for(var t=0;t<e.length;t++)r.push(e[t]);r.flush()}},refresh:function(){n.push({notify:"newPageLoad"}),r.display()},push:function(e,t){r.init();var i=JSON.parse(e.getAttribute("data-taboola"));i=Object.assign({container:e,target_type:"mix"},i),n.push(i),t&&r.flush()},flush:function(){n.push({flush:!0})},taboola:null};window.CBSNEWS=window.CBSNEWS||{},window.CBSNEWS.taboola=r,e(r.display),window.addEventListener("ads:reloadTaboola",function(){CBSNEWS.taboola.refresh()})}),function(e){"use strict";CBSNEWS.originalUrl={search:window.location.search,hash:window.location.hash};var t=/[^a-z0-9-_]/gi;t.test(e.location.hash)&&(e.location.hash=e.location.hash.replace(t,""))}(window),require(["fly/libs/uuid.v4"],function(){CBSNEWS.tracking.pageViewGuid=uuid.v4()}),CBSNEWS.referrerHostname=function(){var e=document.createElement("a");return e.href=document.referrer,"wpcomwidgets.com"==e.hostname?getParameterByName("wpcom_origin",e.href).replace(/(^\w+:|^)\/\//,""):e.hostname}(),require(["utils/clean-url"],function(e){var t=CBSNEWS.features.getFeatureValue("cleanQueryString-"+CBSNEWS.device+"-"+CBSNEWS.tracking.pageType)||CBSNEWS.features.getFeatureValue("cleanQueryString-"+CBSNEWS.device)||CBSNEWS.features.getFeatureValue("cleanQueryString");t&&e.include(t)}),"updating_story"==CBSNEWS.tracking.pageType&&-1!==window.location.hash.indexOf("post")&&0!=window.pageYOffset&&document.body.classList.add("is-collapsed"),require(["common/iframe-resizer"]),require(["common/tracking"]),require(["common/site-ads"]),require(["managers/tealium"],function(e){window.$tealium=e,1==CBSNEWS.tracking.isEnabled&&(e.setViewGuid(CBSNEWS.tracking.pageViewGuid),e.init(CBSNEWS.tracking))}),require(["managers/taboola-rem"]),define("common",function(){}),function(){var e;(function(){function e(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function t(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););return e}function i(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(!t(e[i],i,e))return!1;return!0}function n(e,t){for(var i=-1,n=null==e?0:e.length,s=0,r=[];++i<n;){var a=e[i];t(a,i,e)&&(r[s++]=a)}return r}function s(e,t){return!(null==e||!e.length)&&u(e,t,0)>-1}function r(e,t,i){for(var n=-1,s=null==e?0:e.length;++n<s;)if(i(t,e[n]))return!0;return!1}function a(e,t){for(var i=-1,n=null==e?0:e.length,s=Array(n);++i<n;)s[i]=t(e[i],i,e);return s}function o(e,t){for(var i=-1,n=t.length,s=e.length;++i<n;)e[s+i]=t[i];return e}function l(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}function d(e,t,i,n){for(var s=e.length,r=i+(n?1:-1);n?r--:++r<s;)if(t(e[r],r,e))return r;return-1}function u(e,t,i){return t==t?function(e,t,i){for(var n=i-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}(e,t,i):d(e,h,i)}function c(e,t,i,n){for(var s=i-1,r=e.length;++s<r;)if(n(e[s],t))return s;return-1}function h(e){return e!=e}function p(e){return function(t){return null==t?Rt:t[e]}}function f(e){return function(t){return e(t)}}function v(e,t){return a(t,function(t){return e[t]})}function g(e,t){return e.has(t)}function _(e){return"\\"+Dn[e]}function m(e){return An.test(e)}function E(e){var t=-1,i=Array(e.size);return e.forEach(function(e,n){i[++t]=[n,e]}),i}function y(e,t){return function(i){return e(t(i))}}function A(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}function S(e){return m(e)?function(e){for(var t=yn.lastIndex=0;yn.test(e);)++t;return t}(e):xn(e)}function b(e){return m(e)?function(e){return e.match(yn)||[]}(e):function(e){return e.split("")}(e)}function T(e){if(st(e)&&!$s(e)&&!(e instanceof I)){if(e instanceof C)return e;if(zn.call(e,"__wrapped__"))return xe(e)}return new C(e)}function D(){}function C(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=Rt}function I(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ii,this.__views__=[]}function R(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function P(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function M(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function O(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new M;++t<i;)this.add(e[t])}function L(e){var t=this.__data__=new P(e);this.size=t.size}function w(e,t){var i=$s(e),n=!i&&Zs(e),s=!i&&!n&&er(e),r=!i&&!n&&!s&&sr(e),a=i||n||s||r,o=a?function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],l=o.length;for(var d in e)!t&&!zn.call(e,d)||a&&("length"==d||s&&("offset"==d||"parent"==d)||r&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||Re(d,l))||o.push(d);return o}function N(e,t,i){var n=e[t];zn.call(e,t)&&Qe(n,i)&&(i!==Rt||t in e)||B(e,t,i)}function k(e,t){for(var i=e.length;i--;)if(Qe(e[i][0],t))return i;return-1}function B(e,t,i){"__proto__"==t&&ds?ds(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function U(e,t,i){return e==e&&(i!==Rt&&(e=e<=i?e:i),t!==Rt&&(e=e>=t?e:t)),e}function j(e,i,n,s,r,a){var o,l=i&Nt,d=i&kt,u=i&Bt;if(n&&(o=r?n(e,s,r,a):n(e)),o!==Rt)return o;if(!nt(e))return e;var c=$s(e);if(c){if(o=function(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&zn.call(e,"index")&&(i.index=e.index,i.input=e.input),i}(e),!l)return ve(e,o)}else{var h=Hs(e),p=h==ci||h==hi;if(er(e))return function(e,t){if(t)return e.slice();var i=e.length,n=ts?ts(i):new e.constructor(i);return e.copy(n),n}(e,l);if(h==gi||h==si||p&&!r){if(o=d||p?{}:function(e){return"function"!=typeof e.constructor||Oe(e)?{}:ks(is(e))}(e),!l)return d?function(e,t){return ge(e,Vs(e),t)}(e,function(e,t){return e&&ge(t,_t(t),e)}(o,e)):function(e,t){return ge(e,Gs(e),t)}(e,function(e,t){return e&&ge(t,gt(t),e)}(o,e))}else{if(!Tn[h])return r?e:{};o=function(e,t,i){var n=e.constructor;switch(t){case Di:return pe(e);case oi:case li:return new n(+e);case Ci:return function(e,t){var i=t?pe(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case Ii:case Ri:case Pi:case Mi:case Oi:case Li:case wi:case Ni:case ki:return function(e,t){var i=t?pe(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}(e,i);case pi:return new n;case fi:case Ai:return new n(e);case Ei:return function(e){var t=new e.constructor(e.source,Qi.exec(e));return t.lastIndex=e.lastIndex,t}(e);case yi:return new n;case Si:return function(e){return ws?Object(ws.call(e)):{}}(e)}}(e,h,l)}}a||(a=new L);var f=a.get(e);if(f)return f;if(a.set(e,o),nr(e))return e.forEach(function(t){o.add(j(t,i,n,t,e,a))}),o;if(ir(e))return e.forEach(function(t,s){o.set(s,j(t,i,n,s,e,a))}),o;var v=c?Rt:(u?d?Se:Ae:d?_t:gt)(e);return t(v||e,function(t,s){v&&(t=e[s=t]),N(o,s,j(t,i,n,s,e,a))}),o}function x(e,t){var i=!0;return Bs(e,function(e,n,s){return i=!!t(e,n,s)}),i}function F(e,t,i,n,s){var r=-1,a=e.length;for(i||(i=Ie),s||(s=[]);++r<a;){var l=e[r];t>0&&i(l)?t>1?F(l,t-1,i,n,s):o(s,l):n||(s[s.length]=l)}return s}function G(e,t){return e&&Us(e,t,gt)}function V(e,t){return n(t,function(t){return tt(e[t])})}function H(e,t){for(var i=0,n=(t=ce(t,e)).length;null!=e&&i<n;)e=e[Be(t[i++])];return i&&i==n?e:Rt}function W(e,t,i){var n=t(e);return $s(e)?n:o(n,i(e))}function K(e){return null==e?e===Rt?bi:vi:ls&&ls in Object(e)?function(e){var t=zn.call(e,ls),i=e[ls];try{e[ls]=Rt;var n=!0}catch(e){}var s=qn.call(e);return n&&(t?e[ls]=i:delete e[ls]),s}(e):function(e){return qn.call(e)}(e)}function z(e,t){return null!=e&&zn.call(e,t)}function Y(e,t){return null!=e&&t in Object(e)}function q(t,i,n){var s=null==(t=function(e,t){return t.length<2?e:H(e,oe(t,0,-1))}(t,i=ce(i,t)))?t:t[Be(Ve(i))];return null==s?Rt:e(s,t,n)}function X(e){return st(e)&&K(e)==si}function J(e,t,i,n,s){return e===t||(null==e||null==t||!st(e)&&!st(t)?e!=e&&t!=t:function(e,t,i,n,s,r){var a=$s(e),o=$s(t),l=a?ri:Hs(e),d=o?ri:Hs(t),u=(l=l==si?gi:l)==gi,c=(d=d==si?gi:d)==gi,h=l==d;if(h&&er(e)){if(!er(t))return!1;a=!0,u=!1}if(h&&!u)return r||(r=new L),a||sr(e)?ye(e,t,i,n,s,r):function(e,t,i,n,s,r,a){switch(i){case Ci:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Di:return!(e.byteLength!=t.byteLength||!r(new es(e),new es(t)));case oi:case li:case fi:return Qe(+e,+t);case ui:return e.name==t.name&&e.message==t.message;case Ei:case Ai:return e==t+"";case pi:var o=E;case yi:var l=n&Ut;if(o||(o=A),e.size!=t.size&&!l)return!1;var d=a.get(e);if(d)return d==t;n|=jt,a.set(e,t);var u=ye(o(e),o(t),n,s,r,a);return a.delete(e),u;case Si:if(ws)return ws.call(e)==ws.call(t)}return!1}(e,t,l,i,n,s,r);if(!(i&Ut)){var p=u&&zn.call(e,"__wrapped__"),f=c&&zn.call(t,"__wrapped__");if(p||f){var v=p?e.value():e,g=f?t.value():t;return r||(r=new L),s(v,g,i,n,r)}}return!!h&&(r||(r=new L),function(e,t,i,n,s,r){var a=i&Ut,o=Ae(e),l=o.length;if(l!=Ae(t).length&&!a)return!1;for(var d=l;d--;){var u=o[d];if(!(a?u in t:zn.call(t,u)))return!1}var c=r.get(e);if(c&&r.get(t))return c==t;var h=!0;r.set(e,t),r.set(t,e);for(var p=a;++d<l;){u=o[d];var f=e[u],v=t[u];if(n)var g=a?n(v,f,u,t,e,r):n(f,v,u,e,t,r);if(!(g===Rt?f===v||s(f,v,i,n,r):g)){h=!1;break}p||(p="constructor"==u)}if(h&&!p){var _=e.constructor,m=t.constructor;_!=m&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof m&&m instanceof m)&&(h=!1)}return r.delete(e),r.delete(t),h}(e,t,i,n,s,r))}(e,t,i,n,J,s))}function Q(e){return!(!nt(e)||function(e){return!!Yn&&Yn in e}(e))&&(tt(e)?Qn:en).test(Ue(e))}function Z(e){return"function"==typeof e?e:null==e?At:"object"==typeof e?$s(e)?function(e,t){return Me(e)&&Le(t)?we(Be(e),t):function(i){var n=ft(i,e);return n===Rt&&n===t?vt(i,e):J(t,n,Ut|jt)}}(e[0],e[1]):function(e){var t=function(e){for(var t=gt(e),i=t.length;i--;){var n=t[i],s=e[n];t[i]=[n,s,Le(s)]}return t}(e);return 1==t.length&&t[0][2]?we(t[0][0],t[0][1]):function(i){return i===e||function(e,t,i,n){var s=i.length,r=s,a=!n;if(null==e)return!r;for(e=Object(e);s--;){var o=i[s];if(a&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++s<r;){var l=(o=i[s])[0],d=e[l],u=o[1];if(a&&o[2]){if(d===Rt&&!(l in e))return!1}else{var c=new L;if(n)var h=n(d,u,l,e,t,c);if(!(h===Rt?J(u,d,Ut|jt,n,c):h))return!1}}return!0}(i,e,t)}}(e):Dt(e)}function $(e){if(!Oe(e))return fs(e);var t=[];for(var i in Object(e))zn.call(e,i)&&"constructor"!=i&&t.push(i);return t}function ee(e){if(!nt(e))return function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=Oe(e),i=[];for(var n in e)("constructor"!=n||!t&&zn.call(e,n))&&i.push(n);return i}function te(e,t){return e<t}function ie(e,t){var i=-1,n=Ze(e)?Array(e.length):[];return Bs(e,function(e,s,r){n[++i]=t(e,s,r)}),n}function ne(e,t,i){var n=-1;return t=a(t.length?t:[At],f(be())),function(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}(ie(e,function(e,i,s){return{criteria:a(t,function(t){return t(e)}),index:++n,value:e}}),function(e,t){return function(e,t,i){for(var n=-1,s=e.criteria,r=t.criteria,a=s.length,o=i.length;++n<a;){var l=fe(s[n],r[n]);if(l)return n>=o?l:l*("desc"==i[n]?-1:1)}return e.index-t.index}(e,t,i)})}function se(e,t){var i="";if(!e||t<1||t>$t)return i;do{t%2&&(i+=e),(t=cs(t/2))&&(e+=e)}while(t);return i}function re(e,t){return Ks(Ne(e,t,At),e+"")}function ae(e,t,i,n){if(!nt(e))return e;for(var s=-1,r=(t=ce(t,e)).length,a=r-1,o=e;null!=o&&++s<r;){var l=Be(t[s]),d=i;if(s!=a){var u=o[l];(d=n?n(u,l,o):Rt)===Rt&&(d=nt(u)?u:Re(t[s+1])?[]:{})}N(o,l,d),o=o[l]}return e}function oe(e,t,i){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(i=i>s?s:i)<0&&(i+=s),s=t>i?0:i-t>>>0,t>>>=0;for(var r=Array(s);++n<s;)r[n]=e[n+t];return r}function le(e,t){var i;return Bs(e,function(e,n,s){return!(i=t(e,n,s))}),!!i}function de(e){if("string"==typeof e)return e;if($s(e))return a(e,de)+"";if(lt(e))return Ns?Ns.call(e):"";var t=e+"";return"0"==t&&1/e==-Zt?"-0":t}function ue(e,t){var i=e;return i instanceof I&&(i=i.value()),function(e,t,i,n){var s=-1,r=null==e?0:e.length;for(n&&r&&(i=e[++s]);++s<r;)i=t(i,e[s],s,e);return i}(t,function(e,t){return t.func.apply(t.thisArg,o([e],t.args))},i)}function ce(e,t){return $s(e)?e:Me(e,t)?[e]:zs(pt(e))}function he(e,t,i){var n=e.length;return i=i===Rt?n:i,!t&&i>=n?e:oe(e,t,i)}function pe(e){var t=new e.constructor(e.byteLength);return new es(t).set(new es(e)),t}function fe(e,t){if(e!==t){var i=e!==Rt,n=null===e,s=e==e,r=lt(e),a=t!==Rt,o=null===t,l=t==t,d=lt(t);if(!o&&!d&&!r&&e>t||r&&a&&l&&!o&&!d||n&&a&&l||!i&&l||!s)return 1;if(!n&&!r&&!d&&e<t||d&&i&&s&&!n&&!r||o&&i&&s||!a&&s||!l)return-1}return 0}function ve(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}function ge(e,t,i,n){var s=!i;i||(i={});for(var r=-1,a=t.length;++r<a;){var o=t[r],l=n?n(i[o],e[o],o,i,e):Rt;l===Rt&&(l=e[o]),s?B(i,o,l):N(i,o,l)}return i}function _e(e){return re(function(t,i){var n=-1,s=i.length,r=s>1?i[s-1]:Rt,a=s>2?i[2]:Rt;for(r=e.length>3&&"function"==typeof r?(s--,r):Rt,a&&Pe(i[0],i[1],a)&&(r=s<3?Rt:r,s=1),t=Object(t);++n<s;){var o=i[n];o&&e(t,o,n,r)}return t})}function me(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=ks(e.prototype),n=e.apply(i,t);return nt(n)?n:i}}function Ee(e,t,i,n){return e===Rt||Qe(e,Hn[i])&&!zn.call(n,i)?t:e}function ye(e,t,i,n,s,r){var a=i&Ut,o=e.length,d=t.length;if(o!=d&&!(a&&d>o))return!1;var u=r.get(e);if(u&&r.get(t))return u==t;var c=-1,h=!0,p=i&jt?new O:Rt;for(r.set(e,t),r.set(t,e);++c<o;){var f=e[c],v=t[c];if(n)var _=a?n(v,f,c,t,e,r):n(f,v,c,e,t,r);if(_!==Rt){if(_)continue;h=!1;break}if(p){if(!l(t,function(e,t){if(!g(p,t)&&(f===e||s(f,e,i,n,r)))return p.push(t)})){h=!1;break}}else if(f!==v&&!s(f,v,i,n,r)){h=!1;break}}return r.delete(e),r.delete(t),h}function Ae(e){return W(e,gt,Gs)}function Se(e){return W(e,_t,Vs)}function be(){var e=T.iteratee||St;return e=e===St?Z:e,arguments.length?e(arguments[0],arguments[1]):e}function Te(e,t){var i=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?i["string"==typeof t?"string":"hash"]:i.map}function De(e,t){var i=function(e,t){return null==e?Rt:e[t]}(e,t);return Q(i)?i:Rt}function Ce(e,t,i){for(var n=-1,s=(t=ce(t,e)).length,r=!1;++n<s;){var a=Be(t[n]);if(!(r=null!=e&&i(e,a)))break;e=e[a]}return r||++n!=s?r:!!(s=null==e?0:e.length)&&it(s)&&Re(a,s)&&($s(e)||Zs(e))}function Ie(e){return $s(e)||Zs(e)||!!(as&&e&&e[as])}function Re(e,t){var i=typeof e;return!!(t=null==t?$t:t)&&("number"==i||"symbol"!=i&&nn.test(e))&&e>-1&&e%1==0&&e<t}function Pe(e,t,i){if(!nt(i))return!1;var n=typeof t;return!!("number"==n?Ze(i)&&Re(t,i.length):"string"==n&&t in i)&&Qe(i[t],e)}function Me(e,t){if($s(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!lt(e))||Hi.test(e)||!Vi.test(e)||null!=t&&e in Object(t)}function Oe(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Hn)}function Le(e){return e==e&&!nt(e)}function we(e,t){return function(i){return null!=i&&i[e]===t&&(t!==Rt||e in Object(i))}}function Ne(t,i,n){return i=vs(i===Rt?t.length-1:i,0),function(){for(var s=arguments,r=-1,a=vs(s.length-i,0),o=Array(a);++r<a;)o[r]=s[i+r];r=-1;for(var l=Array(i+1);++r<i;)l[r]=s[r];return l[i]=n(o),e(t,this,l)}}function ke(e){var t=0,i=0;return function(){var n=_s(),s=Xt-(n-i);if(i=n,s>0){if(++t>=qt)return arguments[0]}else t=0;return e.apply(Rt,arguments)}}function Be(e){if("string"==typeof e||lt(e))return e;var t=e+"";return"0"==t&&1/e==-Zt?"-0":t}function Ue(e){if(null!=e){try{return Kn.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function je(e,i){return t(ni,function(t){var n="_."+t[0];i&t[1]&&!s(e,n)&&e.push(n)}),e.sort()}function xe(e){if(e instanceof I)return e.clone();var t=new C(e.__wrapped__,e.__chain__);return t.__actions__=ve(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Fe(e,t,i){var n=null==e?0:e.length;if(!n)return-1;var s=null==i?0:ct(i);return s<0&&(s=vs(n+s,0)),d(e,be(t,3),s)}function Ge(e){return null!=e&&e.length?F(e,1):[]}function Ve(e){var t=null==e?0:e.length;return t?e[t-1]:Rt}function He(e,t){return e&&e.length&&t&&t.length?function(e,t,i,n){var s=n?c:u,r=-1,o=t.length,l=e;for(e===t&&(t=ve(t)),i&&(l=a(e,f(i)));++r<o;)for(var d=0,h=t[r],p=i?i(h):h;(d=s(l,p,d,n))>-1;)l!==e&&rs.call(l,d,1),rs.call(e,d,1);return e}(e,t):e}function We(e){return null==e?e:ms.call(e)}function Ke(e){var t=T(e);return t.__chain__=!0,t}function ze(e,t){return t(e)}function Ye(e,i){return($s(e)?t:Bs)(e,be(i,3))}function qe(e,t,i){function n(t){var i=l,n=d;return l=d=Rt,f=t,c=e.apply(n,i)}function s(e){var i=e-p;return p===Rt||i>=t||i<0||g&&e-f>=u}function r(){var e=Qs();if(s(e))return a(e);h=setTimeout(r,function(e){var i=t-(e-p);return g?gs(i,u-(e-f)):i}(e))}function a(e){return h=Rt,_&&l?n(e):(l=d=Rt,c)}function o(){var e=Qs(),i=s(e);if(l=arguments,d=this,p=e,i){if(h===Rt)return function(e){return f=e,h=setTimeout(r,t),v?n(e):c}(p);if(g)return h=setTimeout(r,t),n(p)}return h===Rt&&(h=setTimeout(r,t)),c}var l,d,u,c,h,p,f=0,v=!1,g=!1,_=!0;if("function"!=typeof e)throw new TypeError(Mt);return t=ht(t)||0,nt(i)&&(v=!!i.leading,u=(g="maxWait"in i)?vs(ht(i.maxWait)||0,t):u,_="trailing"in i?!!i.trailing:_),o.cancel=function(){h!==Rt&&clearTimeout(h),f=0,l=p=d=h=Rt},o.flush=function(){return h===Rt?c:a(Qs())},o}function Xe(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(Mt);var i=function(){var n=arguments,s=t?t.apply(this,n):n[0],r=i.cache;if(r.has(s))return r.get(s);var a=e.apply(this,n);return i.cache=r.set(s,a)||r,a};return i.cache=new(Xe.Cache||M),i}function Je(e){if("function"!=typeof e)throw new TypeError(Mt);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Qe(e,t){return e===t||e!=e&&t!=t}function Ze(e){return null!=e&&it(e.length)&&!tt(e)}function $e(e){return st(e)&&Ze(e)}function et(e){if(!st(e))return!1;var t=K(e);return t==ui||t==di||"string"==typeof e.message&&"string"==typeof e.name&&!at(e)}function tt(e){if(!nt(e))return!1;var t=K(e);return t==ci||t==hi||t==ai||t==mi}function it(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=$t}function nt(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function st(e){return null!=e&&"object"==typeof e}function rt(e){return"number"==typeof e||st(e)&&K(e)==fi}function at(e){if(!st(e)||K(e)!=gi)return!1;var t=is(e);if(null===t)return!0;var i=zn.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Kn.call(i)==Xn}function ot(e){return"string"==typeof e||!$s(e)&&st(e)&&K(e)==Ai}function lt(e){return"symbol"==typeof e||st(e)&&K(e)==Si}function dt(e){if(!e)return[];if(Ze(e))return ot(e)?b(e):ve(e);if(os&&e[os])return function(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i}(e[os]());var t=Hs(e);return(t==pi?E:t==yi?A:Et)(e)}function ut(e){return e?(e=ht(e))===Zt||e===-Zt?(e<0?-1:1)*ei:e==e?e:0:0===e?e:0}function ct(e){var t=ut(e),i=t%1;return t==t?i?t-i:t:0}function ht(e){if("number"==typeof e)return e;if(lt(e))return ti;if(nt(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=nt(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Ki,"");var i=$i.test(e);return i||tn.test(e)?Cn(e.slice(2),i?2:8):Zi.test(e)?ti:+e}function pt(e){return null==e?"":de(e)}function ft(e,t,i){var n=null==e?Rt:H(e,t);return n===Rt?i:n}function vt(e,t){return null!=e&&Ce(e,t,Y)}function gt(e){return Ze(e)?w(e):$(e)}function _t(e){return Ze(e)?w(e,!0):ee(e)}function mt(e,t){if(null==e)return{};var i=a(Se(e),function(e){return[e]});return t=be(t),function(e,t,i){for(var n=-1,s=t.length,r={};++n<s;){var a=t[n],o=H(e,a);i(o,a)&&ae(r,ce(a,e),o)}return r}(e,i,function(e,i){return t(e,i[0])})}function Et(e){return null==e?[]:v(e,gt(e))}function yt(e){return function(){return e}}function At(e){return e}function St(e){return Z("function"==typeof e?e:j(e,Nt))}function bt(e,i,n){var s=gt(i),r=V(i,s);null!=n||nt(i)&&(r.length||!s.length)||(n=i,i=e,e=this,r=V(i,gt(i)));var a=!(nt(n)&&"chain"in n&&!n.chain),l=tt(e);return t(r,function(t){var n=i[t];e[t]=n,l&&(e.prototype[t]=function(){var t=this.__chain__;if(a||t){var i=e(this.__wrapped__);return(i.__actions__=ve(this.__actions__)).push({func:n,args:arguments,thisArg:e}),i.__chain__=t,i}return n.apply(e,o([this.value()],arguments))})}),e}function Tt(){}function Dt(e){return Me(e)?p(Be(e)):function(e){return function(t){return H(t,e)}}(e)}function Ct(){return[]}function It(){return!1}var Rt,Pt=200,Mt="Expected a function",Ot="__lodash_hash_undefined__",Lt=500,wt="__lodash_placeholder__",Nt=1,kt=2,Bt=4,Ut=1,jt=2,xt=1,Ft=2,Gt=4,Vt=8,Ht=16,Wt=32,Kt=64,zt=128,Yt=512,qt=800,Xt=16,Jt=1,Qt=2,Zt=1/0,$t=9007199254740991,ei=1.7976931348623157e308,ti=NaN,ii=4294967295,ni=[["ary",zt],["bind",xt],["bindKey",Ft],["curry",Vt],["curryRight",Ht],["flip",Yt],["partial",Wt],["partialRight",Kt],["rearg",256]],si="[object Arguments]",ri="[object Array]",ai="[object AsyncFunction]",oi="[object Boolean]",li="[object Date]",di="[object DOMException]",ui="[object Error]",ci="[object Function]",hi="[object GeneratorFunction]",pi="[object Map]",fi="[object Number]",vi="[object Null]",gi="[object Object]",_i="[object Promise]",mi="[object Proxy]",Ei="[object RegExp]",yi="[object Set]",Ai="[object String]",Si="[object Symbol]",bi="[object Undefined]",Ti="[object WeakMap]",Di="[object ArrayBuffer]",Ci="[object DataView]",Ii="[object Float32Array]",Ri="[object Float64Array]",Pi="[object Int8Array]",Mi="[object Int16Array]",Oi="[object Int32Array]",Li="[object Uint8Array]",wi="[object Uint8ClampedArray]",Ni="[object Uint16Array]",ki="[object Uint32Array]",Bi=/\b__p \+= '';/g,Ui=/\b(__p \+=) '' \+/g,ji=/(__e\(.*?\)|\b__t\)) \+\n'';/g,xi=/[&<>"']/g,Fi=RegExp(xi.source),Gi=/<%=([\s\S]+?)%>/g,Vi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hi=/^\w*$/,Wi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ki=/^\s+|\s+$/g,zi=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Yi=/\{\n\/\* \[wrapped with (.+)\] \*/,qi=/,? & /,Xi=/\\(\\)?/g,Ji=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Qi=/\w*$/,Zi=/^[-+]0x[0-9a-f]+$/i,$i=/^0b[01]+$/i,en=/^\[object .+?Constructor\]$/,tn=/^0o[0-7]+$/i,nn=/^(?:0|[1-9]\d*)$/,sn=/($^)/,rn=/['\n\r\u2028\u2029\\]/g,an="\\ud800-\\udfff",on="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ln="\\ufe0e\\ufe0f",dn="["+an+"]",un="["+on+"]",cn="\\ud83c[\\udffb-\\udfff]",hn="[^"+an+"]",pn="(?:\\ud83c[\\udde6-\\uddff]){2}",fn="[\\ud800-\\udbff][\\udc00-\\udfff]",vn="\\u200d",gn="(?:"+un+"|"+cn+")?",_n="["+ln+"]?",mn=_n+gn+"(?:"+vn+"(?:"+[hn,pn,fn].join("|")+")"+_n+gn+")*",En="(?:"+[hn+un+"?",un,pn,fn,dn].join("|")+")",yn=RegExp(cn+"(?="+cn+")|"+En+mn,"g"),An=RegExp("["+vn+an+on+ln+"]"),Sn=-1,bn={};bn[Ii]=bn[Ri]=bn[Pi]=bn[Mi]=bn[Oi]=bn[Li]=bn[wi]=bn[Ni]=bn[ki]=!0,bn[si]=bn[ri]=bn[Di]=bn[oi]=bn[Ci]=bn[li]=bn[ui]=bn[ci]=bn[pi]=bn[fi]=bn[gi]=bn[Ei]=bn[yi]=bn[Ai]=bn[Ti]=!1;var Tn={};Tn[si]=Tn[ri]=Tn[Di]=Tn[Ci]=Tn[oi]=Tn[li]=Tn[Ii]=Tn[Ri]=Tn[Pi]=Tn[Mi]=Tn[Oi]=Tn[pi]=Tn[fi]=Tn[gi]=Tn[Ei]=Tn[yi]=Tn[Ai]=Tn[Si]=Tn[Li]=Tn[wi]=Tn[Ni]=Tn[ki]=!0,Tn[ui]=Tn[ci]=Tn[Ti]=!1;var Dn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Cn=parseInt,In="object"==typeof global&&global&&global.Object===Object&&global,Rn="object"==typeof self&&self&&self.Object===Object&&self,Pn=In||Rn||Function("return this")(),Mn="object"==typeof exports&&exports&&!exports.nodeType&&exports,On=Mn&&"object"==typeof module&&module&&!module.nodeType&&module,Ln=On&&On.exports===Mn,wn=Ln&&In.process,Nn=function(){try{return wn&&wn.binding&&wn.binding("util")}catch(e){}}(),kn=Nn&&Nn.isDate,Bn=Nn&&Nn.isMap,Un=Nn&&Nn.isSet,jn=Nn&&Nn.isTypedArray,xn=p("length"),Fn=function(e){return function(t){return null==e?Rt:e[t]}}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Gn=Array.prototype,Vn=Function.prototype,Hn=Object.prototype,Wn=Pn["__core-js_shared__"],Kn=Vn.toString,zn=Hn.hasOwnProperty,Yn=function(){var e=/[^.]+$/.exec(Wn&&Wn.keys&&Wn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),qn=Hn.toString,Xn=Kn.call(Object),Jn=Pn._,Qn=RegExp("^"+Kn.call(zn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zn=Ln?Pn.Buffer:Rt,$n=Pn.Symbol,es=Pn.Uint8Array,ts=Zn?Zn.allocUnsafe:Rt,is=y(Object.getPrototypeOf,Object),ns=Object.create,ss=Hn.propertyIsEnumerable,rs=Gn.splice,as=$n?$n.isConcatSpreadable:Rt,os=$n?$n.iterator:Rt,ls=$n?$n.toStringTag:Rt,ds=function(){try{var e=De(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),us=Math.ceil,cs=Math.floor,hs=Object.getOwnPropertySymbols,ps=Zn?Zn.isBuffer:Rt,fs=y(Object.keys,Object),vs=Math.max,gs=Math.min,_s=Date.now,ms=Gn.reverse,Es=De(Pn,"DataView"),ys=De(Pn,"Map"),As=De(Pn,"Promise"),Ss=De(Pn,"Set"),bs=De(Pn,"WeakMap"),Ts=De(Object,"create"),Ds=bs&&new bs,Cs={},Is=Ue(Es),Rs=Ue(ys),Ps=Ue(As),Ms=Ue(Ss),Os=Ue(bs),Ls=$n?$n.prototype:Rt,ws=Ls?Ls.valueOf:Rt,Ns=Ls?Ls.toString:Rt,ks=function(){function e(){}return function(t){if(!nt(t))return{};if(ns)return ns(t);e.prototype=t;var i=new e;return e.prototype=Rt,i}}();T.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Gi,variable:"",imports:{_:T}},T.prototype=D.prototype,T.prototype.constructor=T,C.prototype=ks(D.prototype),C.prototype.constructor=C,I.prototype=ks(D.prototype),I.prototype.constructor=I,R.prototype.clear=function(){this.__data__=Ts?Ts(null):{},this.size=0},R.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},R.prototype.get=function(e){var t=this.__data__;if(Ts){var i=t[e];return i===Ot?Rt:i}return zn.call(t,e)?t[e]:Rt},R.prototype.has=function(e){var t=this.__data__;return Ts?t[e]!==Rt:zn.call(t,e)},R.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Ts&&t===Rt?Ot:t,this},P.prototype.clear=function(){this.__data__=[],this.size=0},P.prototype.delete=function(e){var t=this.__data__,i=k(t,e);return!(i<0||(i==t.length-1?t.pop():rs.call(t,i,1),--this.size,0))},P.prototype.get=function(e){var t=this.__data__,i=k(t,e);return i<0?Rt:t[i][1]},P.prototype.has=function(e){return k(this.__data__,e)>-1},P.prototype.set=function(e,t){var i=this.__data__,n=k(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this},M.prototype.clear=function(){this.size=0,this.__data__={hash:new R,map:new(ys||P),string:new R}},M.prototype.delete=function(e){var t=Te(this,e).delete(e);return this.size-=t?1:0,t},M.prototype.get=function(e){return Te(this,e).get(e)},M.prototype.has=function(e){return Te(this,e).has(e)},M.prototype.set=function(e,t){var i=Te(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this},O.prototype.add=O.prototype.push=function(e){return this.__data__.set(e,Ot),this},O.prototype.has=function(e){return this.__data__.has(e)},L.prototype.clear=function(){this.__data__=new P,this.size=0},L.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},L.prototype.get=function(e){return this.__data__.get(e)},L.prototype.has=function(e){return this.__data__.has(e)},L.prototype.set=function(e,t){var i=this.__data__;if(i instanceof P){var n=i.__data__;if(!ys||n.length<Pt-1)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new M(n)}return i.set(e,t),this.size=i.size,this};var Bs=function(e,t){return function(i,n){if(null==i)return i;if(!Ze(i))return e(i,n);for(var s=i.length,r=t?s:-1,a=Object(i);(t?r--:++r<s)&&!1!==n(a[r],r,a););return i}}(G),Us=function(e){return function(t,i,n){for(var s=-1,r=Object(t),a=n(t),o=a.length;o--;){var l=a[e?o:++s];if(!1===i(r[l],l,r))break}return t}}(),js=Ds?function(e,t){return Ds.set(e,t),e}:At,xs=ds?function(e,t){return ds(e,"toString",{configurable:!0,enumerable:!1,value:yt(t),writable:!0})}:At,Fs=Ds?function(e){return Ds.get(e)}:Tt,Gs=hs?function(e){return null==e?[]:(e=Object(e),n(hs(e),function(t){return ss.call(e,t)}))}:Ct,Vs=hs?function(e){for(var t=[];e;)o(t,Gs(e)),e=is(e);return t}:Ct,Hs=K;(Es&&Hs(new Es(new ArrayBuffer(1)))!=Ci||ys&&Hs(new ys)!=pi||As&&Hs(As.resolve())!=_i||Ss&&Hs(new Ss)!=yi||bs&&Hs(new bs)!=Ti)&&(Hs=function(e){var t=K(e),i=t==gi?e.constructor:Rt,n=i?Ue(i):"";if(n)switch(n){case Is:return Ci;case Rs:return pi;case Ps:return _i;case Ms:return yi;case Os:return Ti}return t});var Ws=ke(js),Ks=ke(xs),zs=function(e){var t=Xe(e,function(e){return i.size===Lt&&i.clear(),e}),i=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Wi,function(e,i,n,s){t.push(n?s.replace(Xi,"$1"):i||e)}),t}),Ys=re(He),qs=re(function(e,t){return $e(e)?function(e,t,i,n){var o=-1,l=s,d=!0,u=e.length,c=[],h=t.length;if(!u)return c;i&&(t=a(t,f(i))),n?(l=r,d=!1):t.length>=Pt&&(l=g,d=!1,t=new O(t));e:for(;++o<u;){var p=e[o],v=null==i?p:i(p);if(p=n||0!==p?p:0,d&&v==v){for(var _=h;_--;)if(t[_]===v)continue e;c.push(p)}else l(t,v,n)||c.push(p)}return c}(e,t):[]}),Xs=(function(e){Ks(Ne(e,Rt,Ge),e+"")}(function(e){var t=e.length,i=t?e[0]:0,n=this.__wrapped__,s=function(t){return function(e,t){for(var i=-1,n=t.length,s=Array(n),r=null==e;++i<n;)s[i]=r?Rt:ft(e,t[i]);return s}(t,e)};return!(t>1||this.__actions__.length)&&n instanceof I&&Re(i)?((n=n.slice(i,+i+(t?1:0))).__actions__.push({func:ze,args:[s],thisArg:Rt}),new C(n,this.__chain__).thru(function(e){return t&&!e.length&&e.push(Rt),e})):this.thru(s)}),function(e){return function(t,i,n){var s=Object(t);if(!Ze(t)){var r=be(i,3);t=gt(t),i=function(e){return r(s[e],e,s)}}var a=e(t,i,n);return a>-1?s[r?t[a]:a]:Rt}}(Fe)),Js=re(function(e,t){if(null==e)return[];var i=t.length;return i>1&&Pe(e,t[0],t[1])?t=[]:i>2&&Pe(t[0],t[1],t[2])&&(t=[t[0]]),ne(e,F(t,1),[])}),Qs=function(){return Pn.Date.now()};Xe.Cache=M;var Zs=X(function(){return arguments}())?X:function(e){return st(e)&&zn.call(e,"callee")&&!ss.call(e,"callee")},$s=Array.isArray,er=ps||It,tr=kn?f(kn):function(e){return st(e)&&K(e)==li},ir=Bn?f(Bn):function(e){return st(e)&&Hs(e)==pi},nr=Un?f(Un):function(e){return st(e)&&Hs(e)==yi},sr=jn?f(jn):function(e){return st(e)&&it(e.length)&&!!bn[K(e)]},rr=_e(function(e,t){if(Oe(t)||Ze(t))ge(t,gt(t),e);else for(var i in t)zn.call(t,i)&&N(e,i,t[i])}),ar=_e(function(e,t){ge(t,_t(t),e)}),or=_e(function(e,t,i,n){ge(t,_t(t),e,n)}),lr=function(e){return function(t){var i=m(t=pt(t))?b(t):Rt,n=i?i[0]:t.charAt(0),s=i?he(i,1).join(""):t.slice(1);return n[e]()+s}}("toUpperCase"),dr=re(function(t,i){try{return e(t,Rt,i)}catch(t){return et(t)?t:new Error(t)}}),ur=function(e){var t=Math[e];return function(e,i){if(e=ht(e),i=null==i?0:gs(ct(i),292)){var n=(pt(e)+"e").split("e");return+((n=(pt(t(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return t(e)}}("round");T.assign=rr,T.assignIn=ar,T.assignInWith=or,T.chain=Ke,T.compact=function(e){for(var t=-1,i=null==e?0:e.length,n=0,s=[];++t<i;){var r=e[t];r&&(s[n++]=r)}return s},T.constant=yt,T.debounce=qe,T.drop=function(e,t,i){var n=null==e?0:e.length;return n?oe(e,(t=i||t===Rt?1:ct(t))<0?0:t,n):[]},T.flatten=Ge,T.iteratee=St,T.keys=gt,T.keysIn=_t,T.map=function(e,t){return($s(e)?a:ie)(e,be(t,3))},T.memoize=Xe,T.mixin=bt,T.negate=Je,T.omitBy=function(e,t){return mt(e,Je(be(t)))},T.pickBy=mt,T.property=Dt,T.pull=Ys,T.pullAll=He,T.reverse=We,T.sortBy=Js,T.tap=function(e,t){return t(e),e},T.throttle=function(e,t,i){var n=!0,s=!0;if("function"!=typeof e)throw new TypeError(Mt);return nt(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),qe(e,t,{leading:n,maxWait:t,trailing:s})},T.thru=ze,T.toArray=dt,T.values=Et,T.without=qs,T.extend=ar,T.extendWith=or,bt(T,T),T.attempt=dr,T.capitalize=function(e){return lr(pt(e).toLowerCase())},T.clone=function(e){return j(e,Bt)},T.cloneDeep=function(e){return j(e,Nt|Bt)},T.endsWith=function(e,t,i){e=pt(e),t=de(t);var n=e.length,s=i=i===Rt?n:U(ct(i),0,n);return(i-=t.length)>=0&&e.slice(i,s)==t},T.eq=Qe,T.escape=function(e){return(e=pt(e))&&Fi.test(e)?e.replace(xi,Fn):e},T.every=function(e,t,n){var s=$s(e)?i:x;return n&&Pe(e,t,n)&&(t=Rt),s(e,be(t,3))},T.find=Xs,T.findIndex=Fe,T.forEach=Ye,T.forOwn=function(e,t){return e&&G(e,be(t,3))},T.get=ft,T.has=function(e,t){return null!=e&&Ce(e,t,z)},T.hasIn=vt,T.identity=At,T.includes=function(e,t,i,n){e=Ze(e)?e:Et(e),i=i&&!n?ct(i):0;var s=e.length;return i<0&&(i=vs(s+i,0)),ot(e)?i<=s&&e.indexOf(t,i)>-1:!!s&&u(e,t,i)>-1},T.indexOf=function(e,t,i){var n=null==e?0:e.length;if(!n)return-1;var s=null==i?0:ct(i);return s<0&&(s=vs(n+s,0)),u(e,t,s)},T.inRange=function(e,t,i){return t=ut(t),i===Rt?(i=t,t=0):i=ut(i),function(e,t,i){return e>=gs(t,i)&&e<vs(t,i)}(e=ht(e),t,i)},T.isArguments=Zs,T.isArray=$s,T.isArrayLike=Ze,T.isArrayLikeObject=$e,T.isBoolean=function(e){return!0===e||!1===e||st(e)&&K(e)==oi},T.isBuffer=er,T.isDate=tr,T.isEmpty=function(e){if(null==e)return!0;if(Ze(e)&&($s(e)||"string"==typeof e||"function"==typeof e.splice||er(e)||sr(e)||Zs(e)))return!e.length;var t=Hs(e);if(t==pi||t==yi)return!e.size;if(Oe(e))return!$(e).length;for(var i in e)if(zn.call(e,i))return!1;return!0},T.isError=et,T.isFunction=tt,T.isLength=it,T.isMap=ir,T.isNaN=function(e){return rt(e)&&e!=+e},T.isNull=function(e){return null===e},T.isNumber=rt,T.isObject=nt,T.isObjectLike=st,T.isPlainObject=at,T.isSet=nr,T.isString=ot,T.isSymbol=lt,T.isTypedArray=sr,T.isUndefined=function(e){return e===Rt},T.last=Ve,T.min=function(e){return e&&e.length?function(e,t,i){for(var n=-1,s=e.length;++n<s;){var r=e[n],a=t(r);if(null!=a&&(o===Rt?a==a&&!lt(a):i(a,o)))var o=a,l=r}return l}(e,At,te):Rt},T.stubArray=Ct,T.stubFalse=It,T.noConflict=function(){return Pn._===this&&(Pn._=Jn),this},T.noop=Tt,T.now=Qs,T.padStart=function(e,t,i){e=pt(e);var n=(t=ct(t))?S(e):0;return t&&n<t?function(e,t){var i=(t=t===Rt?" ":de(t)).length;if(i<2)return i?se(t,e):t;var n=se(t,us(e/S(t)));return m(t)?he(b(n),0,e).join(""):n.slice(0,e)}(t-n,i)+e:e},T.round=ur,T.some=function(e,t,i){var n=$s(e)?l:le;return i&&Pe(e,t,i)&&(t=Rt),n(e,be(t,3))},T.startsWith=function(e,t,i){return e=pt(e),i=null==i?0:U(ct(i),0,e.length),t=de(t),e.slice(i,i+t.length)==t},T.template=function(e,t,i){var n=T.templateSettings;i&&Pe(e,t,i)&&(t=Rt),e=pt(e),t=or({},t,n,Ee);var s,r,a=or({},t.imports,n.imports,Ee),o=gt(a),l=v(a,o),d=0,u=t.interpolate||sn,c="__p += '",h=RegExp((t.escape||sn).source+"|"+u.source+"|"+(u===Gi?Ji:sn).source+"|"+(t.evaluate||sn).source+"|$","g"),p="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++Sn+"]")+"\n";e.replace(h,function(t,i,n,a,o,l){return n||(n=a),c+=e.slice(d,l).replace(rn,_),i&&(s=!0,c+="' +\n__e("+i+") +\n'"),o&&(r=!0,c+="';\n"+o+";\n__p += '"),n&&(c+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),d=l+t.length,t}),c+="';\n";var f=t.variable;f||(c="with (obj) {\n"+c+"\n}\n"),c=(r?c.replace(Bi,""):c).replace(Ui,"$1").replace(ji,"$1;"),c="function("+(f||"obj")+") {\n"+(f?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(r?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+c+"return __p\n}";var g=dr(function(){return Function(o,p+"return "+c).apply(Rt,l)});if(g.source=c,et(g))throw g;return g},T.toFinite=ut,T.toInteger=ct,T.toNumber=ht,T.toString=pt,T.upperFirst=lr,T.each=Ye,bt(T,function(){var e={};return G(T,function(t,i){zn.call(T.prototype,i)||(e[i]=t)}),e}(),{chain:!1}),T.VERSION="4.17.5",t(["drop","take"],function(e,t){I.prototype[e]=function(i){i=i===Rt?1:vs(ct(i),0);var n=this.__filtered__&&!t?new I(this):this.clone();return n.__filtered__?n.__takeCount__=gs(i,n.__takeCount__):n.__views__.push({size:gs(i,ii),type:e+(n.__dir__<0?"Right":"")}),n},I.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),t(["filter","map","takeWhile"],function(e,t){var i=t+1,n=i==Jt||3==i;I.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:be(e,3),type:i}),t.__filtered__=t.__filtered__||n,t}}),t(["head","last"],function(e,t){var i="take"+(t?"Right":"");I.prototype[e]=function(){return this[i](1).value()[0]}}),t(["initial","tail"],function(e,t){var i="drop"+(t?"":"Right");I.prototype[e]=function(){return this.__filtered__?new I(this):this[i](1)}}),I.prototype.compact=function(){return this.filter(At)},I.prototype.find=function(e){return this.filter(e).head()},I.prototype.findLast=function(e){return this.reverse().find(e)},I.prototype.invokeMap=re(function(e,t){return"function"==typeof e?new I(this):this.map(function(i){return q(i,e,t)})}),I.prototype.reject=function(e){return this.filter(Je(be(e)))},I.prototype.slice=function(e,t){e=ct(e);var i=this;return i.__filtered__&&(e>0||t<0)?new I(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),t!==Rt&&(i=(t=ct(t))<0?i.dropRight(-t):i.take(t-e)),i)},I.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},I.prototype.toArray=function(){return this.take(ii)},G(I.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),s=T[n?"take"+("last"==t?"Right":""):t],r=n||/^find/.test(t);s&&(T.prototype[t]=function(){var t=this.__wrapped__,a=n?[1]:arguments,l=t instanceof I,d=a[0],u=l||$s(t),c=function(e){var t=s.apply(T,o([e],a));return n&&h?t[0]:t};u&&i&&"function"==typeof d&&1!=d.length&&(l=u=!1);var h=this.__chain__,p=!!this.__actions__.length,f=r&&!h,v=l&&!p;if(!r&&u){t=v?t:new I(this);var g=e.apply(t,a);return g.__actions__.push({func:ze,args:[c],thisArg:Rt}),new C(g,h)}return f&&v?e.apply(this,a):(g=this.thru(c),f?n?g.value()[0]:g.value():g)})}),t(["pop","push","shift","sort","splice","unshift"],function(e){var t=Gn[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);T.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var s=this.value();return t.apply($s(s)?s:[],e)}return this[i](function(i){return t.apply($s(i)?i:[],e)})}}),G(I.prototype,function(e,t){var i=T[t];if(i){var n=i.name+"";(Cs[n]||(Cs[n]=[])).push({name:t,func:i})}}),Cs[function e(t,i,n,s,r,a,o,l,d,u){var c=i&zt,h=i&xt,p=i&Ft,f=i&(Vt|Ht),v=i&Yt,g=p?Rt:me(t);return function _(){for(var m=arguments.length,E=Array(m),y=m;y--;)E[y]=arguments[y];if(f)var A=function(e){return(zn.call(T,"placeholder")?T:e).placeholder}(_),S=function(e,t){for(var i=e.length,n=0;i--;)e[i]===t&&++n;return n}(E,A);if(s&&(E=function(e,t,i,n){for(var s=-1,r=e.length,a=i.length,o=-1,l=t.length,d=vs(r-a,0),u=Array(l+d),c=!n;++o<l;)u[o]=t[o];for(;++s<a;)(c||s<r)&&(u[i[s]]=e[s]);for(;d--;)u[o++]=e[s++];return u}(E,s,r,f)),a&&(E=function(e,t,i,n){for(var s=-1,r=e.length,a=-1,o=i.length,l=-1,d=t.length,u=vs(r-o,0),c=Array(u+d),h=!n;++s<u;)c[s]=e[s];for(var p=s;++l<d;)c[p+l]=t[l];for(;++a<o;)(h||s<r)&&(c[p+i[a]]=e[s++]);return c}(E,a,o,f)),m-=S,f&&m<u){var b=function(e,t){for(var i=-1,n=e.length,s=0,r=[];++i<n;){var a=e[i];a!==t&&a!==wt||(e[i]=wt,r[s++]=i)}return r}(E,A);return function(e,t,i,n,s,r,a,o,l,d){var u=t&Vt;t|=u?Wt:Kt,(t&=~(u?Kt:Wt))&Gt||(t&=~(xt|Ft));var c=[e,t,s,u?r:Rt,u?a:Rt,u?Rt:r,u?Rt:a,o,l,d],h=i.apply(Rt,c);return function(e){var t=function(e){for(var t=e.name+"",i=Cs[t],n=zn.call(Cs,t)?i.length:0;n--;){var s=i[n],r=s.func;if(null==r||r==e)return s.name}return t}(e),i=T[t];if("function"!=typeof i||!(t in I.prototype))return!1;if(e===i)return!0;var n=Fs(i);return!!n&&e===n[0]}(e)&&Ws(h,c),h.placeholder=n,function(e,t,i){var n=t+"";return Ks(e,function(e,t){var i=t.length;if(!i)return e;var n=i-1;return t[n]=(i>1?"& ":"")+t[n],t=t.join(i>2?", ":" "),e.replace(zi,"{\n/* [wrapped with "+t+"] */\n")}(n,je(function(e){var t=e.match(Yi);return t?t[1].split(qi):[]}(n),i)))}(h,e,t)}(t,i,e,_.placeholder,n,E,b,l,d,u-m)}var D=h?n:this,C=p?D[t]:t;return m=E.length,l?E=function(e,t){for(var i=e.length,n=gs(t.length,i),s=ve(e);n--;){var r=t[n];e[n]=Re(r,i)?s[r]:Rt}return e}(E,l):v&&m>1&&E.reverse(),c&&d<m&&(E.length=d),this&&this!==Pn&&this instanceof _&&(C=g||me(C)),C.apply(D,E)}}(Rt,Ft).name]=[{name:"wrapper",func:Rt}],I.prototype.clone=function(){var e=new I(this.__wrapped__);return e.__actions__=ve(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ve(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ve(this.__views__),e},I.prototype.reverse=function(){if(this.__filtered__){var e=new I(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},I.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,i=$s(e),n=t<0,s=i?e.length:0,r=function(e,t,i){for(var n=-1,s=i.length;++n<s;){var r=i[n],a=r.size;switch(r.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=gs(t,e+a);break;case"takeRight":e=vs(e,t-a)}}return{start:e,end:t}}(0,s,this.__views__),a=r.start,o=r.end,l=o-a,d=n?o:a-1,u=this.__iteratees__,c=u.length,h=0,p=gs(l,this.__takeCount__);if(!i||!n&&s==l&&p==l)return ue(e,this.__actions__);var f=[];e:for(;l--&&h<p;){for(var v=-1,g=e[d+=t];++v<c;){var _=u[v],m=_.iteratee,E=_.type,y=m(g);if(E==Qt)g=y;else if(!y){if(E==Jt)continue e;break e}}f[h++]=g}return f},T.prototype.chain=function(){return Ke(this)},T.prototype.commit=function(){return new C(this.value(),this.__chain__)},T.prototype.next=function(){this.__values__===Rt&&(this.__values__=dt(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?Rt:this.__values__[this.__index__++]}},T.prototype.plant=function(e){for(var t,i=this;i instanceof D;){var n=xe(i);n.__index__=0,n.__values__=Rt,t?s.__wrapped__=n:t=n;var s=n;i=i.__wrapped__}return s.__wrapped__=e,t},T.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof I){var t=e;return this.__actions__.length&&(t=new I(this)),(t=t.reverse()).__actions__.push({func:ze,args:[We],thisArg:Rt}),new C(t,this.__chain__)}return this.thru(We)},T.prototype.toJSON=T.prototype.valueOf=T.prototype.value=function(){return ue(this.__wrapped__,this.__actions__)},T.prototype.first=T.prototype.head,os&&(T.prototype[os]=function(){return this}),On?((On.exports=T)._=T,Mn._=T):Pn._=T}).call(this),"undefined"!=typeof window&&function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"object"==typeof exports?exports.Hls=t():e.Hls=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var s in e)t.d(n,s,function(t){return e[t]}.bind(null,s));return n},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s="./src/hls.js")}({"./node_modules/eventemitter3/index.js":function(e,t,i){"use strict";function n(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function r(e,t,i,n,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new s(i,n||e,r),o=d?d+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],a]:e._events[o].push(a):(e._events[o]=a,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}var l=Object.prototype.hasOwnProperty,d="~";Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(d=!1)),o.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)l.call(e,t)&&i.push(d?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=d?d+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,r=new Array(s);n<s;n++)r[n]=i[n].fn;return r},o.prototype.listenerCount=function(e){var t=d?d+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,n,s,r){var a=d?d+e:e;if(!this._events[a])return!1;var o,l,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,n),!0;case 5:return u.fn.call(u.context,t,i,n,s),!0;case 6:return u.fn.call(u.context,t,i,n,s,r),!0}for(l=1,o=new Array(c-1);l<c;l++)o[l-1]=arguments[l];u.fn.apply(u.context,o)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,i);break;case 4:u[l].fn.call(u[l].context,t,i,n);break;default:if(!o)for(h=1,o=new Array(c-1);h<c;h++)o[h-1]=arguments[h];u[l].fn.apply(u[l].context,o)}}return!0},o.prototype.on=function(e,t,i){return r(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return r(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,i,n){var s=d?d+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var r=this._events[s];if(r.fn)r.fn!==t||n&&!r.once||i&&r.context!==i||a(this,s);else{for(var o=0,l=[],u=r.length;o<u;o++)(r[o].fn!==t||n&&!r[o].once||i&&r[o].context!==i)&&l.push(r[o]);l.length?this._events[s]=1===l.length?l[0]:l:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=d?d+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=d,o.EventEmitter=o,e.exports=o},"./node_modules/node-libs-browser/node_modules/events/events.js":function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function s(e){return"object"==typeof e&&null!==e}function r(e){return void 0===e}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,a,o,l,d;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(r(i=this._events[e]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(s(i))for(o=Array.prototype.slice.call(arguments,1),a=(d=i.slice()).length,l=0;l<a;l++)d[l].apply(this,o);return!0},i.prototype.addListener=function(e,t){var a;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(a=r(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function i(){this.removeListener(e,i),s||(s=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var s=!1;return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var i,r,a,o;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(i=this._events[e]).length,r=-1,i===t||n(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(i)){for(o=a;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){r=o;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,i){!function(t){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/?#]*)(.*)$/,s=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,a={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var s=a.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");return s.path=a.normalizePath(s.path),a.buildURLFromParts(s)}var r=a.parseURL(t);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return i.alwaysNormalize?(r.path=a.normalizePath(r.path),a.buildURLFromParts(r)):t;var o=a.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=n.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var d={scheme:o.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(d.netLoc=o.netLoc,"/"!==r.path[0]))if(r.path){var u=o.path,c=u.substring(0,u.lastIndexOf("/")+1)+r.path;d.path=a.normalizePath(c)}else d.path=o.path,r.params||(d.params=o.params,r.query||(d.query=o.query));return null===d.path&&(d.path=i.alwaysNormalize?a.normalizePath(r.path):r.path),a.buildURLFromParts(d)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(s,"");e.length!==(e=e.replace(r,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=a}()},"./node_modules/webworkify-webpack/index.js":function(e,t,i){function n(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t.oe=function(e){throw console.error(e),e};var n=t(t.s=ENTRY_MODULE);return n.default||n}function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function r(e){return!isNaN(1*e)}function a(e,t,n){var a={};a[n]=[];var o=t.toString(),l=o.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return a;for(var c,h=l[1],p=new RegExp("(\\\\n|\\W)"+s(h)+u,"g");c=p.exec(o);)"dll-reference"!==c[3]&&a[n].push(c[3]);for(p=new RegExp("\\("+s(h)+'\\("(dll-reference\\s('+d+'))"\\)\\)'+u,"g");c=p.exec(o);)e[c[2]]||(a[n].push(c[1]),e[c[2]]=i(c[1]).m),a[c[2]]=a[c[2]]||[],a[c[2]].push(c[4]);for(var f=Object.keys(a),v=0;v<f.length;v++)for(var g=0;g<a[f[v]].length;g++)r(a[f[v]][g])&&(a[f[v]][g]=1*a[f[v]][g]);return a}function o(e){return Object.keys(e).reduce(function(t,i){return t||e[i].length>0},!1)}function l(e,t){for(var i={main:[t]},n={main:[]},s={main:{}};o(i);)for(var r=Object.keys(i),l=0;l<r.length;l++){var d=r[l],u=i[d].pop();if(s[d]=s[d]||{},!s[d][u]&&e[d][u]){s[d][u]=!0,n[d]=n[d]||[],n[d].push(u);for(var c=a(e,e[d][u],d),h=Object.keys(c),p=0;p<h.length;p++)i[h[p]]=i[h[p]]||[],i[h[p]]=i[h[p]].concat(c[h[p]])}}return n}var d="[\\.|\\-|\\+|\\w|/|@]+",u="\\((/\\*.*?\\*/)?s?.*?("+d+").*?\\)";e.exports=function(e,t){t=t||{};var s={main:i.m},r=t.all?{main:Object.keys(s.main)}:l(s,e),a="";Object.keys(r).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;r[e][t];)t++;r[e].push(t),s[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+r[e].map(function(t){return JSON.stringify(t)+": "+s[e][t].toString()}).join(",")+"});\n"}),a=a+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+r.main.map(function(e){return JSON.stringify(e)+": "+s.main[e].toString()}).join(",")+"}))(self);";var o=new window.Blob([a],{type:"text/javascript"});if(t.bare)return o;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(o),u=new window.Worker(d);return u.objectURL=d,u}},"./src/config.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/controller/abr-controller.js"),s=i("./src/controller/buffer-controller.js"),r=i("./src/controller/cap-level-controller.js"),a=i("./src/controller/fps-controller.js"),o=i("./src/utils/xhr-loader.js"),l=i("./src/controller/audio-track-controller.js"),d=i("./src/controller/audio-stream-controller.js"),u=i("./src/utils/cues.js"),c=i("./src/controller/timeline-controller.js"),h=i("./src/controller/subtitle-track-controller.js"),p=i("./src/controller/subtitle-stream-controller.js"),f=i("./src/controller/eme-controller.js"),v=i("./src/utils/mediakeys-helper.js");t.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:o.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:n.default,bufferController:s.default,capLevelController:r.default,fpsController:a.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:v.requestMediaKeySystemAccess},t.hlsDefaultConfig.subtitleStreamController=p.SubtitleStreamController,t.hlsDefaultConfig.subtitleTrackController=h.default,t.hlsDefaultConfig.timelineController=c.default,t.hlsDefaultConfig.cueHandler=u,t.hlsDefaultConfig.enableCEA708Captions=!0,t.hlsDefaultConfig.enableWebVTT=!0,t.hlsDefaultConfig.captionsTextTrack1Label="English",t.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",t.hlsDefaultConfig.captionsTextTrack2Label="Spanish",t.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",t.hlsDefaultConfig.audioStreamController=d.default,t.hlsDefaultConfig.audioTrackController=l.default,t.hlsDefaultConfig.emeController=f.default},"./src/controller/abr-controller.js":function(e,t,i){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/utils/buffer-helper.js"),o=i("./src/errors.js"),l=i("./src/utils/logger.js"),d=i("./src/utils/ewma-bandwidth-estimator.js"),u=window.performance,c=function(t){function i(e){var i=t.call(this,e,s.default.FRAG_LOADING,s.default.FRAG_LOADED,s.default.FRAG_BUFFERED,s.default.ERROR)||this;return i.lastLoadedFragLevel=0,i._nextAutoLevel=-1,i.hls=e,i.timer=null,i._bwEstimator=null,i.onCheck=i._abandonRulesCheck.bind(i),i}return n(i,t),i.prototype.destroy=function(){this.clearTimer(),r.default.prototype.destroy.call(this)},i.prototype.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var i=this.hls,n=i.config,s=t.level,r=void 0,a=void 0;i.levels[s].details.live?(r=n.abrEwmaFastLive,a=n.abrEwmaSlowLive):(r=n.abrEwmaFastVoD,a=n.abrEwmaSlowVoD),this._bwEstimator=new d.default(i,a,r,n.abrEwmaDefaultEstimate)}},i.prototype._abandonRulesCheck=function(){var e=this.hls,t=e.media,i=this.fragCurrent;if(i){var n=i.loader,r=e.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var o=n.stats;if(t&&o&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&i.autoLevel&&i.level){var d=u.now()-o.trequest,c=Math.abs(t.playbackRate);if(d>500*i.duration/c){var h=e.levels,p=Math.max(1,o.bw?o.bw/8:1e3*o.loaded/d),f=h[i.level],v=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,g=o.total?o.total:Math.max(o.loaded,Math.round(i.duration*v/8)),_=t.currentTime,m=(g-o.loaded)/p,E=(a.BufferHelper.bufferInfo(t,_,e.config.maxBufferHole).end-_)/c;if(E<2*i.duration/c&&m>E){var y=void 0,A=void 0;for(A=i.level-1;A>r;A--){var S=h[A].realBitrate?Math.max(h[A].realBitrate,h[A].bitrate):h[A].bitrate;if((y=i.duration*S/(6.4*p))<E)break}y<m&&(l.logger.warn("loading too slow, abort fragment loading and switch to level "+A+":fragLoadedDelay["+A+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+y.toFixed(1)+"<"+m.toFixed(1)+":"+E.toFixed(1)),e.nextLoadLevel=A,this._bwEstimator.sample(d,o.loaded),n.abort(),this.clearTimer(),e.trigger(s.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:o}))}}}}},i.prototype.onFragLoaded=function(t){var i=t.frag;if("main"===i.type&&e.isFinite(i.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[i.level],s=(n.loaded?n.loaded.bytes:0)+t.stats.loaded,r=(n.loaded?n.loaded.duration:0)+t.frag.duration;n.loaded={bytes:s,duration:r},n.realBitrate=Math.round(8*s/r)}if(t.frag.bitrateTest){var a=t.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(t)}}},i.prototype.onFragBuffered=function(t){var i=t.stats,n=t.frag;if(!0!==i.aborted&&"main"===n.type&&e.isFinite(n.sn)&&(!n.bitrateTest||i.tload===i.tbuffered)){var s=i.tparsed-i.trequest;l.logger.log("latency/loading/parsing/append/kbps:"+Math.round(i.tfirst-i.trequest)+"/"+Math.round(i.tload-i.tfirst)+"/"+Math.round(i.tparsed-i.tload)+"/"+Math.round(i.tbuffered-i.tparsed)+"/"+Math.round(8*i.loaded/(i.tbuffered-i.trequest))),this._bwEstimator.sample(s,i.loaded),i.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},i.prototype.onError=function(e){switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},i.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Object.defineProperty(i.prototype,"nextAutoLevel",{get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var i=this._nextABRAutoLevel;return-1!==e&&(i=Math.min(e,i)),i},set:function(e){this._nextAutoLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_nextABRAutoLevel",{get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.levels,n=e.config,s=e.minAutoLevel,r=e.media,o=this.lastLoadedFragLevel,d=this.fragCurrent?this.fragCurrent.duration:0,u=r?r.currentTime:0,c=r&&0!==r.playbackRate?Math.abs(r.playbackRate):1,h=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,p=(a.BufferHelper.bufferInfo(r,u,n.maxBufferHole).end-u)/c,f=this._findBestLevel(o,d,h,s,t,p,n.abrBandWidthFactor,n.abrBandWidthUpFactor,i);if(f>=0)return f;l.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=d?Math.min(d,n.maxStarvationDelay):n.maxStarvationDelay,g=n.abrBandWidthFactor,_=n.abrBandWidthUpFactor;if(0===p){var m=this.bitrateTestDelay;m&&(v=(d?Math.min(d,n.maxLoadingDelay):n.maxLoadingDelay)-m,l.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),g=_=1)}return f=this._findBestLevel(o,d,h,s,t,p+v,g,_,i),Math.max(f,0)},enumerable:!0,configurable:!0}),i.prototype._findBestLevel=function(e,t,i,n,s,r,a,o,d){for(var u=s;u>=n;u--){var c=d[u];if(c){var h,p=c.details,f=p?p.totalduration/p.fragments.length:t,v=!!p&&p.live;h=u<=e?a*i:o*i;var g=d[u].realBitrate?Math.max(d[u].realBitrate,d[u].bitrate):d[u].bitrate,_=g*f/h;if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(h)+"/"+g+"/"+f+"/"+r+"/"+_),h>g&&(!_||v&&!this.bitrateTestDelay||_<r))return u}}return-1},i}(r.default);t.default=c}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/audio-stream-controller.js":function(e,t,i){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/binary-search.js"),r=i("./src/utils/buffer-helper.js"),a=i("./src/demux/demuxer.js"),o=i("./src/events.js"),l=i("./src/controller/level-helper.js"),d=i("./src/utils/time-ranges.js"),u=i("./src/errors.js"),c=i("./src/utils/logger.js"),h=i("./src/utils/discontinuities.js"),p=i("./src/controller/fragment-tracker.js"),f=i("./src/loader/fragment.js"),v=i("./src/controller/base-stream-controller.js"),g=window.performance,_=function(t){function i(e,i){var n=t.call(this,e,o.default.MEDIA_ATTACHED,o.default.MEDIA_DETACHING,o.default.AUDIO_TRACKS_UPDATED,o.default.AUDIO_TRACK_SWITCHING,o.default.AUDIO_TRACK_LOADED,o.default.KEY_LOADED,o.default.FRAG_LOADED,o.default.FRAG_PARSING_INIT_SEGMENT,o.default.FRAG_PARSING_DATA,o.default.FRAG_PARSED,o.default.ERROR,o.default.BUFFER_RESET,o.default.BUFFER_CREATED,o.default.BUFFER_APPENDED,o.default.BUFFER_FLUSHED,o.default.INIT_PTS_FOUND)||this;return n.fragmentTracker=i,n.config=e.config,n.audioCodecSwap=!1,n._state=v.State.STOPPED,n.initPTS=[],n.waitingFragment=null,n.videoTrackCC=null,n}return n(i,t),i.prototype.onInitPtsFound=function(e){var t=e.id,i=e.frag.cc,n=e.initPTS;"main"===t&&(this.initPTS[i]=n,this.videoTrackCC=i,c.logger.log("InitPTS for cc: "+i+" found from video track: "+n),this.state===v.State.WAITING_INIT_PTS&&this.tick())},i.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(c.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=v.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=v.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=v.State.STOPPED},Object.defineProperty(i.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("audio stream:"+t+"->"+e)}},enumerable:!0,configurable:!0}),i.prototype.doTick=function(){var t,i,n,a=this.hls,l=a.config;switch(this.state){case v.State.ERROR:case v.State.PAUSED:case v.State.BUFFER_FLUSHING:break;case v.State.STARTING:this.state=v.State.WAITING_TRACK,this.loadedmetadata=!1;break;case v.State.IDLE:var d=this.tracks;if(!d)break;if(!this.media&&(this.startFragRequested||!l.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var u=this.mediaBuffer?this.mediaBuffer:this.media,f=this.videoBuffer?this.videoBuffer:this.media,_=r.BufferHelper.bufferInfo(u,t,l.maxBufferHole),m=r.BufferHelper.bufferInfo(f,t,l.maxBufferHole),E=_.len,y=_.end,A=this.fragPrevious,S=Math.min(l.maxBufferLength,l.maxMaxBufferLength),b=Math.max(S,m.len),T=this.audioSwitch,D=this.trackId;if((E<b||T)&&D<d.length){if(void 0===(n=d[D].details)){this.state=v.State.WAITING_TRACK;break}if(!T&&this._streamEnded(_,n))return this.hls.trigger(o.default.BUFFER_EOS,{type:"audio"}),void(this.state=v.State.ENDED);var C=n.fragments,I=C.length,R=C[0].start,P=C[I-1].start+C[I-1].duration,M=void 0;if(T)if(n.live&&!n.PTSKnown)c.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),y=0;else if(y=t,n.PTSKnown&&t<R){if(!(_.end>R||_.nextStart))return;c.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=R+.05}if(n.initSegment&&!n.initSegment.data)M=n.initSegment;else if(y<=R){if(M=C[0],null!==this.videoTrackCC&&M.cc!==this.videoTrackCC&&(M=h.findFragWithCC(C,this.videoTrackCC)),n.live&&M.loadIdx&&M.loadIdx===this.fragLoadIdx){var O=_.nextStart?_.nextStart:R;return c.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(O+.05)),void(this.media.currentTime=O+.05)}}else{var L=void 0,w=l.maxFragLookUpTolerance,N=A?C[A.sn-C[0].sn+1]:void 0,k=function(e){var t=Math.min(w,e.duration);return e.start+e.duration-t<=y?1:e.start-t>y&&e.start?-1:0};y<P?(y>P-w&&(w=0),L=N&&!k(N)?N:s.default.search(C,k)):L=C[I-1],L&&(M=L,R=L.start,A&&M.level===A.level&&M.sn===A.sn&&(M.sn<n.endSN?(M=C[M.sn+1-n.startSN],c.logger.log("SN just loaded, load next one: "+M.sn)):M=null))}M&&(M.encrypted?(c.logger.log("Loading key for "+M.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+D),this.state=v.State.KEY_LOADING,a.trigger(o.default.KEY_LOADING,{frag:M})):(c.logger.log("Loading "+M.sn+", cc: "+M.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+D+", currentTime:"+t+",bufferEnd:"+y.toFixed(3)),this.fragCurrent=M,(T||this.fragmentTracker.getState(M)===p.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,e.isFinite(M.sn)&&(this.nextLoadPosition=M.start+M.duration),a.trigger(o.default.FRAG_LOADING,{frag:M}),this.state=v.State.FRAG_LOADING)))}break;case v.State.WAITING_TRACK:(i=this.tracks[this.trackId])&&i.details&&(this.state=v.State.IDLE);break;case v.State.FRAG_LOADING_WAITING_RETRY:var B=g.now(),U=this.retryDate,j=(u=this.media)&&u.seeking;(!U||B>=U||j)&&(c.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=v.State.IDLE);break;case v.State.WAITING_INIT_PTS:var x=this.videoTrackCC;if(void 0===this.initPTS[x])break;var F=this.waitingFragment;if(F){var G=F.frag.cc;x!==G?(i=this.tracks[this.trackId]).details&&i.details.live&&(c.logger.warn("Waiting fragment CC ("+G+") does not match video track CC ("+x+")"),this.waitingFragment=null,this.state=v.State.IDLE):(this.state=v.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=v.State.IDLE;break;case v.State.STOPPED:case v.State.FRAG_LOADING:case v.State.PARSING:case v.State.PARSED:case v.State.ENDED:}},i.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)},i.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.prototype.onAudioTracksUpdated=function(e){c.logger.log("audio tracks updated"),this.tracks=e.audioTracks},i.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=v.State.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=v.State.IDLE),this.tick()},i.prototype.onAudioTrackLoaded=function(t){var i=t.details,n=t.id,s=this.tracks[n],r=i.totalduration,a=0;if(c.logger.log("track "+n+" loaded ["+i.startSN+","+i.endSN+"],duration:"+r),i.live){var o=s.details;o&&i.fragments.length>0?(l.mergeDetails(o,i),a=i.fragments[0].start,i.PTSKnown?c.logger.log("live audio playlist sliding:"+a.toFixed(3)):c.logger.log("live audio playlist - outdated PTS, unknown sliding")):(i.PTSKnown=!1,c.logger.log("live audio playlist - first load, unknown sliding"))}else i.PTSKnown=!1;if(s.details=i,!this.startFragRequested){if(-1===this.startPosition){var d=i.startTimeOffset;e.isFinite(d)?(c.logger.log("start time offset found in playlist, adjust startPosition to "+d),this.startPosition=d):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===v.State.WAITING_TRACK&&(this.state=v.State.IDLE),this.tick()},i.prototype.onKeyLoaded=function(){this.state===v.State.KEY_LOADING&&(this.state=v.State.IDLE,this.tick())},i.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag;if(this.state===v.State.FRAG_LOADING&&t&&"audio"===i.type&&i.level===t.level&&i.sn===t.sn){var n=this.tracks[this.trackId],s=n.details,r=s.totalduration,l=t.level,d=t.sn,u=t.cc,h=this.config.defaultAudioCodec||n.audioCodec||"mp4a.40.2",p=this.stats=e.stats;if("initSegment"===d)this.state=v.State.IDLE,p.tparsed=p.tbuffered=g.now(),s.initSegment.data=e.payload,this.hls.trigger(o.default.FRAG_BUFFERED,{stats:p,frag:t,id:"audio"}),this.tick();else{this.state=v.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new a.default(this.hls,"audio"));var f=this.initPTS[u],_=s.initSegment?s.initSegment.data:[];s.initSegment||void 0!==f?(this.pendingBuffering=!0,c.logger.log("Demuxing "+d+" of ["+s.startSN+" ,"+s.endSN+"],track "+l),this.demuxer.push(e.payload,_,h,null,t,r,!1,f)):(c.logger.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+d+" of ["+s.startSN+" ,"+s.endSN+"],track "+l),this.waitingFragment=e,this.state=v.State.WAITING_INIT_PTS)}}this.fragLoadError=0},i.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===v.State.PARSING){var n=e.tracks,s=void 0;if(n.video&&delete n.video,s=n.audio){s.levelCodec=s.codec,s.id=e.id,this.hls.trigger(o.default.BUFFER_CODECS,n),c.logger.log("audio track:audio,container:"+s.container+",codecs[level/parsed]=["+s.levelCodec+"/"+s.codec+"]");var r=s.initSegment;if(r){var a={type:"audio",data:r,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(o.default.BUFFER_APPENDING,a))}this.tick()}}},i.prototype.onFragParsingData=function(t){var i=this,n=this.fragCurrent,s=t.frag;if(n&&"audio"===t.id&&"audio"===t.type&&s.sn===n.sn&&s.level===n.level&&this.state===v.State.PARSING){var r=this.trackId,a=this.tracks[r],d=this.hls;e.isFinite(t.endPTS)||(t.endPTS=t.startPTS+n.duration,t.endDTS=t.startDTS+n.duration),n.addElementaryStream(f.default.ElementaryStreamTypes.AUDIO),c.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),l.updateFragPTSDTS(a.details,n,t.startPTS,t.endPTS);var h=this.audioSwitch,p=this.media,g=!1;if(h&&p)if(p.readyState){var _=p.currentTime;c.logger.log("switching audio track : currentTime:"+_),_>=t.startPTS&&(c.logger.log("switching audio track : flushing all audio"),this.state=v.State.BUFFER_FLUSHING,d.trigger(o.default.BUFFER_FLUSHING,{startOffset:0,endOffset:e.POSITIVE_INFINITY,type:"audio"}),g=!0,this.audioSwitch=!1,d.trigger(o.default.AUDIO_TRACK_SWITCHED,{id:r}))}else this.audioSwitch=!1,d.trigger(o.default.AUDIO_TRACK_SWITCHED,{id:r});var m=this.pendingData;if(!m)return c.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void d.trigger(o.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&m.push({type:t.type,data:e,parent:"audio",content:"data"})}),!g&&m.length&&(m.forEach(function(e){i.state===v.State.PARSING&&(i.pendingBuffering=!0,i.hls.trigger(o.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},i.prototype.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===v.State.PARSING&&(this.stats.tparsed=g.now(),this.state=v.State.PARSED,this._checkAppendedParsed())},i.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},i.prototype.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==v.State.PARSING&&t!==v.State.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i.prototype._checkAppendedParsed=function(){if(!(this.state!==v.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,i=this.hls;if(e){this.fragPrevious=e,t.tbuffered=g.now(),i.trigger(o.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var n=this.mediaBuffer?this.mediaBuffer:this.media;c.logger.log("audio buffered : "+d.default.toString(n.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(o.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=v.State.IDLE}this.tick()}},i.prototype.onError=function(t){var i=t.frag;if(!i||"audio"===i.type)switch(t.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=t.frag;if(n&&"audio"!==n.type)break;if(!t.fatal){var s=this.fragLoadError;if(s?s++:s=1,s<=(l=this.config).fragLoadingMaxRetry){this.fragLoadError=s;var a=Math.min(Math.pow(2,s-1)*l.fragLoadingRetryDelay,l.fragLoadingMaxRetryTimeout);c.logger.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=g.now()+a,this.state=v.State.FRAG_LOADING_WAITING_RETRY}else c.logger.error("AudioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=v.State.ERROR}break;case u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case u.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==v.State.ERROR&&(this.state=t.fatal?v.State.ERROR:v.State.IDLE,c.logger.warn("AudioStreamController: "+t.details+" while loading frag, now switching to "+this.state+" state ..."));break;case u.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===v.State.PARSING||this.state===v.State.PARSED)){var l,d=this.mediaBuffer,h=this.media.currentTime;d&&r.BufferHelper.isBuffered(d,h)&&r.BufferHelper.isBuffered(d,h+.5)?((l=this.config).maxMaxBufferLength>=l.maxBufferLength&&(l.maxMaxBufferLength/=2,c.logger.warn("AudioStreamController: reduce max buffer length to "+l.maxMaxBufferLength+"s")),this.state=v.State.IDLE):(c.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=v.State.BUFFER_FLUSHING,this.hls.trigger(o.default.BUFFER_FLUSHING,{startOffset:0,endOffset:e.POSITIVE_INFINITY,type:"audio"}))}}},i.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(c.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(t){e.hls.trigger(o.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=v.State.PARSED):(this.state=v.State.IDLE,this.fragPrevious=null,this.tick())},i}(v.default);t.default=_}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/audio-track-controller.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=i("./src/task-loop.js"),a=i("./src/utils/logger.js"),o=i("./src/errors.js"),l=function(e){function t(t){var i=e.call(this,t,s.default.MANIFEST_LOADING,s.default.MANIFEST_PARSED,s.default.AUDIO_TRACK_LOADED,s.default.AUDIO_TRACK_SWITCHED,s.default.LEVEL_LOADED,s.default.ERROR)||this;return i._trackId=-1,i._selectDefaultTrack=!0,i.tracks=[],i.trackIdBlacklist=Object.create(null),i.audioGroupId=null,i}return n(t,e),t.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},t.prototype.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(s.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})},t.prototype.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)a.logger.warn("Invalid audio track id:",e.id);else{if(a.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},t.prototype.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},t.prototype.onLevelLoaded=function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var i=t.audioGroupIds[t.urlId];this.audioGroupId!==i&&(this.audioGroupId=i,this._selectInitialAudioTrack())}},t.prototype.onError=function(e){e.type===o.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(a.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},Object.defineProperty(t.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTrack",{get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),t.prototype._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)a.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)a.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];a.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var i=t.url,n=t.type,r=t.id;this.hls.trigger(s.default.AUDIO_TRACK_SWITCHING,{id:r,type:n,url:i}),this._loadTrackDetailsIfNeeded(t)}},t.prototype.doTick=function(){this._updateTrack(this._trackId)},t.prototype._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var i=this.tracks[this._trackId],n=null;if(i&&(n=i.name),this._selectDefaultTrack){var r=t.filter(function(e){return e.default});r.length?t=r:a.logger.warn("No default audio tracks defined")}var l=!1,d=function(){t.forEach(function(t){l||e.audioGroupId&&t.groupId!==e.audioGroupId||n&&n!==t.name||(e._setAudioTrack(t.id),l=!0)})};d(),l||(n=null,d()),l||(a.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},t.prototype._needsTrackLoading=function(e){var t=e.details,i=e.url;return!(t&&!t.live||!i)},t.prototype._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,i=e.id;a.logger.log("loading audio-track playlist for id: "+i),this.hls.trigger(s.default.AUDIO_TRACK_LOADING,{url:t,id:i})}},t.prototype._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,a.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},t.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],i=t.name,n=t.language,s=t.groupId;a.logger.warn("Loading failed on audio track id: "+e+", group-id: "+s+', name/language: "'+i+'" / "'+n+'"');for(var r=e,o=0;o<this.tracks.length;o++)if(!this.trackIdBlacklist[o]&&this.tracks[o].name===i){r=o;break}r!==e?(a.logger.log("Attempting audio-track fallback id:",r,"group-id:",this.tracks[r].groupId),this._setAudioTrack(r)):a.logger.warn('No fallback audio-track found for name/language: "'+i+'" / "'+n+'"')},t}(r.default);t.default=l},"./src/controller/base-stream-controller.js":function(e,t,i){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/task-loop.js"),r=i("./src/controller/fragment-tracker.js"),a=i("./src/utils/buffer-helper.js"),o=i("./src/utils/logger.js");t.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var l=function(i){function s(){return null!==i&&i.apply(this,arguments)||this}return n(s,i),s.prototype.doTick=function(){},s.prototype.startLoad=function(){},s.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=t.State.STOPPED},s.prototype._streamEnded=function(e,t){var i=this.fragCurrent,n=this.fragmentTracker;if(!t.live&&i&&!i.backtracked&&i.sn===t.endSN&&!e.nextStart){var s=n.getState(i);return s===r.FragmentState.PARTIAL||s===r.FragmentState.OK}return!1},s.prototype.onMediaSeeking=function(){var i=this,n=i.config,s=i.media,r=i.mediaBuffer,l=i.state,d=s?s.currentTime:null,u=a.BufferHelper.bufferInfo(r||s,d,this.config.maxBufferHole);if(e.isFinite(d)&&o.logger.log("media seeking to "+d.toFixed(3)),l===t.State.FRAG_LOADING){var c=this.fragCurrent;if(0===u.len&&c){var h=n.maxFragLookUpTolerance,p=c.start-h,f=c.start+c.duration+h;d<p||d>f?(c.loader&&(o.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),c.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=t.State.IDLE):o.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else l===t.State.ENDED&&(0===u.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=t.State.IDLE);s&&(this.lastCurrentTime=d),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=d),this.tick()},s.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},s.prototype.onHandlerDestroying=function(){this.stopLoad(),i.prototype.onHandlerDestroying.call(this)},s.prototype.onHandlerDestroyed=function(){this.state=t.State.STOPPED,this.fragmentTracker=null},s}(s.default);t.default=l}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/buffer-controller.js":function(e,t,i){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/utils/logger.js"),o=i("./src/errors.js"),l=i("./src/utils/mediasource-helper.js").getMediaSource(),d=function(t){function i(e){var i=t.call(this,e,s.default.MEDIA_ATTACHING,s.default.MEDIA_DETACHING,s.default.MANIFEST_PARSED,s.default.BUFFER_RESET,s.default.BUFFER_APPENDING,s.default.BUFFER_CODECS,s.default.BUFFER_EOS,s.default.BUFFER_FLUSHING,s.default.LEVEL_PTS_UPDATED,s.default.LEVEL_UPDATED)||this;return i._msDuration=null,i._levelDuration=null,i._levelTargetDuration=10,i._live=null,i._objectUrl=null,i.bufferCodecEventsExpected=0,i.onsbue=i.onSBUpdateEnd.bind(i),i.onsbe=i.onSBUpdateError.bind(i),i.pendingTracks={},i.tracks={},i}return n(i,t),i.prototype.destroy=function(){r.default.prototype.destroy.call(this)},i.prototype.onLevelPtsUpdated=function(e){var t=e.type,i=this.tracks.audio;if("audio"===t&&i&&"audio/mpeg"===i.container){var n=this.sourceBuffer.audio;if(Math.abs(n.timestampOffset-e.start)>.1){var s=n.updating;try{n.abort()}catch(e){a.logger.warn("can not abort audio buffer: "+e)}s?this.audioTimestampOffset=e.start:(a.logger.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+e.start),n.timestampOffset=e.start)}}},i.prototype.onManifestParsed=function(e){this.bufferCodecEventsExpected=e.altAudio?2:1,a.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var i=this.mediaSource=new l;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),t.src=window.URL.createObjectURL(i),this._objectUrl=t.src}},i.prototype.onMediaDetaching=function(){a.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){a.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):a.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(s.default.MEDIA_DETACHED)},i.prototype.onMediaSourceOpen=function(){a.logger.log("media source opened"),this.hls.trigger(s.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},i.prototype.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,i=Object.keys(t).length;(i&&!e||2===i)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.prototype.onMediaSourceClose=function(){a.logger.log("media source closed")},i.prototype.onMediaSourceEnded=function(){a.logger.log("media source ended")},i.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;a.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,i=this.segments.reduce(function(e,i){return i.parent===t?e+1:e},0),n={},r=this.sourceBuffer;for(var o in r)n[o]=r[o].buffered;this.hls.trigger(s.default.BUFFER_APPENDED,{parent:t,pending:i,timeRanges:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===i&&this.flushLiveBackBuffer()},i.prototype.onSBUpdateError=function(e){a.logger.error("sourceBuffer error:",e),this.hls.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},i.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var i=e[t];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.prototype.onBufferCodecs=function(e){var t=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(e).forEach(function(i){t.pendingTracks[i]=e[i]});var i=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),i&&"open"===i.readyState&&this.checkPendingTracks()}},i.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;for(var n in e)if(!t[n]){var r=e[n],l=r.levelCodec||r.codec,d=r.container+";codecs="+l;a.logger.log("creating sourceBuffer("+d+")");try{var u=t[n]=i.addSourceBuffer(d);u.addEventListener("updateend",this.onsbue),u.addEventListener("error",this.onsbe),this.tracks[n]={codec:l,container:r.container},r.buffer=u}catch(e){a.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:d})}}this.hls.trigger(s.default.BUFFER_CREATED,{tracks:e})},i.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.prototype.onBufferAppendFail=function(e){a.logger.error("sourceBuffer error:",e.event),this.hls.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},i.prototype.onBufferEos=function(e){var t=this.sourceBuffer,i=e.type;for(var n in t)i&&n!==i||t[n].ended||(t[n].ended=!0,a.logger.log(n+" sourceBuffer now EOS"));this.checkEos()},i.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var i in e){var n=e[i];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}a.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){a.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},i.prototype.flushLiveBackBuffer=function(){if(this._live){var e=this.hls.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))for(var t=this.media.currentTime,i=this.sourceBuffer,n=Object.keys(i),s=t-Math.max(e,this._levelTargetDuration),r=n.length-1;r>=0;r--){var a=n[r],o=i[a].buffered;o.length>0&&s>o.start(0)&&this.removeBufferRange(a,i[a],0,s)}}},i.prototype.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.prototype.updateMediaElementDuration=function(){var t,i=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer)if(!0===this.sourceBuffer[n].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===i.liveDurationInfinity?(a.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!e.isFinite(t))&&(a.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,i=this.sourceBuffer;try{for(var n in i)t+=i[n].buffered.length}catch(e){a.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(s.default.BUFFER_FLUSHED)}},i.prototype.doAppending=function(){var e=this,t=e.hls,i=e.segments,n=e.sourceBuffer;if(Object.keys(n).length){if(this.media.error)return this.segments=[],void a.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(i&&i.length){var r=i.shift();try{var l=n[r.type];l?l.updating?i.unshift(r):(l.ended=!1,this.parent=r.parent,l.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){a.logger.error("error while trying to append buffer:"+e.message),i.unshift(r);var d={type:o.ErrorTypes.MEDIA_ERROR,parent:r.parent};22!==e.code?(this.appendError?this.appendError++:this.appendError=1,d.details=o.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry?(a.logger.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],d.fatal=!0,t.trigger(s.default.ERROR,d)):(d.fatal=!1,t.trigger(s.default.ERROR,d))):(this.segments=[],d.details=o.ErrorDetails.BUFFER_FULL_ERROR,d.fatal=!1,t.trigger(s.default.ERROR,d))}}}},i.prototype.flushBuffer=function(e,t,i){var n,s=this.sourceBuffer;if(Object.keys(s).length){if(a.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var r in s)if(!i||r===i){if((n=s[r]).ended=!1,n.updating)return a.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(r,n,e,t))return this.flushBufferCounter++,!1}}else a.logger.warn("abort flushing too many retries");a.logger.log("buffer flushed")}return!0},i.prototype.removeBufferRange=function(e,t,i,n){try{for(var s=0;s<t.buffered.length;s++){var r=t.buffered.start(s),o=t.buffered.end(s),l=Math.max(r,i),d=Math.min(o,n);if(Math.min(d,o)-l>.5)return a.logger.log("sb remove "+e+" ["+l+","+d+"], of ["+r+","+o+"], pos:"+this.media.currentTime),t.remove(l,d),!0}}catch(e){a.logger.warn("removeBufferRange failed",e)}return!1},i}(r.default);t.default=d}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/cap-level-controller.js":function(e,t,i){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=function(t){function i(i){var n=t.call(this,i,s.default.FPS_DROP_LEVEL_CAPPING,s.default.MEDIA_ATTACHING,s.default.MANIFEST_PARSED,s.default.BUFFER_CODECS,s.default.MEDIA_DETACHING)||this;return n.autoLevelCapping=e.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n}return n(i,t),i.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},i.prototype.onFpsDropLevelCapping=function(e){i.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},i.prototype.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},i.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this._startCapping()},i.prototype.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this._startCapping()},i.prototype.onLevelsUpdated=function(e){this.levels=e.levels},i.prototype.onMediaDetaching=function(){this._stopCapping()},i.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},i.prototype.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var n=this.levels.filter(function(n,s){return i.isLevelAllowed(s,t.restrictedLevels)&&s<=e});return i.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},i.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=e.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},i.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=e.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(i.prototype,"mediaWidth",{get:function(){var e,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=i.contentScaleFactor),e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mediaHeight",{get:function(){var e,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=i.contentScaleFactor),e},enumerable:!0,configurable:!0}),Object.defineProperty(i,"contentScaleFactor",{get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e},enumerable:!0,configurable:!0}),i.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},i.getMaxLevelByMediaSize=function(e,t,i){if(!e||e&&!e.length)return-1;for(var n=function(e,t){return!t||e.width!==t.width||e.height!==t.height},s=e.length-1,r=0;r<e.length;r+=1){var a=e[r];if((a.width>=t||a.height>=i)&&n(a,e[r+1])){s=r;break}}return s},i}(i("./src/event-handler.js").default);t.default=r}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/eme-controller.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/event-handler.js"),r=i("./src/events.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=window.XMLHttpRequest,d="com.widevine.alpha",u="com.microsoft.playready",c=function(e){function t(t){var i=e.call(this,t,r.default.MEDIA_ATTACHED,r.default.MANIFEST_PARSED)||this;return i._widevineLicenseUrl=t.config.widevineLicenseUrl,i._licenseXhrSetup=t.config.licenseXhrSetup,i._emeEnabled=t.config.emeEnabled,i._requestMediaKeySystemAccess=t.config.requestMediaKeySystemAccessFunc,i._mediaKeysList=[],i._media=null,i._hasSetMediaKeys=!1,i._isMediaEncrypted=!1,i._requestLicenseFailureCount=0,i}return n(t,e),t.prototype.getLicenseServerUrl=function(e){var t;switch(e){case d:t=this._widevineLicenseUrl;break;default:t=null}return t||(o.logger.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t},t.prototype._attemptKeySystemAccess=function(e,t,i){var n=this,s=function(e,t,i){switch(e){case d:return function(e,t,i){var n={videoCapabilities:[]};return t.forEach(function(e){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[n]}(0,i);default:throw Error("Unknown key-system: "+e)}}(e,0,i);s?(o.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,s).then(function(t){n._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){o.logger.error('Failed to obtain key-system "'+e+'" access:',t)})):o.logger.warn("Can not create config for key-system (maybe because platform is not supported):",e)},Object.defineProperty(t.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),t.prototype._onMediaKeySystemAccessObtained=function(e,t){var i=this;o.logger.log('Access for key-system "'+e+'" obtained');var n={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(n),t.createMediaKeys().then(function(t){n.mediaKeys=t,o.logger.log('Media-keys created for key-system "'+e+'"'),i._onMediaKeysCreated()}).catch(function(e){o.logger.error("Failed to create media-keys:",e)})},t.prototype._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},t.prototype._onNewMediaKeySession=function(e){var t=this;o.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(i){t._onKeySessionMessage(e,i.message)},!1)},t.prototype._onKeySessionMessage=function(e,t){o.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){o.logger.log("Received license data, updating key-session"),e.update(t)})},t.prototype._onMediaEncrypted=function(e,t){o.logger.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},t.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return o.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});o.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},t.prototype._generateRequestWithPreferredKeySession=function(){var e=this,t=this._mediaKeysList[0];if(!t)return o.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)o.logger.warn("Key-Session already initialized but requested again");else{var i=t.mediaKeysSession;i||(o.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var n=this._mediaEncryptionInitDataType,s=this._mediaEncryptionInitData;o.logger.log('Generating key-session request for "'+n+'" init data type'),t.mediaKeysSessionInitialized=!0,i.generateRequest(n,s).then(function(){o.logger.debug("Key-session generation succeeded")}).catch(function(t){o.logger.error("Error generating key-session request:",t),e.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},t.prototype._createLicenseXhr=function(e,t,i){var n=new l,s=this._licenseXhrSetup;try{if(s)try{s(n,e)}catch(t){n.open("POST",e,!0),s(n,e)}n.readyState||n.open("POST",e,!0)}catch(e){return o.logger.error("Error setting up key-system license XHR",e),void this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,e,t,i),n},t.prototype._onLicenseRequestReadyStageChange=function(e,t,i,n){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,o.logger.log("License request succeeded"),n(e.response);else{if(o.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),++this._requestLicenseFailureCount<=3){var s=3-this._requestLicenseFailureCount+1;return o.logger.warn("Retrying license request, "+s+" attempts left"),void this._requestLicense(i,n)}this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},t.prototype._generateLicenseRequestChallenge=function(e,t){var i;return e.mediaKeySystemDomain===u?o.logger.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===d?i=t:o.logger.error("Unsupported key-system:",e.mediaKeySystemDomain),i},t.prototype._requestLicense=function(e,t){o.logger.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return o.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var n=this.getLicenseServerUrl(i.mediaKeySystemDomain),s=this._createLicenseXhr(n,e,t);o.logger.log("Sending license request to URL: "+n),s.send(this._generateLicenseRequestChallenge(i,e))},t.prototype.onMediaAttached=function(e){var t=this;if(this._emeEnabled){var i=e.media;this._media=i,i.addEventListener("encrypted",function(e){t._onMediaEncrypted(e.initDataType,e.initData)})}},t.prototype.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),i=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(d,t,i)}},t}(s.default);t.default=c},"./src/controller/fps-controller.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/utils/logger.js"),o=window.performance,l=function(e){function t(t){return e.call(this,t,s.default.MEDIA_ATTACHING)||this}return n(t,e),t.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},t.prototype.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},t.prototype.checkFPS=function(e,t,i){var n=o.now();if(t){if(this.lastTime){var r=n-this.lastTime,l=i-this.lastDroppedFrames,d=t-this.lastDecodedFrames,u=1e3*l/r,c=this.hls;if(c.trigger(s.default.FPS_DROP,{currentDropped:l,currentDecoded:d,totalDroppedFrames:i}),u>0&&l>c.config.fpsDroppedMonitoringThreshold*d){var h=c.currentLevel;a.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=h)&&(h-=1,c.trigger(s.default.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,c.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},t.prototype.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},t}(r.default);t.default=l},"./src/controller/fragment-finders.js":function(e,t,i){"use strict";(function(e){function n(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0);var n=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-n<=e?1:i.start-n>e&&i.start?-1:0}function s(e,t,i){var n=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.endProgramDateTime-n>e}Object.defineProperty(t,"__esModule",{value:!0});var r=i("./src/utils/binary-search.js");t.findFragmentByPDT=function(t,i,n){if(!Array.isArray(t)||!t.length||!e.isFinite(i))return null;if(i<t[0].programDateTime)return null;if(i>=t[t.length-1].endProgramDateTime)return null;n=n||0;for(var r=0;r<t.length;++r){var a=t[r];if(s(i,n,a))return a}return null},t.findFragmentByPTS=function(e,t,i,s){void 0===i&&(i=0),void 0===s&&(s=0);var a=e?t[e.sn-t[0].sn+1]:null;return a&&!n(i,s,a)?a:r.default.search(t,n.bind(null,i,s))},t.fragmentWithinToleranceTest=n,t.pdtWithinToleranceTest=s}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/fragment-tracker.js":function(e,t,i){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/event-handler.js"),r=i("./src/events.js");t.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var a=function(i){function a(e){var t=i.call(this,e,r.default.BUFFER_APPENDED,r.default.FRAG_BUFFERED,r.default.FRAG_LOADED)||this;return t.bufferPadding=.2,t.fragments=Object.create(null),t.timeRanges=Object.create(null),t.config=e.config,t}return n(a,i),a.prototype.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,s.default.prototype.destroy.call(this),i.prototype.destroy.call(this)},a.prototype.getBufferedFrag=function(e,t){var i=this.fragments,n=Object.keys(i).filter(function(n){var s=i[n];if(s.body.type!==t)return!1;if(!s.buffered)return!1;var r=s.body;return r.startPTS<=e&&e<=r.endPTS});if(0===n.length)return null;var s=n.pop();return i[s].body},a.prototype.detectEvictedFragments=function(e,t){var i,n,s=this;Object.keys(this.fragments).forEach(function(r){var a=s.fragments[r];if(!0===a.buffered){var o=a.range[e];if(o){i=o.time;for(var l=0;l<i.length;l++)if(n=i[l],!1===s.isTimeBuffered(n.startPTS,n.endPTS,t)){s.removeFragment(a.body);break}}}})},a.prototype.detectPartialFragments=function(e){var t=this,i=this.getFragmentKey(e),n=this.fragments[i];n&&(n.buffered=!0,Object.keys(this.timeRanges).forEach(function(i){if(e.hasElementaryStream(i)){var s=t.timeRanges[i];n.range[i]=t.getBufferedTimes(e.startPTS,e.endPTS,s)}}))},a.prototype.getBufferedTimes=function(e,t,i){for(var n,s,r=[],a=!1,o=0;o<i.length;o++){if(n=i.start(o)-this.bufferPadding,s=i.end(o)+this.bufferPadding,e>=n&&t<=s){r.push({startPTS:Math.max(e,i.start(o)),endPTS:Math.min(t,i.end(o))});break}if(e<s&&t>n)r.push({startPTS:Math.max(e,i.start(o)),endPTS:Math.min(t,i.end(o))}),a=!0;else if(t<=n)break}return{time:r,partial:a}},a.prototype.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},a.prototype.getPartialFragment=function(e){var t,i,n,s=this,r=null,a=0;return Object.keys(this.fragments).forEach(function(o){var l=s.fragments[o];s.isPartial(l)&&(i=l.body.startPTS-s.bufferPadding,n=l.body.endPTS+s.bufferPadding,e>=i&&e<=n&&(t=Math.min(e-i,n-e),a<=t&&(r=l.body,a=t)))}),r},a.prototype.getState=function(e){var i=this.getFragmentKey(e),n=this.fragments[i],s=t.FragmentState.NOT_LOADED;return void 0!==n&&(s=n.buffered?!0===this.isPartial(n)?t.FragmentState.PARTIAL:t.FragmentState.OK:t.FragmentState.APPENDING),s},a.prototype.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},a.prototype.isTimeBuffered=function(e,t,i){for(var n,s,r=0;r<i.length;r++){if(n=i.start(r)-this.bufferPadding,s=i.end(r)+this.bufferPadding,e>=n&&t<=s)return!0;if(t<=n)return!1}return!1},a.prototype.onFragLoaded=function(t){var i=t.frag;e.isFinite(i.sn)&&!i.bitrateTest&&(this.fragments[this.getFragmentKey(i)]={body:i,range:Object.create(null),buffered:!1})},a.prototype.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var i=t.timeRanges[e];t.detectEvictedFragments(e,i)})},a.prototype.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},a.prototype.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},a.prototype.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},a.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},a}(s.default);t.FragmentTracker=a}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/gap-controller.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/buffer-helper.js"),s=i("./src/errors.js"),r=i("./src/events.js"),a=i("./src/utils/logger.js"),o=function(){function e(e,t,i,n){this.config=e,this.media=t,this.fragmentTracker=i,this.hls=n,this.stallReported=!1}return e.prototype.poll=function(e,t){var i=this.config,s=this.media,r=s.currentTime,o=window.performance.now();if(r!==e)return this.stallReported&&(a.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(o-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(s.ended||!s.buffered.length||s.readyState>2||s.seeking&&n.BufferHelper.isBuffered(s,r))){var l=o-this.stalled,d=n.BufferHelper.bufferInfo(s,r,i.maxBufferHole);if(!this.stalled)return void(this.stalled=o);l>=1e3&&this._reportStall(d.len),this._tryFixBufferStall(d,l)}},e.prototype._tryFixBufferStall=function(e,t){var i=this,n=i.config,s=i.fragmentTracker,r=i.media.currentTime,a=s.getPartialFragment(r);a&&this._trySkipBufferHole(a),e.len>.5&&t>1e3*n.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},e.prototype._reportStall=function(e){var t=this,i=t.hls,n=t.media;t.stallReported||(this.stallReported=!0,a.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer"),i.trigger(r.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},e.prototype._trySkipBufferHole=function(e){for(var t=this.hls,i=this.media,n=i.currentTime,o=0,l=0;l<i.buffered.length;l++){var d=i.buffered.start(l);if(n>=o&&n<d)return i.currentTime=Math.max(d,i.currentTime+.1),a.logger.warn("skipping hole, adjusting currentTime from "+n+" to "+i.currentTime),this.stalled=null,void t.trigger(r.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+i.currentTime,frag:e});o=i.buffered.end(l)}},e.prototype._tryNudgeBuffer=function(){var e=this,t=e.config,i=e.hls,n=e.media,o=n.currentTime,l=(this.nudgeRetry||0)+1;if(this.nudgeRetry=l,l<t.nudgeMaxRetry){var d=o+l*t.nudgeOffset;a.logger.log("adjust currentTime from "+o+" to "+d),n.currentTime=d,i.trigger(r.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else a.logger.error("still stuck in high buffer @"+o+" after "+t.nudgeMaxRetry+", raise fatal error"),i.trigger(r.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}();t.default=o},"./src/controller/id3-track-controller.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/demux/id3.js"),o=i("./src/utils/texttrack-utils.js"),l=function(e){function t(t){var i=e.call(this,t,s.default.MEDIA_ATTACHED,s.default.MEDIA_DETACHING,s.default.FRAG_PARSING_METADATA)||this;return i.id3Track=void 0,i.media=void 0,i}return n(t,e),t.prototype.destroy=function(){r.default.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){this.media=e.media,this.media},t.prototype.onMediaDetaching=function(){o.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},t.prototype.getID3Track=function(e){for(var t=0;t<e.length;t++){var i=e[t];if("metadata"===i.kind&&"id3"===i.label)return o.sendAddTrackEvent(i,this.media),i}return this.media.addTextTrack("metadata","id3")},t.prototype.onFragParsingMetadata=function(e){var t=e.frag,i=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,s=0;s<i.length;s++){var r=a.default.getID3Frames(i[s].data);if(r){var o=i[s].pts,l=s<i.length-1?i[s+1].pts:t.endPTS;o===l&&(l+=1e-4);for(var d=0;d<r.length;d++){var u=r[d];if(!a.default.isTimeStampFrame(u)){var c=new n(o,l,"");c.value=u,this.id3Track.addCue(c)}}}}},t}(r.default);t.default=l},"./src/controller/level-controller.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s,r=i("./src/events.js"),a=i("./src/event-handler.js"),o=i("./src/utils/logger.js"),l=i("./src/errors.js"),d=i("./src/utils/codecs.js"),u=i("./src/controller/level-helper.js"),c=(window.performance,function(e){function t(t){var i=e.call(this,t,r.default.MANIFEST_LOADED,r.default.LEVEL_LOADED,r.default.AUDIO_TRACK_SWITCHED,r.default.FRAG_LOADED,r.default.ERROR)||this;return i.canload=!1,i.currentLevelIndex=null,i.manualLevelIndex=-1,i.timer=null,s=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),i}return n(t,e),t.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},t.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},t.prototype.stopLoad=function(){this.canload=!1},t.prototype.onManifestLoaded=function(e){var t,i=[],n=[],a={},c=null,h=!1,p=!1;if(e.levels.forEach(function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,h=h||!!e.videoCodec,p=p||!!e.audioCodec,s&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(c=a[e.bitrate])?c.url.push(e.url):(e.url=[e.url],e.urlId=0,a[e.bitrate]=e,i.push(e)),t&&(t.AUDIO&&(p=!0,u.addGroupId(c||e,"audio",t.AUDIO)),t.SUBTITLES&&u.addGroupId(c||e,"text",t.SUBTITLES))}),h&&p&&(i=i.filter(function(e){return!!e.videoCodec})),i=i.filter(function(e){var t=e.audioCodec,i=e.videoCodec;return(!t||d.isCodecSupportedInMp4(t,"audio"))&&(!i||d.isCodecSupportedInMp4(i,"video"))}),e.audioTracks&&(n=e.audioTracks.filter(function(e){return!e.audioCodec||d.isCodecSupportedInMp4(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),i.length>0){t=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i;for(var f=0;f<i.length;f++)if(i[f].bitrate===t){this._firstLevel=f,o.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(r.default.MANIFEST_PARSED,{levels:i,audioTracks:n,firstLevel:this._firstLevel,stats:e.stats,audio:p,video:h,altAudio:n.some(function(e){return!!e.url})})}else this.hls.trigger(r.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(t.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))},enumerable:!0,configurable:!0}),t.prototype.setLevelInternal=function(e){var t=this._levels,i=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){o.logger.log("switching to level "+e),this.currentLevelIndex=e;var n=t[e];n.level=e,i.trigger(r.default.LEVEL_SWITCHING,n)}var s=t[e],a=s.details;if(!a||a.live){var d=s.urlId;i.trigger(r.default.LEVEL_LOADING,{url:s.url[d],level:e,id:d})}}else i.trigger(r.default.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(t.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(e){this._firstLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startLevel",{get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e},enumerable:!0,configurable:!0}),t.prototype.onError=function(e){if(e.fatal)e.type===l.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,i=!1,n=!1;switch(e.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,n=!0;break;case l.ErrorDetails.LEVEL_LOAD_ERROR:case l.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,i=!0;break;case l.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,i=!0}void 0!==t&&this.recoverLevel(e,t,i,n)}},t.prototype.recoverLevel=function(e,t,i,n){var s,r,a,l=this,d=this.hls.config,u=e.details,c=this._levels[t];if(c.loadError++,c.fragmentError=n,i){if(!(this.levelRetryCount+1<=d.levelLoadingMaxRetry))return o.logger.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);r=Math.min(Math.pow(2,this.levelRetryCount)*d.levelLoadingRetryDelay,d.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return l.loadLevel()},r),e.levelRetry=!0,this.levelRetryCount++,o.logger.warn("level controller, "+u+", retry in "+r+" ms, current retry count is "+this.levelRetryCount)}(i||n)&&((s=c.url.length)>1&&c.loadError<s?(c.urlId=(c.urlId+1)%s,c.details=void 0,o.logger.warn("level controller, "+u+" for level "+t+": switching to redundant URL-id "+c.urlId)):-1===this.manualLevelIndex?(a=0===t?this._levels.length-1:t-1,o.logger.warn("level controller, "+u+": switch to "+a),this.hls.nextAutoLevel=this.currentLevelIndex=a):n&&(o.logger.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},t.prototype.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var i=this._levels[t.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},t.prototype.onLevelLoaded=function(e){var t=this,i=e.level,n=e.details;if(i===this.currentLevelIndex){var s=this._levels[i];if(s.fragmentError||(s.loadError=0,this.levelRetryCount=0),n.live){var r=u.computeReloadInterval(s.details,n,e.stats.trequest);o.logger.log("live playlist, reload in "+Math.round(r)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},r)}else this.clearTimer()}},t.prototype.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var n=-1,s=0;s<i.audioGroupIds.length;s++)if(i.audioGroupIds[s]===t){n=s;break}n!==i.urlId&&(i.urlId=n,this.startLoad())}},t.prototype.loadLevel=function(){if(o.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&e.url.length>0){var t=this.currentLevelIndex,i=e.urlId,n=e.url[i];o.logger.log("Attempt loading level index "+t+" with URL-id "+i),this.hls.trigger(r.default.LEVEL_LOADING,{url:n,level:t,id:i})}}},Object.defineProperty(t.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)},enumerable:!0,configurable:!0}),t}(a.default));t.default=c},"./src/controller/level-helper.js":function(e,t,i){"use strict";(function(e){function n(t,i,n){var s=t[i],r=t[n],a=r.startPTS;e.isFinite(a)?n>i?(s.duration=a-s.start,s.duration<0&&o.logger.warn("negative duration computed for frag "+s.sn+",level "+s.level+", there should be some duration drift between playlist and fragment!")):(r.duration=s.start-a,r.duration<0&&o.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):r.start=n>i?s.start+s.duration:Math.max(s.start-r.duration,0)}function s(t,i,s,r,a,o){var l=s;if(e.isFinite(i.startPTS)){var d=Math.abs(i.startPTS-s);e.isFinite(i.deltaPTS)?i.deltaPTS=Math.max(d,i.deltaPTS):i.deltaPTS=d,l=Math.max(s,i.startPTS),s=Math.min(s,i.startPTS),r=Math.max(r,i.endPTS),a=Math.min(a,i.startDTS),o=Math.max(o,i.endDTS)}var u=s-i.start;i.start=i.startPTS=s,i.maxStartPTS=l,i.endPTS=r,i.startDTS=a,i.endDTS=o,i.duration=r-s;var c,h,p,f=i.sn;if(!t||f<t.startSN||f>t.endSN)return 0;for(c=f-t.startSN,(h=t.fragments)[c]=i,p=c;p>0;p--)n(h,p,p-1);for(p=c;p<h.length-1;p++)n(h,p,p+1);return t.PTSKnown=!0,u}function r(e,t,i){if(e&&t)for(var n=Math.max(e.startSN,t.startSN)-t.startSN,s=Math.min(e.endSN,t.endSN)-t.startSN,r=t.startSN-e.startSN,a=n;a<=s;a++){var o=e.fragments[r+a],l=t.fragments[a];if(!o||!l)break;i(o,l,a)}}function a(e,t){var i=t.startSN-e.startSN,n=e.fragments,s=t.fragments;if(!(i<0||i>n.length))for(var r=0;r<s.length;r++)s[r].start+=n[i].start}Object.defineProperty(t,"__esModule",{value:!0});var o=i("./src/utils/logger.js");t.addGroupId=function(e,t,i){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(i);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(i)}},t.updatePTS=n,t.updateFragPTSDTS=s,t.mergeDetails=function(t,i){i.initSegment&&t.initSegment&&(i.initSegment=t.initSegment);var n,l=0;if(r(t,i,function(t,s){l=t.cc-s.cc,e.isFinite(t.startPTS)&&(s.start=s.startPTS=t.startPTS,s.endPTS=t.endPTS,s.duration=t.duration,s.backtracked=t.backtracked,s.dropped=t.dropped,n=s),i.PTSKnown=!0}),i.PTSKnown){if(l){o.logger.log("discontinuity sliding from playlist, take drift into account");for(var d=i.fragments,u=0;u<d.length;u++)d[u].cc+=l}n?s(i,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):a(t,i),i.PTSKnown=t.PTSKnown}},t.mergeSubtitlePlaylists=function(e,t,i){void 0===i&&(i=0);var n=-1;r(e,t,function(e,t,i){t.start=e.start,n=i});var s=t.fragments;if(n<0)s.forEach(function(e){e.start+=i});else for(var a=n+1;a<s.length;a++)s[a].start=s[a-1].start+s[a-1].duration},t.mapFragmentIntersection=r,t.adjustSliding=a,t.computeReloadInterval=function(e,t,i){var n=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),s=n/2;return e&&t.endSN===e.endSN&&(n=s),i&&(n=Math.max(s,n-(window.performance.now()-i))),Math.round(n)}}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/stream-controller.js":function(e,t,i){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/utils/binary-search.js"),r=i("./src/utils/buffer-helper.js"),a=i("./src/demux/demuxer.js"),o=i("./src/events.js"),l=i("./src/controller/fragment-tracker.js"),d=i("./src/loader/fragment.js"),u=i("./src/loader/playlist-loader.js"),c=i("./src/controller/level-helper.js"),h=i("./src/utils/time-ranges.js"),p=i("./src/errors.js"),f=i("./src/utils/logger.js"),v=i("./src/utils/discontinuities.js"),g=i("./src/controller/fragment-finders.js"),_=i("./src/controller/gap-controller.js"),m=i("./src/controller/base-stream-controller.js"),E=function(t){function i(e,i){var n=t.call(this,e,o.default.MEDIA_ATTACHED,o.default.MEDIA_DETACHING,o.default.MANIFEST_LOADING,o.default.MANIFEST_PARSED,o.default.LEVEL_LOADED,o.default.KEY_LOADED,o.default.FRAG_LOADED,o.default.FRAG_LOAD_EMERGENCY_ABORTED,o.default.FRAG_PARSING_INIT_SEGMENT,o.default.FRAG_PARSING_DATA,o.default.FRAG_PARSED,o.default.ERROR,o.default.AUDIO_TRACK_SWITCHING,o.default.AUDIO_TRACK_SWITCHED,o.default.BUFFER_CREATED,o.default.BUFFER_APPENDED,o.default.BUFFER_FLUSHED)||this;return n.fragmentTracker=i,n.config=e.config,n.audioCodecSwap=!1,n._state=m.State.STOPPED,n.stallReported=!1,n.gapController=null,n}return n(i,t),i.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=i.startLevel;-1===n&&(n=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=n,this.loadedmetadata=!1}t>0&&-1===e&&(f.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=m.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=m.State.STOPPED},i.prototype.stopLoad=function(){this.forceStartLoad=!1,t.prototype.stopLoad.call(this)},i.prototype.doTick=function(){switch(this.state){case m.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case m.State.IDLE:this._doTickIdle();break;case m.State.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=m.State.IDLE);break;case m.State.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),i=this.retryDate;(!i||t>=i||this.media&&this.media.seeking)&&(f.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=m.State.IDLE);break;case m.State.ERROR:case m.State.STOPPED:case m.State.FRAG_LOADING:case m.State.PARSING:case m.State.PARSED:case m.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},i.prototype._doTickIdle=function(){var e=this.hls,t=e.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&t.startFragPrefetch)){var n;n=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var s=e.nextLoadLevel,a=this.levels[s];if(a){var l,d=a.bitrate;l=d?Math.max(8*t.maxBufferSize/d,t.maxBufferLength):t.maxBufferLength,l=Math.min(l,t.maxMaxBufferLength);var u=r.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,n,t.maxBufferHole),c=u.len;if(!(c>=l)){f.logger.trace("buffer length of "+c.toFixed(3)+" is below max of "+l.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=s;var h=a.details;if(!h||h.live&&this.levelLastLoaded!==s)return void(this.state=m.State.WAITING_LEVEL);if(this._streamEnded(u,h)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(o.default.BUFFER_EOS,p),void(this.state=m.State.ENDED)}this._fetchPayloadOrEos(n,u,h)}}}},i.prototype._fetchPayloadOrEos=function(e,t,i){var n=this.fragPrevious,s=this.level,r=i.fragments,a=r.length;if(0!==a){var o,l=r[0].start,d=r[a-1].start+r[a-1].duration,u=t.end;if(i.initSegment&&!i.initSegment.data)o=i.initSegment;else if(i.live){var c=this.config.initialLiveManifestSize;if(a<c)return void f.logger.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+c);if(null===(o=this._ensureFragmentAtLivePoint(i,u,l,d,n,r,a)))return}else u<l&&(o=r[0]);o||(o=this._findFragment(l,n,a,r,u,d,i)),o&&(o.encrypted?(f.logger.log("Loading key for "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+s),this._loadKey(o)):(f.logger.log("Loading "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+s+", currentTime:"+e.toFixed(3)+",bufferEnd:"+u.toFixed(3)),this._loadFragment(o)))}},i.prototype._ensureFragmentAtLivePoint=function(e,t,i,n,r,a,o){var l,d=this.hls.config,u=this.media,c=void 0!==d.liveMaxLatencyDuration?d.liveMaxLatencyDuration:d.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(i-d.maxFragLookUpTolerance,n-c)){var h=this.liveSyncPosition=this.computeLivePosition(i,e);f.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),t=h,u&&u.readyState&&u.duration>h&&(u.currentTime=h),this.nextLoadPosition=h}if(e.PTSKnown&&t>n&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(r)if(e.hasProgramDateTime)f.logger.log("live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),l=g.findFragmentByPDT(a,r.endProgramDateTime,d.maxFragLookUpTolerance);else{var p=r.sn+1;if(p>=e.startSN&&p<=e.endSN){var v=a[p-e.startSN];r.cc===v.cc&&(l=v,f.logger.log("live playlist, switching playlist, load frag with next SN: "+l.sn))}l||(l=s.default.search(a,function(e){return r.cc-e.cc}))&&f.logger.log("live playlist, switching playlist, load frag with same CC: "+l.sn)}l||(l=a[Math.min(o-1,Math.round(o/2))],f.logger.log("live playlist, switching playlist, unknown, load middle frag : "+l.sn))}return l},i.prototype._findFragment=function(e,t,i,n,s,r,a){var o,l=this.hls.config;if(s<r){var d=s>r-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance;o=g.findFragmentByPTS(t,n,s,d)}else o=n[i-1];if(o){var u=o.sn-a.startSN,c=t&&o.level===t.level,h=n[u-1],p=n[u+1];if(t&&o.sn===t.sn)if(c&&!o.backtracked)if(o.sn<a.endSN){var v=t.deltaPTS;v&&v>l.maxBufferHole&&t.dropped&&u?(o=h,f.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(o=p,f.logger.log("SN just loaded, load next one: "+o.sn,o))}else o=null;else o.backtracked&&(p&&p.backtracked?(f.logger.warn("Already backtracked from fragment "+p.sn+", will not backtrack to fragment "+o.sn+". Loading fragment "+p.sn),o=p):(f.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),o.dropped=0,h?(o=h).backtracked=!0:u&&(o=null)))}return o},i.prototype._loadKey=function(e){this.state=m.State.KEY_LOADING,this.hls.trigger(o.default.KEY_LOADING,{frag:e})},i.prototype._loadFragment=function(t){var i=this.fragmentTracker.getState(t);this.fragCurrent=t,this.startFragRequested=!0,e.isFinite(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||i===l.FragmentState.NOT_LOADED||i===l.FragmentState.PARTIAL?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.hls.trigger(o.default.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new a.default(this.hls,"main")),this.state=m.State.FRAG_LOADING):i===l.FragmentState.APPENDING&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},Object.defineProperty(i.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e,f.logger.log("main stream:"+t+"->"+e),this.hls.trigger(o.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},enumerable:!0,configurable:!0}),i.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,u.default.LevelType.MAIN)},Object.defineProperty(i.prototype,"currentLevel",{get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextBufferedFrag",{get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null},enumerable:!0,configurable:!0}),i.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},Object.defineProperty(i.prototype,"nextLevel",{get:function(){var e=this.nextBufferedFrag;return e?e.level:-1},enumerable:!0,configurable:!0}),i.prototype._checkFragmentChanged=function(){var e,t,i=this.media;if(i&&i.readyState&&!1===i.seeking&&((t=i.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),r.BufferHelper.isBuffered(i,t)?e=this.getBufferedFrag(t):r.BufferHelper.isBuffered(i,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var n=e;if(n!==this.fragPlaying){this.hls.trigger(o.default.FRAG_CHANGED,{frag:n});var s=n.level;this.fragPlaying&&this.fragPlaying.level===s||this.hls.trigger(o.default.LEVEL_SWITCHED,{level:s}),this.fragPlaying=n}}},i.prototype.immediateLevelSwitch=function(){if(f.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,i=void 0;t?(i=t.paused,t.pause()):i=!0,this.previouslyPaused=i}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,e.POSITIVE_INFINITY)},i.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,r.BufferHelper.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},i.prototype.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var i,n=void 0,s=void 0;if((i=this.getBufferedFrag(t.currentTime))&&i.startPTS>1&&this.flushMainBuffer(0,i.startPTS-1),t.paused)n=0;else{var r=this.hls.nextLoadLevel,a=this.levels[r],o=this.fragLastKbps;n=o&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*o)+1:0}if((s=this.getBufferedFrag(t.currentTime+n))&&(s=this.followingBufferedFrag(s))){var l=this.fragCurrent;l&&l.loader&&l.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(s.maxStartPTS,e.POSITIVE_INFINITY)}}},i.prototype.flushMainBuffer=function(e,t){this.state=m.State.BUFFER_FLUSHING;var i={startOffset:e,endOffset:t};this.altAudio&&(i.type="video"),this.hls.trigger(o.default.BUFFER_FLUSHING,i)},i.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition),this.gapController=new _.default(i,t,this.fragmentTracker,this.hls)},i.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(f.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.prototype.onMediaSeeked=function(){var t=this.media,i=t?t.currentTime:void 0;e.isFinite(i)&&f.logger.log("media seeked to "+i.toFixed(3)),this.tick()},i.prototype.onManifestLoading=function(){f.logger.log("trigger BUFFER_RESET"),this.hls.trigger(o.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},i.prototype.onManifestParsed=function(e){var t,i=!1,n=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(i=!0),-1!==t.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=i&&n,this.audioCodecSwitch&&f.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var s=this.config;(s.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(s.startPosition)},i.prototype.onLevelLoaded=function(t){var i=t.details,n=t.level,s=this.levels[this.levelLastLoaded],r=this.levels[n],a=i.totalduration,l=0;if(f.logger.log("level "+n+" loaded ["+i.startSN+","+i.endSN+"],duration:"+a),i.live){var d=r.details;d&&i.fragments.length>0?(c.mergeDetails(d,i),l=i.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(l,d),i.PTSKnown&&e.isFinite(l)?f.logger.log("live playlist sliding:"+l.toFixed(3)):(f.logger.log("live playlist - outdated PTS, unknown sliding"),v.alignStream(this.fragPrevious,s,i))):(f.logger.log("live playlist - first load, unknown sliding"),i.PTSKnown=!1,v.alignStream(this.fragPrevious,s,i))}else i.PTSKnown=!1;if(r.details=i,this.levelLastLoaded=n,this.hls.trigger(o.default.LEVEL_UPDATED,{details:i,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var u=i.startTimeOffset;e.isFinite(u)?(u<0&&(f.logger.log("negative start time offset "+u+", count from end of last fragment"),u=l+a+u),f.logger.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u):i.live?(this.startPosition=this.computeLivePosition(l,i),f.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===m.State.WAITING_LEVEL&&(this.state=m.State.IDLE),this.tick()},i.prototype.onKeyLoaded=function(){this.state===m.State.KEY_LOADING&&(this.state=m.State.IDLE,this.tick())},i.prototype.onFragLoaded=function(e){var t=this,i=t.fragCurrent,n=t.hls,s=t.levels,r=t.media,l=e.frag;if(this.state===m.State.FRAG_LOADING&&i&&"main"===l.type&&l.level===i.level&&l.sn===i.sn){var d=e.stats,u=s[i.level],c=u.details;if(this.bitrateTest=!1,this.stats=d,f.logger.log("Loaded "+i.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+i.level),l.bitrateTest&&n.nextLoadLevel)this.state=m.State.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=window.performance.now(),n.trigger(o.default.FRAG_BUFFERED,{stats:d,frag:i,id:"main"}),this.tick();else if("initSegment"===l.sn)this.state=m.State.IDLE,d.tparsed=d.tbuffered=window.performance.now(),c.initSegment.data=e.payload,n.trigger(o.default.FRAG_BUFFERED,{stats:d,frag:i,id:"main"}),this.tick();else{f.logger.log("Parsing "+i.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+i.level+", cc "+i.cc),this.state=m.State.PARSING,this.pendingBuffering=!0,this.appended=!1,l.bitrateTest&&(l.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:l}));var h=!(r&&r.seeking)&&(c.PTSKnown||!c.live),p=c.initSegment?c.initSegment.data:[],v=this._getAudioCodec(u);(this.demuxer=this.demuxer||new a.default(this.hls,"main")).push(e.payload,p,v,u.videoCodec,i,c.totalduration,h)}}this.fragLoadError=0},i.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===m.State.PARSING){var n=e.tracks,s=void 0,r=void 0;if(n.audio&&this.altAudio&&delete n.audio,r=n.audio){var a=this.levels[this.level].audioCodec,l=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(f.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===l.indexOf("firefox")&&(a="mp4a.40.5"),-1!==l.indexOf("android")&&"audio/mpeg"!==r.container&&(a="mp4a.40.2",f.logger.log("Android: force audio codec to "+a)),r.levelCodec=a,r.id=e.id}for(s in(r=n.video)&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=e.id),this.hls.trigger(o.default.BUFFER_CODECS,n),n){r=n[s],f.logger.log("main track:"+s+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var d=r.initSegment;d&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(o.default.BUFFER_APPENDING,{type:s,data:d,parent:"main",content:"initSegment"}))}this.tick()}},i.prototype.onFragParsingData=function(t){var i=this,n=this.fragCurrent,s=t.frag;if(n&&"main"===t.id&&s.sn===n.sn&&s.level===n.level&&("audio"!==t.type||!this.altAudio)&&this.state===m.State.PARSING){var r=this.levels[this.level],a=n;if(e.isFinite(t.endPTS)||(t.endPTS=t.startPTS+n.duration,t.endDTS=t.startDTS+n.duration),!0===t.hasAudio&&a.addElementaryStream(d.default.ElementaryStreamTypes.AUDIO),!0===t.hasVideo&&a.addElementaryStream(d.default.ElementaryStreamTypes.VIDEO),f.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(a.dropped=t.dropped,a.dropped)if(a.backtracked)f.logger.warn("Already backtracked on this fragment, appending with the gap",a.sn);else{var l=r.details;if(!l||a.sn!==l.startSN)return f.logger.warn("missing video frame(s), backtracking fragment",a.sn),this.fragmentTracker.removeFragment(a),a.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=m.State.IDLE,this.fragPrevious=a,void this.tick();f.logger.warn("missing video frame(s) on first frag, appending with gap",a.sn)}else a.backtracked=!1;var u=c.updateFragPTSDTS(r.details,a,t.startPTS,t.endPTS,t.startDTS,t.endDTS),h=this.hls;h.trigger(o.default.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:u,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(e){e&&e.length&&i.state===m.State.PARSING&&(i.appended=!0,i.pendingBuffering=!0,h.trigger(o.default.BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"}))}),this.tick()}},i.prototype.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===m.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=m.State.PARSED,this._checkAppendedParsed())},i.prototype.onAudioTrackSwitching=function(t){var i=!!t.url,n=t.id;if(!i){if(this.mediaBuffer!==this.media){f.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var s=this.fragCurrent;s.loader&&(f.logger.log("switching to main audio track, cancel main fragment load"),s.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=m.State.IDLE}var r=this.hls;r.trigger(o.default.BUFFER_FLUSHING,{startOffset:0,endOffset:e.POSITIVE_INFINITY,type:"audio"}),r.trigger(o.default.AUDIO_TRACK_SWITCHED,{id:n}),this.altAudio=!1}},i.prototype.onAudioTrackSwitched=function(e){var t=e.id,i=!!this.hls.audioTracks[t].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(f.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()},i.prototype.onBufferCreated=function(e){var t,i,n=e.tracks,s=!1;for(var r in n){var a=n[r];"main"===a.id?(i=r,t=a,"video"===r&&(this.videoBuffer=n[r].buffer)):s=!0}s&&t?(f.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},i.prototype.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==m.State.PARSING&&t!==m.State.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},i.prototype._checkAppendedParsed=function(){if(!(this.state!==m.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;f.logger.log("main buffered : "+h.default.toString(t.buffered)),this.fragPrevious=e;var i=this.stats;i.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(o.default.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.state=m.State.IDLE}this.tick()}},i.prototype.onError=function(t){var i=t.frag||this.fragCurrent;if(!i||"main"===i.type){var n=!!this.media&&r.BufferHelper.isBuffered(this.media,this.media.currentTime)&&r.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var s=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);f.logger.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=window.performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=m.State.FRAG_LOADING_WAITING_RETRY}else f.logger.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=m.State.ERROR;break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==m.State.ERROR&&(t.fatal?(this.state=m.State.ERROR,f.logger.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==m.State.WAITING_LEVEL||(this.state=m.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==m.State.PARSING&&this.state!==m.State.PARSED||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=m.State.IDLE):(f.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,e.POSITIVE_INFINITY)))}}},i.prototype._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,f.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},i.prototype._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},i.prototype.onFragLoadEmergencyAborted=function(){this.state=m.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},i.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(d.default.ElementaryStreamTypes.VIDEO,e.buffered),this.state=m.State.IDLE,this.fragPrevious=null},i.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.prototype.computeLivePosition=function(e,t){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-i)},i.prototype._seekToStartPos=function(){var e=this.media,t=e.currentTime,i=e.seeking?t:this.startPosition;t!==i&&(f.logger.log("target start position not buffered, seek to buffered.start(0) "+i+" from current time "+t+" "),e.currentTime=i)},i.prototype._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(f.logger.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},Object.defineProperty(i.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e},enumerable:!0,configurable:!0}),i}(m.default);t.default=E}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/subtitle-stream-controller.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=i("./src/utils/logger.js"),a=i("./src/crypt/decrypter.js"),o=i("./src/utils/buffer-helper.js"),l=i("./src/controller/fragment-finders.js"),d=i("./src/controller/fragment-tracker.js"),u=i("./src/controller/base-stream-controller.js"),c=i("./src/controller/level-helper.js"),h=window.performance,p=function(e){function t(t,i){var n=e.call(this,t,s.default.MEDIA_ATTACHED,s.default.MEDIA_DETACHING,s.default.ERROR,s.default.KEY_LOADED,s.default.FRAG_LOADED,s.default.SUBTITLE_TRACKS_UPDATED,s.default.SUBTITLE_TRACK_SWITCH,s.default.SUBTITLE_TRACK_LOADED,s.default.SUBTITLE_FRAG_PROCESSED,s.default.LEVEL_UPDATED)||this;return n.fragmentTracker=i,n.config=t.config,n.state=u.State.STOPPED,n.tracks=[],n.tracksBuffered=[],n.currentTrackId=-1,n.decrypter=new a.default(t,t.config),n.lastAVStart=0,n._onMediaSeeking=n.onMediaSeeking.bind(n),n}return n(t,e),t.prototype.onSubtitleFragProcessed=function(e){var t=e.frag,i=e.success;if(this.fragPrevious=t,this.state=u.State.IDLE,i){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var s,r=t.start,a=0;a<n.length;a++)if(r>=n[a].start&&r<=n[a].end){s=n[a];break}var o=t.start+t.duration;s?s.end=o:(s={start:r,end:o},n.push(s))}}},t.prototype.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=u.State.IDLE},t.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=u.State.STOPPED},t.prototype.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=u.State.IDLE)},t.prototype.onSubtitleTracksUpdated=function(e){var t=this;r.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(e){t.tracksBuffered[e.id]=[]})},t.prototype.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},t.prototype.onSubtitleTrackLoaded=function(e){var t=e.id,i=e.details,n=this.currentTrackId,s=this.tracks,r=s[n];t>=s.length||t!==n||!r||(i.live&&c.mergeSubtitlePlaylists(r.details,i,this.lastAVStart),r.details=i,this.setInterval(500))},t.prototype.onKeyLoaded=function(){this.state===u.State.KEY_LOADING&&(this.state=u.State.IDLE)},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag.decryptdata,n=e.frag,r=this.hls;if(this.state===u.State.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&i&&i.key&&"AES-128"===i.method){var a=h.now();this.decrypter.decrypt(e.payload,i.key.buffer,i.iv.buffer,function(e){var t=h.now();r.trigger(s.default.FRAG_DECRYPTED,{frag:n,payload:e,stats:{tstart:a,tdecrypt:t}})})}},t.prototype.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},t.prototype.doTick=function(){if(this.media)switch(this.state){case u.State.IDLE:var e=this,t=e.config,i=e.currentTrackId,n=e.fragmentTracker,a=e.media,c=e.tracks;if(!c||!c[i]||!c[i].details)break;var h=t.maxBufferHole,p=t.maxFragLookUpTolerance,f=Math.min(t.maxBufferLength,t.maxMaxBufferLength),v=o.BufferHelper.bufferedInfo(this._getBuffered(),a.currentTime,h),g=v.end,_=v.len,m=c[i].details,E=m.fragments,y=E.length,A=E[y-1].start+E[y-1].duration;if(_>f)return;var S=void 0,b=this.fragPrevious;g<A?(b&&m.hasProgramDateTime&&(S=l.findFragmentByPDT(E,b.endProgramDateTime,p)),S||(S=l.findFragmentByPTS(b,E,g,p))):S=E[y-1],S&&S.encrypted?(r.logger.log("Loading key for "+S.sn),this.state=u.State.KEY_LOADING,this.hls.trigger(s.default.KEY_LOADING,{frag:S})):S&&n.getState(S)===d.FragmentState.NOT_LOADED&&(this.fragCurrent=S,this.state=u.State.FRAG_LOADING,this.hls.trigger(s.default.FRAG_LOADING,{frag:S}))}else this.state=u.State.IDLE},t.prototype.stopLoad=function(){this.lastAVStart=0,e.prototype.stopLoad.call(this)},t.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},t.prototype.onMediaSeeking=function(){this.fragPrevious=null},t}(u.default);t.SubtitleStreamController=p},"./src/controller/subtitle-track-controller.js":function(e,t,i){"use strict";(function(e){function n(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];"subtitles"===n.kind&&n.label&&t.push(e[i])}return t}var s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=i("./src/events.js"),a=i("./src/event-handler.js"),o=i("./src/utils/logger.js"),l=i("./src/controller/level-helper.js"),d=function(t){function i(e){var i=t.call(this,e,r.default.MEDIA_ATTACHED,r.default.MEDIA_DETACHING,r.default.MANIFEST_LOADED,r.default.SUBTITLE_TRACK_LOADED)||this;return i.tracks=[],i.trackId=-1,i.media=null,i.stopped=!0,i.subtitleDisplay=!0,i}return s(i,t),i.prototype.destroy=function(){a.default.prototype.destroy.call(this)},i.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},i.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},i.prototype.onManifestLoaded=function(e){var t=this,i=e.subtitles||[];this.tracks=i,this.hls.trigger(r.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},i.prototype.onSubtitleTrackLoaded=function(e){var t=this,i=e.id,n=e.details,s=this.trackId,r=this.tracks,a=r[s];if(i>=r.length||i!==s||!a||this.stopped)this._clearReloadTimer();else if(o.logger.log("subtitle track "+i+" loaded"),n.live){var d=l.computeReloadInterval(a.details,n,e.stats.trequest);o.logger.log("Reloading live subtitle playlist in "+d+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},d)}else this._clearReloadTimer()},i.prototype.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},i.prototype.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},Object.defineProperty(i.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))},enumerable:!0,configurable:!0}),i.prototype._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},i.prototype._loadCurrentTrack=function(){var e=this,t=e.trackId,i=e.tracks,n=e.hls,s=i[t];t<0||!s||s.details&&!s.details.live||(o.logger.log("Loading subtitle track "+t),n.trigger(r.default.SUBTITLE_TRACK_LOADING,{url:s.url,id:t}))},i.prototype._toggleTrackModes=function(e){var t=this,i=t.media,s=t.subtitleDisplay,r=t.trackId;if(i){var a=n(i.textTracks);if(-1===e)[].slice.call(a).forEach(function(e){e.mode="disabled"});else{var o=a[r];o&&(o.mode="disabled")}var l=a[e];l&&(l.mode=s?"showing":"hidden")}},i.prototype._setSubtitleTrackInternal=function(t){var i=this.hls,n=this.tracks;!e.isFinite(t)||t<-1||t>=n.length||(this.trackId=t,o.logger.log("Switching to subtitle track "+t),i.trigger(r.default.SUBTITLE_TRACK_SWITCH,{id:t}),this._loadCurrentTrack())},i.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=n(this.media.textTracks),i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack=e}},i}(a.default);t.default=d}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/timeline-controller.js":function(e,t,i){"use strict";(function(e){function n(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function s(e,t,i,n){return Math.min(t,n)-Math.max(e,i)}var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/events.js"),o=i("./src/event-handler.js"),l=i("./src/utils/cea-608-parser.js"),d=i("./src/utils/output-filter.js"),u=i("./src/utils/webvtt-parser.js"),c=i("./src/utils/logger.js"),h=i("./src/utils/texttrack-utils.js"),p=function(t){function i(e){var i=t.call(this,e,a.default.MEDIA_ATTACHING,a.default.MEDIA_DETACHING,a.default.FRAG_PARSING_USERDATA,a.default.FRAG_DECRYPTED,a.default.MANIFEST_LOADING,a.default.MANIFEST_LOADED,a.default.FRAG_LOADED,a.default.LEVEL_SWITCHING,a.default.INIT_PTS_FOUND)||this;if(i.hls=e,i.config=e.config,i.enabled=!0,i.Cues=e.config.cueHandler,i.textTracks=[],i.tracks=[],i.unparsedVttFrags=[],i.initPTS=[],i.cueRanges=[],i.captionsTracks={},i.captionsProperties={textTrack1:{label:i.config.captionsTextTrack1Label,languageCode:i.config.captionsTextTrack1LanguageCode},textTrack2:{label:i.config.captionsTextTrack2Label,languageCode:i.config.captionsTextTrack2LanguageCode}},i.config.enableCEA708Captions){var n=new d.default(i,"textTrack1"),s=new d.default(i,"textTrack2");i.cea608Parser=new l.default(0,n,s)}return i}return r(i,t),i.prototype.addCues=function(e,t,i,n){for(var r=this.cueRanges,a=!1,o=r.length;o--;){var l=r[o],d=s(l[0],l[1],t,i);if(d>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],i),a=!0,d/(i-t)>.5))return}a||r.push([t,i]),this.Cues.newCue(this.captionsTracks[e],t,i,n)},i.prototype.onInitPtsFound=function(e){var t=this;if("main"===e.id&&(this.initPTS[e.frag.cc]=e.initPTS),this.unparsedVttFrags.length){var i=this.unparsedVttFrags;this.unparsedVttFrags=[],i.forEach(function(e){t.onFragLoaded(e)})}},i.prototype.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var n=t.textTracks[i];if(n[e])return n}return null},i.prototype.createCaptionsTrack=function(e){var t=this.captionsProperties[e],i=t.label,n=t.languageCode,s=this.captionsTracks;if(!s[e]){var r=this.getExistingTrack(e);if(r)s[e]=r,h.clearCurrentCues(s[e]),h.sendAddTrackEvent(s[e],this.media);else{var a=this.createTextTrack("captions",i,n);a&&(a[e]=!0,s[e]=a)}}},i.prototype.createTextTrack=function(e,t,i){var n=this.media;if(n)return n.addTextTrack(e,t,i)},i.prototype.destroy=function(){o.default.prototype.destroy.call(this)},i.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.prototype.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){h.clearCurrentCues(e[t]),delete e[t]})},i.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},i.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)h.clearCurrentCues(t[i])}},i.prototype.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,s){var r;if(s<i.length){for(var a=null,o=0;o<i.length;o++)if(n(i[o],e)){a=i[o];break}a&&(r=a)}r||(r=t.createTextTrack("subtitles",e.name,e.lang)),e.default?r.mode=t.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",t.textTracks.push(r)})}},i.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},i.prototype.onFragLoaded=function(t){var i=t.frag,n=t.payload;if("main"===i.type){var s=i.sn;if(s!==this.lastSn+1){var r=this.cea608Parser;r&&r.reset()}this.lastSn=s}else if("subtitle"===i.type)if(n.byteLength){if(!e.isFinite(this.initPTS[i.cc]))return this.unparsedVttFrags.push(t),void(this.initPTS.length&&this.hls.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i}));var o=i.decryptdata;null!=o&&null!=o.key&&"AES-128"===o.method||this._parseVTTs(i,n)}else this.hls.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i})},i.prototype._parseVTTs=function(e,t){var i=this.vttCCs;i[e.cc]||(i[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var n=this.textTracks,s=this.hls;u.default.parse(t,this.initPTS[e.cc],i,e.cc,function(t){var i=n[e.level];"disabled"!==i.mode?(t.forEach(function(e){if(!i.cues.getCueById(e.id))try{i.addCue(e)}catch(n){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}),s.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})):s.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},function(t){c.logger.log("Failed to parse VTT cue: "+t),s.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},i.prototype.onFragDecrypted=function(t){var i=t.payload,n=t.frag;if("subtitle"===n.type){if(!e.isFinite(this.initPTS[n.cc]))return void this.unparsedVttFrags.push(t);this._parseVTTs(n,i)}},i.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var i=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,i)}},i.prototype.extractCea608Data=function(e){for(var t,i,n,s=31&e[0],r=2,a=[],o=0;o<s;o++)t=e[r++],i=127&e[r++],n=127&e[r++],0===i&&0===n||0!=(4&t)&&0==(3&t)&&(a.push(i),a.push(n));return a},i}(o.default);t.default=p}).call(this,i("./src/polyfills/number.js").Number)},"./src/crypt/aes-crypto.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}();t.default=n},"./src/crypt/aes-decryptor.js":function(e,t,i){"use strict";function n(e){var t=e.byteLength,i=t&&new DataView(e).getUint8(t-1);return i?e.slice(0,t-i):e}Object.defineProperty(t,"__esModule",{value:!0}),t.removePadding=n;var s=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),n=0;n<4;n++)i[n]=t.getUint32(4*n);return i},e.prototype.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,n=i[0],s=i[1],r=i[2],a=i[3],o=this.invSubMix,l=o[0],d=o[1],u=o[2],c=o[3],h=new Uint32Array(256),p=0,f=0,v=0;for(v=0;v<256;v++)h[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var g=f^f<<1^f<<2^f<<3^f<<4;g=g>>>8^255&g^99,e[p]=g,t[g]=p;var _=h[p],m=h[_],E=h[m],y=257*h[g]^16843008*g;n[p]=y<<24|y>>>8,s[p]=y<<16|y>>>16,r[p]=y<<8|y>>>24,a[p]=y,y=16843009*E^65537*m^257*_^16843008*p,l[g]=y<<24|y>>>8,d[g]=y<<16|y>>>16,u[g]=y<<8|y>>>24,c[g]=y,p?(p=_^h[h[h[E^_]]],f^=h[h[f]]):p=f=1}},e.prototype.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,n=0;n<t.length&&i;)i=t[n]===this.key[n],n++;if(!i){this.key=t;var s=this.keySize=t.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);var r,a,o,l,d=this.ksRows=4*(s+6+1),u=this.keySchedule=new Uint32Array(d),c=this.invKeySchedule=new Uint32Array(d),h=this.sBox,p=this.rcon,f=this.invSubMix,v=f[0],g=f[1],_=f[2],m=f[3];for(r=0;r<d;r++)r<s?o=u[r]=t[r]:(l=o,r%s==0?(l=h[(l=l<<8|l>>>24)>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=p[r/s|0]<<24):s>6&&r%s==4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),u[r]=o=(u[r-s]^l)>>>0);for(a=0;a<d;a++)r=d-a,l=3&a?u[r]:u[r-4],c[a]=a<4||r<=4?l:v[h[l>>>24]]^g[h[l>>>16&255]]^_[h[l>>>8&255]]^m[h[255&l]],c[a]=c[a]>>>0}},e.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},e.prototype.decrypt=function(e,t,i,s){for(var r,a,o,l,d,u,c,h,p,f,v,g,_,m,E=this.keySize+6,y=this.invKeySchedule,A=this.invSBox,S=this.invSubMix,b=S[0],T=S[1],D=S[2],C=S[3],I=this.uint8ArrayToUint32Array_(i),R=I[0],P=I[1],M=I[2],O=I[3],L=new Int32Array(e),w=new Int32Array(L.length),N=this.networkToHostOrderSwap;t<L.length;){for(p=N(L[t]),f=N(L[t+1]),v=N(L[t+2]),g=N(L[t+3]),d=p^y[0],u=g^y[1],c=v^y[2],h=f^y[3],_=4,m=1;m<E;m++)r=b[d>>>24]^T[u>>16&255]^D[c>>8&255]^C[255&h]^y[_],a=b[u>>>24]^T[c>>16&255]^D[h>>8&255]^C[255&d]^y[_+1],o=b[c>>>24]^T[h>>16&255]^D[d>>8&255]^C[255&u]^y[_+2],l=b[h>>>24]^T[d>>16&255]^D[u>>8&255]^C[255&c]^y[_+3],d=r,u=a,c=o,h=l,_+=4;r=A[d>>>24]<<24^A[u>>16&255]<<16^A[c>>8&255]<<8^A[255&h]^y[_],a=A[u>>>24]<<24^A[c>>16&255]<<16^A[h>>8&255]<<8^A[255&d]^y[_+1],o=A[c>>>24]<<24^A[h>>16&255]<<16^A[d>>8&255]<<8^A[255&u]^y[_+2],l=A[h>>>24]<<24^A[d>>16&255]<<16^A[u>>8&255]<<8^A[255&c]^y[_+3],_+=3,w[t]=N(r^R),w[t+1]=N(l^P),w[t+2]=N(o^M),w[t+3]=N(a^O),R=p,P=f,M=v,O=g,t+=4}return s?n(w.buffer):w.buffer},e.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}();t.default=s},"./src/crypt/decrypter.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/crypt/aes-crypto.js"),s=i("./src/crypt/fast-aes-key.js"),r=i("./src/crypt/aes-decryptor.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=i("./src/events.js"),d=i("./src/utils/get-self-scope.js").getSelfScope(),u=function(){function e(e,t,i){var n=(void 0===i?{}:i).removePKCS7Padding,s=void 0===n||n;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=s,s)try{var r=d.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}return e.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.prototype.decrypt=function(e,t,i,a){var l=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(o.logger.log("JS AES decrypt"),this.logEnabled=!1);var d=this.decryptor;d||(this.decryptor=d=new r.default),d.expandKey(t),a(d.decrypt(e,0,i,this.removePKCS7Padding))}else{this.logEnabled&&(o.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var u=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new s.default(u,t)),this.fastAesKey.expandKey().then(function(s){new n.default(u,i).decrypt(e,s).catch(function(n){l.onWebCryptoError(n,e,t,i,a)}).then(function(e){a(e)})}).catch(function(n){l.onWebCryptoError(n,e,t,i,a)})}},e.prototype.onWebCryptoError=function(e,t,i,n,s){this.config.enableSoftwareAES?(o.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,i,n,s)):(o.logger.error("decrypting error : "+e.message),this.observer.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},e.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.default=u},"./src/crypt/fast-aes-key.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();t.default=n},"./src/demux/aacdemuxer.js":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/demux/adts.js"),s=i("./src/utils/logger.js"),r=i("./src/demux/id3.js"),a=function(){function t(e,t,i){this.observer=e,this.config=i,this.remuxer=t}return t.prototype.resetInitSegment=function(e,t,i,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(e){if(!e)return!1;for(var t=(r.default.getID3Data(e,0)||[]).length,i=e.length;t<i;t++)if(n.probe(e,t))return s.logger.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function(t,i,a,o){for(var l=this._audioTrack,d=r.default.getID3Data(t,0)||[],u=r.default.getTimeStamp(d),c=e.isFinite(u)?90*u:9e4*i,h=0,p=c,f=t.length,v=d.length,g=[{pts:p,dts:p,data:d}];v<f-1;)if(n.isHeader(t,v)&&v+5<f){n.initTrackConfig(l,this.observer,t,v,l.manifestCodec);var _=n.appendFrame(l,t,v,c,h);if(!_){s.logger.log("Unable to parse AAC frame");break}v+=_.length,p=_.sample.pts,h++}else r.default.isHeader(t,v)?(d=r.default.getID3Data(t,v),g.push({pts:p,dts:p,data:d}),v+=d.length):v++;this.remuxer.remux(l,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},i,a,o)},t.prototype.destroy=function(){},t}();t.default=a}).call(this,i("./src/polyfills/number.js").Number)},"./src/demux/adts.js":function(e,t,i){"use strict";function n(e,t,i,n){var s,r,a,o,l,h=navigator.userAgent.toLowerCase(),p=n,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return s=1+((192&t[i+2])>>>6),(r=(60&t[i+2])>>>2)>f.length-1?void e.trigger(c.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+r}):(o=(1&t[i+2])<<2,o|=(192&t[i+3])>>>6,d.logger.log("manifest codec:"+n+",ADTS data:type:"+s+",sampleingIndex:"+r+"["+f[r]+"Hz],channelConfig:"+o),/firefox/i.test(h)?r>=6?(s=5,l=new Array(4),a=r-3):(s=2,l=new Array(2),a=r):-1!==h.indexOf("android")?(s=2,l=new Array(2),a=r):(s=5,l=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&r>=6?a=r-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(r>=6&&1===o||/vivaldi/i.test(h))||!n&&1===o)&&(s=2,l=new Array(2)),a=r)),l[0]=s<<3,l[0]|=(14&r)>>1,l[1]|=(1&r)<<7,l[1]|=o<<3,5===s&&(l[1]|=(14&a)>>1,l[2]=(1&a)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:f[r],channelCount:o,codec:"mp4a.40."+s,manifestCodec:p})}function s(e,t){return 255===e[t]&&240==(246&e[t+1])}function r(e,t){return 1&e[t+1]?7:9}function a(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function o(e){return 9216e4/e}function l(e,t,i,n,s){var o,l,d=e.length;if(o=r(e,t),l=a(e,t),(l-=o)>0&&t+o+l<=d)return{headerLength:o,frameLength:l,stamp:i+n*s}}Object.defineProperty(t,"__esModule",{value:!0});var d=i("./src/utils/logger.js"),u=i("./src/errors.js"),c=i("./src/events.js");t.getAudioConfig=n,t.isHeaderPattern=s,t.getHeaderLength=r,t.getFullFrameLength=a,t.isHeader=function(e,t){return!!(t+1<e.length&&s(e,t))},t.probe=function(e,t){if(t+1<e.length&&s(e,t)){var i=r(e,t);t+5<e.length&&(i=a(e,t));var n=t+i;if(n===e.length||n+1<e.length&&s(e,n))return!0}return!1},t.initTrackConfig=function(e,t,i,s,r){if(!e.samplerate){var a=n(t,i,s,r);e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,d.logger.log("parsed codec:"+e.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)}},t.getFrameDuration=o,t.parseFrameHeader=l,t.appendFrame=function(e,t,i,n,s){var r=l(t,i,n,s,o(e.samplerate));if(r){var a=r.stamp,d=r.headerLength,u=r.frameLength,c={unit:t.subarray(i+d,i+d+u),pts:a,dts:a};return e.samples.push(c),e.len+=u,{sample:c,length:u+d}}}},"./src/demux/demuxer-inline.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=i("./src/events.js"),r=i("./src/errors.js"),a=i("./src/crypt/decrypter.js"),o=i("./src/demux/aacdemuxer.js"),l=i("./src/demux/mp4demuxer.js"),d=i("./src/demux/tsdemuxer.js"),u=i("./src/demux/mp3demuxer.js"),c=i("./src/remux/mp4-remuxer.js"),h=i("./src/remux/passthrough-remuxer.js"),p=i("./src/utils/get-self-scope.js"),f=i("./src/utils/logger.js"),v=p.getSelfScope();try{n=v.performance.now.bind(v.performance)}catch(e){f.logger.debug("Unable to use Performance API on this environment"),n=v.Date.now}var g=function(){function e(e,t,i,n){this.observer=e,this.typeSupported=t,this.config=i,this.vendor=n}return e.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},e.prototype.push=function(e,t,i,r,o,l,d,u,c,h,p,f){var v=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var g=this.decrypter;null==g&&(g=this.decrypter=new a.default(this.observer,this.config));var _=n();g.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var a=n();v.observer.trigger(s.default.FRAG_DECRYPTED,{stats:{tstart:_,tdecrypt:a}}),v.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),r,o,l,d,u,c,h,p,f)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),r,o,l,d,u,c,h,p,f)},e.prototype.pushDecrypted=function(e,t,i,n,a,p,f,v,g,_,m,E){var y=this.demuxer;if(!y||(f||v)&&!this.probe(e)){for(var A=this.observer,S=this.typeSupported,b=this.config,T=[{demux:d.default,remux:c.default},{demux:l.default,remux:h.default},{demux:o.default,remux:c.default},{demux:u.default,remux:c.default}],D=0,C=T.length;D<C;D++){var I=T[D],R=I.demux.probe;if(R(e)){var P=this.remuxer=new I.remux(A,b,S,this.vendor);y=new I.demux(A,P,b,S),this.probe=R;break}}if(!y)return void A.trigger(s.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=y}var M=this.remuxer;(f||v)&&(y.resetInitSegment(i,n,a,_),M.resetInitSegment()),f&&(y.resetTimeStamp(E),M.resetTimeStamp(E)),"function"==typeof y.setDecryptData&&y.setDecryptData(t),y.append(e,p,g,m)},e}();t.default=g},"./src/demux/demuxer-worker.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/demux/demuxer-inline.js"),s=i("./src/events.js"),r=i("./src/utils/logger.js"),a=i("./node_modules/node-libs-browser/node_modules/events/events.js");t.default=function(e){var t=new a.EventEmitter;t.trigger=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];t.emit.apply(t,[e,e].concat(i))},t.off=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];t.removeListener.apply(t,[e].concat(i))};var i=function(t,i){e.postMessage({event:t,data:i})};e.addEventListener("message",function(s){var a=s.data;switch(a.cmd){case"init":var o=JSON.parse(a.config);e.demuxer=new n.default(t,a.typeSupported,o,a.vendor),r.enableLogs(o.debug),i("init",null);break;case"demux":e.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}}),t.on(s.default.FRAG_DECRYPTED,i),t.on(s.default.FRAG_PARSING_INIT_SEGMENT,i),t.on(s.default.FRAG_PARSED,i),t.on(s.default.ERROR,i),t.on(s.default.FRAG_PARSING_METADATA,i),t.on(s.default.FRAG_PARSING_USERDATA,i),t.on(s.default.INIT_PTS_FOUND,i),t.on(s.default.FRAG_PARSING_DATA,function(t,i){var n=[],s={event:t,data:i};i.data1&&(s.data1=i.data1.buffer,n.push(i.data1.buffer),delete i.data1),i.data2&&(s.data2=i.data2.buffer,n.push(i.data2.buffer),delete i.data2),e.postMessage(s,n)})}},"./src/demux/demuxer.js":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i("./node_modules/webworkify-webpack/index.js"),s=i("./src/events.js"),r=i("./src/demux/demuxer-inline.js"),a=i("./src/utils/logger.js"),o=i("./src/errors.js"),l=i("./src/utils/mediasource-helper.js"),d=i("./src/utils/get-self-scope.js"),u=i("./src/observer.js"),c=d.getSelfScope(),h=l.getMediaSource(),p=function(){function t(e,t){var i=this;this.hls=e,this.id=t;var l=this.observer=new u.Observer,d=e.config,p=function(t,n){(n=n||{}).frag=i.frag,n.id=i.id,e.trigger(t,n)};l.on(s.default.FRAG_DECRYPTED,p),l.on(s.default.FRAG_PARSING_INIT_SEGMENT,p),l.on(s.default.FRAG_PARSING_DATA,p),l.on(s.default.FRAG_PARSED,p),l.on(s.default.ERROR,p),l.on(s.default.FRAG_PARSING_METADATA,p),l.on(s.default.FRAG_PARSING_USERDATA,p),l.on(s.default.INIT_PTS_FOUND,p);var f={mp4:h.isTypeSupported("video/mp4"),mpeg:h.isTypeSupported("audio/mpeg"),mp3:h.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(d.enableWorker&&"undefined"!=typeof Worker){a.logger.log("demuxing in webworker");var g=void 0;try{g=this.w=n("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(t){e.trigger(s.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},g.postMessage({cmd:"init",typeSupported:f,vendor:v,id:t,config:JSON.stringify(d)})}catch(e){a.logger.warn("Error in worker:",e),a.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),g&&c.URL.revokeObjectURL(g.objectURL),this.demuxer=new r.default(l,f,d,v),this.w=void 0}}else this.demuxer=new r.default(l,f,d,v)}return t.prototype.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},t.prototype.push=function(t,i,n,s,r,o,l,d){var u=this.w,c=e.isFinite(r.startPTS)?r.startPTS:r.start,h=r.decryptdata,p=this.frag,f=!(p&&r.cc===p.cc),v=!(p&&r.level===p.level),g=p&&r.sn===p.sn+1,_=!v&&g;if(f&&a.logger.log(this.id+":discontinuity detected"),v&&a.logger.log(this.id+":switch detected"),this.frag=r,u)u.postMessage({cmd:"demux",data:t,decryptdata:h,initSegment:i,audioCodec:n,videoCodec:s,timeOffset:c,discontinuity:f,trackSwitch:v,contiguous:_,duration:o,accurateTimeOffset:l,defaultInitPTS:d},t instanceof ArrayBuffer?[t]:[]);else{var m=this.demuxer;m&&m.push(t,h,i,n,s,c,f,v,_,o,l,d)}},t.prototype.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":c.URL.revokeObjectURL(this.w.objectURL);break;case s.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},t}();t.default=p}).call(this,i("./src/polyfills/number.js").Number)},"./src/demux/exp-golomb.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/logger.js"),s=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,n=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");n.set(e.subarray(i,i+s)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s},e.prototype.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i},e.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var t,i=8,n=8;for(t=0;t<e;t++)0!==n&&(n=(i+this.readEG()+256)%256),i=0===n?i:n},e.prototype.readSPS=function(){var e,t,i,n,s,r,a,o=0,l=0,d=0,u=0,c=this.readUByte.bind(this),h=this.readBits.bind(this),p=this.readUEG.bind(this),f=this.readBoolean.bind(this),v=this.skipBits.bind(this),g=this.skipEG.bind(this),_=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);if(c(),e=c(),h(5),v(3),c(),_(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var E=p();if(3===E&&v(1),_(),_(),v(1),f())for(r=3!==E?8:12,a=0;a<r;a++)f()&&m(a<6?16:64)}_();var y=p();if(0===y)p();else if(1===y)for(v(1),g(),g(),t=p(),a=0;a<t;a++)g();_(),v(1),i=p(),n=p(),0===(s=h(1))&&v(1),v(1),f()&&(o=p(),l=p(),d=p(),u=p());var A=[1,1];if(f()&&f())switch(c()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:A=[c()<<8|c(),c()<<8|c()]}return{width:Math.ceil(16*(i+1)-2*o-2*l),height:(2-s)*(n+1)*16-(s?2:4)*(d+u),pixelRatio:A}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();t.default=s},"./src/demux/id3.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,i){for(var n=i,s=0;e.isHeader(t,i);)s+=10,s+=e._readSize(t,i+6),e.isFooter(t,i+10)&&(s+=10),i+=s;if(s>0)return t.subarray(n,n+s)},e._readSize=function(e,t){var i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,(i|=(127&e[t+2])<<7)|127&e[t+3]},e.getTimeStamp=function(t){for(var i=e.getID3Frames(t),n=0;n<i.length;n++){var s=i[n];if(e.isTimeStampFrame(s))return e._readTimeStamp(s)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),n=e._readSize(t,4);return{type:i,size:n,data:t.subarray(10,10+n)}},e.getID3Frames=function(t){for(var i=0,n=[];e.isHeader(t,i);){for(var s=e._readSize(t,i+6),r=(i+=10)+s;i+8<r;){var a=e._getFrameData(t.subarray(i)),o=e._decodeFrame(a);o&&n.push(o),i+=a.size+10}e.isFooter(t,i)&&(i+=10)}return n},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),i=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,i&&(n+=47721858.84),Math.round(n)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var i=e._utf8ArrayToStr(t.data,!0),n=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:n.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var i=1,n=e._utf8ArrayToStr(t.data.subarray(i));i+=n.length+1;var s=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:n,data:s}}var r=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:r}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var i=1,n=e._utf8ArrayToStr(t.data.subarray(i));i+=n.length+1;var s=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:n,data:s}}var r=e._utf8ArrayToStr(t.data);return{key:t.type,data:r}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);for(var i,n,s,r=e.length,a="",o=0;o<r;){if(0===(i=e[o++])&&t)return a;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:n=e[o++],a+=String.fromCharCode((31&i)<<6|63&n);break;case 14:n=e[o++],s=e[o++],a+=String.fromCharCode((15&i)<<12|(63&n)<<6|(63&s)<<0)}}return a},e}(),s=n._utf8ArrayToStr;t.utf8ArrayToStr=s,t.default=n},"./src/demux/mp3demuxer.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/demux/id3.js"),s=i("./src/utils/logger.js"),r=i("./src/demux/mpegaudio.js"),a=function(){function e(e,t,i){this.observer=e,this.config=i,this.remuxer=t}return e.prototype.resetInitSegment=function(e,t,i,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){var t,i,a=n.default.getID3Data(e,0);if(a&&void 0!==n.default.getTimeStamp(a))for(t=a.length,i=Math.min(e.length-1,t+100);t<i;t++)if(r.default.probe(e,t))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},e.prototype.append=function(e,t,i,s){for(var a=n.default.getID3Data(e,0),o=n.default.getTimeStamp(a),l=o?90*o:9e4*t,d=a.length,u=e.length,c=0,h=0,p=this._audioTrack,f=[{pts:l,dts:l,data:a}];d<u;)if(r.default.isHeader(e,d)){var v=r.default.appendFrame(p,e,d,l,c);if(!v)break;d+=v.length,h=v.sample.pts,c++}else n.default.isHeader(e,d)?(a=n.default.getID3Data(e,d),f.push({pts:h,dts:h,data:a}),d+=a.length):d++;this.remuxer.remux(p,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,i,s)},e.prototype.destroy=function(){},e}();t.default=a},"./src/demux/mp4demuxer.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/logger.js"),s=i("./src/events.js"),r=Math.pow(2,32)-1,a=function(){function e(e,t){this.observer=e,this.remuxer=t}return e.prototype.resetTimeStamp=function(e){this.initPTS=e},e.prototype.resetInitSegment=function(t,i,n,r){if(t&&t.byteLength){var a=this.initData=e.parseInitSegment(t);null==i&&(i="mp4a.40.5"),null==n&&(n="avc1.42e01e");var o={};a.audio&&a.video?o.audiovideo={container:"video/mp4",codec:i+","+n,initSegment:r?t:null}:(a.audio&&(o.audio={container:"audio/mp4",codec:i,initSegment:r?t:null}),a.video&&(o.video={container:"video/mp4",codec:n,initSegment:r?t:null})),this.observer.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else i&&(this.audioCodec=i),n&&(this.videoCodec=n)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<8|e[t+1];return i<0?65536+i:i},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return i<0?4294967296+i:i},e.writeUint32=function(e,t,i){e.data&&(t+=e.start,e=e.data),e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i},e.findBox=function(t,i){var n,s,r,a,o,l,d=[];if(t.data?(o=t.start,r=t.end,t=t.data):(o=0,r=t.byteLength),!i.length)return null;for(n=o;n<r;)l=(s=e.readUint32(t,n))>1?n+s:r,e.bin2str(t.subarray(n+4,n+8))===i[0]&&(1===i.length?d.push({data:t,start:n+8,end:l}):(a=e.findBox({data:t,start:n+8,end:l},i.slice(1))).length&&(d=d.concat(a))),n=l;return d},e.parseSegmentIndex=function(t){var i,n=e.findBox(t,["moov"])[0],s=n?n.end:null,r=0,a=e.findBox(t,["sidx"]);if(!a||!a[0])return null;i=[];var o=(a=a[0]).data[0];r=0===o?8:16;var l=e.readUint32(a,r);r+=4,r+=0===o?8:16,r+=2;var d=a.end+0,u=e.readUint16(a,r);r+=2;for(var c=0;c<u;c++){var h=r,p=e.readUint32(a,h);h+=4;var f=2147483647&p;if(1==(2147483648&p)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var v=e.readUint32(a,h);h+=4,i.push({referenceSize:f,subsegmentDuration:v,info:{duration:v/l,start:d,end:d+f-1}}),d+=f,r=h+=4}return{earliestPresentationTime:0,timescale:l,version:o,referencesCount:u,references:i,moovEndOffset:s}},e.parseInitSegment=function(t){var i=[];return e.findBox(t,["moov","trak"]).forEach(function(t){var s=e.findBox(t,["tkhd"])[0];if(s){var r=s.data[s.start],a=0===r?12:20,o=e.readUint32(s,a),l=e.findBox(t,["mdia","mdhd"])[0];if(l){a=0===(r=l.data[l.start])?12:20;var d=e.readUint32(l,a),u=e.findBox(t,["mdia","hdlr"])[0];if(u){var c={soun:"audio",vide:"video"}[e.bin2str(u.data.subarray(u.start+8,u.start+12))];if(c){var h=e.findBox(t,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var p=e.bin2str(h.data.subarray(h.start+12,h.start+16));n.logger.log("MP4Demuxer:"+c+":"+p+" found")}i[o]={timescale:d,type:c},i[c]={timescale:d,id:o}}}}}}),i},e.getStartDTS=function(t,i){var n,s,r;return n=e.findBox(i,["moof","traf"]),s=[].concat.apply([],n.map(function(i){return e.findBox(i,["tfhd"]).map(function(n){var s,r;return s=e.readUint32(n,4),r=t[s].timescale||9e4,e.findBox(i,["tfdt"]).map(function(t){var i,n;return i=t.data[t.start],n=e.readUint32(t,4),1===i&&(n*=Math.pow(2,32),n+=e.readUint32(t,8)),n})[0]/r})})),r=Math.min.apply(null,s),isFinite(r)?r:0},e.offsetStartDTS=function(t,i,n){e.findBox(i,["moof","traf"]).map(function(i){return e.findBox(i,["tfhd"]).map(function(s){var a=e.readUint32(s,4),o=t[a].timescale||9e4;e.findBox(i,["tfdt"]).map(function(t){var i=t.data[t.start],s=e.readUint32(t,4);if(0===i)e.writeUint32(t,4,s-n*o);else{s*=Math.pow(2,32),s+=e.readUint32(t,8),s-=n*o,s=Math.max(s,0);var a=Math.floor(s/(r+1)),l=Math.floor(s%(r+1));e.writeUint32(t,4,a),e.writeUint32(t,8,l)}})})})},e.prototype.append=function(t,i,n,r){var a=this.initData;a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),a=this.initData);var o,l=this.initPTS;if(void 0===l){var d=e.getStartDTS(a,t);this.initPTS=l=d-i,this.observer.trigger(s.default.INIT_PTS_FOUND,{initPTS:l})}e.offsetStartDTS(a,t,l),o=e.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,o,n,r,t)},e.prototype.destroy=function(){},e}();t.default=a},"./src/demux/mpegaudio.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,i,n,s){if(!(i+24>t.length)){var r=this.parseHeader(t,i);if(r&&i+r.frameLength<=t.length){var a=n+s*(9e4*r.samplesPerFrame/r.sampleRate),o={unit:t.subarray(i,i+r.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=r.channelCount,e.samplerate=r.sampleRate,e.samples.push(o),e.len+=r.frameLength,{sample:o,length:r.frameLength}}}},parseHeader:function(e,t){var i=e[t+1]>>3&3,s=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3,o=e[t+2]>>1&1;if(1!==i&&0!==r&&15!==r&&3!==a){var l=3===i?3-s:3===s?3:4,d=1e3*n.BitratesMap[14*l+r-1],u=3===i?0:2===i?1:2,c=n.SamplingRateMap[3*u+a],h=e[t+3]>>6==3?1:2,p=n.SamplesCoefficients[i][s],f=n.BytesInSlot[s],v=8*p*f;return{sampleRate:c,channelCount:h,frameLength:parseInt(p*d/c+o,10)*f,samplesPerFrame:v}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var i=this.parseHeader(e,t),n=4;i&&i.frameLength&&(n=i.frameLength);var s=t+n;if(s===e.length||s+1<e.length&&this.isHeaderPattern(e,s))return!0}return!1}};t.default=n},"./src/demux/sample-aes.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/crypt/decrypter.js"),s=function(){function e(e,t,i,s){this.decryptdata=i,this.discardEPB=s,this.decrypter=new n.default(e,t,{removePKCS7Padding:!1})}return e.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},e.prototype.decryptAacSample=function(e,t,i,n){var s=e[t].unit,r=s.subarray(16,s.length-s.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length),o=this;this.decryptBuffer(a,function(r){r=new Uint8Array(r),s.set(r,16),n||o.decryptAacSamples(e,t+1,i)})},e.prototype.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,t,i,n),!n)return}}},e.prototype.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),n=0,s=32;s<=e.length-16;s+=160,n+=16)i.set(e.subarray(s,s+16),n);return i},e.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var i=0,n=32;n<=e.length-16;n+=160,i+=16)e.set(t.subarray(i,i+16),n);return e},e.prototype.decryptAvcSample=function(e,t,i,n,s,r){var a=this.discardEPB(s.data),o=this.getAvcEncryptedData(a),l=this;this.decryptBuffer(o.buffer,function(o){s.data=l.getAvcDecryptedUnit(a,o),r||l.decryptAvcSamples(e,t,i+1,n)})},e.prototype.decryptAvcSamples=function(e,t,i,n){for(;;t++,i=0){if(t>=e.length)return void n();for(var s=e[t].units;!(i>=s.length);i++){var r=s[i];if(!(r.length<=48||1!==r.type&&5!==r.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(e,t,i,n,r,a),!a)return}}}},e}();t.default=s},"./src/demux/tsdemuxer.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/demux/adts.js"),s=i("./src/demux/mpegaudio.js"),r=i("./src/events.js"),a=i("./src/demux/exp-golomb.js"),o=i("./src/demux/sample-aes.js"),l=i("./src/utils/logger.js"),d=i("./src/errors.js"),u={video:1,audio:2,id3:3,text:4},c=function(){function e(e,t,i,n){this.observer=e,this.config=i,this.typeSupported=n,this.remuxer=t,this.sampleAes=null}return e.prototype.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new o.default(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var i=e._syncOffset(t);return!(i<0||(i&&l.logger.warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:u[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},e.prototype.resetInitSegment=function(t,i,n,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",s),this._audioTrack=e.createTrack("audio",s),this._id3Track=e.createTrack("id3",s),this._txtTrack=e.createTrack("text",s),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=n,this._duration=s},e.prototype.resetTimeStamp=function(){},e.prototype.append=function(t,i,n,s){var a,o,u,c,h,p=t.length,f=!1;this.contiguous=n;var v=this.pmtParsed,g=this._avcTrack,_=this._audioTrack,m=this._id3Track,E=g.pid,y=_.pid,A=m.pid,S=this._pmtId,b=g.pesData,T=_.pesData,D=m.pesData,C=this._parsePAT,I=this._parsePMT,R=this._parsePES,P=this._parseAVCPES.bind(this),M=this._parseAACPES.bind(this),O=this._parseMPEGPES.bind(this),L=this._parseID3PES.bind(this),w=e._syncOffset(t);for(p-=(p+w)%188,a=w;a<p;a+=188)if(71===t[a]){if(o=!!(64&t[a+1]),u=((31&t[a+1])<<8)+t[a+2],(48&t[a+3])>>4>1){if((c=a+5+t[a+4])===a+188)continue}else c=a+4;switch(u){case E:o&&(b&&(h=R(b))&&void 0!==h.pts&&P(h,!1),b={data:[],size:0}),b&&(b.data.push(t.subarray(c,a+188)),b.size+=a+188-c);break;case y:o&&(T&&(h=R(T))&&void 0!==h.pts&&(_.isAAC?M(h):O(h)),T={data:[],size:0}),T&&(T.data.push(t.subarray(c,a+188)),T.size+=a+188-c);break;case A:o&&(D&&(h=R(D))&&void 0!==h.pts&&L(h),D={data:[],size:0}),D&&(D.data.push(t.subarray(c,a+188)),D.size+=a+188-c);break;case 0:o&&(c+=t[c]+1),S=this._pmtId=C(t,c);break;case S:o&&(c+=t[c]+1);var N=I(t,c,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(E=N.avc)>0&&(g.pid=E),(y=N.audio)>0&&(_.pid=y,_.isAAC=N.isAAC),(A=N.id3)>0&&(m.pid=A),f&&!v&&(l.logger.log("reparse from beginning"),f=!1,a=w-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:f=!0}}else this.observer.trigger(r.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});b&&(h=R(b))&&void 0!==h.pts?(P(h,!0),g.pesData=null):g.pesData=b,T&&(h=R(T))&&void 0!==h.pts?(_.isAAC?M(h):O(h),_.pesData=null):(T&&T.size&&l.logger.log("last AAC PES packet truncated,might overlap between fragments"),_.pesData=T),D&&(h=R(D))&&void 0!==h.pts?(L(h),m.pesData=null):m.pesData=D,null==this.sampleAes?this.remuxer.remux(_,g,m,this._txtTrack,i,n,s):this.decryptAndRemux(_,g,m,this._txtTrack,i,n,s)},e.prototype.decryptAndRemux=function(e,t,i,n,s,r,a){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){o.decryptAndRemuxAvc(e,t,i,n,s,r,a)})}else this.decryptAndRemuxAvc(e,t,i,n,s,r,a)},e.prototype.decryptAndRemuxAvc=function(e,t,i,n,s,r,a){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){o.remuxer.remux(e,t,i,n,s,r,a)})}else this.remuxer.remux(e,t,i,n,s,r,a)},e.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},e.prototype._parsePMT=function(e,t,i,n){var s,r,a={audio:-1,avc:-1,id3:-1,isAAC:!0};for(s=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<s;){switch(r=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!n){l.logger.log("unkown stream type:"+e[t]);break}case 15:-1===a.audio&&(a.audio=r);break;case 21:-1===a.id3&&(a.id3=r);break;case 219:if(!n){l.logger.log("unkown stream type:"+e[t]);break}case 27:-1===a.avc&&(a.avc=r);break;case 3:case 4:i?-1===a.audio&&(a.audio=r,a.isAAC=!1):l.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:l.logger.warn("HEVC stream type found, not supported for now");break;default:l.logger.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return a},e.prototype._parsePES=function(e){var t,i,n,s,r,a,o,d,u=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var h=new Uint8Array(c[0].length+c[1].length);h.set(c[0]),h.set(c[1],c[0].length),c[0]=h,c.splice(1,1)}if(1===((t=c[0])[0]<<16)+(t[1]<<8)+t[2]){if((n=(t[4]<<8)+t[5])&&n>e.size-6)return null;192&(i=t[7])&&((a=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2)>4294967295&&(a-=8589934592),64&i?((o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>4294967295&&(o-=8589934592),a-o>54e5&&(l.logger.warn(Math.round((a-o)/9e4)+"s delta between PTS and DTS, align them"),a=o)):o=a),d=(s=t[8])+9,e.size-=d,r=new Uint8Array(e.size);for(var p=0,f=c.length;p<f;p++){var v=(t=c[p]).byteLength;if(d){if(d>v){d-=v;continue}t=t.subarray(d),v-=d,d=0}r.set(t,u),u+=v}return n&&(n-=s+3),{data:r,pts:a,dts:o,len:n}}return null},e.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var i=t.samples,n=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(n||this.contiguous)?(e.id=n,i.push(e)):t.dropped++}e.debug.length&&l.logger.log(e.pts+"/"+e.dts+":"+e.debug)},e.prototype._parseAVCPES=function(e,t){var i,n,s,r=this,o=this._avcTrack,l=this._parseAVCNALu(e.data),d=this.avcSample,u=!1,c=this.pushAccesUnit.bind(this),h=function(e,t,i,n){return{key:e,pts:t,dts:i,units:[],debug:n}};e.data=null,d&&l.length&&!o.audFound&&(c(d,o),d=this.avcSample=h(!1,e.pts,e.dts,"")),l.forEach(function(t){switch(t.type){case 1:n=!0,d||(d=r.avcSample=h(!0,e.pts,e.dts,"")),d.frame=!0;var l=t.data;if(u&&l.length>4){var p=new a.default(l).readSliceType();2!==p&&4!==p&&7!==p&&9!==p||(d.key=!0)}break;case 5:n=!0,d||(d=r.avcSample=h(!0,e.pts,e.dts,"")),d.key=!0,d.frame=!0;break;case 6:n=!0,(i=new a.default(r.discardEPB(t.data))).readUByte();for(var f=0,v=0,g=!1,_=0;!g&&i.bytesAvailable>1;){f=0;do{f+=_=i.readUByte()}while(255===_);v=0;do{v+=_=i.readUByte()}while(255===_);if(4===f&&0!==i.bytesAvailable){if(g=!0,181===i.readUByte()&&49===i.readUShort()&&1195456820===i.readUInt()&&3===i.readUByte()){var m=i.readUByte(),E=31&m,y=[m,i.readUByte()];for(s=0;s<E;s++)y.push(i.readUByte()),y.push(i.readUByte()),y.push(i.readUByte());r._insertSampleInOrder(r._txtTrack.samples,{type:3,pts:e.pts,bytes:y})}}else if(v<i.bytesAvailable)for(s=0;s<v;s++)i.readUByte()}break;case 7:if(n=!0,u=!0,!o.sps){var A=(i=new a.default(t.data)).readSPS();o.width=A.width,o.height=A.height,o.pixelRatio=A.pixelRatio,o.sps=[t.data],o.duration=r._duration;var S=t.data.subarray(1,4),b="avc1.";for(s=0;s<3;s++){var T=S[s].toString(16);T.length<2&&(T="0"+T),b+=T}o.codec=b}break;case 8:n=!0,o.pps||(o.pps=[t.data]);break;case 9:n=!1,o.audFound=!0,d&&c(d,o),d=r.avcSample=h(!1,e.pts,e.dts,"");break;case 12:n=!1;break;default:n=!1,d&&(d.debug+="unknown NAL "+t.type+" ")}d&&n&&d.units.push(t)}),t&&d&&(c(d,o),this.avcSample=null)},e.prototype._insertSampleInOrder=function(e,t){var i=e.length;if(i>0){if(t.pts>=e[i-1].pts)e.push(t);else for(var n=i-1;n>=0;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)},e.prototype._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var i=this._avcTrack.samples;t=i[i.length-1]}if(t){var n=t.units;e=n[n.length-1]}return e},e.prototype._parseAVCNALu=function(e){var t,i,n,s,r=0,a=e.byteLength,o=this._avcTrack,l=o.naluState||0,d=l,u=[],c=-1;for(-1===l&&(c=0,s=31&e[0],l=0,r=1);r<a;)if(t=e[r++],l)if(1!==l)if(t)if(1===t){var h,p;c>=0?(n={data:e.subarray(c,r-l-1),type:s},u.push(n)):(h=this._getLastNalUnit())&&(d&&r<=4-d&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-d)),(i=r-l-1)>0)&&((p=new Uint8Array(h.data.byteLength+i)).set(h.data,0),p.set(e.subarray(0,i),h.data.byteLength),h.data=p),r<a?(c=r,s=31&e[r],l=0):l=-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;return c>=0&&l>=0&&(n={data:e.subarray(c,a),type:s,state:l},u.push(n)),0===u.length&&(h=this._getLastNalUnit())&&((p=new Uint8Array(h.data.byteLength+e.byteLength)).set(h.data,0),p.set(e,h.data.byteLength),h.data=p),o.naluState=l,u},e.prototype.discardEPB=function(e){for(var t,i,n=e.byteLength,s=[],r=1;r<n-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(s.push(r+2),r+=2):r++;if(0===s.length)return e;t=n-s.length,i=new Uint8Array(t);var a=0;for(r=0;r<t;a++,r++)a===s[0]&&(a++,s.shift()),i[r]=e[a];return i},e.prototype._parseAACPES=function(e){var t,i,s,a,o,u=this._audioTrack,c=e.data,h=e.pts,p=this.aacOverFlow,f=this.aacLastPTS;if(p){var v=new Uint8Array(p.byteLength+c.byteLength);v.set(p,0),v.set(c,p.byteLength),c=v}for(s=0,o=c.length;s<o-1&&!n.isHeader(c,s);s++);if(s){var g=void 0,_=void 0;if(s<o-1?(g="AAC PES did not start with ADTS header,offset:"+s,_=!1):(g="no ADTS header found in AAC PES",_=!0),l.logger.warn("parsing error:"+g),this.observer.trigger(r.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:_,reason:g}),_)return}if(n.initTrackConfig(u,this.observer,c,s,this.audioCodec),i=0,t=n.getFrameDuration(u.samplerate),p&&f){var m=f+t;Math.abs(m-h)>1&&(l.logger.log("AAC: align PTS for overlapping frames by "+Math.round((m-h)/90)),h=m)}for(;s<o;)if(n.isHeader(c,s)&&s+5<o){var E=n.appendFrame(u,c,s,h,i);if(!E)break;s+=E.length,a=E.sample.pts,i++}else s++;p=s<o?c.subarray(s,o):null,this.aacOverFlow=p,this.aacLastPTS=a},e.prototype._parseMPEGPES=function(e){for(var t=e.data,i=t.length,n=0,r=0,a=e.pts;r<i;)if(s.default.isHeader(t,r)){var o=s.default.appendFrame(this._audioTrack,t,r,a,n);if(!o)break;r+=o.length,n++}else r++},e.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},e}();t.default=c},"./src/errors.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},t.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/logger.js"),s=i("./src/errors.js"),r=i("./src/events.js"),a={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},o=function(){function e(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.hls=e,this.onEvent=this.onEvent.bind(this),this.handledEvents=t,this.useGenericHandler=!0,this.registerListeners()}return e.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},e.prototype.onHandlerDestroying=function(){},e.prototype.onHandlerDestroyed=function(){},e.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},e.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(a[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},e.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},e.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},e.prototype.onEventGeneric=function(e,t){try{(function(e,t){var i="on"+e.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,t)}).call(this,e,t).call()}catch(t){n.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(r.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}();t.default=o},"./src/events.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},"./src/hls.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./node_modules/url-toolkit/src/url-toolkit.js"),r=i("./src/errors.js"),a=i("./src/loader/playlist-loader.js"),o=i("./src/loader/fragment-loader.js"),l=i("./src/loader/key-loader.js"),d=i("./src/controller/fragment-tracker.js"),u=i("./src/controller/stream-controller.js"),c=i("./src/controller/level-controller.js"),h=i("./src/controller/id3-track-controller.js"),p=i("./src/is-supported.js"),f=i("./src/utils/logger.js"),v=i("./src/config.js"),g=i("./src/events.js"),_=function(e){function t(i){void 0===i&&(i={});var n=e.call(this)||this,s=t.DefaultConfig;if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var r in s)r in i||(i[r]=s[r]);if(void 0!==i.liveMaxLatencyDurationCount&&i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(i.liveMaxLatencyDuration<=i.liveSyncDuration||void 0===i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');f.enableLogs(i.debug),n.config=i,n._autoLevelCapping=-1;var p=n.abrController=new i.abrController(n),v=new i.bufferController(n),g=new i.capLevelController(n),_=new i.fpsController(n),m=new a.default(n),E=new o.default(n),y=new l.default(n),A=new h.default(n),S=n.levelController=new c.default(n),b=new d.FragmentTracker(n),T=[S,n.streamController=new u.default(n,b)],D=i.audioStreamController;D&&T.push(new D(n,b)),n.networkControllers=T;var C=[m,E,y,p,v,g,_,A,b];if(D=i.audioTrackController){var I=new D(n);n.audioTrackController=I,C.push(I)}if(D=i.subtitleTrackController){var R=new D(n);n.subtitleTrackController=R,T.push(R)}if(D=i.emeController){var P=new D(n);n.emeController=P,C.push(P)}return(D=i.subtitleStreamController)&&T.push(new D(n,b)),(D=i.timelineController)&&C.push(new D(n)),n.coreComponents=C,n}return n(t,e),Object.defineProperty(t,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),t.isSupported=function(){return p.isSupported()},Object.defineProperty(t,"Events",{get:function(){return g.default},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ErrorTypes",{get:function(){return r.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ErrorDetails",{get:function(){return r.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DefaultConfig",{get:function(){return t.defaultConfig?t.defaultConfig:v.hlsDefaultConfig},set:function(e){t.defaultConfig=e},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){f.logger.log("destroy"),this.trigger(g.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},t.prototype.attachMedia=function(e){f.logger.log("attachMedia"),this.media=e,this.trigger(g.default.MEDIA_ATTACHING,{media:e})},t.prototype.detachMedia=function(){f.logger.log("detachMedia"),this.trigger(g.default.MEDIA_DETACHING),this.media=null},t.prototype.loadSource=function(e){e=s.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),f.logger.log("loadSource:"+e),this.url=e,this.trigger(g.default.MANIFEST_LOADING,{url:e})},t.prototype.startLoad=function(e){void 0===e&&(e=-1),f.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},t.prototype.stopLoad=function(){f.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},t.prototype.swapAudioCodec=function(){f.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.prototype.recoverMediaError=function(){f.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},Object.defineProperty(t.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(e){f.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(e){f.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(e){f.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){f.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(e){f.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(e){f.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minAutoLevel",{get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,i=e?e.length:0,n=0;n<i;n++)if((e[n].realBitrate?Math.max(e[n].realBitrate,e[n].bitrate):e[n].bitrate)>t)return n;return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxAutoLevel",{get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextAutoLevel",{get:function(){var e=this;return Math.min(Math.max(e.abrController.nextAutoLevel,e.minAutoLevel),e.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTracks",{get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTrack",{get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subtitleTracks",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subtitleTrack",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subtitleDisplay",{get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)},enumerable:!0,configurable:!0}),t}(i("./src/observer.js").Observer);t.default=_},"./src/is-supported.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/mediasource-helper.js");t.isSupported=function(){var e=n.getMediaSource(),t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!s}},"./src/loader/fragment-loader.js":function(e,t,i){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=function(t){function i(e){var i=t.call(this,e,s.default.FRAG_LOADING)||this;return i.loaders={},i}return n(i,t),i.prototype.destroy=function(){var e=this.loaders;for(var i in e){var n=e[i];n&&n.destroy()}this.loaders={},t.prototype.destroy.call(this)},i.prototype.onFragLoading=function(t){var i=t.frag,n=i.type,s=this.loaders,r=this.hls.config,a=r.fLoader,l=r.loader;i.loaded=0;var d,u,c,h=s[n];h&&(o.logger.warn("abort previous fragment loader for type: "+n),h.abort()),h=s[n]=i.loader=r.fLoader?new a(r):new l(r),d={url:i.url,frag:i,responseType:"arraybuffer",progressData:!1};var p=i.byteRangeStartOffset,f=i.byteRangeEndOffset;e.isFinite(p)&&e.isFinite(f)&&(d.rangeStart=p,d.rangeEnd=f),u={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},h.load(d,u,c)},i.prototype.loadsuccess=function(e,t,i,n){void 0===n&&(n=null);var r=e.data,a=i.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(s.default.FRAG_LOADED,{payload:r,frag:a,stats:t,networkDetails:n})},i.prototype.loaderror=function(e,t,i){void 0===i&&(i=null);var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[n.type]=void 0,this.hls.trigger(s.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:i})},i.prototype.loadtimeout=function(e,t,i){void 0===i&&(i=null);var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[n.type]=void 0,this.hls.trigger(s.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:i})},i.prototype.loadprogress=function(e,t,i,n){void 0===n&&(n=null);var r=t.frag;r.loaded=e.loaded,this.hls.trigger(s.default.FRAG_LOAD_PROGRESS,{frag:r,stats:e,networkDetails:n})},i}(r.default);t.default=l}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/fragment.js":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i("./node_modules/url-toolkit/src/url-toolkit.js"),s=i("./src/loader/level-key.js"),r=function(){function t(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=((e={})[t.ElementaryStreamTypes.AUDIO]=!1,e[t.ElementaryStreamTypes.VIDEO]=!1,e)}return Object.defineProperty(t,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=n.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var i=this.lastByteRangeEndOffset;e[0]=i||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0],this._byteRange=e}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endProgramDateTime",{get:function(){if(!e.isFinite(this.programDateTime))return null;var t=e.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),t.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},t.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},t.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},t.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&((i=new s.default).method=e.method,i.baseuri=e.baseuri,i.reluri=e.reluri,i.iv=this.createInitializationVector(t)),i},t}();t.default=r}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/key-loader.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=function(e){function t(t){var i=e.call(this,t,s.default.KEY_LOADING)||this;return i.loaders={},i.decryptkey=null,i.decrypturl=null,i}return n(t,e),t.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},r.default.prototype.destroy.call(this)},t.prototype.onKeyLoading=function(e){var t=e.frag,i=t.type,n=this.loaders[i],r=t.decryptdata,a=r.uri;if(a!==this.decrypturl||null===this.decryptkey){var l,d,u,c=this.hls.config;n&&(o.logger.warn("abort previous key loader for type:"+i),n.abort()),t.loader=this.loaders[i]=new c.loader(c),this.decrypturl=a,this.decryptkey=null,l={url:a,frag:t,responseType:"arraybuffer"},d={timeout:c.fragLoadingTimeOut,maxRetry:0,retryDelay:c.fragLoadingRetryDelay,maxRetryDelay:c.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(l,d,u)}else this.decryptkey&&(r.key=this.decryptkey,this.hls.trigger(s.default.KEY_LOADED,{frag:t}))},t.prototype.loadsuccess=function(e,t,i){var n=i.frag;this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(s.default.KEY_LOADED,{frag:n})},t.prototype.loaderror=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})},t.prototype.loadtimeout=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},t}(r.default);t.default=l},"./src/loader/level-key.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./node_modules/url-toolkit/src/url-toolkit.js"),s=function(){function e(){this.method=null,this.key=null,this.iv=null,this._uri=null}return Object.defineProperty(e.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=n.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),e}();t.default=s},"./src/loader/level.js":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function t(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}return Object.defineProperty(t.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!e.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),t}();t.default=i}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/m3u8-parser.js":function(e,t,i){"use strict";(function(e){function n(t,i){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):i&&i.programDateTime&&(t.programDateTime=i.endProgramDateTime),e.isFinite(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}Object.defineProperty(t,"__esModule",{value:!0});var s=i("./node_modules/url-toolkit/src/url-toolkit.js"),r=i("./src/loader/fragment.js"),a=i("./src/loader/level.js"),o=i("./src/loader/level-key.js"),l=i("./src/utils/attr-list.js"),d=i("./src/utils/logger.js"),u=i("./src/utils/codecs.js"),c=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,h=/#EXT-X-MEDIA:(.*)/g,p=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),f=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,v=/\.(mp4|m4s|m4v|m4a)$/i,g=function(){function t(){}return t.findGroup=function(e,t){if(!e)return null;for(var i=null,n=0;n<e.length;n++){var s=e[n];s.id===t&&(i=s)}return i},t.convertAVC1ToAVCOTI=function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t},t.resolve=function(e,t){return s.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,i){function n(e,t){["video","audio"].forEach(function(i){var n=e.filter(function(e){return u.isCodecType(e,i)});if(n.length){var s=n.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[i+"Codec"]=s.length>0?s[0]:n[0],e=e.filter(function(e){return-1===n.indexOf(e)})}}),t.unknownCodecs=e}var s,r=[];for(c.lastIndex=0;null!=(s=c.exec(e));){var a={},o=a.attrs=new l.default(s[1]);a.url=t.resolve(s[2],i);var d=o.decimalResolution("RESOLUTION");d&&(a.width=d.width,a.height=d.height),a.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),a.name=o.NAME,n([].concat((o.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=t.convertAVC1ToAVCOTI(a.videoCodec)),r.push(a)}return r},t.parseMasterPlaylistMedia=function(e,i,n,s){void 0===s&&(s=[]);var r,a=[],o=0;for(h.lastIndex=0;null!==(r=h.exec(e));){var d={},u=new l.default(r[1]);if(u.TYPE===n){if(d.groupId=u["GROUP-ID"],d.name=u.NAME,d.type=n,d.default="YES"===u.DEFAULT,d.autoselect="YES"===u.AUTOSELECT,d.forced="YES"===u.FORCED,u.URI&&(d.url=t.resolve(u.URI,i)),d.lang=u.LANGUAGE,d.name||(d.name=d.lang),s.length){var c=t.findGroup(s,d.groupId);d.audioCodec=c?c.codec:s[0].codec}d.id=o++,a.push(d)}}return a},t.parseLevelPlaylist=function(t,i,s,u,c){var h,g,_=0,m=0,E=new a.default(i),y=new o.default,A=0,S=null,b=new r.default,T=null;for(p.lastIndex=0;null!==(h=p.exec(t));){var D=h[1];if(D){b.duration=parseFloat(D);var C=(" "+h[2]).slice(1);b.title=C||null,b.tagList.push(C?["INF",D,C]:["INF",D])}else if(h[3]){if(e.isFinite(b.duration)){var I=_++;b.type=u,b.start=m,b.levelkey=y,b.sn=I,b.level=s,b.cc=A,b.urlId=c,b.baseurl=i,b.relurl=(" "+h[3]).slice(1),n(b,S),E.fragments.push(b),S=b,m+=b.duration,b=new r.default}}else if(h[4]){if(b.rawByteRange=(" "+h[4]).slice(1),S){var R=S.byteRangeEndOffset;R&&(b.lastByteRangeEndOffset=R)}}else if(h[5])b.rawProgramDateTime=(" "+h[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),null===T&&(T=E.fragments.length);else{for(h=h[0].match(f),g=1;g<h.length&&void 0===h[g];g++);var P=(" "+h[g+1]).slice(1),M=(" "+h[g+2]).slice(1);switch(h[g]){case"#":b.tagList.push(M?[P,M]:[P]);break;case"PLAYLIST-TYPE":E.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":_=E.startSN=parseInt(P);break;case"TARGETDURATION":E.targetduration=parseFloat(P);break;case"VERSION":E.version=parseInt(P);break;case"EXTM3U":break;case"ENDLIST":E.live=!1;break;case"DIS":A++,b.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":A=parseInt(P);break;case"KEY":var O=P,L=new l.default(O),w=L.enumeratedString("METHOD"),N=L.URI,k=L.hexadecimalInteger("IV");w&&(y=new o.default,N&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(w)>=0&&(y.method=w,y.baseuri=i,y.reluri=N,y.key=null,y.iv=k));break;case"START":var B=P,U=new l.default(B).decimalFloatingPoint("TIME-OFFSET");e.isFinite(U)&&(E.startTimeOffset=U);break;case"MAP":var j=new l.default(P);b.relurl=j.URI,b.rawByteRange=j.BYTERANGE,b.baseurl=i,b.level=s,b.type=u,b.sn="initSegment",E.initSegment=b,(b=new r.default).rawProgramDateTime=E.initSegment.rawProgramDateTime;break;default:d.logger.warn("line parsed but not handled: "+h)}}}return(b=S)&&!b.relurl&&(E.fragments.pop(),m-=b.duration),E.totalduration=m,E.averagetargetduration=m/E.fragments.length,E.endSN=_-1,E.startCC=E.fragments[0]?E.fragments[0].cc:0,E.endCC=A,!E.initSegment&&E.fragments.length&&E.fragments.every(function(e){return v.test(e.relurl)})&&(d.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(b=new r.default).relurl=E.fragments[0].relurl,b.baseurl=i,b.level=s,b.type=u,b.sn="initSegment",E.initSegment=b,E.needSidxRanges=!0),T&&function(e,t){for(var i=e[t],n=t-1;n>=0;n--){var s=e[n];s.programDateTime=i.programDateTime-1e3*s.duration,i=s}}(E.fragments,T),E},t}();t.default=g}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/playlist-loader.js":function(e,t,i){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=i("./src/demux/mp4demuxer.js"),d=i("./src/loader/m3u8-parser.js"),u=window.performance,c={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},h={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},p=function(t){function i(e){var i=t.call(this,e,s.default.MANIFEST_LOADING,s.default.LEVEL_LOADING,s.default.AUDIO_TRACK_LOADING,s.default.SUBTITLE_TRACK_LOADING)||this;return i.loaders={},i}return n(i,t),Object.defineProperty(i,"ContextType",{get:function(){return c},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LevelType",{get:function(){return h},enumerable:!0,configurable:!0}),i.canHaveQualityLevels=function(e){return e!==c.AUDIO_TRACK&&e!==c.SUBTITLE_TRACK},i.mapContextToLevelType=function(e){switch(e.type){case c.AUDIO_TRACK:return h.AUDIO;case c.SUBTITLE_TRACK:return h.SUBTITLE;default:return h.MAIN}},i.getResponseUrl=function(e,t){var i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i},i.prototype.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,s=new(i||n)(t);return e.loader=s,this.loaders[e.type]=s,s},i.prototype.getInternalLoader=function(e){return this.loaders[e.type]},i.prototype.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},i.prototype.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},i.prototype.destroy=function(){this.destroyInternalLoaders(),t.prototype.destroy.call(this)},i.prototype.onManifestLoading=function(e){this.load(e.url,{type:c.MANIFEST,level:0,id:null})},i.prototype.onLevelLoading=function(e){this.load(e.url,{type:c.LEVEL,level:e.level,id:e.id})},i.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:c.AUDIO_TRACK,level:null,id:e.id})},i.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:c.SUBTITLE_TRACK,level:null,id:e.id})},i.prototype.load=function(e,t){var i=this.hls.config;o.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var n,s,r,a,l=this.getInternalLoader(t);if(l){var d=l.context;if(d&&d.url===e)return o.logger.trace("playlist request ongoing"),!1;o.logger.warn("aborting previous loader for type: "+t.type),l.abort()}switch(t.type){case c.MANIFEST:n=i.manifestLoadingMaxRetry,s=i.manifestLoadingTimeOut,r=i.manifestLoadingRetryDelay,a=i.manifestLoadingMaxRetryTimeout;break;case c.LEVEL:n=0,s=i.levelLoadingTimeOut;break;default:n=i.levelLoadingMaxRetry,s=i.levelLoadingTimeOut,r=i.levelLoadingRetryDelay,a=i.levelLoadingMaxRetryTimeout}l=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"";var u={timeout:s,maxRetry:n,retryDelay:r,maxRetryDelay:a},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return o.logger.debug("Calling internal loader delegate for URL: "+e),l.load(t,u,h),!0},i.prototype.loadsuccess=function(e,t,i,n){if(void 0===n&&(n=null),i.isSidxRequest)return this._handleSidxRequest(e,i),void this._handlePlaylistLoaded(e,t,i,n);this.resetInternalLoader(i.type);var s=e.data;t.tload=u.now(),0===s.indexOf("#EXTM3U")?s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,i,n):this._handleMasterPlaylist(e,t,i,n):this._handleManifestParsingError(e,i,"no EXTM3U delimiter",n)},i.prototype.loaderror=function(e,t,i){void 0===i&&(i=null),this._handleNetworkError(t,i,!1,e)},i.prototype.loadtimeout=function(e,t,i){void 0===i&&(i=null),this._handleNetworkError(t,i,!0)},i.prototype._handleMasterPlaylist=function(e,t,n,r){var a=this.hls,l=e.data,u=i.getResponseUrl(e,n),c=d.default.parseMasterPlaylist(l,u);if(c.length){var h=c.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),p=d.default.parseMasterPlaylistMedia(l,u,"AUDIO",h),f=d.default.parseMasterPlaylistMedia(l,u,"SUBTITLES");if(p.length){var v=!1;p.forEach(function(e){e.url||(v=!0)}),!1===v&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(o.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main"}))}a.trigger(s.default.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:f,url:u,stats:t,networkDetails:r})}else this._handleManifestParsingError(e,n,"no level found in manifest",r)},i.prototype._handleTrackOrLevelPlaylist=function(t,n,r,a){var o=this.hls,l=r.id,h=r.level,p=r.type,f=i.getResponseUrl(t,r),v=e.isFinite(l)?l:0,g=e.isFinite(h)?h:v,_=i.mapContextToLevelType(r),m=d.default.parseLevelPlaylist(t.data,f,g,_,v);if(m.tload=n.tload,p===c.MANIFEST){var E={url:f,details:m};o.trigger(s.default.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:f,stats:n,networkDetails:a})}if(n.tparsed=u.now(),m.needSidxRanges){var y=m.initSegment.url;this.load(y,{isSidxRequest:!0,type:p,level:h,levelDetails:m,id:l,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else r.levelDetails=m,this._handlePlaylistLoaded(t,n,r,a)},i.prototype._handleSidxRequest=function(e,t){var i=l.default.parseSegmentIndex(new Uint8Array(e.data));if(i){var n=i.references,s=t.levelDetails;n.forEach(function(e,t){var i=e.info,n=s.fragments[t];0===n.byteRange.length&&(n.rawByteRange=String(1+i.end-i.start)+"@"+String(i.start))}),s.initSegment.rawByteRange=String(i.moovEndOffset)+"@0"}},i.prototype._handleManifestParsingError=function(e,t,i,n){this.hls.trigger(s.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:i,networkDetails:n})},i.prototype._handleNetworkError=function(e,t,i,n){void 0===i&&(i=!1),void 0===n&&(n=null),o.logger.info("A network error occured while loading a "+e.type+"-type playlist");var r,l,d=this.getInternalLoader(e);switch(e.type){case c.MANIFEST:r=i?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case c.LEVEL:r=i?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case c.AUDIO_TRACK:r=i?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;default:l=!1}d&&(d.abort(),this.resetInternalLoader(e.type));var u={type:a.ErrorTypes.NETWORK_ERROR,details:r,fatal:l,url:d.url,loader:d,context:e,networkDetails:t};n&&(u.response=n),this.hls.trigger(s.default.ERROR,u)},i.prototype._handlePlaylistLoaded=function(e,t,n,r){var a=n.type,o=n.level,l=n.id,d=n.levelDetails;if(d.targetduration)if(i.canHaveQualityLevels(n.type))this.hls.trigger(s.default.LEVEL_LOADED,{details:d,level:o||0,id:l||0,stats:t,networkDetails:r});else switch(a){case c.AUDIO_TRACK:this.hls.trigger(s.default.AUDIO_TRACK_LOADED,{details:d,id:l,stats:t,networkDetails:r});break;case c.SUBTITLE_TRACK:this.hls.trigger(s.default.SUBTITLE_TRACK_LOADED,{details:d,id:l,stats:t,networkDetails:r})}else this._handleManifestParsingError(e,n,"invalid target duration",r)},i}(r.default);t.default=p}).call(this,i("./src/polyfills/number.js").Number)},"./src/observer.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.emit.apply(this,[e,e].concat(t))},t}(i("./node_modules/eventemitter3/index.js").EventEmitter);t.Observer=s},"./src/polyfills/number.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/get-self-scope.js").getSelfScope().Number;t.Number=n,n.isFinite=n.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},"./src/remux/aac-helper.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.default=n},"./src/remux/mp4-generator.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Math.pow(2,32)-1,s=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:n};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=r,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,l,a,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,s))},e.box=function(e){for(var t,i=Array.prototype.slice.call(arguments,1),n=8,s=i.length,r=s;s--;)n+=i[s].byteLength;for((t=new Uint8Array(n))[0]=n>>24&255,t[1]=n>>16&255,t[2]=n>>8&255,t[3]=255&n,t.set(e,4),s=0,n=8;s<r;s++)t.set(i[s],n),n+=i[s].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var s=Math.floor(i/(n+1)),r=Math.floor(i%(n+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,s>>24,s>>16&255,s>>8&255,255&s,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,i))},e.moov=function(t){for(var i=t.length,n=[];i--;)n[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))},e.mvex=function(t){for(var i=t.length,n=[];i--;)n[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(n))},e.mvhd=function(t,i){i*=t;var s=Math.floor(i/(n+1)),r=Math.floor(i%(n+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,s>>24,s>>16&255,s>>8&255,255&s,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var i,n,s=t.samples||[],r=new Uint8Array(4+s.length);for(n=0;n<s.length;n++)i=s[n].flags,r[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,r)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,n,s,r=[],a=[];for(i=0;i<t.sps.length;i++)s=(n=t.sps[i]).byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(n));for(i=0;i<t.pps.length;i++)s=(n=t.pps[i]).byteLength,a.push(s>>>8&255),a.push(255&s),a=a.concat(Array.prototype.slice.call(n));var o=e.box(e.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(a))),l=t.width,d=t.height,u=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,s=t.duration*t.timescale,r=t.width,a=t.height,o=Math.floor(s/(n+1)),l=Math.floor(s%(n+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))},e.traf=function(t,i){var s=e.sdtp(t),r=t.id,a=Math.floor(i/(n+1)),o=Math.floor(i%(n+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,s.length+16+20+8+16+8+8),s)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var n,s,r,a,o,l,d=t.samples||[],u=d.length,c=12+16*u,h=new Uint8Array(c);for(i+=8+c,h.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),n=0;n<u;n++)r=(s=d[n]).duration,a=s.size,o=s.flags,l=s.cts,h.set([r>>>24&255,r>>>16&255,r>>>8&255,255&r,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*n);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var i,n=e.moov(t);return(i=new Uint8Array(e.FTYP.byteLength+n.byteLength)).set(e.FTYP),i.set(n,e.FTYP.byteLength),i},e}();t.default=s},"./src/remux/mp4-remuxer.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/remux/aac-helper.js"),s=i("./src/remux/mp4-generator.js"),r=i("./src/events.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=function(){function e(e,t,i,n){this.observer=e,this.config=t,this.typeSupported=i;var s=navigator.userAgent;this.isSafari=n&&n.indexOf("Apple")>-1&&s&&!s.match("CriOS"),this.ISGenerated=!1}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},e.prototype.resetInitSegment=function(){this.ISGenerated=!1},e.prototype.remux=function(e,t,i,n,s,a,l){if(this.ISGenerated||this.generateIS(e,t,s),this.ISGenerated){var d=e.samples.length,u=t.samples.length,c=s,h=s;if(d&&u){var p=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;c+=Math.max(0,p),h+=Math.max(0,-p)}if(d){e.timescale||(o.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,s));var f=this.remuxAudio(e,c,a,l);if(u){var v=void 0;f&&(v=f.endPTS-f.startPTS),t.timescale||(o.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,s)),this.remuxVideo(t,h,a,v,l)}}else if(u){var g=this.remuxVideo(t,h,a,0,l);g&&e.codec&&this.remuxEmptyAudio(e,c,a,g)}}i.samples.length&&this.remuxID3(i,s),n.samples.length&&this.remuxText(n,s),this.observer.trigger(r.default.FRAG_PARSED)},e.prototype.generateIS=function(e,t,i){var n,l,d=this.observer,u=e.samples,c=t.samples,h=this.typeSupported,p="audio/mp4",f={},v={tracks:f},g=void 0===this._initPTS;if(g&&(n=l=1/0),e.config&&u.length&&(e.timescale=e.samplerate,o.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(h.mpeg?(p="audio/mpeg",e.codec=""):h.mp3&&(e.codec="mp3")),f.audio={container:p,codec:e.codec,initSegment:!e.isAAC&&h.mpeg?new Uint8Array:s.default.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(n=l=u[0].pts-e.inputTimeScale*i)),t.sps&&t.pps&&c.length){var _=t.inputTimeScale;t.timescale=_,f.video={container:"video/mp4",codec:t.codec,initSegment:s.default.initSegment([t]),metadata:{width:t.width,height:t.height}},g&&(n=Math.min(n,c[0].pts-_*i),l=Math.min(l,c[0].dts-_*i),this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:n}))}Object.keys(f).length?(d.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,v),this.ISGenerated=!0,g&&(this._initPTS=n,this._initDTS=l)):d.trigger(r.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},e.prototype.remuxVideo=function(e,t,i,n,l){var d,u,c,h,p,f,v,g=8,_=e.timescale,m=e.samples,E=[],y=m.length,A=this._PTSNormalize,S=this._initPTS,b=this.nextAvcDts,T=this.isSafari;if(0!==y){T&&(i|=m.length&&b&&(l&&Math.abs(t-b/_)<.1||Math.abs(m[0].pts-b-S)<_/5)),i||(b=t*_),m.forEach(function(e){e.pts=A(e.pts-S,b),e.dts=A(e.dts-S,b)}),m.sort(function(e,t){var i=e.dts-t.dts,n=e.pts-t.pts;return i||n||e.id-t.id});var D=m.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(D<0){o.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(D/90)+" ms to overcome this issue");for(var C=0;C<m.length;C++)m[C].dts+=D}var I=m[0];p=Math.max(I.dts,0),h=Math.max(I.pts,0);var R=Math.round((p-b)/90);i&&R&&(R>1?o.logger.log("AVC:"+R+" ms hole between fragments detected,filling it"):R<-1&&o.logger.log("AVC:"+-R+" ms overlapping between fragments detected"),p=b,m[0].dts=p,h=Math.max(h-R,b),m[0].pts=h,o.logger.log("Video/PTS/DTS adjusted: "+Math.round(h/90)+"/"+Math.round(p/90)+",delta:"+R+" ms")),I=m[m.length-1],v=Math.max(I.dts,0),f=Math.max(I.pts,0,v),T&&(d=Math.round((v-p)/(m.length-1)));var P=0,M=0;for(C=0;C<y;C++){for(var O=m[C],L=O.units,w=L.length,N=0,k=0;k<w;k++)N+=L[k].data.length;M+=N,P+=w,O.length=N,O.dts=T?p+C*d:Math.max(O.dts,p),O.pts=Math.max(O.pts,O.dts)}var B=M+4*P+8;try{u=new Uint8Array(B)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating video mdat "+B})}var U=new DataView(u.buffer);for(U.setUint32(0,B),u.set(s.default.types.mdat,4),C=0;C<y;C++){var j=m[C],x=j.units,F=0,G=void 0;for(k=0,w=x.length;k<w;k++){var V=x[k],H=V.data,W=V.data.byteLength;U.setUint32(g,W),g+=4,u.set(H,g),g+=W,F+=4+W}if(T)G=Math.max(0,d*Math.round((j.pts-j.dts)/d));else{if(C<y-1)d=m[C+1].dts-j.dts;else{var K=this.config,z=j.dts-m[C>0?C-1:C].dts;if(K.stretchShortVideoTrack){var Y=K.maxBufferHole,q=Math.floor(Y*_),X=(n?h+n*_:this.nextAudioPts)-j.pts;X>q?((d=X-z)<0&&(d=z),o.logger.log("It is approximately "+X/90+" ms to the next segment; using duration "+d/90+" ms for the last video frame.")):d=z}else d=z}G=Math.round(j.pts-j.dts)}E.push({size:F,duration:d,cts:G,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:j.key?2:1,isNonSync:j.key?0:1}})}this.nextAvcDts=v+d;var J=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,E.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Q=E[0].flags;Q.dependsOn=2,Q.isNonSync=0}e.samples=E,c=s.default.moof(e.sequenceNumber++,p,e),e.samples=[];var Z={data1:c,data2:u,startPTS:h/_,endPTS:(f+d)/_,startDTS:p/_,endDTS:this.nextAvcDts/_,type:"video",hasAudio:!1,hasVideo:!0,nb:E.length,dropped:J};return this.observer.trigger(r.default.FRAG_PARSING_DATA,Z),Z}},e.prototype.remuxAudio=function(e,t,i,l){var d,u,c,h,p,f,v,g=e.inputTimeScale,_=e.timescale,m=g/_,E=(e.isAAC?1024:1152)*m,y=this._PTSNormalize,A=this._initPTS,S=!e.isAAC&&this.typeSupported.mpeg,b=e.samples,T=[],D=this.nextAudioPts;if(i|=b.length&&D&&(l&&Math.abs(t-D/g)<.1||Math.abs(b[0].pts-D-A)<20*E),b.forEach(function(e){e.pts=e.dts=y(e.pts-A,t*g)}),0!==(b=b.filter(function(e){return e.pts>=0})).length){if(i||(D=l?t*g:b[0].pts),e.isAAC)for(var C=this.config.maxAudioFramesDrift,I=0,R=D;I<b.length;){var P,M=b[I];P=(j=M.pts)-R;var O=Math.abs(1e3*P/g);if(P<=-C*E)o.logger.warn("Dropping 1 audio frame @ "+(R/g).toFixed(3)+"s due to "+Math.round(O)+" ms overlap."),b.splice(I,1),e.len-=M.unit.length;else if(P>=C*E&&O<1e4&&R){var L=Math.round(P/E);o.logger.warn("Injecting "+L+" audio frame @ "+(R/g).toFixed(3)+"s due to "+Math.round(1e3*P/g)+" ms gap.");for(var w=0;w<L;w++){var N=Math.max(R,0);(c=n.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),c=M.unit.subarray()),b.splice(I,0,{unit:c,pts:N,dts:N}),e.len+=c.length,R+=E,I++}M.pts=M.dts=R,R+=E,I++}else Math.abs(P),M.pts=M.dts=R,R+=E,I++}w=0;for(var k=b.length;w<k;w++){var B=b[w],U=B.unit,j=B.pts;if(void 0!==v)u.duration=Math.round((j-v)/m);else{var x=Math.round(1e3*(j-D)/g),F=0;if(i&&e.isAAC&&x){if(x>0&&x<1e4)F=Math.round((j-D)/E),o.logger.log(x+" ms hole between AAC samples detected,filling it"),F>0&&((c=n.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(c=U.subarray()),e.len+=F*c.length);else if(x<-12){o.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(D/g).toFixed(3)+"s/"+(j/g).toFixed(3)+"s/"+-x+"ms"),e.len-=U.byteLength;continue}j=D}if(f=j,!(e.len>0))return;var G=S?e.len:e.len+8;d=S?0:8;try{h=new Uint8Array(G)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating audio mdat "+G})}for(S||(new DataView(h.buffer).setUint32(0,G),h.set(s.default.types.mdat,4)),I=0;I<F;I++)(c=n.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),c=U.subarray()),h.set(c,d),d+=c.byteLength,u={size:c.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(u)}h.set(U,d);var V=U.byteLength;d+=V,u={size:V,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(u),v=j}var H=0,W=T.length;if(W>=2&&(H=T[W-2].duration,u.duration=H),W){this.nextAudioPts=D=v+m*H,e.len=0,e.samples=T,p=S?new Uint8Array:s.default.moof(e.sequenceNumber++,f/m,e),e.samples=[];var K=f/g,z=D/g,Y={data1:p,data2:h,startPTS:K,endPTS:z,startDTS:K,endDTS:z,type:"audio",hasAudio:!0,hasVideo:!1,nb:W};return this.observer.trigger(r.default.FRAG_PARSING_DATA,Y),Y}return null}},e.prototype.remuxEmptyAudio=function(e,t,i,s){var r=e.inputTimeScale,a=r/(e.samplerate?e.samplerate:r),l=this.nextAudioPts,d=(void 0!==l?l:s.startDTS*r)+this._initDTS,u=s.endDTS*r+this._initDTS,c=1024*a,h=Math.ceil((u-d)/c),p=n.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(o.logger.warn("remux empty Audio"),p){for(var f=[],v=0;v<h;v++){var g=d+v*c;f.push({unit:p,pts:g,dts:g}),e.len+=p.length}e.samples=f,this.remuxAudio(e,t,i)}else o.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},e.prototype.remuxID3=function(e){var t,i=e.samples.length,n=e.inputTimeScale,s=this._initPTS,a=this._initDTS;if(i){for(var o=0;o<i;o++)(t=e.samples[o]).pts=(t.pts-s)/n,t.dts=(t.dts-a)/n;this.observer.trigger(r.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]},e.prototype.remuxText=function(e){e.samples.sort(function(e,t){return e.pts-t.pts});var t,i=e.samples.length,n=e.inputTimeScale,s=this._initPTS;if(i){for(var a=0;a<i;a++)(t=e.samples[a]).pts=(t.pts-s)/n;this.observer.trigger(r.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},e.prototype._PTSNormalize=function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e},e}();t.default=l},"./src/remux/passthrough-remuxer.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/events.js"),s=function(){function e(e){this.observer=e}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(){},e.prototype.resetInitSegment=function(){},e.prototype.remux=function(e,t,i,s,r,a,o,l){var d=this.observer,u="";e&&(u+="audio"),t&&(u+="video"),d.trigger(n.default.FRAG_PARSING_DATA,{data1:l,startPTS:r,startDTS:r,type:u,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),d.trigger(n.default.FRAG_PARSED)},e}();t.default=s},"./src/task-loop.js":function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var s=e.apply(this,[t].concat(i))||this;return s._tickInterval=null,s._tickTimer=null,s._tickCallCount=0,s._boundTick=s.tick.bind(s),s}return n(t,e),t.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.prototype.hasInterval=function(){return!!this._tickInterval},t.prototype.hasNextTick=function(){return!!this._tickTimer},t.prototype.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)},t.prototype.clearInterval=function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.prototype.tick=function(){1==++this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},t.prototype.doTick=function(){},t}(i("./src/event-handler.js").default);t.default=s},"./src/utils/attr-list.js":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function t(e){for(var i in"string"==typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(i)&&(this[i]=e[i])}return t.prototype.decimalInteger=function(t){var i=parseInt(this[t],10);return i>e.MAX_SAFE_INTEGER?1/0:i},t.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},t.prototype.hexadecimalIntegerAsNumber=function(t){var i=parseInt(this[t],16);return i>e.MAX_SAFE_INTEGER?1/0:i},t.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.prototype.enumeratedString=function(e){return this[e]},t.prototype.decimalResolution=function(e){var t=i.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},t.parseAttrList=function(e){var t,i={};for(n.lastIndex=0;null!==(t=n.exec(e));){var s=t[2];0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1&&(s=s.slice(1,-1)),i[t[1]]=s}return i},t}();t.default=s}).call(this,i("./src/polyfills/number.js").Number)},"./src/utils/binary-search.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={search:function(e,t){for(var i=0,n=e.length-1,s=null,r=null;i<=n;){var a=t(r=e[s=(i+n)/2|0]);if(a>0)i=s+1;else{if(!(a<0))return r;n=s-1}}return null}}},"./src/utils/buffer-helper.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var i=e.buffered,n=0;n<i.length;n++)if(t>=i.start(n)&&t<=i.end(n))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,i){try{if(e){var n=e.buffered,s=[],r=void 0;for(r=0;r<n.length;r++)s.push({start:n.start(r),end:n.end(r)});return this.bufferedInfo(s,t,i)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,i){var n,s,r,a,o,l=[];for(e.sort(function(e,t){return e.start-t.start||t.end-e.end}),o=0;o<e.length;o++){var d=l.length;if(d){var u=l[d-1].end;e[o].start-u<i?e[o].end>u&&(l[d-1].end=e[o].end):l.push(e[o])}else l.push(e[o])}for(o=0,n=0,s=r=t;o<l.length;o++){var c=l[o].start,h=l[o].end;if(t+i>=c&&t<h)s=c,n=(r=h)-t;else if(t+i<c){a=c;break}}return{len:n,start:s,end:r,nextStart:a}},e}();t.BufferHelper=n},"./src/utils/cea-608-parser.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},s=function(e){var t=e;return n.hasOwnProperty(e)&&(t=n[e]),String.fromCharCode(t)},r=15,a=100,o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},l={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},u={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],h={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e],this.verboseLevel}},p=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].toString(16));return t},f=function(){function e(e,t,i,n,s){this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=n||"black",this.flash=s||!1}return e.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.prototype.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}},e.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},e.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},e.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),v=function(){function e(e,t,i,n,s,r){this.uchar=e||" ",this.penState=new f(t,i,n,s,r)}return e.prototype.reset=function(){this.uchar=" ",this.penState.reset()},e.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},e.prototype.setPenState=function(e){this.penState.copy(e)},e.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},e.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},e.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),g=function(){function e(){this.chars=[];for(var e=0;e<a;e++)this.chars.push(new v);this.pos=0,this.currPenState=new f}return e.prototype.equals=function(e){for(var t=!0,i=0;i<a;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<a;t++)this.chars[t].copy(e.chars[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<a;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},e.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(h.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>a&&(h.log("ERROR","Too large cursor position "+this.pos),this.pos=a)},e.prototype.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},e.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.prototype.insertChar=function(e){e>=144&&this.backSpace();var t=s(e);this.pos>=a?h.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},e.prototype.clearFromPos=function(e){var t;for(t=e;t<a;t++)this.chars[t].reset()},e.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.prototype.getTextString=function(){for(var e=[],t=!0,i=0;i<a;i++){var n=this.chars[i].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},e.prototype.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),_=function(){function e(){this.rows=[];for(var e=0;e<r;e++)this.rows.push(new g);this.currRow=r-1,this.nrRollUpRows=null,this.reset()}return e.prototype.reset=function(){for(var e=0;e<r;e++)this.rows[e].clear();this.currRow=r-1},e.prototype.equals=function(e){for(var t=!0,i=0;i<r;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<r;t++)this.rows[t].copy(e.rows[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<r;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},e.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},e.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.prototype.insertChar=function(e){this.rows[this.currRow].insertChar(e)},e.prototype.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},e.prototype.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},e.prototype.setCursor=function(e){h.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},e.prototype.setPAC=function(e){h.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<r;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var a=s.rows[n].cueStartTime;if(a&&a<h.time)for(i=0;i<this.nrRollUpRows;i++)this.rows[t-this.nrRollUpRows+i+1].copy(s.rows[n+i])}}this.currRow=t;var o=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,d=Math.max(l-1,0);o.setCursor(e.indent),e.color=o.chars[d].penState.foreground}var u={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(u)},e.prototype.setBkgData=function(e){h.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},e.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},e.prototype.rollUp=function(){if(null!==this.nrRollUpRows){h.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),h.log("INFO","Rolling up")}else h.log("DEBUG","roll_up but nrRollUpRows not set yet")},e.prototype.getDisplayText=function(e){e=e||!1;for(var t=[],i="",n=-1,s=0;s<r;s++){var a=this.rows[s].getTextString();a&&(n=s+1,e?t.push("Row "+n+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i},e.prototype.getTextAndFormat=function(){return this.rows},e}(),m=function(){function e(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new _,this.nonDisplayedMemory=new _,this.lastOutputScreen=new _,this.currRollUpRow=this.displayedMemory.rows[r-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[r-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},e.prototype.getHandler=function(){return this.outputFilter},e.prototype.setHandler=function(e){this.outputFilter=e},e.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},e.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},e.prototype.setMode=function(e){e!==this.mode&&(this.mode=e,h.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},e.prototype.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";h.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(h.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.prototype.ccRCL=function(){h.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.prototype.ccBS=function(){h.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.prototype.ccAOF=function(){},e.prototype.ccAON=function(){},e.prototype.ccDER=function(){h.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.prototype.ccRU=function(e){h.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},e.prototype.ccFON=function(){h.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.prototype.ccRDC=function(){h.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.prototype.ccTR=function(){h.log("INFO","TR"),this.setMode("MODE_TEXT")},e.prototype.ccRTD=function(){h.log("INFO","RTD"),this.setMode("MODE_TEXT")},e.prototype.ccEDM=function(){h.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.prototype.ccCR=function(){h.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.prototype.ccENM=function(){h.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.prototype.ccEOC=function(){if(h.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,h.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.prototype.ccTO=function(e){h.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},e.prototype.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}h.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},e.prototype.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=h.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},e.prototype.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),E=function(){function e(e,t,i){this.field=e||1,this.outputs=[t,i],this.channels=[new m(1,t),new m(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return e.prototype.getHandler=function(e){return this.channels[e].getHandler()},e.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},e.prototype.addData=function(e,t){var i,n,s,r=!1;this.lastTime=e,h.setTime(e);for(var a=0;a<t.length;a+=2)n=127&t[a],s=127&t[a+1],0!==n||0!==s?(h.log("DATA","["+p([t[a],t[a+1]])+"] -> ("+p([n,s])+")"),(i=this.parseCmd(n,s))||(i=this.parseMidrow(n,s)),i||(i=this.parsePAC(n,s)),i||(i=this.parseBackgroundAttributes(n,s)),!i&&(r=this.parseChars(n,s))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(r):h.log("WARNING","No channel found yet. TEXT-MODE?")),i?this.dataCounters.cmd+=2:r?this.dataCounters.char+=2:(this.dataCounters.other+=2,h.log("WARNING","Couldn't parse cleaned data "+p([n,s])+" orig: "+p([t[a],t[a+1]])))):this.dataCounters.padding+=2},e.prototype.parseCmd=function(e,t){var i;if(!((20===e||28===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,h.log("DEBUG","Repeated command ("+p([e,t])+") is dropped"),!0;i=20===e||23===e?1:2;var n=this.channels[i-1];return 20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},e.prototype.parseMidrow=function(e,t){var i=null;return(17===e||25===e)&&t>=32&&t<=47&&((i=17===e?1:2)!==this.currChNr?(h.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(t),h.log("DEBUG","MIDROW ("+p([e,t])+")"),!0))},e.prototype.parsePAC=function(e,t){var i,n;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;i=e<=23?1:2,n=t>=64&&t<=95?1===i?o[e]:d[e]:1===i?l[e]:u[e];var s=this.interpretPAC(n,t);return this.channels[i-1].setPAC(s),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},e.prototype.interpretPAC=function(e,t){var i,n={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,n.underline=1==(1&i),i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},e.prototype.parseChars=function(e,t){var i,n=null,r=null,a=null;(e>=25?(n=2,a=e-8):(n=1,a=e),a>=17&&a<=19)?(i=17===a?t+80:18===a?t+112:t+144,h.log("INFO","Special char '"+s(i)+"' in channel "+n),r=[i]):e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var o=p(r);h.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r},e.prototype.parseBackgroundAttributes=function(e,t){var i,n,s,r;return!(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47)||(i={},16===e||24===e?(n=Math.floor((t-32)/2),i.background=c[n],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0)),s=e<24?1:2,r=this.channels[s-1],r.setBkgData(i),this.lastCmdA=null,this.lastCmdB=null,0))},e.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},e.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}();t.default=E},"./src/utils/codecs.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};t.isCodecType=function(e,t){var i=n[t];return!!i&&!0===i[e.slice(0,4)]},t.isCodecSupportedInMp4=function(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/vttparser.js");t.newCue=function(e,t,i,s){for(var r,a,o,l,d,u=window.VTTCue||window.TextTrackCue,c=0;c<s.rows.length;c++)if(o=!0,l=0,d="",!(r=s.rows[c]).isEmpty()){for(var h=0;h<r.chars.length;h++)r.chars[h].uchar.match(/\s/)&&o?l++:(d+=r.chars[h].uchar,o=!1);r.cueStartTime=t,t===i&&(i+=1e-4),a=new u(t,i,n.fixLineBreaks(d.trim())),l>=16?l--:l++,navigator.userAgent.match(/Firefox\//)?a.line=c+1:a.line=c>7?c-2:c+1,a.align="left",a.position=Math.max(0,Math.min(100,l/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(a)}}},"./src/utils/discontinuities.js":function(e,t,i){"use strict";(function(e){function n(e,t){for(var i=null,n=0;n<e.length;n+=1){var s=e[n];if(s&&s.cc===t){i=s;break}}return i}function s(e,t,i){var n=!1;return t&&t.details&&i&&(i.endCC>i.startCC||e&&e.cc<i.startCC)&&(n=!0),n}function r(e,t){var i=e.fragments,s=t.fragments;if(s.length&&i.length){var r=n(i,s[0].cc);return!r||r&&!r.startPTS?void u.logger.log("No frag in previous level to align on"):r}u.logger.log("No fragments to align")}function a(e,t){t.fragments.forEach(function(t){if(t){var i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}),t.PTSKnown=!0}function o(e,t,i){if(s(e,i,t)){var n=r(i.details,t);n&&(u.logger.log("Adjusting PTS using last level due to CC increase within current level"),a(n.start,t))}}function l(t,i){if(i&&i.fragments.length){if(!t.hasProgramDateTime||!i.hasProgramDateTime)return;var n=i.fragments[0].programDateTime,s=(t.fragments[0].programDateTime-n)/1e3+i.fragments[0].start;e.isFinite(s)&&(u.logger.log("adjusting PTS using programDateTime delta, sliding:"+s.toFixed(3)),a(s,t))}}Object.defineProperty(t,"__esModule",{value:!0});var d=i("./src/utils/binary-search.js"),u=i("./src/utils/logger.js");t.findFirstFragWithCC=n,t.findFragWithCC=function(e,t){return d.default.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})},t.shouldAlignOnDiscontinuities=s,t.findDiscontinuousReferenceFrag=r,t.adjustPts=a,t.alignStream=function(e,t,i){o(e,i,t),!i.PTSKnown&&t&&l(i,t.details)},t.alignDiscontinuities=o,t.alignPDT=l}).call(this,i("./src/polyfills/number.js").Number)},"./src/utils/ewma-bandwidth-estimator.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/ewma.js"),s=function(){function e(e,t,i,s){this.hls=e,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new n.default(t),this.fast_=new n.default(i)}return e.prototype.sample=function(e,t){var i=8e3*t/(e=Math.max(e,this.minDelayMs_)),n=e/1e3;this.fast_.sample(n,i),this.slow_.sample(n,i)},e.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},e.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.prototype.destroy=function(){},e}();t.default=s},"./src/utils/ewma.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}return e.prototype.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},e.prototype.getTotalWeight=function(){return this.totalWeight_},e.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}();t.default=n},"./src/utils/get-self-scope.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},"./src/utils/logger.js":function(e,t,i){"use strict";function n(){}function s(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];t.forEach(function(t){o[t]=e[t]?e[t].bind(e):function(e){var t=l.console[e];return t?function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];i[0]&&(i[0]=function(e,t){return"["+e+"] > "+t}(e,i[0])),t.apply(l.console,i)}:n}(t)})}Object.defineProperty(t,"__esModule",{value:!0});var r=i("./src/utils/get-self-scope.js"),a={trace:n,debug:n,log:n,warn:n,info:n,error:n},o=a,l=r.getSelfScope();t.enableLogs=function(e){if(!0===e||"object"==typeof e){s(e,"debug","log","info","warn","error");try{o.log()}catch(e){o=a}}else o=a},t.logger=o},"./src/utils/mediakeys-helper.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;t.requestMediaKeySystemAccess=n},"./src/utils/mediasource-helper.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaSource=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}},"./src/utils/output-filter.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.timelineController=e,this.trackName=t,this.startTime=null,this.endTime=null,this.screen=null}return e.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},e.prototype.newCue=function(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},e}();t.default=n},"./src/utils/texttrack-utils.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendAddTrackEvent=function(e,t){var i=null;try{i=new window.Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)},t.clearCurrentCues=function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},"./src/utils/time-ranges.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={toString:function(e){for(var t="",i=e.length,n=0;n<i;n++)t+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return t}}},"./src/utils/vttcue.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e){return"string"==typeof e&&!!r[e.toLowerCase()]&&e.toLowerCase()}function t(e){return"string"==typeof e&&!!a[e.toLowerCase()]&&e.toLowerCase()}function i(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}function n(n,r,a){var o=this,l=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),d={};l?o=document.createElement("custom"):d.enumerable=!0,o.hasBeenReset=!1;var u="",c=!1,h=n,p=r,f=a,v=null,g="",_=!0,m="auto",E="start",y=50,A="middle",S=50,b="middle";if(Object.defineProperty(o,"id",i({},d,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},d,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(o,"startTime",i({},d,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},d,{get:function(){return p},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},d,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},d,{get:function(){return v},set:function(e){v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},d,{get:function(){return g},set:function(t){var i=e(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},d,{get:function(){return _},set:function(e){_=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},d,{get:function(){return m},set:function(e){if("number"!=typeof e&&e!==s)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},d,{get:function(){return E},set:function(e){var i=t(e);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");E=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},d,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},d,{get:function(){return A},set:function(e){var i=t(e);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");A=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},d,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},d,{get:function(){return b},set:function(e){var i=t(e);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");b=i,this.hasBeenReset=!0}})),o.displayState=void 0,l)return o}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var s="auto",r={"":!0,lr:!0,rl:!0},a={start:!0,middle:!0,end:!0,left:!0,right:!0};return n.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},n}()},"./src/utils/vttparser.js":function(e,t,i){"use strict";function n(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new d,this.regionList=[]}function s(){this.values=Object.create(null)}function r(e,t,i,n){var s=n?e.split(n):[e];for(var r in s)if("string"==typeof s[r]){var a=s[r].split(i);2===a.length&&t(a[0],a[1])}}function a(e,t,i){function n(){var t=function(e){function t(e,t,i,n){return 3600*(0|e)+60*(0|t)+(0|i)+(0|n)/1e3}var i=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?t(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?t(i[1],i[2],0,i[4]):t(0,i[1],i[2],i[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+o);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}var o=e;if(a(),t.startTime=n(),a(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+o);e=e.substr(3),a(),t.endTime=n(),a(),function(e,t){var n=new s;r(e,function(e,t){switch(e){case"region":for(var s=i.length-1;s>=0;s--)if(i[s].id===t){n.set(e,i[s].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":var r=t.split(","),a=r[0];n.integer(e,a),n.percent(e,a)&&n.set("snapToLines",!1),n.alt(e,a,["auto"]),2===r.length&&n.alt("lineAlign",r[1],["start",c,"end"]);break;case"position":r=t.split(","),n.percent(e,r[0]),2===r.length&&n.alt("positionAlign",r[1],["start",c,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",c,"end","left","right"])}},/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");var a=n.get("line","auto");"auto"===a&&-1===u.line&&(a=-1),t.line=a,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",c);var o=n.get("position","auto");"auto"===o&&50===u.position&&(o="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=o}(e,t)}function o(e){return e.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(t,"__esModule",{value:!0});var l=i("./src/utils/vttcue.js"),d=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};s.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var u=new l.default(0,0,0),c="middle"===u.align?"middle":"center";t.fixLineBreaks=o,n.prototype={parse:function(e){function t(){var e=n.buffer,t=0;for(e=o(e);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var i=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,n.buffer=e.substr(t),i}function i(e){r(e,function(e,t){},/:/)}var n=this;e&&(n.buffer+=n.decoder.decode(e,{stream:!0}));try{var s=void 0;if("INITIAL"===n.state){if(!/\r\n|\n/.test(n.buffer))return this;var d=(s=t()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!d||!d[0])throw new Error("Malformed WebVTT signature.");n.state="HEADER"}for(var u=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(u?u=!1:s=t(),n.state){case"HEADER":/:/.test(s)?i(s):s||(n.state="ID");continue;case"NOTE":s||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){n.state="NOTE";break}if(!s)continue;if(n.cue=new l.default(0,0,""),n.state="CUE",-1===s.indexOf("--\x3e")){n.cue.id=s;continue}case"CUE":try{a(s,n.cue,n.regionList)}catch(e){n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":var c=-1!==s.indexOf("--\x3e");if(!s||c&&(u=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}n.cue.text&&(n.cue.text+="\n"),n.cue.text+=s;continue;case"BADCUE":s||(n.state="ID");continue}}}catch(e){"CUETEXT"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state="INITIAL"===n.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return e.onflush&&e.onflush(),this}},t.default=n},"./src/utils/webvtt-parser.js":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/vttparser.js"),s=i("./src/demux/id3.js"),r=function(e,t,i){return e.substr(i||0,t.length)===t},a=function(t){var i=parseInt(t.substr(-3)),n=parseInt(t.substr(-6,2)),s=parseInt(t.substr(-9,2)),r=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;return e.isFinite(i)&&e.isFinite(n)&&e.isFinite(s)&&e.isFinite(r)?(i+=1e3*n,i+=6e4*s,i+=36e5*r):-1},o=function(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()},l={parse:function(e,t,i,l,d,u){var c,h=s.utf8ArrayToStr(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),p="00:00.000",f=0,v=0,g=0,_=[],m=!0,E=new n.default;E.oncue=function(e){var t=i[l],n=i.ccOffset;t&&t.new&&(void 0!==v?n=i.ccOffset=t.start:function(e,t,i){var n=e[t],s=e[n.prevCC];if(!s||!s.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;s&&s.new;)e.ccOffset+=n.start-s.start,n.new=!1,s=e[(n=s).prevCC];e.presentationOffset=i}(i,l,g)),g&&(n=g-i.presentationOffset),e.startTime+=n-v,e.endTime+=n-v,e.id=o(e.startTime.toString())+o(e.endTime.toString())+o(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&_.push(e)},E.onparsingerror=function(e){c=e},E.onflush=function(){c&&u?u(c):d(_)},h.forEach(function(e){if(m){if(r(e,"X-TIMESTAMP-MAP=")){m=!1,e.substr(16).split(",").forEach(function(e){r(e,"LOCAL:")?p=e.substr(6):r(e,"MPEGTS:")&&(f=parseInt(e.substr(7)))});try{t+(9e4*i[l].start||0)<0&&(t+=8589934592),f-=t,v=a(p)/1e3,g=f/9e4,-1===v&&(c=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){c=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(m=!1)}E.parse(e+"\n")}),E.flush()}};t.default=l}).call(this,i("./src/polyfills/number.js").Number)},"./src/utils/xhr-loader.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/utils/logger.js"),s=window.performance,r=window.XMLHttpRequest,a=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return e.prototype.destroy=function(){this.abort(),this.loader=null},e.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.prototype.load=function(e,t,i){this.context=e,this.config=t,this.callbacks=i,this.stats={trequest:s.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},e.prototype.loadInternal=function(){var e,t=this.context;e=this.loader=new r;var i=this.stats;i.tfirst=0,i.loaded=0;var n=this.xhrSetup;try{if(n)try{n(e,t.url)}catch(i){e.open("GET",t.url,!0),n(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(i){return void this.callbacks.onError({code:e.status,text:i.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},e.prototype.readystatechange=function(e){var t=e.currentTarget,i=t.readyState,r=this.stats,a=this.context,o=this.config;if(!r.aborted&&i>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(s.now(),r.trequest)),4===i){var l=t.status;if(l>=200&&l<300){r.tload=Math.max(r.tfirst,s.now());var d=void 0,u=void 0;u="arraybuffer"===a.responseType?(d=t.response).byteLength:(d=t.responseText).length,r.loaded=r.total=u;var c={url:t.responseURL,data:d};this.callbacks.onSuccess(c,r,a,t)}else r.retry>=o.maxRetry||l>=400&&l<499?(n.logger.error(l+" while loading "+a.url),this.callbacks.onError({code:l,text:t.statusText},a,t)):(n.logger.warn(l+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},e.prototype.loadtimeout=function(){n.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.prototype.loadprogress=function(e){var t=e.currentTarget,i=this.stats;i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total);var n=this.callbacks.onProgress;n&&n(i,this.context,null,t)},e}();t.default=a}}).default}),function(t){"use strict";function i(e,t){var i=t||0,n=u;return n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]}function n(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new d(16):null,e=null);var a=(e=e||{}).random||(e.rng||s)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;o++)t[r+o]=a[o];return t||i(a)}var s,r,a,o,l;t?function(){var e=t.crypto||t.msCrypto;if(!s&&e&&e.getRandomValues)try{var i=new Uint8Array(16);o=s=function(){return e.getRandomValues(i),i},s()}catch(e){}if(!s){var n=new Array(16);r=s=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}():function(){if("function"==typeof e)try{var t=e("crypto").randomBytes;a=s=t&&function(){return t(16)},s()}catch(t){}}();for(var d="function"==typeof Buffer?Buffer:Array,u=[],c={},h=0;h<256;h++)u[h]=(h+256).toString(16).substr(1),c[u[h]]=h;var p=s(),f=[1|p[0],p[1],p[2],p[3],p[4],p[5]],v=16383&(p[6]<<8|p[7]),g=0,_=0,m=n;m.v1=function(e,t,n){var s=t&&n||0,r=t||[],a=null!=(e=e||{}).clockseq?e.clockseq:v,o=null!=e.msecs?e.msecs:(new Date).getTime(),l=null!=e.nsecs?e.nsecs:_+1,d=o-g+(l-_)/1e4;if(d<0&&null==e.clockseq&&(a=a+1&16383),(d<0||o>g)&&null==e.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=o,_=l,v=a;var u=(1e4*(268435455&(o+=122192928e5))+l)%4294967296;r[s++]=u>>>24&255,r[s++]=u>>>16&255,r[s++]=u>>>8&255,r[s++]=255&u;var c=o/4294967296*1e4&268435455;r[s++]=c>>>8&255,r[s++]=255&c,r[s++]=c>>>24&15|16,r[s++]=c>>>16&255,r[s++]=a>>>8|128,r[s++]=255&a;for(var h=e.node||f,p=0;p<6;p++)r[s+p]=h[p];return t||i(r)},m.v4=n,m.parse=function(e,t,i){var n=t&&i||0,s=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){s<16&&(t[n+s++]=c[e])});s<16;)t[n+s++]=0;return t},m.unparse=i,m.BufferClass=d,m._rng=s,m._mathRNG=r,m._nodeRNG=a,m._whatwgRNG=o,"undefined"!=typeof module&&module.exports?module.exports=m:(l=t.uuid,m.noConflict=function(){return t.uuid=l,m},t.uuid=m)}("undefined"!=typeof window?window:null),function(){function e(e){var t=e.__resizeTriggers__,i=t.firstElementChild,n=t.lastElementChild,s=i.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,s.style.width=i.offsetWidth+1+"px",s.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}function t(t){var i=this;e(this),this.__resizeRAF__&&a(this.__resizeRAF__),this.__resizeRAF__=r(function(){var e;((e=i).offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height)&&(i.__resizeLast__.width=i.offsetWidth,i.__resizeLast__.height=i.offsetHeight,i.__resizeListeners__.forEach(function(e){e.call(i,t)}))})}function i(){if(!s){var e=(v||"")+".resize-triggers { "+(g||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t.appendChild(i),s=!0}}var n=document.attachEvent,s=!1;if(!n){var r=function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)};return function(t){return e(t)}}(),a=function(){var e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(t){return e(t)}}(),o=!1,l="",d="animationstart",u="Webkit Moz O ms".split(" "),c="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),h=document.createElement("fakeelement");if(void 0!==h.style.animationName&&(o=!0),!1===o)for(var p=0;p<u.length;p++)if(void 0!==h.style[u[p]+"AnimationName"]){l="-"+u[p].toLowerCase()+"-",d=c[p],o=!0;break}var f="resizeanim",v="@"+l+"keyframes "+f+" { from { opacity: 0; } to { opacity: 0; } } ",g=l+"animation: 1ms "+f+"; "}window.addResizeListener=function(s,r){n?s.attachEvent("onresize",r):(s.__resizeTriggers__||("static"==getComputedStyle(s).position&&(s.style.position="relative"),i(),s.__resizeLast__={},s.__resizeListeners__=[],(s.__resizeTriggers__=document.createElement("div")).className="resize-triggers",s.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',s.appendChild(s.__resizeTriggers__),e(s),s.addEventListener("scroll",t,!0),d&&s.__resizeTriggers__.addEventListener(d,function(t){t.animationName==f&&e(s)})),s.__resizeListeners__.push(r))},window.removeResizeListener=function(e,i){n?e.detachEvent("onresize",i):(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(i),1),e.__resizeListeners__.length||(e.removeEventListener("scroll",t),e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)))}}(),function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.Spinner=t()}(this,function(){"use strict";function e(e,t){var i,n=document.createElement(e||"div");for(i in t)n[i]=t[i];return n}function t(e){for(var t=1,i=arguments.length;i>t;t++)e.appendChild(arguments[t]);return e}function i(e,t,i,n){var s=["opacity",t,~~(100*e),i,n].join("-"),r=.01+i/n*100,a=Math.max(1-(1-e)/t*(100-r),e),o=l.substring(0,l.indexOf("Animation")).toLowerCase(),u=o&&"-"+o+"-"||"";return c[s]||(d.insertRule("@"+u+"keyframes "+s+"{0%{opacity:"+a+"}"+r+"%{opacity:"+e+"}"+(r+.01)+"%{opacity:1}"+(r+t)%100+"%{opacity:"+e+"}100%{opacity:"+a+"}}",d.cssRules.length),c[s]=1),s}function n(e,t){var i,n,s=e.style;if(void 0!==s[t=t.charAt(0).toUpperCase()+t.slice(1)])return t;for(n=0;n<u.length;n++)if(void 0!==s[i=u[n]+t])return i}function s(e,t){for(var i in t)e.style[n(e,i)||i]=t[i];return e}function r(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)void 0===e[n]&&(e[n]=i[n])}return e}function a(e,t){return"string"==typeof e?e:e[t%e.length]}function o(e){this.opts=r(e||{},o.defaults,h)}var l,d,u=["webkit","Moz","ms","O"],c={},h={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(o.defaults={},r(o.prototype,{spin:function(t){this.stop();var i=this,n=i.opts,r=i.el=e(null,{className:n.className});if(s(r,{position:n.position,width:0,zIndex:n.zIndex,left:n.left,top:n.top}),t&&t.insertBefore(r,t.firstChild||null),r.setAttribute("role","progressbar"),i.lines(r,i.opts),!l){var a,o=0,d=(n.lines-1)*(1-n.direction)/2,u=n.fps,c=u/n.speed,h=(1-n.opacity)/(c*n.trail/100),p=c/n.lines;!function e(){o++;for(var t=0;t<n.lines;t++)a=Math.max(1-(o+(n.lines-t)*p)%c*h,n.opacity),i.opacity(r,t*n.direction+d,a,n);i.timeout=i.el&&setTimeout(e,~~(1e3/u))}()}return i},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(n,r){function o(t,i){return s(e(),{position:"absolute",width:r.scale*(r.length+r.width)+"px",height:r.scale*r.width+"px",background:t,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/r.lines*u+r.rotate)+"deg) translate("+r.scale*r.radius+"px,0)",borderRadius:(r.corners*r.scale*r.width>>1)+"px"})}for(var d,u=0,c=(r.lines-1)*(1-r.direction)/2;u<r.lines;u++)d=s(e(),{position:"absolute",top:1+~(r.scale*r.width/2)+"px",transform:r.hwaccel?"translate3d(0,0,0)":"",opacity:r.opacity,animation:l&&i(r.opacity,r.trail,c+u*r.direction,r.lines)+" "+1/r.speed+"s linear infinite"}),r.shadow&&t(d,s(o("#000","0 0 4px #000"),{top:"2px"})),t(n,t(d,o(a(r.color,u),"0 0 1px rgba(0,0,0,.1)")));return n},opacity:function(e,t,i){t<e.childNodes.length&&(e.childNodes[t].style.opacity=i)}}),"undefined"!=typeof document){d=function(){var i=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}();var p=s(e("group"),{behavior:"url(#default#VML)"});!n(p,"transform")&&p.adj?function(){function i(t,i){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}d.addRule(".spin-vml","behavior:url(#default#VML)"),o.prototype.lines=function(e,n){function r(){return s(i("group",{coordsize:u+" "+u,coordorigin:-d+" "+-d}),{width:u,height:u})}function o(e,o,l){t(h,t(s(r(),{rotation:360/n.lines*e+"deg",left:~~o}),t(s(i("roundrect",{arcsize:n.corners}),{width:d,height:n.scale*n.width,left:n.scale*n.radius,top:-n.scale*n.width>>1,filter:l}),i("fill",{color:a(n.color,e),opacity:n.opacity}),i("stroke",{opacity:0}))))}var l,d=n.scale*(n.length+n.width),u=2*n.scale*d,c=-(n.width+n.length)*n.scale*2+"px",h=s(r(),{position:"absolute",top:c,left:c});if(n.shadow)for(l=1;l<=n.lines;l++)o(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=n.lines;l++)o(l);return t(e,h)},o.prototype.opacity=function(e,t,i,n){var s=e.firstChild;n=n.shadow&&n.lines||0,s&&t+n<s.childNodes.length&&(s=(s=(s=s.childNodes[t+n])&&s.firstChild)&&s.firstChild)&&(s.opacity=i)}}():l=n(p,"animation")}return o}),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_BUFFERING:"onAdBuffering",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},ErrorCode:{1001:"1200",1002:"",1003:"",2000:"1000",2001:"1101",2002:"1100",2003:"1106",2004:"2004",2005:"2000",3000:"3400",3001:"3100",3002:"3001",3003:"3200",3004:"3101",3005:"",3006:"3002",3007:"3102",3008:"3202",3009:"3401",3011:"3300",3012:"3301",3013:"",4000:"4000",4001:"4300"},mapErrorCode:function(e){return uvpjs.ErrorCode[e]||e},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam"},getVideoManager:function(){return uvpjs.VideoManager.getInstance()},register:function(e){var t,i,n=e.split("."),s=window,r=n.length;for(t=0;t<r;t++)void 0===s[i=n[t]]&&(s[i]={}),s=s[i];return s},getClass:function(e){var t,i,n,s,r,a;if("string"!=typeof e)return e;for(t=e.split("."),i=window,n=t.length,s="",r=0;r<n;r++){if(s+=a=t[r],void 0===i[a])throw new Error("uvpjs.getClass(): "+s+" is undefined.");r<n-1&&(s+="."),i=i[a]}return i},getObject:function(e){return uvpjs.getClass(e)}},function(){var e=!1,t=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(i){function n(){!e&&this.init&&this.init.apply(this,arguments)}var s,r,a,o,l=this.prototype;for(o in e=!0,r=new this,e=!1,s=function(e,t){return function(){var i,n=this._super;return this._super=l[e],i=t.apply(this,arguments),this._super=n,i}},i)i.hasOwnProperty(o)&&(a=i[o],r[o]="function"==typeof a&&"function"==typeof l[o]&&t.test(a)?s(o,a):a);return n.prototype=r,n.prototype.constructor=n,n.subClass=arguments.callee,n}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),uvpjs.register("uvpjs").b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",function(e){"use strict";uvpjs.register("uvpjs").util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(e){return e&&this.xhrMessages[e]||"XHR status: "+e},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(e){var t=document.createElement("a");return t.href=e,{host:t.hostname,pathname:t.pathname,protocol:t.protocol,search:t.search}},objFromQueryStr:function(e){var t,i,n,s="string"==typeof e?e:"",r=(s.indexOf("?")>-1?s.split("?")[1]:s).split("&"),a={};for(i=0,n=r.length;i<n;i++)a[(t=r[i].split("="))[0]]=t[1];return a},queryStrFromObj:function(e,t){var i,n="",s=!1;for(i in e)n+=(s?"&":"")+i+"="+(t?encodeURIComponent(e[i]):e[i]),s=!0;return n},uid8:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()},getUserStatusForQuery:function(e){var t="";switch(e){case"anon":t="sb=0";break;case"reg;sub;pay":t="sb=1";break;case"reg":t="sb=2";break;case"reg;sub;susp":t="sb=3";break;case"reg;sub;exsub":t="sb=4";break;case"reg;sub;trial":t="sb=5";break;default:if(e.indexOf("|")>-1){var i,n,s,r,a="",o=e.split(","),l=o.length;for(o.sort(),r=0;r<l;r++)2==(i=o[r].split("|")).length&&(n=i[0],s=i[1],a!=n?(t.length>0&&(t+="&"),t+=n+"="+s):t+=","+s,a=n)}}return""==t&&(t="sb=0"),t},firstInt:function(){var e,t,i=arguments.length;for(t=0;t<i;t++)if(e=arguments[t],parseInt(e)===e)return e},inRange:function(e,t,i){return"number"==typeof e&&e>=t&&e<=i},isEmpty:function(e){return null==e||Array.isArray(e)&&0===e.length||"object"==typeof e&&0===Object.keys(e).length||"string"==typeof e&&""===e},isPlainObject:function(e){return e&&"object"==typeof e&&e.constructor===Object},isFunction:function(e){return"function"==typeof e},isDefinedString:function(e){return!!(e&&"string"==typeof e&&e.length>0)},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isDefined:function(e){return void 0!==e},isFlagTrue:function(e){return!0===e||"true"===e||1===e||"1"===e},getDefinedString:function(){var e,t,i=arguments.length;for(t=0;t<i;t++)if(e=arguments[t],this.isDefinedString(e))return e;return""},supportsLocalStorage:function(){var e,t="test";if(null===this.isLocalStorageSupported)try{localStorage.setItem(t,"1"),e=localStorage.getItem(t),this.isLocalStorageSupported="1"===e,localStorage.removeItem(t)}catch(e){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild},createStyleSheet:function(e,t){var i,n,s,r,a,o,l,d,u,c,h=document.styleSheets,p=h.length;for(u=function(){c||(e(a),c=!0)},i=0;i<p;i++){a=h[i];try{if((a.href&&a.href.replace(/http(s)?:/,""))===t)return void u()}catch(e){}}n="string"==typeof t&&""!==t,s=uvpjs.mediaCapabilities.isFirefox(),r=!n||s?"style":"link",(a=document.createElement(r)).setAttribute("type","text/css"),a.appendChild(document.createTextNode("")),n&&(a.setAttribute("rel","stylesheet"),a.setAttribute("href",t),a.textContent='@import "'+t+'"'),"function"==typeof e&&(a.onload=u,a.addEventListener&&a.addEventListener("load",u,!1),a.onreadystatechange=function(){"loaded"!==(o=a.readyState)&&"complete"!==o||(link.onreadystatechange=null,u())},l=setInterval(function(){document.styleSheets.length>p&&(u(),clearInterval(l))},10),s&&(d=setInterval(function(){try{a.sheet.cssRules,clearInterval(d),u()}catch(e){}},10)),document.getElementsByTagName("head")[0].appendChild(a))},addCSSObject:function(e,t,i,n){var s,r=uvpjs.util,a="#"+t.id+" "+(n||"");for(s in i)r.addCSSRule(e,a,s,i[s])},addCSSRule:function(e,t,i,n){var s,r,a,o=uvpjs.mediaCapabilities,l="string"==typeof n&&n.match(/NaN(%|px)/);if(e&&e.sheet)if(!l||o.isAndroid()&&o.isChrome()||(n="0"),r=((s=e.sheet).rules||s.cssRules).length,a=i+":"+n+";",s.insertRule)try{s.insertRule(t+"{"+a+"}",r)}catch(e){console.warn("Unable to add CSS rule: "+e.message)}else s.addRule&&s.addRule(t,a,r)},addCSSRules:function(e,t,i){for(var n,s=i.length;s--;)n=i[s],uvpjs.util.addCSSRule(e,t,n.name,n.value)},copyObjectWithKeyMap:function(e){var t=e,i=null;return this.from=function(e){return i=e,this},this.to=function(e){if(!(t&&i&&e))return e;for(var n in t)t.hasOwnProperty(n)&&i.hasOwnProperty(n)&&null!==i[n]&&(e[t[n]]=i[n]);return e},this}}}(),function(e){var t=uvpjs._,i=/\{mediaReferenceId}/g,n=/PARTNER/g,s=/\{ptype}/g,r=/\{VGUID}/g,a=/%7Bptype%7D/g,o=/%7BVGUID%7D/g,l=/;/g;e.adUtil={MOAT_PARTNER_CODE:"cbsiimajsint708425247896",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(e,l,d,u){var c,h,p,f,v,g,_,m,E=uvpjs.util,y="cust_params",A=e.split("?"),S=A[1],b=e.indexOf("%7Bptype%7D")>-1,T=e.indexOf("{ptype}")>-1,D=this.getAdParams(l,d,u);return S=S.replace(i,D.vid).replace(n,D.partner),b&&(S=S.replace(o,D.vguid).replace(a,D.ptype)),T&&(S=S.replace(r,D.vguid).replace(s,D.ptype)),h=E.objFromQueryStr(S),this.isExcludedFromVpaid(l)&&delete h.pp,(p=h[y])&&(c=E.objFromQueryStr(decodeURIComponent(p)),delete h[y]),f=D[y],delete D[y],delete D.partner,delete D.vguid,delete D.ptype,v=t.assign(D,h),g=t.assign(f,c||{}),decodeURIComponent(v.iu).indexOf("/8264/")>=0&&l.isMuteAtPlayStart&&!l.userHasUnmuted&&(v.sz="640x483"),this.removeEmpty(v),this.removeEmpty(g),_=E.queryStrFromObj(v,!1),m=E.queryStrFromObj(g,!1),_+="&"+y+"="+encodeURIComponent(m),A[0]+"?"+_},getAdParams:function(e,i,n){var s,r,a=e.dwPageParams,o=this.getDwViewGuid(e),l=this.getPpidValue(e),d=e.contentVideoState,u=encodeURIComponent(e.sessionOptions.partner),c=a.pagetype||"",h=this.getUserStatusKey(e.getSessionOption("userStatus")),p=""===d.contPlayState||uvpjs.util.isFlagTrue(n)?"0":"1",f=e.getSessionOption("isEmbedded")?"1":"0",v=this.getHost("1"===f,e),g=d.pid,_={cust_params:{}},m=uvpjs.Configuration.env,E=e.getAdCallParams();for(r in s=i?this.getVideoDfpId(e):"",_.vid=s,_.partner=u,_.ptype=c,_.vguid=o,_.cust_params.vguid=o,_.cust_params.embed=f,v&&(_.cust_params.host=v),this.populateCustParamsWithAdSessionValues(_.cust_params,g),d.podsToSkip.length>0&&(_.cust_params.resume=1,_.cust_params.skippod=d.podsToSkip),h)_.cust_params[r]=h[r];if(l&&(_.ppid=l,_.cust_params.ppid=l),"cbs"===u&&(_.cust_params.cpSession=p,_.cust_params.cpPre=p,_.cust_params.sub=t.isEmpty(e.sessionOptions.userId)?"":e.sessionOptions.userId),E&&!uvpjs.util.isEmpty(E.standardParams))for(r in E.standardParams)_[r]=E.standardParams[r];if(E&&!uvpjs.util.isEmpty(E.customParams))for(r in E.customParams)_.cust_params[r]=E.customParams[r];return this.isExcludedFromVpaid(e)?_.pp="ssai":("local"===m||"dev"===m)&&(_.pp="vpaid_js"),_},getVideoDfpId:function(e){return uvpjs.util.isEmpty(e.contentVideoState.dfpMediaId)?e.contentVideoState.cmsRefGuid:e.contentVideoState.dfpMediaId},isExcludedFromVpaid:function(e){return"AA Original"===e.contentVideoState.contentType},getDwViewGuid:function(e){var t=e.dwPageParams;return t&&t.viewguid||t.pguid||""},extractAdInfo:function(e,i){var n,s,r=i===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return uvpjs.util.isEmpty(e)||!i?(!i&&console.error("No 'context' arg supplied"),null):((n={adId:e.getAdId(),adSystem:e.getAdSystem(),creativeAdId:e.getCreativeAdId(),creativeId:e.getCreativeId()}).adPodInfo=this.extractPodInfo(e.getAdPodInfo()),s=this[r](e),t.assign(n,s))},extractAdStateData:function(e,t,i){var n=e.getAdPodInfo(),s=n.getPodIndex(),r=n.getAdPosition(),a=e.getDuration(),o=i?"mid":0===s?"pre":s>=1?"mid":-1===s?"post":"",l=("mid"!==o?o+"_0":"mid_"+s)+"_"+r,d=t===this.context.IMA,u=d?this.extractIdInfo(e):null,c=this.getAdStateBlank();return c.adPosition=r,c.adBitrate=e.getVastMediaBitrate?e.getVastMediaBitrate():NaN,c.adServerName=d?this.context.IMA:this.context.DAI,c.adVideoTitle=e.getTitle(),c.duration=a,c.adType=o,c.adClipID=l,c.wrapperAdId=d&&u.wrapperAdId||"",c.adVideoId=d?u.wrapperAdId||u.adId:e.getAdId(),c.creativeId=d?u.wrapperCreativeId||u.creativeId:e.getCreativeId(),t===this.context.DAI&&(c.sourceWidth=e.getVastMediaWidth(),c.sourceHeight=e.getVastMediaHeight()),c},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(e){var t=e.getWrapperAdIds(),i=e.getWrapperCreativeIds(),n=Array.isArray(t)&&t.length||0,s=Array.isArray(i)&&i.length||0,r=null,a=null,o=e.getAdId()||"",l=e.getCreativeId()||"";return n&&(n>1&&(r=t[1]),o=t[0]),s&&(s>1&&(a=i[1]),l=i[0]),{adId:o,wrapperAdId:r,creativeId:l,wrapperCreativeId:a}},getHost:function(e,t){var i,n;return e?(i=t.getSessionOption("referrer"))&&(n=uvpjs.util.parseUrl(i).host):n=window.location.hostname,n&&""!==n?n:null},getUserStatusKey:function(e){for(var t,i=uvpjs.util.getUserStatusForQuery(e).split("&"),n=i.length,s={};n--;)s[(t=i[n].split("="))[0]]=t[1];return s},trackAd:function(e){var t,i,n,s=e.model,r=e.context,a=s.getAdVideoState(),o=r===this.context.IMA,l=r===this.context.DAI;return o||l?(i=s.dwPageParams.pagetype||"",t={level1:"",level2:"",level3:a.adVideoId,level4:a.creativeId,slicer1:"vaw-can",slicer2:s.sessionOptions.partner,slicer3:i,moatVASTSystem:a.adServerName,moatVASTAdID:a.wrapperAdId},""!==(n=this.getDwViewGuid(s))&&(t.zMoatVGUID=n),""!==i&&(t.zMoatPT=i),this.initMoatTracking(e.adVideoContainer,t,a.duration,this.MOAT_PARTNER_CODE,null)):void console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(e){var t=this.getVpaidEventForEvent(e.eventName,e.context);t&&e.trackingHandle.dispatchEvent({type:t,adVolume:e.volume})},checkForAdBlocker:function(e){var t=e.getSessionOption("adBlockerCallback");return t&&t()},populateCustParamsWithAdSessionValues:function(e,t){var i,n,s;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(i=window.getVideoAdSessionValues(t))&&""!==i)for(s in i=i.replace(l,"&"),n=uvpjs.util.objFromQueryStr(i))e[s]=n[s]},removeEmpty:function(e){for(var t in e)(null===e[t]||""===e[t])&&delete e[t]},extractAdInfoIma:function(e){return{contentType:e.getContentType(),isLinear:e.isLinear()}},extractAdInfoDai:function(e){return{advertiserName:e.getAdvertiserName(),description:e.getDescription(),duration:e.getDuration(),title:e.getTitle()}},extractPodInfo:function(e){return e?{adPosition:e.getAdPosition(),podIndex:e.getPodIndex(),timeOffset:e.getTimeOffset(),totalAds:e.getTotalAds()}:null},getPpidValue:function(e){var t=e.getSessionOption("userPPID");return uvpjs.util.isDefinedString(t)?t:null},initMoatTracking:function(e,t,i,n,s){var r,a,o,l=document.createElement("script"),d=[];t={adData:{ids:t,duration:i,url:s},dispatchEvent:function(e){this.sendEvent?(d&&(d.push(e),e=d,d=!1),this.sendEvent(e)):d.push(e)}},o="_moatApi"+Math.floor(1e8*Math.random());try{a=(r=e.ownerDocument).defaultView||r.parentWindow}catch(e){a=window}return a[o]=t,l.type="text/javascript",e&&e.insertBefore(l,e.childNodes[0]||null),l.src="https://z.moatads.com/"+n+"/moatvideo.js#"+o,t},getVpaidEventForEvent:function(e,t){var i=this.moatEventMapping[t][e];return uvpjs.util.isEmpty(i)?null:this.vpaidEvents[i]}}}(uvpjs.register("uvpjs")),function(e){"use strict";uvpjs.Configuration={env:"prod",hostname:"vidtech.cbsinteractive.com",name:"UVPJS",version:"3.0.0",date:"12/06/19 10:32:04 AM (PST)",path:"//vidtech.cbsinteractive.com/uvpjs/3.0.0/",playerName:"CBSI-PLAYER"}}(),uvpjs.register("uvpjs").AutoplayDetectionService=uvpjs.Class.subClass({init:function(e){this.mc=e.mediaCapabilities,this.completeCallback=e.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=e.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(e,t){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:e,supportsMutedAutoplay:t})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(e,t){this.killVid(),this.setInfo(e,t),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var e,t;this.vidEl=t=this.createVideoElement(!1),t.load(),void 0===(e=t.play())?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):e.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var e;this.killVid(),this.checkForEarlySafari()?this.finishCheck(!1,!1):(this.vidEl=e=this.createVideoElement(!0),e.load(),e.play().then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1)))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var e=this.mc.getBrowserName()===this.mc.SAFARI,t=this.mc.isDesktop(),i=e&&t?this.mc.getBrowserVersion():null,n=i&&i.split("."),s=n?11===parseInt(n[0])&&0===parseInt(n[1]):null;return null!==i&&s&&(!n[2]||parseInt(n[2])<3)},detectMobileCapabilities:function(){var e=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(!1,e)},isAutoplayEligibleAndroid:function(){return this.mc.isAndroid()&&this.mc.isChrome()&&this.isChromeAutoplayEligible()},isAutoplayEligibleIos:function(){var e=this.mc.isIOSTen(),t=e&&this.mc.isSafari(),i=e&&!t&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return t||i},isChromeAutoplayEligible:function(){return parseInt(this.mc.getBrowserMajorVersion())>=54},createVideoElement:function(e){var t=document.createElement("video");return e&&(t.muted=!0,t.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(t,!0),t.volume=.005,t.style.width="100%",t.style.height="100%",t.src=this.testVidPath,this.testDom.appendChild(t),t},createTestDom:function(){var e=document.createElement("div"),t=e.style,i="-1000px";return t.position="absolute",t.top=i,t.left=i,t.width="320px",t.height="180px",document.body.appendChild(e),e}}),uvpjs.MediaCapabilities=function(){var e,t,i,n,s,r,a,o,l,d,u,c,h,p=uvpjs._,f=uuid.noConflict(),v=!1,g={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLACEHOLDER_M3U8_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLACEHOLDER_MP4_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",MP4_BLANK_FILE:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLATFORM_OUTLET_ACCOUNT_ID:"dJ5BDC",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"http://can.cbs.com/thunder/player/videoManifest.php?assetType=HLS&authn=",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",FIREFOX_IOS:"FxiOS",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",FACEBOOK_IOS:"Facebook Browser iOS",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(t,i){var r=this.systemInfo;return typeof t===this.STRING?e=t:e=navigator.userAgent||null,n=document.createElement(this.VIDEO),s=document.createElement(this.AUDIO),this.BOOLEAN,_(),A(),N(),v="https:"===location.protocol,r.browser=this.getBrowserName(),r.version=parseInt(this.getBrowserMajorVersion()),r.isMobile=this.isMobile(),r.isDesktop=this.isDesktop(),r.os=this.getOS()+"; ver. "+this.getOSVersion(),r.supportsMse=this.hasMediaSourceSupport(),r.isHlsjsEligible=this.canPlayHLSJS(),r.supportsNativeHls=this.canPlayNativeHLS(),r.supportsMp4=this.canPlayH264(),r.supportsDash=this.canPlayDASH(),this.canUseDataUrl()||(this.PLACEHOLDER_MP4_URL=this.MP4_BLANK_FILE),this},canUseDataUrl:function(){return!1},determineAutoplayCapabilities:function(e){var t;null===this.systemInfo.supportsUnmutedAutoplay?(t=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,e()}.bind(this),this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:t,testVidPath:this.PLACEHOLDER_MP4_URL})):e()},setTrackingInfo:function(e){var t,i,n=uvpjs.tracking,s={};for(i in n)t=n[i],s[i]=!!e[t];this.systemInfo.trackingAvailability=s},setAutoplayInfo:function(e){this.systemInfo.supportsUnmutedAutoplay=e.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=e.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return f.v1().replace(/-/g,"")},checkBrowserName:function(e){return typeof e===this.STRING&&this.getBrowserName()===e},canPlayHTML5Video:function(){var e=document.createElement(this.VIDEO);return typeof e===this.OBJECT&&typeof e.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var e=document.createElement(this.AUDIO);return typeof e===this.OBJECT&&typeof e.canPlayType===this.FUNCTION},getBrowserName:function(){return u||"unknown"},getBrowserVersion:function(){return c||-1},getBrowserMajorVersion:function(){return h||-1},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(e,t){if(typeof t===this.OBJECT){var i=t.exec(this.getUserAgent()),n="",s="";if(i&&typeof i===this.OBJECT&&i.length&&i.length>1){if((n=i[1]||"").indexOf(".")){var r=n.split(".");"object"==typeof r&&r.length&&r.length>0&&(s=r[0])}else s=n;return u=e,c=n,h=s,!0}}return!1},hasTealium:function(){return p.has(window,"utag")||p.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)||this.checkBrowserName(this.FIREFOX_IOS)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(e){return typeof e===this.STRING&&(this._detectEnvironment(e),!0)},getUserAgent:function(){return e},getMimeTypesObj:function(){return t||(typeof navigator===this.OBJECT&&navigator.mimeTypes&&navigator.mimeTypes.length>0&&(t=navigator.mimeTypes),t)},getMimeTypes:function(){if(typeof i===this.OBJECT)return i;var e={length:0},t=this.getMimeTypesObj();if(typeof t===this.OBJECT){for(var n=0;n<this.length;n++){var s=t[n].enabledPlugin&&t[n].enabledPlugin.name?t[n].enabledPlugin.name:"";e[t[n].type]={type:t[n].type,description:t[n].description,suffixes:t[n].suffixes,enabledPlugin:t[n].enabledPlugin,enabledPluginName:s},e.length++}return i=e}},getPlatform:function(){return typeof a===this.STRING?a:null},getOS:function(){return typeof o===this.STRING?o:null},getOSVersion:function(){return typeof l===this.STRING?l:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())>=0},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof d===this.BOOLEAN?d:d=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return S()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){if(null===this.hasMse){var e=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;this.hasMse=!(!i||!n)}return this.hasMse},canPlayHLSJS:function(e){var t=this.isMobile(),i=!!S(),n=this.hasMediaSourceSupport(),s=this.isFirefox()||this.isChrome(),r=this.isIE()&&this.getBrowserMajorVersion()>=11||this.isEdge(),a=this.isOpera()&&this.getBrowserMajorVersion()>=30,o=this.isPlaystation();return!(!n||!i||o||t&&!this.canPlayHlsjsAndriod(e))&&(!!e||s||r||a)},canPlayHlsjsAndriod:function(e){var t=this.getUserAgent();return!!(t.indexOf("Android")>=0&&parseFloat(t.slice(t.indexOf("Android")+8))>=5&&e)},canPlayNativeHLSAudio:function(){return b()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return S()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return S()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return S()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(e,t){return S()&&this.canPlayMediaType(this.VIDEO,e,t||!1)},canPlayAudioType:function(e,t){return S()&&this.canPlayMediaType(this.AUDIO,e,t||!1)},canPlayMediaType:function(e,t,i){var n=e===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return i=1==i,!(typeof n!==this.OBJECT||typeof n.canPlayType!==this.FUNCTION||!(i&&n.canPlayType(t)===this.PROBABLY||!i&&""!==n.canPlayType(t)))},canPlayType:function(e,t){t=1==t;var i=/audio\//.test(e)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof i!==this.OBJECT||typeof i.canPlayType!==this.FUNCTION||!(t&&i.canPlayType(e)===this.PROBABLY||!t&&""!==i.canPlayType(e)))},nativeCanPlayType:function(e,t){var i=e===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof i===this.OBJECT&&typeof i.canPlayType===this.FUNCTION&&i.canPlayType(t)||null},canPlayDASHType:function(e){if(typeof e!==this.STRING||e.length<1)return null;var t=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(e)&&this.hasMSE()&&t.isTypeSupported(e)},canPlayDASH264:function(e){return e=typeof e===this.STRING?e:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(e)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var e=this.getUserAgent();return e&&!(this.isChromecast()||this.isIOS()||e.indexOf("Android 2.")>-1||e.indexOf("Android 4.0")>-1||e.indexOf("Android 4.1")>-1)},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(e){return!(e&&this.supportsAutoplay()||this.isChromecast()||this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(e){return e&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(e){return!e&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(e,t){var i=this.getInlinePlayAttribute(),n=i&&i.name;t&&i?i&&e.setAttribute(n,i.value):!t&&n&&e.removeAttribute(n)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&parseInt(this.getBrowserVersion())>=10},getPreferredPlaceholderURL:function(){return this.isIOS()?this.PLACEHOLDER_M3U8_URL:this.PLACEHOLDER_MP4_URL},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var e="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return e&&!e.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var e,t;return void 0===this._hasFullscreenApiSupport&&(this.isIOS()?this._hasFullscreenApiSupport=!1:(e=document.createElement("div"),t=uvpjs.util,this._hasFullscreenApiSupport=!!(t.isFunction(e.requestFullscreen)||t.isFunction(e.webkitRequestFullscreen)||t.isFunction(e.mozRequestFullScreen)||t.isFunction(e.msRequestFullscreen)))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(e){var t=document,i=this.supportsFullscreenApi()&&(t.fullscreenEnabled||t.webkitFullscreenEnabled||t.mozFullScreenEnabled||t.msFullscreenEnabled);return!i&&(i=e&&e.webkitSupportsFullscreen),i},getDevice:function(){return r||null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var e=this.isIOS();return!e||e&&parseInt(this.getBrowserVersion())>=10},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(e){return/\.m3u|assetType=hls/i.test(e)},isDashUrl:function(e){return/\.mpd/i.test(e)},isSecure:function(){return v},setUrlProtocol:function(e){return v?e.replace("http:","https:"):e},getDrmType:function(e){var t="none";return e.enabled?((this.isIOS()||this.isSafari())&&null!==e.fairplay.appCertURL?t="Fairplay":(this.isIE()||this.isEdge())&&null!==e.dash.playreadyURL?t="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==e.dash.widevineURL&&(t="Widevine"),t):t}},_=function(){var e=new RegExp(/\s(\([^)]+\))/).exec(g.getUserAgent());e&&e.length&&e.length>1&&(e=e[1].replace(/_/gi,"."),E(e)||y(e)||m(e)||C(e))},m=function(e){return(-1!==e.indexOf(g.LINUX)||-1!==e.indexOf(g.ANDROID))&&(a=g.LINUX,-1!==e.indexOf(g.ANDROID)&&(e=new RegExp(/\ Android\ ([^\s]+);/).exec(e),r=g.ANDROID,o=g.ANDROID,l=e&&e[1]?e[1]:""),!0)},E=function(e){if(-1!==e.indexOf(g.MAC))return a=g.MAC,r=g.DESKTOP,-1!==e.indexOf(g.OSX)&&(e=new RegExp(/Mac\ OS\ X\ ([\d\.]+)/).exec(e),o=g.OSX,l=e&&e[1]?e[1]:null),!0;if(-1!==e.indexOf("like Mac OS X")){a=g.MAC,o=g.IOS;var t=/\sOS\s([^\s]*)\s/.exec(e);if(t&&t[1]&&(l=t[1]),/\(iPhone;/.test(e))r=g.IPHONE;else if(/\(iPad;/.test(e))r=g.IPAD;else{if(!/\(iPod;/.test(e))return!1;r=g.IPOD}return!0}return!1},y=function(e){var t=new RegExp(/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/);if((e=t.exec(g.getUserAgent()))&&e[2])return a=g.WINDOWS,o=g.WINDOWS_PHONE,l=e[2],r=g.PHONE,!0;if((e=(t=new RegExp(/Windows\ NT\ ([^\s]+)[;\)]/)).exec(g.getUserAgent()))&&e[1]){a=g.WINDOWS,o=g.WINDOWS;var i=e[1];return 6==i?o=g.WINDOWS_VISTA:6.1==i?(o=g.WINDOWS7,l=7):6.2==i?(o=g.WINDOWS8,l=8):10==parseInt(i)&&(o=g.WINDOWS10,l=i),r=g.DESKTOP,!0}return!1},A=function(){return!!(T()||I()||R()||P()||M()||O()||L()||D()||w())},S=function(){return n},b=function(){return s},T=function(){var e=/Chrome\/(\S+)/,t=/CriOS\/(\S+)/,i=g.getUserAgent(),n=t.test(i);return!(!e.test(i)&&!n||/(Opera|OPR)/.test(i)||/Edge/.test(i)||/CrKey/.test(i)||(g.setBrowserVersion(g.CHROME,n?t:e),0))},D=function(){var e=/Playstation (\S+)/i;return!!e.test(g.getUserAgent())&&(g.setBrowserVersion(g.PLAYSTATION,e),!0)},C=function(){return null!=g.getUserAgent()&&g.getUserAgent().indexOf(g.CHROMECAST_USER_AGENT)>-1&&(a=g.LINUX,r=g.CHROMECAST,o=g.ANDROID,!0)},I=function(){var e=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,t=/\ Edge\/([^\s]+)/,i=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return e.test(g.getUserAgent())?(g.setBrowserVersion(g.IE,e),!0):t.test(g.getUserAgent())?(g.setBrowserVersion(g.EDGE,t),!0):!!i.test(g.getUserAgent())&&(g.setBrowserVersion(g.IE,i),!0)},R=function(){var e=/Firefox\/(\S+)/,t=/FxiOS\/(\S+)/,i=g.getUserAgent(),n=t.test(i),s=!n&&e.test(i)?g.FIREFOX:n?g.FIREFOX_IOS:null;return!!s&&(g.setBrowserVersion(s,n?t:e),!0)},P=function(){var e,t=/Version\/(\S+).*Safari\//,i=t.test(g.getUserAgent());return e=o===g.ANDROID?g.ANDROID:g.SAFARI,!!i&&(g.setBrowserVersion(e,t),!0)},M=function(){var e=new RegExp(/Opera|OPR\/(\S+)/).exec(g.getUserAgent());if(e){var t=-1!==e.indexOf("Opera Mini/")||-1!==e.indexOf("Opera Mobi")?g.OPERA_MOBILE:g.OPERA;return g.setBrowserVersion(t,/Opera|OPR\/(\S+)/),!0}return!1},O=function(){return!!/Silk/i.test(g.getUserAgent())&&(g.setBrowserVersion(g.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},L=function(){return!!/Android/.test(g.getUserAgent())&&(u=g.ANDROID_BROWSER,!0)},w=function(){var e=g.getUserAgent();if(!/FBAN/.test(e))return!1;var t=function(e){var t=e.match(/\[(.*)\]/),i=null,n={};return t&&t.length>0&&(i=t[1]),i.split(";").forEach(function(e){var t=e.split("/");t.length>0&&(n[t[0]]=t[1])}),n}(e);return t.FBSN&&(o=t.FBSN),t.FBSV&&(l=t.FBSV),!(!t.FBAN||!/iOS/i.test(t.FBAN)||(u=g.FACEBOOK_IOS,0))},N=function(){var e=S(),t=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],i=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"],n=null;g.isIOS()?n=i:e.requestFullscreen?n=t:e.webkitRequestFullscreen?n=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:e.mozRequestFullScreen?n=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:e.msRequestFullscreen?g.getBrowserVersion()<12?n=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(n=t.slice())[5]=null:g.isAndroid()&&(n=i),function(e,t){e._fullscreenEventName=t?t[0]:null,e._fullscreenEnterEventName=t?t[1]:null,e._fullscreenExitEventName=t?t[2]:null,e._enterFullscreenMethodName=t?t[3]:null,e._exitFullscreenMethodName=t?t[4]:null,e._isFullscreenPropertyName=t?t[5]:null,e._fullscreenElementName=t?t[6]:null,e._fullscreenErrorEventName=t?t[7]:null}(g,n)};return g},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(e){var t=uvpjs._,i=uvpjs.mediaCapabilities;this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,t.isObject(e)?(this.cookie=this._getCookie(),this.CDO=e,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=i.isChrome()||i.isFirefox()||i.isSafari(),this.setSessionStartTime()):this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.")},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(e,t,i){this.debugCount++;var n=uvpjs._;if(this.isEnabled||n.isUndefined(this.CDO)){if(!n.isString(e)||!n.isString(t)||n.isUndefined(i))return void console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+i,t);if(this.showAll||n.isUndefined(this.CDO)||this.isParamEnabled(t)||!0===this.cookie[t]){var s=this.showTimestamps?"["+this._timestamp()+"] ":"",r=n.drop(arguments,3),a=n.isEmpty(r)?"":r,o={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[e]("%sUVPJS %s %s",s,t,i,a);console[e]("%s%cUVPJS %c%s%c %s",s,o.bold,o.underline,t,o.normal,i,a)}}},isParamEnabled:function(e){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,e)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var e=uvpjs._,t=new Date-this.adjustedStartTime,i=t%1e3,n=(t=(t-i)/1e3)%60,s=(t=(t-n)/60)%60,r=(t=(t-s)/60)%24-this.adjustedTimezone;return e.padStart(r,2,"0")+":"+e.padStart(s,2,"0")+":"+e.padStart(n,2,"0")+"."+e.padStart(i,3,"0")},_getCookie:function(){var e=this._readCookie(this.COOKIE_NAME),t={};if(!e)return t;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",e);try{t=JSON.parse(e)}catch(e){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",e)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",t),t},_readCookie:function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0,s=i.length;n<s;n++){for(var r=i[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null}},function(e){var t,i=e._;e.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(e){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",e),this.mc=null,this._createControls=e.createControls,this._createAds=e.createAds,this._useInlinePlayAttribute=e.useInlinePlayAttribute,this._useMutedAttribute=e.useMutedAttribute,this._DOMReadyCB=e.callback,this._useAutoplayAttribute=e.useAutoplayAttribute,this._userAgent=null,this.adClickElement=null,this.dom=t(),this.dom.outer.id=e.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var e=this.dom.video.el;e&&e instanceof HTMLElement&&(e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeEventListener(this.PLAY,this._handleEvent,!1),e.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return i.clone(this.dom)},createAdClickElement:function(){var e={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};for(var t in this.adClickElement=document.createElement("div"),e)this.adClickElement.style[t]=e[t];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(e){this.dom.ad.el&&(this.dom.ad.el.style.display=e?"block":"none")},showAdClickElement:function(e){this.adClickElement&&(this.adClickElement.style.display=e?"inline-block":"none")},getAdClickElement:function(){return this.adClickElement||this.createAdClickElement(),this.adClickElement},_disableVideoContextMenu:function(){var e=this.dom.video.el;e.addEventListener?e.addEventListener("contextmenu",function(e){e.preventDefault()},!1):e.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var e=this.dom;e.outer.el=document.getElementById(e.outer.id),i.isNull(this.dom.outer.el)?this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",e.outer.id):(e.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),e.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),e.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),e.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),e.content.el=this._getOrCreateElement("content"),e.outer.el.insertBefore(e.content.el,e.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),e.ad.el=this._getOrCreateElement("ad"),e.outer.el.insertBefore(e.ad.el,e.content.el.nextSibling)),this._createControls?(e.controls.el=this._getOrCreateElement("controls"),e.outer.el.appendChild(e.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB())},_createVideoElement:function(){var e,t=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),i=document.querySelectorAll(t);if(i instanceof NodeList&&i[0]instanceof HTMLElement&&i[0].id)this._checkVideoTagAttributes(i);else{if(t=[this.dom.outer.id,this.dom.video.id].join(" "),(i=document.querySelectorAll(t))instanceof NodeList&&i[0]instanceof HTMLElement){if(i[0].id)return;return i[0].id=this.dom.video.id,void this.dom.content.el.appendChild(i[0])}e=this._getOrCreateElement("video"),this._checkVideoTagAttributes(e),this.dom.content.el.appendChild(e),this.dom.video.el=e}},_createPlaceholderContent:function(){var e=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||i.isNull(this._userAgent)&&this.mc.isIPhone()?e.innerHTML='<source src="'+this.dom.video.url+'">':e.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),e.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.addEventListener(this.CAN_PLAY,this._handleEvent,!1),e.addEventListener(this.PLAY,this._handleEvent,!1),e.addEventListener(this.PAUSE,this._handleEvent,!1),e.style.width="100%",this._DOMReadyCB()},_handleEvent:function(e){var t=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",e),!i.isNull(t)){var n=this._useSeparateTags?t.getElementsByTagName("source")[0]:t;if(!i.isNull(n)){if(e.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,e.target),t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===n.src.indexOf(this.dom.video.url))return t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeEventListener(this.PLAY,this._handleEvent,!1),void t.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",e.type),e.type){case this.CAN_PLAY:t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(t.removeEventListener(this.PLAY,this._handleEvent,!1),t.pause(),!i.isFunction(this.dom.video.callback)){this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:t.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(e){this._useMutedAttribute&&e.setAttribute("muted","muted"),this._useAutoplayAttribute&&e.setAttribute("autoplay","autoplay"),this.mc.setVideoForInlinePlay(e,this._useInlinePlayAttribute)},_addInlineStyles:function(){if(this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds){var e=this.dom.ad.el;e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.left="0",e.style.top="0"}},_getIdByPrefix:function(e){if(!i.isNull(e))return uvpjs.domConstants[e]+this.dom.outer.id},_getOrCreateElement:function(e){var t=this.dom[e],n=document.getElementById(t.id);return i.isNull(n)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+t.type+' id="'+t.id+'">.'),(n=document.createElement(t.type)).id=t.id),n}}),t=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,uvpc:null,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,audioInfo:{},bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(e,i,n,s){t.isString(e)&&t.isObject(i)&&t.isObject(n)?(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+e),this.vidContId=e,this.cviMgr=i,this.CDO=n,this.sessionOptions=s,this.eventsMgr=i.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN")},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(e){if(t.isPlainObject(e)&&e.target===this.vidContId&&t.isNumber(e.payload.newState)){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+e.payload.newState);var i=e.payload.newState;i!==uvpjs.mediaCapabilities.EMPTY&&i!==uvpjs.mediaCapabilities.LOADING&&i!==uvpjs.mediaCapabilities.STOPPED&&i!==uvpjs.mediaCapabilities.PLAYING&&i!==uvpjs.mediaCapabilities.PAUSED&&i!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=i,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(e){var t=e.payload;e.target===this.vidContId&&(this.isCurrVideoAd=t.isAd,this.playbackState=t.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=t.currentTime,this.adPlaybackState.absoluteStreamTime=t.absoluteStreamTime||t.currentTime,this.adPlaybackState.duration=t.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=t.playbackStarted,this.adPlaybackState.playbackComplete=t.playbackComplete,this.adPlaybackState.sourceBitrate=t.sourceBitrate,this.adPlaybackState.playbackBitrate=t.playbackBitrate,this.adPlaybackState.errorInfo=t.errorInfo,this.adPlaybackState.lastSecondCompleted=t.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=t.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=t.currentTime,this.contentPlaybackState.absoluteStreamTime=t.absoluteStreamTime||t.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=t.playbackStarted,this.contentPlaybackState.playbackComplete=t.playbackComplete,this.contentPlaybackState.sourceBitrate=t.sourceBitrate,this.contentPlaybackState.playbackBitrate=t.playbackBitrate,this.contentPlaybackState.videoFramerate=t.videoFramerate,this.contentPlaybackState.isSeeking=t.isSeeking,this.contentPlaybackState.isHDStreamLive=t.isHDStreamLive,this.contentPlaybackState.isPlayingLive=t.isPlayingLive,this.contentPlaybackState.currentContentSegment=t.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=t.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=t.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=t.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=t.lastPercentageCompleted,this.contentPlaybackState.bufferLength=t.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=t.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&t.isNumber(e.payload.vol)&&(this.volume=e.payload.vol,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&(this.isFullscreen=e.payload.isFs)},onContextMetadata:function(e){!t.isPlainObject(e)||e.target!==this.vidContId||t.isPlainObject(e.target.contextMetadata)},onResourceStart:function(e){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){t.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){t.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){t.assign(this.contentVideoState,this.contentVideoStateDefaults)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(e){this.CDO.setAdCallParams(e)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var e=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof e&&e.length?e:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(e){var i=void 0;return e&&t.isString(e)&&this.hasOwnProperty(e)&&!t.isFunction(this[e])&&(i=this[e]),i},getModule:function(e){if(t.isString(e))return this.CDO.getModule(e)},getModuleParam:function(e,i){if(t.isString(e)&&t.isString(i))return this.CDO.getModuleParam(e,i)},getModules:function(){return this.CDO.getModules()},copyModules:function(e){this.CDO.copyModules(e)},isModuleEnabled:function(e){return!(!e||!t.isString(e))&&this.CDO.isModuleEnabled(e)},isModuleSet:function(e){return!uvpjs.util.isEmpty(e)&&this.CDO.isModuleSet(e)},getSessionOption:function(e){return e?this.sessionOptions[e]:null},getClass:function(e){if(t.isString(e))return this.CDO.getClass(e)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(e,t){return this.CDO.getClassProperty(e,t)},getClassListItems:function(e){return this.CDO.getClassListItems(e)},getClassListItemProperty:function(e,t,i){return this.CDO.getClassListItemProperty(e,t,i)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var e={};return t.assign(e,this.contentVideoState),e},getAdVideoState:function(){var e={};return t.assign(e,this.adVideoState),e},getContentPlaybackState:function(){var e={};return t.assign(e,this.contentPlaybackState),e},getAdPlaybackState:function(){return t.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(e){this.contentVideoState.abrInfo=e,this.contentPlaybackState.abrInfo=e},setAdVideoState:function(e){this.adVideoState=t.assign({},this.adVideoStateDefaults,e||{})},setContentVideoStateItems:function(e){this._addItemsToInstanceObj("contentVideoState",e)},setContentPlaybackStateItems:function(e){this._addItemsToInstanceObj("contentPlaybackState",e)},setAdVideoStateItems:function(e){this._addItemsToInstanceObj("adVideoState",e)},setAdPlaybackStateItems:function(e){this._addItemsToInstanceObj("adPlaybackState",e)},setNonDefaultContentVideoStateItems:function(e){this.setContentVideoStateItems(this._removeDefaults(e,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(e){this.setAdVideoStateItems(this._removeDefaults(e,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},getVideoPlaybackCDOProperty:function(e){var t=this.VIDEO_PLAYBACK_SETTINGS,i=this.isModuleEnabled(t),n=this.getModuleParam(t,e);if(i&&n)return n},setAbrStartBitrateFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==e&&this.setStartBitrate(e)},setAbrMinBitrateFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==e&&this.setMinBitrate(e)},setAbrMaxBitrateFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==e&&this.setMaxBitrate(e)},setLiveSyncDurationCountFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==e&&this.setLiveSyncDurationCount(e)},setCapLevelToPlayerSizeFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==e&&this.setCapLevelToPlayerSize(e)},setDashJSFastSwitchABRFromCDO:function(){var e=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==e&&this.setDashJSFastSwitchABR(e)},setStartBitrate:function(e){this.startBitrate=e,this.setContentPlaybackStateItems({startBitrate:e}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(e){this.minBitrate=e,this.setContentPlaybackStateItems({minBitrate:e}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(e){this.maxBitrate=e,this.setContentPlaybackStateItems({maxBitrate:e}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(e){this.liveSyncDurationCount=e,this.setContentPlaybackStateItems({liveSyncDurationCount:e}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(e){this.capLevelToPlayerSize=e,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(e){this.enableDashJSFastSwitchABR=e,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setAudioTrackInfo:function(e){this.contentPlaybackState.audioInfo=e},getAudioTrackInfo:function(){return this.contentPlaybackState.audioInfo},setErrorRecovery:function(e){this.errorRecovery=e,this.debug&&uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(e){this.useDynamicSwitching=e,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var e=this;t.forOwn(this.sessionOptions,function(i,n){if(t.isString(i))return t.has(e.contentVideoState,n)?void(e.contentVideoState[n]=i):t.has(e.adVideoState,n)?void(e.adVideoState[n]=i):void 0}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(e,i){return t.omitBy(e,function(t,n){return e[n]===i[n]})},_addItemsToInstanceObj:function(e,i){var n,s,r;if(n=this[e])if(t.isObject(i))for(s in this.debug,n)r=i[s],!i.hasOwnProperty(s)||t.isUndefined(r)||t.isFunction(r)||(n[s]=r);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",i);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+e)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,clearTimeout(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(e,i,n){var s,r;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",e),this.scriptsLoadedCB=i,this.timeout=n||this.REQUEST_TIMEOUT,t.isString(e)&&this.urls.push(e),t.isArray(e)&&(this.urls=e),r=this.urls.length,s=0;s<r;s++)this._getScript(this.urls[s])},_getScript:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",e);var i=this,n=function(e,n){t.isFunction(i._onScriptLoaded)&&!i._onScriptLoaded.done?(i.urls=t.without(i.urls,e),i._onScriptLoaded({url:e,error:n})):i.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript _doCallback callback not a function or already called.")},s=document.createElement("script");s.src=this._setUrlProtocol(e),s.async=!0,s.onreadystatechange=s.onload=function(){s.readyState&&!/loaded|complete/.test(s.readyState)||n(e)},s.onerror=function(t){uvpjs.error(i.DEBUG_ID,"_getScript "+t.target.src+" is not accessible."),n(e,t)},document.querySelector("head").appendChild(s),this.timeoutHandle=setTimeout(function(e){-1===t.indexOf(i.urls,e)||(this.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript request timeout"),n(e,"timeout"))}.bind(this,e),this.timeout)},_onScriptLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var i=t.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),i&&t.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(e))},createCORSRequest:function(e,t){var i=new XMLHttpRequest;return t=this._setUrlProtocol(t),"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(e,t):i=!1,i},loadXHR:function(e,i,n,s){var r,a;if(e=this._setUrlProtocol(e),!1===(r=this.createCORSRequest("GET",e)))return a="loadXHR CORS not supported for url = "+e,uvpjs.warn(this.DEBUG_ID,a),void n(r);s&&!uvpjs.util.isEmpty(s)&&(r.responseType=s),r.timeout=this.REQUEST_TIMEOUT,r.onload=function(){t.inRange(r.status,200,400)?i(r):n(r)},r.onerror=function(){n(r)},r.ontimeout=function(){n(r)},r.send()},loadXML:function(e,t,i){this.loadXHR(e,t,i,"document")},loadArrayBuffer:function(e,t,i){this.loadXHR(e,t,i,"arraybuffer")}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(e){var t=e.vidContId;if(!e.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=t,this.eventsMgr=e.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=e.readyCallback,this.cachedOptions={suppressFacadePlay:e.suppressFacadePlay,deferLoadingCaptions:e.playerOptions.deferLoadingCaptions},this.cviModel.initialize(t,this,e.CDO,e.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(e){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(e)},setAdCallParams:function(e){this.cviModel.setAdCallParams(e)},setInitialPlaybackType:function(e,t){this.initialPlaybackInfo.isAutoplay=e,this.initialPlaybackInfo.isMuteAtPlayStart=t},setContextMetadata:function(e){this.cviModel.contentVideoState.contextMetadata=e||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var i=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:i.suppressFacadePlay,p2pClient:e||null,multiCdnClient:t||null,deferLoadingCaptions:i.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:i.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(e){var i=this.cviModel.getSessionOption("adBlockerCallback"),n=!(!i||!i()),s=this.eventsMgr.eventTypes,r=uvpjs.ErrorInfo,a=window.google&&google.ima;if(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+n),n&&this.eventsMgr.dispatchEvent(s.AD_BLOCKED,{errorInfo:new r({eventType:s.AD_BLOCKED,errorCode:r.errorCodes.AD_BLOCKING_DETECTED,message:r.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),n||a){if(a){if(!t.isEmpty(this.imaAdDisplayContainer))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed"));this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(e),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer);var o=this.adsLoader.getSettings();o.setAutoPlayAdBreaks(!0),o.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}}else this.eventsMgr.dispatchEvent(s.PLAYER_START_ERROR,{errorInfo:new r({eventType:s.PLAYER_START_ERROR,errorCode:r.errorCodes.IMA_SDK_MISSING,message:r.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId)},_createIMAAdDisplayContainer:function(e){var t,i;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),t=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId).getElementsByTagName("video")[0],i=new google.ima.AdDisplayContainer(this.adVideoDiv,t,e),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",e),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",i),i},onAdsManagerLoaded:function(e){var t,i=uvpjs.util,n=i.isEmpty(this.RPM),s=i.isEmpty(this.RPM.currRP),r=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",e),n||s||r)return t="CVI mgr: onAdsManagerLoaded; ",t+=n?"no RPM found":s?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,t),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+t,isFatal:!1})},this.vidContId);this.RPM.currRP.onAdsManagerLoaded(e)},onAdError:function(e){var i=!t.isEmpty(this.RPM)&&this.RPM,n=i&&!t.isEmpty(i.currRP)&&i.currRP;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",e),!i||!n)return this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId);"function"==typeof n.handleAdsLoaderError&&n.handleAdsLoaderError(e)},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",e),this.RPM.loadDynamicAdCall(e)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,{},this.vidContId)},seekToRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+e),t.isNaN(e)?this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+e):(-1===e&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:e},this.vidContId))},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",e),t.isNaN(e)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:e},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",e),t.isString(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:e},this.vidContId)},showCaptionsRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{language:e},this.vidContId)},setCaptionLanguage:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SET_CAPTIONS_LANG,{language:e},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},getCaptionInfo:function(){return this.captionsMgr.getCaptionInfo()},setCaptionsStyleRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",e),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(e):this.captionsMgr.setStyles(e)},setCaptionsCuePropertyRequest:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",e,t),this.captionsMgr.setCueProperty(e,t)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},getAudioTrackInfo:function(){return this.cviModel.getAudioTrackInfo()},setAudioTrack:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_AUDIO_TRACK,{id:e})},resizeRequest:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+e+"  height = "+i),!t.isNaN(e)&&!t.isNaN(i)&&e>=0&&i>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:e,height:i},this.vidContId)},fullscreenRequest:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",e),t.isBoolean(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:e},this.vidContId)},setUserGesture:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:e},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",e),t.isPlainObject(e)},setNativeControls:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",e),t.isBoolean(e)&&(this.cviModel.nativeControls=e)},createPauseAdRetriever:function(){var e=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),t={eventsMgr:this.eventsMgr,adCallUrl:e,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};return e?uvpjs.PauseAdRetriever?void(this.pauseAdRetriever=new uvpjs.PauseAdRetriever(t)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path.")):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+e))},checkForPauseAd:function(){var e=this.cviModel.isModuleEnabled("PauseAd"),t=uvpjs.Configuration.path+"lib/PauseAdRetriever.js";e&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(new uvpjs.CodeLoader).loadScript(t,this.createPauseAdRetriever.bind(this)))}})}(uvpjs.register("uvpjs")),function(e){e.ErrorInfo=uvpjs.Class.subClass({init:function(e){var t=e||{};this.errorCode=t.errorCode||null,this.eventType=t.eventType||null,this.isFatal=!!t.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=t.message||null,this.adInfo=t.adInfo||null,this.serverCode=t.serverCode||null,this.hlsjsErrorCode=null}}),e.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},e.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."}}(uvpjs.register("uvpjs")),function(e){var t=e._,i=Math.random();e.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(e){this.debug=uvpjs.debug,e&&e===i?(this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance().")},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(e,i){if(e&&t.isString(e)&&i&&t.isFunction(i)){var n=this._returnValidEvtTypeAndNameSpace(e);if(!1!==n){var s=n[0],r=n[1];this.registeredEventsTable[s]||(this.registeredEventsTable[s]={}),this.registeredEventsTable[s][r]?this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",s," ns = ",r):(this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",s," ns = ",r),this.registeredEventsTable[s][r]=i)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+e},this.internalNS)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(e){if(!e||!t.isString(e))return this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",e),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var i=this._returnValidEvtTypeAndNameSpace(e);if(!1!==i){var n=i[0],s=i[1];this.registeredEventsTable[n]&&this.registeredEventsTable[n][s]?(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",e),delete this.registeredEventsTable[n][s]):this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",e)}else this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",e)},dispatchEvent:function(e,i,n){var s={};if(e&&t.isString(e))if(t.isUndefined(i)||t.isPlainObject(i))if(t.isUndefined(n)||t.isString(n)){var r=this.registeredEventsTable[e];if(r)for(var a in t.isUndefined(i)&&(i={}),t.isUndefined(n)&&(n=""),s.type=e,s.payload=i,s.target=n,r)r.hasOwnProperty(a)&&r[a](s)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+e+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS)},_returnValidEvtTypeAndNameSpace:function(e){var t=[],i=e.split(".");if(i.length<2)return!1;var n=i[0];i.shift();var s=i.join("_");return!(!this._validateEventType(n)||s.indexOf("undefined")>-1)&&(t[0]=n,t[1]=s,t)},_validateEventType:function(e){var t=!1,i=this.eventTypes;for(var n in i)if(i.hasOwnProperty(n)&&i[n]===e){t=!0;break}return t},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(e){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),e)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(e,i,n,s){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",i);var r={};e&&t.isNumber(e)&&i&&t.isString(i)&&n&&t.isFunction(n)&&(!s||t.isNumber(s)||!(s>=1||-1===s))?(e<this.uvpjsClockInterval&&(e=this.uvpjsClockInterval),r={freq:e,ns:i=i.split(".").join("_"),cb:n,rptCnt:-1,nextTime:Date.now()+e},s&&(r.rptCnt=s),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",e),this.timerCBOs.push(r)):this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeTimedEventCallback:function(e,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",e+" ns = "+i),e&&t.isNumber(e)&&i&&t.isString(i)){var n,s,r=i.split(".");for(i=r.join("_"),n=this.timerCBOs.length;n--;)(s=this.timerCBOs[n]).freq===e&&s.ns===i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",s.freq+" CBO.ns = "+s.ns),this.timerCBOs.splice(n,1))}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;var e,t,i=Date.now();for(e=this.timerCBOs.length-1;e>=0;e--)i>=(t=this.timerCBOs[e]).nextTime&&(t.cb(),t.nextTime=i+t.freq,-1!==t.rptCnt&&(t.rptCnt=t.rptCnt-1,0===t.rptCnt&&this.timerCBOs.splice(e,1)))},eventTypes:{SWITCH_AUDIO_TRACK:"switchAudioTrack",FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,AD_BUFFERING:uvpjs.EventType.AD_BUFFERING,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",SET_CAPTIONS_LANG:"onSetCaptionLang",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),e.EventsManager._instance=null,e.EventsManager.destroyInstance=function(){this._instance=null},e.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(i)),this._instance}}(uvpjs.register("uvpjs")),function(e){var t="www.nielsen.com";e.AbstractId3Parser=uvpjs.Class.subClass({init:function(e){this.findNielsen=e.findNielsen,this.dataCallback=e.dataCallback,this.ownerIds=this.assembleOwnerIds(e.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(e){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(e){for(var t=e.length,i=[];t--;)i[t]=e[t].length;return i},assembleOwnerIds:function(e,i){var n,s,r=[];if("string"==typeof e)for(s=(n=e.split(",")).length;s--;)r.push(n[s].trim());return i&&-1===r.indexOf(t)&&r.push(t),r}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(e){var t,i=e.length;for(t=0;t<i;t++)e[t].data&&this.findId3(e[t])},findId3:function(e){var t,i,n,s,r,a,o=0,l=e.data;a=this.readStr(l,o,3),o+=3,"ID3"===a&&(o+=3,t=127&l[o++],i=127&l[o++],n=127&l[o++],s=127&l[o++],r=o+((t<<21)+(i<<14)+(n<<7)+s),this.findId3PrivateFrame(e,o,r))},findId3PrivateFrame:function(e,t,i){for(var n,s=e.data;t+8<=i;)n=this.readStr(s,t,4),t+=4,s[t++],s[t++],s[t++],s[t++],s[t++],s[t++],"PRIV"===n&&this.parseFrame(e,t)},parseFrame:function(e,t){for(var i,n,s,r=this.idLengths,a=this.totalIds,o=e.data;a--;)if(s=r[a],(n=this.readStr(o,t,s))===this.ownerIds[a]){t+=s,i="www.nielsen.com"===n?this.parseNielsen(n,o,t):this.readStr(o,++t,o.length),this.dataCallback({name:n,data:i,pts:e.pts});break}},parseNielsen:function(e,t,i){var n=e+this.readStr(t,i,t.length-(i+2));return 249===n.length?n:null},readStr:function(e,t,i){var n="",s=t||0,r=t+i;do{n+=String.fromCharCode(e[s++])}while(s<r);return n}}),uvpjs.register("uvpjs").TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(e){if(1===e.length){var t=e[0];if("PRIV"===t.value.key)for(var i=0;i<this.ownerIds.length;i++){var n=this.ownerIds[i];-1!==t.value.info.indexOf(n)&&this.dataCallback({name:n,data:"www.nielsen.com"===n?t.value.info:String.fromCharCode.apply(null,new Uint8Array(t.value.data)),pts:t.startTime})}}}}),function(e){e.SdkLoadManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var e={};for(var t in this.historyItems)e[t]=this.historyItems[t];return e},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(e){var t="//79423.analytics.edgesuite.net/js/csma.js";return t=e&&e.getModuleParam("AkamaiQOSPluginJS","libpath")||t,uvpjs.mediaCapabilities.isSecure()?[t.replace("edgesuite","edgekey")]:[t]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefined:function(){return void 0!==window.ns_&&void 0!==window.ns_.ReducedRequirementsStreamingAnalytics},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPath:function(){return["//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js"]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof ADB||"undefined"===e._.get(ADB,"va.Heartbeat"))},getPath:function(e){var t=uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",i=uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return e.sessionOptions.usesTealium?[i]:[t,i]}},OzTam:{isDefined:function(){return void 0!==window.OzTAMService},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}}},init:function(e,t){var i=[],n=e.getModules(),s=uvpjs.util;if(this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",e),this.cdo=e,this.initCallback=t,s.isEmpty(n))this.invokeCallbackWithHistory();else{e.getModule("MuxQOSPluginJS")||n.push({name:"MuxQOSPluginJS",enabled:"true"});for(var r=n.length;r--;){var a,o,l=n[r],d=l.name,u=this.sdkModules[l.name];if(l.enabled&&u)if(u.isDefined())this.addToHistory({name:l.name,loaded:!0});else for(o=(a=u.getPath(e)).length;o--;)i.push({name:d,path:a[o]})}s.isEmpty(i)?this.invokeCallbackWithHistory():this.bulkLoad(i)}},invokeCallbackWithHistory:function(){var e=this.initCallback,t=this.getHistory();setTimeout(function(){e(t)},1)},bulkLoad:function(e){var t=e,i=[],n=(this.handleAllLoadResults,function(e,n,r){i.push({name:e,result:r}),n.destroy(),0===t.length?this.handleAllLoadResults(i):s()}),s=function(){var e=t.shift(),i=new uvpjs.CodeLoader;i.loadScript(e.path,n.bind(this,e.name,i))}.bind(this);s()},handleAllLoadResults:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",e);for(var t=e.length;t--;){var i=e[t];i.result.error&&uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+i.result.error),this.addToHistory({name:i.name,loaded:!i.result.error})}this.initCallback(this.getHistory())},addToHistory:function(e){e.name?!1!==this.historyItems[e.name]&&(this.historyItems[e.name]=!e.error&&e.loaded):this.debug&&uvpjs.warn(this.DEBUG_ID,"module name not found",e)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(e){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=e.p2pClient||null,this.multiCdnClient=e.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=e.suppressFacadePlay,this.deferLoadingCaptions=e.deferLoadingCaptions,this.playlistPaused=!1,!t.isEmpty(e)&&this.initialize(e.vidContId,e.cviMgr)},initialize:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",e),t.isString(e)&&t.isObject(i)?(this.vidContId=e,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS")},setContainers:function(e){this.containers=e},setCaptionStyle:function(e){!uvpjs.util.isEmpty(this.currRP)&&this.currRP.setCaptionStyle(e)},onResourceLoadRequest:function(e){if(e.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",e.payload.rcObj),this.playlistPaused=!1;var t=this._createResourceProvider(e.payload.rcObj);this.rscProviders.unshift(t),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(e){if(e.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",e.payload.rcObjs);var i,n,s=e.payload.rcObjs,r=s.length;for(i=0;i<r;i++)n=this._createResourceProvider(s[i]),this.rscProviders.push(n);t.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(e){if(e.target===this.vidContId){for(var t,i=e.payload.rcObjs,n=i.length,s=this.rscProviders,r=this.usedRPs,a=!1,o=!uvpjs.util.isEmpty(this.currRP);n--;)t=i[n],this.removeFromList(t,s),this.removeFromList(t,r),o&&!a&&(a=this.isMatchingResource(t,this.currRP.rco.rcoSeed));a&&this.advancePlaylist()}},removeFromList:function(e,t){for(var i=t.length;i--;)this.isMatchingResource(e,t[i].rco.rcoSeed)&&t.splice(i,1)},isMatchingResource:function(e,t){var i=uvpjs.util;return e.type===t.type&&(!i.isEmpty(e.pid)&&e.pid===t.pid||!i.isEmpty(e.assetURL)&&e.assetURL===t.assetURL||!i.isEmpty(e.selectorCall)&&e.selectorCall===t.selectorCall)},onResourcePlaylistPause:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),e.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(e){e.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,t.isEmpty(this.currRP)&&this.rscProviders.length>0&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(e){e.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(e){e.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",e),t.isEmpty(this.currRP)||t.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(e)},forceDynamicMidrollPodEnd:function(){!t.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),t.isEmpty(this.currRP)||t.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(e){var t,i={rco:e,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",e),e.type){case this.mc.RP_URL:t=new uvpjs.RP_URL(i);break;case this.mc.RP_PLATFORM:t=new uvpjs.RP_Platform(i);break;case this.mc.RP_DAI:t=new(e.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider)(i);break;case this.mc.RP_IMA:t=new uvpjs.RP_IMA(i);break;case this.mc.RP_MDIALOG:t=new uvpjs.RP_Mdialog(i)}return t},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),t.isEmpty(this.currRP)||t.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),!t.isObject(this.currRP))return this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist();this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay)},rpDataLoadErrorCB:function(e){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",e.message),this.eventsMgr.dispatchEvent(e.eventType,{errorInfo:e},this.vidContId),this.advancePlaylist()},resourceStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:e},this.vidContId)},resourceEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",e),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:e,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!t.isEmpty(this.currRP)&&t.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(e,i,n,s,r){var a=!0===r.skin;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",e),t.isString(e)&&t.isObject(i)&&t.isObject(n)&&t.isFunction(s)?(this.vidContId=e,this.namespace=".vci_"+e,this.eventsMgr=i,this.CDO=n,this.vciReadyCB=s,this._usesIMA=r.usesIMA,this._loadSkinFlag=a,this._isPreviewBtnInternallyManaged=a,this._isUnmutedAutoplay=r.enableUnmutedAutoplay,this._isMutedAutoplay=r.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!r.useBrowserControls,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:e,eventsMgr:i,CDO:n,playerOptions:r,suppressFacadePlay:this.checkNativeAutoplay(r.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,r)})):this.debug&&uvpjs.log(this.DEBUG_ID,"-")},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(e){var t={skin:!0===e.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:e.customCSS,enableReplay:e.enableReplay,previewImage:e.previewImage,themeName:e.themeName};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:e.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(e.enableNativeMobileAutoplay),callback:this.onDOMReady.bind(this,t)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(e){},onAdStart:function(e){var t=e.payload.adData;this.DOMMgr.showAdContainer(!0),!this.autoplayRestrictionChecked&&this.checkAutoplayRestriction(t),t.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(e){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){if(this.handleFirstGesture(),this.skinMgr){var e=this.skinMgr,t=this.mc.PAUSED;setTimeout(function(){e.setPlaystate(t)},200)}},setAdCallParams:function(e){this.CVI_Mgr.setAdCallParams(e)},checkAutoplayRestriction:function(e){this.autoplayRestrictionChecked=!0,!this.contentStartReceived&&"pre"===e.adType&&"ima"===e.adServerName&&this._isMutedAutoplay&&!this.mc.isSingleVideoIma()&&!this.mc.supportsUnmutedAutoplay()&&!this.isPreparedForAutoplay&&(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(e){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,e,this.vidContId)},prepForRestrictedAutoplay:function(e){var t=this.dom.video.el,i=function(){this.isPreparedForAutoplay=!0,t.removeEventListener("play",i,!1),t.muted=!1,e&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this);this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),t.src=this.mc.getPreferredPlaceholderURL(),t.addEventListener("play",i,!1),t.muted=!0,t.load();var n=t.play();void 0!==n&&n.then(Function.prototype).catch(function(e){console.warn("UVPJS:VCI.prepForRestrictedAutoplay: priming Promise rejected.")})},handleFirstGesture:function(e){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:e||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(e){this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),this.useBrowserNativeControls||!this._loadSkinFlag?this.onVCIReady():this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:e})},checkNativeAutoplay:function(e){return e&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),!this._vciReadySent){if(!this._autoPlay&&this._isPreviewBtnInternallyManaged&&!this._previewButtonDone)return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId);this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)}},loadDynamicAdCall:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",e),t.isString(e)?this.CVI_Mgr.loadDynamicAdCall(e):this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)")},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(e){return uvpjs.log(this.DEBUG_ID,"onPreviewButton"),uvpjs.util.isFunction(e)?(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone?(uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=e,void this.playBlankVideo()):(uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),void e())):void(this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function."))},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(e){var t,i;if(!0!==e&&!this.canOverrideUserGesture())return t=uvpjs.ErrorInfo,void(i=this.eventsMgr).dispatchEvent(i.eventTypes.PLAYER_START_ERROR,{errorInfo:new t({eventType:i.eventTypes.PLAYER_START_ERROR,errorCode:t.errorCodes.USER_GESTURE_REQUIRED,message:t.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId);this.onPreviewButton(this.onVCIReady.bind(this))},addEventListener:function(e,i){e&&t.isString(e)&&t.isFunction(i)?this.eventsMgr.addEventListener(e,i):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId)},removeEventListener:function(e){e&&t.isString(e)?this.eventsMgr.removeEventListener(e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(e){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",e),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,e),void this.playBlankVideo();i=this.createResourceConfig(e),t.isObject(i)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:i},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",e),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,e),void this.playBlankVideo();if(t.isArray(e)&&e.length>0){var i,n,s=[];for(i in e)n=this.createResourceConfig(e[i]),t.isObject(n)?s.push(n):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);s.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:s},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(e){var t,i,n,s,r,a="",o=!1,l=e.type===this.mc.RP_IMA,d=!1,u=null;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",e),(r=this.prevalidateRcObj(e)).error)return a="Resource configuration error: "+r.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(a,null),!1;switch(e.type){case this.mc.RP_URL:t=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:t=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(a="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",o=!0),d=!0,t=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:t=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:d=!e.useSsb,t=uvpjs.DaiRco;break;default:a="VCI createResourceConfig Unknown resource type "+e.type+"; this.vidContId = "+this.vidContId,o=!0}return o?(this.dispatchStartError(a,null),!1):(this.rcoIdIndex++,r=(i=new t(e,this.rcoIdIndex+"_"+this.vidContId,this.vidContId)).getValidationInfo(),d&&this.checkForAdBlocker()?(!0===r.missingSDK&&(u=l?"IMA":"DAI"),this.dispatchAdBlocked(u,!0),!1):r.error?(a="VCI error initializing RCO: "+r.message,n=uvpjs.ErrorInfo.errorCodes,!0===r.missingSDK?(s=l?n.IMA_SDK_MISSING:n.DAI_SDK_MISSING,this.dispatchStartError(a,s)):this.dispatchStartError(a,null),!1):(this._replayRco=e,i))},prevalidateRcObj:function(e){var t=uvpjs.util,i="",n=!1;return t.isPlainObject(e)?t.isDefinedString(e.type)||(i="Invalid resource type encountered",n=!0):(i="Invalid resource config object format",n=!0),{error:n,message:i}},dispatchStartError:function(e,t){this.debug&&uvpjs.error(this.DEBUG_ID,e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:t||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+e,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(e,t){var i=e?" (Missing "+e+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+i,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+i,isFatal:!!t})},this.vidContId)},checkForAdBlocker:function(){return uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(e){t.isArray(e)&&e.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:e},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest()},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",e),isNaN(e)||this.CVI_Mgr.seekToRequest(e)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",e),t.isEmpty(this.skinMgr)||t.isEmpty(e)||this.skinMgr.disableButton(e)},enableButton:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",e),t.isEmpty(this.skinMgr)||t.isEmpty(e)||this.skinMgr.enableButton(e)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(e){t.isNaN(e)||this.CVI_Mgr.volumeChangeRequest(e)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",e),t.isString(e)&&this.CVI_Mgr.loadCaptionsRequest(e)},showCaptions:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest(e)},setCaptionLanguage:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionLanguage to "+e),this.CVI_Mgr.setCaptionLanguage(e)},getCaptionInfo:function(){return this.CVI_Mgr.getCaptionInfo()},hideCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},getAudioTrackInfo:function(){return this.CVI_Mgr.getAudioTrackInfo()},setAudioTrack:function(e){this.CVI_Mgr.setAudioTrack(e)},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",e),this.CVI_Mgr.setCaptionsStyleRequest(e)},setCaptionsStyleProperty:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",e,t),this.CVI_Mgr.setCaptionsStyleRequest([{name:e,value:t}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",e,t),this.CVI_Mgr.setCaptionsCuePropertyRequest(e,t)},setSize:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+e+"  height = "+i),t.isNumber(e)||t.isNumber(i)||this.CVI_Mgr.resizeRequest(e,i)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",e),!t.isEmpty(e)&&(t.isArray(e)&&e.length>0||uvpjs.util.isDefinedString(e))&&this.CVI_Mgr.setUserGesture(e)},setQosMetadata:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",e),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",i),t.isEmpty(e)||t.isEmpty(i)||!t.isArray(e)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:e,paramsObj:i},this.vidContId))},fullscreen:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",e),t.isBoolean(e)&&this.CVI_Mgr.fullscreenRequest(e)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(e){e&&t.isPlainObject(e)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:e},this.vidContId))},forceTrackSessionEnd:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FORCE_TRACK_SESSION_END,{},this.vidContId)},removeNativeControls:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",e),t.isBoolean(e)&&this.CVI_Mgr.setNativeControls(e)},useDynamicSwitching:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",e),t.isBoolean(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:e},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(e){e&&"number"==typeof e?(this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:e},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",e)},switchTo:function(e){var t=null!=e&&"string"==typeof e&&-1!=="up,down".indexOf(e),i=null!=e&&"number"==typeof e&&!isNaN(e);t||i?(this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",e),i?this.switchBitrateTo(e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:e},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",e,t,i,typeof e)},setMinimumBitrateAllowed:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:e},this.vidContId)},setMaximumBitrateAllowed:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:e},this.vidContId)},pauseAdRequest:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:e||null,height:t||null},this.vidContId)},_dispatchResizeEvent:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:e},this.vidContId)},liveSegmentStart:function(e){var t=this.eventsMgr.eventTypes.LIVE_SEGMENT_START,i={liveSegmentData:e};this.eventsMgr.dispatchEvent(t,i,this.vidContId)},liveSegmentEnd:function(e){var t=this.eventsMgr.eventTypes.LIVE_SEGMENT_END,i={liveSegmentData:e};this.eventsMgr.dispatchEvent(t,i,this.vidContId)}})}(uvpjs.register("uvpjs")),function(e){var t=Math.random(),i=e._;e.VideoManager=uvpjs.Class.subClass({init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance?console.warn("UVPJS: An instance of VideoManager has already been created."):(uvpjs.VideoManager._instance=this,this.initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1)},destroy:function(){for(var e in this.VCIs)this.destroyVideoPlayer(e);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,uvpjs.VideoManager.destroyInstance()},initialize:function(e,t,i){var n=uvpjs.Configuration,s=uvpjs.VideoManager._instance,r=uvpjs.DebugManager,a=this.validateParams(e,t,i),o=a.message,l=a.isValid;if(!o||(console[l?"warn":"error"](o),!l&&a.errorCb&&a.errorCb(o),l)){if(s){if(s.isInitializing())return void s.addInitCallback(t);if(s.isReady())return void(uvpjs.util.isFunction(t)&&t(this.mc.systemInfo))}console.log([n.name,n.version,n.date].join(" ")),uvpjs.log=r.log.bind(r),uvpjs.warn=r.warn.bind(r),uvpjs.error=r.error.bind(r),r.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!e.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(t),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",e),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(e,this.onCongfigMgrReady.bind(this))}},validateParams:function(e,t,n){var s=uvpjs.util,r=null,a=!1,o="VideoManager.initialize()",l=s.isFunction(n)?n:null;return e&&i.isPlainObject(e)||(r=o+" was invoked with invalid session options.",a=!0),s.isFunction(t)||(r=o+": A success callback function is required.",a=!0),l||(r=o+" did not receive a valid error callback function.",a=!1),{errorCb:l,message:r,isValid:!a}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(e){var t=this.successCallbacks.length;if(uvpjs.util.isFunction(e)){for(;t--;)if(this.successCallbacks[t]===e)return;this.successCallbacks.push(e)}},onCongfigMgrReady:function(e){i.isObject(e)?(this.CDO=e,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS)},onSdkLoadManagerReady:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",e),uvpjs.mediaCapabilities.setTrackingInfo(e),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(e){var t,i=e.isModuleEnabled("VideoPlaybackSettings")&&e.getModuleParam("VideoPlaybackSettings","forceHlsjs"),n="string"==typeof i,s=n&&i.toLowerCase();i&&!uvpjs.util.isEmpty(i)&&(!0===i||1===i||n&&("1"===s||"y"===s||"yes"===s))&&((t=this.mc.canPlayHLSJS(!0))&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=t)},checkAutoplay:function(){uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(e,t){if(this.eventsMgr)return e&&i.isString(e)&&i.isFunction(t)?void this.eventsMgr.addEventListener(e,t):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(e){e&&i.isString(e)?this.eventsMgr.removeEventListener(e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS)},getVideoPlayers:function(){var e,t={};for(e in this.VCIs)t[e]=this.VCIs[e];return t},createVideoPlayer:function(e,t,n){if(this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),i.isString(e)&&i.isFunction(t)&&(!n||i.isPlainObject(n))){var s=[e,t];n&&s.push(n),this.createMultipleVideoPlayers([s])}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS)},destroyVideoPlayer:function(e){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),i.isString(e)?i.isEmpty(this.VCIs)||!this.VCIs[e]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+e},this.internalNS),!1):(this.VCIs[e].destroy(),delete this.VCIs[e]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(e){var t,n,s,r,a,o,l,d;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!i.isEmpty(this.VCIs)),i.isArray(e)){for(r=e.length,s=0;s<r;s++)if(o=(a=e[s])[0],l=a[1],d=a[2],a.length<2||!i.isString(o)||!i.isFunction(l)||!i.isUndefined(d)&&!i.isPlainObject(d))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),s=0;s<r;s++)o=(a=e[s])[0],l=a[1],d=a[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",o),d=this.CDO.getSessionOptions(d),t=this.validateAutoplay(d),!1===this._allowConcurrentPlayback&&t&&(this._disableAutoplay&&(d.enableMutedAutoplay=!1,d.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),n=new uvpjs.VideoControlInterface,this.VCIs[o]=n,n.initialize(o,this.eventsMgr,this.CDO,l,d);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS)},validateAutoplay:function(e){var t=e.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),i=!!(e.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||t);return t&&(e.enableMutedAutoplay=!1),i||(e.enableMutedAutoplay=!1,e.enableUnmutedAutoplay=!1),i},overrideSessionOptions:function(e){e&&i.isPlainObject(e)&&this.CDO.overrideSessionOptions(e)},onVideoProgress:function(e){if(!(this._allowConcurrentPlayback||!i.isPlainObject(e)||i.isUndefined(e.target)||i.isUndefined(e.payload)||i.isUndefined(e.payload.playbackState)||e.payload.playbackState!==this.mc.PLAYING)){var t=e.target;i.isEmpty(this.currActiveVCI)&&!i.isUndefined(this.VCIs[t])&&(this.currActiveVCI=this.VCIs[t]),t===this.currActiveVCI.vidContId||i.isUndefined(this.VCIs[t])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",t),this.VCIs[t].pauseVideo())}},onVideoPlaybackInitiated:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",e),!this._allowConcurrentPlayback&&i.isPlainObject(e)&&!i.isUndefined(e.target)){var t=e.target;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),i.isEmpty(this.VCIs)||i.isUndefined(this.VCIs[t])||this.currActiveVCI&&this.currActiveVCI.vidContId===t||(this.currActiveVCI=this.VCIs[t],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))}},uvpjsError:function(e){e?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",e.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(e){e?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",e.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),e.VideoManager._instance=null,e.VideoManager.destroyInstance=function(){this._instance=null},e.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(t)),this._instance}}(uvpjs.register("uvpjs")),function(e){var t,i,n,s,r,a,o,l,d,u,c,h,p,f,v,g=e._;e.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(e){var t=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,e&&(this._cviModel=e.cviModel,this._eventsMgr=e.eventsMgr,this._containerId=e.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=i(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=t.getCaptionsLineOffset(),this._lineAlign=t.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=e.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._disabled=!1,this.subtitleLanguage="en",this.subtitleMasterList=null,this.ccDisplayRequested=!1,this.isAndroidOnHlsjs=uvpjs.mediaCapabilities.canPlayHlsjsAndriod(this._cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=e,this.isAndroidOnHlsjs||!this._ccEl&&this._createCaptionsElement()},showCaptions:function(e){if(this._deferLoadingCaptions&&!this._hasCaptions())return this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this));this.setCaptionLanguage(e),this.ccDisplayRequested=!0,!this._getActiveTrack()&&uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(e,"showing")},setCaptionLanguage:function(e){var t=e.payload.language;if(uvpjs.util.isDefinedString(t)){var i=this._getActiveTrack();i&&i.language===this.subtitleLanguage&&this.subtitleLanguage!==t&&this._clearCaptionTrack(i),this._ccEl&&(this._ccEl.innerHTML=""),this.subtitleLanguage=t}},getCaptionInfo:function(){for(var e=[],t=this.subtitleMasterList||this._getTextTracks(),i=this._getActiveTrack(),n=0;n<t.length;n++){var s=t[n];enabled=i&&i.language===s.language||!1,e.push({language:s.language,label:s.label,kind:s.kind,enabled:enabled})}return this.subtitleMasterList=e,this.subtitleMasterList},hideCaptions:function(e){this.ccDisplayRequested=!1,this._toggleVisibility(e,"hidden")},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:g.clone(this.styles)},setStyles:function(e){var t,i,n,s=this._pageStyles,r=e.length;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",e);r--;)n=e[r],t=p(n.name),i=n.value,s[t]=i;this._updateStylesObject(s),this._applyStyles(),this._setPosition(s["text-position"]||null)}},setCueProperty:function(e,t){var i;if(!this._disabled){if(i=this._getActiveTrack(),!(e&&t&&i&&this._supportsVTTCue))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",e,t));this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",i,e,t),this._props[e]=isNaN(t)?t:Number(t)}},_addEventListeners:function(){var e=this._eventsMgr,t=e.eventTypes,i=this._namespace,n=this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners",n),e.addEventListener(t.CONTAINER_RESIZE+i,this._onContainerResize.bind(this)),e.addEventListener(t.CONTROL_LOAD_CAPTIONS+i,this._onControlLoadCaptions.bind(this)),e.addEventListener(t.CONTENT_DATA_LOADED+i,this._onContentDataLoaded.bind(this)),e.addEventListener(t.CONTROL_SHOW_CAPTIONS+i,this.showCaptions.bind(this)),e.addEventListener(t.CONTROL_HIDE_CAPTIONS+i,this.hideCaptions.bind(this)),e.addEventListener(t.SET_CAPTIONS_LANG+i,this.setCaptionLanguage.bind(this)),e.addEventListener(t.CONTENT_FACADE_CREATED+i,this._onContentFacadeCreated.bind(this)),e.addEventListener(t.RESOURCE_END+i,this._onVideoComplete.bind(this)),e.addEventListener(t.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this))},_removeEventListeners:function(){var e=this._eventsMgr,t=e.eventTypes,i=this._namespace;this._cviModel.contentVideoState.isLive,this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),e.removeEventListener(t.CONTAINER_RESIZE+i),e.removeEventListener(t.CONTROL_LOAD_CAPTIONS+i),e.removeEventListener(t.CONTENT_DATA_LOADED+i),e.removeEventListener(t.CONTROL_SHOW_CAPTIONS+i),e.removeEventListener(t.CONTROL_HIDE_CAPTIONS+i),e.removeEventListener(t.SET_CAPTIONS_LANG+i),e.removeEventListener(t.CONTENT_FACADE_CREATED+i),e.removeEventListener(t.RESOURCE_END+i),e.removeEventListener(t.VIDEO_PROGRESS+i)},_createTrackElement:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",e);var t=document.createElement("track");t.default=!0,t.kind="captions",t.label="English",t.srclang="en",t.id=this._trackId,t.src=e,this._videoEl.appendChild(t)},_createCaptionsElement:function(){var e=uvpjs.util,t=this._styleEl,i=document.createElement("div"),n=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);i.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),n?(n.appendChild(i),this._ccEl=i,e.addCSSObject(t,i,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),e.addCSSObject(t,i,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),e.addCSSObject(t,i,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container.")},_dispatchCaptionsError:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",e),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:e},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this.adjustVttCuesLinePosition(),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(e){e.target===this._containerId&&this._setRect()},_onVideoComplete:function(e){var t,i,n=e.target,s=this._videoEl;n===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",n),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,s&&s.removeEventListener("loadeddata",this._onLoadedData),s&&s.removeEventListener("timeupdate",this._onTimeUpdate),(i=this._getTextTracks())&&(i.onaddtrack=null),(t=this._getActiveTrack())instanceof window.TextTrack&&o(t)&&(t.mode="disabled",t.oncuechange=null),this._trackCount++)},_onContentDataLoaded:function(e){var t,i=uvpjs.util,n=e.target,s=e.payload.vidState,r=s.closedCaptionPath;s.isLive,n===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",n),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,(t=this._getTextTracks())&&(t.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),i.isDefinedString(r)&&(this._captionsUrl=r))},_onLoadedData:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",e),this._checkForLiveCaptions()},_onTimeUpdate:function(e){!this.hasDispatchedCaptionsReady&&!!this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(e)},_onControlLoadCaptions:function(e){var t;e.target===this._containerId&&(t=e.payload.url,g.isString(t)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",e.target),this._loadCaptionsUrl(t)))},_onContentFacadeCreated:function(e){e.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",e.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(e){var t=e.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",e);try{t=(t=t.replace(/\n/g,"")).substr(t.indexOf("<?xml"));var i=(new DOMParser).parseFromString(t,"text/xml");this._xmlToCues(i)}catch(e){var n="Error parsing closed captions XML.";this._dispatchCaptionsError(n),this.debug&&uvpjs.error(this.DEBUG_ID,n,e)}},_onLoadError:function(e){var t=e.status,i="Unknown error";switch(t){case 404:i="File not found";break;case 500:i="Server error";break;case 0:i="Request aborted"}i+=" "+t,this._dispatchCaptionsError(i),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",i)},_onAddTrack:function(e){var t=e.track;t.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(t,!1),o(t)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",e)},_syncCCTrackMode:function(e,t){if(e)return t?void(e.mode="disabled"):void(this.useNativeBrowserControls||uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(e.mode="showing"):"hidden"!==e.mode&&(e.mode="hidden"))},_onVideoProgress:function(e){var t;if(e.target===this._containerId){var i=this._getActiveTrack();if(this.isAndroidOnHlsjs||this._syncCCTrackMode(i,!1),!this._hasCaptions())return void(this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1));if(!this._liveCaptionsInitalized)return void this._checkForLiveCaptions();if(i&&i.activeCues&&(t=i.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);t--;)e.payload.currentTime-i.activeCues[t].endTime>1&&this.showCcContainer(!1);else this.showCcContainer(!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!e||!this._liveCaptionsInitalized){try{!e&&this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(e){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",e),this._dispatchCaptionsError(e)}e&&(this._liveCaptionsInitalized=!0),this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var e=this._getActiveTrack(),t=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),e&&(e.oncuechange=t)||this._videoEl.addEventListener("timeupdate",t)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var e=g.get(this._captionsJson,"tt.head.styling.style");e=g.isArray(e)?e[0]:e,this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",e),e?this._inlineStyles={backgroundColor:e["tts:backgroundColor"],color:e["tts:color"],fontFamily:e["tts:fontFamily"],fontSize:e["tts:fontSize"],fontStyle:e["tts:fontStyle"],fontWeight:e["tts:fontWeight"],textAlign:e["tts:textAlign"],textDecoration:e["tts:textDecoration"]}:this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file.")},_applyStyles:function(){var e,i,n,s=uvpjs.util,r=this.styles,a=this._styleSelector,o=[];for(i in this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",r),r){switch(n=r[i],e=!1,i){case"background-opacity":case"font-opacity":e=!0;break;case"text-position":e=!0,this._setPosition(n);break;case"background-color":n=t(n,r["background-opacity"]);break;case"color":case"font-color":i="color",n=t(n,r["font-opacity"]);break;case"text-edge-style":i="text-shadow",n=f(n)}e||(l(i,n)?o.push({name:i,value:n}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",i,n))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",a,o),s.addCSSRules(this._styleEl,a,o)},_updateStylesObject:function(e){var t,i,s;for(t in e){if(!(i=e[t])||!t)return;if((s=p(t))in this.styles){switch(s){case"font-size":i=n(i)}this.styles[s]=i}else this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",s)}},_hasCaptions:function(){return o(this._getActiveTrack())},_loadOrDeferCaptions:function(e){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(e)},_loadCaptionsUrl:function(e){var t=uvpjs.util.isDefinedString(e),i=t&&-1!==e.indexOf(".vtt");if(t&&!this._cviModel.contentVideoState.isFlash){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),i)return void this._createTrackElement(e);(new uvpjs.CodeLoader).loadXHR(e,this._onLoadComplete.bind(this),this._onLoadError.bind(this))}},_checkForLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),this._hasCaptions()?(this._finalizeTrackElement(),this._finalizeLiveCaptions()):this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize.")},_clearAllCaptionTracks:function(){var e=this._getTextTracks(),t=e&&e.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",e);t--;)this._clearCaptionTrack(e[t]);this._ccEl&&(this._ccEl.innerHTML="")},_clearCaptionTrack:function(e){var t,i;if(o(e)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",e),i=(t=e&&e.cues)&&t.length||0;i--;)e.removeCue(t[i]);this._syncCCTrackMode(e,!0),e.cues=null}},_toggleVisibility:function(e,t){e.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",t),this.showCcContainer("hidden"!==t))},showCcContainer:function(e){this.isAndroidOnHlsjs?this._getActiveTrack().mode=e?"showing":"hidden":this._ccEl&&(this._ccEl.style.display=!1===e?"none":"block")},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){var e,t,i,n=this._getTextTracks(),s=n&&n.length||0;for(i=0;i<s;i++)if((t=(e=n[i])&&e.cues)&&t.length&&o(e))return e},enableCaptionsTracks:function(){for(var e,t=this._getTextTracks(),i=t&&t.length||0;i--;)e=t[i],o(e)&&(e.mode="hidden")},_getTrackById:function(e){var t=this._getTextTracks();return t&&t.getTrackById(e||this._trackId)},_getActiveCues:function(){var e=this._getActiveTrack();return e&&e.activeCues},_getAllCues:function(){var e=this._getActiveTrack();return e&&e.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var e,t,i=this._cviModel.getModule(this.CONFIG_MODULE_NAME),n={};return this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",i),i?!0!==i.enabled?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled.")):g.isEmpty(i.params)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty.")):(g.each(i.params,function(i){e=i.name,t=i.value,e&&t&&(p(e),n[e]=t)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(n,null,2)),void(this._configStyles=n)):void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found."))},_setPosition:function(e){var t=["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"].indexOf(e)>-1?e:"bottom-center-floated";this._setPositionCSS(t)},_setPositionCSS:function(e){var t,i,n,s,r,a,o=uvpjs.util,l=this._styleEl,d=this._ccEl,u=d&&d.style.marginBottom,c=parseInt(this.BASE_CONTROLS_HEIGHT);l&&d&&(s=(i=e.split("-"))[0],n=i[1],r="inherit"===u?0:parseInt(u),a=isNaN(r)?c+"px":(r>c?10:c-r)+"px",t={top:{top:"10px",middle:"50%",bottom:"auto"}[s],bottom:{top:"auto",middle:"auto",bottom:a}[s],"text-align":n,transform:"initial"},"middle"===s&&(t.transform="translateY(-50%)"),o.addCSSObject(l,d,t,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var e=this.styles;e&&this._setPosition(e["text-position"])},_setRect:function(){function e(){g.assign(h.style,a),p&&(g.assign(p.style,a),this._checkBottomPosition())}var t,i,n,s,r,a,o,l,d,u,c,h=this._videoEl,p=this._ccEl,f=h&&h.parentNode;h&&f&&(s=h.videoHeight,(r=h.videoWidth)&&s&&(i=h.getBoundingClientRect(),t=f.getBoundingClientRect(),n=i.height/i.width/(s/r),d=t.height-i.height,l=t.width-i.width,c=n<1||0!==l&&0===d,(a=(u=n>1||0===l&&0!==d)?{height:"auto","max-height":"100%",width:"100%",margin:0}:c?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0})&&e.call(this),i=h.getBoundingClientRect(),d=(t=f.getBoundingClientRect()).height-i.height,l=t.width-i.width,u?a={margin:"inherit","margin-top":o=d/2+"px","margin-bottom":o}:c&&(a={margin:"inherit","margin-left":o=l/2+"px","margin-right":o}),p&&(a["font-size"]=this._calculateFontSize(i.width)),a&&e.call(this)))},_calculateFontSize:function(e){var t;try{t=e/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),t=Math.max(t,parseInt(this.MIN_FONT_SIZE))}catch(e){console.error(e)}return t&&t+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(e){var t=e&&e.target,i=t&&t.activeCues||this._getActiveCues();this._setCueProps(i)},adjustVttCuesLinePosition:function(){if(this.isAndroidOnHlsjs){var e=this._getAllCues();if(e&&e.length>0){this._syncCCTrackMode(this._getActiveTrack(),!1);for(var t=0;t<e.length;t++){var i=e[t];!i||"auto"!==i.line&&-1!==i.line&&-2!==i.line||(i.line=-3)}}}},_setCueProps:function(e){this._addCuesToCaptionsElement(e)},_xmlToCues:function(e){var t,i,n,a,o,l,d,c,h,p,f,_=v(e);if(this._captionsJson=_,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",_),!g.isEmpty(_)&&g.isPlainObject(_)){if(i=g.get(_,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",i),g.isUndefined(i)||g.isEmpty(i))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file."));if(!(t=this._supportsVTTCue?window.VTTCue:window.TextTrackCue))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions."));for((o=this._videoEl.addTextTrack("captions","English","en")).id=this._trackId,p=i.length,c=0;c<p;c++)if(h=c+1,d=i[c],a=i[h],l=d.text,!g.isEmpty(l)){for(l=(l=(l=l.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3")).replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3")).replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),f=s(l),d._lineCountPrev=d._lineCountPrev||0,d._lineCountNext=d._lineCountNext||0;(a&&a.begin)===d.begin;)a._lineCountPrev=f+d._lineCountNext,d._lineCountNext+=s(a.text),a=i[++h];(n=new t(r(d.begin),r(d.end),l))._lineCount=f,n._lineCountPrev=d._lineCountPrev,n._lineCountNext=d._lineCountNext,n._metadata=d.metadata,n=u.call(this,n),o.addCue(n)}this._finalizeCaptions()}},_addCuesToCaptionsElement:function(e){var t,i,n=uvpjs.util,s=this._ccEl,r='<div class="{{cntrClass}}">{{spans}}</div>',a="",o=e&&e.length;if(o){for(t=0;t<o;t++)i=e[t].text,n.isDefinedString(i)&&(a+='<span class="{{txtClass}}">'+(i=i.replace(/(\r\n|\n|\r)/g,"<br/>"))+"</span>",t+1!==o&&(a+="<br/>"));r=(r=(r=r.replace("{{spans}}",a)).replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME)).replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),s&&(s.innerHTML=r)}}}),t=function(e,t){var i=c(e)||a(e)||a(d(e));return i&&t?h(i.r,i.g,i.b,t):e},i=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},n=function(e){var t="100%";return e.indexOf("px")>-1?(t=e.replace("px",""),t=100*(t/=18)+"%"):e.indexOf("%")>-1&&(t=e),t},s=function(e){return e&&(e.match(/\n/g)||[]).length+1},r=function(e){var t,i;if(!g.isNull(e)&&!g.isUndefined(e))return i=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},t=e.split(":"),i(60*Number(t[0])*60+60*Number(t[1])+Number(t[2]),2)},a=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,n){return t+t+i+i+n+n});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},o=function(e){return e instanceof window.TextTrack&&("captions"===e.kind||"subtitles"===e.kind)},l=function(e,t){if(e&&t)return g.get(window,"CSS.supports")?window.CSS.supports(e,t):"string"==typeof document.createElement("div").style[e]},u=function(e){var t,i=e._metadata;if(i){e.snapToLines=!0,t=Math.round(i.cccol/35*100),e.position=t;try{e.align=t<45?"start":t>55?"end":this._lineAlign}catch(t){e.align="center"}e.positionAlign=t<45?"line-left":t>55?"line-right":"center",e.line=i.ccrow-17+this._lineOffset,e._defaults={line:e.line,position:e.position,align:e.align,positionAlign:e.positionAlign}}return e},d=function(e){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[e.toLowerCase()]},c=function(e){var t;if(-1!==e.indexOf("rgba"))return{r:(t=e.substr(5,e.length).split(","))[0],g:t[1],b:t[2]}},p=function(e){if(g.isString(e)&&!g.isEmpty(e))return e.replace(/([A-Z])/g,"-$1").toLowerCase()},h=function(e,t,i,n){return"rgba("+[e,t,i,n].join(",")+")"},f=function(e){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[e]||"none"},v=function(e){var t={};if(1===e.nodeType&&e.attributes.length>0)for(var i=0,n=e.attributes.length;i<n;i++){var s=e.attributes.item(i);t[s.nodeName]=s.nodeValue}else 3===e.nodeType&&(t=e.nodeValue);if("p"===e.nodeName&&(t.text="",g.each(e.childNodes,function(e){if("metadata"!==e.nodeName){var i=(new XMLSerializer).serializeToString(e);1===e.nodeType&&(t.text+="br"===e.tagName?"\n":i),3===e.nodeType&&(t.text+=i)}})),e.hasChildNodes())for(var r=0,a=e.childNodes.length;r<a;r++){var o=e.childNodes.item(r),l=o.nodeName;if(void 0!==t[l]){if(void 0===t[l].push){var d=t[l];t[l]=[],t[l].push(d)}t[l].push(v(o))}else t[l]=v(o)}return t}}(uvpjs.register("uvpjs")),function(e){"use strict";var t=e._;e.ConfigDataObject=uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(e)},initialize:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",e),this.overrideSessionOptions(e)},destroy:function(){this.modules=null,this.classes=null},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(e){var t;if(!uvpjs.util.isEmpty(e.standardParams)&&null===this.adCallParams.standardParams)for(t in this.adCallParams.standardParams={},e.standardParams)this.adCallParams.standardParams[t]=e.standardParams[t];if(!uvpjs.util.isEmpty(e.customParams)&&null===this.adCallParams.customParams)for(t in this.adCallParams.customParams={},e.customParams)this.adCallParams.customParams[t]=e.customParams[t]},overrideSessionOptions:function(e){var i=this.getSessionOptions(e);i&&t.isPlainObject(i)?this.sessionOptions=i:this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type.")},getSessionOption:function(e){return this.sessionOptions[e]||null},getSessionOptions:function(e){var i,n,s;if(i=t.clone(this.sessionOptions),!e||!t.isPlainObject(e))return i;if((n=e.skinConfig)&&!t.isEmpty(n))for(s in uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object."),n)i.hasOwnProperty(s)&&(i[s]=n[s]);for(s in i)e.hasOwnProperty(s)&&(i[s]=e[s]);return i},getModule:function(e){return n(this.modules,e)},getModules:function(){return this.modules},getModuleParam:function(e,t){var i=n(this.modules,e),s=n(i.params,t);if(s&&s.hasOwnProperty("value"))return s.value},setModule:function(e){a(this.modules,e,"name",this.DEBUG_ID)},isModuleEnabled:function(e){var t=this.getModule(e);if(!t){var i="ConfigDataObject isModuleEnabled module not found: "+e;return this.debug&&uvpjs.log(this.DEBUG_ID,i),!1}return this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+e+":",t.enabled),t.enabled},isModuleSet:function(e){return!!this.getModule(e)},getClass:function(e){return n(this.classes,e)},getClasses:function(){return this.classes},getClassProperty:function(e,t){var i=n(this.classes,e),s=r.call(this,i,"properties",this.DEBUG_ID),a=n(s,t);return r.call(this,a,"value",this.DEBUG_ID)},getClassListItems:function(e){var t=n(this.classes,e);return r.call(this,t,"list",this.DEBUG_ID)},getClassListItemProperty:function(e,t,i){var a=this.getClassListItems(e),o=s(a,t),l=r.call(this,o,"properties",this.DEBUG_ID),d=n(l,i);return r.call(this,d,"value",this.DEBUG_ID)},setClass:function(e){a(this.classes,e,"name",this.DEBUG_ID)},isCAN:function(){return t.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()},copyModules:function(e){for(var t=e.length;t--;)for(var i=e[t],n=this.modules.length;n--;)if(this.modules[n].name===i.name){this.modules[n]=i;break}}});var i=function(e,t,i){for(var n in e)if(e[n][t]==i)return e[n];return!1},n=function(e,t){return i(e,"name",t)},s=function(e,t){return i(e,"id",t)},r=function(e,t,i){return e?e.hasOwnProperty(t)?e[t]:(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty no item property:",e,t),!1):(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty item not found:",e),!1)},a=function(e,t,i,n){for(var s in e)if(e[s][i]==t[i])return this.debug&&uvpjs.log(n,"ConfigDataObject _addItemToArray updating existing item",t),void(e[s]=t);this.debug&&uvpjs.log(n,"ConfigDataObject _addItemToArray creating item",t),e.push(t)}}(uvpjs.register("uvpjs")),function(e){var t=e._,i=Math.random();e.ConfigManager=uvpjs.Class.subClass({init:function(e,t,n){this.debug=uvpjs.debug,e&&e===i?(this.initCallback=n,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",t),this.CDO=new uvpjs.ConfigDataObject(t),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance().")},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(this.configSources.length){var e=this.configSources.shift();if(null!=e)switch(e.constructor){case String:if(""===e)break;return void(new uvpjs.CodeLoader).loadXHR(e,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=e.concat(this.configSources);break;case Object:this.updateCDO(e)}this.loadConfig()}else t.isFunction(this.initCallback)&&this.initCallback(this.CDO)},onLoadComplete:function(e){var t,i,n=e.responseText,s=e.getResponseHeader("Content-Type");s.indexOf("application/json")>-1?i=JSON.parse(n):s.indexOf("text/xml")>-1||s.indexOf("application/xml")>-1?(t=(new DOMParser).parseFromString(n,"text/xml"),i=this.xmlToCDO(t)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",s),i&&this.updateCDO(i),this.loadConfig()},onLoadError:function(e){var t="unknown error";switch(e.status){case 0:t="request timeout"}this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",t,e),this.loadConfig()},updateCDO:function(e){t.isEmpty(e)?this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"):["classes","modules"].map(function(t){e.hasOwnProperty(t)&&(this.CDO[t]=n(this.CDO[t],e[t]))},this)},xmlToCDO:function(e){var t={},i=function(e){return"y"===e||"n"===e},n=function(e){return"y"===e},a=s(e);return a.hasOwnProperty("player-config")&&(a=a["player-config"]),t.modules=function(){var e,t=[];if(a.modules){for(var s in e=r(a.modules.module)){var o=e[s],l={name:o.name,category:o.category,enabled:n(o.enabled),params:[]};if(e[s].hasOwnProperty("params")){var d=r(o.params.param);for(var u in d){var c=d[u];c.name&&(i(c.value)&&(c.value=n(c.value)),l.params.push(c))}}o.category,t.push(l)}return t}}(),t.classes=function(){var e=r(a.classes),t=[];for(var i in e){var n=e[i];if(n.hasOwnProperty("classDef")&&(n=n.classDef),n.name){var s={name:n.name,className:n.className,properties:[],list:[]};if(n.hasOwnProperty("list")){var o=r(n.list.listitem);for(var l in o){var d=o[l];d.id&&(d.hasOwnProperty("properties")&&(d.properties=d.properties.property),s.list.push(d))}}n.hasOwnProperty("properties")&&(s.properties=n.properties.property),t.push(s)}}return t}(),t},getCDO:function(){return this.CDO}}),e.ConfigManager._instance=null,e.ConfigManager.destroyInstance=function(){this._instance=null},e.ConfigManager.getInstance=function(e,t){return this._instance||(this._instance=new uvpjs.ConfigManager(i,e,t)),this._instance};var n=function(e,t){for(var i in t){var n=!1;for(var s in e)if(e[s].name===t[i].name){n=!0;break}n||e.push(t[i])}return e},s=function(e){var t,i={};if(1===e.nodeType&&e.attributes.length>0){t=e.attributes.length;for(var n=0;n<t;n++){var r=e.attributes.item(n);i[r.nodeName]=r.nodeValue}}if(e.hasChildNodes()){t=e.childNodes.length;for(var a=0;a<t;a++){var o=e.childNodes.item(a),l=o.nodeName;if(3!==o.nodeType)if(void 0!==i[l]){if(void 0===i[l].push){var d=i[l];i[l]=[],i[l].push(d)}i[l].push(s(o))}else i[l]=s(o)}}return i},r=function(e){if(void 0!==e&&e.constructor!==String)return e.constructor===Object&&(e=[e]),e}}(uvpjs.register("uvpjs")),function(e){"use strict";var t=null,i=null,n=e._;e.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1,this.isMobile=!1},initialize:function(e){var n=e.resourceProvider,s=n.vidContId;this.resourceProvider=n,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=s,this.assetURL=e.assetURL,this.vidContentId=this.PREFIX_CONTENT+s,this.internalNS="."+s+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+s),this.deferLoadingCaptions=e.deferLoadingCaptions,this._updateVolumeSettings(e),n.createWatermark()&&!e.suppressWatermark&&(t=new uvpjs.Watermark({containerId:s,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),n.is360()&&!e.suppress360&&(i=new uvpjs.Kaleidoscope360({containerId:s,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==e.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){n.isEmpty(this.resourceProvider)?this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."):(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),t&&(t.destroy(),t=null),i&&(i.destroy(),i=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1)},_updateVolumeSettings:function(e){var t=(e=e||{}).volume,i=!0===e.isMuted,n=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",e),uvpjs.util.inRange(t,0,1)&&n.volume!==t&&(n.volume=t),"isMuted"in e&&n.muted!==i&&this.muteVideo(i)},_addHTML5Events:function(){var e,t=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(e in this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events"),t)"CLICK"!==e&&"TOUCH_END"!==e&&this.videoTagRef.addEventListener(t[e],this,!1);this.videoTagRef.addEventListener(t[i],this,!1)},_removeHTML5Events:function(){var e,t=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(e in this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events"),t)"CLICK"!==e&&"TOUCH_END"!==e&&this.videoTagRef.removeEventListener(t[e],this,!1);this.videoTagRef.removeEventListener(t[i],this,!1)},handleEvent:function(e){var t=this.eventTypes.HTML5;if(this.videoTagRef)switch(e.type){case t.ABORT:break;case t.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(t.CAN_PLAY,this,!1);break;case t.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(t.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case t.CLICK:case t.DURATION_CHANGE:break;case t.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case t.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case t.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(e.target.error);break;case t.LOAD_START:if(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),n.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(uvpjs.mediaCapabilities.isIOS())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case t.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case t.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case t.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case t.PLAY:break;case t.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case t.PROGRESS:this.videoLoading();break;case t.RATE_CHANGE:break;case t.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",e);break;case t.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",e),this.seeked(e.target.currentTime);break;case t.STALLED:case t.SUSPEND:break;case t.TIME_UPDATE:this.timeUpdated();break;case t.VOL_CHANGE:this.volumeChanged();break;case t.WAITING:}},seeked:function(e){var t=this.videoTagRef.paused,i=uvpjs.mediaCapabilities;this.playbackStateChange(t?i.PAUSED:i.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:e,paused:t,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:e})},videoLoading:function(){var e;try{e=this.videoTagRef.buffered.end(0)||0}catch(t){e=0}var t={bufferLength:e,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(t)},volumeChanged:function(){var e=this.videoTagRef.volume;!n.isNumber(e)||e<0?e=0:e>1&&(e=1),this.resourceProvider.facadeVolumeChange(e)},timeUpdated:function(){var e=this.videoTagRef.currentTime;"number"==typeof e&&this.resourceProvider.facadeTimeUpdate(e)},error:function(e){var t=uvpjs.ErrorInfo.messages,i=uvpjs.ErrorInfo.errorCodes,s=t.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,r=i.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,a=!0;if(e)switch(e.code){case e.MEDIA_ERR_ABORTED:a=!1,s=t.MEDIA_ERR_ABORTED,r=i.MEDIA_ERR_ABORTED;break;case e.MEDIA_ERR_NETWORK:s=t.MEDIA_ERR_NETWORK,r=i.MEDIA_ERR_NETWORK;break;case e.MEDIA_ERR_DECODE:s=t.MEDIA_ERR_DECODE,r=i.MEDIA_ERR_DECODE;break;case e.MEDIA_ERR_SRC_NOT_SUPPORTED:s=t.MEDIA_ERR_SRC_NOT_SUPPORTED,r=i.MEDIA_ERR_SRC_NOT_SUPPORTED}this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+s),n.isEmpty(this.resourceProvider)?this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."):this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:r,message:s,isFatal:a}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var e;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(e=this.videoTagRef.play())&&e.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+e.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(e.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",e),isNaN(e)||this.videoTagRef&&e>=0&&e<this.videoTagRef.duration&&(this.videoTagRef.currentTime=e)},seekToLive:function(){if(this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef){var e=this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&this.videoTagRef.seekable.end(0);!isNaN(e)&&e>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=e)}},toggleMute:function(){var e;this.videoTagRef&&(e=!this.videoTagRef.muted,this.muteVideo(e))},setFullscreenState:function(e){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(e){var t=!1!==e;this.videoTagRef&&(this.videoTagRef.muted=t,t&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),!t&&this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(e){this.videoTagRef&&e>=0&&e<=1&&(this.videoTagRef.volume=e)},getDuration:function(){var e=0;return this.videoTagRef&&(e=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&(e=this.videoTagRef.seekable.end(0)),e},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(e){(!this.isAbrStreamingSupported()||"boolean"!=typeof e)&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(e){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(e){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(e){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(e,t,i){if(e.length>0){var n=e.length,s=e[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(t>=e[n-1][s])return n-1;for(;n--;)if(t>=e[n][s])return i?n+1:n}return 0},addSessionIdAndTicketToURL:function(e,t,i){if(!e)return e;var n=function(e){return-1!==e.indexOf("?")?"&":"?"};return t&&-1===e.indexOf("SessionId=")&&(e+=n(e)+"SessionId="+t),i&&-1===e.indexOf("Ticket=")&&(e+=n(e)+"Ticket="+i),e},processResponseHeader:function(e,t){switch(t){case this.responseHeaders.MULTI_CDN:this.resourceProvider.getContentVideoStateCdn()!==e&&this.resourceProvider.setContentVideoStateCdn(e)}},getCdnNameAtStartup:function(e){return""},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(e,t){},getBuffered:function(){var e,t=this.videoTagRef,i=t&&t.buffered,n=0,s=0;return i&&i.length>0&&(n=i.start&&i.start(0),s=i.end&&i.end(0)),(e=s-n)>0&&e||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(e){if(this.videoTagRef){var t=this.videoTagRef.hasAttribute(this.CONTROLS);e&&!t?this.videoTagRef.setAttribute("controls",this.CONTROLS):!e&&t&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(e){if(e!==this.playbackState){if(this.playbackState=e,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+e),n.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"));this.resourceProvider.facadePlaybackStateChange(e)}},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var e=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!n.isUndefined(e),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,e=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",e),e},normalizeAudioTrackInfo:function(e,t){if(e){for(var i=[],n=0;n<e.length;n++){var s=e[n];this.checkCodecForWeb(s)&&i.push({index:n,id:s.id,type:s.type||s.kind,codec:s.codec||"n/a",label:t===uvpjs.mediaCapabilities.DASHJS?s.lang:s.label||s.name})}return i}},checkCodecForWeb:function(e){return!e.codec||-1!==e.codec.indexOf("mp4a")}})}(uvpjs.register("uvpjs")),function(e){"use strict";var t="www.nielsen.com";e.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(e){for(var t in e)this.initOptions[t]=e[t];e.suppress360=!0,e.suppressCreatedEvent=!0,this._super(e),this.swfService=e.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){var e;for(e in this.windowLabels)window[this.windowLabels[e]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(e){this.player&&this.player.setVolume(e)},seekTo:function(e){this.player&&this.player.seekTo(e)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(e){this.swfService.resetSize()},loadCaptions:function(e){this.captionsUrl=uvpjs.util.isEmpty(e)?null:e,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(e)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl?(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0,this.player.showCaptions()):this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(e){for(var t,i,n,s=Array.isArray(e)&&e.length||0,r=uvpjs.util,a=uvpjs.VPF_Flash.styleTransform;s--;)t=e[s],n=a[i=this.dashToCamel(t.name)]?a[i](t.value):t.value,!r.isEmpty(t.value)&&this.player.setStyleAttribute(i,n)},setId3Options:function(e){this.id3Options=e},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(e){var t=!1===e?"false":"true";this.player.enableDynamicStreaming(t)},switchToBitrate:function(e){var t=this.findClosestBitrate(e);-1!==t.index&&this.player.switchStreamingIndex(t.index)},setMinBitrateAllowed:function(e){var t=this.findClosestBitrate(e);-1!==t.index&&(this.bitrateInfo.min=t.bitrate,this.player.setMinimumStreamingIndex(t.index))},setMaxBitrateAllowed:function(e){var t=this.findClosestBitrate(e);-1!==t.index&&(this.bitrateInfo.max=t.bitrate,this.player.setMaximumStreamingIndex(t.index))},switchUp:function(){var e=this.currFlashVideoState.playbackBitrate,t=this.findClosestBitrate(e),i=-1!==t.index&&this.bitrateInfo.bitrates.length;-1!==t.index&&t.index<i-1&&this.player.switchStreamingIndex(t.index+1)},switchDown:function(){var e=this.currFlashVideoState.playbackBitrate,t=this.findClosestBitrate(e);-1!==t.index&&t.index>0&&this.player.switchStreamingIndex(t.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var e=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return e?this.bitrateInfo.bitrates[e-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(e){for(var t,i=this.bitrateInfo.bitrates,n=i?i.length:0,s={bitrate:0,delta:1/0,index:-1};n--;)(t=Math.abs(e-i[n]))<s.delta&&(s.bitrate=i[n],s.index=n,s.delta=t);return s},hContentEvent:function(e){var t=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(e){case t.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case t.CONTENT_END:}},hPlaybackEvent:function(e,t){var i,n=uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(e){case n.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+t);break;case n.VIDEO_PROGRESS:this.processCvioPayload(t);break;case n.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(t);break;case n.VIDEO_ERROR:this.processCvioPayload(t),this.dispatchError();break;case n.VIDEO_DONE:this.processCvioPayload(t),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case n.VIDEO_TRANSITION_COMPLETE:i=this.parsePayload(t),this.resourceProvider.facadeVideoTransitionComplete(i.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case n.VIDEO_TRANSITION_START:i=this.parsePayload(t),this.pendingSwitchMode=i.reason.toLowerCase().indexOf("manual")>=0?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(i.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(e){var t,i,n=this.parsePayload(e,"ContentVIO");if(n){for(t in i=n.ContentVIO)this.currFlashVideoState[t]=this.getCvioValue(i[t]);null===this.bitrateInfo.bitrates&&i.currentTime>0&&this.captureBitrateInfo()}},setStartBitrate:function(){this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var e=[],t=[],i=this.player.getContentBitrateInfo(),n="string"==typeof i&&i.split(","),s=Array.isArray(n)?n.length:0;s--;)e[s]=+n[s],t[s]={bitrate:+n[s]};this.bitrateInfo.bitrates=e,this.bitrateInfo.abrInfo=t},processCuepointPayload:function(e){var i=this.parsePayload(e,"Cuepoint"),n=this.id3Options,s={pts:null};!i||!n.dataCallback||i.text.indexOf("syncbak.cc")>=0||(s.name=n.findNielsen&&i.text.indexOf(t)>-1?t:i.name,s.data=i.text,n.dataCallback(s))},getCvioValue:function(e){var t,i,n,s,r;return"boolean"==typeof e||"number"==typeof e?e:"string"==typeof e?(i=!(t="NaN"===e||"null"===e||""===e)&&"true"===e.toLowerCase(),n=!t&&!i&&"false"===e.toLowerCase(),s=!t&&!i&&!n&&parseInt(e),r=isNaN(s)?e:s,t?-1:!!i||!n&&r):void 0},parsePayload:function(e,t){var i=null;if(0===e.indexOf("{")||0===e.indexOf("[")){try{i=JSON.parse(e)}catch(e){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+t+"as JSON; "+e.message),null}return i}return e},addUvpFlashEventListeners:function(){var e,t,i,n,s,r=uvpjs.VPF_Flash.uvpFlashEvent,a={},o=function(e,t,i){return e["h"+(t.charAt(0).toUpperCase()+t.substr(1))+"Event"].bind(e,i)};for(i in r)for(s in t=r[i])a[n=t[s]]=o(this,i,n);for(i in e=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(a))this.player.addEventJSCallback(i,e[i])},loadVideo:function(){var e={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(e.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,e)},initializeCaptionStyles:function(){var e,t={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(e in t)this.player.setStyleAttribute(e,t[e])},dashToCamel:function(e){return e.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}}),e.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},e.VPF_Flash.styleTransform={_opacity:function(e){return 100*+e},backgroundOpacity:function(e){return uvpjs.VPF_Flash.styleTransform._opacity(e)},fontOpacity:function(e){return uvpjs.VPF_Flash.styleTransform._opacity(e)},fontSize:function(e){var t=.01*+e.substr(0,e.indexOf("%"));return Math.round(14*t)}}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.hVideoEvent=this.onVideoEvent.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(e){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",e.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",e)),this._super(e),e.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:e.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),!uvpjs.util.isEmpty(e.startTime)&&(this.startTime=Math.floor(e.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",e)},handleEvent:function(e){var t=this.eventTypes.HTML5;this.videoTagRef&&(this._super(e),e.type===t.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(e,t){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:e,message:t,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(e){console.log("Error caught at setSource: ",e)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onVideoEvent:function(e){e.type===this.eventTypes.HTML5.CAN_PLAY&&(this.videoTagRef.removeEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.updateAudioTracksInfo())},switchAudioTrack:function(e){this.videoTagRef.audioTracks?(this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+e),this.videoTagRef.audioTracks[e].enabled=!0,this.updateAudioTracksInfo()):this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switching is not supported on this user agent")},updateAudioTracksInfo:function(){var e=this.normalizeAudioTrackInfo(this.videoTagRef.audioTracks,uvpjs.mediaCapabilities.HTML5);if(e){var t=this.getCurrentEnabledAudioTrackIndex(this.videoTagRef.audioTracks),i={tracks:e,track:e[t],index:t};this.resourceProvider.facadeSetAudioTrackInfo(i)}},getCurrentEnabledAudioTrackIndex:function(e){for(var t=e.length;t--;)if(e[t].enabled)return t;return t},onAddTextTrack:function(e){e.track&&"metadata"===e.track.kind&&(this.activeMetadataTrack=e.track),e.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(e){e&&e.target&&e.target.activeCues&&e.target.activeCues.length>=1&&("metadata"===e.target.kind?this.resourceProvider.facadeId3Data(e.target.activeCues):"captions"!==e.target.kind&&"subtitles"!==e.target.kind||(e.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},showCaptions:function(e){if(uvpjs.util.isDefinedString(e))for(var t=this.videoTagRef.textTracks,i=0,n=t.length;i<n;i++){var s=t[i];s.mode=s.language===e?"hidden":"disabled"}},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(e){if(t.isEmpty(this.resourceProvider)||t.isEmpty(this.resourceProvider.cviModel))this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",e);else{var i=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",e,i)}}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"prod"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isHdStreamLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.levelDetails=null,this.isMobile=uvpjs.mediaCapabilities.isMobile(),this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onAudioEvent=this.onAudioEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy");for(var e=this.videoTagRef.textTracks,t=0;t<e.length;t++){var i=e[t];"captions"!==i.kind&&"subtitles"!==i.kind||(i.textTrack1&&(i.textTrack1=!1),i.textTrack2&&(i.textTrack2=!1))}this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null,this.levelDetails=null},initialize:function(e){return this._super(e),this.id3HandlingEnabled=e.enableId3Handling,"number"==typeof e.liveSyncDurationCount&&e.liveSyncDurationCount>0&&(this.libConfig.liveSyncDurationCount=e.liveSyncDurationCount),!0===e.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=e.capLevelToPlayerSize),this.isMobile&&(this.libConfig.maxBufferLength=20,this.libConfig.maxMaxBufferLength=60,this.libConfig.liveBackBufferLength=30),uvpjs.util.isEmpty(e.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=e.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof e.startBitrate&&e.startBitrate>-1&&(this.startBitrate=e.startBitrate),"number"==typeof e.maxBitrate&&e.maxBitrate>-1&&(this.maxBitrate=e.maxBitrate),"number"==typeof e.minBitrate&&e.minBitrate>-1&&(this.minBitrate=e.minBitrate),e.startTime&&(this.startTime=Math.round(e.startTime)),e.errorRecovery&&this.setErrorRecoveryOverrides(e.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){this.player&&this._isHdStreamLive?this.seekTo(this.getLiveEdgeOffset()):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+isHDStreamLive)},isAbrStreamingSupported:function(){return this.bitrateList?this.bitrateList.length>0:this._super()},useDynamicSwitching:function(e){this._super(),this.player?this.player.nextLevel=e?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchAudioTrack:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+e),this.player.audioTrack=e},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(e){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,e,!1))},switchToIndex:function(e){if(this.isAbrStreamingSupported()){this.getMinBitrateAllowed()>0&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&this.getMaxBitrateAllowed()>0&&this.setMaxBitrateAllowed(-1);var t=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,i=isNaN(t)?this.bitrateList.length-1:t;e>=0&&e<=i?this.player.nextLevel=e:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",i," : Index=",e)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){this.player.subtitleTracks.length>0&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var e=this.player;return this.startBitrate||this.minBitrate||e&&e.levels&&e.levels[0]&&e.levels[0].bitrate||-1},setStartBitrate:function(e){this.player?(e<this.getMinBitrateAllowed()&&(e=this.getMinBitrateAllowed(),this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,e,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var e=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[e].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(e){if(this.player){this.player.config.minAutoBitrate=e-1;var t=this.getIndexForBitrate(this.bitrateList,e,!0);this.player.currentLevel<t&&(this.player.nextAutoLevel=t),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",e)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var e=this.player.maxAutoLevel;return void 0!==e?this.bitrateList[e].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(e){if(!this.player)return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===e?e:this.getIndexForBitrate(this.bitrateList,e,!1),uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",e)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var e=-1;return this.bitrateList&&this.bitrateList[this.player.currentLevel]&&(e=this.bitrateList[this.player.currentLevel].bitrate),e},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var e,t;if(this.player)return(t=(e=this.player.media).getVideoPlaybackQuality)&&"function"==typeof t?t.call(e).droppedVideoFrames:e.webkitDroppedFrameCount||0},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var e=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,t=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(t,e)},getFacadeState:function(){this.videoTagRef&&this.videoTagRef.textTracks.length>0&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var e={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(e.abrInfo=this.bitrateList,e.currentAbr=this.bitrateList[this.player.currentLevel],e.cappedAbrInfo=this.getCappedAbrInfo(),e.startBitrate=this.getStartBitrate(),e.currentBitrate=this.getCurrentBitrate(),e.minBitrate=this.getMinBitrateAllowed(),e.maxBitrate=this.getMaxBitrateAllowed()),e},getStreamType:function(){return"HLS"},isPlayingLive:function(){var e=!1;if(this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.currentTime>=0){var t=Math.floor(this.getLiveEdgeOffset());e=Math.ceil(this.videoTagRef.currentTime)>=t}return e},getLiveEdgeOffset:function(){var e=Number.POSITIVE_INFINITY;return this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.duration>0&&(e=this.videoTagRef.duration-this.player.config.liveSyncDurationCount*this.levelDetails.targetduration),e},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var e=Hls.Events,t=this.onLibraryEvent,i=this.onLevelEvent,n=this.onAudioEvent,s=this.onFragmentEvent;this.player.on(e.MEDIA_ATTACHING,t,!1),this.player.on(e.MEDIA_ATTACHED,t,!1),this.player.on(e.MEDIA_DETACHING,t,!1),this.player.on(e.MANIFEST_PARSED,t,!1),this.player.on(e.MANIFEST_LOADED,t,!1),this.player.on(e.MANIFEST_LOADING,t,!1),this.player.on(e.FPS_DROP,t,!1),this.player.on(e.SUBTITLE_TRACKS_UPDATED,t,!1),this.player.on(e.LEVEL_SWITCHING,i,!1),this.player.on(e.LEVEL_SWITCHED,i,!1),this.player.on(e.LEVEL_LOADING,i,!1),this.player.on(e.LEVEL_LOADED,i,!1),this.player.on(e.LEVEL_UPDATED,i,!1),this.player.on(e.LEVEL_PTS_UPDATED,i,!1),this.player.on(e.AUDIO_TRACKS_UPDATED,n,!1),this.player.on(e.AUDIO_TRACK_SWITCHED,n,!1),this.player.on(e.FRAG_LOADING,s,!1),this.player.on(e.FRAG_LOAD_PROGRESS,s,!1),this.player.on(e.FRAG_LOADED,s,!1),this.player.on(e.FRAG_PARSED,s,!1),this.player.on(e.FRAG_BUFFERED,s,!1),this.player.on(e.FRAG_CHANGED,s,!1),this.player.on(e.FRAG_PARSING_DATA,s,!1),this.id3HandlingEnabled&&this.player.on(e.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(e.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var e=Hls.Events,t=this.onLibraryEvent,i=this.onLevelEvent,n=this.onAudioEvent,s=this.onFragmentEvent;this.player.off(e.MEDIA_ATTACHING,t),this.player.off(e.MEDIA_ATTACHED,t),this.player.off(e.MEDIA_DETACHING,t),this.player.off(e.MANIFEST_PARSED,t),this.player.off(e.MANIFEST_LOADED,t),this.player.off(e.MANIFEST_LOADING,t),this.player.off(e.FPS_DROP,t),this.player.off(e.SUBTITLE_TRACKS_UPDATED,t),this.player.off(e.LEVEL_SWITCHING,i),this.player.off(e.LEVEL_SWITCHED,i),this.player.off(e.LEVEL_LOADING,i),this.player.off(e.LEVEL_LOADED,i),this.player.off(e.LEVEL_UPDATED,i),this.player.off(e.LEVEL_PTS_UPDATED,i),this.player.off(e.AUDIO_TRACKS_UPDATED,n,!1),this.player.off(e.AUDIO_TRACK_SWITCHED,n,!1),this.player.off(e.FRAG_LOADING,s),this.player.off(e.FRAG_LOAD_PROGRESS,s),this.player.off(e.FRAG_LOADED,s),this.player.off(e.FRAG_PARSED,s),this.player.off(e.FRAG_BUFFERED,s),this.player.off(e.FRAG_CHANGED,s),this.player.off(e.FRAG_PARSING_DATA,s),this.id3HandlingEnabled&&this.player.off(e.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(e.ERROR,this.onError)},handleManifestData:function(e){this.bitrateList=this.player.levels;for(var t,i=e.levels,n=i.length,s=[];n--;)t=i[n],s.unshift({name:t.name||null,rate:t.bitrate,width:t.width,height:t.height});s.sort(function(e,t){var i=e.rate,n=t.rate;return i<n?-1:i>n?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:s})},onRequest:function(e,t){this.withCredentials=this.withCredentials||t.indexOf("akamaihd")>-1&&t.indexOf("csmil")>-1,e.withCredentials=this.withCredentials,(this.multiCDNEnabled||-1!==t.indexOf(".m3u8"))&&e.addEventListener("readystatechange",function(i){if(-1!==t.indexOf(".ts")&&e.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled){var n=e.getAllResponseHeaders();this.multiCDNEnabled=-1!==n.indexOf(this.responseHeaders.MULTI_CDN);var s=this.multiCDNEnabled?e.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(t);this.processResponseHeader(s,this.responseHeaders.MULTI_CDN)}}.bind(this))},onLibraryEvent:function(e,t){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,e,t);var i=Hls.Events;switch(e){case i.MEDIA_ATTACHING:case i.MEDIA_ATTACHED:case i.MEDIA_DETACHING:case i.MANIFEST_LOADING:break;case i.MANIFEST_PARSED:this.handleManifestData(t);break;case i.FPS_DROP:break;case i.MANIFEST_LOADED:this.maxBitrate>-1&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),this.minBitrate>-1&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),this.startBitrate>-1&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case i.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(e,t){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,e,t);var i=Hls.Events;switch(e){case i.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(t.details);break;case i.LEVEL_LOADING:break;case i.LEVEL_UPDATED:t.details&&(this.levelDetails=t.details,this._isHdStreamLive=t.details.live);break;case i.LEVEL_PTS_UPDATED:break;case i.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[t.level].bitrate);break;case i.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[t.level].bitrate)}},onAudioEvent:function(e,t){if(e===Hls.Events.AUDIO_TRACKS_UPDATED||e===Hls.Events.AUDIO_TRACK_SWITCHED){var i=this.normalizeAudioTrackInfo(this.player.audioTracks,this.mc.HLSJS),n={tracks:i,track:i[this.player.audioTrack],index:this.player.audioTrack};this.resourceProvider.facadeSetAudioTrackInfo(n),this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switched "+n.track.id)}},onFragmentEvent:function(e,t){var i,n,s=Hls.Events;switch(e){case s.FRAG_LOAD_PROGRESS:break;case s.FRAG_PARSING_DATA:"video"===t.type&&(this._playbackFramerate=t.nb/(t.endPTS-t.startPTS));break;case s.FRAG_LOADED:i=8e3*(n=t.stats).loaded/Number(window.performance.now()-n.trequest),this._currentBandwidth=i,this._currentMaxBandwidth=Math.max(i,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case s.FRAG_CHANGED:}},onID3Event:function(e,t){this.resourceProvider.facadeId3Data(t.samples)},onError:function(e,t){var i=!1,n=[Hls.ErrorDetails.MANIFEST_LOAD_ERROR,Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(t.fatal&&-1===n.indexOf(t.details))switch(this.debug&&uvpjs.error(this.DEBUG_ID,e,t.type,t.details,"isFatal: "+t.fatal),t.type){case Hls.ErrorTypes.NETWORK_ERROR:(i=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts)&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(i).network());break;case Hls.ErrorTypes.MEDIA_ERROR:i=this.tryRecoveryFromMediaError()}else t.details===Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",t.type,t.details,"isFatal: "+t.fatal),i=this.tryRecoveryFromMediaError(),setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100)):this.debug&&uvpjs.warn(this.DEBUG_ID,e,t.type,t.details,"isFatal: "+t.fatal);i||(t.response&&t.response.code&&t.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,t.details,t.fatal)),this.debug&&uvpjs.warn(this.DEBUG_ID,uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(t.type,t.details,t.fatal)))},tryRecoveryFromMediaError:function(){var e=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return e&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(e).media()),e},getErrorMsg:function(e){var t=e?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,i=" attempt : ";return{network:function(){return i+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+t+i}.bind(this),media:function(){return i+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+t+i}.bind(this)}},getErrorInfoForType:function(e,t,i){var n=uvpjs.ErrorInfo,s=Hls.ErrorTypes,r=uvpjs.ErrorInfo.errorCodes;switch(e){case s.NETWORK_ERROR:return new n({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_NETWORK_ERROR,message:n.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",t),isFatal:i});case s.MEDIA_ERROR:return new n({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_MEDIA_ERROR,message:n.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",t),isFatal:i});case s.MUX_ERROR:return new n({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_MUX_ERROR,message:n.messages.HLSJS_MUX_ERROR.replace("{INFO}",t),isFatal:i});case s.OTHER_ERROR:return new n({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_OTHER_ERROR,message:n.messages.HLSJS_OTHER_ERROR.replace("{INFO}",t),isFatal:i});case r.RESOURCE_GEOBLOCKED:return new n({errorCode:r.RESOURCE_GEOBLOCKED,hlsjsErrorCode:r.HLSJS_OTHER_ERROR,message:n.messages.RESOURCE_GEOBLOCKED,isFatal:i})}},setErrorRecoveryOverrides:function(e){["network","media"].forEach(function(t){e[t]&&e[t].attempts&&"number"==typeof e[t].attempts&&(this.errorRecovery[t+"RetryAttempts"]=e[t].attempts)}.bind(this))}}),function(e){"use strict";function t(e){if(!isNaN(e))return e<1048576?(e/1024).toFixed(2)+"k":e<1073741824?(e/1048576).toFixed(2)+"M":(e/1073741824).toFixed(2)+"G"}uvpjs.register("uvpjs").Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(e){var t,i=uvpjs.Configuration;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),e&&(t=e.videoEl,this._videoEl=t,this._containerEl=e.containerEl,this._eventsMgr=e.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=t.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":i.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),this._diagEl&&this._contentEl?(this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window.")},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=e,this._createDiag(),this._addEventListeners()},_createDiag:function(){var e,t,i,n=uvpjs.util,s=this._styleEl,r=this._contentEl;this._template,this._params,r&&((e=document.createElement("div")).id=this._diagnosticId,r.insertBefore(e,r.firstChild),(i=uvpjs.util.htmlToElement("<span>x</span>")).addEventListener("click",this._handleCloseButton.bind(this),!0),e.appendChild(i),t=document.createElement("table"),e.appendChild(t),n.addCSSObject(s,e,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),n.addCSSObject(s,e,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),n.addCSSObject(s,e,{color:"#fff"},"span:hover"),n.addCSSObject(s,e,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),n.addCSSObject(s,e,{background:"transparent"},"table td"),n.addCSSObject(s,e,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),n.addCSSObject(s,e,{width:"60px"},"table td:last-child"),this._diagEl=e,this._diagTableEl=t,this._hideDiagBtn=i)},_removeDiag:function(){var e=this._diagEl,t=this._hideDiagBtn;t&&t.removeEventListener("click",this._handleCloseButton.bind(this)),e&&e.remove()},_hideDiag:function(){var e=this._diagEl,t=this._eventsMgr;e&&(e.style.display="none"),t.dispatchEvent(t.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var e=this._diagEl;e&&(e.style.display="block")},_toggleDiag:function(){var e=this._diagEl;if(e)return"block"===e.style.display?void this._hideDiag():void this._showDiag()},_handleCloseButton:function(){var e=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),e.dispatchEvent(e.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;this._containerEl,t&&e?(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),t.addEventListener(i.VIDEO_PROGRESS+e,this._onVideoProgress.bind(this)),t.addEventListener(i.VIDEO_STATE_CHANGE+e,this._onVideoStateChange.bind(this)),t.addEventListener(i.VIDEO_TRANSITION_START+e,this._onVideoTransitionStart.bind(this)),t.addEventListener(i.VIDEO_TRANSITION_COMPLETE+e,this._onVideoTransitionComplete.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners.")},_removeEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;this._containerEl,t&&e?(t.removeEventListener(i.VIDEO_PROGRESS+e),t.removeEventListener(i.VIDEO_STATE_CHANGE+e),t.removeEventListener(i.VIDEO_TRANSITION_START+e),t.removeEventListener(i.VIDEO_TRANSITION_COMPLETE+e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners.")},_updateTableHtml:function(){var e,t,i="",n=this._params;for(e in n)null!==(t=n[e])&&void 0!==t&&(i+="<tr><td>"+e+"</td><td>"+t+"</td></tr>");this._diagTableEl.innerHTML=i},_onVideoProgress:function(e){var i=e.payload,n=i.facadeState,s=this._params,r=n.minABRLevel,a=n.maxABRLevel;e.target===this._containerId&&(s["stream type"]=i.streamType,s.duration=i.duration,s["current time"]=i.currentTime.toFixed(2),s["buffer length"]=i.bufferLength.toFixed(2),s["total dropped frames"]=i.droppedFrames>=0&&i.droppedFrames||null,s["average dropped (fps)"]=i.averageDroppedFPS>=0&&i.averageDroppedFPS.toFixed(2)||null,s["playback framerate (fps)"]=i.playbackFramerate>=0&&i.playbackFramerate.toFixed(2)||null,s["current bandwidth (B/s)"]=i.currentBandwidth>=0&&t(i.currentBandwidth)||null,s["switching mode"]=i.switchingMode,s["current index bitrate (B/s)"]=t(n.currentAbr&&n.currentAbr.bitrate),s["start index bitrate (B/s)"]=t(n.startBitrate),void 0!==r&&void 0!==a&&(s["available indexes"]=r+" to "+a),this._updateTableHtml())},_onVideoStateChange:function(e){var t=e.payload,i=this._params;e.target===this._containerId&&(i["playback state"]=t.newState,this._updateTableHtml())},_onVideoTransitionStart:function(e){var t=e.payload,i=this._params;e.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",t),i["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(e){var t=e.payload,i=this._params;e.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",t),i["transition state"]="complete",this._updateTableHtml())}})}(),function(e){"use strict";uvpjs.register("uvpjs").Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(e){var t;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),e&&(t=e.videoEl,this._videoEl=t,this._eventsMgr=e.eventsMgr,this._containerId=e.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=t.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){this._imgEl&&this._contentEl?(this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark.")},_createImage:function(){var e;this._contentEl&&((e=document.createElement("img")).id=this._watermarkId,e.src=this.IMAGE,e.style.position="absolute",e.style.display="none",this._imgEl=e,this._contentEl.appendChild(e))},_removeImage:function(){var e=this._imgEl;e&&e.parentNode&&e.parentNode.removeChild(e)},_ensureImage:function(){document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var e=this._imgEl;e&&(e.style.display="none")},_showImage:function(){var e=this._imgEl;e&&(e.style.display="block")},_addEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;t&&e?(t.addEventListener(i.AD_START+e,this._hideImage.bind(this)),t.addEventListener(i.CONTENT_START+e,this._showImage.bind(this)),t.addEventListener(i.CONTENT_END+e,this._hideImage.bind(this)),t.addEventListener(i.CONTAINER_RESIZE+e,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),t.addTimedEventCallback(t.HALF_SECOND,e,this._ensureImage.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;t&&e?(t.removeEventListener(i.AD_START+e),t.removeEventListener(i.CONTENT_START+e),t.removeEventListener(i.CONTENT_END+e),t.removeEventListener(i.CONTAINER_RESIZE+e),t.removeTimedEventCallback(this.TIMER_INTERVAL,e),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(e){e.target===this._containerId&&this._setPosition()},_setPosition:function(){var e,t,i,n,s,r,a,o,l,d,u,c,h,p,f,v,g,_,m,E,y;t=this._contentEl,i=this._videoEl,(e=this._imgEl)&&i&&t&&(h=i.videoHeight,(p=i.videoWidth)&&h&&(r=this.OFFSET,d=this.SIZE,a=i.getBoundingClientRect(),f=t.getBoundingClientRect(),u=(o=a.height)/(l=a.width)/(c=h/p),n=l*c,s=o/c,v=f.bottom-a.bottom,g=f.right-a.right,u>1?(_=(o-n)/2,m=0,y=l*d+"px",E="auto"):(_=0,m=(l-s)/2,y="auto",E=o*d*(this.RATIO/c)+"px"),e.style.width=y,e.style.height=E,e.style.bottom=_+v+r+"px",e.style.right=m+g+r+"px"))}})}(),function(e){"use strict";uvpjs.register("uvpjs").Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(e){var t;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),e&&(t=e.videoEl,this._videoEl=t,this._eventsMgr=e.eventsMgr,this._containerId=e.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=t.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){this._360El&&this._kaleidoscopeViewer?(this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360.")},_loadKaleidoscope:function(e){return"function"!=typeof e?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,e()}.bind(this),window.Kaleidoscope&&window.Kaleidoscope.Video?void this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB)))},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;t&&e?(t.addEventListener(i.CONTAINER_RESIZE+e,this._handleContainerResize.bind(this)),t.addEventListener(i.CONTENT_START+e,this._startKaleidoscopeRender.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var e=this._namespace,t=this._eventsMgr,i=t.eventTypes;t&&e?(t.removeEventListener(i.CONTAINER_RESIZE+e),t.removeEventListener(i.CONTENT_START+e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")}})}(),uvpjs.register("uvpjs").ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(e,t,i){this.debug=uvpjs.debug,this.validationInfo=null,this.id=t,this.vidContId=i,this.rcoSeed={},this.initialize(e)},initialize:function(e){this.validationInfo=this.validateUserRco(e),this.validationInfo&&(this.rcoSeed=e,this.populateSelf(e))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(e){var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},has:function(e){return!uvpjs.util.isEmpty(this[e])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(e){return{error:!1,message:""}}}),uvpjs.register("uvpjs").RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this._super(e,t,i)},validateUserRco:function(e){var t=this._super(e),i=uvpjs.util.isDefinedString(e.assetURL);return{error:t.error||!i,message:t.error?t.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(e,t,i)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(e){this.cmsRefGuid=e,this.daiParams.daiVideoId=e},canMakePlatformCall:function(e){var t=uvpjs.util.isDefinedString(e),i=this.has("selectorCall")&&this.selectorCall||t&&e;return!!i&&(i.indexOf("$PID$")>-1?this.has("pid"):!(i.indexOf("$GUID$")>-1)||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var e=this.daiParams.dfpMediaId,t=this.daiParams.daiVideoId,i=e||t||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return e||t||i},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(e){var t=window.google&&google.ima&&google.ima.dai,i=this.validateDaiConfig(e),n=this._super(e),s=t?i?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing.";return{error:!((e.useSsb||t)&&i&&!n.error),missingSDK:!t,message:n.error?n.message:s}},populateSelf:function(e){var t,i;for(t in e)(i=e.hasOwnProperty(t))&&void 0!==this.daiParams[t]?this.daiParams[t]=e[t]:i&&(this[t]=e[t]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(e){var t=uvpjs.util,i=!t.isEmpty(e.adTagParameters),n=!t.isEmpty(e.contentSourceId),s=!t.isEmpty(e.assetKey);return e.useSsb||s||i&&n?e.useSsb?!t.isEmpty(e.assetURL):s||i&&n:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),i&&n)},checkCustomAdTagParams:function(){var e,t=uvpjs.util,i=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;i&&"string"!=typeof i&&t.isPlainObject(i)&&(e=t.queryStrFromObj(i),this.daiParams.adTagParameters.cust_params=encodeURIComponent(e))}}),uvpjs.register("uvpjs").RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this._super(e,t,i)},validateUserRco:function(e){var t=window.google&&google.ima,i=this._super(e);return{error:!(t&&!i.error),missingSDK:!t,message:i.error?i.message:"IMA SDK is missing."}}}),uvpjs.register("uvpjs").RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this._super(e,t,i)},validateUserRco:function(e){var t=this._super(e);return{error:t.error||!uvpjs.util.isDefinedString(e.assetURL),message:t.err?t.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(e,t,i){this._super(e,t,i)},validateUserRco:function(e){var t=uvpjs.util,i=t.isDefinedString(e.pid),n=!i&&t.isDefinedString(e.cmsRefGuid)&&!t.isDefinedString(e.assetURL),s=this._super(e);return{error:!(!s.error&&(i||n||t.isDefinedString(e.selectorCall))),message:s.error?s.message:"Supplied RCO is not valid for type rp_platform"}}}),function(e){"use strict";e.UvpSwfService=uvpjs.Class.subClass({init:function(e){this.debugId=e.debugId,this.debug=uvpjs.debug,this.containerId=e.containerId,this.dom=e.contentVideoDom,this.playerDom=e.playerDom,this.callback=e.readyCallback,this.id3OwnerIds=e.id3OwnerIds||"",this.capLevelToPlayerSize=e.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){var e;for(e in this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype,this.windowLabels)window[this.windowLabels[e]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=setTimeout(this.setSize.bind(this),40)},setSize:function(){var e=this.getContainerSize(),t=e.width,i=e.height;this.swf&&this.swf.setSize(t,i,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=-1!==navigator.appName.indexOf("Microsoft")?window[this.swfName]:document[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(e){},startTimer:function(){this.initTimeoutHandle=setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(e){e.success?this.startTimer():this.callback(null,this.svcC.error.EMBED_FAILED)},embed:function(e){var t=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,e,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:t.jsReady,playerReady:t.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var e,t,i=this.dom;this.svcC.hasFlash()?(this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),(e=document.createElement("div")).id=this.swfName,(t=i.querySelector("video")).style.display="none",i.style.height="100%",this.playerDom.style.height="100%",i.insertBefore(e,t),this.embed(e)):this.callback(null,this.svcC.error.FLASH_NOT_DETECTED)}}),e.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"//vidtech.cbsinteractive.com/uvpjs/uvpjsf/js_falback.swf",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},e.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},e.UvpSwfService.hasFlash=function(){var e=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(e)&&parseInt(e)>0},e.UvpSwfService.setWindowMethods=function(e){var t,i,n,s=uvpjs.util;for(t in e)i=e[t],n="f_"+s.uid8(),window[n]=i,e[t]=n;return e},e.UvpSwfService.swfobject=function(){function e(){if(!F&&document.getElementsByTagName("body")[0]){try{var e,t=f("span");t.style.display="none",(e=w.getElementsByTagName("body")[0].appendChild(t)).parentNode.removeChild(e),e=null,t=null}catch(e){return}F=!0;for(var i=B.length,n=0;n<i;n++)B[n]()}}function t(e){F?e():B[B.length]=e}function i(){var e=U.length;if(e>0)for(var t=0;t<e;t++){var i=U[t].id,o=U[t].callbackFn,l={success:!1,id:i};if(W.pv[0]>0){var d=p(i);if(d)if(!g(U[t].swfVersion)||W.wk&&W.wk<312)if(U[t].expressInstall&&s()){var u={};u.data=U[t].expressInstall,u.width=d.getAttribute("width")||"0",u.height=d.getAttribute("height")||"0",d.getAttribute("class")&&(u.styleclass=d.getAttribute("class")),d.getAttribute("align")&&(u.align=d.getAttribute("align"));for(var c={},h=d.getElementsByTagName("param"),f=h.length,v=0;v<f;v++)"movie"!=h[v].getAttribute("name").toLowerCase()&&(c[h[v].getAttribute("name")]=h[v].getAttribute("value"));r(u,c,i,o)}else a(d),o&&o(l);else m(i,!0),o&&(l.success=!0,l.ref=n(i),l.id=i,o(l))}else if(m(i,!0),o){var _=n(i);_&&typeof _.SetVariable!=C&&(l.success=!0,l.ref=_,l.id=_.id),o(l)}}}function n(e){var t=null,i=p(e);return i&&"OBJECT"===i.nodeName.toUpperCase()&&(t=typeof i.SetVariable!==C?i:i.getElementsByTagName(I)[0]||i),t}function s(){return!G&&g("6.0.65")&&(W.win||W.mac)&&!(W.wk&&W.wk<312)}function r(e,t,i,n){var s=p(i);if(i=h(i),G=!0,S=n||null,b={success:!1,id:i},s){"OBJECT"==s.nodeName.toUpperCase()?(y=o(s),A=null):(y=s,A=i),e.id=M,(typeof e.width==C||!/%$/.test(e.width)&&v(e.width)<310)&&(e.width="310"),(typeof e.height==C||!/%$/.test(e.height)&&v(e.height)<137)&&(e.height="137");var r=W.ie?"ActiveX":"PlugIn",a="MMredirectURL="+encodeURIComponent(L.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+r+"&MMdoctitle="+encodeURIComponent(w.title.slice(0,47)+" - Flash Player Installation");if(typeof t.flashvars!=C?t.flashvars+="&"+a:t.flashvars=a,W.ie&&4!=s.readyState){var d=f("div");i+="SWFObjectNew",d.setAttribute("id",i),s.parentNode.insertBefore(d,s),s.style.display="none",u(s)}l(e,t,i)}}function a(e){if(W.ie&&4!=e.readyState){e.style.display="none";var t=f("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(o(e),t),u(e)}else e.parentNode.replaceChild(o(e),e)}function o(e){var t=f("div");if(W.win&&W.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(I)[0];if(i){var n=i.childNodes;if(n)for(var s=n.length,r=0;r<s;r++)1==n[r].nodeType&&"PARAM"==n[r].nodeName||8==n[r].nodeType||t.appendChild(n[r].cloneNode(!0))}}return t}function l(e,t,i){var n,s=p(i);if(i=h(i),W.wk&&W.wk<312)return n;if(s){var r,a,o,l=f(W.ie?"div":I);for(o in typeof e.id==C&&(e.id=i),t)t.hasOwnProperty(o)&&"movie"!==o.toLowerCase()&&d(l,o,t[o]);for(r in W.ie&&(l=function(e,t){var i=f("div");return i.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+e+"'>"+t+"</object>",i.firstChild}(e.data,l.innerHTML)),e)e.hasOwnProperty(r)&&("styleclass"===(a=r.toLowerCase())?l.setAttribute("class",e[r]):"classid"!==a&&"data"!==a&&l.setAttribute(r,e[r]));W.ie?j[j.length]=e.id:(l.setAttribute("type",P),l.setAttribute("data",e.data)),s.parentNode.replaceChild(l,s),n=l}return n}function d(e,t,i){var n=f("param");n.setAttribute("name",t),n.setAttribute("value",i),e.appendChild(n)}function u(e){var t=p(e);t&&"OBJECT"==t.nodeName.toUpperCase()&&(W.ie?(t.style.display="none",function e(){if(4==t.readyState){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}else setTimeout(e,10)}()):t.parentNode.removeChild(t))}function c(e){return e&&e.nodeType&&1===e.nodeType}function h(e){return c(e)?e.id:e}function p(e){if(c(e))return e;var t=null;try{t=w.getElementById(e)}catch(e){}return t}function f(e){return w.createElement(e)}function v(e){return parseInt(e,10)}function g(e){e+="";var t=W.pv,i=e.split(".");return i[0]=v(i[0]),i[1]=v(i[1])||0,i[2]=v(i[2])||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]}function _(e,t,i,n){var s=w.getElementsByTagName("head")[0];if(s){var r="string"==typeof i?i:"screen";if(n&&(T=null,D=null),!T||D!=r){var a=f("style");a.setAttribute("type","text/css"),a.setAttribute("media",r),T=s.appendChild(a),W.ie&&typeof w.styleSheets!=C&&w.styleSheets.length>0&&(T=w.styleSheets[w.styleSheets.length-1]),D=r}T&&(typeof T.addRule!=C?T.addRule(e,t):typeof w.createTextNode!=C&&T.appendChild(w.createTextNode(e+" {"+t+"}")))}}function m(e,t){if(V){var i=t?"visible":"hidden",n=p(e);F&&n?n.style.visibility=i:"string"==typeof e&&_("#"+e,"visibility:"+i)}}function E(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=C?encodeURIComponent(e):e}var y,A,S,b,T,D,C="undefined",I="object",R="Shockwave Flash",P="application/x-shockwave-flash",M="SWFObjectExprInst",O="onreadystatechange",L=window,w=document,N=navigator,k=!1,B=[],U=[],j=[],x=[],F=!1,G=!1,V=!0,H=!1,W=function(){var e=typeof w.getElementById!=C&&typeof w.getElementsByTagName!=C&&typeof w.createElement!=C,t=N.userAgent.toLowerCase(),i=N.platform.toLowerCase(),n=/win/.test(i||t),s=/mac/.test(i||t),r=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),a="Microsoft Internet Explorer"===N.appName,o=[0,0,0],l=null;if(typeof N.plugins!=C&&typeof N.plugins[R]==I)(l=N.plugins[R].description)&&typeof N.mimeTypes!=C&&N.mimeTypes[P]&&N.mimeTypes[P].enabledPlugin&&(k=!0,a=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=v(l.replace(/^(.*)\..*$/,"$1")),o[1]=v(l.replace(/^.*\.(.*)\s.*$/,"$1")),o[2]=/[a-zA-Z]/.test(l)?v(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof L.ActiveXObject!=C)try{var d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");d&&(l=d.GetVariable("$version"))&&(a=!0,o=[v((l=l.split(" ")[1].split(","))[0]),v(l[1]),v(l[2])])}catch(e){}return{w3:e,pv:o,wk:r,ie:a,win:n,mac:s}}();return W.w3&&((typeof w.readyState!=C&&("complete"===w.readyState||"interactive"===w.readyState)||typeof w.readyState==C&&(w.getElementsByTagName("body")[0]||w.body))&&e(),F||(typeof w.addEventListener!=C&&w.addEventListener("DOMContentLoaded",e,!1),W.ie&&(w.attachEvent(O,function t(){"complete"==w.readyState&&(w.detachEvent(O,t),e())}),L==top&&function t(){if(!F){try{w.documentElement.doScroll("left")}catch(e){return void setTimeout(t,0)}e()}}()),W.wk&&function t(){if(!F)return/loaded|complete/.test(w.readyState)?void e():void setTimeout(t,0)}())),B[0]=function(){k?function(){var e=w.getElementsByTagName("body")[0],t=f(I);t.setAttribute("style","visibility: hidden;"),t.setAttribute("type",P);var n=e.appendChild(t);if(n){var s=0;!function r(){if(typeof n.GetVariable!=C)try{var a=n.GetVariable("$version");a&&(a=a.split(" ")[1].split(","),W.pv=[v(a[0]),v(a[1]),v(a[2])])}catch(e){W.pv=[8,0,0]}else if(s<10)return s++,void setTimeout(r,10);e.removeChild(t),n=null,i()}()}else i()}():i()},W.ie&&window.attachEvent("onunload",function(){for(var e=x.length,t=0;t<e;t++)x[t][0].detachEvent(x[t][1],x[t][2]);for(var i=j.length,n=0;n<i;n++)u(j[n]);for(var s in W)W[s]=null;for(var r in W=null,swfobject)swfobject[r]=null;swfobject=null}),{registerObject:function(e,t,i,n){if(W.w3&&e&&t){var s={};s.id=e,s.swfVersion=t,s.expressInstall=i,s.callbackFn=n,U[U.length]=s,m(e,!1)}else n&&n({success:!1,id:e})},getObjectById:function(e){if(W.w3)return n(e)},embedSWF:function(e,i,n,a,o,d,u,c,p,f){var v=h(i),_={success:!1,id:v};W.w3&&!(W.wk&&W.wk<312)&&e&&i&&n&&a&&o?(m(v,!1),t(function(){n+="",a+="";var t={};if(p&&typeof p===I)for(var h in p)t[h]=p[h];t.data=e,t.width=n,t.height=a;var E={};if(c&&typeof c===I)for(var y in c)E[y]=c[y];if(u&&typeof u===I)for(var A in u)if(u.hasOwnProperty(A)){var S=H?encodeURIComponent(A):A,b=H?encodeURIComponent(u[A]):u[A];typeof E.flashvars!=C?E.flashvars+="&"+S+"="+b:E.flashvars=S+"="+b}if(g(o)){var T=l(t,E,i);t.id==v&&m(v,!0),_.success=!0,_.ref=T,_.id=T.id}else{if(d&&s())return t.data=d,void r(t,E,i,f);m(v,!0)}f&&f(_)})):f&&f(_)},switchOffAutoHideShow:function(){V=!1},enableUriEncoding:function(e){H=typeof e===C||e},ua:W,getFlashPlayerVersion:function(){return{major:W.pv[0],minor:W.pv[1],release:W.pv[2]}},hasFlashPlayerVersion:g,createSWF:function(e,t,i){return W.w3?l(e,t,i):void 0},showExpressInstall:function(e,t,i,n){W.w3&&s()&&r(e,t,i,n)},removeSWF:function(e){W.w3&&u(e)},createCSS:function(e,t,i,n){W.w3&&_(e,t,i,n)},addDomLoadEvent:t,addLoadEvent:function(e){if(typeof L.addEventListener!=C)L.addEventListener("load",e,!1);else if(typeof w.addEventListener!=C)w.addEventListener("load",e,!1);else if(typeof L.attachEvent!=C)!function(e,t,i){e.attachEvent(t,i),x[x.length]=[e,t,i]}(L,"onload",e);else if("function"==typeof L.onload){var t=L.onload;L.onload=function(){t(),e()}}else L.onload=e},getQueryParamValue:function(e){var t=w.location.search||w.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return E(t);for(var i=t.split("&"),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf("="))==e)return E(i[n].substring(i[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(G){var e=p(M);e&&y&&(e.parentNode.replaceChild(y,e),A&&(m(A,!0),W.ie&&(y.style.display="block")),S&&S(b)),G=!1}},version:"2.3"}}()}(uvpjs.register("uvpjs")),function(e){var t=e._;e.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(e){this.debug=uvpjs.debug,this.vidContId="",this.containers=e.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=e.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=e.p2pClient,this.multiCdnClient=e.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(e.rco,e.cviMgr,e.vidContId)},initialize:function(e,i,n){var s;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",e),this.rco=e,this.vidContId=n,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",(s=this.cviModel.contentVideoState).sendResumeEvent=!1,s.startTime=0,s.elapsedTime=0,s.showPreroll=!0,s.playedChapterTime=0,s.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({cviModel:this.cviModel,eventsManager:this.eventsMgr}),t.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var e=this.eventsMgr;this._removeTimers(),e.addTimedEventCallback(e.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),e.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(e){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(e)},_removeTimers:function(){var e=this.eventsMgr;e.removeTimedEventCallback(e.TENTH_SECOND,this.internalNS),e.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var e=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(e)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(e){var t=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),t.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),t.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),t.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=e,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(e){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,e)})):this.finishLoadVideoAndBeginPlayback(e),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(e,t,i){var n,s=uvpjs.ErrorInfo;if(i)return n=new s({errorCode:s.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+i,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:n},this.vidContId);setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,e),2)},handleCdnDecision:function(e,t){this.setNewAssetUrlAndCdn(t),this.doFlashCheck(e)},shouldUseFlash:function(){var e=this.mc.systemInfo,t=this.cviModel.getSessionOption("preventFlashPlayback"),i=e.supportsNativeHls||e.isHlsjsEligible,n=!t&&e.isDesktop&&uvpjs.UvpSwfService.hasFlash(),s=this.mc.isHlsUrl(this._getAssetUrl()),r=uvpjs.Configuration.env;return!("local"!==r&&"dev"!==r&&"stage"!==r||!window.forceFlash||!n)||s&&!i&&n},prepForCaptionEvents:function(){for(var e=this.eventsMgr.eventTypes,t=[e.CONTROL_HIDE_CAPTIONS,e.CONTROL_SHOW_CAPTIONS,e.CAPTIONS_READY,e.SET_CAPTIONS_LANG],i=t.length;i--;)this.eventsMgr.addEventListener(t[i]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var e=this.eventsMgr.eventTypes,t=[e.CONTROL_HIDE_CAPTIONS,e.CONTROL_SHOW_CAPTIONS,e.CAPTIONS_READY,e.SET_CAPTIONS_LANG],i=t.length;i--;)this.eventsMgr.removeEventListener(t[i]+this.internalNS)},hCaptionEventForUvp:function(e){var t=this.eventsMgr.eventTypes;if(this._hasFacade()&&e.target===this.vidContId)switch(e.type){case t.CAPTIONS_READY:uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case t.CONTROL_SHOW_CAPTIONS:uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions(e.payload.language);break;case t.CONTROL_HIDE_CAPTIONS:uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions();break;case t.SET_CAPTIONS_LANG:uvpjs.util.isFunction(this.facade.setCaptionLanguage)&&this.facade.setCaptionLanguage(e.payload.language)}},finishLoadVideoAndBeginPlayback:function(e){var t,i=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),i.incrementMedNum(),this.createFacade(),t=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(t),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),t===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(e){var t,i,n,s=e&&e.providers||null,r=s&&s[0]?s[0]:null,a=r&&r.host||null,o=r&&r.provider||null;a&&(t=this._getAssetUrl(),a!==(i=uvpjs.util.parseUrl(t)).host&&(n=i.protocol+"//"+a+i.pathname+i.search,this.cviModel.contentVideoState.assetURL=n)),o&&this.setContentVideoStateCdn(o)},setContentVideoStateCdn:function(e){this.cviModel.contentVideoState.cdn=e,this.debug&&uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:e},this.vidContId)},getContentVideoStateCdn:function(e){return this.cviModel.contentVideoState.cdn},setModelRcoOverrides:function(){var e=function(e){var t=i.getSessionOption(e);return"boolean"==typeof t?t:void 0!==i.getVideoPlaybackCDOProperty(e)&&i.getVideoPlaybackCDOProperty(e)},t=function(e){var t=i.getSessionOption(e);return"number"==typeof t&&t>=0?t:void 0!==i.getVideoPlaybackCDOProperty(e)?Number(i.getVideoPlaybackCDOProperty(e)):-1},i=this.cviModel,n=t(i.START_BITRATE),s=t(i.MIN_BITRATE),r=t(i.MAX_BITRATE),a=t(i.LIVE_SYNC_DURATION_COUNT),o=e(i.CAP_LEVEL_TO_PLAYER_SIZE),l=e(i.DASHJS_FAST_SWITCH_ABR),d=i.getSessionOption("useDynamicSwitching"),u=i.getSessionOption("errorRecovery"),c=Number(this.rco.startBitrate)||-1,h=Number(this.rco.minBitrate)||-1,p=Number(this.rco.maxBitrate)||-1,f=Number(this.rco.liveSyncDurationCount)||-1,v=this.rco.capLevelToPlayerSize,g=this.rco.enableDashJSFastSwitchABR,_=this.rco.useDynamicSwitching,m=(_=this.rco.useDynamicSwitching,this.rco.errorRecovery);c>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",c),i.setStartBitrate(c)):i.setStartBitrate(n),h>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",h),i.setMinBitrate(h)):i.setMinBitrate(s),p>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",p),i.setMaxBitrate(p)):i.setMaxBitrate(r),f>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",f),i.setLiveSyncDurationCount(f)):i.setLiveSyncDurationCount(a),"boolean"==typeof v?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",v),i.setCapLevelToPlayerSize(v)):i.setCapLevelToPlayerSize(o),"boolean"==typeof g?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",g),i.setDashJSFastSwitchABR(g)):i.setDashJSFastSwitchABR(l),"boolean"==typeof _?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",_),i.setUseDynamicSwitching(_)):i.setUseDynamicSwitching(d),"object"==typeof m?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",m),i.setErrorRecovery(m)):i.setErrorRecovery(u)},createId3Parser:function(e){this.id3EventQueue=[];var t={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(e){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(t);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(t);break;case this.mc.FLASH_HLS:t.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(t)}},handleId3Metadata:function(e){this.id3EventQueue&&this.id3EventQueue.push(e)},checkId3Events:function(e){for(var t,i=this.id3EventQueue,n=i&&i.length||0;n--;)e>=(t=i[n]).pts&&(this.dispatchCuepointEvent(t),this.id3EventQueue.splice(n,1))},dispatchCuepointEvent:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,e,this.vidContId)},createFacade:function(){var e=this.cviModel,t=e.getContentVideoState(),i=this._getAssetUrl(),n={enableId3Handling:this.id3HandlingEnabled,assetURL:i,isMuted:e.isMuted,resourceProvider:this,startTime:t.startTime,startBitrate:e.startBitrate,maxBitrate:e.maxBitrate,minBitrate:e.minBitrate,useDynamicSwitching:e.useDynamicSwitching,liveSyncDurationCount:e.liveSyncDurationCount,volume:e.volume,capLevelToPlayerSize:e.capLevelToPlayerSize,enableDashJSFastSwitchABR:e.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:e.errorRecovery,drm:t.drm};this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",n),this.facade=this.getFacade(i),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(n.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(n.swfService=this.uvpSwfService);var s=this.facade.initialize(n);!s||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:s,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(e.nativeControls)},destroyFacade:function(){var e=this._hasFacade()&&"function"==typeof this.facade.destroy;this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),e?(this.facade.destroy(),this.facade={}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up.")},muteContentForAdPlay:function(e){var t=this.cviModel,i=this.facade;this._hasFacade()&&(!1!==e?i.muteVideo():t.isMuted||i.unMuteVideo())},getModule:function(e){return this.cviModel.getModule(e)},getModuleParam:function(e,t){return this.cviModel.getModuleParam(e,t)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var e=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:e},this.vidContId)},dispatchContentEnd:function(){var e=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:e},this.vidContId)},dispatchSeekDone:function(){var e=this.eventsMgr;e.dispatchEvent(e.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var e=this.cviModel&&this.cviModel.contentPlaybackState.fatalError,t=e?"Fatal ERROR encountered":"";this.eventsMgr&&(this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+t),!e&&this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId))},dispatchVideoStateChange:function(e){isNaN(e)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:e,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+e,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(e){e&&e.abrInfo&&this.cviModel.setAbrInfo(e.abrInfo)},facadeProgress:function(e){!uvpjs.util.isEmpty(e)&&"object"==typeof e&&e.currentTime&&e.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:e.currentTime}),this.setModelDuration(parseInt(e.duration)))},facadeDurationChanged:function(e){uvpjs.util.isEmpty(e)||"object"!=typeof e||e.duration},setModelDuration:function(e){e>0&&this.cviModel.contentVideoState.duration!==e&&(this.cviModel.setContentVideoStateItems({duration:e}),this.cviModel.setContentPlaybackStateItems({duration:e}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",e),this._seekFromTime?(this._seekToTime=e.seekToTime,this.dispatchSeekDone()):this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE.")},facadeError:function(e){var t,i,n,s,r=uvpjs.util,a=this.RPM&&this.RPM.currRP,o=this.eventsMgr,l=this.cviModel,d=!r.isEmpty(l),u=e.isFatal;if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+e.message),d&&u&&(i=(t=this.cviModel.getContentVideoState()).playbackStarted,n=r.isDefinedString(t.overrideAssetURL),!i&&n&&!this._overrideAssetUrlFailure))this._handleOverrideAssetURLError(e);else if(d||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),r.isEmpty(o)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(s=e.eventType||o.eventTypes.VIDEO_PLAYBACK_ERROR,e.eventType=s,o.dispatchEvent(s,{errorInfo:e},this.vidContId)),u){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),d&&(l.contentPlaybackState.fatalError=!0),a&&a.rco&&a.rco.type===uvpjs.mediaCapabilities.RP_IMA)return void a.imaContentComplete();this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp()}},facadePlaybackStateChange:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+e),this.dispatchVideoStateChange(e)},facadeVideoLevelLoaded:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:e},this.vidContId)},facadeVideoTransitionStart:function(e,t){var i=t||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+e+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:e,mode:i},this.vidContId)},facadeVideoTransitionComplete:function(e,t){var i=t||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+e+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:e,mode:i},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeSetAudioTrackInfo:function(e){this.cviModel.setAudioTrackInfo(e)},facadeId3Data:function(e){this.id3Parser&&this.id3Parser.parse(e)},facadeMinimumBitrateAllowedChanged:function(e){this.cviModel.setMinBitrate(e)},facadeMaximumBitrateAllowedChanged:function(e){this.cviModel.setMaxBitrate(e)},getFacade:function(e){var t,i=this.mc.STREAMING,n=(e=e||this._getAssetUrl(),this.mc.isHlsUrl(e)),s=this.mc.isDashUrl(e),r=this.cviModel.contentVideoState.isFlash;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(r||n||s)&&this._setDeliveryType(i),!r&&n)this.mc.canPlayHLSJS()&&(t=new uvpjs.VPF_HLSJS);else if(!r&&s)if(uvpjs.VPF_DASHJS)t=new uvpjs.VPF_DASHJS;else{if(!uvpjs.VPF_SHAKA)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));t=new uvpjs.VPF_SHAKA}else r&&(t=new uvpjs.VPF_Flash);return t||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var e=this.eventsMgr,t=e.eventTypes,i=this.internalNS,n=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",n),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,e.addEventListener(t.CONTROL_SEEK+i,this.onVideoSeekTo.bind(this)),e.addEventListener(t.CONTROL_SEEK_TO_LIVE_POINT+i,this.onVideoSeekToLive.bind(this)),e.addEventListener(t.CONTROL_PAUSE+i,this.onPauseVideo.bind(this)),e.addEventListener(t.CONTROL_PLAY+i,this.onPlayVideo.bind(this)),e.addEventListener(t.CONTROL_MUTE+i,this.onMuteVideo.bind(this)),e.addEventListener(t.CONTROL_UNMUTE+i,this.onUnMuteVideo.bind(this)),e.addEventListener(t.CONTROL_VOLUME_SET+i,this.onChangeVideoVolume.bind(this)),e.addEventListener(t.CONTROL_FULLSCREEN+i,this.onFullscreen.bind(this)),e.addEventListener(t.SWITCH_REQUEST+i,this.onSwitchRequest.bind(this)),e.addEventListener(t.USE_DYNAMIC_SWITCHING+i,this.onUseDynamicSwitching.bind(this)),e.addEventListener(t.MAXIMUM_BITRATE_ALLOWED+i,this.onMaximumBitrateAllowed.bind(this)),e.addEventListener(t.MINIMUM_BITRATE_ALLOWED+i,this.onMinimumBitrateAllowed.bind(this)),e.addEventListener(t.CONTAINER_RESIZE+i,this.handleContainerResize.bind(this)),e.addEventListener(t.SWITCH_AUDIO_TRACK+i,this.onSwitchAudioTrack.bind(this)))},_removeUVPEventListeners:function(){var e=this.eventsMgr,t=e.eventTypes,i=this.internalNS,n=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",n),e.removeEventListener(t.CONTROL_SEEK+i),e.removeEventListener(t.CONTROL_SEEK_TO_LIVE_POINT+i),e.removeEventListener(t.CONTROL_PAUSE+i),e.removeEventListener(t.CONTROL_PLAY+i),e.removeEventListener(t.CONTROL_MUTE+i),e.removeEventListener(t.CONTROL_UNMUTE+i),e.removeEventListener(t.CONTROL_VOLUME_SET+i),e.removeEventListener(t.SWITCH_REQUEST+i),e.removeEventListener(t.USE_DYNAMIC_SWITCHING+i),e.removeEventListener(t.MAXIMUM_BITRATE_ALLOWED+i),e.removeEventListener(t.MINIMUM_BITRATE_ALLOWED+i),e.removeEventListener(t.CONTROL_SHOW_CAPTIONS+i),e.removeEventListener(t.CONTROL_HIDE_CAPTIONS+i),e.removeEventListener(t.CAPTIONS_READY+i),e.removeEventListener(t.CONTAINER_RESIZE+i),e.removeEventListener(t.SWITCH_AUDIO_TRACK+i)},_getAssetUrl:function(e){var t=uvpjs.util,i=e||this.cviModel.getContentVideoState(),n=i.overrideAssetURL,s=t.isDefinedString(n)&&!this._overrideAssetUrlFailure,r=s?n:i.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+s+")",r),r},_setDeliveryType:function(e){this.cviModel.setContentVideoStateItems({deliveryType:e})},_handleOverrideAssetURLError:function(e){var t=uvpjs.ErrorInfo,i=this.eventsMgr,n=i.eventTypes.VIDEO_START_ERROR,s=t.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,s+" Error using overrideAssetURL; will use assetURL."),e.eventType=n,e.message=s,e.isFatal=!1,e.errorCode=t.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,i.dispatchEvent(n,{errorInfo:e},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(e){var t=e&&e.target,i=e&&e.payload,n=i&&i.bitrate,s=this.cviModel,r=this.facade;if(t===this.vidContId&&n&&this._hasFacade())switch(typeof n){case"string":if("up"===n)s.setUseDynamicSwitching(!1),r.switchUp();else if("down"===n)s.setUseDynamicSwitching(!1),r.switchDown();else{if(n=Number(n),isNaN(n))return;s.setUseDynamicSwitching(!1),r.switchToBitrate(n)}break;case"number":s.setUseDynamicSwitching(!1),r.switchToBitrate(n);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",n)}},onSwitchAudioTrack:function(e){uvpjs.util.isFunction(this.facade.switchAudioTrack)&&this.facade.switchAudioTrack(e.payload.id)},onUseDynamicSwitching:function(e){if(e&&e.target===this.vidContId&&e.payload){var t=e.payload.data;this.cviModel.setUseDynamicSwitching(t),this._hasFacade()&&(this.facade.useDynamicSwitching(t),t&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",t)}},onMinimumBitrateAllowed:function(e){var t=e.payload,i=t&&t.bitrate,n=this.facade;if(e.target===this.vidContId){if(!i||"number"!=typeof i)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i));this.cviModel.setMinBitrate(i),this._hasFacade()&&n.setMinBitrateAllowed(i)}},onMaximumBitrateAllowed:function(e){var t=e.payload,i=t&&t.bitrate,n=this.facade;if(e.target===this.vidContId){if(!i||"number"!=typeof i)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i));this.cviModel.setMaxBitrate(i),this._hasFacade()&&n.setMaxBitrateAllowed(i)}},onVideoSeekTo:function(e){var t=e&&e.target,i=e&&e.payload,n=i&&i.seekTime,s=this.cviModel.contentVideoState.duration,r=this.cviModel.contentPlaybackState.currentTime,a=this.facade;if("number"==typeof n&&t===this.vidContId){if(n<0||n>s)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+n));this._seekFromTime=this._seekFromTime||r,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:n,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&a.seekTo(n)}},onVideoSeekToLive:function(){var e=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&e.seekToLive()},facadeVolumeChange:function(e){!t.isNaN(e)&&t.isNumber(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:e},this.vidContId)},facadeLoading:function(e){var t={data:e};e&&(e.bufferLength||e.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,t,this.vidContId)},facadeTimeUpdate:function(e){this.cviModel.setContentPlaybackStateItems({currentTime:e})},onFullscreen:function(e){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(e.payload.isFs)},onPauseVideo:function(e){var t=e&&e.target,i=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",t),t===this.vidContId&&this._hasFacade()&&i.pauseVideo()},onPlayVideo:function(e){var t=e&&e.target,i=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",t),t===this.vidContId&&this._hasFacade()&&i.playVideo()},onChangeVideoVolume:function(e){var t=e&&e.target,i=e&&e.payload,n=i&&i.vol,s=uvpjs.util.inRange(n,0,1),r=this.cviModel.isMuted,a=this.facade;t===this.vidContId&&s&&!r&&this._hasFacade()&&a.setVolume(n)},onMuteVideo:function(e){var t=e&&e.target,i=this.facade;t===this.vidContId&&this._hasFacade()&&i.muteVideo()},onUnMuteVideo:function(e){var t=e&&e.target,i=this.facade;t===this.vidContId&&this._hasFacade()&&i.unMuteVideo()},onUVPJSTimerTick:function(){if(this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING){var e={};this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),e=this.cviModel.getContentVideoState(),!t.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:e},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1);var i=this.getVideoProgressPayload();this.setModelDuration(i.duration),this.id3HandlingEnabled&&this.checkId3Events(i.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,i,this.vidContId)}},checkBuffering:function(e){var t,i=this.cviModel?this.cviModel.contentPlaybackState:null;i&&i.playbackStarted&&i.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(t=e||i.currentTime||0,!this.bufferingDetected&&t<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&t>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=t)},getVideoProgressPayload:function(){var e={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:(this.cviModel.getCurrentVideoState(),this.facade.getDuration()),errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(e),e},setFacadeStateOnProgressPayload:function(e){var t=this.facade,i=this._hasFacade()&&t.getFacadeState();if(!i)return e;e.facadeState=i,e.averageDroppedFPS=t.getAverageDroppedFPS(),e.bufferLength=t.getBuffered()||0,e.currentTime=t.getCurrentTime()||0,e.currentBandwidth=t.getCurrentBandwidth(),e.currentMaxBandwidth=t.getCurrentMaxBandwidth(),e.droppedFrames=t.getDroppedFramesCount(),e.playbackFramerate=t.getPlaybackFramerate(),e.playbackState=t.getPlaybackState(),e.streamType=t.getStreamType(),e.isHDStreamLive=t.isHDStreamLive(),e.isPlayingLive=t.isPlayingLive(),e.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var e=this.cviModel.contentVideoState,t=localStorage.getItem("UVPJS.resumePid")||null,i=localStorage.getItem("UVPJS.resumeContentTime")||null,n=localStorage.getItem("UVPJS.resumeEpochTime")||null,s=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(t&&(e.resumePid=t),i&&(e.resumeContentTime=i),n&&(e.resumeEpochTime=n),s&&(e.resumeSessionId=s))},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var e=this.cviModel;e&&(e.resetAdVideoState(),e.resetContentVideoState())},_hasFacade:function(){return!uvpjs.util.isEmpty(this.facade)}})}(uvpjs.register("uvpjs")),function(e){var t=e._,i="pubads.g.doubleclick.net",n="ad.doubleclick.net",s="request.php",r="Request.jsp";e.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(e){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=e||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.cviModel=this.opts.cviModel,this.eventsMgr=this.opts.eventsManager,this.cviModel.contentVideoStateDefaults&&this.populateDefaults(this.cviModel.contentVideoStateDefaults),this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(e){var t;for(t in e)this.opts[t]=e[t]},getModel:function(){return this.mdl},getProperty:function(e){return this.mdl[e]},setProperty:function(e,t){this.mdl[e]=t},loadData:function(e,t){var i,n="callback=uvpHandleJsonpResult",s=t||this.opts.queryParams,r=!1,a=!uvpjs.util.isEmpty(s);if(this.opts.url=e,this.opts.queryParams=t,a)for(i in e+=e.indexOf("?")<0?"?":"&",s)e+=(r?"&":"")+i+"="+s[i],r=!0;e.indexOf(n)<0&&(e+=(e.indexOf("?")<0?"?":"&")+n),this.selectorCall=e,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var e=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),e.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(e){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(e)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(e){var t,i,n,s,r,a,o,l,d,u=e.getElementsByTagName("ref"),c=null,h=u[0],p=!1,f=this.mdl,v=h&&this.checkForPlatformError(h);if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",e),v&&v.error)return v;if(null===(i=(t=e.getElementsByTagName("switch"))[0]?t[0].getElementsByTagName("video"):e.getElementsByTagName("video"))[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(f.chapterTimesString="",h)for(n=0,s=u.length;n<s;n++)o=(r=u[n]).attributes.src.nodeValue,this.isAdCallURL(o)?(!p&&(f.imaAdCall=o),p=!0):c||(c=r,f.assetURL=c.getAttribute("src"),l=r.getElementsByTagName("param")),null!==r.getAttribute("clipEnd")&&(f.chapterTimesString+=r.getAttribute("clipEnd")+",");for(n=0,s=i.length;n<s&&(o=(a=i[n]).attributes.src.nodeValue,c||(c=a,f.assetURL=c.getAttribute("src"),l=a.getElementsByTagName("param"),null!==a.getAttribute("clipEnd")));n++)null!==a.getAttribute("clipEnd")&&(f.chapterTimesString+=a.getAttribute("clipEnd")+",");return d=l&&this.extractParams(l)||{},this.populateModelFromContentNodeAndParams(c,d),{error:!1}},populateModelFromContentNodeAndParams:function(e,t){var i,n,s=this.mdl,r=uvpjs.mediaCapabilities,a={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},o={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},l="true";for(q in a)s[q]=e.getAttribute(a[q])||"";for(q in o)s[q]=t[o[q]]||"";s.mediaId=this.getMediaId(t),s.duration=this.getDuration(e),s.sourceOwner=this.getSourceOwner(t),s.cmsRefGuid=e.getAttribute("guid")||e.getAttribute("vid")||"",s.isEmbedable=t.Embeddable===l,s.isLive=t.IsLive===l,s.episodeFlag=t.EpisodeFlag===l,s.useWatermark=t.WatermarkPlayback===l,s.chapterTimesString.length>0?(n=(i=s.chapterTimesString).length-1,i.lastIndexOf(",")===n&&(s.chapterTimesString=i.substring(0,n)),s.chapterStartTimes=this.convertChapterTimesToSeconds(s.chapterTimesString)):s.chapterStartTimes=[],s.assetURL.indexOf(r.M3U)>-1?(s.cdn="",s.fileType=r.M3U):s.assetURL.indexOf(r.MP3)>-1?s.fileType=r.MP3:s.fileType=r.MP4;var d=this.cviModel.getVideoPlaybackCDOProperty("matchPageUrlProtocol")||!1;d&&(s.assetURL=s.assetURL.replace(/^\w*:/,"")),this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy mdl",s,d)},handleData:function(e){var t=e.responseText,i=uvpjs.util,n=t.substring(t.indexOf("{"),t.lastIndexOf("}")+1),s=this.isValidJsonStr(n)&&JSON.parse(n)||null,r=i.isEmpty(s)?null:s.metafile,a=r&&new DOMParser,o=a&&a.parseFromString(r,"application/xml"),l=o&&this.parseSmilXML(o);if(this.callAttempts=0,l){if(l.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+l.errorInfo.message),void this.signalError(l.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(e){return"string"==typeof e&&("{"===e.charAt(0)&&"}"===e.charAt(e.length-1)||"["===e.charAt(0)&&"]"===e.charAt(e.length-1))},handleError:function(e){var t,i="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(e.status);this.debug&&uvpjs.error(this.DEBUG_ID,i,this.selectorCall),this.shouldRetryCall(e)?(t=this.callDelays[this.callAttempts],this.callAttempts>=1&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+t,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),t)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:i+" URL: "+this.selectorCall,isFatal:!0,serverCode:e.status})))},shouldRetryCall:function(e){var t=e.status;return this.selectorCall.indexOf("link.theplatform")>-1&&this.callAttempts<this.retryLimit&&500!==t&&404!==t&&403!==t&&0!==t},defineProperties:function(){},checkForPlatformError:function(e){var t=e&&this.parseSmilRefNodeForException(e);return t?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(t),serverCode:t.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(e){var t=e.responseCode||"n/a",i="; PID: "+(this.opts.pid||"n/a")+"; ",n=this.opts&&this.opts.cmsRefGuid+"; "||"",s=e.abstract?e.abstract+" ":"";return"Platform Error; code: "+t+i+n+(e.exception||"Resource Unavailable.")+" "+s},populateDefaults:function(e){!uvpjs.util.isEmpty(e)&&t.assign(this.mdl,e)},parseSmilRefNodeForException:function(e){var t,i=e.getElementsByTagName("param"),n={};if(i&&i.length){for(t=i.length;t--;)n[i[t].getAttribute("name")]=i[t].getAttribute("value");if("true"===n.isException)return n.abstract=e.getAttribute("abstract")||"",n}return null},extractParams:function(e){var t,i,n,s,r={};if(uvpjs.util.isEmpty(e))return r;for(s=e.length;s--;)i=(t=e[s]).getAttribute("name"),n=t.getAttribute("value"),i&&n&&(r[i]=n);return r},isAdCallURL:function(e){return e.indexOf(n)>-1||e.indexOf(i)>-1||e.indexOf(s)>-1||e.indexOf(r)>-1},getMediaId:function(e){var t,i,n,s="",r=e.trackingData;if(uvpjs.util.isEmpty(r))return"";for(i=0,n=(t=r.split("|")).length;i<n;i++)t[i].indexOf("cid=")>-1&&(s=t[i].split("=")[1]);return s},getSourceOwner:function(e){var t=e.Source;return uvpjs.util.isEmpty(t)&&"true"===e.WatermarkPlayback?"Entertainment":t||""},getDuration:function(e){var t=parseInt(e.getAttribute("dur"))||0;return t>0?.001*t:t},convertChapterTimesToSeconds:function(e){for(var t=[],i=e.split(","),n=i.length,s=function(e){var t=parseInt;switch((e=i[n].split(":")).length){case 1:return t(e[0]);case 2:return 60*t(e[0])+t(e[1]);case 3:return 3600*t(e[0])+60*t(e[1])+t(e[2])}};n--;)t.unshift(s(i[n]));return t}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(e){this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_URL},initialize:function(e,t,i){this._super(e,t,i)},loadData:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),t.isFunction(e)&&t.isFunction(i)?(this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=e,this.dataLoadErrorCB=i,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS)},loadVideoAndBeginPlayback:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(e)}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(e){this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(e,t){var i=this.getSelectorCall(),n=i.url||null,s=null;if(i.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+i.message),void("function"==typeof t&&t(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+i.message,isFatal:!0})));this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=e,uvpjs.util.isDefinedString(this.rco.sig)&&(s={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:t}),this.contentDataProxy.loadData(n,s)},loadVideoAndBeginPlayback:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(e)},getSelectorCall:function(){var e,t,i,n,s,r,a,o=this.rco,l=o.has("selectorCall")&&o.selectorCall||null;if(!l){if(i=(l=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"))&&l.indexOf("$PID$")>-1,n=l&&l.indexOf("$GUID$")>-1,e=o.has("pid")&&o.pid||null,t=o.has("cmsRefGuid")&&o.cmsRefGuid||null,(s=!i&&!n)||!e&&!t)return{error:!0,message:"Config error: "+(s?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(i?"pid":"cmsRefGuid"))};r=i?e:t,a=i?/\$PID\$/g:/\$GUID\$/g,l=(l=l.replace(a,r)).replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:l}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var e=uvpjs.util;e.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),e.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var e,t,i,n,s,r,a,o,l=this.cviModel.contentVideoState,d=this.contentDataProxy,u=this.rco;this.populateContentVideoStateFromLocalStorage(),t=Date.now()-+l.resumeEpochTime,d.setProperty("resumePid",l.resumePid),d.setProperty("resumeEpochTime",+l.resumeEpochTime),d.setProperty("resumeSessionId",l.resumeSessionId),d.setProperty("resumeContentTime",+l.resumeContentTime),d.setProperty("playedChapterTime",+l.playedChapterTime),d.setProperty("showPreroll",l.showPreroll),d.setProperty("sendResumeEvent",!1),d.getProperty("episodeFlag")&&!0!==l.isLive&&(s=!(i=function(){var e=d.getProperty("duration");return!uvpjs.util.isEmpty(u.globalResumeTime)&&u.globalResumeTime>0&&e>0&&e-u.globalResumeTime>20}())&&u.pid===l.resumePid,i||s?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),n=i?u.globalResumeTime:+l.resumeContentTime||0,e=i?0:t||0,o=!i&&t>this.ONE_HOUR_MS,a=i?this.cviModel.sessionId:"",r=this.getPlayedChapterTimeForContentResume(n),d.setProperty("sendResumeEvent",!0),d.setProperty("startTime",n),d.setProperty("elapsedTime",e),d.setProperty("showPreroll",o),d.setProperty("playedChapterTime",r),d.setProperty("previousSessionId",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(s?"local":"global")+"Resume"],startTime:n},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(e){var t,i=0,n=this.contentDataProxy.getProperty("chapterStartTimes"),s=n.length||0;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",n),s)for(;s--;)if(e>=(t=n[s])){e-t>=4?i=t:(this.contentDataProxy.setProperty("startTime",e-4),s>0&&(i=n[s-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",i),i}}),function(e){var t=e._;e.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(e){this.debug=uvpjs.debug,this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(e,t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",i),this._super(e,t,i)},loadData:function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),t.isFunction(e)?(this.dataLoadedCB=e,this.dataLoadErrorCB=i,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS)}})}(uvpjs.register("uvpjs")),function(e){"use strict";var t=e._;e.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_BITRATE_THRESHOLD:2500,AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(e){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(e,t,i){var n,s;this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",e),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",i)),this.playbackState=this.mc.EMPTY,this.vidContId=i,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=e,this.isContentScenario=!1,this._super(e,t,i),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(n=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(n.eventType,{errorInfo:n},i)):(s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=s.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(e,t){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),!this.mc.isChromecast()&&this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:e();break;case this.PLATFORM:this._super(e,t);break;case this.CONTENT_AND_AD_CALL:e()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(e){var t=this.rco,i=this.cviModel,n=uvpjs.util.isDefinedString(t.adCall)?t.adCall:null,s=this.imaScenario===this.PLATFORM,r=n||(s?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(i.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(r)):(i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(t),i.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,r)):this.doFlashCheck(r))},finishLoadVideoAndBeginPlayback:function(e){var t="",i=uvpjs.adUtil,n=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,n.incrementMedNum(),this.isContentScenario=!0),e?(t=i.populateImaAdCallValues(e,n,this.isContentScenario),this.viewGuid=i.getDwViewGuid(n),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",t)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(t)},dispatchContentStart:function(){this.resetTrueXStatus(),this.stuckAdCheckDisabled=!1,this._super()},requestAdsManagerOrResume:function(e){t.isString(e)&&!t.isEmpty(e)?this._requestAdsManager(e):this._onContentResumeRequested()},setImaAdUrl:function(){var e=this.checkForAdCallOverride();e?(this.contentDataProxy.setProperty("imaAdCall",e),this.imaAdCall=e):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var e=this.cviModel.getModule(this.AD_SETTINGS),i=null!=e&&1==e.enabled,n=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),s=null;return i&&!t.isUndefined(n)&&(s=n),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(s||"null")),s},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var e,t="",i=this.contentDataProxy,n=i.getProperty("chapterStartTimes");return i.getProperty("showPreroll")||(t="1"),n.length>0&&(e=n.indexOf(i.getProperty("playedChapterTime")))>=0&&(e+=2,t=t.length>0?t+","+String(e):String(e)),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",t),t},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(e){var t=e&&e.id,i=this.trueXInteractionIds;switch(t){case i.CLOSED_BEFORE_CREDIT:case i.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case i.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case i.OPT_OUT:case i.TIME_OUT:this.resetTrueXStatus();break;case i.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStatus:function(){this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1}},assembleAdPodInfo:function(e){var t=this.getAdPodInfo(e),i=t.podIndex,n=0===i?"pre":-1===i?"post":"mid_"+i;if(this.currAdPod=this.APM.getAdPodById(n),void 0===this.currAdPod)return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(e)}),adCallUrl:this.adCallUrl},this.vidContId),!1;var s=this.currAdPod;return s.adCount=t.totalAds,s.podDuration=t.maxDuration,s.isBumper=t.isBumper,s.imaPodIndex=t.podIndex,s.timeOffset=t.timeOffset,s.totalAds=t.totalAds,s.imaAdPostion=t.adPosition,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",i,this.currAdPod),!0},getAdPodInfo:function(e,t){var i=e.getAdPodInfo(),n=t||{};return n.adPosition=i.getAdPosition(),n.isBumper=i.getIsBumper(),n.maxDuration=i.getMaxDuration(),n.podIndex=i.getPodIndex(),n.timeOffset=i.getTimeOffset(),n.totalAds=i.getTotalAds(),n},assembleAdInfo:function(e){return{adId:e.getAdId(),adPodInfo:this.getAdPodInfo(e),adSystem:e.getAdSystem(),advertiserName:e.getAdvertiserName(),apiFramework:e.getApiFramework(),contentType:e.getContentType(),creativeAdId:e.getCreativeAdId(),creativeId:e.getCreativeId(),dealId:e.getDealId(),description:e.getDescription(),duration:e.getDuration(),height:e.getHeight(),mediaUrl:e.getMediaUrl(),minSuggestedDuration:e.getMinSuggestedDuration(),skipTimeOffset:e.getSkipTimeOffset(),surveyUrl:e.getSurveyUrl(),title:e.getTitle(),traffickingParams:e.getTraffickingParameters(),traffickingParametersString:e.getTraffickingParametersString(),uiElements:e.getUiElements(),universalAdIdRegistry:e.getUniversalAdIdRegistry(),universalAdIdValue:e.getUniversalAdIdValue(),vastMediaHeight:e.getVastMediaHeight(),vastMediaWidth:e.getVastMediaWidth(),vastMediaBitrate:e.getVastMediaBitrate(),width:e.getWidth(),wrapperAdIds:e.getWrapperAdIds(),wrapperAdSystems:e.getWrapperAdSystems(),wrapperCreativeIds:e.getWrapperCreativeIds(),isLinear:e.isLinear()}},onAdEvent:function(e){var i,n=e.getAdData(),s=e.getAd(),r=google.ima.AdEvent.Type;if(e.type!==r.INTERACTION){if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(e.type),e.type){case r.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",s),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(e)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(s))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(s,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(e)}),this._dispatchAdLoaded(this.assembleAdInfo(s));break;case r.STARTED:var a,o,l=s.getContentType();this.ad=s,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=s.getDuration(),this._populateAdVideoState(s,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(e)}),this.cviModel.mergeCDOData(),"application/javascript"!==l&&"application/x-shockwave-flash"!==l||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===l&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(s),this.trackAdEvent(r.STARTED),(a=s.getAdPodInfo())&&(o=a.getTotalAds()),this._dispatchAdStart(o),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case r.AD_BUFFERING:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.AD_BUFFERING"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BUFFERING,{},this.vidContId);break;case r.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case r.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case r.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case r.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case r.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||t.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case r.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),(i=this.cviModel.getAdVideoState()).paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:i},this.vidContId);break;case r.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case r.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case r.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case r.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,i=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:i,adCallUrl:this.adCallUrl},this.vidContId),uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case r.LOG:var d,u=n&&n.adError,c=(uvpjs.ErrorInfo,null===s);this.eventsMgr.eventTypes.AD_ERROR,!u&&c?(d=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof d&&d()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(u,s,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),c&&!u&&this.savedSeekToTime>-1&&this.resumeContentPlay();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",r))}}else this.processInteractionEvent(n)},_populateAdVideoState:function(e,i){var n,s;if(t.isObject(e)){if(s=uvpjs.adUtil.extractAdStateData(e,uvpjs.adUtil.context.IMA),i)for(n in i)s[n]=i[n];this.cviModel.setAdVideoState(s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())}else this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN")},_requestAdsManager:function(e){var t=this.cviModel;if(this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",e),this.adStartEventReceived=!1,this.adCallUrl=e,uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var i=new google.ima.AdsRequest;i.adTagUrl=e,this._updateAdSize(),i.linearAdSlotWidth=this.containerWidth,i.linearAdSlotHeight=this.containerHeight,i.nonLinearAdSlotWidth=this.containerWidth,i.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof i.setAdWillAutoPlay&&(i.setAdWillAutoPlay(t.isAutoplay),i.setAdWillPlayMuted(t.isMuteAtPlayStart&&!t.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(i)},onAdsManagerLoaded:function(e){var i,n,s,r=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,a=uvpjs.util;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",e),this._dispatchAdResponse(),a.isEmpty(this.RPM)||a.isEmpty(this.RPM.currRP)||a.isEmpty(this.cviModel))return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new google.ima.AdsRenderingSettings;var o=this.renderSettings;o.bitrate=this.getAdPlaybackBitrate(),o.restoreCustomPlaybackStateOnAdBreakComplete=!1,o.enablePreloading=!1,o.loadVideoTimeout=this._returnIMATimeout(),i=this.adsManager=e.getAdsManager(r,o),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",i.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",i.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",i.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(n=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",n)),this.imaCuePoints=this.adsManager.getCuePoints(),t.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,n,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",n),this.APM.initialize(this.vidContId,n,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),s=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,s),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},getAdPlaybackBitrate:function(){var e=this.cviModel.contentPlaybackState.facadeState.currentBitrate,t=900;return!uvpjs.util.isEmpty(e)&&e>0&&(t=Math.min(e/1e3,this.AD_BITRATE_THRESHOLD)),t},startAds:function(){var e,t,i=null,n=null;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(s){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),e=(t=uvpjs.ErrorInfo).messages.NO_AD_CONTENT,s&&"function"==typeof s.getMessage&&(e+=": "+s.getMessage(),i=s.getErrorCode(),n=s.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new t({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:t.errorCodes.IMA_AD_ERROR,message:e,imaErrorCode:i,imaVastErrorCode:n,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var e,i=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),t.isEmpty(this.facade)||(i=this.cviModel.contentVideoState.isLive,!(e=this.imaUsesContentVideoTag())&&this.facade.hideVideo(),i&&!e?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),e&&(this.savedSeekToTime=i?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!t.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),t.isEmpty(this.APM)||!this.APM.isPostRoll(this.currAdPod)){if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),t.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!t.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),this.savedSeekToTime>-1){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}}else this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN")},facadePlaybackStateChange:function(e){this.seekPending&&e===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(e)},_updateIMAPlaybackState:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",e),e!==this.playbackState&&(this.playbackState=e,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(e){var t=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:e||1,adData:t,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(e){var t;this.uvpjsAdStartOpened&&((t=this.cviModel.getAdVideoState()).skipped=!0===e,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:t,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(e){var t="function"==typeof e.getAdData?e.getAdData():{},i="function"==typeof e.getAd?e.getAd():{};return("function"==typeof i.getMediaUrl?i.getMediaUrl():t.mediaUrl)||null},_dispatchAdLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:e},this.vidContId)},_dispatchAdRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(e,t){var i,n,s;e&&(this.containerWidth=e),t&&(this.containerHeight=t),this.mc.isChromecast()||(i=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),n=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),i===this.containerWidth&&n===this.containerHeight||(this.containerWidth=i,this.containerHeight=n,this.adsManager&&(s=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,s))))},_updateCurrentAdTime:function(){if(this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY){var e=this.adsManager.getRemainingTime();this._checkForStuckAd(e)?this.adsManager.discardAdBreak():(this.currImaAdTime=Math.floor(this.duration-e),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime}))}},_checkForStuckAd:function(e){if(this.stuckAdCheckDisabled)return!1;if(null===this.previousRemainingTime)return this.previousRemainingTime=e,!1;var t=this.previousRemainingTime-e;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+t),0===t?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS){var i="Ad playback stuck for "+this.stuckIntervals+" intervals.",n=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:i,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,i,n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:n,adCallUrl:this.adCallUrl},this.vidContId),!0}return this.previousRemainingTime=e,!1},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(e){var t=e&&e.getAd&&e.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(e.getError(),t),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(e){this.dispatchAdErrorEvent(e.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(e){return uvpjs.adUtil.extractAdInfo(e,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(e,t,i){var n,s=null,r=null,a=null,o=uvpjs.ErrorInfo,l=uvpjs.util.isFunction;e&&l(e.getMessage)&&(s=e.getMessage(),s+=" imaErrorCode: "+(r=e.getErrorCode()||"n/a")+"; vastErrorCode: "+(a=e.getVastErrorCode()||"n/a")),e&&l(e.getInnerError)&&(n=e.getInnerError())&&(!s&&(s=""),s+=" Inner error: "+(l(n.getMessage)?n.getMessage():n.message||"n/a")+"; inner error code: "+(l(n.getErrorCode)?n.getErrorCode():"n/a")),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+s),i&&(s=i+" "+s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new o({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:o.errorCodes.IMA_AD_ERROR,message:o.messages.IMA_AD_ERROR_EVENT_RECEIVED+(s||" Unspecified IMA ad error."),isFatal:!1,imaErrorCode:r,imaVastErrorCode:a,adInfo:this.extractAdInfo(t)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),t.isEmpty(this.facade))return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA();this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo()},cleanUpRP_IMA:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var e=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(e)}},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(e){var t;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",e),null===this.adsManager?(this.dynamicMidRollPodCount++,t=uvpjs.adUtil.populateImaAdCallValues(e,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=t,this._requestAdsManager(t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call")},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(e)))},onPlayVideo:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(e)))},onVideoSeekTo:function(e){var i,n,s,r=this.cviModel.contentPlaybackState.currentTime;return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",e),e.target!==this.vidContId||t.isEmpty(this.facade)||!this.canSeek(e&&e.payload)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")):t.isEmpty(this.APM)||!this.APM.hasMidRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(e)):(i=e.payload.seekTime,this._seekFromTime=r,n=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(i):i,s=this.APM.returnPrecedingUnplayedAdPod(n),void(t.isEmpty(s)||s.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(e)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",s.startTime),this.savedSeekToTime=n,s.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=s.startTime)))},canSeek:function(e){return void 0!==e.seekTime&&null!==e.seekTime&&e.seekTime>=0&&e.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(e){return e},onChangeVideoVolume:function(e){t.has(e,"target")&&e.target===this.vidContId&&!this.cviModel.isMuted&&e.payload.vol>=0&&e.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(e.payload.vol):this._super(e))},onMuteVideo:function(e){t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(e)))},onUnMuteVideo:function(e){t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(e)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var e,t=this.adsManager,i=google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),e=this.onAdEvent,t.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),t.addEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),t.addEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),t.addEventListener(i.LOADED,e),t.addEventListener(i.STARTED,e),t.addEventListener(i.AD_BUFFERING,e),t.addEventListener(i.FIRST_QUARTILE,e),t.addEventListener(i.MIDPOINT,e),t.addEventListener(i.THIRD_QUARTILE,e),t.addEventListener(i.COMPLETE,e),t.addEventListener(i.ALL_ADS_COMPLETED,e),t.addEventListener(i.CLICK,e),t.addEventListener(i.PAUSED,e),t.addEventListener(i.RESUMED,e),t.addEventListener(i.USER_CLOSE,e),t.addEventListener(i.SKIPPED,e),t.addEventListener(i.LOG,e),t.addEventListener(i.VOLUME_CHANGED,e),t.addEventListener(i.VOLUME_MUTED,e),t.addEventListener(i.INTERACTION,e)},_removeAdsManagerEventListeners:function(){var e=this.onAdEvent,t=this.adsManager,i=google.ima.AdEvent.Type;t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),t.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),t.removeEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),t.removeEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),t.removeEventListener(i.LOADED,e),t.removeEventListener(i.STARTED,e),t.removeEventListener(i.AD_BUFFERING,e),t.removeEventListener(i.FIRST_QUARTILE,e),t.removeEventListener(i.MIDPOINT,e),t.removeEventListener(i.THIRD_QUARTILE,e),t.removeEventListener(i.COMPLETE,e),t.removeEventListener(i.ALL_ADS_COMPLETED,e),t.removeEventListener(i.CLICK,e),t.removeEventListener(i.PAUSED,e),t.removeEventListener(i.RESUMED,e),t.removeEventListener(i.USER_CLOSE,e),t.removeEventListener(i.SKIPPED,e),t.removeEventListener(i.LOG,e),t.removeEventListener(i.VOLUME_CHANGED,e),t.removeEventListener(i.VOLUME_MUTED,e))},onUVPJSTimerTick:function(){var e,t,i,n,s=uvpjs.util,r=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,a=!s.isEmpty(this.adsManager),o=!s.isEmpty(this.facade);if(a){var l=this.getAdPlaybackBitrate();l!==this.renderSettings.bitrate&&(this.renderSettings.bitrate=l,this.adsManager.updateAdsRenderingSettings(this.renderSettings))}if(r&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:o?(e=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=e):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return t=(n=a&&r&&(this.cviModel.sessionOptions.adBlockerCallback||null))&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),n&&(i=(new Date).getTime())&&(this.lastAdBlockCheckTime<i||t)&&(this.lastAdBlockCheckTime=i+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();if(this.id3HandlingEnabled&&o&&this.checkId3Events(e),this.playbackState===this.mc.PLAYING){var d=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,d,this.vidContId)}},_checkForCloseToMidrollPod:function(e){var t,i,n,s=this.APM.getMidRollPods();if(e<=0)return!1;for(t=s.length;t--;)if((i=(n=s[t]).startTime-e)>0&&i<1&&!n.hasPlayed&&!n.hasBeenChecked)return n.hasBeenChecked=!0,!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(e){var t=uvpjs.util,i=this._getAssetUrl(e),n=t.isDefinedString(e.pid),s=t.isDefinedString(e.cmsRefGuid),r=t.isDefinedString(e.selectorCall),a=t.isDefinedString(e.assetURL);return n||s&&!a||r?this.PLATFORM:t.isDefinedString(i)?this.CONTENT_AND_AD_CALL:t.isDefinedString(e.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var e=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),e},_checkForContentPreload:function(){var e=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,t=this.adsManager.isCustomPlaybackUsed(),i=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!t;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&e&&this.duration>5&&i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var e=-1,t=this.cviModel.getModule(this.AD_SETTINGS),i=t&&t.enabled&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return i&&(e=(e=parseInt(i))>0?1e3*e:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+e),e},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(e){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:e,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(e){"use strict";var t,i=(e._,["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"]),n=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];e.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(e){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this.pendingSeekTime=null,this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(e,i,n){var s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+n),r=s.getElementsByTagName("video")[0];!t&&(t=google.ima.dai.api),this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new t.StreamManager(r),this.adClickElement=this.createAdClickElement(r),this.streamManager.setClickElement(this.adClickElement),this._super(e,i,n),this.resetAdStates(),this.contentVideoDiv=s,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(e,t){var i=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(i)?this._super(e,t):(this.dataLoadedCB=e,this.onDataProxyComplete())},onDataProxyComplete:function(){var e=this.contentDataProxy.getProperty("cmsRefGuid");!uvpjs.util.isEmpty(e)&&!this.rco.getVideoId()&&this.rco.setCmsRefGuid(e),this._super()},loadVideoAndBeginPlayback:function(e){var t,i=this.rco,n=this.cviModel,s=this.contentDataProxy.getModel();if(this.suppressFacadePlayOnLoad=!0===e,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),n.setNonDefaultContentVideoStateItems(s),n.setContentVideoStateItems(i),n.mergeCDOData(),this.killDataProxy(),!(t=this.assembleResourceDefinition()))return this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0);this.cviMgr.setPlaybackInfoOnModel(),this.requestStream(t)},requestStream:function(e){var i=!uvpjs.util.isEmpty(e.assetKey),n=new(i?t.LiveStreamRequest:t.VODStreamRequest);n.apiKey=e.apiKey||null,n.adTagParameters=e.adTagParameters,i?(n.assetKey=e.assetKey,n.attemptPreroll=!0,this.isLiveStream=!0,this.id3HandlingEnabled=!0):(n.contentSourceId=e.contentSourceId,n.videoId=e.videoId),this.streamManager.requestStream(n)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(e){var t=e.getStreamData().url;if(!uvpjs.util.isDefinedString(t))return this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=t,this.cviModel.contentVideoState.isLive=this.isLiveStream,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())},hStreamInitialized:function(e){this.daiStreamId=e.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(e){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(e){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null,this.pendingSeekTime&&(this._hasFacade()&&this.facade.seekTo(this.pendingSeekTime),this.pendingSeekTime=null)},hCuePointsChanged:function(e){this.currAdPod=this.getNewPod(e.getStreamData().cuepoints)},hAdStarted:function(e){var t=e.getAd();this.resetAdStates(),!this.currAdPod&&this.isLiveStream&&(this.currAdPod={played:!0}),this.updateAdModel(t),this.currAd=t,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.trackAdEvent(e.type),this.dispatchAdPodStart()),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(e){var i,n,s,r=e.type,a=t.StreamEvent.Type,o=null;switch(r){case a.FIRST_QUARTILE:o=25;break;case a.MIDPOINT:o=50;break;case a.THIRD_QUARTILE:o=75;break;case a.AD_PROGRESS:(s=(n=(i=e.getStreamData())&&i.adProgressData)&&this.createAdProgressPayload(n))&&this.dispatchVideoProgress(s)}o&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=o,this.dispatchAdQuartile(o))},hStreamError:function(e){var t=e.getStreamData(),i=t&&t.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+i,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,i||"Unknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(e){},hStreamEvent:function(e){this.isAdPlaying()&&this.trackAdEvent(e.type),this[this.hMap[e.type]](e)},onVideoSeekTo:function(e){var t,i=e&&e.target,n=e&&e.payload,s=n&&n.seekTime,r=this.facade,a=this._hasFacade(),o=r.getDuration(),l=this.facade.getCurrentTime();if("number"==typeof s&&i===this.vidContId){if((s=this.streamManager.streamTimeForContentTime(s))<0||s>o)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s));(t=this.getSkippedPod(s))&&(this.pendingSeekTime=s,s=t.startTime-1),this._seekFromTime=this._seekFromTime||l,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),a&&r.seekTo(s)}},getSkippedPod:function(e){var t,i,n,s,r=[];for(t in this.adPods)r.push(this.adPods[t].startTime);for(r.sort(function(e,t){return e-t}),i=r.length;i--;)if((n=r[i])<e)return(s=this.adPods["t_"+n]).hasPlayed?null:s;return null},dispatch:function(e,t){this.eventsMgr.dispatchEvent(e,t,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var e=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:e})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var e=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_LOADED,{adData:e}),this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:e})},dispatchAdEnd:function(){var e=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:e})},dispatchAdQuartile:function(e){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:e})},dispatchVideoProgress:function(e){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,e)},dispatchError:function(e,t,i,n){this.dispatch(e,{errorInfo:new uvpjs.ErrorInfo({eventType:e,errorCode:i,message:t+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===n,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(e){var t,i,n=null,s=e&&e.length;for(s&&!this.adPods&&this.createAdPods(e);s--;)t=e[s],i=this.adPods["t_"+t.start],n||i.hasPlayed===t.played||(n=i),i.hasPlayed=t.played;return n},createAdPods:function(e){var t,i,n,s,r=function(e){return l>1&&e===l-1?"post":0===e?"pre":"mid"},a=0,o=[],l=e.length;for(this.adPods={},i=0;i<l;i++)t=e[i],n=r(i),s=t.start,o.push(s),this.adPods["t_"+s]={startTime:s,hasPlayed:!1,adPodId:n+("mid"===n?"_"+a++:"_0"),adCount:0,podDuration:t.end-s};this.cviModel.contentVideoState.chapterStartTimes=o},resetAdStates:function(){var e=this.cviModel;e.resetAdPlaybackState(),e.resetAdVideoState(),e.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(e){var t=e.getAdPodInfo();this.populateAdVideoState(e),t&&this.currAdPod&&(this.currAdPod.adCount=t.getTotalAds(),this.currAdPod.podDuration=t.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(e){var t=uvpjs.adUtil.extractAdStateData(e,uvpjs.adUtil.context.DAI,this.isLiveStream);t.adBitrate=this.cviModel.getContentPlaybackState().facadeState.currentBitrate,this.cviModel.setAdVideoState(t)},createAdProgressPayload:function(e){var t=this.getVideoProgressPayload(),i=e.currentTime;return t.isAd=!0,t.duration=e.duration,t.currentTime=i,t.absoluteStreamTime=this.facade.getCurrentTime(),t.lastSecondCompleted=Math.floor(i),t.lastPercentageCompleted=this.currAdPercentComplete,t},extractAdInfo:function(e){return uvpjs.adUtil.extractAdInfo(e,uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(e){this.adTrackingHandle&&e!=t.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:e,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||this.isLiveStream||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var e,t,i;this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying()&&(t=this.facade.getCurrentTime(),this.checkForAdBlocker(t,!1),e=this.streamManager.contentTimeForStreamTime(t),!this.contentStartOpen&&(e>0||this.isLiveStream)&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(e),i=this.createVideoProgressPayload(e,t),this.dispatchVideoProgress(i))},createVideoProgressPayload:function(e,t){var i=this.getVideoProgressPayload();return i.currentTime=e,i.absoluteStreamTime=t,i.duration=this.contentDuration||-1,i},checkBuffering:function(e){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(e,t){var i=e-this.lastAdBlockCheckTime>this.adBlockCheckInterval,n=t||i,s=n&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return n&&(this.lastAdBlockCheckTime=e),s&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!s},assembleResourceDefinition:function(){var e=this.rco.getAdTagParameters(),t=this.rco.getVideoId(),i=this.rco.getContentSourceId(),n=this.rco.getAssetKey();return n&&e||e&&t&&i?{adTagParameters:e,videoId:t||null,contentSourceId:i||null,assetKey:n||null}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(e){for(var s,r="add"===e?"addEventListener":"removeEventListener",a="addEventListener"===r,o=t.StreamEvent.Type,l=i.length;l--;)s=o[i[l]],a&&(this.hMap[s]=n[l]),!a&&delete this.hMap[s],this.streamManager[r](s,this.hStreamEvent)},createAdClickElement:function(e){var t,i,n,s,r=e.nextSibling;if(r&&"uvpjsDaiContainer"===r.getAttribute("data-role"))return r;for(n in(t=document.createElement("div")).setAttribute("data-role","uvpjsDaiContainer"),i={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1},s=t.style,i)s[n]=i[n];return e.insertAdjacentElement("afterend",t),t},onPauseVideo:function(e){(e&&e.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(e.type))},onPlayVideo:function(e){(e&&e.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(e.type))},onChangeVideoVolume:function(e){var t=e&&e.target,i=e&&e.payload,n=i&&i.vol,s=uvpjs.util.inRange(n,0,1),r=this.cviModel.isMuted;t===this.vidContId&&s&&!r&&this._hasFacade()&&(this.facade.setVolume(n),this.isAdPlaying()&&this.trackAdEvent(e.type))},onMuteVideo:function(e){(e&&e.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(e.type))},onUnMuteVideo:function(e){(e&&e.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(e.type))},facadeId3Data:function(e){if(this.streamManager){var t=function(e){this.streamManager.processMetadata("ID3",e.data,e.pts)}.bind(this);e&&e.forEach(t)}},facadeProgress:function(e){},facadeTimeUpdate:function(e){},facadeDurationChanged:function(e){this.contentDuration=this.streamManager.contentTimeForStreamTime(e.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(e){this.adClickElement&&(this.adClickElement.style.display=!1!==e?"block":"none")},log:function(e,t,i){uvpjs[i||"log"](this.DEBUG_ID,e,t||"")}})}(uvpjs.register("uvpjs")),function(e){"use strict";var t={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};e.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(e){this.debug=uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(e),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(e,t,i){this._super(e,t,i),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(e){e()},loadVideoAndBeginPlayback:function(e){var t,i=this.rco,n=this.cviModel;this.suppressFacadePlayOnLoad=!0===e,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),n.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),n.setContentVideoStateItems(i),n.mergeCDOData(),this.killDataProxy(),this.contentDuration=n.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),(t=this.assembleAssetUrl(i))?(this.cviModel.contentVideoState.assetURL=t,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(i.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),!this.suppressFacadePlayOnLoad&&this.facade.playVideo()):this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0)},assembleAssetUrl:function(e){var t,i,n=e.assetURL,s=uvpjs.util;return s.isEmpty(n)?null:n.indexOf("?")>-1?n:(t=(i=e.getAdTagParameters())?s.queryStrFromObj(i):null,s.isEmpty(t)?n:n+"?"+t)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(e){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(e),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(e,t){this.eventsMgr.dispatchEvent(e,t,this.vidContId)},dispatchContentDataLoaded:function(){var e=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:e})},dispatchAdPodStart:function(e){var t=this.getPrerollPod(e);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:t})},dispatchAdPodEnd:function(){var e=this.getPrerollPod();e.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:e})},dispatchAdStart:function(){var e=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:e})},dispatchAdEnd:function(){var e=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:e})},dispatchAdQuartile:function(e){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:e})},dispatchVideoProgress:function(e){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,e)},dispatchError:function(e,t,i,n){this.dispatch(e,{errorInfo:new uvpjs.ErrorInfo({eventType:e,errorCode:i,message:t,isFatal:!0===n,adInfo:null})})},getPrerollPod:function(e){return this.adPod||(this.adPod={startTime:e,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var e=this.cviModel;e.resetAdPlaybackState(),e.resetAdVideoState(),e.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var e=uvpjs.adUtil.getAdStateBlank();e.adServerName="dai_ssb",e.duration=this.getPrerollAdDuration(),e.adClipID="pre_0",e.adPosition=1,e.adType="pre",this.cviModel.setAdVideoState(e)},getPrerollAdDuration:function(){var e=this.getAbsoluteDuration();return e>0&&this.contentDuration>0?e-this.contentDuration:-1},getAbsoluteDuration:function(){return this.absoluteDuration||(this.absoluteDuration=this.facade.getDuration()),this.absoluteDuration},createAdProgressPayload:function(){var e,t,i=this.getVideoProgressPayload(),n=this.facade.getCurrentTime(),s=this.getPrerollAdDuration(),r=Math.floor(n/s*100);switch(r){case 25:e=this.quartiles[25],t=25;break;case 50:e=this.quartiles[50],t=50;break;case 75:e=this.quartiles[75],t=75}return t&&!e&&this.dispatchAdQuartile(t),t&&(this.quartiles[String(t)]=1),i.isAd=!0,i.duration=s,i.currentTime=n,i.absoluteStreamTime=this.facade.getCurrentTime(),i.lastSecondCompleted=Math.floor(n),i.lastPercentageCompleted=r,i},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var e,t=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,i=this.isAdPlaying(),n=this.contentStartOpen,s=t&&this.facade.getCurrentTime();t&&(e=i?this.createAdProgressPayload():n?this.createVideoProgressPayload():null,s>1&&!n&&!i&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+s),this.contentStartTime=s,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(s),e&&this.dispatchVideoProgress(e))},createVideoProgressPayload:function(){var e=this.getVideoProgressPayload(),t=this.facade.getCurrentTime(),i=t-this.contentStartTime;return e.currentTime=i,e.absoluteStreamTime=t,e.duration=this.contentDuration||-1,e},checkBuffering:function(e){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(e){var t=e&&e.target,i=e&&e.payload,n=i&&i.seekTime,s=this.facade,r=this._hasFacade(),a=r&&(this.absoluteDuration||s.getDuration()),o=this.getPrerollAdDuration(),l=this.facade.getCurrentTime();if("number"==typeof n&&t===this.vidContId&&a){if((n+=o>0?o:0)<0||n>a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+n));this._seekFromTime=this._seekFromTime||l,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:n,seekFromTime:this._seekFromTime},null,2)),r&&s.seekTo(n)}},facadeProgress:function(e){},facadeTimeUpdate:function(e){},facadeDurationChanged:function(e){!this.absoluteDuration&&(this.absoluteDuration=e.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.hCueChange=this.hCueChange.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){var e=this.vidEl.textTracks;e.removeEventListener("addtrack",this.hAddTextTrack,!1);for(var t=0,i=e.length;t<i;t++)e[t].removeEventListener("cuechange",this.hCueChange,!1)},hAddTextTrack:function(e){e.track&&"metadata"===e.track.kind&&(e.track.addEventListener("cuechange",this.hCueChange,!1),e.track.mode="hidden")},hCueChange:function(e){e.target&&e.target.activeCues&&1==e.target.activeCues.length&&this.handleId3Cue(e.target.activeCues[0])},handleId3Cue:function(e){var i,n,s=e.value;"TXXX"===s.key&&(i=""!==s.info?s.info:s.data,(n=t[i])&&this[n](e.startTime))},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},log:function(e,t,i){uvpjs[i||"log"](this.DEBUG_ID,e,t||"")}})}(uvpjs.register("uvpjs")),function(e){"use strict";e.P2pClient=uvpjs.Class.subClass({init:function(e){this.clientName=e.clientName||null,this.requiredParams=e.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var e=uvpjs.P2pClient.clientMap[this.clientName];return e&&e.getHlsjsLoader&&(e.getHlsjsLoader()||null)}}),e.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,e.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(e,t){var i;this.getHlsjsLoader()?e():t.apiKey?(i=this.loadHlsLoader.bind(this,e),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+t.apiKey,i,2e3)):e(!0)},loadHlsLoader:function(e,t){if(t)return uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",t),void e(!0);uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,e,2e3)}}}}(uvpjs.register("uvpjs")),function(e){"use strict";e.MultiCdnClient=uvpjs.Class.subClass({init:function(e){this.clientName=e.clientName||null,this.requiredParams=e.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(e){this.inFlight||(this.inFlight=!0,this.decisionCallback=e,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),2e3),(new uvpjs.CodeLoader).loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(e){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(e.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),e.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(e){return e&&e.customerId&&e.appId?this.decisionUrl.replace("{customerId}",e.customerId).replace("{appId}",e.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(e){e()}}}}(uvpjs.register("uvpjs")),function(e){"use strict";e.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(e,t){var i=uvpjs.VideoDeliveryPluginService.clientType;this.model=t,this.callback=e,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(i.P2P),this.multiCdnClientOptions=this.getClientOptions(i.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var e=null,t=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(e=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(t=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(e,t))},handleMcdnReady:function(e){var t=this.multiCdnClientOptions;!e&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,t.clientName)||(t.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+t.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var e=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,e.clientName,this.handleMcdnReady.bind(this),e.requiredParams)},handleP2pReady:function(e,t){var i=this.p2pClientOptions;!t&&this.validateScriptLoad(this.staticSvc.clientType.P2P,i.clientName)||(i.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+i.clientName)),e?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var e=this.p2pClientOptions,t=this.multiCdnClientOptions.canUse;e.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,e.clientName,this.handleP2pReady.bind(this,t),e.requiredParams):t?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(e,t,i,n){var s=this.getClientObject(e,t);s||i(!0),s.loadScripts(i,n)},validateScriptLoad:function(e,t){var i=this.getClientObject(e,t);return i&&i.validateScriptLoad()||!1},createClient:function(e,t){return new e(t)},getClientOptions:function(e){var t,i,n,s,r,a,o,l,d,u=this.model,c=this.getSupportedClients(e),h={canUse:!1,clientName:null};if(e===this.staticSvc.clientType.P2P&&!uvpjs.mediaCapabilities.canUseP2p())return h;for(t in c)if((l=(n=c[i=t])&&n.uvpcModuleName)&&u.isModuleEnabled(l)){for(r=(s=n.requiredParams)&&s.length||0,o={},d=!0;r--;){if(a=u.getModuleParam(l,s[r]),uvpjs.util.isEmpty(a)){d=!1;break}o[s[r]]=a}return{canUse:d,clientName:i,requiredParams:o}}return h},getSupportedClients:function(e){var t,i,n={},s=e.clientMap;if(!s)return n;for(t in s)i=s[t],n[t]={uvpcModuleName:i.uvpcModuleName,requiredParams:i.requires};return n},getClientObject:function(e,t){return e.clientMap[t]||null}});var t=e.VideoDeliveryPluginService;t.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},t.load=function(e,t,i){(new uvpjs.CodeLoader).loadScript(e,t,i)}}(uvpjs.register("uvpjs")),function(e){var t="loadedmetadata";e.FullscreenManager=uvpjs.Class.subClass({init:function(e){var t=uvpjs.util,i=e||{},n=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,i.videoElement&&i.container?(this.videoEl=i.videoElement,this.container=i.container,this.fullscreenChangeCallback=t.isFunction(i.fullscreenChangeCallback)&&i.fullscreenChangeCallback,this.readyCallback=t.isFunction(i.readyCallback)&&i.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=n.getEnterFullscreenMethodName(),this.exitMethod=n.getExitFullscreenMethodName(),this.fsElementName=n.getFullScreenElementName(),this.isFullscreenProperty=n.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()):uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.")},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(e){var t=this.isFullscreen();e.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(t)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener(t,this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var e=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return e&&uvpjs.util.isFunction(e[this.exitMethod])?e:null},validateEntryAndExitMethods:function(){var e=this.fsElement&&this.fsElement[this.enterMethod],t=this.exitScope&&this.exitScope[this.exitMethod],i=uvpjs.util;this.hasValidEntryMethod=i.isFunction(e),this.hasValidExitMethod=i.isFunction(t)},initialize:function(){var e,i,n,s=uvpjs.mediaCapabilities;this.hasFsApiSupport=s.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(n=s.getFullscreenEventName(),(s.isFirefox()||s.isIE()?document:this.container).addEventListener(n,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,e=s.getFullscreenEnterEventName(),i=s.getFullscreenExitEventName(),this.fsElement.addEventListener(e,this.hFullScreenEvent,!1),this.fsElement.addEventListener(i,this.hFullScreenEvent,!1),this.enterEvt=e,this.exitEvt=i),this.validateEntryAndExitMethods(),this.hasValidEntryMethod?(this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener(t,this.hMetadataLoaded,!1),this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())):this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo())}}),e.FullscreenManager.hasFullscreenSupport=function(){return!!uvpjs.mediaCapabilities.getEnterFullscreenMethodName()}}(uvpjs.register("uvpjs")),function(e){"use strict";var t,i,n,s,r=e._;e.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=e.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=e.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._ccEnabledByUser=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this.isAndroidOnHlsjs=this.mc.canPlayHlsjsAndriod(this.vci.CVI_Mgr.cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(e.skinConfig)},destroy:function(){var e=function(){};this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=e,this._replayCB=e,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(e){var t=uvpjs.util,i=uvpjs.Configuration.path,n=this._containerId,s=e.customCSS;this._namespace="."+n+".skin",this._autoPlay=e.isMutedAutoplay||e.isUnmutedAutoplay,this._isMutedAutoplay=e.isMutedAutoplay,this._previewImage=e.previewImage,this._enableReplay=e.enableReplay,this._themeName=e.themeName,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=t.isDefinedString(s)&&s||i+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(e)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaystate:function(e){this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)},disableButton:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",e),r.includes(this._disabledButtons,e)||this._disabledButtons.push(e),this._disableButton(e)},enableButton:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",e),r.pull(this._disabledButtons,e),this._enableButton(e)},_handleFullscreenMgrReady:function(e){e&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(e){var t=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),e?(this.vci.fullscreen(!0),t&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),t&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(e){var t=this._queryByElementName(e);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",e),this._disable(e),t&&t.setAttribute("disabled","disabled")},_enableButton:function(e){var t=this._queryByElementName(e);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",e),r.includes(this._disabledButtons,e)||(this._enable(e),t&&t.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var e=this.vci,t=this._namespace,i=uvpjs.EventType;e.addEventListener(i.AD_START+t,this._onAdStart.bind(this)),e.addEventListener(i.AD_END+t,this._onAdEnd.bind(this)),!this._isIOS&&e.addEventListener(i.CAPTIONS_READY+t,this._onCaptionsReady.bind(this)),e.addEventListener(i.CONTENT_START+t,this._onContentStart.bind(this)),e.addEventListener(i.CONTENT_END+t,this._onContentEnd.bind(this)),e.addEventListener(i.VIDEO_PROGRESS+t,this._onVideoProgress.bind(this)),e.addEventListener(i.VIDEO_STATE_CHANGE+t,this._onVideoStateChange.bind(this)),e.addEventListener(i.VIDEO_LOADING+t,this._onVideoLoading.bind(this)),e.addEventListener(i.CONTROL_MUTE+t,this._onControlMuteUnmute.bind(this)),e.addEventListener(i.CONTROL_UNMUTE+t,this._onControlMuteUnmute.bind(this)),e.addEventListener(i.RESOURCE_START+t,this._onResourceStart.bind(this)),e.addEventListener(i.RESOURCE_END+t,this._onResourceEnd.bind(this)),e.addEventListener(i.CONTAINER_RESIZE+t,this._onUVPJSResize.bind(this)),e.addEventListener(i.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+t,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var e=this.vci,t=this._namespace,i=uvpjs.EventType;e&&e instanceof uvpjs.VideoControlInterface&&(e.removeEventListener(i.AD_START+t),e.removeEventListener(i.AD_END+t),!this._isIOS&&e.removeEventListener(i.CAPTIONS_READY+t),e.removeEventListener(i.CONTENT_START+t),e.removeEventListener(i.CONTENT_END+t),e.removeEventListener(i.VIDEO_PROGRESS+t),e.removeEventListener(i.VIDEO_STATE_CHANGE+t),e.removeEventListener(i.VIDEO_LOADING+t),e.removeEventListener(i.CONTROL_MUTE+t),e.removeEventListener(i.CONTROL_UNMUTE+t),e.removeEventListener(i.RESOURCE_END+t),e.removeEventListener(i.CONTAINER_RESIZE+t))},_addUIEventListeners:function(){for(var e=this.mc.isIE()?"change":"input",t=this._containerEl,i=this.css,n=this.shouldTrapTaps(),s=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],r=s.length;r--;)"_onClosedCaptionBtnClick"===s[r]&&this._isIOS||(this[s[r]]=this[s[r]].bind(this));var a=this._onUVPJSGestureEvent,o=this._hNonTap,l=this._onProgressSliderEvent,d=this._onVolumeSliderEvent,u=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",o),t.addEventListener("mouseenter",a,!0),t.addEventListener("mouseleave",a,!0),t.addEventListener("mousemove",a,!0),t.addEventListener("mousedown",a,!1),t.addEventListener("mouseup",a,!1),t.addEventListener("click",a,!1),t.addEventListener("touchstart",a,!0),t.addEventListener("touchend",a,!0),this._previewBtn=this._queryByElementName(i.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",o),!this._isTouch&&this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(i.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),!this._isTouch&&this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(i.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(i.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(i.PROGRESS_SLIDER),this._progressSlider.addEventListener(e,l,!1),this._progressSlider.addEventListener("mousedown",l,!1),this._progressSlider.addEventListener("mouseup",l,!1),this._progressSlider.addEventListener("touchstart",l,!0),this._progressSlider.addEventListener("touchend",l,!0),this._volumeSlider=this._queryByElementName(i.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(e,d,!1),this._volumeSlider.addEventListener("mouseover",d,!1),this._volumeSlider.addEventListener("mouseout",d,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(i.LARGE_PLAY_BTN),!n&&this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(i.PLAYSTATE_BTN),!n&&this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(i.VOLUME_BTN),!n&&this._volumeBtn.addEventListener("click",u,!1),this._volumeBtn.addEventListener("mouseover",u,!1),this._volumeBtn.addEventListener("mouseout",u,!1),this._isIOS||(this._ccBtn=this._queryByElementName(i.CLOSED_CAPTION_BTN),!n&&this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1)),this._settingsBtn=this._queryByElementName(i.SETTINGS_BTN),!n&&this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,i.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(i.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var e=this.mc.isIE()?"change":"input",t=this._containerEl,i=this._hNonTap,n=this._onUVPJSGestureEvent,s=this._onProgressSliderEvent,r=this._onVolumeSliderEvent,a=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",i,!1),t.removeEventListener("mouseenter",n,!0),t.removeEventListener("mouseleave",n,!0),t.removeEventListener("mousemove",n,!0),t.removeEventListener("mousedown",n,!1),t.removeEventListener("mouseup",n,!1),t.removeEventListener("click",n,!1),t.removeEventListener("touchstart",n,!0),t.removeEventListener("touchend",n,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",i,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(e,s,!1),this._progressSlider.removeEventListener("mousedown",s,!1),this._progressSlider.removeEventListener("mouseup",s,!1),this._progressSlider.removeEventListener("touchstart",s,!0),this._progressSlider.removeEventListener("touchend",s,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(e,r,!1),this._volumeSlider.removeEventListener("mouseover",r,!1),this._volumeSlider.removeEventListener("mouseout",r,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",a,!1),this._volumeBtn.removeEventListener("mouseover",a,!1),this._volumeBtn.removeEventListener("mouseout",a,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var e=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));uvpjs.util.createStyleSheet(e,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var e=!0;for(var t in this._controlList)this._checkControlOnDOM(this._controlList[t])||(e=!1);return e},_waitForControls:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls."),setTimeout(function(){if(!(++this._waitCount>100))return this._haveControlsLoaded()?void e.call(this):void this._waitForControls(e)}.bind(this),50)},_clearMouseMoveInterval:function(e){var t=this._getClassName(e,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[t]&&(clearInterval(this._intervals[t]),this._intervals[t]=-1)},_clearIntervals:function(){var e,t=this._intervals;for(e in t)-1!==t[e]&&(clearInterval(t[e]),t[e]=-1)},_setupDom:function(){var e=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),t(this._containerEl,this.PRIMARY_BLOCK),t(this._contentEl,this._getClassName(e.CONTENT)),t(this._controlsEl,this._getClassName(e.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&t(this._adEl,this._getClassName(e.AD)),this._hide(e.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(e.BUFFERING_FRAME),this._hide(e.LARGE_PLAY_BTN),this._hide(e.CONTROL_BAR),this._hide(e.PROGRESS),this._hide(e.VOLUME_SLIDER),this._show(e.CONTROLS),this._hide(e.BUFFERING_FRAME),this._hide(e.SETTINGS_MENU),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(e){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+e]=e},_setupControlsContainer:function(){var e=[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(e),this._isIOS&&(this._controlsEl.querySelector(".uvpjs__btn-volume").style.right="45px",this._controlsEl.querySelector(".uvpjs__time").style.right="83px")},_generateSettingsMenu:function(e,t){function i(e,t){var i={};if(!1!==e.enabled)return void 0===e.value?(i.el="SETTINGS_MENU_ITEM",i.type="button",i.label=e.label,i.target=t):(i.el="SETTINGS_MENU_INPUT",i.type="menu",i.label=e.label||e.value,i.value=e.value,i.property=t&&r.last(t.split(":")),i.selected=function(e){var t=e.value,i=e.property,n=i&&f[i];return!((n&&n.toLowerCase())!==(t&&t.toLowerCase()))}(i)),i}var n,s,a,o,l,d,u,c,h=this._queryByElementName(this.css.SETTINGS_MENU),p=this._getClassName(this.css.SETTINGS_MENU_ITEM),f=r.assign({},this._menuSelections,this._getCaptionsStyle()),v=document.createRange(),g=uvpjs.util,_=[],m=this.shouldTrapTaps();for(c=e&&e.length,u=0;u<c;u++)a=t,(o=(l=e[u]).name)&&(a=g.isDefinedString(t)&&[t,o].join(":")||o),_.push(i(l,a));for(t&&((d=i(this._findMenuItem(t),a=t.split(":").slice(0,-1).join(":"))).cls=p+"--back",_.unshift(d)),v.selectNodeContents(h),v.deleteContents(),h.insertAdjacentHTML("beforeend",this._templateToHTML(_)),n=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),s=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),u=n&&n.length;u--;)!m&&n[u].addEventListener("click",this._onSettingsMenuBtnClick);for(u=s&&s.length;u--;)!m&&s[u].addEventListener("click",this._onSettingsMenuInputClick)},_removeMenuEventListeners:function(){var e,t=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),i=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);for(e=t&&t.length;e--;)t[e].removeEventListener("click",this._onSettingsMenuBtnClick);for(e=i&&i.length;e--;)i[e].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(e){var t={items:this.settingsMenu};if(r.isEmpty(e))return t;var i=this,n=e.split(":");return r(n).each(function(e){i.debug&&uvpjs.log(i.DEBUG_ID,"_findMenuItem key",e),t=r.find(t.items,function(t){return t.name===e})}),t},_createAdLearnMoreButton:function(){},_setupPreview:function(){var e=uvpjs.util,t=this.css.PREVIEW_BTN,i=this._previewImage,n=this._queryByElementName(t);uvpjs.log(this.DEBUG_ID,"_setupPreview",i),e.isDefinedString(i)&&(n.style.backgroundImage="url('"+i+"')"),this._show(t)},_setupReplay:function(){var e=uvpjs.util,t=this.css,i=t.REPLAY_BTN,n=this._previewImage,s=this._queryByElementName(i);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),e.isDefinedString(n)&&(s.style.backgroundImage="url('"+n+"')"),this._hide(t.LARGE_PLAY_BTN),this._hide(t.PREVIEW_BTN),this._hide(t.BUFFERING_FRAME),this._show(t.CONTROLS),this._hide(t.CONTROL_BAR),this._hide(t.PROGRESS),this._show(i),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var e=this._getClassName(this.css.BUFFERING_FRAME);new Spinner({lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:e,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(this._controlsEl)},_disableInactiveButtons:function(){!this._isIOS&&this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(e){var t=this.css;this._containerId===e.target&&(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(e.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(t.VOLUME_BTN),this._disableButton(t.SETTINGS_BTN),this._disableButton(t.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(t.PROGRESS),this._hasActive(t.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),e.payload.adData.isCustomClickTrackingUsed||this._disable(t.LARGE_PLAY_BTN))},shouldIgnoreStateChange:function(e){return this.vci.getContentVideoData().isLive&&!!e},_onAdEnd:function(e){this._containerId===e.target&&(this.ignoreVideoStateChange=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,e.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(e){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",e),this._captionsLoaded=!0,this._enableCaptions(),this.isAndroidOnHlsjs||this._enableButton(this.css.SETTINGS_BTN))},_onCaptionsUnavailable:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",e),this._isIOS||this._disableCaptions()},_onContentStart:function(e){var t=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",e),this._containerId===e.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),!this._isLive()&&this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(t.VOLUME_BTN),this._captionsLoaded&&this._enableButton(t.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(t.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(t.PROGRESS)):this._isStreaming()&&(this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(t.PROGRESS)),!this._isIOS&&this._hasActive(t.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===e.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(e){var t="controlMute"===e.type;this._containerId===e.target&&this._updateVolumeUI(this._volumeSlider.value,t)},_onDiagCloseButton:function(e){this._containerId===e.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",e),this._menuSelections.debug=null)},_onResourceStart:function(e){(e&&e.target)===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",e),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(e){var t=e.target,i=0===e.payload.playlistLength;this._containerId===t&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",e),this._hide(this.css.CONTROLS),this._enableReplay&&i&&this._setupReplay(),this._captionsLoaded&&(this._captionsLoaded=!1,this._disableCaptions()),this._resetProgressSlider())},_onVideoProgress:function(e){var t,i,n=e.payload,s=n.playbackState,r=this.vci.getVolume(),a=this.css.TIME_DURATION,o=this.css.TIME_CURRENT,l=!1;this._containerId===e.target&&(r!==Number(this._volumeSlider.value)&&this._updateVolumeUI(r),s!==this._playbackState&&(this._playbackState=s,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(n),s!==this.mc.PLAYING||this._isSliding||n.duration!==1/0&&(t=this._queryByElementName(a),i=this._queryByElementName(o),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&n.duration>=3600&&(this.durationChecked=l=!0):(this.durationChecked=!0,n.duration>=3600&&(l=!0)),l&&(i.parentNode.style.width="100px"),t.innerHTML=this._formatTimestampByType(a,n.duration),i.innerHTML=this._formatTimestampByType(o,n.currentTime),this._updateProgressUI(n)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(e){r.has(e,"target")&&this._containerId===e.target&&r.isObject(e)&&r.has(e,"payload.data")&&this._updateProgressLoad(e.payload.data)},_onVideoStateChange:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",e),r.isObject(e)&&this._containerId===e.target&&r.isObject(e.payload)&&r.isNumber(parseInt(e.payload.newState))&&(!this.ignoreVideoStateChange||t===this.mc.PAUSED||t===this.mc.PLAYING)){var t=e.payload.newState;t!==this._playbackState&&(this._playbackState=t,this._updatePlaybackStateUI(this._playbackState)),t===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)}},monitorMuting:function(e,t,i){null!==e&&(this.isMonitoringMuting=e),t&&clearInterval(this.muteMonitorIntervalId),i&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var e=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&e!==this.currVolumeInfo.muted&&(this.currVolumeInfo.muted=e,e?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(e){var t=!1;switch(e.type){case"mouseenter":this._onUVPJSMouseEnter(e);break;case"mouseleave":this._onUVPJSMouseLeave(e);break;case"mousemove":this._onUVPJSMouseMove(e);break;case"mousedown":this._onUVPJSMouseDown(e);break;case"mouseup":this._onUVPJSMouseUp(e);break;case"click":this._showControlBar(e),t=!0;break;case"touchstart":this._onUVPJSTouchStart(e);break;case"touchend":this._onUVPJSTouchEnd(e),t=!0}!this._hasFirstTouch&&t&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(e)))},_getTargetInfo:function(e){var t=e.target;return{isVolumeButton:-1!==t.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==t.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(e){switch(e.type){case"input":case"change":this._onProgressSliderChange(e);break;case"touchstart":case"mousedown":this._onProgressSliderStart(e);break;case"touchend":case"mouseup":this._onProgressSliderEnd(e)}},_onVolumeSliderEvent:function(e){switch(e.type){case"input":case"change":this._onVolumeSliderChange(e);break;case"mouseover":this._showVolumeSlider(e);break;case"mouseout":this._hideVolumeSlider(e)}},_onVolumeBtnEvent:function(e){switch(e.type){case"click":case"touchend":this._onVolumeBtnClick(e);break;case"mouseover":this._showVolumeSlider(e);break;case"mouseout":this._hideVolumeSlider(e)}},_onUVPJSMouseEnter:function(e){e.stopPropagation(),this._containerEl===e.target&&(this._hasPaused()||this._showControlBar(e))},_onUVPJSMouseDown:function(e){e.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(e){var t,i=this.vci.getCurrentPlaybackState().playbackState;return this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),e.target.getAttribute("disabled")?(e.stopPropagation(),void e.preventDefault()):(this._touchStartTime=e.timeStamp,this._previewCallbackDone?void(this._hasDisabled(this.css.CONTROLS)||i!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),e.target===this._progressSlider&&(t=1-(e.target.clientWidth-e.layerX)/e.target.clientWidth,this._onProgressSliderChange(e,t)))):void(this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet.")))},_onUVPJSTouchEnd:function(e){var t,i,n,s,r=this.css,a=this._isTap(e.timeStamp),o=[r.CLOSED_CAPTION_BTN,r.VOLUME_BTN,r.PLAYSTATE_BTN,r.SETTINGS_BTN,r.SETTINGS_MENU,r.SETTINGS_MENU_ITEM,r.SETTINGS_MENU_INPUT,r.LARGE_PLAY_BTN,r.FULLSCREEN_BTN],l=o.length,d=e.target.className;if(e.target.getAttribute("disabled"))return e.stopPropagation(),void e.preventDefault();if(!this._hasDisabled(r.CONTROLS)){for(;l--&&!(i=i||d.indexOf(o[l])>-1););if(this.shouldTrapTaps()&&i&&l<o.length-1)return e.stopPropagation(),e.preventDefault(),void this.handleTap(o[l],e);(n=!(i||this._isTouchActive&&a))&&e.preventDefault(),n&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),s=t||n?this.HIDE_DELAY:0,t&&clearTimeout(t),t=setTimeout(function(){this._hasPaused()||(t=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER))}.bind(this),s)}},handleTap:function(e,t){var i=this.css;if(!this._queryByElementName(e).hasAttribute("disabled"))switch(e){case i.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(t);break;case i.VOLUME_BTN:this._onVolumeBtnEvent(t);break;case i.PLAYSTATE_BTN:case i.LARGE_PLAY_BTN:this._onPlayToggle(t);break;case i.SETTINGS_BTN:this._onSettingsBtnClick(t);break;case i.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(t);break;case i.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(t)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(e){e.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(e){var t=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[t]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[t]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(e){this._isMouseActive||(this._clearMouseMoveInterval(e),this._removeModifier(e,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(e){e.stopPropagation(),this._containerEl===e.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(e){e.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(e){e.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(e){e.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var e=this._containerEl.offsetWidth;e>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),e>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),e>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),e>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),e<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),e<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),e<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),e<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(e){var t=this.vci.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(t?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(e){var t=parseFloat(e.target.value),i=this.vci.getPlayerMuted();i&&t>0&&this.vci.unMute(),this.vci.setVolume(t),this._updateVolumeUI(t,i)},_onFullscreenBtnClick:function(e){e.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),e.stopPropagation(),e.preventDefault(),this.ignoreVideoStateChange&&this._isLive())this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo());else{var t=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",t),t===this.mc.PAUSED||t===this.mc.EMPTY||t===this.mc.LOADING)return this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),void this.vci.playVideo();t!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo())}},_onPreviewBtn:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),!this._isTouch||this._isTap(e.timeStamp)?(e.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback.")},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),e.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),!this._isTouch&&this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),e.stopPropagation();var t=this.css.CLOSED_CAPTION_BTN,i=this._hasActive(t);if(this._ccEnabledByUser=!i,i)return this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions();this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()},_onSettingsBtnClick:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),e.stopPropagation();var t=this.css.SETTINGS_MENU,i=this._hasHidden(t);if(uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",i),i)return this._addModifier(t,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(t);this._removeModifier(t,this.ACTIVE_MODIFIER),this._hide(t)},_onSettingsMenuBtnClick:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",e);var t=e.target.getAttribute("data-target");this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",t),e.target.parentNode.setAttribute("data-target",t);var i=this._findMenuItem(t);this._generateSettingsMenu(i.items,t)},_onSettingsMenuInputClick:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",e);var t=e.target.parentNode.getAttribute("data-target");switch(t&&t.split(":")[0]){case"cc":this._onSettingsCaptionsChange(e);break;case"controls":this._onSettingsControlsChange(e);break;case"debug":this._onSettingsDiagWindowChange(e)}},_onSettingsCaptionsChange:function(e){var t=e.target,i=t.parentNode,n=t.getAttribute("data-property"),s=t.getAttribute("data-value").toLowerCase();this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",n,s),r(i.children).each(function(e){e.setAttribute("data-selected","false")}.bind(this)),t.setAttribute("data-selected","true"),"text-position"!==n?this.vci.setCaptionsStyleProperty(n,s):this._setCCPosition(s)},_onSettingsControlsChange:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",e);var t=e.target,i=t.getAttribute("data-property"),n=t.getAttribute("data-value").toLowerCase(),s="#"+this._containerId+" ";if("background-opacity"===i){i="background-color";var r=this._queryByElementName(this.css.CONTROL_BAR),a=getComputedStyle(r).getPropertyValue(i);if(-1===a.indexOf("rgba"))return;n=a.split(",").slice(0,-1).join(",")+", "+n+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",n),s+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(s,i,n)},_onSettingsDiagWindowChange:function(e){var t=e.target,i=t.getAttribute("data-property"),n=t.getAttribute("data-value"),s=!("true"===t.getAttribute("data-selected"));this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",e),this._menuSelections[i]=n,t.setAttribute("data-selected",s),s?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(e){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",e),this.vci.setCaptionsStyle(e))},_setCaptionsStyleProperty:function(e,t){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",e,t),this.vci.setCaptionsStyleProperty(e,t))},_setCueProperty:function(e,t){!this._isIOS&&this._captionsLoaded&&this._videoEl.textTracks&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",e,t),this.vci.setCaptionsCueProperty(e,t))},_setCCPosition:function(e){var t="text-position";!this._isIOS&&this._captionsLoaded&&(e=e||this._getCaptionsStyle()[t],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",t,e),this.vci.setCaptionsStyleProperty(t,e))},_showControlBar:function(e){var t=this.vci.getCurrentPlaybackState().playbackState,i=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&t!==this.mc.EMPTY&&(r.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[i.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(i.CONTROL_BAR),this.controlsVisible=!0,this._show(i.PROGRESS))},_hideMenu:function(e){this._hasHidden(this.css.SETTINGS_MENU)||e.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(e){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=r.debounce(function(){this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch?this._hideControlBar.hide.cancel():(this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS))},e||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(e){var t,i=this.css;this._hasDisabled(i.VOLUME_BTN)||this._hasDisabled(i.CONTROLS)||(this._hasActive(i.SETTINGS_MENU)&&this._hide(i.SETTINGS_MENU),this._setDataAttribute(this._containerEl,i.VOLUME_SLIDER,!0),this._addModifier(i.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(i.VOLUME_SLIDER),(this.mc.isFirefox()||this.mc.isEdge())&&(t=this._controlsEl.querySelector(".uvpjs__volume-slider"))&&t.setAttribute("style","bottom: 62px"))},_hideVolumeSlider:function(e){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._ccEnabledByUser&&(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions()))},_disableCaptions:function(){this._isIOS||(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this._disableButton(this.css.CLOSED_CAPTION_BTN),this._disableButton(this.css.SETTINGS_BTN))},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),r.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(e,t){var i,n=uvpjs.util,s=this._containerEl;!0===this.vci.getPlayerMuted()?i="mute":e>.85?i="full":n.inRange(e,.5,.85)?i="high":n.inRange(e,.15,.5)?i="medium":n.inRange(e,0,.15)&&(i="low"),this._volumeSlider.value=e||this._videoEl.volume,this._setDataAttribute(s,"volume-level",i),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,e)},_onProgressSliderChange:function(e,t){var i,n,s=this.vci.getContentVideoData(),r=this.vci.getCurrentPlaybackState(),a=this.css.TIME_CURRENT,o=this._queryByElementName(a),l=t||this._progressSlider.value;l=l>1?1:l<0?0:l,i=Math.ceil(l*s.duration*1e4)/1e4,n=Math.abs((r.currentTime-i)/i),this._updateProgressSlider(l),o.innerHTML=this._formatTimestampByType(a,i),this._hasActive(this.css.PROGRESS_SLIDER)||n<=.02||this.vci.seekTo(i)},_onProgressMouseOver:function(e){e.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(e){e.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(e){var t=this.css;if(this._hasAd()||this._hasDisabled(t.PROGRESS))return e.stopPropagation(),void e.preventDefault();this._addModifier(t.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0},_onProgressSliderEnd:function(e){if(this._hasAd()||this._hasDisabled(this.css.PROGRESS))return e.stopPropagation(),void e.preventDefault();this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(e)},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(e){var t;this._isLive()||(t=Math.ceil(e.bufferLength/e.duration*1e4)/1e4,r.isNaN(t)||t===1/0||t<=0||(this._downloaded=t,this._hasAd()||(this._queryByElementName(this.css.PROGRESS_LOADED).value=this._downloaded)))},_updatePlaybackStateUI:function(e){var t=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",e),e){case this.mc.PLAYING:this._show(t.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(t.LARGE_PLAY_BTN),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),this._hide(t.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(t.PROGRESS);break;case this.mc.PAUSED:this._show(t.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(t.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(t.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(t.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(t.CONTROLS),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),this._hide(t.LARGE_PLAY_BTN),this._show(t.BUFFERING_FRAME)}},_updateProgressUI:function(e){var t=Math.ceil(e.currentTime/e.duration*1e4)/1e4;this._updateProgressSlider(t)},_updateSliderUI:function(e,t,i){var n=this,s={};if(!r.isUndefined(this._vendorPrefix)&&!r.isUndefined(e)){if(s.id="#"+this._containerId,s.cls=n._getClass(t),s.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[n._vendorPrefix],this._isMSEdge&&(s.pseudo=""),s.add=function(e,t,i){if(!r.isUndefined(this.pseudo)){var s=this.id+(t||"")+" "+this.cls+(i||"")+this.pseudo;n._addCSSRule(s,"background-size",100*e+"% 100%")}},s.before=function(e,t){var i=n._getClass(n.PRIMARY_BLOCK);t&&(i+=n._getClass(n.PRIMARY_BLOCK,t)),this.add(e,i,null)},s.after=function(e,t){this.add(e,null,t)},t===n.css.VOLUME_SLIDER)return void s.add(i);var a=i*e.offsetWidth,o=(.5-i)*e.offsetHeight,l=a/e.offsetWidth,d=(a+o)/e.offsetWidth;e.value=i;var u=n._hasAd();s.before(l,u?n.AD_MODIFIER:null),u||s.after(d,":hover"),this._isTouch&&s.before(d,n.TOUCH_MODIFIER)}},_checkControlOnDOM:function(e){var t=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+e;return!!this._controlCache[t]},_getClassName:function(e,t){var i=this.PRIMARY_BLOCK;return e!==this.PRIMARY_BLOCK&&(i+=this.BLOCK_ELEMENT_DELIMITER+e),t&&(i+=this.ELEMENT_MODIFIER_DELIMITER+t),i},_getClass:function(e,t){return this.CLASS_SELECTOR_PREFIX+this._getClassName(e,t)},_queryByClassName:function(e){var t,i;if(this._containerId)return t=this.ID_SELECTOR_PREFIX+this._containerId,e!==this.PRIMARY_BLOCK&&(t+=" "+this.CLASS_SELECTOR_PREFIX+e),(i=this._controlCache[t]||document.querySelector(t))&&(this._controlCache[t]=i),i},_queryAllByClassName:function(e){var t=this.ID_SELECTOR_PREFIX+this._containerId;return e!==this.PRIMARY_BLOCK&&(t+=" "+this.CLASS_SELECTOR_PREFIX+e),document.querySelectorAll(t)},_queryByElementName:function(e){return this._queryByClassName(this._getClassName(e))},_queryAllByElementName:function(e){return this._queryAllByClassName(this._getClassName(e))},_show:function(e){if(e===this.css.PROGRESS&&!this._isLive()){var t=this._queryByElementName(e),i=t.querySelector("input"),n=t.querySelector("progress");t&&(t.style.display="block"),i&&(i.style.display="block"),n&&(n.style.display="block")}this._removeModifier(e,this.HIDDEN_MODIFIER)},_hide:function(e){if(e===this.css.PROGRESS){var t=this._queryByElementName(e),i=t.querySelector("input"),n=t.querySelector("progress");t&&(t.style.display="none"),i&&(i.style.display="none"),n&&(n.style.display="none")}this._addModifier(e,this.HIDDEN_MODIFIER)},_enable:function(e){this._removeModifier(e,this.DISABLED_MODIFIER)},_disable:function(e){this._addModifier(e,this.DISABLED_MODIFIER)},_enableMenuItem:function(e){var t;e&&(t=this._findMenuItem(e))&&(t.enabled=!0)},_hasHidden:function(e){return this._hasModifier(e,this.HIDDEN_MODIFIER)},_hasActive:function(e){return this._hasModifier(e,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(e){return this._hasModifier(e,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var e=this.vci.getContentVideoData();return e.deliveryType&&e.deliveryType===this.mc.PLAYING},_isStreaming:function(){var e=this.vci.getContentVideoData();return e.deliveryType&&e.deliveryType===this.mc.STREAMING},_hasModifier:function(e,t){r.isArray(t)&&(t=t.join(this.MODIFIER_DELIMETER));var n=this._getClassName(e,t),s=this._queryByElementName(e);return!!s&&i(s,n)},_addModifier:function(e,i){r.isArray(i)&&(i=i.join(this.MODIFIER_DELIMETER));var n=this._getClassName(e,i),s=this._queryByElementName(e);s&&t(s,n)},_removeModifier:function(e,t){var i,s=this._queryByElementName(e);r.isArray(t)&&(t=t.join(this.MODIFIER_DELIMETER)),i=this._getClassName(e,t),s&&n(s,i)},_toggleModifier:function(e,t){r.isArray(t)&&(t=t.join(this.MODIFIER_DELIMETER));var i=this._getClassName(e,t),n=this._queryByElementName(e);n&&s(n,i)},_setDataAttribute:function(e,t,i){e.setAttribute("data-"+t,i)},_removeDataAttribute:function(e,t){e.removeAttribute("data-"+t)},_formatTimestamp:function(e){var t,i;return uvpjs.util.isEmpty(e)||e===1/0?this.NULL_TIME:(isNaN(e)&&(e=0),(t=new Date(null)).setSeconds(Math.round(e)),i=t.toISOString(),e>=3600?i.substr(11,8):i.substr(14,5))},_formatTimestampByType:function(e,t){if(void 0===t||t<0){if(e===this.css.TIME_DURATION)return this.NULL_TIME;if(e===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(t)},_addCSSRule:function(e,t,i){var n=this._styleEl.sheet,s=n.cssRules.length,a=this._cssRules[e];if(!r.isUndefined(a)){var o=n.rules||n.cssRules;if(o.length>0&&o[a])return void(o[a].style[t]=i)}this._cssRules[e]=s,uvpjs.util.addCSSRule(this._styleEl,e,t,i)},_setStyleSheet:function(e){var t=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(i){this._styleEl=i,t||"function"!=typeof e||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),t=!0,e())}.bind(this))},_templateToHTML:function(e){if(r.isArray(e)&&!r.isEmpty(e)){var t=function(e){return this._getClassName(this.css[e])}.bind(this),i={button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},n=this._isIOS;return function e(s){var a="";return r(s).each(function(s){s&&("CLOSED_CAPTION_BTN"!==s.el&&"SETTINGS_BTN"!==s.el||!n)&&(s.cls=r.isUndefined(s.cls)?t(s.el):[s.cls,t(s.el)].join(" "),s.children&&(s.children=e(s.children)),a+=r.template(i[s.type],{variable:"o"})(s))}),a}(e)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(e){return!!this._touchStartTime&&e-this._touchStartTime<this.TAP_THRESHOLD}}),i=function(e,t){return!r.isNull(e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)")))},t=function(e,t){i(e,t)||(e.className=(e.className+=" "+t).trim())},n=function(e,t){e.className=e.className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)")," ").trim()},s=function(e,s){i(e,s)?n(e,s):t(e,s)}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(e,i,n,s){this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",e),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",i),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",n)),t.isArray(i)?(this.vidContId=e,this._generateAdPods(i,n,s)):this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN")},_generateAdPods:function(e,t,i){var n,s,r,a=t.length,o=function(e,t,i){return{hasBeenChecked:!1,startTime:i||0,hasPlayed:!1,adPodId:e,adCount:0,podDuration:0,adCallURL:t}};for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",e),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",t)),this.adPods={},a>0&&(t.indexOf(0)>-1&&(this.adPods[this.PRE]=o(this.PRE+"_0",i)),t.indexOf(-1)>-1&&(this.adPods[this.POST]=o(this.POST+"_0",i))),n=0;n<a;n++)s=0===t[0]?n:n+1,r=t[n],isNaN(r)||0===r||-1===r||(this.adPods[this.MID_+s]=o(this.MID_+s,i,r));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",e),t.isString(e)){var i=this.adPods[e];return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",i),i}},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var e=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",e),e},getMidRollPods:function(){var e,t=[];if(!this.midRollPods){for(e in t=[],this.adPods)e.indexOf(this.MID)>=0&&t.push(this.adPods[e]);this.midRollPods=t}return this.midRollPods},isPreRoll:function(e){return!t.isUndefined(e.adPodId)&&e.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(e){return!t.isUndefined(e.adPodId)&&e.adPodId.indexOf(this.MID)>-1},isPostRoll:function(e){return!t.isUndefined(e.adPodId)&&e.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){for(var e in this.adPods)if(e.indexOf(this.MID)>-1)return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(e){var t,i,n,s=null,r="No eligible ad pod found.";for(n in this.adPods)this.adPods.hasOwnProperty(n)&&(t=this.adPods[n],this.isPreRoll(t)||this.isPostRoll(t)||t.startTime<=e&&(s?e-t.startTime<e-s.startTime&&(s=t):s=t));return s&&(i=s.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",r="Found Ad pod; adPodId = "+s.adPodId+"; "+i),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+e+";  "+r),s}})}(uvpjs.register("uvpjs")),function(e){var t,n=e._;e.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",DATAZOOM_MODULE_NAME:"Datazoom",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},_hasAgentInit:!1,init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this.resourceStartTime=0,this.contextMetadata={},this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,e&&this.initialize(e.vidContId,e.cviMgr)},destroy:function(){for(var e,t=this.agents.length;t--;)this.agents[t]&&"function"==typeof this.agents[t].destroy&&this.agents[t].destroy(),this.agents.splice(t,1);for(e in this.eventCBs)this.eventsMgr.removeEventListener(e+this.internalNS+".agent"),delete this.eventsMgr[e];for(e in this.progressEvents)delete this.progressEvents[e];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this.contextMetadata=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),n.isString(e)&&n.isObject(t)&&(this.vidContId=e,this.eventsMgr=t.getEventsMgr(),this.cviModel=t.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._addTrackingEventListeners())},hasTrackingConfigOverrides:function(e){return null!==e&&e.hasOwnProperty("trackingConfigOverrides")&&null!==e.trackingConfigOverrides},getAgentConfig:function(e,t){for(var i=null,n=e.length;n-- >0;){var s=e[n];if(s.name===t){i=s;break}}return i},_overrideUvpc:function(){var e=this.cviModel;if(this.hasTrackingConfigOverrides(e)){for(var t=e.getModules().slice(0),i=t.length;i-- >0;){var n=t[i],s=this.getAgentConfig(e.trackingConfigOverrides,n.name);null!==s&&(t[i]=s)}this.agentConfigs=t}else this.agentConfigs=e.getModules().slice(0)},isTrackingAgentEnabled:function(e){var t,i=this.getAgentConfig(this.agentConfigs,e),n=this.mc.systemInfo.trackingAvailability,s=!1;for(t in uvpjs.tracking)if(uvpjs.tracking[t]===e&&n[t]){s=!0;break}return this.debug&&i&&i.enabled&&!s&&uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",i,n),null!==i&&i.enabled&&s},_createAgentsArray:function(e){var t,i,n,s,r,a,o;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),i=e||this.cviModel,this.debug&&uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),s=i.isModuleEnabled.bind(i),r=i.isModuleSet.bind(i),o=this.getPlayerName(),n={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr,playerName:o,playerVersion:this.PLAYER_VERSION_ONLY},this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),n.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,t=new uvpjs.AdobeHeartbeatAgent(n),this.agents.push(t)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),n.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,t=new uvpjs.AkamaiAnalyticsAgent(n),this.agents.push(t)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),n.moduleName=this.COMSCORE_SS_MODULE_NAME,n.playerName=this.getPlayerName("|","_"),t=new uvpjs.ComScoreAgent(n),this.agents.push(t)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),n.moduleName=this.CONVIVA_MODULE_NAME,t=new uvpjs.ConvivaAgent(n),this.agents.push(t)),((a=s(this.DW_MODULE_NAME))||s(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),n.moduleName=a?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,n.playerName=this.getPlayerName(";"),t=new uvpjs.DWAgent(n),this.agents.push(t)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),n.moduleName=this.NIELSEN_MODULE_NAME,t=new uvpjs.NielsenAgent(n),this.agents.push(t)),r(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME))this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC");else{this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent");var l=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME);n.moduleName=this.MUX_MODULE_NAME,n.playerName=this.PLAYER_NAME_ONLY,n.playerVersion=this.PLAYER_VERSION_ONLY,n.useDefaultProperty=!l("propertyKey"),t=new uvpjs.MuxAgent(n),this.agents.push(t)}var d=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(d&&d.params&&d.params.length>0)for(var u=d.params.length;u-- >0;)this.beaconEndPoint[d.params[u].name]=d.params[u].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(n.moduleName=this.OZTAM_MODULE_NAME,t=new uvpjs.OzTamAgent(n),this.agents.push(t));var c=this.getAgentConfig(this.agentConfigs,this.DATAZOOM_MODULE_NAME);c&&c.enabled&&(n.moduleName=this.DATAZOOM_MODULE_NAME,t=new uvpjs.DatazoomAgent(n),this.agents.push(t))},_addTrackingEventListeners:function(){var e=this.eventsMgr,t=e.eventTypes,i=this.internalNS;e.addEventListener(t.CONTEXT_METADATA+i,this._onContextMetadata.bind(this)),e.addEventListener(t.VIDEO_STATE_CHANGE+i,this._onVideoStateChange.bind(this)),e.addEventListener(t.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),e.addEventListener(t.RESOURCE_START+i,this._onResourceStart.bind(this)),e.addEventListener(t.PLAYBACK_DURATION_RESUME+i,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var e=this.eventsMgr,t=e.eventTypes,i=this.internalNS;e.removeEventListener(t.VIDEO_PROGRESS+i),e.removeEventListener(t.AD_QUARTILE+i),e.removeEventListener(t.RESOURCE_START+i)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),n.isEmpty(this.agents))this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled.");else{for(var e=this.agents.length;e--;)this.agents[e].initialize();this._addAgentEventListeners()}},fireTrackingPixel:function(e){var t=document.createElement("img");t.setAttribute("src",e),t.setAttribute("width","1"),t.setAttribute("height","1"),t.setAttribute("border","0"),t.style.position="absolute",t.style.bottom="0",t.style.right="0",this._beaconElement.appendChild(t)},registerEventCallbacks:function(e){if(n.isPlainObject(e)&&!n.isEmpty(e))for(var t in e)this.eventCBs[t]=this.eventCBs[t]||[],this.eventCBs[t].push(e[t])},registerProgressEvents:function(e){if(n.isPlainObject(e)&&!n.isEmpty(e))for(var t in e)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",t),this.progressEvents[t]=this.progressEvents[t]||[],this.progressEvents[t].push(e[t])},getContentPlayhead:function(){var e=this.cviModel.contentPlaybackState.currentTime;return parseInt(e)},getPlayerName:function(e,t){var i=this.PLAYER_NAME;return n.isEmpty(i)?"UVPJS":(e&&(i=i.replace("_",e)),t&&(i=i.replace(/\./g,t)),i)},getAdLength:function(){return this._adLength=t(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=t(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var e in this.eventCBs)this.eventsMgr.addEventListener(e+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(e){if(e.target===this.vidContId){var t,i=this.eventCBs[e.type];if(!n.isEmpty(i)){t=i.length;for(var s=0;s<t;s++)i[s](e)}}},_onContextMetadata:function(e){this.contextMetadata=e.payload.contextMetadata},_onVideoStateChange:function(e){if(e.payload.newState===this.mc.LOADING&&!this._hasAgentInit){var t,i=this.cviModel.cviMgr.RPM.currRP,n=this.cviModel.cviMgr.RPM.rscProviders;i&&i.rco&&i.rco.uvpc?t=i.rco.uvpc:n&&n.length>0&&(t=n[0].rco.uvpc),t&&t.modules&&this.cviModel.copyModules(t.modules),this._overrideUvpc(),this._createAgentsArray(),this._initializeAgents(),this._hasAgentInit=!0}},_onResourceStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",e),this.resourceStartTime=new Date,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(e){var t,s=this.progressEvents[e];if(!n.isEmpty(s))for(t=s.length,i=0;i<t;i++)s[i]()},_onPlaybackDurationResume:function(t){var i=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),n=this.cviModel.getContentVideoState(),s={ts:Math.floor(Date.now()/1e3),contentid:n.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:i("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:n.isPaidContent,affiliate:n.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},r=(new e.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(s).devMode(this.debug).buildUrl();this.fireTrackingPixel(r)},_onVideoProgress:function(e){var t,i=e.payload,s=Math.floor(i.currentTime),r=i.duration;if(s&&r&&!i.isAd&&!(this._lastContentSecondCompleted>=s)){if(this._lastContentSecondCompleted=s,s%15==0&&s<=60||s%60==0){if(this._contentTimeFired[s])return;this._contentTimeFired[s]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",s),this._onProgressEvent(this.progressEvents.TIMED)}i.isPlayingLive||r<=10||((t=Math.floor(s/r*100))!==this.percentDone&&(this.percentDone=t),n.inRange(t,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),n.inRange(t,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),t>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),t=function(e,t){var i=t>0?Math.floor(1e3*t):0;return uvpjs.util.inRange(e,i-1e3,i+1e3)?e:i}}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").TrackingAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,vo:null,sdkEvent:null,hasSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,isSeekDone:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(e){this.options=e,this.initTime=new Date,this.contextMetadata=e.trackingMgr.contextMetadata||{}},initialize:function(){var e=this.options.eventsMgr.eventTypes,t={};t[e.RESOURCE_START]=this.onResourceStart.bind(this),t[e.CONTENT_START]=this.onContentStart.bind(this),t[e.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),t[e.CONTROL_SEEK]=this.onSeekStart.bind(this),t[e.SEEK_DONE]=this.onSeekDone.bind(this),t[e.RESOURCE_END]=this.onResourceEnd.bind(this),t[e.CONTEXT_METADATA]=this.onContextMetadata.bind(this),t[e.CDN_UPDATED]=this.onCdnUpdated.bind(this),t[e.AD_POD_START]=this.onAdPodStart.bind(this),t[e.AD_POD_END]=this.onAdPodEnd.bind(this),t[e.AD_START]=this.onAdStart.bind(this),t[e.AD_CLICK]=this.onAdClick.bind(this),t[e.AD_END]=this.onAdEnd.bind(this),t[e.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),t[e.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),t[e.USER_GESTURE]=this.onUserGesture.bind(this),t[e.FORCE_TRACK_SESSION_END]=this.onForceTrackSessionEnd.bind(this),this.options.trackingMgr.registerEventCallbacks(t),(t={})[(e=this.options.trackingMgr.progressEvents).FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.FIRST_QUARTILE),t[e.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.MID_QUARTILE),t[e.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(t)},onResourceStart:function(e){this.hasResourceStart||(this.sendTrackEvent(this.sdkEvent.SESSION_START,this.vo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(e){this.trackContentStartEvent=!0,this.hasContentStart&&this.isPaused&&(this.sendTrackEvent(this.sdkEvent.PLAY_RESUME),this.isPaused=!1)},onQuartileProgress:function(e){this.sendTrackEvent(e,this.vo.getQuartileInfo())},onVideoStateChange:function(e){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(e.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.sdkEvent.PAUSE));break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.sdkEvent.BUFFER_START));break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.sdkEvent.BUFFER_COMPLETE),this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))}},onSeekStart:function(e){this.sendTrackEvent(this.sdkEvent.SEEK_START,this.vo.getSeekInfo())},onSeekDone:function(e){this.sendTrackEvent(this.sdkEvent.SEEK_COMPLETE,this.vo.getSeekInfo()),this.isSeekDone=!0},onResourceEnd:function(e){this.hasContentStart&&this.vo.isCompletedMarker()&&(this.sendTrackEvent(this.sdkEvent.CONTENT_COMPLETE,this.vo.getContentCompleteInfo()),this.sendTrackEvent(this.sdkEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadata:function(e){this.contextMetadata=e.payload.contextMetadata},onCdnUpdated:function(e){this.sendTrackEvent(this.sdkEvent.CDN_UPDATED,{cdn:e.payload.cdn})},onAdPodStart:function(e){this.sendTrackEvent(this.sdkEvent.AD_BREAK_START,this.vo.getAdBreakInfo())},onAdPodEnd:function(e){this.sendTrackEvent(this.sdkEvent.AD_BREAK_COMPLETE)},onAdStart:function(e){this.sendTrackEvent(this.sdkEvent.AD_START,this.vo.getAdItemInfo())},onAdClick:function(e){this.sendTrackEvent(this.sdkEvent.AD_CLICK)},onAdEnd:function(e){this.sendTrackEvent(this.sdkEvent.AD_COMPLETE)},onVideoTransition:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"bitrate",e.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(e){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.sdkEvent.QOS,this.vo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.hasContentStart||(this.sendTrackEvent(this.sdkEvent.CONTENT_START,this.vo.getContentStartInfo()),this.hasContentStart=!0)),this.isSeekDone&&(this.isSeekDone=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))},onUserGesture:function(e){e.payload.startTime>0&&(this.options.resumeTime=e.payload.startTime)},onForceTrackSessionEnd:function(e){this.onResourceEnd(e)},destroy:function(){this.vo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.vo=null,this.contextMetadata=null}}),function(e){"use strict";var t,i,n,s,r,a;a=e._,e.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",SEGMENT_OWNER_PARAM_NAME:"id3SegmentOwner",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",LIVE_CONTENT_LENGTH:86400,init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this._playerName=e.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this._segmentOwner=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata=this.trackingMgr.contextMetadata||{},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._startUpTime=0,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._segmentOwner=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),a.isUndefined(this._visitorData.marketingCloudOrgId)?this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."):this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(e,t){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),a.isFunction(e)){i=t?t.sessionOptions:this.cviModel.sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,e()}.bind(this),this._usesTealium=i.usesTealium;var n=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];if(this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),n=a.without(n,this.scriptPaths.APP_MEASUREMENT)),s()&&!this.isPluginLoaded)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(n,this.pluginLoadedCB);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB()}else this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!")},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var e=this._qosObject;return t.createQoSObject(e.bitrate,e.startupTime,e.fps,e.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var e=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),t=e(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),i=e(this.TRACKING_SERVER_PARAM_NAME);this._segmentOwner=e(this.SEGMENT_OWNER_PARAM_NAME),this.mc.isSecure()&&(a.isString(i)&&0!==i.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(i=this.TRACKING_SERVER_SSL_PREFIX+i),a.isString(t)&&(t=t.replace("heartbeats.omtrdc.net","cbsinteractive.hb.omtrdc.net"))),this._appMeasurementData={account:e(this.ACCOUNT_PARAM_NAME),charSet:e(this.CHAR_SET_PARAM_NAME),trackingServer:i},this._heartbeatData={publisher:e(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:t},this._visitorData={marketingCloudOrgId:e(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:i},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var e=this.cviModel.sessionOptions;this._usesTealium=e.usesTealium,a.each({ftag:"ftag",netwk:"Network"},function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",t,i);var n=e[i];a.isNull(n)||a.isUndefined(n)||a.isEmpty(n)||(this._sessionMetadata[t]=n)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.AD_POD_START]=this._onAdPodStart.bind(this),t[e.AD_POD_END]=this._onAdPodEnd.bind(this),t[e.AD_CLICK]=this._onAdClick.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.CONTROL_SEEK]=this._onControlSeek.bind(this),t[e.SEEK_DONE]=this._onSeekDone.bind(this),t[e.RESOURCE_END]=this._onResourceEnd.bind(this),t[e.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),t[e.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),t[e.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),t[e.PLAYER_LOADED]=this._updateVideoInfo.bind(this),t[e.RESOURCE_START]=this._updateVideoInfo.bind(this),t[e.VIDEO_RESUME]=this._updateVideoInfo.bind(this),t[e.VIDEO_DONE]=this._updateVideoInfo.bind(this),t[e.VIDEO_CUEPOINT]=this._onVideoCuePoint.bind(this),this._contextMetadataCBSetup||(t[e.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(t)},_setupContextMetadataEventCallback:function(){var e={};e[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e),this._contextMetadataCBSetup=!0},_initializePlugin:function(){function e(e){this._agent=e}var o,l,d,u;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),s())this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded.");else if(this._mediaHeartbeat)this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used.");else{if(t=ADB.va.MediaHeartbeat,i=ADB.va.MediaHeartbeatConfig,n=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!r(this._s)&&!this._waitForTealium)return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)l=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(o=this._appMeasurementData.account,a.isString(o)&&a.isEmpty(o))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));(u=new Visitor(this._visitorData.marketingCloudOrgId)).trackingServer=this._visitorData.trackingServer,u.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),(l=new AppMeasurement(o)).visitor=u,l.account=o,l.trackingServer=this._appMeasurementData.trackingServer,l.pageName=this._appMeasurementData.pageName,l.charSet=this._appMeasurementData.charSet,l.visitorID=this._appMeasurementData.visitorID}a.isNull(l)?this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."):((d=new i).trackingServer=this._heartbeatData.trackingServer,d.playerName=this._playerName,d.channel=this._heartbeatData.channel,d.debugLogging=this._heartbeatDebug,d.appVersion=this.SDK_VERSION,d.ssl=this.mc.isSecure(),d.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",d),a.extend(e.prototype,n.prototype),e.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},e.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new t(new e(this),d,l),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad())}},_getTealium:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),r(this._s)||this._waitForTealium?void(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.")):(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),a.has(window,"s")&&r(window.s)?(this._s=window.s,this._waitForTealium=!0,void this._initializePlugin()):(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL)))},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(e,i){if(a.isNull(this._mediaHeartbeat))this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined");else switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",e),e){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(t.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(t.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(t.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(t.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(t.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(t.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(t.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(i)}},_getContentVideoMetadata:function(){var e,t,i=this.cviModel.getContentVideoState(),n=this._contextMetadata,s=this._sessionMetadata,r={};for(e in n)n.hasOwnProperty(e)&&(r[e]=n[e]);for(e in s)s.hasOwnProperty(e)&&(r[e]=s[e]);if(i.contextMetadata)for(e in t=i.contextMetadata)t.hasOwnProperty(e)&&(r[e]=t[e]);return r.tl=i.videoTitle,r.mediaAutoPlay=this.cviModel.isAutoplay.toString(),r.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),r.mediaIsPaidContent=i.isPaidContent.toString(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",r),r},_onContextMetadata:function(e){var t,i=e.payload.contextMetadata;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",e),!a.isEmpty(i)&&(this._contextMetadata=i,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),a.isEmpty(i[this.PAGE_REPORT_SUITE_ID_KEY]),t=i[this.PAGE_SITE_ACCOUNT_KEY],!a.isEmpty(t))){var n=a.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=t,n&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+t),this._initializePlugin())}},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat,this._startUpTime),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:this._startUpTime,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(e){var i,n,s,r,a,o=e.chapterStartTimes,l=o&&o.length||0,d=parseInt(e.currentContentSegment);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",e),isNaN(d)&&(d=1),n=(i=d<0?0:d-1)<=0?0:o[i],a=(s=i+1>l?e.duration:o[i+1])-n,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",s,n),(r={}).name="",r.length=isNaN(a)?0:a,r.position=d,r.startTime=o[i],this._chapterObject=t.createChapterObject(r.name,r.position,r.length,r.startTime),this._chapterInfo=r,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(e){var i,n,s,r,o,l;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",e),"pre"===(r=(o=(l=e.payload.adData).adClipID.split("_"))[0])?s=1:"mid"===r?s=parseInt(o[1])+1:"post"===r&&(s=this.cviModel.getNumberOfAdPods()),(n={}).name=a.isEmpty(l.adVideoTitle)?"na":l.adVideoTitle,n.position=s,n.playerName=this._playerName,n.startTime=this.getCurrentPlaybackTime(),(i={}).id=a.isEmpty(l.adVideoId)?a.isEmpty(l.adVatId)?"na":l.adVatId:l.adVideoId,i.name=n.name,i.length=l.duration,i.position=l.adPosition,this._adObject=t.createAdObject(i.name,i.id,i.position,i.length),this._adBreakObject=t.createAdBreakObject(n.name,n.position,n.startTime),this._adInfo=i,this._adBreakInfo=n,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(e){var t=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(t)},_onAdClick:function(e){var t=!0===e.payload.adData.paused;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),t&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(e){var t=e.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",t),this._contentStarted=!0,this._startUpTime=Math.abs(new Date-this.trackingMgr.resourceStartTime)/1e3,this._sendInitialPlay(),t.chapterStartTimes.length>0&&(this._setChapterInfo(t),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(e){var t=e.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",t),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&t.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(e){var t=this._videoInfo,i=this._contentStarted&&t&&Math.ceil(t.playhead)>=.95*t.length,n=this.cviModel.getContentVideoState().isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",i),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,!n&&i&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(e){var t=e.payload.newState,i=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",t),this._videoLoaded&&(this._isBuffering||t!==this.mc.BUFFERING?this._isBuffering&&t!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),t===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),i&&t===this.mc.PAUSED&&this._onControlPause(e))},_updateVideoInfo:function(){var e,i=this.cviModel.getCurrentPlaybackState(),n=this.cviModel.getContentVideoState(),s=t.StreamType,r=n.duration,o=n.isLive,l=n.episodeFlag,d={};a.isEmpty(n.cmsRefGuid)?a.isEmpty(n.mediaId)?a.isEmpty(n.pid)?a.isEmpty(n.assetURL)?d.id="na":d.id=n.assetURL:d.id=n.pid:d.id=n.mediaId:d.id=n.cmsRefGuid,d.name=n.videoTitle,d.playerName=this._playerName,d.length=o?this.LIVE_CONTENT_LENGTH:isNaN(r)?0:r,d.playhead=i.currentTime,o?e=s.LIVE:(e=s.VOD,e+=":"+(l?this.FULL_EPISODES:this.CLIPS)),d.streamType=e,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",t),this._mediaObject=t.createMediaObject(d.name,d.id,d.length,d.streamType),this._videoInfo=d,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(e){var t=e&&e.facadeState,i=this._qosObject;t&&i&&(i.bitrate=t.currentBitrate||0,i.droppedFrames=t.droppedFrames||0,i.fps=t.playbackFramerate||0)},_updatePlayhead:function(e){var t=e.payload;this._videoInfo&&t&&(t.isAd||(this._updateQosObj(t),this._videoInfo.playhead=t.currentTime))},_sendInitialPlay:function(){!this._videoLoaded&&this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)},_onVideoCuePoint:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoCuePoint",e),this._isSegmentOwner(e.payload)){var t=e.payload.data;(t=t.split("|")).length>0&&this._segmentStart({segmentId:t[0],segmentTitle:t[1]})}},_segmentStart:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _segmentStart",e),e.segmentId){this._mediaHeartbeat.trackComplete(),this._mediaHeartbeat.trackSessionEnd(),this._mediaObject.data["a.videoId"]=e.segmentId,this._mediaObject.data["a.name"]=e.segmentTitle;var t=this._getContentVideoMetadata();t.tl=e.segmentTitle,this._mediaHeartbeat.trackSessionStart(this._mediaObject,t),this._mediaHeartbeat.trackPlay()}},_isSegmentOwner:function(e){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _isOwner",this._segmentOwner),e.data&&e.data.indexOf("|")>-1&&e.name===this._segmentOwner}}),s=function(){return"undefined"==typeof ADB||"undefined"===a.get(ADB,"va.Heartbeat")},r=function(e){return a.isObject(e)&&!a.isEmpty(e)&&a.isFunction(e.isReadyToTrack)}}(uvpjs.register("uvpjs")),function(e){var t,i=e._,n=function(e){return(e>0&&e<10?"0":"")+e.toString()},s="*null",r={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"};e.ComScoreAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this._playerName=e.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var e=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:e("c2")||"3005086",ns_st_pu:e("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.RESOURCE_START]=this._onResourceStart.bind(this),t[e.RESOURCE_END]=this._onResourceEnd.bind(this),t[e.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),t[e.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),t[e.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),t[e.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(t)},_initializePlugin:function(){t()?this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."):this._setupEventCallbacks()},_createStreamingTag:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",e),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(e)},_getContentMetadata:function(){var e,t,i=this.cviModel.getContentVideoState(),a=(this.cviModel.getContentPlaybackState(),uvpjs.util),o=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),l=this.cviModel.getContentVideoState().isLive,d=parseInt(i.episodeNumber),u=parseInt(i.seasonNumber),c=(i.seriesTitle,i.videoTitle),h=c&&c.split("-")[1],p=!isNaN(d),f=!isNaN(u),v=null!==i.contextMetadata&&i.contextMetadata.comscore_c4,g=c;p&&f&&(e=n(d),g+="--"+(t=n(u))+e);var _={ns_st_ci:a.getDefinedString(i.cmsRefGuid,i.mediaId,"0"),ns_st_cl:l?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[r.publisherBrand],ns_st_pr:a.getDefinedString(i.seriesTitle,i.videoTitle),ns_st_ep:h,ns_st_sn:f&&t||s,ns_st_en:p&&e||s,ns_st_ge:i.category||s,ns_st_ia:l?1:0,ns_st_ddt:s,ns_st_tdt:s,ns_st_st:o("c4")||s,ns_st_ce:i.episodeFlag?1:0,c3:o("c3")||this._playerName,c4:v||o("c4")||s,c6:o("c6")||g};return["ns_st_ge","ns_st_st","ns_st_pu","ns_ap_an","ns_st_ddt","ns_st_tdt"].forEach(function(e){var t=o(e);t&&(_[e]=t)}),_},_onAdStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",e),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",e),this._isAd=!1,this._trackStop()},_onContentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",e);var t=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?t.Live:t.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",e),this._trackStop()},_onControlPlay:function(e){return this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",e),this.streamingTag?this._isAd?void this._trackAdPlay():void this._trackContentPlay():void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized"))},_onControlPause:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",e),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",e),this.streamingTag=null},_onLiveSegmentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",e),this._isLiveEvent(e)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=e.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",e),this._trackStop()},_onVideoProgress:function(e){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_onVideoStateChange:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",e);var t=e.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(t===this._mc.PAUSED?this._onControlPause(e):t===this._mc.PLAYING&&this._onControlPlay(e))},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=e.util.copyObjectWithKeyMap(r).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(e){return this.cviModel.getContentVideoState().isLive&&e.payload&&e.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof e.payload.liveSegmentData},_isSameLiveStation:function(e){return e.stationTitle===this._contentMetadata[r.stationTitle]},_getAdType:function(){var e,t=ns_.ReducedRequirementsStreamingAnalytics.AdType,i=this.cviModel.getAdVideoState().adClipID.split("_")[0];return e="pre"===i?t.LinearOnDemandPreRoll:"mid"===i?t.LinearOnDemandMidRoll:t.LinearOnDemandPostRoll,this.cviModel.getContentVideoState().isLive&&(e=t.LinearLive),e}}),t=function(){return"undefined"==typeof ns_||i.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)}}(uvpjs.register("uvpjs")),function(e){"use strict";e.ConvivaAgent=uvpjs.Class.subClass({init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",e),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventTypes=e.eventsMgr&&e.eventsMgr.eventTypes||null,this.moduleName=e.moduleName,this.playerName=e.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null,this.contextMetadata=this.trackingMgr.contextMetadata||{}},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null,this.contextMetadata=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){if(void 0!==window.Conviva){var e=this.eventTypes,t=this.adEventHandlerMap={};t[e.AD_POD_START]=this.hPodStart.bind(this),t[e.AD_POD_END]=this.hPodEnd.bind(this),t[e.AD_LOADED]=this.hAdLoaded.bind(this),t[e.AD_START]=this.hAdStart.bind(this),t[e.AD_END]=this.hAdEnd.bind(this),t[e.AD_ERROR]=this.hAdError.bind(this),t[e.AD_BUFFERING]=this.hAdBuffering.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client.")))}else this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded.")},_getAdType:function(e){var t="string"==typeof e?e.toLowerCase():null,i=Conviva.Client.AdPosition,n=uvpjs.ConvivaAgent.adPositions;return t?t.indexOf(n.PRE)>=0?i.PREROLL:t.indexOf(n.MID)>=0?i.MIDROLL:t.indexOf(n.POST)>=0?i.POSTROLL:void 0:i.PREROLL},_getArgsForStartAd:function(e){var t=Conviva.Client.AdStream,i=Conviva.Client.AdPlayer,n="ima"==e.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(e.adType),stream:n?t.SEPARATE:t.CONTENT,player:n?i.SEPARATE:i.CONTENT}},_onAdEvent:function(e){var t=e.type;this.startEvents.content=0,this.hasConvivaSession||t===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[t](e.payload,e)},hPodStart:function(e,t){this.podCount++,this._onContentPaused(t),this.currAdPodInfo=this._buildAdPodInfo(e.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);var i=this._getArgsForStartAd(e);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(i.key,i.stream,i.player,i.pos),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",i),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(e,t){var i=this._buildAdInfo(e);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,i),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(e,t){this.adPodInProgress&&this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(e,t){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(e,t){var i=this.currAdPodInfo||{},n=this.convivaSessionKey;this.adPodInProgress=!1,uvpjs.util.isEmpty(n)||n===Conviva.Client.NO_SESSION_KEY?this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",i),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(e,t){var i=e.errorInfo;this.hasConvivaAdSession?(this._sendError(i.errorCode,Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",i)):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",i)},hAdBuffering:function(e,t){this.hasConvivaAdSession?(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_BUFFERING")):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad buffering - no session key")},_onContentEvent:function(e){var t=!1;this.startEvents.ad=0,e.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),!this.hasConvivaSession&&this._createConvivaSession(),t=!0):e.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,t=!0,this.hasContentStarted=!0,this._killConvivaAdSession()),t&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(e){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlaying:function(e){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING)},_onContentBuffering:function(e){!this.isSeekPending&&this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(e){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",e),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*e.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(e){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",e),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(e){this.isSeekDone&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",e),this._onContentPlaying(e),this.isSeekDone=!1)},_onVideoEvent:function(e){var t=this.eventTypes;switch(e.type){case t.VIDEO_STATE_CHANGE:var i=e.payload.newState,n=this._getMediaCapabilities();this.hasConvivaAdSession?i===n.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(e):i===n.PAUSED&&this._onAdPaused(e):this.hasConvivaSession&&(i===n.PLAYING?this._onContentPlaying(e):i===n.PAUSED?this._onContentPaused(e):i===n.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(e));break;case t.VIDEO_TRANSITION_COMPLETE:case t.VIDEO_DONE:this._onVideoTransition(e);break;case t.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(e){var t=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY,i=new Conviva.ContentMetadata;i.defaultResource=this._validateStr(e.payload.cdn,""),this.convivaClient.updateContentMetadata(t,i)},_onError:function(e){var t=e.payload.errorInfo;t.isFatal?(!this.hasConvivaSession&&this._createConvivaSession(),this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(e){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",e),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(e){var t=e.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(t>0&&(t*=.001),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",t),this.convivaPlayerStateManager.setBitrateKbps(t))},_onContextMetadata:function(e){this.contextMetadata=e.payload.contextMetadata||{}},_createConvivaSession:function(){if(this.convivaClient){var e=this.cviModel,t=(this._getMediaCapabilities(),Conviva.PlayerStateManager.PlayerState,{userId:e.getSessionOption("userId"),userPPID:e.getSessionOption("userPPID"),userStatus:e.getSessionOption("userStatus")}),i=new Conviva.ContentMetadata;this._setContentMetadata(i,t),this.convivaSessionKey=this.convivaClient.createSession(i),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")}},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(e,t){var i=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",e,t),this.convivaClient&&this.convivaClient.sendCustomEvent(i,e,t)},_sendError:function(e,t,i){if(this.hasConvivaSession){var n="";e=uvpjs.mapErrorCode(e).toString(),!0===i?(n=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,e,t)):this.convivaPlayerStateManager.sendError(e,t),this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+n+" ERROR: "+e)}},_setConvivaPlayerState:function(e){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",e),this.convivaPlayerStateManager.setPlayerState(e))},_setContentMetadata:function(e,t){var i=this.cviModel,n=Conviva.ContentMetadata.StreamType,s=i.contentVideoState,r=s.defaultBitrate;e.applicationName=this.playerName,e.assetName=this._validateStr(s.videoTitle,"N/A"),e.defaultBitrateKbps=r&&r>0?r:700,e.defaultResource=this._validateStr(s.cdn,""),e.duration=s.duration,e.streamType=s.isLive?n.LIVE:n.VOD,e.streamUrl=this._validateStr(s.assetURL,"N/A"),e.viewerId=this._validateStr(t.userId,"N/A"),e.custom={accessType:this._validateStr(t.userStatus,"anon"),contentId:this._validateStr(s.cmsRefGuid,"N/A"),contentType:s.isLive?"Live":"VOD",isEpisode:s.episodeFlag?"true":"false",Partner_ID:this._validateStr(i.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(s.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._getEpisodeTitle(s),appRegion:this._validateStr(i.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:s.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(s.drm),showId:this.contextMetadata.showId&&this._validateStr(this.contextMetadata.showId.toString(),""),connectionType:this._validateStr(i.sessionOptions.userConnectionType,"unknown")}},_getEpisodeTitle:function(e){if(e.isLive)return e.videoTitle||e.episodeTitle;var t=this._validateStr(e.episodeTitle,e.videoTitle);return t.search(/\w+.*-.*\w+/)>-1&&(t=t.split("-")[1]),t.replace(/^\s+|\s+$/g,"")},_getWinDimension:function(){var e=this.cviModel.contentVideoState.sourceWidth,t=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(e=window.screen.width),window.screen.height&&(t=window.screen.height)),e+"x"+t},_createConvivaClient:function(){var e=this._getConvivaClientSettings();return e?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(e,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var e,t=this.moduleParams;return this._isValidStr(t.customerKey)&&this._isValidStr(t.serviceUrl)?((e=new Conviva.ClientSettings(t.customerKey)).heartbeatInterval=t.heartbeatInterval||this.defaultHeartbeatInterval,e.gatewayUrl=t.serviceUrl,e):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(e){var t="development"===uvpjs.Configuration.env,i=Conviva.SystemSettings.LogLevel;e.allowUncaughtExceptions=t,e.logLevel=t?i.WARNING:i.NONE},_createConvivaSystemFactory:function(){var e=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),t=new Conviva.SystemSettings;return this._setConvivaSystemProps(t),new Conviva.SystemFactory(e,t)},_buildAdPodInfo:function(e){var t,i,n,s={};return uvpjs.ConvivaAgent.adPositions,e?(void 0!==e.podDuration&&(s.podDuration=String(e.podDuration)),e.adPodId?(i=(t=e.adPodId.split("_")[0].toLowerCase()).charAt(0).toUpperCase()+t.slice(1),n=String(e.imaPodIndex+1),s.podPosition=i+"-roll",s.podIndex=this.podCount,s.absoluteIndex=n,s):s):null},_buildAdInfo:function(e){var t=new Conviva.ContentMetadata,i=e.adData,n=e.imaAdData||{},s=this.cviModel.getSessionOption("partner");if(!e)return null;t.adTitle="("+i.adVideoId+")"+i.adVideoTitle,t.assetName=t.adTitle,t.adClipId=this._validateStr(i.adClipID,"N/A"),t.Partner_ID=this._validateStr(s,"N/A"),t.adServerName=this._validateStr(i.adServerName,"N/A"),t.streamUrl=this._validateStr(i.adAssetUrl,"N/A"),t.duration=i.duration,t.streamType=Conviva.ContentMetadata.StreamType.VOD;var r=i.adType;return t.custom={"c3.ad.technology":"Client Side","c3.ad.id":n.adId||i.adVideoId,"c3.ad.system":n.adSystem||i.adServerName,"c3.ad.position":r.charAt(0).toUpperCase()+r.substr(1)+"roll","c3.ad.mediaFileApiFramework":n.apiFramework,"c3.ad.sequence":n.adPodInfo?n.adPodInfo.adPosition:i.adPosition,"c3.ad.creativeId":n.creativeId||i.creativeId,"c3.ad.advertiser":n.advertiserName},this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",t),t},_isValidStr:function(e){return uvpjs.util.isDefinedString(e)},_validateStr:function(e,t){return this._isValidStr(e)?e:t},_isDynamicStreaming:function(e){var t=e.split("?");return"mp4"===t[0].substr(t[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var e,t=this.cviModel.getModule(this.moduleName).params,i=t.length,n={};i--;)n[(e=t[i]).name]=e.value;this.moduleParams=n},_setupEventCallbacks:function(){var e=this.eventTypes,t={},i=this._onAdEvent.bind(this),n=this._onContentEvent.bind(this),s=this._onVideoEvent.bind(this),r=this._onError.bind(this);t[e.AD_POD_START]=i,t[e.AD_LOADED]=i,t[e.AD_START]=i,t[e.AD_END]=i,t[e.AD_POD_END]=i,t[e.AD_ERROR]=i,t[e.AD_BUFFERING]=i,t[e.CONTENT_DATA_LOADED]=n,t[e.CONTENT_START]=n,t[e.CONTENT_END]=n,t[e.VIDEO_STATE_CHANGE]=s,t[e.VIDEO_TRANSITION_COMPLETE]=s,t[e.VIDEO_DONE]=s,t[e.RESOURCE_END]=s,t[e.PLAYER_START_ERROR]=r,t[e.VIDEO_START_ERROR]=r,t[e.VIDEO_PLAYBACK_ERROR]=r,t[e.CDN_UPDATED]=this._onCdnUpdated.bind(this),t[e.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),t[e.CONTROL_SEEK]=this._onControlSeek.bind(this),t[e.SEEK_DONE]=this._onSeekDone.bind(this),t[e.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),t[e.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t),window.addEventListener("beforeunload",function(){this.hasConvivaAdSession&&this._killConvivaAdSession(),this._killConvivaSession()}.bind(this),!1)}}),e.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(e){"use strict";e.NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},adType:{LINEAR:"1",DYNAMIC:"2"},init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",e),this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this._playerName=e.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var e,t,i,n=this.cviModel,s=this._metadata,r=n.sessionOptions.partner,a=n.getModule(this._moduleName).params,o=a.length,l={};for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");o--;)""!==(e=a[o]).value&&(l[e.name]=e.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:l[this.NIELSEN_SFCODE_PARAM_NAME],apid:l[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:l[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},r){case"chow":t="us-700144",i="c06";break;case"tvcom":t="us-200330",i="c03";break;case"cbs":case"can":t="us-700144",i="c01";break;case"cbssports":case"cbssports_test":t="us-201669",i="c02";break;case"news":t="us-700144",i="c03";break;case"gamespot":t="us-200330",i="c13";break;case"cnettv":t="us-200330",i="c05";break;default:t="us-700144",i="c01"}s.ci=l.clientid||t,s.c6=l.vcid||i,s.iag_sid=l.iag_sid,s.iag_tfid=l.iag_tfid,s.channelName=l.channelName,s.segB=l.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",l,s)},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};t[e.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_POD_START]=this._onAdPodStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),t[e.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(t)},_initializePlugin:function(){t()?this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."):(window.NOLBUNDLE&&"function"==typeof window.NOLBUNDLE.nlsQ?this._gg=window.NOLBUNDLE.nlsQ(this._nolggGlobalParams.apid,"_gg"+(new Date).getTime()):(this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams)),this._setupEventCallbacks())},_notifySDK:function(e,t){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",e,t),this._gg.ggPM(e,t))},_onContentDataLoaded:function(e){var t,i,n,s,r,a,o,l,d=uvpjs.mediaCapabilities.isMobile(),u=this._metadata;e.payload&&(n=(t=e.payload.vidState).chapterStartTimes.length>0?"lf":"sf",r=t.episodeNumber,a=t.seasonNumber,o=t.seriesTitle,l=t.videoTitle,i=t.duration,s=[l,a,r,n].join("|"),""===a&&(a="0"),""===r&&(r="0"),t.isAffiliateFeed&&(u.tv="true"),(t.isLive||-1===i)&&(i=this.NIELSEN_LIVE_VIDEO_DURATION),u.pc=u.ci+u.c6+u.cmsRefGuid,u.c10="plt,"+(d?"MBL":"DSK"),u.sd=i,u.dur=i,u.cg=o,u.tl=s,u.videotype="content",u.guid=t.cmsRefGuid,u.seriestitle=o,u.episodetitle=l,u.isfullepisode=t.episodeFlag?"y":"n",u.crossId1=t.mediaId,u.iag_pgm=l,u.iag_epi=s,u.iag_pd=location.hostname,u.iag_fp=n,u.iag_cte="na",u.iag_oad="na",u.iag_seg=1,this._metadata.adloadtype=t.isLive?this.adType.LINEAR:this.adType.DYNAMIC,this._isRcoTypeDai()&&(this._metadata.adloadtype=this.adType.DYNAMIC),this._metadata.adModel=this._metadata.adloadtype,this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",u))},_onAdStart:function(e){var t,i,n,s,r,a,o,l,d,u,c=this.cviModel.getContentVideoState(),h=e.payload;h&&(this._metadata.hasAds=1,this._adDisplayed=!0,u=uvpjs._.clone(this._metadata),s=(i=(t=h.adData).adClipID.split("_"))[0],l=this.cviModel.getNumberOfAdPods(),d="post"===s?l:++i[1],n=["dav0",c.videoTitle,c.seasonNumber,c.episodeNumber].join("-"),o=[l,d,this._numAdsInPod,i[2]].join("_"),r=t.adVatId,a=t.adVideoUrl,""!==r&&(a+="|"+r),u.videotype=s+"roll",u.iag_cte=a,u.iag_pod=o,u.iag_apt="na",u.tl=n,u.c3="st,a","pre"===s&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",u),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,u))},_onAdPodStart:function(e){var t=e.payload;t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",t.adPod.adCount),this._numAdsInPod=t.adPod.adCount)},_onAdEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(e){var t,i=e.payload;if(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),i){if(this._metadata.iag_seg&&this._metadata.iag_seg++,(t=e.payload.contentData).duration>0&&Math.abs(t.duration-this._lastContentSecond)<=5)return void this._notifySDK(this.events.END,this._lastContentSecond);this._notifySDK(this.events.STOP,this._lastContentSecond)}},_onControlPlay:function(e){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(e){var t,i=e.payload;if(i&&!((t=Math.floor(i.currentTime))<0)){if(i.isAd){if(this._lastAdSecond===t)return;this._lastAdSecond=t}else{if(this._lastContentSecond===t)return;this._lastContentSecond=t}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,t)}},_onVideoCuepoint:function(e){var t=e.payload,i=t.data;t.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&i&&"string"==typeof i&&this._notifySDK(this.events.SEND_ID3,i)},_hasAds:function(){var e=this.cviModel.getNumberOfAdPods();return-1===e?2:0===e?0:1},_isDisabled:function(){var e=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===e||!0===e},_isRcoTypeDai:function(){var t=this.cviModel.cviMgr.RPM.currRP;return!(null==t)&&t.rco.type===e.mediaCapabilities.RP_DAI}});var t=function(){return void 0===window.NOLCMB}}(uvpjs.register("uvpjs")),function(e){var t,i,n,s=e._;e.DWAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"//dw.cbsi.com/levt/video/e.gif?",RESUME_BEACON_URL:"//dw.cbsi.com/levt/beacon/e.gif?",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this._playerName=e.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var e=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),e.componentid=this.trackingMgr.componentid,e.device=this._getDevice(),e.mapp=this._playerName,e.part=this.cviModel.getSessionOption("partner"),e.playertime=0,e.siteid=this.trackingMgr.DEFAULT_SITEID,e.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var e=this.cviModel,t=e.getSessionOption("cms"),i=e.getContentVideoState(),n=e.getCurrentPlaybackState(),s=uvpjs.mediaCapabilities,r=this._tags.content,a=this._tags.ad,o=this.trackingMgr;a.adastid=t===o.PLATFORM_CMS?"43":"0",(uvpjs.util.isEmpty(r.medastid)||0===r.medastid||"0"===r.medastid)&&(i.isLive?i.isAffiliateFeed?r.medastid="cbsnews"===e.getSessionOption("playerId")?"601":"600":n.isHDStreamLive||s.isChromecast()?r.medastid="601":r.medastid="0":r.medastid=t===o.PLATFORM_CMS?"595":"0",this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",r.medastid,a.adastid))},_loadConfigParams:function(){for(var e,t,i,n=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),r=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],a=r.length;a--;)t=r[a],e=this._getTagType(t),i=n(t),s.isUndefined(e)||s.isEmpty(i)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",t,i),this._tags[e][t]=i);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var e,t,i,n=window.DW&&window.DW.pageParams||{};for(e in this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams"),n)n.hasOwnProperty(e)&&(i=n[e],s.isEmpty(i)||(this._pageParams[e]=i,t=this._getTagType(e),s.isUndefined(t)||(this._tags[t][e]=i)));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};t[e.AD_BLOCKED]=this._onAdBlocked.bind(this),t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.AD_QUARTILE]=this._onAdQuartile.bind(this),t[e.AD_ERROR]=this._onAdError.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.SEEK_DONE]=this._onSeekDone.bind(this),t[e.USER_GESTURE]=this._onUserGesture.bind(this),t[e.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(t),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var e=this.trackingMgr.progressEvents,t={};t[e.FIRST_QUARTILE]=this._onProgressEvent.bind(this,e.FIRST_QUARTILE),t[e.MID_QUARTILE]=this._onProgressEvent.bind(this,e.MID_QUARTILE),t[e.THIRD_QUARTILE]=this._onProgressEvent.bind(this,e.THIRD_QUARTILE),t[e.TIMED]=this._onProgressEvent.bind(this,e.TIMED),this.trackingMgr.registerProgressEvents(t)},_sendDWEvent:function(e){var t=this._tags.content,s=t.event,r=s===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),t.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:n(this._gestval),s!==this.events.INIT&&(t.playertime=this._getPlayerTime()),t.ts=+new Date,r+=i(t),e&&(r+="&"+i(this._tags.ad)),this.trackingMgr.fireTrackingPixel(r),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",r),this._gestval={},t.gestval="",t.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var e=window.location,t=uvpjs.mediaCapabilities,i=t.isMobile()?"mobile%20web":"desktop%20web",n=this.cviModel.getSessionOption("userStatus"),r=this.cviModel.getSessionOption("userId"),a=this._tags.content,o=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,a.event=this.events.INIT,a.mso=this.trackingMgr.mso,a.pageurl=e.href,a.srchost=e.host,a.ursuid=r,a.v16=o.viewguid,a.v17=o.topic,a.v18=o.topicbrcrm,a.v19=o.pagetype,a.v20=o.assetguid,a.v21=t.isChromecast()?"chromecast":i,a.v23=o.rsid,a.v25=s.isEmpty(n)?"anon":n,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(e){var t=this.trackingMgr.progressEvents,i=this._tags.content,n=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",e),e)switch(e){case t.FIRST_QUARTILE:n.pct=25;break;case t.MID_QUARTILE:n.pct=50;break;case t.THIRD_QUARTILE:n.pct=75}i.event=this.events.PLAY,this._sendDWEvent(),delete n.pct}},_onAdBlocked:function(e){this._tags.ad,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",e),this._setCMSDependentValues(),this._setStartTags(e),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(e){var t=this._tags.ad,i=e.payload.adData,n=i.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",e),this._setCMSDependentValues(),this._setStartTags(e),this._updateTimeTags(),t.adid=s.isEmpty(i.adVideoId)?"999":i.adVideoId,t.adnum=this.cviModel.adNum,t.adtime=0,t.adtitle=i.adVideoTitle,t.adtype=i.isLinear?1:2,t.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),t.adbreak="",t.adpos=n[0],t.adpod=n[1],t.adpodpos=n[2],this._sendDWEvent(!0)},_onAdQuartile:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",e),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(e){var t=e.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",e),this._tags.content.event=this.events.END,this._tags.ad.adtime=t.duration,this._sendDWEvent(!0)},_onAdError:function(e){var t=e.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",e),t===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(e){var t=this.cviModel,i=t.getContentVideoState(),n=this._tags.content,r=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",e),n.event=this.events.START,n.codec=i.fileType,n.distntwrk=t.getSessionOption("netwk"),n.playersz=this._getPlayerSize(),n.sdlvrytype=this._getStreamType(),n.v22=i.cmsRefGuid,n.medid=i.mediaId,n.medlength=this.trackingMgr.getContentLength()/1e3,n.mednum=t.medNum,n.medrls=i.pid,n.medtitle=i.videoTitle,n.contsessid=i.previousSessionId,s.isEmpty(i.contPlayState)||(r.autoplay=i.contPlayState),r.paywall=i.isPaidContent?"1":"0",r.caption_available=i.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",e),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(e),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var e=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(e.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),e.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(e){var t=e&&e.payload,i=t&&t.seekFromTime,n=t&&t.seekToTime,s=n-i,r=this._tags.content;r.eventdur=Math.floor(Math.abs(s)),r.event=s>0?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:i,seekToTime:n,seekDuration:s,event:r.event,eventdur:r.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(e){var t,i,n,r,a,o,l=this._tags.content,d=this._gestval,u=e.payload.gestureInfo,c=this.cviModel.contentVideoState,h=c.elapsedTime,p="",f=uvpjs.Type.Gesture;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",e),"string"!=typeof u||-1!==u.indexOf("event=")){if(s.isArray(u)){if(u.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");p=u[0]}if(c=this.cviModel.contentVideoState,"string"==typeof u)a=(r=/event=([^&]*)(?:&gestval=(.*))?/.exec(u))[1],o=r[2],l.event=a,l.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===o?"":o;else if(p===f.GLOBAL_RESUME||p===f.LOCAL_RESUME)d.prevcomponentid=c.previousSessionId,d.eventdur=h>0?Math.round(h/1e3):0,d.paywall=c.isPaidContent?"1":"0",l.event=this.events.RESUME,l.medtime=c.resumeContentTime;else if(p===f.CONT_CANCEL)d.action=this.events.PROMPT;else switch(l.medtime=this.cviModel.contentPlaybackState.currentTime,p){case f.RELATED_OVERLAY:l.event=f.RELATED_OVERLAY;break;case f.RELATED_CLICK_GESTURE:u.length>=2&&(d.related_pid=u[1]),l.event=f.RELATED_CLICK_GESTURE;break;case f.SHARE_OVERLAY:l.event=f.SHARE_OVERLAY;break;case f.SHARE_NETWORK_GESTURE:u.length>=2&&(d.network=u[1]),l.event=f.SHARE_NETWORK_GESTURE;break;case f.SEND_GESTURE:u.length>=2&&(i=(t=u[1].split(",")).shift(),n=t.join(","),d.sender=i,d.recipient=n),l.event=f.SEND_GESTURE;break;case f.EMBED_GESTURE:l.event=f.EMBED_GESTURE;break;case f.LINK_GESTURE:l.event=f.LINK_GESTURE;break;case f.REPLAY_GESTURE:l.event=f.REPLAY_GESTURE;break;case f.END_CARD_OVERLAY:l.event=f.END_CARD_OVERLAY;break;case f.ERROR_OVERLAY:l.event=f.ERROR_OVERLAY;break;case f.RECOMMEND_NOW:u.length>=3?(d.mediaid=u[1],d.pid=u[2]):(d.mediaid="",d.pid=""),l.event=f.RECOMMEND_NOW;break;case f.RECOMMEND_NEXT:u.length>=3?(d.mediaid=u[1],d.pid=u[2]):(d.mediaid="",d.pid=""),l.event=f.RECOMMEND_NEXT;break;case f.RECOMMEND_CLOSE:l.event=f.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",p)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",l),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",d)),this._sendDWEvent()}else uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.")},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(e){return s.has(this._tags.ad,e)?"ad":s.has(this._tags.content,e)?"content":void 0},_getStreamType:function(){var e=this.cviModel.getContentVideoState(),t=uvpjs.mediaCapabilities,i=e.deliveryType,n=e.isLive;return i===t.STREAMING?n?5:4:i===t.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var e=this._agentStartTime,t=s.isDate(e)&&parseInt((new Date-e)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",t),t},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var e=uvpjs.mediaCapabilities,t=window.screen,i={type:(e.getDevice()||"").toLowerCase(),os:(e.getOS()||"").toLowerCase(),ver:e.getOSVersion(),screensz:[t.width,t.height].join("x")};return n(i)},_getPlayerSize:function(){var e=this.cviModel.getContentVideoState();return[e.sourceWidth,e.sourceHeight].join("x")}}),t=function(e,t,i){var n,r,a=[];for(n in e)e.hasOwnProperty(n)&&(r=s.isUndefined(e[n])?"":encodeURIComponent(e[n]),a.push([n,r].join(t)));return a.join(i)},i=function(e){return t(e,"=","&")},n=function(e){return t(e,":",";")}}(uvpjs.register("uvpjs")),function(e){var t;e._,e.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(e){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=e.trackingMgr,this.cviModel=e.cviModel,this.eventsMgr=e.eventsMgr,this._moduleName=e.moduleName,this.buffering=!1,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.buffering=!1,this.akamaiPlugin=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var e=this.eventsMgr.eventTypes,t={};t[e.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.AD_QUARTILE]=this._onAdQuartile.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),t[e.RESOURCE_END]=this._onResourceEnd.bind(this),t[e.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t)},_initializePlugin:function(){var e={};this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),t()?this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."):(e.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,e.streamHeadPosition=this.getStreamHeadPosition.bind(this),e.streamLength=this.getStreamLength.bind(this),e.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(e),this._setupEventCallbacks())},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var e=this.cviModel.adVideoState,t={};t.adTitle=e.adVideoTitle,t.adDuration=e.duration,t.id=e.adVideoId,t.adPartnerId=this.cviModel.sessionOptions.partner,t.adServer=e.adServerName,this.akamaiPlugin.handleAdLoaded(t)},setContentMetaData:function(){var e=this.cviModel,t=e.sessionOptions,i=this.akamaiPlugin,n=e.getContentVideoState(),s=e.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),i.setData("viewerId",e.getModuleParam(this._moduleName,"viewerID")),i.setData("partnerId",t.partner),i.setData("playerId",this.trackingMgr.getPlayerName("|")),i.setData("Host",t.host),i.setData("Referrer",t.referrer),i.setData("title",n.title),i.setData("category",n.category),i.setData("subCategory",n.sourceOwner),i.setData("show",n.title),i.setData("contentLength",1e3*s.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",e),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",e.payload),this.akamaiPlugin&&e.payload)switch(e.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",e),this.akamaiPlugin){var t=e.payload.newState;t!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),t===uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())}},_onResourceEnd:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",e),this.akamaiPlugin&&this.akamaiPlugin.handlePlayEnd("Play.End.Detected")},_onQosMetadata:function(e){var t,i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",e),this.akamaiPlugin&&-1!==e.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI))for(t in i=e.payload.paramsObj)this.akamaiPlugin.setData(t,i[t])}}),t=function(){return"undefined"==typeof AkaHTML5MediaAnalytics}}(uvpjs.register("uvpjs")),function(e){"use strict";var t=e._;e.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(e){this.cviModel=e.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",e),this.trackingMgr=e.trackingMgr,this.eventTypes=e.eventsMgr&&e.eventsMgr.eventTypes||null,this.moduleName=e.moduleName,this.playerName=e.playerName,this.playerVersion=e.playerVersion,this.useDefaultProperty=e.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){if(!this.cviModel)return uvpjs.debug;var e=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!e&&!0===e[uvpjs.DebugManager.configParams.MUX_DEBUG]},_initializePlugin:function(){console.log("[MUX] _initializePlugin"),void 0!==window.mux?this.cviModel&&this._setupEventCallbacks():this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded.")},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var e=this.cviModel,i=this.moduleParams,n=t.assign({page_type:"",viewer_user_id:e.getSessionOption("userId"),experiment_name:i&&!uvpjs.util.isEmpty(i.experimentName)?i.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||uvpjs.util.isEmpty(i.subPropertyId)?e.getSessionOption("partner"):i.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:e.initTime},this._getMuxVideoData());return this.useDefaultProperty?n.property_key=this.MUX_DEFAULT_PROPERTY_KEY:n.property_key=i.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:n}),this.videoElement.mux},_getMuxVideoData:function(){var e=this.cviModel.contentVideoState;return{video_id:this._validateStr(e.cmsRefGuid,""),video_title:this._validateStr(e.videoTitle,""),video_series:this._validateStr(e.seriesTitle,""),video_producer:"",video_content_type:e.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:e.duration,video_stream_type:e.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(e.cdn,""),video_source_url:this._validateStr(e.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(e){return uvpjs.util.isDefinedString(e)},_validateStr:function(e,t){return this._isValidStr(e)?e:t},_onContentEvent:function(e){e.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(e){if(this.muxMonitor)switch(e.payload.facadeType){case this.mc.HLSJS:this.muxHLSJSMonitoring||(this.muxHLSJSMonitoring=!0,this.muxMonitor.addHLSJS({hlsjs:e.payload.player,Hls:window.Hls}));break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:e.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(e){var t=e.payload.errorInfo;t&&t.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:t.errorCode,player_error_message:t.message}))},_gatherModuleParams:function(e){var t,i=this.cviModel.getModule(e).params,n={};if(!i)return null;for(var s=i.length;s--;)n[(t=i[s]).name]=t.value;return n},_setupEventCallbacks:function(){var e=this.eventTypes,t={},i=this._onContentEvent.bind(this),n=this._onPlaybackLibraryLoaded.bind(this),s=this._onError.bind(this),r=this._onAdEvent.bind(this);t[e.CONTENT_DATA_LOADED]=i,t[e.PLAYBACK_LIBRARY_LOADED]=n,t[e.PLAYER_START_ERROR]=s,t[e.VIDEO_START_ERROR]=s,t[e.VIDEO_PLAYBACK_ERROR]=s,t[e.AD_ERROR]=s,t[e.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=r,t[e.AD_PLUGIN_CONTENT_RESUME_REQUEST]=r,t[e.AD_LOADED]=r,t[e.AD_START]=r,t[e.VIDEO_STATE_CHANGE]=r,t[e.AD_SKIPPED]=r,t[e.AD_END]=r,t[e.AD_ERROR]=r,t[e.AD_REQUEST]=r,t[e.AD_RESPONSE]=r,t[e.AD_QUARTILE]=r,this.trackingMgr.registerEventCallbacks(t)},_getMuxAdData:function(e){var t=e.payload.adData?e.payload.adData.adAssetUrl:e.payload.adAssetUrl;return{ad_tag_url:e.payload.adCallUrl,ad_asset_url:t}},_dispatchMuxAdEvent:function(e,t){e&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),t||(t={ad_tag_url:"",ad_asset_url:""}),t.ad_tag_url||(t.ad_tag_url=""),t.ad_asset_url||(t.ad_asset_url=""),window.mux.emit(this.videoElement,e,t))},_dispatchMuxEvent:function(e){window.mux.emit(this.videoElement,e)},_onAdEvent:function(e){var t=this.eventTypes,i=this.MUX_AD_EVENTS,n=this.MUX_EVENTS;switch(e.type){case t.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(n.PAUSE),this._dispatchMuxAdEvent(i.AD_BREAK_START);break;case t.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(i.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(n.PLAY),this._dispatchMuxEvent(n.PLAYING));break;case t.AD_LOADED:this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(e));break;case t.AD_START:this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(e));break;case t.VIDEO_STATE_CHANGE:if(!e.payload.isAd)return;var s=e.payload.newState,r=e.payload.currentState;s===this.mc.PAUSED?this._dispatchMuxAdEvent(i.AD_PAUSE,this._getMuxAdData(e)):r==this.mc.PAUSED&&s===this.mc.PLAYING&&(this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(e)),this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(e)));break;case t.AD_SKIPPED:case t.AD_END:this._dispatchMuxAdEvent(i.AD_ENDED,this._getMuxAdData(e));break;case t.AD_ERROR:this._dispatchMuxAdEvent(i.AD_ERROR,this._getMuxAdData(e));break;case t.AD_REQUEST:this._dispatchMuxAdEvent(i.AD_REQUEST,this._getMuxAdData(e));break;case t.AD_RESPONSE:this._dispatchMuxAdEvent(i.AD_RESPONSE,this._getMuxAdData(e));break;case t.AD_QUARTILE:switch(e.payload.percent){case 25:this._dispatchMuxAdEvent(i.AD_FIRST_QUARTILE,this._getMuxAdData(e));break;case 50:this._dispatchMuxAdEvent(i.AD_MIDPOINT,this._getMuxAdData(e));break;case 75:this._dispatchMuxAdEvent(i.AD_THIRD_QUARTILE,this._getMuxAdData(e))}}}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").OzTamAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isStopped:!1,resumeTime:-1,init:function(e){this.options=e,this.ozTamVo=new uvpjs.OzTamVo(this);var t=this.ozTamVo.getConfig();this.ozTamService=new OzTAMService(t.publisherId,t.vendorVersion,t.productionMode,t.verboseLogging,t.useHTTPS),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService",t,this.ozTamService)},initialize:function(){var e=this.options.eventsMgr.eventTypes,t=this.onVideoEvent.bind(this),i={};i[e.RESOURCE_START]=t,i[e.CONTENT_START]=t,i[e.CONTROL_SEEK]=t,i[e.SEEK_DONE]=t,i[e.CONTENT_END]=t,i[e.VIDEO_STATE_CHANGE]=t,i[e.VIDEO_PROGRESS]=t,i[e.USER_GESTURE]=t,this.options.trackingMgr.registerEventCallbacks(i)},onVideoEvent:function(e){var t=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out");else switch(e.type){case t.RESOURCE_START:this.onResourceStart(e);break;case t.CONTENT_START:this.onContentStart(e);break;case t.CONTROL_SEEK:this.onSeekStart(e);break;case t.SEEK_DONE:this.onSeekDone(e);break;case t.CONTENT_END:this.onContentEnd(e);break;case t.VIDEO_STATE_CHANGE:this.onVideoStateChange(e);break;case t.VIDEO_PROGRESS:this.onVideoProgress(e);break;case t.USER_GESTURE:this.onUserGesture(e)}},onResourceStart:function(e){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(e){this.ozTamService.seekBegin()},onSeekDone:function(e){this.ozTamService.seekComplete(),this.isStopped=!0},onContentEnd:function(e){this.ozTamService.complete()},onVideoStateChange:function(e){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(e.payload.newState){case uvpjs.mediaCapabilities.PAUSED:case uvpjs.mediaCapabilities.BUFFERING:this.isStopped||(this.isStopped=!0,this.ozTamService.haltProgress())}},onVideoProgress:function(e){this.isStopped&&(this.isStopped=!1,this.ozTamService.resumeProgress())},onUserGesture:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"startTime",e.payload.startTime),e.payload.startTime>0&&(this.resumeTime=e.payload.startTime)},destroy:function(){this.ozTamVo.destroy(),this.DEBUG_ID=null,this.options=null,this.ozTamService=null,this.ozTamVo=null,this.mediaInfo=null}}),uvpjs.register("uvpjs").DatazoomAgent=uvpjs.TrackingAgent.subClass({metadata:{},init:function(e){this._super(e),this.vo=new uvpjs.DatazoomVo(this),this.sdkEvent=this.vo.Event,this.metadata={},(new uvpjs.CodeLoader).loadScript(this.vo.sdkUrl,this.onSdkReady.bind(this))},onSdkReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent SDK Ready"),this.hasSdk="function"==typeof window.setDatazoomMetadata},sendTrackEvent:function(e,t){if(this.hasSdk){for(var i in this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent "+e),t=t||{})this.metadata[i]=t[i];switch(e){case"content_start":window.setDatazoomMetadata(this.format(this.metadata));break;case"cdn_updated":window.generateDatazoomEvent("CDNChange",this.format(t));break;case"content_complete":this.metadata={}}}},format:function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)&&e[i]&&"object"!=typeof e[i]){var n={};n[i]=e[i],t.push(n)}return this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent",t),t}}),uvpjs.register("uvpjs").DataModelVo=uvpjs.Class.subClass({agent:null,channelName:null,apiKey:null,contentInfo:{},getApiKey:function(){return this.apiKey},getPersistentData:function(e){var t=this.agent.options.cviModel,i=t&&t.getContentVideoState(),n=this.agent.contextMetadata;for(var s in(e=e||{}).sessionId=t&&t.sessionId,e.contentAssetId=i&&(i.cmsRefGuid||i.mediaId)||"",e.playheadTime=e.playheadTime||this.getPlayhead(),e.playerTime=this.getPlayerElapsedTime(),n)n.hasOwnProperty(s)&&(e[s]=n[s]);return e},getSessionStartInfo:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=t.duration,n=e.contentPlaybackState.facadeState,s=t.isLive?-1:isNaN(i)?0:i,r=this.getDrmInfo(t.drm);return this.getPersistentData({adAssetId:e.adVideoState.adClipID,adPodId:e.adVideoState.adVideoId||e.adVideoState.adVatId,adType:e.adVideoState.adType,allowConcurrentPlayback:e.sessionOptions.allowConcurrentPlayback,bitrate:n.currentBitrate,channel:this.channelName,cdn:t.cdn,cms:e.sessionOptions.cms,currentIndex:1,"drm.dash.playreadyURL":r.playreadyURL,"drm.dash.widevineURL":r.widevineURL,"drm.enabled":r.enabled,"drm.fairplay.appCertURL":r.appCertURL,"drm.ticket":r.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(t.drm),enableMutedAutoplay:e.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:e.sessionOptions.enableNativeMobileAutoplay,enableReplay:e.sessionOptions.enableReplay,enableUnmutedAutoplay:e.sessionOptions.enableUnmutedAutoplay,framerate:n.playbackFramerate,fullScreen:e.isFullscreen,isAutoplay:e.isAutoplay,isMultiCDN:e.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:e.isMuteAtPlayStart,isMuted:t.isMuted,isSslRequired:window.location.href.search(/^https/)>-1,length:s,livestream:t.isLive,liveSyncDurationCount:e.sessionOptions.liveSyncDurationCount,maxBitrate:e.maxBitrate,method:"",minBitrate:e.minBitrate,pageProvidesTealium:e.sessionOptions.usesTealium,pagetype:e.dwPageParams.pagetype,partner:e.sessionOptions.partner,pguid:e.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sound:e.volume,startTime:t.startTime,streamType:t.isLive?"Live":"VOD",title:t.videoTitle,totalLength:s,usesIMA:e.sessionOptions.usesIMA,userConnectionType:e.sessionOptions.userConnectionType,userCountry:e.sessionOptions.userCountry,userIsp:e.sessionOptions.userISP,userPpid:e.sessionOptions.userPPID,userStatus:e.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName})},getContentStartInfo:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=t.duration,n=e.contentPlaybackState.facadeState,s=t.isLive?-1:isNaN(i)?0:i;return this.contentInfo={assetUrl:t.assetURL,assetId:t.cmsRefGuid||t.mediaId,category:t.category,channel:this.channelName,chapterStartTimes:t.chapterStartTimes.join(","),closedCaptionPath:t.closedCaptionPath,cms:e.sessionOptions.cms,cmsRefGuid:t.cmsRefGuid,dfpMediaId:t.dfpMediaId,duration:s,episodeAbstract:t.episodeAbstract,episodeFlag:t.episodeFlag,episode:t.episodeNumber,excludeNielsenTracking:t.excludeNielsenTracking,fileType:t.fileType,genre:t.category,indexPosition:e.contentPlaybackState.currentContentSegment,is360:t.is360,isAffiliateFeed:t.isAffiliateFeed,isEmbedable:t.isEmbedable,isPaidContent:t.isPaidContent,mediaId:t.mediaId,overrideAssetURL:t.overrideAssetURL,program:t.videoTitle.split("-")[0],pguid:e.dwPageParams.pguid,playbackBitrate:n.currentBitrate,playheadTime:this.getContentStartPlayhead(),season:t.seasonNumber,seriesTitle:t.seriesTitle,showPreroll:t.showPreroll,startTime:t.startTime,useWatermark:t.useWatermark,title:t.videoTitle,totalLength:s},this.getPersistentData(this.contentInfo)},getContentCompleteInfo:function(){var e=this.agent.options.cviModel;return this.contentInfo.playbackBitrate=e.contentPlaybackState.facadeState.currentBitrate,this.getPersistentData(this.contentInfo)},getQuartileInfo:function(){return this.agent.options.cviModel.getContentVideoState(),this.getPersistentData()},getQosInfo:function(){var e=this.agent.options.cviModel,t=e.contentPlaybackState,i=e.contentPlaybackState.facadeState;return this.getPersistentData({averageDroppedFPS:t.averageDroppedFPS,bufferLength:t.bufferLength,currentContentSegment:t.currentContentSegment,currentMaxBandwidth:t.currentMaxBandwidth,currentTime:this.getPlayhead(),currentBitrate:i.currentBitrate,droppedFPS:i.droppedFPS,droppedFrames:i.droppedFrames,playbackFramerate:i.playbackFramerate})},getAdBreakInfo:function(){var e=this.agent.options.cviModel,t=e.adVideoState,i=t.adClipID.split("_"),n=1;return"post"===t.adType?n=e.getNumberOfAdPods():"mid"===t.adType&&(n=parseInt(i[1])+1),this.getPersistentData({indexPosition:n,startTime:this.getPlayhead(),title:t.adVideoTitle})},getAdItemInfo:function(){var e=this.agent.options.cviModel.adVideoState;return this.getPersistentData({adCallUrl:e.assetURL||e.adAssetUrl||e.adVideoUrl,adParams:e.adParameters,assetId:e.adVideoId||e.adVatId,indexPosition:e.adPosition,isCustomClickTrackingUsed:e.isCustomClickTrackingUsed,title:e.adVideoTitle,totalLength:e.duration})},getSeekInfo:function(){return this.getPersistentData({seekPosition:this.getPlayhead()})},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getContentStartPlayhead:function(){var e=this.getPlayhead();return this.agent.options.resumeTime&&this.agent.options.resumeTime>0&&(e=this.agent.options.resumeTime,this.agent.options.resumeTime=-1),e},getPlayerElapsedTime:function(){return parseInt((new Date-this.agent.initTime)/1e3)},getDrmInfo:function(e){return{playreadyURL:e.dash&&e.dash.playreadyURL?e.dash.playreadyURL:"",widevineURL:e.dash&&e.dash.widevineURL?e.dash.widevineURL:"",appCertURL:e.fairplay&&e.fairplay.appCertURL?e.fairplay.appCertURL:"",enabled:e.enabled||!1,ticket:e.ticket||""}},isCompletedMarker:function(){var e=this.agent.options.cviModel.getContentVideoState();return!e.isLive&&this.getPlayhead()>=.95*e.duration},destroy:function(){this.Event=null,this.agent=null,this.channelName=null,this.apiKey=null}}),uvpjs.register("uvpjs").DatazoomVo=uvpjs.DataModelVo.subClass({Event:{SESSION_START:"session_start",CONTENT_START:"content_start",CONTENT_COMPLETE:"content_complete",CDN_UPDATED:"cdn_updated",PAUSE:"pause",STOP:"stop",BUFFER_START:"buffer_start",BUFFER_COMPLETE:"buffer_complete",SEEK_START:"seek_start",SEEK_COMPLETE:"seek_complete",PLAY_RESUME:"resume",SESSION_END:"session_end",AD_BREAK_START:"ad_break_start",AD_BREAK_COMPLETE:"ad_break_end",AD_START:"ad_start",AD_COMPLETE:"ad_end",AD_CLICK:"ad_click",QOS:"qos",FIRST_QUARTILE:"first_quartile",MID_QUARTILE:"mid_quartile",THIRD_QUARTILE:"third_quartile"},sdkUrl:"//platform.datazoom.io/beacon/v1/config?configuration_id=",init:function(e){this.agent=e;var t=this.agent.options;this.getModuleParam=t.cviModel.getModuleParam.bind(t.cviModel,t.trackingMgr.DATAZOOM_MODULE_NAME),this.sdkUrl+=this.getModuleParam("configId")}}),uvpjs.register("uvpjs").OzTamVo=uvpjs.Class.subClass({agent:null,init:function(e){this.agent=e;var t=this.agent.options;this.getModuleParam=t.cviModel.getModuleParam.bind(t.cviModel,t.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.getVendorVersion(),productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:top.location.href.search(/^https/)>-1}},getVendorVersion:function(){return[this.getModuleParam("platform"),uvpjs.mediaCapabilities.isMobile()?"Mobile-Web":"Desktop-Web",this.agent.options.playerVersion].join("_")},getMediaInfo:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=t.duration,n=function(){var t=e.getCurrentPlaybackState().currentTime;return this.agent.resumeTime>0&&(t=this.agent.resumeTime,this.agent.resumeTime=-1),t}.bind(this);return{mediaId:t.ozTamMediaId||t.cmsRefGuid||t.mediaId,url:t.assetURL,mediaDuration:t.isLive?-1:isNaN(i)?0:i,mediaType:t.isLive?"live":"vod",mediaPositionFunction:function(){return n()}}},getPropertyDictionary:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=e.getSessionOption("userId"),n=this.agent.ozTamService,s={};return t.ozTamMediaId&&(s[n.PROP_ALT_MEDIA_ID]=t.cmsRefGuid||t.mediaId),i&&(s[n.PROP_DEMO1]=i),s},isOzTamOptOut:function(){var e=this.agent.options.cviModel.getContentVideoState();return e.hasOwnProperty("ozTamOptOut")&&e.ozTamOptOut},getValue:function(e){return e.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}}),function(e){var t={prodUrl:"//sparrow.cbs.com",stageUrl:"//stage-sparrow.cbs.com",path:"/streamer/v1.0/ingest/beacon.json"},i=!1,n=null,s=null,r=function(e){return(e=e.replace(/\s/g,"")).search(/^\/\//)>-1?e:"//"+e};e.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(e){return s=t,e&&e.prodUrl&&e.stageUrl&&(s.prodUrl=r(e.prodUrl),s.stageUrl=r(e.stageUrl)),this},queryParams:function(t){return n=e.util.queryStrFromObj(t,!1),this},devMode:function(e){return i=e,this},buildUrl:function(){return null===s?"Unable to build url.":(i?s.stageUrl:s.prodUrl)+s.path+(null===n?"":"?"+n)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(e){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=e.drm,this.videoTagRef=e.videoTagRef,this.eventTypes=e.eventTypes,this.errorCallback=e.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destroy:function(){this.removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var e=this.getLicenseServerUrl(this.initData),t=this.getId(e);if(this.drmVendor=this.getDRMVendor(e),t){if(!this.videoTagRef.webkitKeys){var i=this.KEY_SYSTEMS.FPS_1_0;if(!WebKitMediaKeys.isTypeSupported(i,"video/mp4"))return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(i))}if(this.videoTagRef.webkitKeys){var n=this.concatInitDataIdAndCertificate(this.initData,t,this.appCertData),s=this.videoTagRef.webkitKeys.createSession("video/mp4",n);s?(s.contentId=t,s.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,e),!1),s.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),s.addEventListener("webkitkeyerror",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)):this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null)}else this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null)}else this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null)},loadAppCert:function(){t.isEmpty(this.drm.fairplay.appCertURL)||(new uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",e),this.appCertData=new Uint8Array(e.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(e){this.webKitNeedKeyCalled=!0,this.initData=e.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(e,t,i){"string"==typeof t&&(t=this.stringToArray(t));var n=0,s=new ArrayBuffer(e.byteLength+4+t.byteLength+4+i.byteLength),r=new DataView(s);new Uint8Array(s,n,e.byteLength).set(e),n+=e.byteLength,r.setUint32(n,t.byteLength,!0),n+=4;var a=new Uint8Array(s,n,t.byteLength);return a.set(t),n+=a.byteLength,r.setUint32(n,i.byteLength,!0),n+=4,new Uint8Array(s,n,i.byteLength).set(i),new Uint8Array(s,0,s.byteLength)},onLicenseRequestReady:function(e,t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+e,t);var i=new XMLHttpRequest;i.session=t.target,i.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),i.addEventListener("error",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),i.open("POST",e,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?i.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(i.responseType="text");var n="spc="+encodeURIComponent(this.base64EncodeUint8Array(t.message))+"&"+i.session.contentId;(i=this.setRequestHeaders(i)).send(n)},onLicenseRequestLoaded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",e);var i=e.target,n=i.session,s=null;t.inRange(i.status,200,400)||this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,e),this.drmVendor===this.DRM_VENDORS.DRMTODAY?s=this.base64DecodeUint8Array(i.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(s=new Uint8Array(i.response)),n.update(s)},onError:function(e,t){this.debug&&uvpjs.error(this.DEBUG_ID,e,t),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,e)},onKeyAdded:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM key was added successfully!",e)},getLicenseServerUrl:function(e){var i=null;return i=t.isEmpty(this.drm.fairplay.licenseURL)?"https://"+String.fromCharCode.apply(null,new Uint16Array(e.buffer)).split("://")[1]:this.drm.fairplay.licenseURL,this.appendDRMQueryParams(i)},appendDRMQueryParams:function(e){var t=-1===e.indexOf("?")?"?":"&";return this.drm.sessionId&&(e+=t+"SessionId="+this.drm.sessionId),this.drm.ticket&&(e+="&Ticket="+this.drm.ticket),e},getDRMVendor:function(e){var t=null;return-1!==e.indexOf(this.DRM_VENDORS.DRMTODAY)?t=this.DRM_VENDORS.DRMTODAY:-1!==e.indexOf(this.DRM_VENDORS.IRDETO)&&(t=this.DRM_VENDORS.IRDETO),t},setRequestHeaders:function(e){if(e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!t.isEmpty(this.drm.fairplay.header)){var i=this.drm.fairplay.header;for(var n in i)e.setRequestHeader(n,i[n])}return e},getId:function(e){var t=uvpjs.util.objFromQueryStr(e);return t.ContentId||t.contentId||t.assetId||null},base64EncodeUint8Array:function(e){var t=String.fromCharCode.apply(null,e);return btoa(t)},base64DecodeUint8Array:function(e){var t=window.atob(e),n=t.length,s=new Uint8Array(new ArrayBuffer(n));for(i=0;i<n;i++)s[i]=t.charCodeAt(i);return s},stringToArray:function(e){for(var t=new ArrayBuffer(2*e.length),i=new Uint16Array(t),n=0,s=e.length;n<s;n++)i[n]=e.charCodeAt(n);return i}})}(uvpjs.register("uvpjs"))}(),define("uvp/uvp-3.0.0",function(){}),define("third-party/dai",[],function(){CBSNEWS.features.adsDAIloaded=null,CBSNEWS.features.executeIfEnabled(["ads","adsDAI"],function(){CBSNEWS.features.adsDAIloaded=!1,require(["https://imasdk.googleapis.com/js/sdkloader/ima3_dai.js#"],function(){CBSNEWS.features.adsDAIloaded=!0})},this)}),define("third-party/ima",[],function(){CBSNEWS.features.adsIMAloaded=null,CBSNEWS.features.executeIfEnabled(["ads","adsIMA"],function(){CBSNEWS.features.adsIMAloaded=!1,require(["https://imasdk.googleapis.com/js/sdkloader/ima3.js#"],function(){CBSNEWS.features.adsIMAloaded=!0})},this)}),define("uvp",["uvp/uvp-3.0.0","third-party/tealium","third-party/dai","third-party/ima"],function(){}),require(["polyfill!fetch","polyfill!window.CustomEvent","polyfill!element.closest","polyfill!object.assign","uvp"]),define("video/common",function(){}),define("video/main",[],function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=97)}([function(e,t,i){
/* Riot v3.13.1, @license MIT */
!function(e){"use strict";function t(e,t){return(t||document).querySelector(e)}var i,n,s=[],r={},a="yield",o="__global_mixin",l="riot-",d=["ref","data-ref"],u="data-is",c="if",h="each",p="no-reorder",f="show",v="hide",g="key",_="__riot-events__",m="string",E="object",y="undefined",A="function",S="http://www.w3.org/1999/xlink",b="http://www.w3.org/2000/svg",T=/^xlink:(\w+)/,D=typeof window===y?void 0:window,C=/^on/,I=/([-\w]+) ?= ?(?:"([^"]*)|'([^']*)|({[^}]*}))/g,R={viewbox:"viewBox",preserveaspectratio:"preserveAspectRatio"},P=/^(?:disabled|checked|readonly|required|allowfullscreen|auto(?:focus|play)|compact|controls|default|formnovalidate|hidden|ismap|itemscope|loop|multiple|muted|no(?:resize|shade|validate|wrap)?|open|reversed|seamless|selected|sortable|truespeed|typemustmatch)$/,M=0|(D&&D.document||{}).documentMode;function O(e){return"svg"===e?document.createElementNS(b,e):document.createElement(e)}function L(e,t,i){var n=T.exec(t);n&&n[1]?e.setAttributeNS(S,n[1],i):e.setAttribute(t,i)}var w={},N=!1;D&&(i=function(){var e=O("style"),i=t("style[type=riot]");return L(e,"type","text/css"),i?(i.id&&(e.id=i.id),i.parentNode.replaceChild(e,i)):document.head.appendChild(e),e}(),n=i.styleSheet);var k={styleNode:i,add:function(e,t){w[t]=e,N=!0},inject:function(){if(D&&N){N=!1;var e=Object.keys(w).map(function(e){return w[e]}).join("\n");n?n.cssText=e:i.innerHTML=e}},remove:function(e){delete w[e],N=!0}},B=function(){var e=["case","default","do","else","in","instanceof","prefix","return","typeof","void","yield"],t=e.reduce(function(e,t){return e+t.slice(-1)},""),i=/^\/(?=[^*>\/])[^[\/\\]*(?:(?:\\.|\[(?:\\.|[^\]\\]*)*\])[^[\\\/]*)*?\/[gimuy]*/,n=/[$\w]/;function s(e,t){for(;--t>=0&&/\s/.test(e[t]););return t}return function(r,a){var o=/.*/g,l=o.lastIndex=a++,d=o.exec(r)[0].match(i);if(d){var u=l+d[0].length,c=r[l=s(r,l)];if(l<0||~"[{(,;:?=|&!^~>%*/".indexOf(c))return u;if("."===c)"."===r[l-1]&&(a=u);else if("+"===c||"-"===c)(r[--l]!==c||(l=s(r,l))<0||!n.test(r[l]))&&(a=u);else if(~t.indexOf(c)){for(var h=l+1;--l>=0&&n.test(r[l]););~e.indexOf(r.slice(l+1,h))&&(a=u)}}return a}}(),U=function(e){var t,i,n="g",s=/"[^"\\]*(?:\\[\S\s][^"\\]*)*"|'[^'\\]*(?:\\[\S\s][^'\\]*)*'|`[^`\\]*(?:\\[\S\s][^`\\]*)*`/g,r=s.source+"|"+/(?:\breturn\s+|(?:[$\w\)\]]|\+\+|--)\s*(\/)(?![*\/]))/.source+"|"+/\/(?=[^*\/])[^[\/\\]*(?:(?:\[(?:\\.|[^\]\\]*)*\]|\\.)[^[\/\\]*)*?([^<]\/)[gim]*/.source,a=RegExp("[\\x00-\\x1F<>a-zA-Z0-9'\",;\\\\]"),o=/(?=[[\]()*+?.^$|])/g,l=s.source+"|"+/(\/)(?![*\/])/.source,d={"(":RegExp("([()])|"+l,n),"[":RegExp("([[\\]])|"+l,n),"{":RegExp("([{}])|"+l,n)},u="{ }",c=["{","}","{","}",/{[^}]*}/,/\\([{}])/g,/\\({)|{/g,RegExp("\\\\(})|([[({])|(})|"+l,n),u,/^\s*{\^?\s*([$\w]+)(?:\s*,\s*(\S+))?\s+in\s+(\S.*)\s*}/,/(^|[^\\]){=[\S\s]*?}/],h=void 0,p=[];function f(e){return e}function v(e,t){return t||(t=p),new RegExp(e.source.replace(/{/g,t[2]).replace(/}/g,t[3]),e.global?n:"")}function g(e){if(e===u)return c;var t=e.split(" ");if(2!==t.length||a.test(e))throw new Error('Unsupported brackets "'+e+'"');return(t=t.concat(e.replace(o,"\\").split(" ")))[4]=v(t[1].length>1?/{[\S\s]*?}/:c[4],t),t[5]=v(e.length>3?/\\({|})/g:c[5],t),t[6]=v(c[6],t),t[7]=RegExp("\\\\("+t[3]+")|([[({])|("+t[3]+")|"+l,n),t[8]=e,t}function _(e){return e instanceof RegExp?t(e):p[e]}function m(e){(e||(e=u))!==p[8]&&(p=g(e),t=e===u?f:v,p[9]=t(c[9])),h=e}return _.split=function(e,t,i){i||(i=p);var n,s,r,a,o,l,u=[],c=i[6],h=[],f="";for(s=r=c.lastIndex=0;n=c.exec(e);){if(l=c.lastIndex,a=n.index,s){if(n[2]){var v=n[2],g=d[v],_=1;for(g.lastIndex=l;n=g.exec(e);)if(n[1]){if(n[1]===v)++_;else if(!--_)break}else g.lastIndex=E(n.index,g.lastIndex,n[2]);c.lastIndex=_?e.length:g.lastIndex;continue}if(!n[3]){c.lastIndex=E(a,l,n[4]);continue}}n[1]||(m(e.slice(r,a)),r=c.lastIndex,(c=i[6+(s^=1)]).lastIndex=r)}return e&&r<e.length&&m(e.slice(r)),u.qblocks=h,u;function m(e){f&&(e=f+e,f=""),t||s?u.push(e&&e.replace(i[5],"$1")):u.push(e)}function E(i,n,s){return s&&(n=B(e,i)),t&&n>i+2&&(o="⁗"+h.length+"~",h.push(e.slice(i,n)),f+=e.slice(r,i)+o,r=n),n}},_.hasExpr=function(e){return p[4].test(e)},_.loopKeys=function(e){var t=e.match(p[9]);return t?{key:t[1],pos:t[2],val:p[0]+t[3].trim()+p[1]}:{val:e.trim()}},_.array=function(e){return e?g(e):p},Object.defineProperty(_,"settings",{set:function(e){var t;t=(e=e||{}).brackets,Object.defineProperty(e,"brackets",{set:m,get:function(){return h},enumerable:!0}),i=e,m(t)},get:function(){return i}}),_.settings="undefined"!=typeof riot&&riot.settings||{},_.set=m,_.skipRegex=B,_.R_STRINGS=s,_.R_MLCOMMS=/\/\*[^*]*\*+(?:[^*\/][^*]*\*+)*\//g,_.S_QBLOCKS=r,_.S_QBLOCK2=l,_}(),j=function(){var e={};function t(s,r){return s?(e[s]||(e[s]=function(e){var t=function(e){var t,s=U.split(e.replace(i,'"'),1),r=s.qblocks;if(s.length>2||s[0]){var o,l,d=[];for(o=l=0;o<s.length;++o)(t=s[o])&&(t=1&o?a(t,1,r):'"'+t.replace(/\\/g,"\\\\").replace(/\r\n?|\n/g,"\\n").replace(/"/g,'\\"')+'"')&&(d[l++]=t);t=l<2?d[0]:"["+d.join(",")+'].join("")'}else t=a(s[1],0,r);return r.length&&(t=t.replace(n,function(e,t){return r[t].replace(/\r/g,"\\r").replace(/\n/g,"\\n")})),t}(s);return"try{return "!==t.slice(0,11)&&(t="return "+t),new Function("E",t+";")}())).call(r,function(e,i){e.riotData={tagName:i&&i.__&&i.__.tagName,_riot_id:i&&i._riot_id},t.errorHandler?t.errorHandler(e):"undefined"!=typeof console&&"function"==typeof console.error&&(console.error(e.message),console.log("<%s> %s",e.riotData.tagName||"Unknown tag",this.tmpl),console.log(this.data))}.bind({data:r,tmpl:s})):s}t.hasExpr=U.hasExpr,t.loopKeys=U.loopKeys,t.clearCache=function(){e={}},t.errorHandler=null;var i=/\u2057/g,n=/\u2057(\d+)~/g,s=/^(?:(-?[_A-Za-z\xA0-\xFF][-\w\xA0-\xFF]*)|\u2057(\d+)~):/,r={"(":/[()]/g,"[":/[[\]]/g,"{":/[{}]/g};function a(e,t,i){if(e=e.replace(/\s+/g," ").trim().replace(/\ ?([[\({},?\.:])\ ?/g,"$1")){for(var n,a=[],o=0;e&&(n=e.match(s))&&!n.index;){var l,d,c=/,|([[{(])|$/g;for(e=RegExp.rightContext,l=n[2]?i[n[2]].slice(1,-1).trim().replace(/\s+/g," "):n[1];d=(n=c.exec(e))[1];)h(d,c);d=e.slice(0,n.index),e=RegExp.rightContext,a[o++]=u(d,1,l)}e=o?o>1?"["+a.join(",")+'].join(" ").trim()':a[0]:u(e,t)}return e;function h(t,i){var n,s=1,a=r[t];for(a.lastIndex=i.lastIndex;n=a.exec(e);)if(n[0]===t)++s;else if(!--s)break;i.lastIndex=s?e.length:a.lastIndex}}var o='"in this?this:'+("object"!=typeof window?"global":"window")+").",l=/[,{][\$\w]+(?=:)|(^ *|[^$\w\.{])(?!(?:typeof|true|false|null|undefined|in|instanceof|is(?:Finite|NaN)|void|NaN|new|Date|RegExp|Math)(?![$\w]))([$_A-Za-z][$\w]*)/g,d=/^(?=(\.[$\w]+))\1(?:[^.[(]|$)/;function u(e,t,i){var n;return e=e.replace(l,function(e,t,i,s,r){return i&&(s=n?0:s+e.length,"this"!==i&&"global"!==i&&"window"!==i?(e=t+'("'+i+o+i,s&&(n="."===(r=r[s])||"("===r||"["===r)):s&&(n=!d.test(r.slice(s)))),e}),n&&(e="try{return "+e+"}catch(e){E(e,this)}"),i?e=(n?"function(){"+e+"}.call(this)":"("+e+")")+'?"'+i+'":""':t&&(e="function(v){"+(n?e.replace("return ","v="):"v=("+e+")")+';return v||v===0?v:""}.call(this)'),e}return t.version=U.version="v3.0.8",t}(),x=function(e){e=e||{};var t={},i=Array.prototype.slice;return Object.defineProperties(e,{on:{value:function(i,n){return"function"==typeof n&&(t[i]=t[i]||[]).push(n),e},enumerable:!1,writable:!1,configurable:!1},off:{value:function(i,n){if("*"!=i||n)if(n)for(var s,r=t[i],a=0;s=r&&r[a];++a)s==n&&r.splice(a--,1);else delete t[i];else t={};return e},enumerable:!1,writable:!1,configurable:!1},one:{value:function(t,i){return e.on(t,function n(){e.off(t,n),i.apply(e,arguments)})},enumerable:!1,writable:!1,configurable:!1},trigger:{value:function(n){var s,r,a,o=arguments,l=arguments.length-1,d=new Array(l);for(a=0;a<l;a++)d[a]=o[a+1];for(s=i.call(t[n]||[],0),a=0;r=s[a];++a)r.apply(e,d);return t["*"]&&"*"!=n&&e.trigger.apply(e,["*",n].concat(d)),e},enumerable:!1,writable:!1,configurable:!1}}),e};function F(e,t){return Object.getOwnPropertyDescriptor(e,t)}function G(e){return typeof e===y}function V(e,t){var i=F(e,t);return G(e[t])||i&&i.writable}function H(e){for(var t,i=1,n=arguments,s=n.length;i<s;i++)if(t=n[i])for(var r in t)V(e,r)&&(e[r]=t[r]);return e}function W(e){return Object.create(e)}var K=H(W(U.settings),{skipAnonymousTags:!0,keepValueAttributes:!1,autoUpdate:!0});function z(e,t){return[].slice.call((t||document).querySelectorAll(e))}function Y(){return document.createTextNode("")}function q(e,t){e.style.display=t?"":"none",e.hidden=!t}function X(e,t){return e.getAttribute(t)}function J(e,t){e.removeAttribute(t)}function Q(e,t,i){if(i){var n=e.ownerDocument.importNode((new DOMParser).parseFromString('<svg xmlns="'+b+'">'+t+"</svg>","application/xml").documentElement,!0);e.appendChild(n)}else e.innerHTML=t}function Z(e,t){if(e)for(var i;i=I.exec(e);)t(i[1].toLowerCase(),i[2]||i[3]||i[4])}function $(){return document.createDocumentFragment()}function ee(e,t,i){e.insertBefore(t,i.parentNode&&i)}function te(e){return Object.keys(e).reduce(function(t,i){return t+" "+i+": "+e[i]+";"},"")}function ie(e,t,i){if(e){var n,s=t(e,i);if(!1===s)return;for(e=e.firstChild;e;)n=e.nextSibling,ie(e,t,s),e=n}}var ne=Object.freeze({$$:z,$:t,createDOMPlaceholder:Y,mkEl:O,setAttr:L,toggleVisibility:q,getAttr:X,remAttr:J,setInnerHTML:Q,walkAttrs:Z,createFrag:$,safeInsert:ee,styleObjectToString:te,walkNodes:ie});function se(e){return G(e)||null===e}function re(e){return se(e)||""===e}function ae(e){return typeof e===A}function oe(e){return e&&typeof e===E}function le(e){var t=e.ownerSVGElement;return!!t||null===t}function de(e){return Array.isArray(e)||e instanceof Array}function ue(e){return P.test(e)}function ce(e){return typeof e===m}var he=Object.freeze({isBlank:re,isFunction:ae,isObject:oe,isSvg:le,isWritable:V,isArray:de,isBoolAttr:ue,isNil:se,isString:ce,isUndefined:G});function pe(e,t){return-1!==e.indexOf(t)}function fe(e,t){for(var i=e?e.length:0,n=0;n<i;n++)t(e[n],n);return e}function ve(e,t){return e.slice(0,t.length)===t}var ge=function(){var e=-1;return function(){return++e}}();function _e(e,t,i,n){return Object.defineProperty(e,t,H({value:i,enumerable:!1,writable:!1,configurable:!0},n)),e}function me(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})}function Ee(e){console&&console.warn&&console.warn(e)}var ye=Object.freeze({contains:pe,each:fe,getPropDescriptor:F,startsWith:ve,uid:ge,defineProperty:_e,objectCreate:W,extend:H,toCamel:me,warn:Ee});function Ae(e,t,i,n,s){var r=e[t],a=de(r),o=!G(s);if(!r||r!==i)if(!r&&n)e[t]=[i];else if(r)if(a){var l=r.indexOf(i);if(l===s)return;-1!==l&&r.splice(l,1),o?r.splice(s,0,i):r.push(i)}else e[t]=[r,i];else e[t]=i}function Se(e){return e.tagName&&r[X(e,u)||X(e,u)||e.tagName.toLowerCase()]}function be(e,t){var i=Se(e),n=!t&&X(e,u);return n&&!j.hasExpr(n)?n:i?i.name:e.tagName.toLowerCase()}function Te(){return this.parent?H(W(this),this.parent):this}var De=/<yield\b/i,Ce=/<yield\s*(?:\/>|>([\S\s]*?)<\/yield\s*>|>)/gi,Ie=/<yield\s+to=['"]([^'">]*)['"]\s*>([\S\s]*?)<\/yield\s*>/gi,Re=/<yield\s+from=['"]?([-\w]+)['"]?\s*(?:\/>|>([\S\s]*?)<\/yield\s*>)/gi,Pe={tr:"tbody",th:"tr",td:"tr",col:"colgroup"},Me=M&&M<10?/^(?:t(?:body|head|foot|[rhd])|caption|col(?:group)?|opt(?:ion|group))$/:/^(?:t(?:body|head|foot|[rhd])|caption|col(?:group)?)$/,Oe="div",Le="svg";function we(e,i,n){var s=e&&e.match(/^\s*<([-\w]+)/),r=s&&s[1].toLowerCase(),a=O(n?Le:Oe);return e=function(e,t){if(!De.test(e))return e;var i={};return t=t&&t.replace(Ie,function(e,t,n){return i[t]=i[t]||n,""}).trim(),e.replace(Re,function(e,t,n){return i[t]||n||""}).replace(Ce,function(e,i){return t||i||""})}(e,i),Me.test(r)?a=function(e,i,n){var s="o"===n[0],r=s?"select>":"table>";if(e.innerHTML="<"+r+i.trim()+"</"+r,r=e.firstChild,s)r.selectedIndex=-1;else{var a=Pe[n];a&&1===r.childElementCount&&(r=t(a,r))}return r}(a,e,r):Q(a,e,n),a}var Ne=/^on/;function ke(e){for(var t=e;t.__.isAnonymous&&t.parent;)t=t.parent;return t}function Be(e,t,i,n){var s,r=function(e,t,i){var n=this.__.parent,s=this.__.item;if(!s)for(;n&&!s;)s=n.__.item,n=n.__.parent;if(V(i,"currentTarget")&&(i.currentTarget=e),V(i,"target")&&(i.target=i.srcElement),V(i,"which")&&(i.which=i.charCode||i.keyCode),i.item=s,t.call(this,i),K.autoUpdate&&!i.preventUpdate){var r=ke(this);r.isMounted&&r.update()}}.bind(n,i,t);i[e]=null,s=e.replace(C,""),pe(n.__.listeners,i)||n.__.listeners.push(i),i[_]||(i[_]={}),i[_][e]&&i.removeEventListener(s,i[_][e]),i[_][e]=r,i.addEventListener(s,r,!1)}function Ue(e,t,i,n){var s=vt(e,t,i),r=t.tagName||be(t.root,!0),a=ke(n);return _e(s,"parent",a),s.__.parent=n,Ae(a.tags,r,s),a!==n&&Ae(n.tags,r,s),s}function je(e,t,i,n){if(de(e[t])){var s=e[t].indexOf(i);-1!==s&&e[t].splice(s,1),e[t].length?1!==e[t].length||n||(e[t]=e[t][0]):delete e[t]}else e[t]===i&&delete e[t]}function xe(e,t){var i,n,s=Y(),r=Y(),a=$();for(this.root.insertBefore(s,this.root.firstChild),this.root.appendChild(r),this.__.head=n=s,this.__.tail=r;n;)i=n.nextSibling,a.appendChild(n),this.__.virts.push(n),n=i;t?e.insertBefore(a,t.__.head):e.appendChild(a)}function Fe(e,t){if(t.parentNode){var i=$();xe.call(e,i),t.parentNode.replaceChild(i,t)}}function Ge(e){if(!this.root||!X(this.root,"virtualized")){var t,i=e.dom,n=function(e){return e?(e=e.replace(l,""),R[e]&&(e=R[e]),e):null}(e.attr),s=pe([f,v],n),a=e.root&&"VIRTUAL"===e.root.tagName,o=this.__.isAnonymous,d=i&&(e.parent||i.parentNode),u=K.keepValueAttributes,c="style"===n,h="class"===n,p="value"===n;if(e._riot_id)e.__.wasCreated?e.update():(e.mount(),a&&Fe(e,e.root));else{if(e.update)return e.update();var g=s&&!o?Te.call(this):this,_=!re(t=j(e.expr,g)),m=oe(t);if(m&&(h?t=j(JSON.stringify(t),this):c&&(t=te(t))),!e.attr||e.wasParsedOnce&&!1!==t&&(_||p&&(!p||u))||J(i,X(i,e.attr)?e.attr:n),e.bool&&(t=!!t&&n),e.isRtag)return function(e,t,i){var n,s=e.tag||e.dom._tag,a=(s?s.__:{}).head,o="VIRTUAL"===e.dom.tagName;s&&e.tagName===i?s.update():(s&&(o&&(n=Y(),a.parentNode.insertBefore(n,a)),s.unmount(!0)),ce(i)&&(e.impl=r[i],e.impl&&(e.tag=s=Ue(e.impl,{root:e.dom,parent:t,tagName:i},e.dom.innerHTML,t),fe(e.attrs,function(e){return L(s.root,e.name,e.value)}),e.tagName=i,s.mount(),o&&Fe(s,n||s.root),t.__.onUnmount=function(){var e=s.opts.dataIs;je(s.parent.tags,e,s),je(s.__.parent.tags,e,s),s.unmount()})))}(e,this,t);if((!e.wasParsedOnce||e.value!==t)&&(e.value=t,e.wasParsedOnce=!0,!m||h||c||s)){if(_||(t=""),!n)return t+="",void(d&&(e.parent=d,"TEXTAREA"===d.tagName?(d.value=t,M||(i.nodeValue=t)):i.nodeValue=t));switch(!0){case ae(t):(function(e){return Ne.test(e)})(n)&&Be(n,t,i,this);break;case s:q(i,n===v?!t:t);break;default:e.bool&&(i[n]=t),p&&i.value!==t?i.value=t:_&&!1!==t&&L(i,n,t),c&&i.hidden&&q(i,!1)}}}}}function Ve(e){fe(e,Ge.bind(this))}function He(e,t,i,n,s){if(!e||!i){var r=e?Te.call(this):t||this;fe(s,function(e){e.expr&&Ge.call(r,e.expr),n[me(e.name).replace(l,"")]=e.expr?e.expr.value:e.value})}}function We(e){if(!e){var t=Object.keys(r);return t+We(t)}return e.filter(function(e){return!/[^-\w]/.test(e)}).reduce(function(e,t){var i=t.trim().toLowerCase();return e+",["+u+'="'+i+'"]'},"")}function Ke(e,t){var i=this.name,n=this.tmpl,s=this.css,a=this.attrs,o=this.onCreate;return r[i]||(ze(i,n,s,a,o),r[i].class=this.constructor),gt(e,i,t,this),s&&k.inject(),this}function ze(e,t,i,n,s){return ae(n)&&(s=n,/^[\w-]+\s?=/.test(i)?(n=i,i=""):n=""),i&&(ae(i)?s=i:k.add(i,e)),e=e.toLowerCase(),r[e]={name:e,tmpl:t,attrs:n,fn:s},e}function Ye(e,t,i,n,s){return i&&k.add(i,e),r[e]={name:e,tmpl:t,attrs:n,fn:s},e}function qe(e,t,i){var n,s,r=[];if(k.inject(),(oe(t)||ae(t))&&(i=t,t=0),ce(e)?n=(e="*"===e?s=We():e+We(e.split(/, */)))?z(e):[]:n=e,"*"===t){if(t=s||We(),n.tagName)n=z(t,n);else{var a=[];fe(n,function(e){return a.push(z(t,e))}),n=a}t=0}return function e(n){if(n.tagName){var s,a=X(n,u);t&&a!==t&&(a=t,L(n,u,t)),(s=gt(n,a||n.tagName.toLowerCase(),ae(i)?i():i))&&r.push(s)}else n.length&&fe(n,e)}(n),r}var Xe={},Je=Xe[o]={},Qe=0;function Ze(e,t,i){if(oe(e))Ze("__"+Qe+++"__",e,!0);else{var n=i?Je:Xe;if(!t){if(G(n[e]))throw new Error("Unregistered mixin: "+e);return n[e]}n[e]=ae(t)?H(t.prototype,n[e]||{})&&t:H(n[e]||{},t)}}function $e(){return fe(s,function(e){return e.update()})}function et(e){return k.remove(e),delete r[e]}var tt=Object.freeze({Tag:Ke,tag:ze,tag2:Ye,mount:qe,mixin:Ze,update:$e,unregister:et,version:"v3.13.1"});function it(e,t){var i,n=this.parent;n&&(de(i=n.tags[e])?i.splice(t,0,i.splice(i.indexOf(this),1)[0]):Ae(n.tags,e,this))}function nt(e,t){for(var i,n=this.__.head,s=$();n;)if(i=n.nextSibling,s.appendChild(n),(n=i)===this.__.tail){s.appendChild(n),e.insertBefore(s,t.__.head);break}}function st(e,t,i){var n={};return n[e.key]=t,e.pos&&(n[e.pos]=i),n}function rt(e,t){e.splice(t,1),this.unmount(),je(this.parent,this,this.__.tagName,!0)}function at(e,t,i){var n=typeof X(e,p)!==m||J(e,p),s=X(e,g),a=!!s&&j.hasExpr(s),o=be(e),l=r[o],d=e.parentNode,u=Y(),f=Se(e),v=X(e,c),_=[],y=e.innerHTML,A=!r[o],S="VIRTUAL"===e.tagName,b=[];return J(e,h),J(e,g),(i=j.loopKeys(i)).isLoop=!0,v&&J(e,c),d.insertBefore(u,e),d.removeChild(e),i.update=function(){i.value=j(i.val,t);var r=i.value,d=$(),c=!de(r)&&!ce(r),h=u.parentNode,p=[],g=c&&!!r;if(h){c&&(r=r?Object.keys(r).map(function(e){return st(i,r[e],e)}):[]);var m=0;fe(r,function(u,T){var D=T-m,C=!g&&i.key?st(i,u,T):u;if(!v||j(v,H(W(t),C))){var I=function(e,t,i,n){return e?a?j(e,C):t[e]:t}(s,u),R=!c&&n&&typeof u===E||s,P=b.indexOf(I),M=-1===P,O=!M&&R?P:D,L=_[O],w=D>=b.length,N=R&&M||!R&&!L||!_[D];N?((L=vt(l,{parent:t,isLoop:!0,isAnonymous:A,tagName:o,root:e.cloneNode(A),item:C,index:D},y)).mount(),w?function(e,t){t?xe.call(this,e):e.appendChild(this.root)}.apply(L,[d||h,S]):function(e,t,i){i?xe.apply(this,[e,t]):ee(e,this.root,t.root)}.apply(L,[h,_[D],S]),w||b.splice(D,0,C),_.splice(D,0,L),f&&Ae(t.tags,o,L,!0)):O!==D&&R&&((s||pe(r,b[O]))&&(function(e,t,i){i?nt.apply(this,[e,t]):ee(e,this.root,t.root)}.apply(L,[h,_[D],S]),_.splice(D,0,_.splice(O,1)[0]),b.splice(D,0,b.splice(O,1)[0])),i.pos&&(L[i.pos]=D),!f&&L.tags&&function(e){var t=this;fe(Object.keys(this.tags),function(i){it.apply(t.tags[i],[i,e])})}.call(L,D)),H(L.__,{item:C,index:D,parent:t}),p[D]=I,N||L.update(C)}else m++}),function(e,t,i){for(var n=t.length,s=e.length-i;n>s;)n--,rt.apply(t[n],[t,n])}(r,_,m),b=p.slice(),h.insertBefore(d,u)}},i.unmount=function(){fe(_,function(e){e.unmount()})},i}var ot={init:function(e,t,i,n){return this.dom=e,this.attr=i,this.rawValue=n,this.parent=t,this.hasExp=j.hasExpr(n),this},update:function(){var e=this.value,t=this.parent&&ke(this.parent),i=this.dom.__ref||this.tag||this.dom;this.value=this.hasExp?j(this.rawValue,this.parent):this.rawValue,!re(e)&&t&&je(t.refs,e,i),!re(this.value)&&ce(this.value)?(t&&Ae(t.refs,this.value,i,null,this.parent.__.index),this.value!==e&&L(this.dom,this.attr,this.value)):J(this.dom,this.attr),this.dom.__ref||(this.dom.__ref=i)},unmount:function(){var e=this.tag||this.dom,t=this.parent&&ke(this.parent);!re(this.value)&&t&&je(t.refs,this.value,e)}};function lt(e,t,i,n){return W(ot).init(e,t,i,n)}function dt(e){fe(e,function(e){e.unmount?e.unmount(!0):e.tagName?e.tag.unmount(!0):e.unmount&&e.unmount()})}var ut={init:function(e,t,i){J(e,c),H(this,{tag:t,expr:i,stub:Y(),pristine:e});var n=e.parentNode;return n.insertBefore(this.stub,e),n.removeChild(e),this},update:function(){this.value=j(this.expr,this.tag),this.stub.parentNode&&(this.value&&!this.current?(this.current=this.pristine.cloneNode(!0),this.stub.parentNode.insertBefore(this.current,this.stub),this.expressions=ht.apply(this.tag,[this.current,!0])):!this.value&&this.current&&(this.unmount(),this.current=null,this.expressions=[]),this.value&&Ve.call(this.tag,this.expressions))},unmount:function(){this.current&&(this.current._tag?this.current._tag.unmount():this.current.parentNode&&this.current.parentNode.removeChild(this.current)),dt(this.expressions||[])}};function ct(e,t,i){return W(ut).init(e,t,i)}function ht(e,t){var i=this,n=[];return ie(e,function(s){var r,a,o=s.nodeType;if((t||s!==e)&&(3===o&&"STYLE"!==s.parentNode.tagName&&j.hasExpr(s.nodeValue)&&n.push({dom:s,expr:s.nodeValue}),1===o)){var l="VIRTUAL"===s.tagName;if(r=X(s,h))return l&&L(s,"loopVirtual",!0),n.push(at(s,i,r)),!1;if(r=X(s,c))return n.push(ct(s,i,r)),!1;if((r=X(s,u))&&j.hasExpr(r))return n.push({isRtag:!0,expr:r,dom:s,attrs:[].slice.call(s.attributes)}),!1;if(a=Se(s),l&&(X(s,"virtualized")&&s.parentElement.removeChild(s),a||X(s,"virtualized")||X(s,"loopVirtual")||(a={tmpl:s.outerHTML})),a&&(s!==e||t)){var d=X(s,u);if(!l||d)return d&&l&&Ee("Virtual tags shouldn't be used together with the \""+u+'" attribute - https://github.com/riot/riot/issues/2511'),n.push(Ue(a,{root:s,parent:i},s.innerHTML,i)),!1;L(s,"virtualized",!0);var p=vt({tmpl:s.outerHTML},{root:s,parent:i},s.innerHTML);n.push(p)}pt.apply(i,[s,s.attributes,function(e,t){t&&n.push(t)}])}}),n}function pt(e,t,i){var n=this;fe(t,function(t){if(!t)return!1;var s,r=t.name,o=ue(r);pe(d,r)&&e.tagName.toLowerCase()!==a?s=lt(e,n,r,t.value):j.hasExpr(t.value)&&(s={dom:e,expr:t.value,attr:r,bool:o}),i(t,s)})}function ft(e){var t=this.__,i=t.isAnonymous,n=t.skipAnonymous;_e(this,"isMounted",e),i&&n||(e?this.trigger("mount"):(this.trigger("unmount"),this.off("*"),this.__.wasCreated=!1))}function vt(e,t,i){void 0===e&&(e={}),void 0===t&&(t={});var n,r=t.context||{},a=t.opts||{},d=t.parent,u=t.isLoop,c=!!t.isAnonymous,h=K.skipAnonymousTags&&c,p=t.item,f=t.index,v=e.tmpl,g=[],m=t.root,E=t.tagName||be(m),y="virtual"===E,A=!y&&!v;return A||u&&c?n=m:(y||(m.innerHTML=""),n=we(v,i,le(m))),h||x(r),e.name&&m._tag&&m._tag.unmount(!0),_e(r,"__",{impl:e,root:m,skipAnonymous:h,implAttrs:[],isAnonymous:c,instAttrs:[],innerHTML:i,tagName:E,index:f,isLoop:u,isInline:A,item:p,parent:d,listeners:[],virts:[],wasCreated:!1,tail:null,head:null}),[["isMounted",!1],["_riot_id",ge()],["root",m],["opts",a,{writable:!0,enumerable:!0}],["parent",d||null],["tags",{}],["refs",{}],["update",function(e){return function(e,t,i){var n=e.__,s={},r=e.isMounted&&!n.skipAnonymous;return n.isAnonymous&&n.parent&&H(e,n.parent),H(e,t),He.apply(e,[n.isLoop,n.parent,n.isAnonymous,s,n.instAttrs]),r&&e.isMounted&&ae(e.shouldUpdate)&&!e.shouldUpdate(t,s)?e:(H(e.opts,s),r&&e.trigger("update",t),Ve.call(e,i),r&&e.trigger("updated"),e)}(r,e,g)}],["mixin",function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return function(e){for(var t=[],i=arguments.length-1;i-- >0;)t[i]=arguments[i+1];return fe(t,function(t){var i,n,s=[],r=["init","__proto__"];t=ce(t)?Ze(t):t,i=ae(t)?new t:t;var a=Object.getPrototypeOf(i);do{s=s.concat(Object.getOwnPropertyNames(n||i))}while(n=Object.getPrototypeOf(n||i));fe(s,function(t){if(!pe(r,t)){var n=F(i,t)||F(a,t),s=n&&(n.get||n.set);!e.hasOwnProperty(t)&&s?Object.defineProperty(e,t,n):e[t]=ae(i[t])?i[t].bind(e):i[t]}}),i.init&&i.init.bind(e)(e.opts)}),e}.apply(void 0,[r].concat(e))}],["mount",function(){return function(e,t,i,n){var s=e.__,r=s.root;r._tag=e,pt.apply(s.parent,[r,r.attributes,function(t,i){!s.isAnonymous&&ot.isPrototypeOf(i)&&(i.tag=e),t.expr=i,s.instAttrs.push(t)}]),Z(s.impl.attrs,function(e,t){s.implAttrs.push({name:e,value:t})}),pt.apply(e,[r,s.implAttrs,function(e,t){t?i.push(t):L(r,e.name,e.value)}]),He.apply(e,[s.isLoop,s.parent,s.isAnonymous,n,s.instAttrs]);var a=Ze(o);if(a&&!s.skipAnonymous)for(var l in a)a.hasOwnProperty(l)&&e.mixin(a[l]);if(s.impl.fn&&s.impl.fn.call(e,n),s.skipAnonymous||e.trigger("before-mount"),fe(ht.apply(e,[t,s.isAnonymous]),function(e){return i.push(e)}),e.update(s.item),!s.isAnonymous&&!s.isInline)for(;t.firstChild;)r.appendChild(t.firstChild);if(_e(e,"root",r),!s.skipAnonymous&&e.parent){var d=ke(e.parent);d.one(d.isMounted?"updated":"mount",function(){ft.call(e,!0)})}else ft.call(e,!0);return e.__.wasCreated=!0,e}(r,n,g,a)}],["unmount",function(e){return function(e,t,i){var n=e.__,r=n.root,a=s.indexOf(e),o=r.parentNode;if(n.skipAnonymous||e.trigger("before-unmount"),Z(n.impl.attrs,function(e){ve(e,l)&&(e=e.slice(l.length)),J(r,e)}),e.__.listeners.forEach(function(e){Object.keys(e[_]).forEach(function(t){e.removeEventListener(t,e[_][t])})}),-1!==a&&s.splice(a,1),n.parent&&!n.isAnonymous){var d=ke(n.parent);n.isVirtual?Object.keys(e.tags).forEach(function(t){return je(d.tags,t,e.tags[t])}):je(d.tags,n.tagName,e)}return e.__.virts&&fe(e.__.virts,function(e){e.parentNode&&e.parentNode.removeChild(e)}),dt(i),fe(n.instAttrs,function(e){return e.expr&&e.expr.unmount&&e.expr.unmount()}),t?Q(r,""):o&&o.removeChild(r),n.onUnmount&&n.onUnmount(),e.isMounted||ft.call(e,!0),ft.call(e,!1),delete r._tag,e}(r,e,g)}]].reduce(function(e,t){var i=t[0],n=t[1],s=t[2];return _e(r,i,n,s),e},H(r,p))}function gt(e,t,i,n){var a,o=r[t],l=r[t].class,d=n||(l?W(l.prototype):{}),u=e._innerHTML=e._innerHTML||e.innerHTML,c=H({root:e,opts:i,context:d},{parent:i?i.parent:null});return o&&e&&(a=vt(o,c,u)),a&&a.mount&&(a.mount(!0),pe(s,a)||s.push(a)),a}var _t=Object.freeze({arrayishAdd:Ae,getTagName:be,inheritParentProps:Te,mountTo:gt,selectTags:We,arrayishRemove:je,getTag:Se,initChildTag:Ue,moveChildTag:it,makeReplaceVirtual:Fe,getImmediateCustomParentTag:ke,makeVirtual:xe,moveVirtual:nt,unmountAll:dt,createIfDirective:ct,createRefDirective:lt}),mt=K,Et={tmpl:j,brackets:U,styleManager:k,vdom:s,styleNode:k.styleNode,dom:ne,check:he,misc:ye,tags:_t},yt=Ke,At=ze,St=Ye,bt=qe,Tt=Ze,Dt=$e,Ct=et,It=x,Rt=H({},tt,{observable:x,settings:mt,util:Et});e.settings=mt,e.util=Et,e.Tag=yt,e.tag=At,e.tag2=St,e.mount=bt,e.mixin=Tt,e.update=Dt,e.unregister=Ct,e.version="v3.13.1",e.observable=It,e.default=Rt,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,i){var n,s;n=[t,i(0)],void 0===(s=function(e,t){"use strict";function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=function(e){return e&&e.__esModule?e:{default:e}}(t),window.location.hash;var n=/development/.test(window.location.hash),s=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._broker={},t.default.observable(this._broker)}return function(e,t,n){t&&i(e.prototype,t)}(e,[{key:"on",value:function(e,t){this._broker.on(e,t)}},{key:"off",value:function(e,t){this._broker.off(e,t)}},{key:"one",value:function(e,t){this._broker.one(e,t)}},{key:"trigger",value:function(){var e=this,t=[].slice.call(arguments);n&&window.console&&console.log('triggered: "'+t[0]+'" with payload:\n',t[1]),setTimeout(function(){try{e._broker.trigger.apply(e._broker,t)}catch(e){window.console&&console.error(t,e)}},0)}}]),e}());e.default=s}.apply(t,n))||(e.exports=s)},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,i){var n=i(22)("wks"),s=i(16),r=i(2).Symbol,a="function"==typeof r;(e.exports=function(e){return n[e]||(n[e]=a&&r[e]||(a?r:s)("Symbol."+e))}).store=n},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t,i){var n=i(2),s=i(15),r=i(7),a=i(20),o=i(24),l=function(e,t,i){var d,u,c,h,p=e&l.F,f=e&l.G,v=e&l.S,g=e&l.P,_=e&l.B,m=f?n:v?n[t]||(n[t]={}):(n[t]||{}).prototype,E=f?s:s[t]||(s[t]={}),y=E.prototype||(E.prototype={});for(d in f&&(i=t),i)c=((u=!p&&m&&void 0!==m[d])?m:i)[d],h=_&&u?o(c,n):g&&"function"==typeof c?o(Function.call,c):c,m&&a(m,d,c,e&l.U),E[d]!=c&&r(E,d,h),g&&y[d]!=c&&(y[d]=c)};n.core=s,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,i){var n=i(9),s=i(19);e.exports=i(11)?function(e,t,i){return n.f(e,t,s(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t,i){var n=i(42),s=i(44);e.exports=function(e){return n(s(e))}},function(e,t,i){var n=i(10),s=i(39),r=i(23),a=Object.defineProperty;t.f=i(11)?Object.defineProperty:function(e,t,i){if(n(e),t=r(t,!0),n(i),s)try{return a(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t,i){var n=i(4);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,i){e.exports=!i(17)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,i){var n=i(41),s=i(27);e.exports=Object.keys||function(e){return n(e,s)}},function(e,t,i){i(37)("asyncIterator")},function(e,t,i){"use strict";var n=i(2),s=i(5),r=i(11),a=i(6),o=i(20),l=i(57).KEY,d=i(17),u=i(22),c=i(25),h=i(16),p=i(3),f=i(38),v=i(37),g=i(58),_=i(48),m=i(10),E=i(4),y=i(8),A=i(23),S=i(19),b=i(49),T=i(63),D=i(28),C=i(9),I=i(12),R=D.f,P=C.f,M=T.f,O=n.Symbol,L=n.JSON,w=L&&L.stringify,N=p("_hidden"),k=p("toPrimitive"),B={}.propertyIsEnumerable,U=u("symbol-registry"),j=u("symbols"),x=u("op-symbols"),F=Object.prototype,G="function"==typeof O,V=n.QObject,H=!V||!V.prototype||!V.prototype.findChild,W=r&&d(function(){return 7!=b(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(e,t,i){var n=R(F,t);n&&delete F[t],P(e,t,i),n&&e!==F&&P(F,t,n)}:P,K=function(e){var t=j[e]=b(O.prototype);return t._k=e,t},z=G&&"symbol"==typeof O.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof O},Y=function(e,t,i){return e===F&&Y(x,t,i),m(e),t=A(t,!0),m(i),s(j,t)?(i.enumerable?(s(e,N)&&e[N][t]&&(e[N][t]=!1),i=b(i,{enumerable:S(0,!1)})):(s(e,N)||P(e,N,S(1,{})),e[N][t]=!0),W(e,t,i)):P(e,t,i)},q=function(e,t){m(e);for(var i,n=g(t=y(t)),s=0,r=n.length;r>s;)Y(e,i=n[s++],t[i]);return e},X=function(e){var t=B.call(this,e=A(e,!0));return!(this===F&&s(j,e)&&!s(x,e))&&(!(t||!s(this,e)||!s(j,e)||s(this,N)&&this[N][e])||t)},J=function(e,t){if(e=y(e),t=A(t,!0),e!==F||!s(j,t)||s(x,t)){var i=R(e,t);return!i||!s(j,t)||s(e,N)&&e[N][t]||(i.enumerable=!0),i}},Q=function(e){for(var t,i=M(y(e)),n=[],r=0;i.length>r;)s(j,t=i[r++])||t==N||t==l||n.push(t);return n},Z=function(e){for(var t,i=e===F,n=M(i?x:y(e)),r=[],a=0;n.length>a;)!s(j,t=n[a++])||i&&!s(F,t)||r.push(j[t]);return r};G||(o((O=function(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(i){this===F&&t.call(x,i),s(this,N)&&s(this[N],e)&&(this[N][e]=!1),W(this,e,S(1,i))};return r&&H&&W(F,e,{configurable:!0,set:t}),K(e)}).prototype,"toString",function(){return this._k}),D.f=J,C.f=Y,i(50).f=T.f=Q,i(21).f=X,i(47).f=Z,r&&!i(18)&&o(F,"propertyIsEnumerable",X,!0),f.f=function(e){return K(p(e))}),a(a.G+a.W+a.F*!G,{Symbol:O});for(var $="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;$.length>ee;)p($[ee++]);for(var te=I(p.store),ie=0;te.length>ie;)v(te[ie++]);a(a.S+a.F*!G,"Symbol",{for:function(e){return s(U,e+="")?U[e]:U[e]=O(e)},keyFor:function(e){if(!z(e))throw TypeError(e+" is not a symbol!");for(var t in U)if(U[t]===e)return t},useSetter:function(){H=!0},useSimple:function(){H=!1}}),a(a.S+a.F*!G,"Object",{create:function(e,t){return void 0===t?b(e):q(b(e),t)},defineProperty:Y,defineProperties:q,getOwnPropertyDescriptor:J,getOwnPropertyNames:Q,getOwnPropertySymbols:Z}),L&&a(a.S+a.F*(!G||d(function(){var e=O();return"[null]"!=w([e])||"{}"!=w({a:e})||"{}"!=w(Object(e))})),"JSON",{stringify:function(e){for(var t,i,n=[e],s=1;arguments.length>s;)n.push(arguments[s++]);if(i=t=n[1],(E(t)||void 0!==e)&&!z(e))return _(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!z(t))return t}),n[1]=t,w.apply(L,n)}}),O.prototype[k]||i(7)(O.prototype,k,O.prototype.valueOf),c(O,"Symbol"),c(Math,"Math",!0),c(n.JSON,"JSON",!0)},function(e,t){var i=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=i)},function(e,t){var i=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+n).toString(36))}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=!1},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,i){var n=i(2),s=i(7),r=i(5),a=i(16)("src"),o=Function.toString,l=(""+o).split("toString");i(15).inspectSource=function(e){return o.call(e)},(e.exports=function(e,t,i,o){var d="function"==typeof i;d&&(r(i,"name")||s(i,"name",t)),e[t]!==i&&(d&&(r(i,a)||s(i,a,e[t]?""+e[t]:l.join(String(t)))),e===n?e[t]=i:o?e[t]?e[t]=i:s(e,t,i):(delete e[t],s(e,t,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[a]||o.call(this)})},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){var n=i(15),s=i(2),r=s["__core-js_shared__"]||(s["__core-js_shared__"]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:i(18)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(e,t,i){var n=i(4);e.exports=function(e,t){if(!n(e))return e;var i,s;if(t&&"function"==typeof(i=e.toString)&&!n(s=i.call(e)))return s;if("function"==typeof(i=e.valueOf)&&!n(s=i.call(e)))return s;if(!t&&"function"==typeof(i=e.toString)&&!n(s=i.call(e)))return s;throw TypeError("Can't convert object to primitive value")}},function(e,t,i){var n=i(56);e.exports=function(e,t,i){if(n(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,s){return e.call(t,i,n,s)}}return function(){return e.apply(t,arguments)}}},function(e,t,i){var n=i(9).f,s=i(5),r=i(3)("toStringTag");e.exports=function(e,t,i){e&&!s(e=i?e:e.prototype,r)&&n(e,r,{configurable:!0,value:t})}},function(e,t,i){var n=i(22)("keys"),s=i(16);e.exports=function(e){return n[e]||(n[e]=s(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,i){var n=i(21),s=i(19),r=i(8),a=i(23),o=i(5),l=i(39),d=Object.getOwnPropertyDescriptor;t.f=i(11)?d:function(e,t){if(e=r(e),t=a(t,!0),l)try{return d(e,t)}catch(e){}if(o(e,t))return s(!n.f.call(e,t),e[t])}},function(e,t,i){var n=i(28),s=i(51),r=i(5),a=i(6),o=i(4),l=i(10);a(a.S,"Reflect",{get:function e(t,i){var a,d,u=arguments.length<3?t:arguments[2];return l(t)===u?t[i]:(a=n.f(t,i))?r(a,"value")?a.value:void 0!==a.get?a.get.call(u):void 0:o(d=s(t))?e(d,i,u):void 0}})},function(e,t,i){var n=i(44);e.exports=function(e){return Object(n(e))}},function(e,t,i){var n=i(6);n(n.S,"Object",{setPrototypeOf:i(64).set})},function(e,t,i){"use strict";var n=i(52),s=i(66),r=i(33),a=i(8);e.exports=i(67)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,s(1)):s(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])},"values"),r.Arguments=r.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports={}},function(e,t,i){"use strict";var n=i(6),s=i(69)(5),r=!0;"find"in[]&&Array(1).find(function(){r=!1}),n(n.P+n.F*r,"Array",{find:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),i(52)("find")},function(e,t,i){var n,s;n=[t,i(1)],void 0===(s=function(e,t){"use strict";function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.BaseFeedAdapter=void 0,t=function(e){return e&&e.__esModule?e:{default:e}}(t);var n=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructor===e)throw new TypeError('Abstract class "BaseFeedAdapter" cannot be instantiated directly.');this.event=t.event,this.lastUpdated=null,this.pendingFeeds={},this.isLocked=!0}return function(e,t,n){t&&i(e.prototype,t)}(e,[{key:"getNewFeed",value:function(e){e?e in this.pendingFeeds?t.default.trigger("feed:debounce",{feedUrl:e}):(this.pendingFeeds[e]=1,this.isLocked||this.fetch(e)):t.default.trigger("feed:error",{feedUrl:e,error:"attempted to call a blank feed"})}},{key:"fetch",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var i=this;fetch(e,{credentials:"same-origin"}).then(function(i){if(i.ok)return i;t.default.trigger("feed:error",{feedUrl:e,error:"response is not ok",response:i})}).then(function(e){return i.unifyFormat(e)}).then(function(e){return i.dispatchFeed(e)}).then(function(t){return delete i.pendingFeeds[e]}).catch(function(e){return window.console&&console.error("err: ",e)})})},{key:"unifyFormat",value:function(e){return e.json()}},{key:"dispatchFeed",value:function(e){return t.default.trigger(this.event,{feed:e}),e}},{key:"registerCallbacks",value:function(){var e=this;t.default.on("player:player:initialUrlLoad",function(t){for(var i in e.isLocked=!1,e.pendingFeeds)e.fetch(i)})}}]),e}();e.BaseFeedAdapter=n}.apply(t,n))||(e.exports=s)},function(e,t,i){for(var n=i(32),s=i(12),r=i(20),a=i(2),o=i(7),l=i(33),d=i(3),u=d("iterator"),c=d("toStringTag"),h=l.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=s(p),v=0;v<f.length;v++){var g,_=f[v],m=p[_],E=a[_],y=E&&E.prototype;if(y&&(y[u]||o(y,u,h),y[c]||o(y,c,_),l[_]=h,m))for(g in n)y[g]||r(y,g,n[g],!0)}},function(e,t,i){var n=i(2),s=i(15),r=i(18),a=i(38),o=i(9).f;e.exports=function(e){var t=s.Symbol||(s.Symbol=r?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:a.f(e)})}},function(e,t,i){t.f=i(3)},function(e,t,i){e.exports=!i(11)&&!i(17)(function(){return 7!=Object.defineProperty(i(40)("div"),"a",{get:function(){return 7}}).a})},function(e,t,i){var n=i(4),s=i(2).document,r=n(s)&&n(s.createElement);e.exports=function(e){return r?s.createElement(e):{}}},function(e,t,i){var n=i(5),s=i(8),r=i(59)(!1),a=i(26)("IE_PROTO");e.exports=function(e,t){var i,o=s(e),l=0,d=[];for(i in o)i!=a&&n(o,i)&&d.push(i);for(;t.length>l;)n(o,i=t[l++])&&(~r(d,i)||d.push(i));return d}},function(e,t,i){var n=i(43);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,i){var n=i(46),s=Math.min;e.exports=function(e){return e>0?s(n(e),9007199254740991):0}},function(e,t){var i=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:i)(e)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,i){var n=i(43);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,i){var n=i(10),s=i(61),r=i(27),a=i(26)("IE_PROTO"),o=function(){},l=function(){var e,t=i(40)("iframe"),n=r.length;for(t.style.display="none",i(62).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;n--;)delete l.prototype[r[n]];return l()};e.exports=Object.create||function(e,t){var i;return null!==e?(o.prototype=n(e),i=new o,o.prototype=null,i[a]=e):i=l(),void 0===t?i:s(i,t)}},function(e,t,i){var n=i(41),s=i(27).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,s)}},function(e,t,i){var n=i(5),s=i(30),r=i(26)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=s(e),n(e,r)?e[r]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,i){var n=i(3)("unscopables"),s=Array.prototype;null==s[n]&&i(7)(s,n,{}),e.exports=function(e){s[n][e]=!0}},function(e,t,i){var n;void 0===(n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getCookie=function(e){var t,i,n,s=document.cookie.split(";");for(t=0;t<s.length;t++)if(i=(i=s[t].substr(0,s[t].indexOf("="))).replace(/^\s+|\s+$/g,""),n=s[t].substr(s[t].indexOf("=")+1),i==e)return unescape(n);return null}}.apply(t,[t]))||(e.exports=n)},function(e,t,i){var n,s;n=[t,i(13),i(14),i(29),i(31),i(34),i(32),i(72),i(1),i(35),i(53)],void 0===(s=function(e,t,i,n,s,r,a,o,l,d,u){"use strict";function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t,i){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i):s.value}})(e,t,i||e)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.FusionFeedAdapter=void 0,l=function(e){return e&&e.__esModule?e:{default:e}}(l);var _=function(e){function t(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=p(this,v(t).call(this,{event:"feed:ingested:playlist"})),e.fusionRundown?(i.liveItem={canonicalTitle:e.canonicalTitle,fulltitle:e.fulltitle,title:e.title,url:e.url},i.fusionRundown=e.fusionRundown,i.feedUrl=e.fusionRundown+"&partner=cbsnsite",i.playlist={items:[]},i.liveSource=e.video,i.liveSourceNoAds=e.video2,i.liveSlug=e.slug.replace(/^live-/,""),i.topic=e.topic,i.tracking=e.tracking,i.isLocked=!1,i.registerCallbacks(),i):p(i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,d.BaseFeedAdapter),function(e,t,i){t&&h(e.prototype,t)}(t,[{key:"unifyFormat",value:function(e){var i=this;return f(v(t.prototype),"unifyFormat",this).call(this,e).then(function(e){return i.convertFeed(e)})}},{key:"convertFeed",value:function(e){for(var t=Object.values(e.navigation.rundown.counts).reduce(function(e,t){return e+t}),i={id:"fusion-"+this.liveSlug,slug:this.liveSlug,type:"channel",title:this.liveItem.fulltitle,items:[],url:this.liveItem.url,meta:{fusionRundown:this.feedUrl,dateUpdated:e.navigation.dateUpdated.date,limit:null,itemCount:t,totalCount:t,loadMore:!1,custom:null,image:null,strategy:{method:"replace",startPosition:0,deleteCount:this.playlist.items.length}}},n=0;n<t;n++){var s=e.navigation.data[n];s&&("dvr"!=s.type&&"live"!=s.type||i.items.push({id:s.id,mpxRefId:s.mpxRefId,slug:s.dvr_slug,title:s.headlineshort,fulltitle:s.headline,canonicalTitle:"live"===s.type?this.liveItem.canonicalTitle+" Live Video":s.headlineshort,label:s.slug_label,type:s.type,duration:"live"===s.type?-1:s.duration,timestamp:s.startDate,durationLabel:s.segmentDur,url:s.path,images:{sd:s.images.thumbnail_url_hd,hd:s.images.thumbnail_url_hd},video:"live"===s.type?this.liveSource:s.videoUrl.base,video2:"live"===s.type?this.liveSourceNoAds:s.videoUrl.base,playlist:i,topic:this.topic,suppress:"adsEnabled"in s?!s.adsEnabled:null,allAccessBlock:!1,isUserSubscribed:null,sponsor:s.sponsor,fusionRundown:this.fusionRundown,tracking:this.tracking}),"live"==s.type&&(i.mpxRefId=s.mpxRefId,i.video=this.liveSource,i.video2=this.liveSourceNoAds,i.hasVideo=!0))}return i}},{key:"dispatchFeed",value:function(e){var i=this.playlist.items.find(function(e){return"live"===e.type}),n=e.items.find(function(e){return"live"===e.type});return i&&n&&i.id===n.id&&this.playlist.items.length===e.items.length||(f(v(t.prototype),"dispatchFeed",this).call(this,e),n&&(l.default.trigger("video:video:changed",{video:n}),l.default.trigger("video:video:changed:type-live",{video:n}),l.default.trigger("video:video:changed:type-live:"+n.playlist.id,{video:n}))),e}},{key:"registerCallbacks",value:function(){var e=this,i=JSON.parse((0,u.getCookie)("fly_geo"));(!i||"au"!==i.countryCode&&"nz"!==i.countryCode)&&(f(v(t.prototype),"registerCallbacks",this).call(this),l.default.on("video:data:changed:fusion-"+this.liveSlug,function(t){return e.playlist=t.playlist}),this.getNewFeed(this.feedUrl),setInterval(this.getNewFeed.bind(this,this.feedUrl),15e3))}}]),t}();e.FusionFeedAdapter=_}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[t,i(13),i(14),i(29),i(31),i(1),i(35)],void 0===(s=function(e,t,i,n,s,r,a){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i):s.value}})(e,t,i||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.VideoFeedAdapter=void 0,r=function(e){return e&&e.__esModule?e:{default:e}}(r);var h=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,u(t).call(this,{event:"feed:ingested:playlist"}))).registerCallbacks(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,a.BaseFeedAdapter),function(e,t,i){t&&l(e.prototype,t)}(t,[{key:"dispatchFeed",value:function(e){return r.default.trigger(this.event,{feed:e,path:this.path}),e}},{key:"registerCallbacks",value:function(){var e=this;d(u(t.prototype),"registerCallbacks",this).call(this);var i=!(-1==document.cookie.indexOf("fly_user"));CBSNEWS.user.isUserSubscribed&&(i="2"),r.default.on("feed:request:playlist",function(t){t.slug&&t.slug.indexOf("fusion")>-1||!t.type||!t.api||e.getNewFeed(t.api+"?is_logged_in="+ +i)}),r.default.on("feed:request:video",function(t){if("vod"===t.type&&(t.id||t.slug)){var n="0";t.imposter&&(n="1");var s="";t.strategy&&(s="&strategy="+t.strategy);var r="";t.startPosition&&(r="&startPosition="+t.startPosition);var a=t.type;e.getNewFeed("/video/xhr/video/"+a+"/"+(t.id||t.slug)+"/?is_logged_in="+ +i+"&is_imposter="+n+s+r)}}),r.default.on("feed:request:path",function(t){if(t.path){var n="0";t.imposter&&(n="1");var s="";t.strategy&&(s="&strategy="+t.strategy);var r="";t.startPosition&&(r="&startPosition="+t.startPosition),t.type,e.path=t.path,e.getNewFeed("/video/xhr/path"+t.path+"?is_logged_in="+ +i+"&is_imposter="+n+s+r)}})}}]),t}();e.VideoFeedAdapter=h}.apply(t,n))||(e.exports=s)},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,i){var n=i(16)("meta"),s=i(4),r=i(5),a=i(9).f,o=0,l=Object.isExtensible||function(){return!0},d=!i(17)(function(){return l(Object.preventExtensions({}))}),u=function(e){a(e,n,{value:{i:"O"+ ++o,w:{}}})},c=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!s(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!r(e,n)){if(!l(e))return"F";if(!t)return"E";u(e)}return e[n].i},getWeak:function(e,t){if(!r(e,n)){if(!l(e))return!0;if(!t)return!1;u(e)}return e[n].w},onFreeze:function(e){return d&&c.NEED&&l(e)&&!r(e,n)&&u(e),e}}},function(e,t,i){var n=i(12),s=i(47),r=i(21);e.exports=function(e){var t=n(e),i=s.f;if(i)for(var a,o=i(e),l=r.f,d=0;o.length>d;)l.call(e,a=o[d++])&&t.push(a);return t}},function(e,t,i){var n=i(8),s=i(45),r=i(60);e.exports=function(e){return function(t,i,a){var o,l=n(t),d=s(l.length),u=r(a,d);if(e&&i!=i){for(;d>u;)if((o=l[u++])!=o)return!0}else for(;d>u;u++)if((e||u in l)&&l[u]===i)return e||u||0;return!e&&-1}}},function(e,t,i){var n=i(46),s=Math.max,r=Math.min;e.exports=function(e,t){return(e=n(e))<0?s(e+t,0):r(e,t)}},function(e,t,i){var n=i(9),s=i(10),r=i(12);e.exports=i(11)?Object.defineProperties:function(e,t){s(e);for(var i,a=r(t),o=a.length,l=0;o>l;)n.f(e,i=a[l++],t[i]);return e}},function(e,t,i){var n=i(2).document;e.exports=n&&n.documentElement},function(e,t,i){var n=i(8),s=i(50).f,r={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==r.call(e)?function(e){try{return s(e)}catch(e){return a.slice()}}(e):s(n(e))}},function(e,t,i){var n=i(4),s=i(10),r=function(e,t){if(s(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=i(24)(Function.call,i(28).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return r(e,i),t?e.__proto__=i:n(e,i),e}}({},!1):void 0),check:r}},function(e,t,i){var n,s;n=[t,i(13),i(14),i(36),i(1),i(54)],void 0===(s=function(e,t,i,n,s,r){"use strict";function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.VideoStore=void 0,s=function(e){return e&&e.__esModule?e:{default:e}}(s);var o={},l={},d=1e3,u={};function c(e){var t="video:data:changed",i={_playlist_id:e.__id,playlist:e};s.default.trigger(t,i),e.id&&s.default.trigger("".concat(t,":").concat(e.id),i),e.slug&&s.default.trigger("".concat(t,":").concat(e.slug),i)}function h(e,t){return e.type+"/"+e[t]}function p(e){var t,i=h(e,"id"),n=h(e,"slug");i in l?t=l[i]:n in l?t=l[n]:(t=++d,o[t]={__id:t,__lastUpdated:null,id:null,items:[],itemIndexById:{},meta:{dateUpdated:null,hash:null}});var s=[],a=e.meta.strategy;switch(a.method){case"replace":s=function(e,t,i){var n=o[e].items;return Array.prototype.splice.apply(n,[i.startPosition,i.deleteCount||n.length].concat(t.items)),n}(t,e,a);break;case"inject":s=function(e,t,i){var n=o[e].items;return Array.prototype.splice.apply(n,[i.startPosition,0].concat(t.items)),n}(t,e,a);break;case"append":default:s=function(e,t,i){var n=o[e].items,s=!0,r=!1,a=void 0;try{for(var l,d=t.items[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var u=l.value;u.id&&u.id in o[e].itemIndexById||n.push(u)}}catch(e){r=!0,a=e}finally{try{s||null==d.return||d.return()}finally{if(r)throw a}}return n}(t,e)}for(var v in e)e[v]&&(o[t][v]=e[v]);o[t].id&&(l[h(o[t],"id")]=t),o[t].slug&&(l[h(o[t],"slug")]=t);for(var g=0,_={},m=0;m<s.length;m++){var E=s[m];"live"!==E.type||u[E.mpxRefId]||(u[E.mpxRefId]=new r.FusionFeedAdapter(E)),"vod"!==E.type&&"dvr"!==E.type&&"live"!==E.type||(E.playlist=o[t]),"playlist"!==E.type&&"listing"!==E.type&&"channel"!==E.type||(p(E),s[m]=f(E.id,E.slug,E.type)||E),E.id&&(_[E.id]=m),E.imposter?g--:g++}o[t].emptyPlaylist=!1,g<1&&(o[t].emptyPlaylist=!0),o[t].items=s,o[t].itemIndexById=_,o[t].__lastUpdated=Date.now(),c(o[t])}function f(e,t,i){var n;if(e?n=l[i+"/"+e]:t&&i&&(n=l[i+"/"+t]),n&&o[n])return o[n]}var v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.registerCallbacks()}return function(e,t,i){t&&a(e.prototype,t)}(e,[{key:"getVideoInPlaylist",value:function(e,t){var i=this.getPlaylistByIdOrSlug(t);for(var n in i.items){var s=i.items[n];if(s.id==e)return s}return null}},{key:"registerCallbacks",value:function(){s.default.on("feed:ingested:playlist",function(e){return p(e.feed)}),s.default.on("feed:ingested:video",function(e){return function(e){if(e.playlist){var t=f(e.playlist.id,e.playlist.slug,e.playlist.type)||e.playlist;t.items.shift(e),p(t)}}(e.feed)}),s.default.on("register:component",function(e){var t=f(e.id,e.slug,e.type);t&&c(t),t&&t.meta.itemCount===t.meta.totalCount||s.default.trigger("feed:request:playlist",e)})}}]),e}();e.VideoStore=v}.apply(t,n))||(e.exports=s)},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,i){"use strict";var n=i(18),s=i(6),r=i(20),a=i(7),o=i(33),l=i(68),d=i(25),u=i(51),c=i(3)("iterator"),h=!([].keys&&"next"in[].keys()),p=function(){return this};e.exports=function(e,t,i,f,v,g,_){l(i,t,f);var m,E,y,A=function(e){if(!h&&e in D)return D[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},S=t+" Iterator",b="values"==v,T=!1,D=e.prototype,C=D[c]||D["@@iterator"]||v&&D[v],I=C||A(v),R=v?b?A("entries"):I:void 0,P="Array"==t&&D.entries||C;if(P&&(y=u(P.call(new e)))!==Object.prototype&&y.next&&(d(y,S,!0),n||"function"==typeof y[c]||a(y,c,p)),b&&C&&"values"!==C.name&&(T=!0,I=function(){return C.call(this)}),n&&!_||!h&&!T&&D[c]||a(D,c,I),o[t]=I,o[S]=p,v)if(m={values:b?I:A("values"),keys:g?I:A("keys"),entries:R},_)for(E in m)E in D||r(D,E,m[E]);else s(s.P+s.F*(h||T),t,m);return m}},function(e,t,i){"use strict";var n=i(49),s=i(19),r=i(25),a={};i(7)(a,i(3)("iterator"),function(){return this}),e.exports=function(e,t,i){e.prototype=n(a,{next:s(1,i)}),r(e,t+" Iterator")}},function(e,t,i){var n=i(24),s=i(42),r=i(30),a=i(45),o=i(70);e.exports=function(e,t){var i=1==e,l=2==e,d=3==e,u=4==e,c=6==e,h=5==e||c,p=t||o;return function(t,o,f){for(var v,g,_=r(t),m=s(_),E=n(o,f,3),y=a(m.length),A=0,S=i?p(t,y):l?p(t,0):void 0;y>A;A++)if((h||A in m)&&(g=E(v=m[A],A,_),e))if(i)S[A]=g;else if(g)switch(e){case 3:return!0;case 5:return v;case 6:return A;case 2:S.push(v)}else if(u)return!1;return c?-1:d||u?u:S}}},function(e,t,i){var n=i(71);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,i){var n=i(4),s=i(48),r=i(3)("species");e.exports=function(e){var t;return s(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!s(t.prototype)||(t=void 0),n(t)&&null===(t=t[r])&&(t=void 0)),void 0===t?Array:t}},function(e,t,i){var n=i(6),s=i(73)(!1);n(n.S,"Object",{values:function(e){return s(e)}})},function(e,t,i){var n=i(12),s=i(8),r=i(21).f;e.exports=function(e){return function(t){for(var i,a=s(t),o=n(a),l=o.length,d=0,u=[];l>d;)r.call(a,i=o[d++])&&u.push(e?[i,a[i]]:a[i]);return u}}},function(e,t,i){var n,s;n=[t,i(1),i(0),i(75),i(76),i(78),i(79),i(81),i(82)],void 0===(s=function(e,t,i,n,s,r,a,o,l){"use strict";function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.beforeInitialTagMount=function(){var e={initialUrlLoad:!0},i=function(i){if(t.default.trigger("player:player:initialUrlLoad",{initialUrlLoad:e.initialUrlLoad,shouldAutoplay:CBSNEWS.shouldAutoplay}),e.initialUrlLoad){e.initialUrlLoad=!1;var n=CBSNEWS.defaultPayload.items[0],s={video:n,type:n.playlist.type,playlist:n.playlist,initialUrlLoad:!0};t.default.trigger("url:load",s)}},n=CBSNEWS.defaultPayload,s=!(!n.meta||!n.meta.view);t.default.on("player:player:init",i),t.default.on("player:player:ready",i),t.default.on("player:video:state",function(e){if(1==e.uvpEvent.payload.newState){document.body.classList.add("uvp--overlay-hidden"),document.body.classList.add("uvp--is-playing"),document.body.classList.remove("uvp--is-not-playing"),document.body.classList.remove("uvp--is-paused"),document.body.classList.remove("uvp--overlay-closed"),CBSNEWS.frameElementContainer&&CBSNEWS.frameElementContainer.classList.add("embed--is-playing");var t=new CustomEvent("video-embed-event",{detail:{type:"PLAYING",videoShelfType:s&&CBSNEWS.defaultPayload.meta.view}});try{window.parent.dispatchEvent(t)}catch(e){}}else document.body.classList.remove("uvp--is-playing"),document.body.classList.add("uvp--is-not-playing");if(-1==e.uvpEvent.payload.newState){document.body.classList.add("uvp--overlay-hidden"),document.body.classList.remove("uvp--is-paused"),document.body.classList.remove("uvp--overlay-closed"),CBSNEWS.frameElementContainer&&CBSNEWS.frameElementContainer.classList.add("embed--is-playing");var i=new CustomEvent("video-embed-event",{detail:{type:"OPEN",videoShelfType:s&&CBSNEWS.defaultPayload.meta.view}});try{window.parent.dispatchEvent(i)}catch(e){}}2==e.uvpEvent.payload.newState&&(document.body.classList.remove("uvp--overlay-hidden"),document.body.classList.add("uvp--is-paused"))}),t.default.on("player:video:block",function(){document.body.classList.add("uvp--overlay-hidden")}),t.default.on("player:player:closed",function(){document.body.classList.remove("uvp--overlay-hidden"),document.body.classList.add("uvp--overlay-closed");var e=new CustomEvent("video-embed-event",{detail:{type:"CLOSE",videoShelfType:s&&CBSNEWS.defaultPayload.meta.view}});try{window.parent.dispatchEvent(e)}catch(e){}}),t.default.on("url:click",function(){CBSNEWS.frameElementContainer&&CBSNEWS.frameElementContainer.classList.add("embed--is-playing")}),t.default.on("url:change",function(e){return t.default.trigger("url:load",e)}),t.default.on("url:load",function(e){var t=e.video.slug;document.body.setAttribute("data-slug",t)}),CBSNEWS.defaultPayload&&t.default.trigger("feed:ingested:playlist",{feed:CBSNEWS.defaultPayload,isDefaultPayload:!0}),CBSNEWS.defaultLayout&&t.default.trigger("feed:ingested:layout",{feed:CBSNEWS.defaultLayout})},t=d(t),i=d(i),window.riot=i.default,window.isie=-1!=navigator.userAgent.indexOf("Edge")||-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Trident"),window.istablet=window.matchMedia("(min-width: 36em)").matches&&window.istouch;try{document.createEvent("TouchEvent"),window.istouch=!0,document.body.classList.add("touch")}catch(e){window.istouch=!1,document.body.classList.add("no-touch")}window.needsflash=navigator.userAgent.indexOf("Trident/7.0")>0&&navigator.userAgent.indexOf("Windows NT 6.1")>0,window.isie&&document.body.classList.add("is-ie"),CBSNEWS.dispatch=t.default}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(1)],void 0===(s=function(e){"use strict";function t(e){this._player=e}e=function(e){return e&&e.__esModule?e:{default:e}}(e),t._viewStartTime=Date.now(),t._contentTypes={AD:"ad",CONTENT:"ct"},t._adPositions={PREROLL:"a1",MIDROLL:"a2",POSTROLL:"a3",OVERLAY:"a4",SPECIAL:"a5"},t._videoStates={UNPLAYED:"s1",PLAYED:"s2",STOPPED:"s3",COMPLETED:"s4"},t.prototype.isReady=function(){return!!this._getVideoData("cmsRefGuid")},t.prototype.getTitle=function(){return this._getVideoData("videoTitle")},t.prototype.getVideoPath=function(){return this._getVideoData("cmsRefGuid")},t.prototype.getContentType=function(){return this._getPlaybackState("isAd")?t._contentTypes.AD:t._contentTypes.CONTENT},t.prototype.getAdPosition=function(){return t._adPositions.PREROLL},t.prototype.getTotalDuration=function(){var e=this._getPlaybackState("duration");return-1==e&&(e=300),1e3*e},t.prototype.getState=function(){var e=this._getPlaybackState("playbackState");return 0===e?t._videoStates.STOPPED:1===e?t._videoStates.PLAYED:2===e?t._videoStates.COMPLETED:void 0},t.prototype.getCurrentPlayTime=function(){return 1e3*this._getPlaybackState("currentTime")},t.prototype.getBitrate=function(){var e=this._getPlaybackState("facadeState");return this._getPlaybackState("isAd")?0:e.currentBitrate/1e3},t.prototype.getThumbnailPath=function(){return this._getVideoData("audioPreviewImageUrl")},t.prototype.getPlayerType=function(){return"UVPJS"},t.prototype.getViewStartTime=function(){return Date.now()-t._viewStartTime},t.prototype.getViewPlayTime=function(){return 1e3*this._getPlaybackState("absoluteStreamTime")},t.prototype.getViewAdPlayTime=function(){},t.verify=function(e){return"function"==typeof e.loadAndPlayResource},t.prototype._getPlaybackState=function(e){return this._player.getCurrentPlaybackState()[e]},t.prototype._getVideoData=function(e){return this._player.getContentVideoData()[e]},t.setPlayer=function(e){window._cbv.push(e)},window._cbv=window._cbv||[],window._cbv_strategies=window._cbv_strategies||[],window._cbv_strategies.push(t),window.UvpjsChartbeatAnalytics=t,e.default.on("player:player:ready",function(e){t.setPlayer(e.videoPlayer)}),e.default.on("url:load",function(e){t._viewStartTime=Date.now()})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(1),i(77)],void 0===(s=function(e,t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}e=i(e);var n,s,r=(t=i(t)).default.getInstance();e.default.on("player:resource:start",function(e){s=e.video,r.emit("uvpjs-newvideoplayback",{slug:e.video.slug,componentId:CBSNEWS.defaultPayload.id,componentSlug:CBSNEWS.defaultPayload.slug,containerId:CBSNEWS.uvpContainerId})}),e.default.on("player:video:state",function(e){1==e.uvpEvent.payload.newState&&e.uvpEvent.payload.newState!==n&&r.emit("uvpjs-newvideoplayback",{slug:e.video.slug,componentId:CBSNEWS.defaultPayload.id,componentSlug:CBSNEWS.defaultPayload.slug,containerId:CBSNEWS.uvpContainerId}),n=e.uvpEvent.payload.newState}),r.on("uvpjs-newvideoplayback",function(t){t.containerId&&t.containerId!==CBSNEWS.uvpContainerId&&e.default.trigger("player:video:pause",{video:s})}),r.on("uvpjs-viewabilityclosed",function(t){t.containerId==CBSNEWS.uvpContainerId&&e.default.trigger("player:video:pause",{video:s})})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n;/*! intercom.js | https://github.com/diy/intercom.js | Apache License (v2) */void 0===(n=function(){var e=function(){};e.createInterface=function(e){return{on:function(t,i){void 0===this[e]&&(this[e]={}),this[e].hasOwnProperty(t)||(this[e][t]=[]),this[e][t].push(i)},off:function(t,i){void 0!==this[e]&&this[e].hasOwnProperty(t)&&s.removeItem(i,this[e][t])},trigger:function(t){if(void 0!==this[e]&&this[e].hasOwnProperty(t))for(var i=Array.prototype.slice.call(arguments,1),n=0;n<this[e][t].length;n++)this[e][t][n].apply(this[e][t][n],i)}}};var t=e.createInterface("_handlers");e.prototype._on=t.on,e.prototype._off=t.off,e.prototype._trigger=t.trigger;var i=e.createInterface("handlers");e.prototype.on=function(){i.on.apply(this,arguments),Array.prototype.unshift.call(arguments,"on"),this._trigger.apply(this,arguments)},e.prototype.off=i.off,e.prototype.trigger=i.trigger;var n=window.localStorage;void 0===n&&(n={getItem:function(){},setItem:function(){},removeItem:function(){}});var s={};s.guid=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),s.throttle=function(e,t){var i=0;return function(){var n=(new Date).getTime();n-i>e&&(i=n,t.apply(this,arguments))}},s.extend=function(e,t){if(void 0!==e&&e||(e={}),"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},s.removeItem=function(e,t){for(var i=t.length-1;i>=0;i--)t[i]===e&&t.splice(i,1);return t};var r=function(){var e=this,t=(new Date).getTime();this.origin=s.guid(),this.lastMessage=t,this.bindings=[],this.receivedIDs={},this.previousValues={};var i=function(){e._onStorageEvent.apply(e,arguments)};window.attachEvent?document.attachEvent("onstorage",i):window.addEventListener("storage",i,!1)};r.prototype._transaction=function(e){var t=this,i=!1,s=!1,r=null,a=function(){if(!i){var d=(new Date).getTime(),u=parseInt(n.getItem(l)||0);if(u&&d-u<1e3)return s||(t._on("storage",a),s=!0),void(r=window.setTimeout(a,20));i=!0,n.setItem(l,d),e(),o()}},o=function(){s&&t._off("storage",a),r&&window.clearTimeout(r),n.removeItem(l)};a()},r.prototype._cleanup_emit=s.throttle(100,function(){this._transaction(function(){for(var e=(new Date).getTime()-d,t=0,i=JSON.parse(n.getItem(a)||"[]"),s=i.length-1;s>=0;s--)i[s].timestamp<e&&(i.splice(s,1),t++);t>0&&n.setItem(a,JSON.stringify(i))})}),r.prototype._cleanup_once=s.throttle(100,function(){var e=this;this._transaction(function(){var t,i=JSON.parse(n.getItem(o)||"{}"),s=((new Date).getTime(),0);for(t in i)e._once_expired(t,i)&&(delete i[t],s++);s>0&&n.setItem(o,JSON.stringify(i))})}),r.prototype._once_expired=function(e,t){if(!t)return!0;if(!t.hasOwnProperty(e))return!0;if("object"!=typeof t[e])return!0;var i=t[e].ttl||u,n=(new Date).getTime();return t[e].timestamp<n-i},r.prototype._localStorageChanged=function(e,t){if(e&&e.key)return e.key===t;var i=n.getItem(t);return i!==this.previousValues[t]&&(this.previousValues[t]=i,!0)},r.prototype._onStorageEvent=function(e){e=e||window.event;var t=this;this._localStorageChanged(e,a)&&this._transaction(function(){for(var e=(new Date).getTime(),i=n.getItem(a),s=JSON.parse(i||"[]"),r=0;r<s.length;r++)if(s[r].origin!==t.origin&&!(s[r].timestamp<t.lastMessage)){if(s[r].id){if(t.receivedIDs.hasOwnProperty(s[r].id))continue;t.receivedIDs[s[r].id]=!0}t.trigger(s[r].name,s[r].payload)}t.lastMessage=e}),this._trigger("storage",e)},r.prototype._emit=function(e,t,i){if((i="string"==typeof i||"number"==typeof i?String(i):null)&&i.length){if(this.receivedIDs.hasOwnProperty(i))return;this.receivedIDs[i]=!0}var s={id:i,name:e,origin:this.origin,timestamp:(new Date).getTime(),payload:t},r=this;this._transaction(function(){var i=n.getItem(a)||"[]",o="[]"===i?"":",";i=[i.substring(0,i.length-1),o,JSON.stringify(s),"]"].join(""),n.setItem(a,i),r.trigger(e,t),window.setTimeout(function(){r._cleanup_emit()},50)})},r.prototype.bind=function(e,t){for(var i=0;i<r.bindings.length;i++){var n=r.bindings[i].factory(e,t||null,this);n&&this.bindings.push(n)}},r.prototype.emit=function(e,t){this._emit.apply(this,arguments),this._trigger("emit",e,t)},r.prototype.once=function(e,t,i){if(r.supported){var s=this;this._transaction(function(){var r=JSON.parse(n.getItem(o)||"{}");s._once_expired(e,r)&&(r[e]={},r[e].timestamp=(new Date).getTime(),"number"==typeof i&&(r[e].ttl=1e3*i),n.setItem(o,JSON.stringify(r)),t(),window.setTimeout(function(){s._cleanup_once()},50))})}},s.extend(r.prototype,e.prototype),r.bindings=[],r.supported=void 0!==n;var a="intercom",o="intercom_once",l="intercom_lock",d=5e4,u=36e5;r.destroy=function(){n.removeItem(l),n.removeItem(a),n.removeItem(o)},r.getInstance=function(){var e=null;return function(){return e||(e=new r),e}}();var c=function(e,t,i){if((t=s.extend({id:null,send:!0,receive:!0},t)).receive){var n=[],r=function(s,r){-1===n.indexOf(s)&&(n.push(s),e.on(s,function(e){var n="function"==typeof t.id?t.id(s,e):null,r="function"!=typeof t.receive||t.receive(s,e);(r||"boolean"!=typeof r)&&i._emit(s,e,n)}))};for(var a in i.handlers)for(var o=0;o<i.handlers[a].length;o++)r(a,i.handlers[a][o]);i._on("on",r)}t.send&&i._on("emit",function(i,n){var s="function"!=typeof t.send||t.send(i,n);(s||"boolean"!=typeof s)&&e.emit(i,n)})};return c.factory=function(e,t,i){return void 0!==e.socket&&new c(e,t,i)},r.bindings.push(c),r}.call(t,i,t,e))||(e.exports=n)},function(e,t,i){var n,s;n=[i(1),i(0)],void 0===(s=function(e,t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}e=i(e),(t=i(t)).default.util.tmpl.errorHandler=function(t){e.default.trigger("riot:tag:error",{tagName:t.riotData.tagName,message:t.message})},t.default.mixin({init:function(t){this.dispatch=e.default,this.opts.dataIs?this.opts.dataIs:this.root.nodeName.toLowerCase()}}),t.default.mixin("formatter",{init:function(e){},getRelativeTime:function(e){if(!e)return"";var t=new Date(e),i=new Date;window.isie&&"string"==typeof e&&(t=Date.parse(e.replace(/( \+)/," UTC$1")));var n=Math.floor((i-t)/1e3);return n<=60?"just now":n<=3600?Math.round(n/60)+"m ago":n<=86400?Math.round(n/3600)+"h ago":this.formatDate(e)},formatDate:function(e){var t=(e=new Date(e)).getMonth(),i=e.getDate(),n=e.getFullYear();return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][t]+" "+i+", "+n}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(1),i(80)],void 0===(s=function(e,t){"use strict";(e=function(e){return e&&e.__esModule?e:{default:e}}(e)).default.on("url:load",function(e){var t=e.video,i=Object.assign({},CBSNEWS.tracking),n=t.type;window.hashParams&&window.hashParams.tracking||(window.isembed&&(i.mediaEmbed=!0),"playlist"===t.playlist.type&&(i.collectionId=t.playlist.id,i.collectionName=t.playlist.title),"live"===n||"dvr"===n?(i.articleId="",i.articleTitle="",i.mediaId="",i.mediaTitle="",i.mediaType="",i.pageName="/cbsn",i.pageType="live_streaming_player",i.siteSection=t.topic.slug):(i.articleId=t.id,i.articleTitle=t.fulltitle.toLowerCase(),i.mediaId=t.id,i.mediaTitle=t.fulltitle.toLowerCase(),i.mediaType="content_video",i.pageName=window.location.pathname,i.pageType="video",i.siteSection=t.topic.slug.replace(/-/gi," ")),i.hasVideo=!0,i.pageViewGuid=uuid.v4(),i.pageUrl=window.location.href,i.topicId=t.topic.id,i.topicName=t.topic.hierarchy,i.siteHier=t.topic.hierarchy,i.videoTitle=t.fulltitle,i.videoUrl=t.url,window.utag_cfg_ovrd=window.utag_cfg_ovrd||{},window.utag_cfg_ovrd.noview=!1,CBSNEWS.tracking=i,utag_data=CBSNEWS.tracking,window.utag&&window.utag.view(i,function(){var e=new CustomEvent("tracking:view",{detail:i});window.dispatchEvent(e)}.bind(void 0)))})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n;void 0===(n=function(){"use strict";window.uuid||(window.uuid={}),void 0===window.uuid.v4&&(window.uuid.v4=function(){var e,t,i="";for(e=0;e<32;e++)t=16*Math.random()|0,8!=e&&12!=e&&16!=e&&20!=e||(i+="-"),i+=(12==e?4:16==e?3&t|8:t).toString(16);return i})}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n,s;n=[i(1)],void 0===(s=function(e){"use strict";var t,i=!1,n={};(e=function(e){return e&&e.__esModule?e:{default:e}}(e)).default.on("url:change",function(e){i=!!e.userInitated}),e.default.on("player:video:start",function(e){i=!1}),e.default.on("player:resource:end",function(s){if(!window.isembed&&!i&&"live"!=s.video.type){for(var r,a=s.video,o=a.playlist,l=o.itemIndexById[a.id]+1;l<o.items.length;){var d=o.items[l];if(["vod","live","dvr"].indexOf(d.type)>-1){r=d;break}l++}var u={userInitated:!1};r?u.video=r:a.fusionRundown in n?u.video=n[a.fusionRundown]:u.video=t||CBSNEWS.defaultPayload.items[0],e.default.trigger("url:change",u)}}),e.default.on("video:video:changed:type-live",function(e){n[e.video.fusionRundown]=e.video,"fusion-cbsn"===e.video.playlist.id&&(t=e.video)})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(1)],void 0===(s=function(e){"use strict";e=function(e){return e&&e.__esModule?e:{default:e}}(e);var t,i={adHref:null,adSlug:null,pathClicked:null,slugClicked:null};function n(n){e.default.trigger("url:click",n);var s=n.target;if("A"!=!n.target.nodeName&&(s=n.target.closest("a")),s&&"A"==s.nodeName&&(!window.isembed||s.hasAttribute("data-stay-inside-embed"))&&/(cbsnews\.com)/i.test(s.host)&&(s.payload||s.hasAttribute("data-payload")||s.matches('a[href*="/live/"], a[href*="/video/"]')&&!s.matches('a[href^="#"]'))){var r=s.payload;if(!r&&s.hasAttribute("data-payload")&&(r=JSON.parse(s.getAttribute("data-payload"))),r)if("custom"==r.type);else if("playlist"==r.type||"listing"==r.type||"channel"==r.type){n.preventDefault();var a=r.items[0];r.id.indexOf("fusion")>-1&&(a=r.items[r.items.length-1]),e.default.trigger("feed:ingested:playlist",{feed:r}),e.default.trigger("url:change",{type:r.type,playlist:r,video:a,userInitated:!0})}else n.preventDefault(),e.default.trigger("url:change",{type:r.type,playlist:r.playlist,video:r,userInitated:!0});else{n.preventDefault();var o=s.pathname;"/pcs/click"==o&&(o="/video/"+s.href.split(".com/video/")[1]),i.pathClicked=o,e.default.trigger("feed:request:path",{path:o,targetPathname:s.pathname}),t=setTimeout(function(){clearTimeout(t),window.location.href=s.href},1e3)}}}document.body.addEventListener("click",n,!0),CBSNEWS.frameElementContainer&&CBSNEWS.frameElementContainer.addEventListener("click",n,!0),e.default.on("feed:ingested:playlist",function(n){if(n.feed&&"top-stories"==n.feed.slug){if(i.pathClicked&&i.pathClicked==n.path){clearTimeout(t);var s=n.feed.items[0];n={type:s.type,playlist:s.playlist,video:s,userInitated:!0},e.default.trigger("url:change",n),i.slugClicked=null}if(i.adSlug==n.feed.items[0].slug){var r=n.feed.items[0];i.adHref.payload={type:r.type,playlist:r.playlist,video:r,userInitated:!0,isInjectedAd:!0},i.adSlug=null}}}),window.addEventListener("ads:slotRenderEnded",function(t){var n=t.detail.adUnit.code,s=document.getElementById(n).querySelector("a");if(s){var r=function(e){if(e.indexOf("cbsnews.com")>-1){var t=/\/(live)\/([A-Za-z0-9\-]*)?/;if(null!=(i=e.match(t)))return[i[1],i[2]||""];var i;t=/\/video\/([A-Za-z0-9\-]*)/;return["vod",(i=e.match(t))[1]]}return!1}(s.href);i.adHref=s,i.adSlug=r[1];var a=3;CBSNEWS.defaultPayload.items[0].isImposter&&a++,e.default.trigger("feed:request:video",{type:r[0],slug:r[1],imposter:!0,strategy:"inject",startPosition:a})}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(32),i(84),i(53)],void 0===(s=function(e,t,n){"use strict";i(0).tag2("uvpjs",'<div id="{containerId}"><div id="content_{containerId}"><video id="video_{containerId}" playsinline></video></div><div id="ad_{containerId}"></div><div id="controls_{containerId}" ref="controls"></div><div class="player-overlay__container is-visible" ref="controlsOverlay"><yield></yield></div><div if="{geoBlock}" class="player-overlay__container is-visible" ref="geoBlockOverlay" riot-style="background-image: url({video && video.images.hd})"><div class="player-overlay player-overlay--geo-block"><svg viewbox="0 0 33 34" class="player-overlay__icon player-overlay__icon--eye" aria-hidden="true"><use xlink:href="#icon-eye"></use></svg><p class="player-overlay__message">Sorry, this content is not available in your region.</p><a class="player-overlay__button" href="/video/">More CBS News Videos</a></div></div><div if="{allAccessBlock}" class="player-overlay__container is-visible" ref="allAccessBlockOverlay" riot-style="background-image: url({video && video.images.hd})"><div class="player-overlay player-overlay--all-access-block"><svg viewbox="0 0 134 16" class="player-overlay__icon player-overlay__icon--all-access" aria-hidden="true"><use xlink:href="#logo-cbs-all-access"></use></svg><p class="player-overlay__message">This video is available on CBS&nbsp;All&nbsp;Access</p><a class="player-overlay__button" href="{video.cbsAllAccessRedirect}" target="_top">Watch Now</a><p class="player-overlay__message player-overlay__message--sm ">60 Minutes All Access subscribers <a href="https://{CBSNEWS.host.secure}/user/login/?appId=1503&amp;redirectUrl={encodeURIComponent(inIframe() ? document.referrer : window.location)}" target="_blank" class="popup-link">CLICK&nbsp;HERE</a></p><p class=" player-overlay__message player-overlay__message--sticky"><a href="{video.cbsAllAccessRedirect}" target="_top">Watch Now</a><a href="https://{CBSNEWS.host.secure}/user/login/?appId=1503&amp;redirectUrl={encodeURIComponent(inIframe() ? document.referrer : window.location)}" target="_blank" class="popup-link">LOG&nbsp;IN</a></p></div></div><div if="{embedBlock}" class="player-overlay__container is-visible" ref="embedBlockOverlay" riot-style="background-image: url({video && video.images.hd})"><div class="player-overlay player-overlay--embed-block"><svg viewbox="0 0 33 34" class="player-overlay__icon player-overlay__icon--eye" aria-hidden="true"><use xlink:href="#icon-eye"></use></svg><p class="player-overlay__message">Sorry, you are not authorized to embed this stream.</p><a class="player-overlay__button" href="/video/" target="blank">More CBS News Videos</a></div></div><div class="player-overlay__container player-overlay--draggable"><div class="player-overlay"><svg class="player-overlay--icon-grid"><use xlink:href="#player-icon-drag"></use></svg><span class="player-overlay__title" if="{video}">{video.title}</span><button class="player-overlay__button player-overlay__button--close" data-target="" aria-label="Disable small player"><svg class="player-overlay__button--icon player-overlay__button--icon-close"><use xlink:href="#player-icon-close"></use></svg></button></div></div></div><div class="player-overlay--draggable-handle"></div>',"",'class="{opts.component}"',function(e){var t=this;CBSNEWS.uvpContainerId=this.containerId="uvpjs-container-"+Date.now(),this.eventNamespace=".cbsnewsVideoBundle",this.partner="cbsnews",this.ppProp="desktop"==CBSNEWS.device?"&pp=vpaid_js":"&pp=ssai",this.types={dai:window.uvpjs.mediaCapabilities.RP_DAI,live:window.uvpjs.mediaCapabilities.RP_IMA,dvr:window.uvpjs.mediaCapabilities.RP_URL,vod:window.uvpjs.mediaCapabilities.RP_IMA},this.mediaIds={live:"305276483626",dvr:"320600643969",vod:null},this.videoStates={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120},this.systemInfo={},this.isPlayerReady=!1,this.playQueue=null,this.shouldAutoplay=CBSNEWS.shouldAutoplay&&CBSNEWS.features.isFeatureEnabled("autoplay"),this.playlist=null,this.video=CBSNEWS.defaultPayload.items[0],this.geoBlock=null,this.allAccessBlock=null,this.embedBlock=null,this.controlsOverlay,this.geoBlockOverlay,this.allAccessBlockOverlay,this.geo,this.cbsLocalComscoreC3={"newyork.cbslocal.com":"CBSLocalNY","losangeles.cbslocal.com":"CBSLocalLA","boston.cbslocal.com":"CBSLocalBoston","sacramento.cbslocal.com":"CBSLocalSacramentoCA","sanfrancisco.cbslocal.com":"CBSLocalSanFran","denver.cbslocal.com":"CBSLocalDenver","miami.cbslocal.com":"CBSLocalMiami","chicago.cbslocal.com":"CBSLocalChicago","baltimore.cbslocal.com":"CBSLocalBaltimore","detroit.cbslocal.com":"CBSLocalDetroit","minnesota.cbslocal.com":"CBSLocalMinnesota","philadelphia.cbslocal.com":"CBSLocalPhiladelphia","pittsburgh.cbslocal.com":"CBSLocalPittsburgh","dfw.cbslocal.com":"CBSLocalDallas","www.msn.com":"MSN"},this.comscoreC3="CBSNewsBrowser",window.isembed&&CBSNEWS.referrerHostname in this.cbsLocalComscoreC3&&(this.comscoreC3=this.cbsLocalComscoreC3[CBSNEWS.referrerHostname]),this.uvpcModules={SiteCatalyst:{name:"SiteCatalyst",category:"qos",enabled:!0,params:[{name:"heartbeatAdobePublisherId",value:"10D31225525FF5790A490D4D@AdobeOrg"},{name:"heartbeatVisitorMarketingCloudOrgId",value:"10D31225525FF5790A490D4D@AdobeOrg"},{name:"heartbeatTrackingServer",value:"https://cbsinteractive.hb.omtrdc.net"},{name:"partnerID",value:"cbsnews"}]},ComScore_ss:{name:"ComScore_ss",category:"qos",enabled:!0,params:[{name:"partnerID",value:"cbs"},{name:"c2",value:this.video.tracking.comscore.c2},{name:"c3",value:this.comscoreC3},{name:"c4",value:this.video.tracking.comscore.c4},{name:"c6",value:this.video.tracking.comscore.c6},{name:"ns_st_ge",value:"news"},{name:"ns_ap_an",value:"N/A"}]},MuxQOSPluginJS:{name:"MuxQOSPluginJS",category:"qos",enabled:!0,params:[{name:"propertyKey",value:this.video.muxPropertyKey}]}},this.on("mount",function(){t.dispatch.on("player:player:init",function(e){return t.initVideoPlayer(e.uvpEvent.payload.player)}),t.dispatch.on("player:video:error",t.handleVideoError),t.dispatch.on("player:video:pause",t.pause),t.dispatch.on("player:video:state",t.onVideoResume),t.dispatch.on("player:video:recover",t.play),t.dispatch.on("url:load",t.play),t.dispatch.on("url:change",t.enableAutoplay),CBSNEWS.features.executeWithConsent(["uvp"],"essential",t.initPlayer,t),t.controlsOverlay=t.refs.controlsOverlay.parentNode.removeChild(t.refs.controlsOverlay),t.geoBlockOverlay=t.refs.geoBlockOverlay,t.allAccessBlockOverlay=t.refs.allAccessBlockOverlay,t.geo=JSON.parse((0,n.getCookie)("fly_geo"))}),this.onVideoManagerReady=function(e){this.systemInfo=e;var t={enableUnmutedAutoplay:!1};this.shouldAutoplay&&e.supportsUnmutedAutoplay&&(t.enableUnmutedAutoplay=!0),this.dispatch.trigger("player:manager:ready",{systemInfo:e,videoOptions:t});var i=window.uvpjs.EventType;this.videoManager.addEventListener(i.PLAYER_INIT+this.eventNamespace,this.onPlayerInit),this.videoManager.addEventListener(i.PLAYER_START_ERROR+this.eventNamespace,this.onPlayerStartError),this.videoManager.addEventListener(i.VIDEO_START_ERROR+this.eventNamespace,this.onVideoStartError),this.videoManager.addEventListener(i.VIDEO_PLAYBACK_ERROR+this.eventNamespace,this.onVideoPlaybackError),this.videoManager.addEventListener(i.AD_ERROR+this.eventNamespace,this.onAdError),this.videoManager.addEventListener(i.AD_BLOCKED+this.eventNamespace,this.onAdBlocked),this.videoManager.createVideoPlayer(this.containerId,this.onVideoPlayerReady,t)}.bind(this),this.onVideoManagerError=function(e){this.dispatch.trigger("player:manager:error",{uvpEvent:e})}.bind(this),this.initPlayer=function(){this.dispatch.trigger("player:init",{});var e={classes:[],modules:[]};(CBSNEWS.features.isFeatureDisabled("consent")||!0===CBSNEWS.consentStates.performance)&&e.modules.push(this.uvpcModules.SiteCatalyst,this.uvpcModules.ComScore_ss,this.uvpcModules.MuxQOSPluginJS);var t={netwk:"CBSNEWS",partner:this.partner,uvpc:[e],id3OwnerIds:"com.cbsinteractive.vtg,com.cbsinteractive.cbsnews.cuepoint",usesIMA:!1!==CBSNEWS.features.adsIMA,usesTealium:!0,previewImage:null,skin:!0,themeName:"cbsnews-video",customCSS:"data:text/css;base64,LyogdGhpcyBmaWxlIGlzIG9ubHkgbmVlZGVkIHdoaWxlIFVWUC5qcyBkb2VzIG5vdCBzdXBwb3J0IGxvYWRpbmcgd2l0aG91dCBleHRlcm5hbCBDU1MgZGVwZW5kZW5jeSAqLw==",minBitrate:1e5,capLevelToPlayerSize:!0,playsInline:!0,enableReplay:window.isembed,enableMutedAutoplay:!1,enableUnmutedAutoplay:this.shouldAutoplay};window.uvpjs.Configuration.path=requirejs.s.contexts._.config.baseUrl+"uvp/",this.videoManager=new window.uvpjs.VideoManager,this.videoManager.initialize(t,this.onVideoManagerReady,this.onVideoManagerError)}.bind(this),this.initVideoPlayer=function(e){if(!this.videoPlayer){this.videoPlayer=e,this.refs.controls.appendChild(this.controlsOverlay);var t=window.uvpjs.EventType;e.addEventListener(t.RESOURCE_START+this.eventNamespace,this.onResourceStart),e.addEventListener(t.AD_START+this.eventNamespace,this.onAdStart),e.addEventListener(t.AD_END+this.eventNamespace,this.onAdEnd),e.addEventListener(t.NO_AD_CONTENT+this.eventNamespace,this.onAdNoContent),e.addEventListener(t.CONTENT_DATA_LOADED+this.eventNamespace,this.onContentDataLoaded),e.addEventListener(t.CONTENT_START+this.eventNamespace,this.onVideoStart),e.addEventListener(t.CONTENT_END+this.eventNamespace,this.onVideoEnd),e.addEventListener(t.VIDEO_DONE+this.eventNamespace,this.onVideoDone),e.addEventListener(t.VIDEO_ERROR+this.eventNamespace,this.onVideoError),e.addEventListener(t.VIDEO_STATE_CHANGE+this.eventNamespace,this.onVideoStateChange),e.addEventListener(t.RESOURCE_END+this.eventNamespace,this.onResourceEnd),this.videoPlayer.canOverrideUserGesture()&&this.videoPlayer.overrideUserGesture()}}.bind(this),this.onVideoPlayerReady=function(e){this.isPlayerReady=!0,this.initVideoPlayer(e),this.dispatch.trigger("player:player:ready",{videoPlayer:e,eventNamespace:this.eventNamespace}),this.playQueue&&this.play(this.playQueue)}.bind(this),this.enableAutoplay=function(e){this.playQueue=null,!1===this.systemInfo.supportsUnmutedAutoplay&&this.videoPlayer.onPreviewButton(this.videoPlayer.onVCIReady.bind(this.videoPlayer)),this.videoPlayer.handleFirstGesture()}.bind(this),this.play=function(e){if(!this.isPlayerReady||e.initialUrlLoad&&!this.shouldAutoplay)return this.playQueue=e,void this.dispatch.trigger("player:player:not-ready",[e,this.isPlayerReady,e.initialUrlLoad,this.shouldAutoplay]);if(1==this.videoPlayer.getCurrentPlaybackState().playbackStarted&&this.video==e.video)this.videoPlayer.playVideo();else if(this.isPlayerReady=!0,this.videoPlayer.destroyPlaylist(),this.videoPlayer.setPageContextMetadata(window.om.getHbParams()),this.video=e.video,!this.shouldShowBlocker(this.video)){var t={};this.addVideoToRco(this.video,t),this.addAdToRco(this.video,t),this.videoPlayer.loadAndPlayResource(t),this.dispatch.trigger("player:player:rco",t)}}.bind(this),this.pause=function(){this.videoPlayer&&this.videoPlayer.pauseVideo()}.bind(this),this.stop=function(){this.videoPlayer.destroyPlaylist()}.bind(this),this.addAdToRco=function(e,t){if(this.shouldShowAd(e)){var i=null;CBSNEWS.features.isFeatureEnabled("consent")&&window.cbsoptanon&&cbsoptanon.ads.getNpaFlag(function(e){i=e}),"live"!==e.type&&!0===CBSNEWS.features.adsIMAloaded?(t.type=window.uvpjs.mediaCapabilities.RP_IMA,t.adCall="//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu="+this.adSlotTargeting(e)+"&ciu_szs=728x90&impl=s&gdfp_req=1&env=vp&output=xml_vmap1&unviewed_position_start=1&url=[referrer_url]&correlator=[timestamp]&vid="+this.adVideoPid(e)+"&cust_params="+encodeURIComponent(this.adCustParams(e))+"&cmsid=2289"+this.ppProp,null!==i&&(t.adCall+="&npa="+i)):e.daiAssetId&&!0===CBSNEWS.features.adsDAIloaded&&!window.needsflash?(t.type=this.types.dai,t.assetKey=e.daiAssetId,t.adTagParameters={iu:this.adSlotTargeting(e),cust_params:this.adCustParams(e),sz:e.isLocalStream?"320x240":"640x480",ciu_szs:"728x90"},null!==i&&(t.adTagParameters.npa=i),delete t.assetURL,delete t.overrideAssetURL):(t.assetURL+="?iu="+this.adSlotTargeting(e),t.overrideAssetURL+="?iu="+this.adSlotTargeting(e))}}.bind(this),this.addVideoToRco=function(e,t){var i=e.video;if(window.needsflash&&"live"===e.type&&(i=e.video2),t.cmsRefGuid=e.mpxRefId,t.duration=parseInt(e.duration),t.type=this.types[e.type],t.mediaId=this.mediaIds[e.type],t.partner=this.partner,t.episodeAbstract=e.dek,t.episodeNumber=e.episode,t.seasonNumber=e.season,t.episodeFlag=null!==e.episode,t.seriesTitle=e.topic.parentTopicName,t.hierarchyByName=e.topic.hierarchyByName.join("/"),t.closedCaptionPath=e.captions,t.isLive="live"===e.type,t.assetURL=i,t.overrideAssetURL=i,CBSNEWS.features.isFeatureDisabled("consent")||CBSNEWS.consentStates.targeting)for(var n in t.uvpc={},t.uvpc.modules=this.uvpcModules,t.uvpc.modules.ComScore_ss.params){var s=t.uvpc.modules.ComScore_ss.params[n];e.tracking.comscore[s.name]&&(s.value=e.tracking.comscore[s.name])}t.videoTitle=e.fulltitle,t.audioPreviewImageUrl=e.images.hd}.bind(this),this.adVideoPid=function(e){return e.sponsor&&e.sponsor.mpx_id?e.sponsor.mpx_id:e.mpxRefId}.bind(this),this.adCustParams=function(e,t){var i=Object.assign({vid:this.adVideoPid(e),partner:this.partner},CBSNEWS.ad.gpt.targeting,t);return Object.keys(i).map(function(e){return e+"="+i[e]}).join("&")}.bind(this),this.adSlotTargeting=function(e){if(e&&e.iu)return e.iu;var t="mobile_web",i="cbsnews_mobile";return"desktop"==CBSNEWS.device&&(t="desktop",i="cbsnews"),window.isembed&&"can"!=CBSNEWS.tracking.mediaPartnerId&&(i=CBSNEWS.tracking.mediaPartnerId.replace(".com","")),["",CBSNEWS.ad.gpt.slotVars.network,"vaw-can",t,i].join("/").replace(/ /g,"-")}.bind(this),this.onVideoResume=function(e){"live"!==e.video.type||e.uvpEvent.payload.isAd||e.uvpEvent.payload.newState!==this.videoStates.PLAYING||(this.videoPlayer.seekToLive(),this.dispatch.trigger("player:video:seekToLive",e))}.bind(this),this.adDistanceCount=3,this.adDistanceMicroseconds=48e4,this.adLastTimestamp=0,this.adRotator=0,this.shouldShowAd=function(e){var t=Date.now();"dvr"===e.type?this.adRotator=this.adRotator%this.adDistanceCount+1:this.adRotator=0;var i=!("dvr"===e.type&&!0===e.suppress||"dvr"===e.type&&(null===e.sponsor||null===e.sponsor.mpx_id)&&1!==this.adRotator&&(0===this.adLastTimestamp||t-this.adLastTimestamp<this.adDistanceMicroseconds)||"vod"===e.type&&!0===e.isUserSubscribed&&/^60-minutes/.test(e.topic.slug));return i&&(this.adLastTimestamp=t),this.dispatch.trigger("ad:video:"+i,{adRotator:this.adRotator,time:t-this.adLastTimestamp,type:e.type}),i}.bind(this),this.shouldShowBlocker=function(e){return this.update({geoBlock:!1,allAccessBlock:!0===e.allAccessBlock,embedBlock:CBSNEWS.whitelistFailed}),this.dispatch.trigger("player:video:block",{video:e,allAccessBlock:this.allAccessBlock,embedBlock:this.embedBlock,geoBlock:this.geoBlock,geo:this.geo}),this.geoBlock||this.allAccessBlock||this.embedBlock}.bind(this),this.handleVideoError=function(e){var t=e.uvpError,i=e.video;"videoStartError"!==t.type||t.payload.errorInfo.errorCode!==window.uvpjs.ErrorInfo.errorCodes.DAI_SDK_MISSING&&t.payload.errorInfo.errorCode!==window.uvpjs.ErrorInfo.errorCodes.IMA_SDK_MISSING||!i.daiAssetId||(this.types.dai=window.uvpjs.mediaCapabilities.RP_URL,this.types.live=window.uvpjs.mediaCapabilities.RP_URL,i.daiAssetId=void 0,this.dispatch.trigger("player:video:recover",{video:i}))}.bind(this),this.onPlayerInit=function(e){this.dispatch.trigger("player:player:init",{video:this.video,uvpEvent:e})}.bind(this),this.onAdStart=function(e){this.dispatch.trigger("player:ad:start",{video:this.video,uvpEvent:e})}.bind(this),this.onAdPlay=function(e){this.dispatch.trigger("player:ad:play",{video:this.video,uvpEvent:e})}.bind(this),this.onAdNoContent=function(e){this.dispatch.trigger("player:ad:no-content",{video:this.video,uvpEvent:e})}.bind(this),this.onAdEnd=function(e){this.dispatch.trigger("player:ad:end",{video:this.video,uvpEvent:e})}.bind(this),this.onContentDataLoaded=function(e){this.dispatch.trigger("player:content:loaded",{video:this.video,uvpEvent:e})}.bind(this),this.onResourceStart=function(e){this.dispatch.trigger("player:resource:start",{video:this.video,uvpEvent:e})}.bind(this),this.onResourceEnd=function(e){this.dispatch.trigger("player:resource:end",{video:this.video,uvpEvent:e})}.bind(this),this.onVideoDone=function(e){this.dispatch.trigger("player:video:done",{video:this.video,uvpEvent:e})}.bind(this),this.onVideoEnd=function(e){this.dispatch.trigger("player:video:end",{video:this.video,uvpEvent:e})}.bind(this),this.onVideoError=function(e){this.dispatch.trigger("player:video:error",{video:this.video,uvpEvent:e})}.bind(this),this.onVideoProgress=function(e){this.dispatch.trigger("player:video:progress",{video:this.video,uvpEvent:e})}.bind(this),this.onVideoStart=function(e){this.dispatch.trigger("player:video:start",{video:this.video,uvpEvent:e})}.bind(this),this.onVideoStateChange=function(e){this.dispatch.trigger("player:video:state",{video:this.video,uvpEvent:e})}.bind(this),this.onPlayerStartError=function(e){this.dispatch.trigger("player:start:error",{video:this.video,uvpError:e})}.bind(this),this.onVideoStartError=function(e){this.dispatch.trigger("player:video:error",{video:this.video,uvpError:e})}.bind(this),this.onVideoPlaybackError=function(e){this.dispatch.trigger("player:video:error",{video:this.video,uvpError:e})}.bind(this),this.onAdError=function(e){this.dispatch.trigger("player:ad:error",{video:this.video,uvpError:e})}.bind(this),this.onAdBlocked=function(e){this.dispatch.trigger("player:ad:error",{video:this.video,uvpError:e})}.bind(this),window.getVideoAdSessionValues=function(){var e="",i=JSON.parse((0,n.getCookie)(CBSNEWS.ad.cookieName)),s=i&&i.session,r=+(null==(0,n.getCookie)("first_page_today")||void 0!==window.firstpgvar&&1==window.firstpgvar),a=window.location.search.slice(1).split("&").reduce(function(e,t){return e[(t=t.split("="))[0]]=decodeURIComponent(t[1]),e},{});for(var o in s&&(e+="&session="+s),t.video.suppress&&(e+="&feat=killad"),CBSNEWS.ad.useFirstPageTargeting&&(e+="&firstpg="+r),e+="&ptype="+CBSNEWS.tracking.pageType,a){var l=o.match(/adTargeting_(.+)/);l&&l[1]&&(e+="&"+l[1]+"="+a[o])}return e.replace(/^&/,"")},this.inIframe=function(){try{return window.self!==window.top}catch(e){return!0}}.bind(this)})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n=i(30),s=i(12);i(85)("keys",function(){return function(e){return s(n(e))}})},function(e,t,i){var n=i(6),s=i(15),r=i(17);e.exports=function(e,t){var i=(s.Object||{})[e]||Object[e],a={};a[e]=t(i),n(n.S+n.F*r(function(){i(1)}),"Object",a)}},function(e,t,i){var n;void 0===(n=function(){"use strict";i(0).tag2("metadata",'<span class="card__label card__label--type-short card__label--type-time-duration">{(opts.isplaying && playerState) ? nowPlayingLabel : label}</span><span class="card__label card__label--type-long card__label--type-time-duration">{(opts.isplaying && playerState) ? nowPlayingLabelLong : liveLabelLong}</span><span class="card__label card__label--type-relative">{riot.mixin(\'formatter\').getRelativeTime(item.timestamp)}</span><span if="{item.type == \'playlist\'}" class="card__label card__label--type-count">{label} video{label !== 1 ? \'s\' : \'\'}</span>',"","",function(e){var t=this;this.item=e.item,this.nowPlayingLabel="now playing",this.nowPlayingLabelLong="now playing",this.parent.parent.root.classList.contains("carousel--slug-ott-live")&&(this.nowPlayingLabel="playing"),window.istouch?this.playerState=!0:this.playerState=null,this.on("mount",function(){t.getLabel(t.item)}),this.dispatch.on("player:video:state",function(e){t.playerState=!0,t.update()}),this.getLabel=function(e){if("live"==e.type){var t=new Date;this.label=this.formatTime(t)}else"vod"==e.type||"dvr"==e.type?this.label=e.durationLabel:"playlist"==e.type?this.label=e.meta.totalCount:"listing"==e.type&&(this.liveLabelLong="live: "+e.title,this.label="live");this.update()}.bind(this),this.formatTime=function(e,t){if(t);else e=new Date(e);if(e.getHours()>12)var i=e.getHours()-12;else i=e.getHours();if(e.getHours()<12)var n="am";else n="pm";return i+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+" "+n}.bind(this)})}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n;void 0===(n=function(){"use strict";i(0).tag2("thumbnail",'<span class="{opts.class}-img img"><img data-srcset="{opts.images.sd} 1x, {opts.images.hd} 2x" riot-src="{opts.images.sd}" srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEAAAAALAAAAAABAAEAAAI=" alt="{opts.alt}" class="lazyload"></span><svg viewbox="0 0 32 32" class="{opts.class}--icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-video"></use></svg>',"","",function(e){})}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n,s;n=[i(34)],void 0===(s=function(e){"use strict";var t=i(0);t.tag2("card",'<a ref="anchor" if="{item.type.indexOf(\'html\') === -1}" class="card__container" href="{item.url}" target="_blank" rel="{relData}"><thumbnail if="{item.images.sd || item.images.hd}" class="card__thumb" images="{item.images}" alt="{title}"></thumbnail><div class="card__heading-wrapper"><h3 if="{title}" class="card__title">{title}</h3></div><span class="card__link" if="{item.linkText}" href="{item.linkUrl}" aria-label="{item.linkText}">{item.linkText}</span><metadata isplaying="{isPlaying}" class="label" component="card" item="{item}" type="{item.type}" relativetime="true"></metadata></a>',"","class=\"card card--type-{item.type} card--type-{imposter} card--type-{opts.classes} card--slug-{item.slug} {'card--is-playing': isPlaying} {'card--is-active': isActive}\"",function(e){var i=this;this.item=e.item,this.title=e.item.title,this.dataIs=null,this.isActive=!1,this.isPlaying=!1,this.relData,1==this.item.isImposter&&(this.imposter="is-imposter"),1==this.item.isExternal&&(this.relData="noopener nofollow"),this.isSheAnAd=function(e){return e.type.indexOf("html")>-1}.bind(this),this.changeOttLiveTitle=function(){if(this.item.items){var e=this.item.items.find(function(e){return"live"===e.type});e&&this.update({title:e.title})}}.bind(this),"ott-live"===this.parent.playlist.slug&&this.item.items&&this.changeOttLiveTitle(),this.dispatch.on("video:video:changed:type-live:"+this.item.id,function(e){i.title!==e.video.title&&i.update({title:e.video.title})}),this.dispatch.on("url:load",function(e){i.update({isActive:e.video&&e.video.id===i.item.id||"live"===e.video.type&&e.video.mpxRefId===i.item.mpxRefId})}),this.dispatch.on("player:video:state",function(e){i.update({isPlaying:("live"===e.video.type&&e.video.mpxRefId===i.item.mpxRefId||"live"!==e.video.type&&e.video.id===i.item.id)&&1===e.uvpEvent.payload.newState})}),this.on("update",function(t){"current"==e.type&&(i.item=e.item),i.refs.anchor&&(i.refs.anchor.payload=i.item)}),this.on("mount",function(){if(i.isSheAnAd(i.item)){var e="html"+Date.now(),n=t.tag(e,i.item.body.replace(/({|})/g,"\\$1"),null,'class="html-container"'),s=document.createElement(n);i.root.appendChild(s),t.mount(n)}else i.refs.anchor&&(i.refs.anchor.payload=i.item);"related"===i.parent.opts.component&&i.update({isActive:i.item.id===CBSNEWS.defaultPayload.items[0].id})})})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(13),i(14),i(36),i(90)],void 0===(s=function(e,t,n,s){"use strict";s=function(e){return e&&e.__esModule?e:{default:e}}(s),i(0).tag2("carousel",'<h2 if="{playlistItems.length && playlist.title}" class="carousel__title" aria-label="{playlist.title}"> {playlist.title} </h2><ad display="{opts.type === \'playlist\' && opts.component === \'hero\'}" slot="sponsor-playlist-logo" categoryslug="{playlist.slug}"></ad><div class="show_{rowsVisible} card__wrapper" ref="list"><ad if="{opts.index === 1}" display="{opts.index === 1}" slot="native-video-shelf" categoryslug="{playlist.slug}" class="card card--type-html-native-ad" index="{opts.index}"></ad><card if="{playlistItems.length}" each="{item, i in playlistItems}" item="{item}" index="{i}" ref="card"></card></div><button if="{playlistItems.length && playlist.id}" aria-role="button" class="carousel__button" ref="loadmore" aria-label="more {playlist.title}" onclick="{handleLoadMore}"> More + </button>',"","id=\"{playlist.slug}\" class=\"carousel carousel--slug-{playlist.slug} carousel--component-{opts.component} carousel--view-{playlist.meta.view} carousel--type-{playlist.type} {'carousel--empty ': isEmpty} {dupe ? 'carousel--is-playing' : ''}\" tabindex=\"0\"",function(e){var t=this;window.addEventListener("resize",(0,s.default)(function(e){return t.dispatch.trigger("window:resize")},250)),this.playlist={id:null,type:e.type,title:null,items:[],meta:{view:null}},this.playlistItems=[],this.defaultRowsVisible=2,this.rowsVisible=parseInt(e.rowsvisible)||2,this.dupe=!1,this.isLoadMoreHidden=!0,this.registerComponent=function(){(e.plid||e.slug)&&e.type&&this.playlist.id!==e.plid&&this.dispatch.trigger("register:component",e.playlist)}.bind(this),this.scrollToShelf=function(){if(CBSNEWS.originalUrl&&this.playlist.slug&&""!=CBSNEWS.originalUrl.hash){var e=CBSNEWS.originalUrl.hash.replace(/^#/,""),t=document.querySelector(CBSNEWS.originalUrl.hash);t&&e===this.playlist.slug&&(window.needsflash?t.scrollIntoView():t.scrollIntoView({behavior:"smooth"}))}}.bind(this),this.showHideLoadMore=function(){if(this.playlist.id&&this.refs.list&&!(this.refs.list.childElementCount<=0)){var e=!1,t=this.refs.list.getElementsByClassName("card");if(t&&t.length>0){var i=!0,n=!1,s=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var o=r.value;if(0===o.offsetWidth&&0===o.offsetHeight){if(o.classList.contains("card--type-html-native-ad")||o.classList.contains("card--is-playing")||o.classList.contains("card--type-is-imposter"))continue;e=!0;break}}}catch(e){n=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(n)throw s}}}this.refs.loadmore&&(e?this.refs.loadmore.classList.remove("carousel__button--hidden"):this.refs.loadmore.classList.add("carousel__button--hidden"))}}.bind(this),this.isDuplicate=function(t){t.video.playlist.id==e.plid!==this.dupe&&this.update({dupe:t.video.playlist.id==e.plid})}.bind(this),this.dispatch.on("player:ad:start",this.isDuplicate),this.dispatch.on("player:video:start",this.isDuplicate),this.dispatch.on("url:load",this.isDuplicate),this.dispatch.on("window:resize",this.showHideLoadMore),this.dispatch.on("video:data:changed",function(i){if(i.playlist.id===e.plid){var n={};t.playlist.id&&e.plid===t.playlist.id||(n=t.setDefaultRowsVisible(i.playlist.meta.view)),n.playlist=i.playlist,n.playlistItems=t.getItems(i.playlist),t.isEmpty=i.playlist.emptyPlaylist,t.update(n)}}),this.on("mount",this.registerComponent),this.on("update",this.registerComponent),this.on("updated",this.showHideLoadMore),this.on("updated",this.scrollToShelf),this.on("updated",function(){t.dispatch.trigger("video:data:rendered",{playlist:t.playlist,playlistItems:t.playlistItems})}),this.handleLoadMore=function(e){e.preventUpdate=!0;var t=this.rowsVisible;this.rowsVisible<8&&"all"!=this.rowsVisible?t+=this.defaultRowsVisible:t="all",this.update({rowsVisible:t})}.bind(this),this.setDefaultRowsVisible=function(t){var i={};return"playlists"===t?(i.defaultRowsVisible=1,i.rowsVisible=1):"slider"==e.component?i.rowsVisible="all":(i.defaultRowsVisible=2,i.rowsVisible=2),i}.bind(this),this.getItems=function(t){return"slider"===e.component||"hero"===e.component?t.items.filter(function(e){return-1===e.type.indexOf("html")}).filter(function(e){return!0!==e.isImposter}):t.items.filter(function(e){return!0!==e.isImposter})}.bind(this)})}.apply(t,n))||(e.exports=s)},function(e,t){e.exports=function(e,t){var i=null;return function(){clearTimeout(i);var n=arguments,s=this;i=setTimeout(function(){e.apply(s,n)},t)}}},function(e,t,i){var n;void 0===(n=function(){"use strict";i(0).tag2("slider",'<button hide="{lessThanLimit}" class="slider__controls slider__controls--prev" onclick="{previous}" ref="prevBtn"><svg width="47" height="47" viewbox="0 0 47 47" xmlns="http://www.w3.org/2000/svg"><title>buttons/button-playertray-right</title><g fill="none" fill-rule="evenodd"><path d="M0 4.007C0 1.794 1.785 0 4.007 0H47v47H4.007C1.794 47 0 45.215 0 42.993V4.007z" fill="#F5F5F5"></path><path stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M22 17l7 6.776L22 30"></path></g></svg></button><button hide="{lessThanLimit}" class="slider__controls slider__controls--next" onclick="{next}" ref="nextBtn"><svg width="47" height="47" viewbox="0 0 47 47" xmlns="http://www.w3.org/2000/svg"><title>buttons/button-playertray-right</title><g fill="none" fill-rule="evenodd"><path d="M0 4.007C0 1.794 1.785 0 4.007 0H47v47H4.007C1.794 47 0 45.215 0 42.993V4.007z" fill="#F5F5F5"></path><path stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M22 17l7 6.776L22 30"></path></g></svg></button><carousel ref="slider" if="{playlist.id}" component="{opts.component}" plid="{playlist.id}" slug="{playlist.slug}" type="{playlist.type}" playlist="{playlist}"></carousel>',"",'class="slider slider--slug-{playlist.slug}"',function(e){var t=this;this.playlist={id:null,slug:"ott-latest",items:[]},this.limit=parseInt(e.limit),this.margin=parseInt(e.margin),this.lessThanLimit=!0,this.dispatch.on("url:load",function(e){t.update({playlist:e.video.playlist})}),"related"===e.component&&(this.update({playlist:CBSNEWS.defaultPayload}),this.dispatch.on("url:change",function(e){t.scrollToCard(t.wrapper,e.video.slug)})),this.dispatch.on("player:player:fullscreen",function(){var e=t.playlist.id;if(e){var i=t.refs.slider.refs.list;t.scrollOver(i,e,t.playlist.items.length,t.isFullScreen())}}),this.dispatch.on("video:data:changed",function(e){if(!t.playlist||t.playlist.id===e.playlist.id){t.update({playlist:e.playlist,lessThanLimit:t.playlist.items.length<=t.limit});var i=t.playlist.id;if(i){var n=t.refs.slider.refs.list;t.scrollOver(n,i,e.playlist.items.length,t.isFullScreen())}}}),this.isFullScreen=function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}.bind(this),this._getTranslateValue=function(e){var t=getComputedStyle(e).transform;return"none"===t?"none":+t.split("(")[1].split(")")[0].split(",")[4]}.bind(this),this.on("updated",function(){t.playlist&&t.refs.slider&&t.tags.carousel.on("updated",function(){if(t.refs.slider.refs.list&&t.root.querySelector(".card")){var e=t.refs.slider.root.querySelectorAll(".card__wrapper .card");Math.round(t.root.querySelector(".card").offsetWidth),t.margin;e.length,t.limit,t.playlist.id;try{Math.round(t.root.querySelector(".card").offsetWidth),t.wrapper=t.refs.slider.root.querySelector(".card__wrapper")}catch(e){}}})}),this.scrollToCard=function(e,t){if(e&&t){var i=this.wrapper.querySelector(".card--slug-"+t);if(i){this.refs.nextBtn.classList.remove("slider__controls--hidden"),this.refs.prevBtn.classList.remove("slider__controls--hidden"),e.style.transform="translateX(-"+i.offsetLeft+"px)";var n=parseInt(i.getAttribute("index"))+1;this.playlist.items.length-n<=this.limit&&this.refs.nextBtn.classList.add("slider__controls--hidden"),1===n&&this.refs.prevBtn.classList.add("slider__controls--hidden")}}}.bind(this),this.scrollOver=function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e){var s=this.root.querySelector(".card");if(s)var r=Math.round(s.offsetWidth)+this.margin;else r=335;var a=document.body.offsetWidth,o=r*i,l=o-r*this.limit;if(this._getTranslateValue(e),this.refs.nextBtn.classList.remove("slider__controls--hidden"),this.refs.prevBtn.classList.remove("slider__controls--hidden"),this.update({lessThanLimit:n&&o<a}),0===t.indexOf("fusion-")){n&&(l=o-document.body.offsetWidth);try{e.style.transform="translateX(-"+l+"px)",this.refs.nextBtn.classList.add("slider__controls--hidden")}catch(e){}}else try{e.style.transform="translateX(0)",this.refs.prevBtn.classList.add("slider__controls--hidden")}catch(e){}}}.bind(this),this.scrollTo=function(e,t){var i=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,n=this.refs.slider.root.querySelectorAll(".card__wrapper .card"),s=Math.round(this.root.querySelector(".card").offsetWidth)+this.margin,r=s*n.length,a=this._getTranslateValue(e),o=0;this.refs.nextBtn.classList.remove("slider__controls--hidden"),this.refs.prevBtn.classList.remove("slider__controls--hidden");var l=r+a-s*this.limit;i&&(l=r+a-i.offsetWidth);var d=Math.abs(a);"previous"==t?(Math.abs(a)<450?(o=s-Math.abs(a),i&&d<=s&&(this.refs.prevBtn.classList.add("slider__controls--hidden"),o=0),d===s&&this.refs.prevBtn.classList.add("slider__controls--hidden")):Math.abs(a)<1005?(o=2*s-Math.abs(a),i&&d<=2*s&&(this.refs.prevBtn.classList.add("slider__controls--hidden"),o=0),d===2*s&&this.refs.prevBtn.classList.add("slider__controls--hidden")):(o=3*s-Math.abs(a),d===3*s&&this.refs.prevBtn.classList.add("slider__controls--hidden")),e.style.transform="translateX("+o+"px)"):(l<400?(o=s-a,i&&l<450&&(this.refs.nextBtn.classList.add("slider__controls--hidden"),o=d+l),l===s&&this.refs.nextBtn.classList.add("slider__controls--hidden")):l<1005?(o=2*s-a,i&&l<1005&&(this.refs.nextBtn.classList.add("slider__controls--hidden"),o=d+l),l===2*s&&this.refs.nextBtn.classList.add("slider__controls--hidden")):(o=3*s-a,l===3*s&&this.refs.nextBtn.classList.add("slider__controls--hidden")),e.style.transform="translateX(-"+o+"px)")}.bind(this),this.whichTransitionEvent=function(){var e,t=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e]}.bind(this),this.previous=function(){var e=this.whichTransitionEvent(),t=this;this.refs.prevBtn.classList.add("slider__controls--disable"),this.wrapper.addEventListener(e,function(){t.refs.prevBtn.classList.remove("slider__controls--disable")}),this.scrollTo(this.wrapper,"previous")}.bind(this),this.next=function(){var e=this.whichTransitionEvent(),t=this;this.refs.nextBtn.classList.add("slider__controls--disable"),this.wrapper.addEventListener(e,function(){t.refs.nextBtn.classList.remove("slider__controls--disable")}),this.scrollTo(this.wrapper,"next")}.bind(this)})}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n;void 0===(n=function(){"use strict";i(0).tag2("inline-overlay",'<a if="{video}" class="overlay" ref="overlay" href="{video.url}" draggable="false" ondragstart="return false;" data-stay-inside-embed><div class="overlay__preview"><video class="lazyload" ref="videoPreview" muted="{true}" autoplay playsinline data-poster="{video.images.hd}" loop="{video.type === \'vod\'}" data-hls-wrapper data-preview-url="{previewUrl}"><source type="{video.type == \'live\' ? \'application/vnd.apple.mpegURL\' : \'video/mp4\'}"></video></div><div class="overlay__gradient"></div><div class="overlay__wrapper"><div show="{video.type === \'live\'}" class="overlay__title">{liveStreamTitle}</div><div class="overlay__play"><svg viewbox="0 0 32 32" aria-hidden="true" class="icon icon--play"><use xlink:href="#icon-video"></use></svg><svg viewbox="0 0 32 32" aria-hidden="true" class="icon icon--unmute"><use xlink:href="#icon-unmute"></use></svg></div><h3 class="overlay__hed" data-is="overlay-headline" title="{video.title}" slug="{video.slug}" type="{video.type}"> {video.title} </h3><span class="overlay__metadata"><span if="{video.type !== \'live\'}" class="overlay__timestamp"> {riot.mixin(\'formatter\').getRelativeTime(video.timestamp)} </span><span hide="{video.type === \'live\'}" class="overlay__duration"><span class="icon icon--video"><svg viewbox="0 0 32 32" aria-hidden="true"><use xlink:href="#icon-video"></use></svg></span> {video.durationLabel} </span></span></div></a><button class="overlay__button overlay__button--close" aria-label="Stop video and close player" onclick="{closePlayer}"><svg viewbox="0 0 32 32" class="overlay__button--icon overlay__button--icon-close"><use xlink:href="#icon-close"></use></svg></button>',"","",function(e){var t=this;this.video=null,this.previewUrl=null,this.previewImage=null,this.componentTitle,this.liveStreamTitle="CBSN Live",this.closePlayer=function(){this.dispatch.trigger("player:video:pause",{video:this.video}),this.dispatch.trigger("player:player:closed",{video:this.video})}.bind(this),this.dispatch.on("url:load",function(e){t.update({previewUrl:e.video.previewUrl,previewImage:e.video.images.hd,video:e.video}),t.refs.videoPreview.classList.add("lazyload"),t.refs.overlay.payload=e.video})})}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n;void 0===(n=function(){"use strict";i(0).tag2("overlay-headline","<virtual> {headline} </virtual>","","",function(e){var t=this;this.headline=e.title,this.slug=e.slug,this.type=e.type,this.onLiveItemChange=function(e){console.log("update:live",e.video),this.update({headline:e.video.title})}.bind(this),this.on("mount",function(){"live"==t.type&&t.dispatch.on("video:video:changed:type-live",t.onLiveItemChange)})})}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n;void 0===(n=function(){"use strict";i(0).tag2("raw","<span></span>","","",function(e){this.root.innerHTML=e.html||"",this.on("update",function(){this.root.innerHTML=e.html||""})})}.apply(t,[]))||(e.exports=n)},,,function(e,t,i){e.exports=i(98)},function(e,t,i){var n,s;n=[i(1),i(0),i(99),i(55),i(100),i(101),i(65),i(74),i(102),i(103),i(104),i(88),i(89),i(105),i(92),i(86),i(93),i(106),i(107),i(94),i(91),i(109),i(87),i(83),i(110)],void 0===(s=function(e,t,i,n,s,r,a,o,l,d,u,c,h,p,f,v,g,_,m,E,y,A,S,b,T){"use strict";function D(e){return e&&e.__esModule?e:{default:e}}function C(){new i.BreakingNewsFeedAdapter,new n.VideoFeedAdapter,new a.VideoStore,new r.BreakingNewsStore,window.isembed&&new s.TopDvrAdapter,(0,o.beforeInitialTagMount)(),t.default.mount("watch-live"),t.default.mount("page")}if(e=D(e),t=D(t),window.isembed=!1,document.body.classList.add("no-embedded"),window.self!==window.top||/[?&]embed[=&]/.test(window.location.search))if(CBSNEWS.isPreviewRequest)CBSNEWS.shouldAutoplay=!1,C();else if(document.body.classList.remove("no-embedded"),document.body.classList.add("embedded"),window.isembed=!0,CBSNEWS.defaultPayload.id="topdvr",CBSNEWS.shouldAutoplay=!1,"live_streaming_player"!==CBSNEWS.tracking.pageType)C();else{var I=function(e,t){var i=new RegExp("[?&]premium(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}(0,window.location.search)||"0";window.renderEmbed=function(e,t){CBSNEWS.tracking.siteId=t,CBSNEWS.tracking.mediaPartnerId=1==I?e:"can",document.documentElement.classList.add("partner--"+e.replace(/\./g,"-")),CBSNEWS.partnerHostname=e,"1"==I&&document.documentElement.classList.add("embed--is-premium"),C()},window.blockFrame=function(){CBSNEWS.whitelistFailed=!0,C()},window.retry=function(){location.reload()};var R=document.createElement("script");R.src="/video/xhr/partner-check/"+CBSNEWS.referrerHostname+"/"+I,document.body.appendChild(R)}else CBSNEWS.shouldAutoplay=!0,C()}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[t,i(13),i(14),i(29),i(31),i(35)],void 0===(s=function(e,t,i,n,s,r){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,i){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i):s.value}})(e,t,i||e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(e,"__esModule",{value:!0}),e.BreakingNewsFeedAdapter=void 0;var h=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i="/feedfiles/breakingnews.desktop.json";return(e=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?c(e):t}(this,d(t).call(this,{event:"feed:ingested:breaking"}))).getNewFeed(i),setInterval(e.getNewFeed.bind(c(c(e)),i),15e3),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.BaseFeedAdapter),function(e,t,i){t&&o(e.prototype,t)}(t,[{key:"unifyFormat",value:function(e){return l(d(t.prototype),"unifyFormat",this).call(this,e).then(function(t){var i=t.cbsNewsTicker;return i.meta={dateUpdated:e.headers.get("last-modified")},i})}}]),t}();e.BreakingNewsFeedAdapter=h}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[t,i(13),i(14),i(29),i(31),i(1),i(54)],void 0===(s=function(e,t,i,n,s,r,a){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i):s.value}})(e,t,i||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.TopDvrAdapter=void 0,r=function(e){return e&&e.__esModule?e:{default:e}}(r);var h=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,u(t).call(this,{slug:"live-top-dvr",fusionRundown:"//"+CBSNEWS.host.fusion+"/2.0/rundown/topdvr/?edition=CBSN-US"}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,a.FusionFeedAdapter),function(e,t,i){t&&l(e.prototype,t)}(t,[{key:"convertFeed",value:function(e){for(var t=e.navigation.counts.popular,i={id:"topdvr",slug:"topdvr",type:"listing",title:"Trending on CBSN",items:[],meta:{dateUpdated:e.navigation.dateUpdated.date,limit:null,itemCount:t,totalCount:t,loadMore:!1,custom:null,image:null,strategy:{method:"replace",startPosition:0,deleteCount:this.playlist.items.length}}},n=0;n<e.navigation.data.length;n++){var s=e.navigation.data[n];i.items.push({id:s.id,mpxRefId:null,slug:s.dvr_slug,title:this.truncateHeadline(s.headlineshort),label:s.slug_label,type:"dvr",duration:null,timestamp:s.startDate,durationLabel:s.segmentDur,url:s.shareUrl,images:{sd:s.images.thumbnail_url_hd,hd:s.images.thumbnail_url_hd},video:null,playlist:i,topic:{id:"8a37c65b-cbd4-4bcb-b0d6-fb0eac279178",slug:"cbs-news-digital-channel",hierarchy:["cbs news digital channel"],parentTopicName:"CBS News Digital Channel",hierarchyByName:["CBS News Digital Channel"]}})}return i}},{key:"registerCallbacks",value:function(){var e=this;d(u(t.prototype),"registerCallbacks",this).call(this),r.default.on("video:data:changed:topdvr",function(t){return e.playlist=t.playlist})}},{key:"truncateHeadline",value:function(e){return e.length<=45?e:e.substring(0,e.lastIndexOf(" ",42))+"..."}}]),t}();e.TopDvrAdapter=h}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[t,i(1)],void 0===(s=function(e,t){"use strict";function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.BreakingNewsStore=void 0,t=function(e){return e&&e.__esModule?e:{default:e}}(t);var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.registerCallbacks()}return function(e,t,n){t&&i(e.prototype,t)}(e,[{key:"emitChange",value:function(e){t.default.trigger("component:breaking:changed",e)}},{key:"registerCallbacks",value:function(){var e=this;t.default.on("feed:ingested:breaking",function(t){e.emitChange({breaking:t.feed.active,item:t.feed.banner[0]})})}}]),e}();e.BreakingNewsStore=n}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(1)],void 0===(s=function(e){"use strict";e=function(e){return e&&e.__esModule?e:{default:e}}(e);var t={};window.BidBarrel=window.BidBarrel||{},BidBarrel.queue=BidBarrel.queue||[],BidBarrel.queue.push(function(e){BidBarrel.on("native-video-shelf.slotResponseReceived",function(e){e.sizes.filter(function(e){return Array.isArray(e)}).forEach(function(i){var n=i.concat(e.targeting.pos).join("-");t[n]=e.code})}),BidBarrel.on("native-video-shelf.slotRenderEnded",function(e){var t=new CustomEvent("ads:slotRenderEnded",{detail:{adUnit:e}});window.dispatchEvent(t)}),e()}),window.blankAdCallback=function(e,i,n){var s=[e,i,n].join("-");if(t[s]){var r=document.getElementById(t[s]).closest(".card--type-html-native-ad");r&&(r.style.display="none",r.parentNode.classList.add("card__wrapper--no-ad"))}},e.default.on("url:load",function(e){t={},CBSNEWS.ad.gpt.slotVars.topics=("live"===e.video.type?["video","live"]:["video"].concat(e.video.topic.hierarchy)).join("/").replace(/ /g,"-"),CBSNEWS.ad.gpt.targeting.ptype="live"===e.video.type?"live_streaming_player":"video",CBSNEWS.ad.gpt.targeting.vguid=CBSNEWS.tracking.pageViewGuid,CBSNEWS.ad.gpt.targeting.firstpg="0",CBSNEWS.ad.gpt.targeting.cid="live"===e.video.type?"live":e.video.slug,e.video.playlist.slug?CBSNEWS.ad.gpt.targeting.plist=e.video.playlist.slug:delete CBSNEWS.ad.gpt.targeting.plist,e.initialPageLoad||(CBSNEWS.ad.gpt.targeting.firstpg="0"),window.dispatchEvent(new CustomEvent("ads:destroySlots")),window.dispatchEvent(new CustomEvent("ads:setConfig")),window.dispatchEvent(new CustomEvent("ads:reloadTaboola"))})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(1)],void 0===(s=function(e){"use strict";(e=function(e){return e&&e.__esModule?e:{default:e}}(e)).default.on("url:load",function(e){e.userInitated&&function(e,t){if("string"==typeof e)throw new TypeError("Invalid element: should be DOM element, not query string");var i,n=window.pageYOffset,s=window.pageYOffset+e.getBoundingClientRect().top,r=(document.body.scrollHeight-s<window.innerHeight?document.body.scrollHeight-window.innerHeight:s)-n;r&&window.requestAnimationFrame(function e(t){i||(i=t);var s=t-i,a=Math.min(s/500,1);a=a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1,window.scrollTo(0,n+r*a),s<500&&window.requestAnimationFrame(e)})}(document.querySelector("body"))})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n;void 0===(n=function(){"use strict";i(0).tag2("ad",'<div if="{opts.display}" id="{id}" data-ad="{opts.slot}" class="ad-{opts.slot}" ref="ad"></div>',"",'class="ad__wrapper ad__{opts.slot} {opts.class}"',function(e){var t=this;this.slot=e.slot,this.id=e.slot,void 0!==e.index&&(this.slot=[this.slot,e.index],this.id=this.slot.join(""),this.slot.push({category:e.categoryslug})),this.initAd=function(){e.display&&(window.cbsiGptDivIds=window.cbsiGptDivIds||[],window.cbsiGptDivIds.push(this.slot))}.bind(this),this.dispatch.on("url:load",function(e){return t.initAd()})})}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n;void 0===(n=function(){"use strict";i(0).tag2("embed-bar",'<a href="/video" target="_blank"><svg viewbox="0 0 104 22" width="104" height="22" class="site-logo__icon--type-cbsn" aria-hidden="true"><path d="M11.0000971 16.5833144C14.083986 16.5833144 16.5839639 14.083113 16.5839639 11 16.5839639 7.91592386 14.083986 5.41630037 11.0000971 5.41630037 7.91679102 5.41630037 5.41700734 7.91592386 5.41700734 11 5.41700734 14.083113 7.91679102 16.5833144 11.0000971 16.5833144M11.0000971 17.4615344C6.48284874 17.442271 2.8099985 14.4768576.864794229 10.9212125 2.8292291 7.38483092 6.52130994 4.51804634 11.0000971 4.51804634 15.5571664 4.51804634 19.2100091 7.36614539 21.1355943 10.9212125 19.2100091 14.4768576 15.5965989 17.4804126 11.0000971 17.4615344M0 11C0 17.0741467 4.92478169 22 11.0000971 22 17.0752183 22 22 17.0741467 22 11 22 4.92508275 17.0752183 0 11.0000971 0 4.92478169 0 0 4.92508275 0 11zM35.46 21.36C40.44 21.36 43.05 18.57 44.34 15.99L39.9 13.89C39.24 15.48 37.53 16.8 35.46 16.8 32.34 16.8 30.03 14.28 30.03 11.01 30.03 7.74 32.34 5.22 35.46 5.22 37.53 5.22 39.24 6.54 39.9 8.13L44.34 6.03C43.02 3.39 40.44.66 35.46.66 29.46.66 24.78 4.83 24.78 11.01 24.78 17.16 29.46 21.36 35.46 21.36zM46.56 21L46.56.99 57.9.99C61.86.99 63.75 3.57 63.75 6.09 63.75 8.58 62.22 10.26 60.33 10.68 62.46 11.01 64.14 13.05 64.14 15.57 64.14 18.48 62.19 21 58.26 21L46.56 21zM51.72 8.73L56.73 8.73C57.78 8.73 58.5 7.98 58.5 6.99 58.5 6 57.78 5.28 56.73 5.28L51.72 5.28 51.72 8.73zM51.72 16.71L56.91 16.71C58.14 16.71 58.89 15.96 58.89 14.88 58.89 13.86 58.17 12.99 56.91 12.99L51.72 12.99 51.72 16.71zM65.52 18.18C67.53 20.1 70.35 21.36 74.4 21.36 79.77 21.36 82.74 18.69 82.74 14.67 82.74 10.14 78.18 9.18 74.88 8.49 72.66 8.07 71.43 7.71 71.43 6.66 71.43 5.79 72.09 5.1 73.8 5.1 75.57 5.1 77.76 5.79 79.44 7.17L82.26 3.48C80.13 1.65 77.34.69 74.13.69 69 .69 66.15 3.6 66.15 6.96 66.15 11.7 70.77 12.54 74.07 13.2 76.2 13.65 77.49 14.1 77.49 15.24 77.49 16.2 76.41 16.95 74.64 16.95 71.91 16.95 69.69 15.75 68.25 14.31L65.52 18.18zM98.76 21L103.74 21 103.74.99 98.55.99 98.55 12.51 90.45.99 85.14.99 85.14 21 90.3 21 90.3 8.91 98.76 21z" fill="#F5F5F5"></path></svg></a><watch-live></watch-live><social></social>',"",'class="embed-bar"',function(e){})}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n,s;n=[i(13),i(14),i(36)],void 0===(s=function(e,t,n){"use strict";function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=[],n=!0,s=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){s=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(s)throw r}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}i(0).tag2("page",'<div class="container"><yield from="before-player"></yield><player></player><carousel if="{!window.isembed}" each="{component, i in layout}" plid="{component.id}" type="{component.type}" component="shelf" slug="{component.slug}" playlist="{component}" index="{i}"></carousel></div>',"","",function(e){var t=this;this.flags={state:null,playingDefault:!1},this.layout=[],this.video=null,this.dispatch.on("feed:ingested:layout",function(e){t.update({layout:e.feed})}),this.dispatch.on("url:history",function(e){if(e){if(history.state)(e=history.state).userInitated=!0,t.flags.playingDefault=!1;else{e.userInitated=!1,t.flags.playingDefault=!0;try{history.replaceState(e,"")}catch(e){console.error(e)}}t.dispatch.trigger("url:change",e)}}),window.addEventListener("popstate",function(e){return t.dispatch.trigger("url:history",e.state)}),this.pageSlugAndTitle=function(e){var t,i;return"- CBSN Live Video ".concat("- CBS News"),"playlist"!=e.type&&"listing"!=e.type&&"channel"!=e.type||!e.playlist.url?e.playlist&&"playlist"==e.type?(t="/video/playlist/".concat(e.playlist.slug,"/"),i="".concat(e.playlist.title," ").concat("- CBS News")):"live"!=e.video.type&&"dvr"!=e.video.type&&"vod"!=e.video.type||(t=e.video.url,i="".concat(e.video.title," ").concat("- CBS News")):(t=e.playlist.url,i="".concat(e.playlist.title," ").concat("- CBS News")),[t,i]}.bind(this),this.dispatch.on("url:change",function(e){t.flags.state=e;var i=s(t.pageSlugAndTitle(e),2),n=i[0],r=i[1];try{window.location.pathname!==n&&history.pushState(e,r,n),setTimeout(function(e){return window.location.hash="#x"},0)}catch(e){console.error(e)}document.title=r,document.querySelector('link[rel="canonical"]').setAttribute("href",n);var a=document.querySelector('meta[name="apple-itunes-app"]');a&&a.setAttribute("content",a.getAttribute("content").replace(/app-argument=[^,]+/,"app-argument=".concat(n)))}),this.dispatch.on("url:load",function(e){t.video=e.video}),this.dispatch.on("video:video:changed:type-live",function(e){if(t.video&&t.video.mpxRefId===e.video.mpxRefId){t.video=e.video;var i=s(t.pageSlugAndTitle(e),2),n=i[0],r=i[1];try{history.replaceState(e,r,n)}catch(e){}document.title=r}})})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(108)],void 0===(s=function(e){"use strict";e=function(e){return e&&e.__esModule?e:{default:e}}(e),i(0).tag2("player",'<div class="player__bg"></div><div class="player__wrapper"><uvpjs><div class="player-overlay player-overlay--controls"><slider component="slider" limit="3" margin="0"></slider></div></uvpjs><inline-overlay></inline-overlay><embed-bar if="{window.isembed}"></embed-bar><ad display="{topic == \'sponsored_content\'}" slot="player-sponsor-bar" class="ad__player-sponsor-bar"></ad></div><div class="player__bottom-bar"><div class="player__bottom-bar--left"><h1 class="now-playing__hed now-playing">{nowPlaying.type == \'vod\' ? nowPlaying.fulltitle : nowPlaying.title}</h1><span hide="{nowPlaying.type == \'live\'}" class="now-playing__dek"><raw html="{nowPlaying.dek}"></raw></span><span hide="{nowPlaying.type == \'live\'}" class="now-playing__relative">{riot.mixin(\'formatter\').getRelativeTime(nowPlaying.timestamp)}</span></div><div class="player__bottom-bar--right"><social></social></div></div><carousel ref="hero" component="hero" plid="{playlist.id}" slug="{playlist.slug}" type="{playlist.type}" playlist="{playlist}"></carousel>',"",'class="player player--topic-{topic} player--type-{nowPlaying.type}"',function(t){var i=this;this.playlist={id:null,slug:null,type:null},this.shouldDrag=!1,this.nowPlaying={},this.dispatch.on("url:load",function(e){var t=e.video.playlist;i.nowPlaying=e.video,e.video.topic&&i.getTopic(e.video.topic.hierarchy),i.hexADefault=e.video.hexADefault,i.hexBDefault=e.video.hexBDefault,i.playlist.id!=t.id&&(i.playlist=t,i.dispatch.trigger("player:playlist:changed",{playlist:i.playlist})),i.update()}),this.dispatch.on("video:video:changed:type-live",function(e){i.nowPlaying.type===e.video.type&&i.nowPlaying.mpxRefId===e.video.mpxRefId&&i.update({nowPlaying:e.video})}),this.dispatch.on("player:content:loaded",function(e){i.dispatch.trigger("video:data:now-playing",i.nowPlaying)}),this.on("mount",function(){try{if(window.needsflash||window.isembed||"embed"==t.component)return;CBSNEWS.features.executeIfEnabled(["viewability"],function(){this.enableViewabilityPlayer(),this.initDraggablePlayer()},i)}catch(e){console.error("uh oh PLAYER!",e)}var e=function(){this.dispatch.trigger("player:player:fullscreen")};document.addEventListener("fullscreenchange",e,!0),document.addEventListener("mozfullscreenchange",e,!0),document.addEventListener("MSFullscreenChange",e,!0),document.addEventListener("webkitfullscreenchange",e,!0)}),this.hexToRgb=function(e){if(e)return e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,n){return"#"+t+t+i+i+n+n}).substring(1).match(/.{2}/g).map(function(e){return parseInt(e,16)}).join(",")}.bind(this),this.dispatch.on("player:video:state",function(e){e.uvpEvent.payload.newState===i.tags.uvpjs.videoStates.PLAYING?i.shouldDrag=!0:i.shouldDrag=!1}),this.dispatch.on("player:playlist:changed",function(e){var t,n=e.playlist.meta.custom,s=window.CSS&&window.CSS.supports&&window.CSS.supports("(--foo: red)"),r=document.getElementById("style--no-var-support--template"),a=document.getElementById("style--no-var-support--polyfill");if(n){document.body.classList.contains("custom")||document.body.classList.add("custom");var o=n.background,l=i.hexToRgb(n.hexA)||i.hexADefault,d=i.hexToRgb(n.hexB)||i.hexBDefault;if(s)t="\n\t\t\t\t\t\t:root {\n\t\t\t\t\t\t\t",o&&(t+="\n\t\t\t\t\t\t\t--custom-bg:\t  \turl(".concat(o,");\n\t\t\t\t\t\t")),l&&(t+="\n\t\t\t\t\t\t\t--hex-a:\t\t  \trgb(".concat(l,");\n\t\t\t\t\t\t\t--hex-a--low: \t  \trgba(").concat(l,", .8);\n\t\t\t\t\t\t\t--hex-a--lower:   \trgba(").concat(l,", .6);\n\t\t\t\t\t\t\t--hex-a--lower-b:  \trgba(").concat(l,", .5);\n\t\t\t\t\t\t\t--hex-a--lowest:  \trgba(").concat(l,", .2);\n\t\t\t\t\t\t\t--hex-a--lowest-b: \trgba(").concat(l,", .15);\n\t\t\t\t\t\t")),d&&(t+="\n\t\t\t\t\t\t\t--hex-b--zero:\t \trgba(".concat(d,", 0);\n\t\t\t\t\t\t\t--hex-b:\t\t  \trgb(").concat(d,");\n\t\t\t\t\t\t\t--hex-b--low:\t \trgba(").concat(d,", .8);\n\t\t\t\t\t\t\t--hex-b--lower:  \trgba(").concat(d,", .6);\n\t\t\t\t\t\t\t--hex-b--lower-b:  \trgba(").concat(d,", .5);\n\t\t\t\t\t\t\t--hex-b--lowest:  \trgba(").concat(d,", .2);\n\t\t\t\t\t\t\t--hex-b--lowest-b:  rgba(").concat(d,", .15);")),t+="}";else{var u={"var(--hex-a)":"rgb("+l+")","var(--hex-a--low)":"rgba("+l+", .8)","var(--hex-a--lower)":"rgba("+l+", .6)","var(--hex-a--lower-b)":"rgba("+l+", .5)","var(--hex-a--lowest)":"rgba("+l+", .2)","var(--hex-a--lowest-b)":"rgba("+l+", .15)","var(--hex-b)":"rgb("+d+")","var(--hex-b--zero)":"rgba("+d+", 0)","var(--hex-b--low)":"rgba("+d+", .8)","var(--hex-b--lower)":"rgba("+d+", .6)","var(--hex-b--lower-b)":"re abouba("+d+", .5)","var(--hex-b--lowest)":"rgba("+d+", .2)","var(--hex-b--lowest-b)":"rgba("+d+", .15)"};t=r.innerText.replace(/var\((.*?)\)/gi,function(e){return u[e]||e})}}else if(document.body.classList.remove("custom"),s)t="";else{var c={"var(--hex-a)":"rgb("+i.hexADefault+")","var(--hex-a--low)":"rgba("+i.hexADefault+",.8)","var(--hex-a--lower)":"rgba("+i.hexADefault+",.6)","var(--hex-a--lower-b)":"rgba("+i.hexADefault+",.5)","var(--hex-a--lowest)":"rgba("+i.hexADefault+",.2)","var(--hex-a--lowest-b)":"rgba("+i.hexADefault+",.15)","var(--hex-b)":"rgb("+i.hexBDefault+")","var(--hex-b--zero)":"rgba("+i.hexBDefault+",0)","var(--hex-b--low)":"rgba("+i.hexBDefault+",.8)","var(--hex-b--lower)":"rgba("+i.hexBDefault+",.6)","var(--hex-b--lower-b)":"rgba("+i.hexBDefault+",.5)","var(--hex-b--lowest)":"rgba("+i.hexBDefault+",.2)","var(--hex-b--lowest-b)":"rgba("+i.hexBDefault+",.15)"};t=r.innerText.replace(/var\((.*?)\)/gi,function(e){return c[e]||e})}a.styleSheet?a.styleSheet.cssText=t:a.textContent=t,i.dispatch.trigger("player:feature:theme",{custom:n,cssVarSupport:s,css:t})}),this.getTopic=function(e){if(e){var t=e[0].replace(/ /g,"_");this.update({topic:t})}}.bind(this),this.enableViewabilityPlayer=function(){var e=this,t=this.tags.uvpjs.root,i=this;this.intersectionObserver=new IntersectionObserver(function(n){if(n[0].intersectionRatio<=.2&&e.shouldDrag){t.classList.add("is-sticky");var s=t.getAttribute("data-left");s&&(t.style.left=s);var r=t.getAttribute("data-top");r&&(t.style.top=r),i.containDraggablePlayer(t),e.dispatch.trigger("player:feature:viewability",{enabled:!0})}else t.classList.remove("is-sticky"),t.setAttribute("data-left",t.style.left),t.setAttribute("data-top",t.style.top),t.style.left=null,t.style.top=null},{threshold:.2}),this.intersectionObserver.observe(this.root.querySelector(".player__wrapper")),document.querySelector(".player-overlay__button--close").addEventListener("click",this.disableViewabilityPlayer,!1),this.dispatch.trigger("player:feature:viewability",{enabled:!0})}.bind(this),this.disableViewabilityPlayer=function(){this.tags.uvpjs.root.classList.remove("is-sticky"),this.dispatch.trigger("player:feature:viewability",{enabled:!1})}.bind(this),this.initDraggablePlayer=function(){var t=this,i=document.querySelector("uvpjs");i.style.touchAction="none",i.style.msTouchAction="none",this.draggable=(0,e.default)(i,{handle:document.querySelector(".player-overlay--draggable-handle"),onMouseDown:this.activateDraggablePlayer,onTouchStart:this.activateDraggablePlayer,onMouseUp:this.deactivateDraggablePlayer,onTouchStop:this.deactivateDraggablePlayer}),window.addEventListener("orientationchange",function(){setTimeout(function(){return t.containDraggablePlayer(i)},500)},!1)}.bind(this),this.activateDraggablePlayer=function(e){e.classList.add("is-dragging")}.bind(this),this.containDraggablePlayer=function(e){var t=e.getBoundingClientRect();t.left<20?e.style.left="20px":t.left>window.innerWidth-t.width-20&&(e.style.left=window.innerWidth-t.width-20+"px"),t.top<20?e.style.top="20px":t.top>window.innerHeight-t.height-20&&(e.style.top=window.innerHeight-t.height-20+"px")}.bind(this),this.deactivateDraggablePlayer=function(e){e.classList.remove("is-dragging");var t=this;setTimeout(function(){t.containDraggablePlayer(e)},100)}.bind(this)})}.apply(t,n))||(e.exports=s)},function(e,t,i){
/*!
 * displacejs.js 1.2.4 - Tiny javascript library to create moveable DOM elements.
 * Copyright (c) 2017 Catalin Covic - https://github.com/catc/displace
 * License: MIT
 */
e.exports=function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(i(1));e.exports=n.default},function(e,t,i){"use strict";function n(){var e=this.el,t=this.opts||a,i={};if(e.style.position="absolute",this.handle=t.handle||e,t.constrain){for(var n=t.relativeTo||e.parentNode,o=e,l=0,d=0;o!==n;)o=o.parentNode,(0,s.isRelative)(o)&&(l-=o.offsetLeft,d-=o.offsetTop),o===n&&(l+=o.offsetLeft,d+=o.offsetTop);var u=l+n.offsetWidth-e.offsetWidth,c=d+n.offsetHeight-e.offsetHeight;i.xClamp=(0,s.generateClamp)(l,u),i.yClamp=(0,s.generateClamp)(d,c)}this.opts=t,this.data=i,this.events={mousedown:r.mousedown.bind(this),mouseup:r.mouseup.bind(this),touchstart:r.touchstart.bind(this),touchstop:r.touchstop.bind(this)},this.handle.addEventListener("mousedown",this.events.mousedown,!1),this.handle.addEventListener("touchstart",this.events.touchstart,!1)}Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),r=i(3),a={constrain:!1,relativeTo:null,handle:null,highlightInputs:!1,onMouseDown:null,onMouseMove:null,onMouseUp:null,onTouchStart:null,onTouchMove:null,onTouchStop:null},o=function(){function e(t,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw Error("Must include moveable element");this.el=t,this.opts=i,n.call(this)}return e.prototype.reinit=function(){this.destroy(),n.call(this)},e.prototype.destroy=function(){var e=this.events;this.handle.removeEventListener("mousedown",e.mousedown,!1),document.removeEventListener("mousemove",e.mousemove,!1),document.removeEventListener("mouseup",e.mouseup,!1),this.handle.removeEventListener("touchstart",e.touchstart,!1),document.removeEventListener("touchmove",e.touchmove,!1),document.removeEventListener("touchstop",e.touchstop,!1)},e}();t.default=function(e,t){return new o(e,t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateClamp=function(e,t){return function(i){return Math.min(Math.max(i,e),t)}},t.generateMoveFn=function(){return window.requestAnimationFrame?function(e,t,i){window.requestAnimationFrame(function(){e.style.left=t+"px",e.style.top=i+"px"})}:function(e,t,i){e.style.left=t+"px",e.style.top=i+"px"}},t.isRelative=function(e){return"relative"===window.getComputedStyle(e).position}},function(e,t,i){"use strict";function n(e,t,i){var n=this.el,s=this.opts,a=this.data;"function"==typeof s.onMouseMove&&s.onMouseMove(n,i);var o=i.clientX-e,l=i.clientY-t;return s.constrain&&(o=a.xClamp(o),l=a.yClamp(l)),r(n,o,l),i.preventDefault(),!1}function s(e,t,i){var n=this.el,s=this.opts,a=this.data;"function"==typeof s.onTouchMove&&s.onTouchMove(n,i);var o=i.targetTouches[0],l=o.clientX-e,d=o.clientY-t;return s.constrain&&(l=a.xClamp(l),d=a.yClamp(d)),r(n,l,d),i.preventDefault(),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.mousedown=function(e){var t=this.opts;if(t.highlightInputs){var i=e.target.tagName.toLowerCase();if("input"===i||"textarea"===i)return}var s=this.el,r=this.events;"function"==typeof t.onMouseDown&&t.onMouseDown(s,e);var a=e.clientX-s.offsetLeft,o=e.clientY-s.offsetTop;r.mousemove=n.bind(this,a,o),document.addEventListener("mousemove",r.mousemove,!1),document.addEventListener("mouseup",r.mouseup,!1)},t.mousemove=n,t.mouseup=function(e){var t=this.el,i=this.opts,n=this.events;"function"==typeof i.onMouseUp&&i.onMouseUp(t,e),document.removeEventListener("mouseup",n.mouseup,!1),document.removeEventListener("mousemove",n.mousemove,!1)},t.touchstart=function(e){var t=this.opts;if(t.highlightInputs){var i=e.target.tagName.toLowerCase();if("input"===i||"textarea"===i)return}var n=this.el,r=this.events;"function"==typeof t.onTouchStart&&t.onTouchStart(n,e);var a=e.targetTouches[0],o=a.clientX-n.offsetLeft,l=a.clientY-n.offsetTop;r.touchmove=s.bind(this,o,l),document.addEventListener("touchmove",r.touchmove,!1),document.addEventListener("touchend",r.touchstop,!1),document.addEventListener("touchcancel",r.touchstop,!1)},t.touchmove=s,t.touchstop=function(e){var t=this.el,i=this.opts,n=this.events;"function"==typeof i.onTouchStop&&i.onTouchStop(t,e),document.removeEventListener("touchmove",n.touchmove,!1),document.removeEventListener("touchend",n.touchstop,!1),document.removeEventListener("touchcancel",n.touchstop,!1)};var r=(0,i(2).generateMoveFn)()}])},function(e,t,n){var s,r;s=[n(34)],void 0===(r=function(e){"use strict";n(0).tag2("social",'<ul class="social__list"><li><a class="social__link social__link--twitter" href="{twitter}" onclick="{handleClick}" target="_blank"> Twitter <svg viewbox="0 0 32 32" class="social-icons__icon-svg" aria-hidden="true"><use xlink:href="#icon-social-twitter"></use></svg></a></li><li><a class="social__link social__link--facebook" href="{facebook}" onclick="{handleClick}" target="_blank"> Facebook <svg viewbox="0 0 32 32" class="social-icons__icon-svg" aria-hidden="true"><use xlink:href="#icon-social-facebook"></use></svg></a></li><li><a class="social__link social__link--email" href="{email}" target="_blank"> Email <svg viewbox="0 0 32 32" class="social-icons__icon-svg" aria-hidden="true"><use xlink:href="#icon-social-email"></use></svg></a></li><li if="{!isVod}"><input name="copy-link" readonly="" riot-value="{url}"><a class="social__link social__link--link" onclick="{copy}"> Link <svg viewbox="0 0 28 28" class="social-icons__icon-svg" aria-hidden="true"><use xlink:href="#icon-social-link"></use></svg></a><div ref="tooltip" class="social__tooltip"><div class="arrow-up"></div><span class="social__tooltip-icon"><svg viewbox="0 0 23 23" class="social-icons__icon-svg" aria-hidden="true"><use xlink:href="#icon-check"></use></svg></span><span class="social__tooltip-label"> link copied </span></div><textarea class="social__textarea" riot-value="{window.location.href}"></textarea></li><li if="{isVod}"><input name="copy-embed" readonly="" riot-value="<iframe src=&quot;{url}&quot; id=&quot;cbsNewsVideo&quot; allowfullscreen allow=&quot;fullscreen&quot; frameborder=&quot;0&quot; width=&quot;620&quot; height=&quot;349&quot;></iframe>"><a class="social__link social__link--link" onclick="{copy}"> Embed <svg viewbox="0 0 28 28" class="social-icons__icon-svg" aria-hidden="true"><use xlink:href="#icon-social-embed"></use></svg></a><div ref="tooltip" class="social__tooltip"><div class="arrow-up"></div><span class="social__tooltip-icon"><svg viewbox="0 0 23 23" class="social-icons__icon-svg" aria-hidden="true"><use xlink:href="#icon-check"></use></svg></span><span class="social__tooltip-label"> embed code copied </span></div><textarea class="social__textarea" riot-value="{window.location.href}"></textarea></li></ul>',"",'class="player__social"',function(e){var t=this;this.msg="copy link",this.isLive,this.isVod,this.url,this.dispatch.on("url:load",function(e){t.isLive="live"==e.video.type,t.isVod="vod"==e.video.type,t.url=t.relativeToFullUrl(e.video.url),t.resetCheck(),t.updateInfo(e.video)}),this.dispatch.on("video:data:changed:fusion-cbsn",function(e){t.isLive&&(t.resetCheck(),e.video=e.playlist.items.find(function(e){return"live"===e.type}),t.updateInfo(e.video))}),this.updateInfo=function(e){if(e){var t=e.title,i=this.relativeToFullUrl(e.url);this.facebook="https://www.facebook.com/sharer/sharer.php?app_id=79439656165&display=popup&u="+encodeURIComponent(i)+"&caption="+encodeURIComponent(t),this.twitter="https://twitter.com/intent/tweet?url="+encodeURIComponent(i)+"&text="+encodeURIComponent(t)+"&via=CBSNLive",this.email="mailto:?subject="+encodeURIComponent("CBS News: "+t+" -- CBSN Live News")+"&body="+encodeURIComponent("WATCH: "+t+"\r\n"+i+"\r\n\r\nSee more CBS News video from CBSN, a free live news stream featuring original CBS News reporting: https://www.cbsnews.com/live/"),this.update()}}.bind(this),this.showTooltip=function(){this.refs.tooltip.classList.remove("is-hidden"),this.refs.tooltip.classList.add("is-visible"),setTimeout(this.hideTooltip,1200)}.bind(this),this.hideTooltip=function(){this.refs.tooltip.classList.add("is-hidden"),this.refs.tooltip.classList.remove("is-visible"),setTimeout(function(e){e.refs.tooltip.classList.remove("is-hidden")},1200,this)}.bind(this),this.resetCheck=function(){setTimeout(function(){var e=document.querySelectorAll(".social-overlay__button");for(i=0;i<e.length;i++)e[i].classList.remove("social-overlay__button--is-checked")},1e3)}.bind(this),this.handleClick=function(e){e.preventDefault();var t=e.currentTarget.getAttribute("href"),i=screen.width/2-480,n=screen.height/2-275.5;CBSNEWS.device,-1!=navigator.userAgent.indexOf("Edge")||-1!=navigator.userAgent.indexOf("MSIE")||navigator.userAgent.indexOf("Trident"),window.open(t,"securePopup","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=no, width=960, height=551, top="+n+", left="+i)}.bind(this),this.copy=function(e){e.preventDefault(),e.currentTarget.previousElementSibling.select();try{document.execCommand("copy"),this.showTooltip()}catch(e){}}.bind(this),this.relativeToFullUrl=function(e){var t=document.createElement("a");return t.setAttribute("href",e),t.href}.bind(this)})}.apply(t,s))||(e.exports=r)},function(e,t,i){var n,s;n=[i(34)],void 0===(s=function(e){"use strict";i(0).tag2("watch-live",'<a class="{watch-live--expanded: (isExpanded || isBreaking), watch-live--is-live: isLive, watch-live: true}" ref="watchlive" href="{breakingLink || defaultLink}" target="_top"><div class="watch-live__label"><div class="icon-pulse__container"><div class="icon-pulse--white"></div><div class="icon-pulse--red"></div><div class="icon-pulse--pulse"></div><div class="icon-pulse--disc"></div></div> {breakingLabel || defaultLabel} </div><span class="watch-live__headline">{breakingHeadline || liveHeadline || defaultHeadline}</span></a>',"","",function(e){var t=this;this.defaultLabel=window.isembed?"live":"watch live",this.defaultHeadline="CBSN Live",this.defaultLink="/live/",this.isLive=!0,this.isExpanded=!0,this.dispatch.on("url:load",function(e){t.isLive="live"==e.video.type,t.isExpanded=!0,t.update(),t.refs.anchor&&(t.refs.anchor.payload=t.item)}),this.dispatch.on("component:breaking:changed",function(e){var i="1"==e.breaking;t.isBreaking?(t.breakingLabel=e.item.label||"breaking",t.breakingHeadline=e.item.headline,t.breakingLink=e.item.link,clearTimeout(t.breakingHideTimeout)):(t.breakingLabel=null,t.breakingHeadline=null,t.breakingLink=null,delete t.refs.watchlive.payload),t.update({isBreaking:i})}),this.dispatch.on("video:data:changed:fusion-cbsn",function(e){t.liveVideo=e.playlist.items.find(function(e){return"live"===e.type});var i=t.liveVideo.title;t.refs.watchlive.payload=t.liveVideo,t.update({liveHeadline:i})}),this.on("updated",function(){t.isBreaking||0==t.isExpanded||(clearTimeout(t.breakingHideTimeout),t.breakingHideTimeout=setTimeout(function(){t.isExpanded=!1,t.refs.watchlive.blur(),t.update()},6e3))})})}.apply(t,n))||(e.exports=s)}])});for(var popups=document.querySelectorAll(".popup-link"),i=0;i<popups.length;i++)popups[i].addEventListener("click",function(e){e.preventDefault(),popupHandler(this.href)});addParameterToURL=function(e,t){return e+=(e.split("?")[1]?"&":"?")+t},define("utils/popup-handler",function(){}),define("components/live-headline",[],function(){var e={};function t(t){var n=new XMLHttpRequest;n.open("GET",t,!0),n.send(),n.onreadystatechange=function(){if(4==this.readyState&&200===this.status){var n=JSON.parse(this.responseText);if(n.navigation&&n.navigation.data&&n.navigation.data[0]){for(var s,r=0;r<n.navigation.data.length;r++){var a=n.navigation.data[r];"liveStreaming"!==a.type&&"custom"!==a.type&&"live"!==a.type||(s=a)}e[t].status=n.navigation.ready,void 0!==s&&(e[t].rundown=s,e[t].elements.forEach(function(n){i(n,e[t])}))}}}}function i(e,t){var i=e.options.fieldMap||{"":"headlineshort"};for(var n in i){var s=n,r=t.rundown[i[n]],a=s.split("::");s=a[0];var o=a[1],l=[e.node];s&&(l=Array.prototype.slice.call(e.node.querySelectorAll(s))),l.length&&void 0!==r&&(o?l.forEach(function(e){e.setAttribute(o,r)}):l.forEach(function(e){e.textContent=r}))}if(e.options.documentClassName){var d=document.documentElement.classList;1==t.status?d.add(e.options.documentClassName):d.remove(e.options.documentClassName)}}return function(n,s){var r=s.rundownUrl,a={node:n,options:s};r?(e[r]||(e[r]={status:null,rundown:void 0,elements:[]},t(r),setInterval(function(){t(r)},15e3)),e[r].elements.push(a),e[r].rundown&&i(a,e[r])):console.error("Rundown URL is not provided:",a,s)}}),define("components/smart-banner",["version!fly/managers/debug"],function(e){var t=e.init("smart-banner");function n(e,i){if(this.element=e,this.options=i,this.deviceName=null,this.isHidden=null,this.featureName="smart-banner-"+i.cookieName,t.log("init with options",i),CBSNEWS.features.isFeatureDisabled("smart-banner")||CBSNEWS.features.isFeatureDisabled(this.featureName))return t.log("Diabled by feature flag"),void this.toggleVisibleClass(!0);if(!this.isTargetDevice())return t.log("Not the target device"),void this.toggleVisibleClass(!0);var n=this.url(this.deviceName);(t.log("set click url to ",n),i.bannerAnchorSelector)&&Array.prototype.slice.call(e.querySelectorAll(i.bannerAnchorSelector)).forEach(function(e){e.setAttribute("href",n)}.bind(this));i.bannerCloseSelector&&Array.prototype.slice.call(e.querySelectorAll(i.bannerCloseSelector)).forEach(function(e){e.addEventListener("click",function(){this.toggleHide(i.hideDays)}.bind(this),!1)}.bind(this));setTimeout(function(){t.log("this",this),this.isHidden||"number"!=typeof i.retryDays?t.log("timeout reached, but banner is hidden or retryDays is not set",i.retryDays):i.hideOnTimeout?(t.log("hide on timeout"),this.toggleHide(i.retryDays)):(t.log("hide on next page"),this.setCookie(i.retryDays))}.bind(this),3e4),this.isHidden="hidden"===CBSNEWS.features.getFeatureValue(this.featureName),t.log("banner is ",this.isHidden?"hidden":"visible"),this.toggleVisibleClass()}return n.prototype.toggleHide=function(e){t.log((this.isHidden?"show":"hide")+" component for "+e),this.isHidden=!this.isHidden,this.setCookie(e),this.toggleVisibleClass()},n.prototype.setCookie=function(e){t.log("set cookie for "+e+" days"),CBSNEWS.features.setFeatureValue(this.featureName,this.isHidden?"hidden":"visible",{type:"cookie",maxAge:86400*parseFloat(e)})},n.prototype.isTargetDevice=function(){var e=navigator.userAgent.toLowerCase(),i=this.options.url,n=i&&"object"==typeof i&&Object.keys(i).join("|"),s=new RegExp("("+n+")"),r=e.match(s);return n?r?(t.log("detected device as ",r[0]),this.deviceName=r[0],document.documentElement.classList.add("device-is--"+this.deviceName)):t.log("device does not match the rule ",r):(t.log("no devices provided, default to true",r),r=!0),!!r},n.prototype.toggleVisibleClass=function(e){e=e||this.isHidden,t.log("toggle state to "+(e?"hidden":"visible")),this.toggleClass(e),this.toggleAccessibilityLabels(e)},n.prototype.toggleClass=function(e){var t=document.documentElement.classList;this.element.getAttribute("id");e?(t.add(this.options.bannerHiddenClass),t.remove(this.options.bannerVisibleClass)):(t.add(this.options.bannerVisibleClass),t.remove(this.options.bannerHiddenClass))},n.prototype.toggleAccessibilityLabels=function(e){e=e||this.isHidden,t.log("toggle labels to "+(e?"hidden":"visible"));var n=this.element.querySelectorAll("[aria-controls]");for(i=0;i<n.length;i++)n[i].setAttribute("aria-expanded",!e),n[i].setAttribute("aria-label",e?"data-label-hidden":"data-label-visible")},n.prototype.url=function(e){var i=this.options.url;return t.log("Guess URL, looking for",e,"in",i),"string"==typeof i?i:"object"==typeof i&&e in i?i[e]:""},function(e,t){new n(e,t)}}),require(["requireLib"]),require(["common/lazysizes"]),require(["common/consent"]),require(["common/dynamic-css-classes"]),require(["common"]),require(["polyfill!intersection-observer","video/common","video/main"]),require(["utils/popup-handler"]),require(["components/live-headline"]),require(["components/smart-banner"]),define("main.video",function(){});