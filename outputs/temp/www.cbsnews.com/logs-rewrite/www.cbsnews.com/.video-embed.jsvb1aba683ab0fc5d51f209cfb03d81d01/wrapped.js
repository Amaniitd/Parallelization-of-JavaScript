/* 
 * Generates UUID v4
 */
(function __HORCRUX__(){ window.uuid||(window.uuid={}),void 0===window.uuid.v4&&(window.uuid.v4=function(){var t,e,i="";for(t=0;t<32;t++)e=16*Math.random()|0,8!=t&&12!=t&&16!=t&&20!=t||(i+="-"),i+=(12==t?4:16==t?3&e|8:e).toString(16);return i}),window.define("fly/libs/uuid.v4",function(){}); window.CBSNEWS=window.CBSNEWS||{};window.CBSNEWS.consentStates={targeting:null,performance:null,functional:null,social:null},window.CBSNEWS.updateConsentStates=function(t,e,i,s){window.CBSNEWS.consentStates.targeting=t,window.CBSNEWS.consentStates.performance=e,window.CBSNEWS.consentStates.functional=i,window.CBSNEWS.consentStates.social=s,window.console&&console.log("cbsoptanon::addOnConsentChangedHandler","getState",JSON.parse(JSON.stringify(window.CBSNEWS.consentStates)))},window.cbsoptanon=window.cbsoptanon?window.cbsoptanon:{},window.cbsoptanon.cmd=window.cbsoptanon.cmd?window.cbsoptanon.cmd:[],window.cbsoptanon.config=window.cbsoptanon.config?window.cbsoptanon.config:[],["onIframesReady","onFormsReady","onScriptsReady","onAdsReady"].forEach(function(t){window.cbsoptanon[t]=window.cbsoptanon[t]||function(){var e=arguments;window.cbsoptanon.cmd.push(function(){window.cbsoptanon[t].apply(window.cbsoptanon,e)})}}),window.cbsoptanon.onScriptsReady(function(t){t.leavebehind.bannerCloseListener(function(){"none"===window.document.getElementById(t.constants.OT_LEAVEBEHIND_ID).style.display?window.document.body.classList.remove("manage-cookies-btn--is-visible"):window.document.body.classList.add("manage-cookies-btn--is-visible")})}),window.cbsoptanon.config.push({enableServices:!1,setNpaOnConsentChange:!0}),window.CBSNEWS.frameElement;try{window.CBSNEWS.frameElement=window.frameElement}catch(t){window.CBSNEWS.frameElement=null}if(window.CBSNEWS.features.isFeatureDisabled("consent"));else if(window===window.top||/optanonConsent/.test(window.location.search)){ window.script = window.undefined;window.cbsoptanon.cmd.push(function(t){t.ot.addOnConsentChangedHandler(function(){t.ot.getState(window.CBSNEWS.updateConsentStates)})}),(window.script=window.document.createElement("script")).src=window.CBSNEWS.oneTrustPath,window.script.async=!0,window.script.setAttribute("data-domain-script",window.CBSNEWS.oneTrustScriptId),window.document.head.appendChild(window.script),(window.script=window.document.createElement("script")).src=window.CBSNEWS.optAnonPath,window.script.async=!0,window.script.setAttribute("id","bb-cbsoptanon"),window.document.head.appendChild(window.script)}else window.CBSNEWS.frameElement?(window.CBSNEWS.consentStates=window.parent.CBSNEWS.consentStates,window.parent.cbsoptanon?window.cbsoptanon_=window.cbsoptanon=window.parent.cbsoptanon:window.cbsoptanon_=window.parent.cbsoptanon=window.cbsoptanon,function(t){window.cbsoptanon.cmd.push(function(e){window.console&&console.log("cbsoptanon::cmd","check reference",t.cbsoptanon===e),t.cbsoptanon!==e&&(t.cbsoptanon=e,t.cbsoptanon_.cmd.forEach(function(t){e.cmd.push(t)}))})}(window)):window.CBSNEWS.features.consent=!1;window.define("common/consent",function(){}),function(){"use strict";var t=null;window.define("version",{version:"1.0",load:function(e,i,s,n){var r=n.config.version;if(!r)throw new Error("A version config has not been setup");if(!r[e])throw new Error("A version was not specified for module: "+e);t&&r[e],i([e+"-"+n.config.version[e]],function(t){s(t)})},normalize:function(e){var i=/\(([^)]*)\)/.exec(e);return t=null,i&&(t=i[1],e=e.substring(0,i.index)),e}})}(),window.define("fly/utils/string-helper-2.0",[],function(){return{capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},lowerFirst:function(t){return t.charAt(0).toLowerCase()+t.slice(1)},toBool:function(t){return!0===t||"true"===t||"1"===t},toCleanArray:function(t,e){return e=e||",",t=(t="string"==typeof t?t.split(e).map(function(t){return t.trim()}):Array.prototype.slice.call(t)).filter(function(t){return t})},toCamelCase:function(t,e){return e=e||"-",t.replace(new RegExp("(\\"+e+"[a-z])","g"),function(t){return t.toUpperCase().replace(e,"")})},fromCamelCase:function(t,e){return e=e||"-",t.replace(/[A-Z]/g,function(t){return e+t.toLowerCase()})},toEventName:function(t){return t.replace(/^on([A-Z])/,function(t){return t.charAt(2).toLowerCase()})},isEventOption:function(t){return/^on([A-Z])/.test(t)}}}),window.define("fly/utils/url-helper-2.0",[],function(){return{buildUrl:function(t,e,i,s){var n=t+e;return(i=this._stringifyObject(i))&&(n+="?"+i),(s=this._stringifyObject(s))&&(n+="#"+s),n},getParam:function(t,e){var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e||window.location);return i?i[1]:null},getParamAsArray:function(t){var e=this.getParam(t);return e?e.split(","):null},getAllParams:function(t){var e=(t?this._getParsableUrl(t):window.location).search.substring(1),i=e.split("&"),s={};if(""===e)return{};for(var n=0;n<i.length;n++){var r=i[n].split("=");s[window.unescape(r[0])]=window.unescape(r[1])}return s},getHashParam:function(t,e){var i=(e||window.location.hash).substring(1),s="",n="";if(-1!=i.indexOf(t)){if(-1!=(s=i.substring(i.indexOf(t))).indexOf("&"))n=s.split("&")[0].split("=");else n=s.split("=");return n[1]}return!1},paramExists:function(t,e){return!!(e||window.location.href).match("[\\?&]"+t+"([=&#]|$)")},getOrigin:function(t){var e=t?this._getParsableUrl(t):window.location;return e.origin||e.protocol+"//"+e.host},getPath:function(t){var e=(t?this._getParsableUrl(t):window.location).pathname;return-1===[void 0,"/"].indexOf(e[0])&&(e="/"+e),e},_getParsableUrl:function(t){var e=window.document.createElement("a");return e.href=t,e},_stringifyObject:function(t,e,i){var s="";if(e=e||"&",i=i||"=",null==t||[]==t||{}==t);else if(Array.isArray(t))s=t.join(e);else if("object"==typeof t){for(var n in t){s+=n+i+t[n]+e}s=s.substring(0,s.length-1)}else"string"==typeof t&&(s=t);return s}}}),function(t){var e;if("function"==typeof window.define&&window.define.amd&&(window.define("fly/libs/js-cookie-2.2.0",t),e=!0),"object"==typeof window.exports&&(window.module.exports=t(),e=!0),!e){var i=window.Cookies,s=window.Cookies=t();s.noConflict=function(){return window.Cookies=i,s}}}(function(){function t(){for(var t=0,e={};t<arguments.length;t++){var i=arguments[t];for(var s in i)e[s]=i[s]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,window.decodeURIComponent)}return function i(s){function n(){}function r(e,i,r){if("undefined"!=typeof window.document){"number"==typeof(r=t({path:"/"},n.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var a=JSON.stringify(i);/^[\{\[]/.test(a)&&(i=a)}catch(t){}i=s.write?s.write(i,e):window.encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,window.decodeURIComponent),e=window.encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,window.decodeURIComponent).replace(/[\(\)]/g,window.escape);var o="";for(var l in r)r[l]&&(o+="; "+l,!0!==r[l]&&(o+="="+r[l].split(";")[0]));return window.document.cookie=e+"="+i+o}}function a(t,i){if("undefined"!=typeof window.document){for(var n={},r=window.document.cookie?window.document.cookie.split("; "):[],a=0;a<r.length;a++){var o=r[a].split("="),l=o.slice(1).join("=");i||'"'!==l.charAt(0)||(l=l.slice(1,-1));try{var d=e(o[0]);if(l=(s.read||s)(l,d)||e(l),i)try{l=JSON.parse(l)}catch(t){}if(n[d]=l,t===d)break}catch(t){}}return t?n[t]:n}}return n.set=r,n.get=function(t){return a(t,!1)},n.getJSON=function(t){return a(t,!0)},n.remove=function(e,i){r(e,"",t(i,{expires:-1}))},n.defaults={},n.withConverter=i,n}(function(){})}),window.define("fly/managers/cookie-2.0",["fly/libs/js-cookie-2.2.0"],function(t){var e={domains:{default:null}};return{init:function(t){this.setConfig(t)},setConfig:function(t){"object"==typeof t&&null!==t&&Object.assign(e,t)},set:function(i,s,n){n=n||{},("object"==typeof s&&null!==s||Array.isArray(s))&&(s=JSON.stringify(s)),n.domain?n.domain in e.domains&&(n.domain=e.domains[n.domain]):n.domain=e.domains.default,n.domain||delete n.domain,t.set(i,s,n)},get:function(e){var i,s=t.get(e);try{i=JSON.parse(s)}catch(t){i=s}return i},remove:function(e,i){t.remove(e,i)}}}),window.define("fly/managers/debug-2.0",["module","version!fly/utils/string-helper","version!fly/utils/url-helper","version!fly/managers/cookie"],function(t,e,i,s){var n,r,a,o={},l={queryParam:"jsDebug",cookie:{name:"fly_js_debug",domain:"default"}},d=!1,u=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};return Object.assign(l,t.config()),(r=i.getParamAsArray(l.queryParam)||[])?s.set(l.cookie.name,r,{path:"/",domain:l.cookie.domain}):a=s.get(l.cookie.name)||[],(r.indexOf("true")>-1||r.indexOf("all")>-1)&&(s.set(l.cookie.name,!0,{path:"/",domain:l.cookie.domain}),d=!0),(n=function(t){this.name=t,this.color="hsl("+u(0,360)+","+u(35,80)+"%,"+u(20,45)+"%)",(!0===a||Array.isArray(r)&&r.indexOf(this.name)>-1||Array.isArray(a)&&a.indexOf(this.name)>-1)&&this.enable()}).prototype={constructor:n,enabled:!1,_call:function(t,e){if(window.console&&(this.enabled||d)){e.callee=e.callee.caller;var i=[].slice.call(e);-1<["error","info","log","trace","warn"].indexOf(t)&&i.unshift("%c "+this.name+" ","color:#fff;border-radius:3px;background-color:"+this.color+";"),"object"==typeof window.console&&"function"==typeof window.console[t]&&window.console[t].apply(window.console,i)}return this},disable:function(){return this.enabled=!1,this},enable:function(){return this.enabled=!0,this},error:function(){return this._call("error",arguments)},info:function(){return this._call("info",arguments)},log:function(){return this._call("log",arguments)},profile:function(){return this._call("profile",arguments)},profileEnd:function(){return this._call("profileEnd",arguments)},timeStamp:function(){return this._call("timeStamp",arguments)},trace:function(){return this._call("trace",arguments)},warn:function(){return this._call("warn",arguments)}},{init:function(t){var e=new n(t);return o[t]=e,e},get:function(t){return o[t]||this.init(t)}}}),window.define("libs/hls-video",["version!fly/managers/debug"],function(t){return function(e){var i=t.init("hls-wrapper");i.log("Prepare to initialize");var s,n=null,r=function(t,e,s){return i.log("togglePlayback",e?"pause":"play",s),e&&t.paused?void i.log("Video is already paused",s):e?(i.log("PAUSE video",s),t.pause(),n&&n.stopLoad(),!0):t.paused?(i.log("PLAY video",s),t.play(),n&&n.startLoad(-1),!0):void i.log("Video IS not paused",s)},a=function(t,e,s,a){if(void 0!==window.document.hidden||void 0!==window.document.webkitHidden){window.document.addEventListener(s,function(){i.log("onPageVisibilityChange","Page is",window.document[a]?"hidden":"visible"),r(t,window.document[a],e,n)},!1)}},o=function(){var t=window.MediaSource=window.MediaSource||window.WebKitMediaSource,e=window.SourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return i&&s},l=function(t){return t.defaultPrevented||"VIDEO"!=t.nodeName||!t.hasAttribute("data-hls-wrapper")}(e)?null:function(t){var e=t;return e.muted=e.hasAttribute("muted"),e.autoplay=e.hasAttribute("autoplay"),e.disableRemotePlayback=!0,e.onerror=function(t){i.error("Error "+e.error.code+"; details: "+e.error.message),e.getAttribute("data-poster")&&e.setAttribute("poster",e.getAttribute("data-poster"))},e}(e),d=l?function(t){var e=t.getAttribute("src"),s=t.getAttribute("data-src"),n=t.querySelector("source"),r=n&&n.getAttribute("data-src");return e=e||s||(n&&n.src?n.src:r||null),i.log("Found video source",e),e}(l):null;return function(t){if(!t)return i.error("No video source available"),!0}(d)?null:(s=function(){var t=function(){var t,e;return void 0!==window.document.hidden?(t="hidden",e="visibilitychange"):void 0!==window.document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange",window.pageVisibilitySupported=!0),[t,e]}(),e=t[0],s=t[1];a(l,d,s,e),l.hasAttribute("data-hls-wrapper-no-observer")?i.log("IntersectionObserver is disabled on this video"):function(t,e){try{new IntersectionObserver(function(s){i.log("intersectionObserver",s[0].intersectionRatio,t),r(t,0==s[0].intersectionRatio,e)}).observe(t)}catch(t){i.error(t)}}(l,d),function(t){var e=t.querySelector("source");return!(e&&t.canPlayType(e.type)||t.canPlayType("application/vnd.apple.mpegURL")||!o())||(i.log("native playback is supported or HLS.js is not supported"),!1)}(l)&&(n=function(t,e){return(n=new window.Hls({capLevelToPlayerSize:!0,enableWebVTT:!1,enableCEA708Captions:!1,autoLevelCapping:2})).attachMedia(t),n.on(window.Hls.Events.MEDIA_ATTACHED,function(){n.loadSource(e),n.on(window.Hls.Events.MANIFEST_PARSED,function(){r(t,!t.hasAttribute("autoplay"),e)})}),n.on(window.Hls.Events.ERROR,function(t,e){if(e.fatal)switch(e.type){case window.Hls.ErrorTypes.NETWORK_ERROR:i.error("fatal network error encountered, try to recover",e),n.startLoad();break;case window.Hls.ErrorTypes.MEDIA_ERROR:i.error("fatal media error encountered, try to recover",e),n.recoverMediaError();break;default:i.error("cannot recover, destroy",e),n.destroy()}}),n}(l,d))},void(window.Hls?(i.log("Hls.js is available"),window.setTimeout(s,0)):(i.log("Hls.js is not available"),window.require(["version!libs/hls"],function(t){window.Hls=window.Hls||t,s()}))))}}),window.lazySizesConfig=window.lazySizesConfig||{},window.lazySizesConfig.init=!1,window.lazySizesConfig.loadMode=1,window.lazySizesConfig.preloadAfterLoad=!!window.parseInt(window.CBSNEWS.features.getFeatureValue("lazysizes.preloadAfterLoad")); window.userAgent=window.navigator.userAgent.toLowerCase(),window.isSafari=/^((?!chrome).)*safari/.test(window.userAgent);window.define("libs/lazysizes.plugins",["libs/hls-video"],function(t){"use strict";window.addEventListener("lazybeforeunveil",function(e){if(!e.defaultPrevented){if(e.target.getAttribute("data-component")){if("string"==typeof(i=e.target.getAttribute("data-component"))&&(i=[i]),i[0]&&i[0].match(/^\[/))var i=JSON.parse(i[0]);else i=i;i.forEach(function(t,i){var s=JSON.parse(e.target.getAttribute("data-"+t+"-options")||{});window.require(["components/"+t],function(t){t(e.target,s)})})}var s=["videoPreview"];if(l=e.target.getAttribute("data-preview-url"),"VIDEO"==e.target.nodeName&&l&&(l.indexOf("splice.amlg.io")>=0&&s.push("splice"),window.CBSNEWS.features.executeIfEnabled(s,function(i){e.target.setAttribute("src",i),t(e.target)},window,[l])),l=e.target.getAttribute("data-poster"),"VIDEO"==e.target.nodeName&&l&&window.CBSNEWS.features.executeIfDisabled(s,function(t){e.target.setAttribute("poster",l)},window,[l]),"IFRAME"==e.target.nodeName){var n=e.target,r=n.parentElement.querySelector(".embed__resizer"),a=(n.getAttribute("data-width")||"").replace("px",""),o=(n.getAttribute("data-height")||"").replace("px","");if(r&&r.hasAttribute("data-resized")||(r&&o>0&&a>0?r.setAttribute("style","padding-top:"+o/a*100+"%"):(a&&n.setAttribute("width",a),o&&n.setAttribute("height",o),r&&o&&r.setAttribute("style","padding-top:"+o+"px"))),/^\/embed\/video\//.test(n.getAttribute("src")||n.getAttribute("data-src"))&&!window.document.body.classList.contains("has__video-player")&&window.document.body.classList.add("has__video-player"),e.target.getAttribute("data-src")){e.preventDefault();var l=e.target.getAttribute("data-src"),d="social";/^(?:https?:)?\/\/.+?cbsnews.com/i.test(l)||/^\/[^\/]/.test(l)?d="essential":e.target.hasAttribute("data-optanon-category")&&(d=e.target.getAttribute("data-optanon-category")),window.CBSNEWS.features.executeWithConsent(["iframe"],d,function(t){var e=t.getAttribute("data-src");if(e){var i=t.cloneNode();i.setAttribute("src",e),i.removeAttribute("data-src"),t.parentElement.replaceChild(i,t)}},this,[e.target,l])}}if(l=e.target.getAttribute("href"),"LINK"==e.target.nodeName&&l){var u=new XMLHttpRequest;u.open("GET",l,!0),u.send(),u.onload=function(){if(u.responseXML&&"image/svg+xml"===u.responseXML.contentType)window.document.head.insertAdjacentHTML("beforeend",u.responseText);else if("application/json"===u.getResponseHeader("Content-Type")){var t=JSON.parse(u.responseText);e.target.insertAdjacentHTML("afterend",t.html)}else e.target.insertAdjacentHTML("afterend",u.responseText)}}if((l=e.target.getAttribute("data-require"))&&window.require){var h=e.target.getAttribute("data-require-callback"),c=JSON.parse(e.target.getAttribute("data-require-arguments"));window.require([l],function(t,e){return function(){t&&"function"==typeof window[t]&&window[t].apply(window,e||arguments)}}(h,c))}if((l=e.target.getAttribute("data-lazy-taboola"))&&e.target.setAttribute("data-taboola",l),(l=e.target.getAttribute("data-taboola"))&&window.CBSNEWS.taboola&&window.CBSNEWS.taboola.push(e.target,!0),l=e.target.getAttribute("data-ad-unit")){var p=JSON.parse(l),f=window.document.querySelectorAll('[id="'+e.target.id+'"]').length;Array.isArray(p)&&f>1&&(p[1]+=window.document.querySelectorAll('[id^="'+p[0]+'"]').length-f+1,e.target.setAttribute("id",p.join("")),e.target.setAttribute("data-ad-unit",JSON.stringify(p)),console.log("ADS: incremental ad",p,"is clashing with another, updated id to",e.target.id)),console.log("ADS: queuing to lazyload",e.target.getAttribute("id")),window.cbsiGptDivIds=window.cbsiGptDivIds||[],window.cbsiGptDivIds.push(p)}}},!1)}),function(t){var e=function(t,e,i){"use strict";var s,n;if(function(){var e,i={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};for(e in n=t.lazySizesConfig||t.lazysizesConfig||{},i)e in n||(n[e]=i[e])}(),!e||!e.getElementsByClassName)return{init:function(){},cfg:n,noSupport:!0};var r=e.documentElement,a=t.HTMLPictureElement,o="addEventListener",l="getAttribute",d=t[o].bind(t),u=t.setTimeout,h=t.requestAnimationFrame||u,c=t.requestIdleCallback,p=/^picture$/i,f=["load","error","lazyincluded","_lazyloaded"],v={},g=Array.prototype.forEach,_=function(t,e){return v[e]||(v[e]=new RegExp("(\\s|^)"+e+"(\\s|$)")),v[e].test(t[l]("class")||"")&&v[e]},E=function(t,e){_(t,e)||t.setAttribute("class",(t[l]("class")||"").trim()+" "+e)},m=function(t,e){var i;(i=_(t,e))&&t.setAttribute("class",(t[l]("class")||"").replace(i," "))},A=function(t,e,i){var s=i?o:"removeEventListener";i&&A(t,e),f.forEach(function(i){t[s](i,e)})},y=function(t,i,n,r,a){var o=e.createEvent("Event");return n||(n={}),n.instance=s,o.initEvent(i,!r,!a),o.detail=n,t.dispatchEvent(o),o},S=function(e,i){var s;!a&&(s=t.picturefill||n.pf)?(i&&i.src&&!e[l]("srcset")&&e.setAttribute("srcset",i.src),s({reevaluate:!0,elements:[e]})):i&&i.src&&(e.src=i.src)},b=function(t,e){return(window.getComputedStyle(t,null)||{})[e]},T=function(t,e,i){for(i=i||t.offsetWidth;i<n.minSize&&e&&!t._lazysizesWidth;)i=e.offsetWidth,e=e.parentNode;return i},D=function(){var t,i,s=[],n=[],r=s,a=function(){var e=r;for(r=s.length?n:s,t=!0,i=!1;e.length;)e.shift()();t=!1},o=function(s,n){t&&!n?s.apply(this,arguments):(r.push(s),i||(i=!0,(e.hidden?u:h)(a)))};return o._lsFlush=a,o}(),I=function(t,e){return e?function(){D(t)}:function(){var e=this,i=arguments;D(function(){t.apply(e,i)})}},C=function(t){var e,s=0,r=n.throttleDelay,a=n.ricTimeout,o=function(){e=!1,s=i.now(),t()},l=c&&a>49?function(){c(o,{timeout:a}),a!==n.ricTimeout&&(a=n.ricTimeout)}:I(function(){u(o)},!0);return function(t){var n;(t=!0===t)&&(a=33),e||(e=!0,(n=r-(i.now()-s))<0&&(n=0),t||n<9?l():u(l,n))}},R=function(t){var e,s,n=function(){e=null,t()},r=function(){var t=i.now()-s;t<99?u(r,99-t):(c||n)(n)};return function(){s=i.now(),e||(e=u(r,99))}},P=function(){var a,c,f,v,T,P,O,L,N,k,w,U,B=/^img$/i,j=/^iframe$/i,F="onscroll"in t&&!/(gle|ing)bot/.test(window.navigator.userAgent),x=0,G=0,V=-1,H=function(t){G--,(!t||G<0||!t.target)&&(G=0)},W=function(t){return null==U&&(U="hidden"==b(e.body,"visibility")),U||!("hidden"==b(t.parentNode,"visibility")&&"hidden"==b(t,"visibility"))},K=function(t,i){var s,n=t,a=W(t);for(L-=i,w+=i,N-=i,k+=i;a&&(n=n.offsetParent)&&n!=e.body&&n!=r;)(a=(b(n,"opacity")||1)>0)&&"visible"!=b(n,"overflow")&&(s=n.getBoundingClientRect(),a=k>s.left&&N<s.right&&w>s.top-1&&L<s.bottom+1);return a},z=function(){var t,i,o,d,u,h,p,f,g,_,E,m,A=s.elements;if((v=n.loadMode)&&G<8&&(t=A.length)){for(i=0,V++;i<t;i++)if(A[i]&&!A[i]._lazyRace)if(!F||s.prematureUnveil&&s.prematureUnveil(A[i]))$(A[i]);else if((f=A[i][l]("data-expand"))&&(h=1*f)||(h=x),_||(_=!n.expand||n.expand<1?r.clientHeight>500&&r.clientWidth>500?500:370:n.expand,s._defEx=_,E=_*n.expFactor,m=n.hFac,U=null,x<E&&G<1&&V>2&&v>2&&!e.hidden?(x=E,V=0):x=v>1&&V>1&&G<6?_:0),g!==h&&(P=window.innerWidth+h*m,O=window.innerHeight+h,p=-1*h,g=h),o=A[i].getBoundingClientRect(),(w=o.bottom)>=p&&(L=o.top)<=O&&(k=o.right)>=p*m&&(N=o.left)<=P&&(w||k||N||L)&&(n.loadHidden||W(A[i]))&&(c&&G<3&&!f&&(v<3||V<4)||K(A[i],h))){if($(A[i]),u=!0,G>9)break}else!u&&c&&!d&&G<4&&V<4&&v>2&&(a[0]||n.preloadAfterLoad)&&(a[0]||!f&&(w||k||N||L||"auto"!=A[i][l](n.sizesAttr)))&&(d=a[0]||A[i]);d&&!u&&$(d)}},Y=C(z),q=function(t){var e=t.target;e._lazyCache?delete e._lazyCache:(H(t),E(e,n.loadedClass),m(e,n.loadingClass),A(e,J),y(e,"lazyloaded"))},X=I(q),J=function(t){X({target:t.target})},Q=function(t){var e,i=t[l](n.srcsetAttr);(e=n.customMedia[t[l]("data-media")||t[l]("media")])&&t.setAttribute("media",e),i&&t.setAttribute("srcset",i)},Z=I(function(t,e,i,s,r){var a,o,d,h,c,v;(c=y(t,"lazybeforeunveil",e)).defaultPrevented||(s&&(i?E(t,n.autosizesClass):t.setAttribute("sizes",s)),o=t[l](n.srcsetAttr),a=t[l](n.srcAttr),r&&(h=(d=t.parentNode)&&p.test(d.nodeName||"")),v=e.firesLoad||"src"in t&&(o||a||h),c={target:t},E(t,n.loadingClass),v&&(window.clearTimeout(f),f=u(H,2500),A(t,J,!0)),h&&g.call(d.getElementsByTagName("source"),Q),o?t.setAttribute("srcset",o):a&&!h&&(j.test(t.nodeName)?function(t,e){try{t.contentWindow.location.replace(e)}catch(i){t.src=e}}(t,a):t.src=a),r&&(o||h)&&S(t,{src:a})),t._lazyRace&&delete t._lazyRace,m(t,n.lazyClass),D(function(){var e=t.complete&&t.naturalWidth>1;v&&!e||(e&&E(t,"ls-is-cached"),q(c),t._lazyCache=!0,u(function(){"_lazyCache"in t&&delete t._lazyCache},9)),"lazy"==t.loading&&G--},!0)}),$=function(t){if(!t._lazyRace){var e,i=B.test(t.nodeName),s=i&&(t[l](n.sizesAttr)||t[l]("sizes")),r="auto"==s;(!r&&c||!i||!t[l]("src")&&!t.srcset||t.complete||_(t,n.errorClass)||!_(t,n.lazyClass))&&(e=y(t,"lazyunveilread").detail,r&&M.updateElem(t,!0,t.offsetWidth),t._lazyRace=!0,G++,Z(t,e,r,s,i))}},tt=R(function(){n.loadMode=3,Y()}),et=function(){3==n.loadMode&&(n.loadMode=2),tt()},it=function(){c||(i.now()-T<999?u(it,999):(c=!0,n.loadMode=3,Y(),d("scroll",et,!0)))};return{_:function(){T=i.now(),s.elements=e.getElementsByClassName(n.lazyClass),a=e.getElementsByClassName(n.lazyClass+" "+n.preloadClass),d("scroll",Y,!0),d("resize",Y,!0),d("pageshow",function(t){if(t.persisted){var i=e.querySelectorAll("."+n.loadingClass);i.length&&i.forEach&&h(function(){i.forEach(function(t){t.complete&&$(t)})})}}),t.MutationObserver?new MutationObserver(Y).observe(r,{childList:!0,subtree:!0,attributes:!0}):(r[o]("DOMNodeInserted",Y,!0),r[o]("DOMAttrModified",Y,!0),window.setInterval(Y,999)),d("hashchange",Y,!0),["focus","mouseover","click","load","transitionend","animationend"].forEach(function(t){e[o](t,Y,!0)}),/d$|^c/.test(e.readyState)?it():(d("load",it),e[o]("DOMContentLoaded",Y),u(it,2e4)),s.elements.length?(z(),D._lsFlush()):Y()},checkElems:Y,unveil:$,_aLSL:et}}(),M=function(){var t,i=I(function(t,e,i,s){var n,r,a;if(t._lazysizesWidth=s,s+="px",t.setAttribute("sizes",s),p.test(e.nodeName||""))for(r=0,a=(n=e.getElementsByTagName("source")).length;r<a;r++)n[r].setAttribute("sizes",s);i.detail.dataAttr||S(t,i.detail)}),s=function(t,e,s){var n,r=t.parentNode;r&&(s=T(t,r,s),(n=y(t,"lazybeforesizes",{width:s,dataAttr:!!e})).defaultPrevented||(s=n.detail.width)&&s!==t._lazysizesWidth&&i(t,r,n,s))},r=R(function(){var e,i=t.length;if(i)for(e=0;e<i;e++)s(t[e])});return{_:function(){t=e.getElementsByClassName(n.autosizesClass),d("resize",r)},checkElems:r,updateElem:s}}(),O=function(){!O.i&&e.getElementsByClassName&&(O.i=!0,M._(),P._())};return u(function(){n.init&&O()}),s={cfg:n,autoSizer:M,loader:P,init:O,uP:S,aC:E,rC:m,hC:_,fire:y,gW:T,rAF:D}}(t,t.document,Date);"object"==typeof window.module&&window.module.exports?window.module.exports=e:"function"==typeof window.define&&window.define.amd?window.define("common/../../../../../../../node_modules/lazysizes/lazysizes-umd.min",e):t.lazySizes=e}(window),window.require(["libs/lazysizes.plugins","common/../../../../../../../node_modules/lazysizes/lazysizes-umd.min"],function(t,e){e.init()}),window.define("common/lazysizes",function(){}),function(){"use strict";var t={"element.closest":function(){return!!window.Element.prototype.closest},fetch:function(){return!!window.fetch},"function.prototype.bind":function(){return!!Function.prototype.bind},"intersection-observer":function(){return"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype},lineclamp:function(){return void 0!==window.document.body.style.webkitLineClamp},"object.assign":function(){return"function"==typeof Object.assign},objectfit:function(){return void 0===window.document.body.style.msTouchAction},Promise:function(){return!!("Promise"in window)},sendBeacon:function(){return"function"==typeof window.navigator.sendBeacon},"window.CustomEvent":function(){return!(!window.CustomEvent||"object"==typeof window.CustomEvent)}};window.define("polyfill",{version:"1.0",load:function(e,i,s,n){if(!t)throw new Error("A polyfill config has not been setup");if(!t[e])throw new Error("A polyfill for "+e+" was not specified");n.isBuild||!0===t[e]()?s():i(["polyfills/"+e],function(t){s(t)})}})}(),function(){var t;(function(){function t(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function e(t,e){for(var i=-1,s=null==t?0:t.length;++i<s&&!1!==e(t[i],i,t););return t}function i(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(!e(t[i],i,t))return!1;return!0}function s(t,e){for(var i=-1,s=null==t?0:t.length,n=0,r=[];++i<s;){var a=t[i];e(a,i,t)&&(r[n++]=a)}return r}function n(t,e){return!(null==t||!t.length)&&u(t,e,0)>-1}function r(t,e,i){for(var s=-1,n=null==t?0:t.length;++s<n;)if(i(e,t[s]))return!0;return!1}function a(t,e){for(var i=-1,s=null==t?0:t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}function o(t,e){for(var i=-1,s=e.length,n=t.length;++i<s;)t[n+i]=e[i];return t}function l(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}function d(t,e,i,s){for(var n=t.length,r=i+(s?1:-1);s?r--:++r<n;)if(e(t[r],r,t))return r;return-1}function u(t,e,i){return e==e?function(t,e,i){for(var s=i-1,n=t.length;++s<n;)if(t[s]===e)return s;return-1}(t,e,i):d(t,c,i)}function h(t,e,i,s){for(var n=i-1,r=t.length;++n<r;)if(s(t[n],e))return n;return-1}function c(t){return t!=t}function p(t){return function(e){return null==e?Re:e[t]}}function f(t){return function(e){return t(e)}}function v(t,e){return a(e,function(e){return t[e]})}function g(t,e){return t.has(e)}function _(t){return"\\"+Ts[t]}function E(t){return As.test(t)}function m(t){var e=-1,i=Array(t.size);return t.forEach(function(t,s){i[++e]=[s,t]}),i}function A(t,e){return function(i){return t(e(i))}}function y(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function S(t){return E(t)?function(t){for(var e=ms.lastIndex=0;ms.test(t);)++e;return e}(t):js(t)}function b(t){return E(t)?function(t){return t.match(ms)||[]}(t):function(t){return t.split("")}(t)}function T(t){if(ne(t)&&!$n(t)&&!(t instanceof C)){if(t instanceof I)return t;if(Ks.call(t,"__wrapped__"))return Ft(t)}return new I(t)}function D(){}function I(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=Re}function C(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ii,this.__views__=[]}function R(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function P(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function M(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function O(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new M;++e<i;)this.add(t[e])}function L(t){var e=this.__data__=new P(t);this.size=e.size}function N(t,e){var i=$n(t),s=!i&&Zn(t),n=!i&&!s&&tr(t),r=!i&&!s&&!n&&nr(t),a=i||s||n||r,o=a?function(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}(t.length,String):[],l=o.length;for(var d in t)!e&&!Ks.call(t,d)||a&&("length"==d||n&&("offset"==d||"parent"==d)||r&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||Rt(d,l))||o.push(d);return o}function k(t,e,i){var s=t[e];Ks.call(t,e)&&Qt(s,i)&&(i!==Re||e in t)||U(t,e,i)}function w(t,e){for(var i=t.length;i--;)if(Qt(t[i][0],e))return i;return-1}function U(t,e,i){"__proto__"==e&&dn?dn(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function B(t,e,i){return t==t&&(i!==Re&&(t=t<=i?t:i),e!==Re&&(t=t>=e?t:e)),t}function j(t,i,s,n,r,a){var o,l=i&ke,d=i&we,u=i&Ue;if(s&&(o=r?s(t,n,r,a):s(t)),o!==Re)return o;if(!se(t))return t;var h=$n(t);if(h){if(o=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&Ks.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(t),!l)return vt(t,o)}else{var c=Hn(t),p=c==hi||c==ci;if(tr(t))return function(t,e){if(e)return t.slice();var i=t.length,s=tn?tn(i):new t.constructor(i);return t.copy(s),s}(t,l);if(c==gi||c==ni||p&&!r){if(o=d||p?{}:function(t){return"function"!=typeof t.constructor||Ot(t)?{}:wn(en(t))}(t),!l)return d?function(t,e){return gt(t,Vn(t),e)}(t,function(t,e){return t&&gt(e,_e(e),t)}(o,t)):function(t,e){return gt(t,Gn(t),e)}(t,function(t,e){return t&&gt(e,ge(e),t)}(o,t))}else{if(!bs[c])return r?t:{};o=function(t,e,i){var s=t.constructor;switch(e){case Di:return pt(t);case oi:case li:return new s(+t);case Ii:return function(t,e){var i=e?pt(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case Ci:case Ri:case Pi:case Mi:case Oi:case Li:case Ni:case ki:case wi:return function(t,e){var i=e?pt(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}(t,i);case pi:return new s;case fi:case yi:return new s(t);case mi:return function(t){var e=new t.constructor(t.source,Qi.exec(t));return e.lastIndex=t.lastIndex,e}(t);case Ai:return new s;case Si:return function(t){return Nn?Object(Nn.call(t)):{}}(t)}}(t,c,l)}}a||(a=new L);var f=a.get(t);if(f)return f;if(a.set(t,o),sr(t))return t.forEach(function(e){o.add(j(e,i,s,e,t,a))}),o;if(ir(t))return t.forEach(function(e,n){o.set(n,j(e,i,s,n,t,a))}),o;var v=h?Re:(u?d?St:yt:d?_e:ge)(t);return e(v||t,function(e,n){v&&(e=t[n=e]),k(o,n,j(e,i,s,n,t,a))}),o}function F(t,e){var i=!0;return Un(t,function(t,s,n){return i=!!e(t,s,n)}),i}function x(t,e,i,s,n){var r=-1,a=t.length;for(i||(i=Ct),n||(n=[]);++r<a;){var l=t[r];e>0&&i(l)?e>1?x(l,e-1,i,s,n):o(n,l):s||(n[n.length]=l)}return n}function G(t,e){return t&&Bn(t,e,ge)}function V(t,e){return s(e,function(e){return ee(t[e])})}function H(t,e){for(var i=0,s=(e=ht(e,t)).length;null!=t&&i<s;)t=t[Ut(e[i++])];return i&&i==s?t:Re}function W(t,e,i){var s=e(t);return $n(t)?s:o(s,i(t))}function K(t){return null==t?t===Re?bi:vi:ln&&ln in Object(t)?function(t){var e=Ks.call(t,ln),i=t[ln];try{t[ln]=Re;var s=!0}catch(t){}var n=Ys.call(t);return s&&(e?t[ln]=i:delete t[ln]),n}(t):function(t){return Ys.call(t)}(t)}function z(t,e){return null!=t&&Ks.call(t,e)}function Y(t,e){return null!=t&&e in Object(t)}function q(e,i,s){var n=null==(e=function(t,e){return e.length<2?t:H(t,ot(e,0,-1))}(e,i=ht(i,e)))?e:e[Ut(Vt(i))];return null==n?Re:t(n,e,s)}function X(t){return ne(t)&&K(t)==ni}function J(t,e,i,s,n){return t===e||(null==t||null==e||!ne(t)&&!ne(e)?t!=t&&e!=e:function(t,e,i,s,n,r){var a=$n(t),o=$n(e),l=a?ri:Hn(t),d=o?ri:Hn(e),u=(l=l==ni?gi:l)==gi,h=(d=d==ni?gi:d)==gi,c=l==d;if(c&&tr(t)){if(!tr(e))return!1;a=!0,u=!1}if(c&&!u)return r||(r=new L),a||nr(t)?At(t,e,i,s,n,r):function(t,e,i,s,n,r,a){switch(i){case Ii:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Di:return!(t.byteLength!=e.byteLength||!r(new $s(t),new $s(e)));case oi:case li:case fi:return Qt(+t,+e);case ui:return t.name==e.name&&t.message==e.message;case mi:case yi:return t==e+"";case pi:var o=m;case Ai:var l=s&Be;if(o||(o=y),t.size!=e.size&&!l)return!1;var d=a.get(t);if(d)return d==e;s|=je,a.set(t,e);var u=At(o(t),o(e),s,n,r,a);return a.delete(t),u;case Si:if(Nn)return Nn.call(t)==Nn.call(e)}return!1}(t,e,l,i,s,n,r);if(!(i&Be)){var p=u&&Ks.call(t,"__wrapped__"),f=h&&Ks.call(e,"__wrapped__");if(p||f){var v=p?t.value():t,g=f?e.value():e;return r||(r=new L),n(v,g,i,s,r)}}return!!c&&(r||(r=new L),function(t,e,i,s,n,r){var a=i&Be,o=yt(t),l=o.length;if(l!=yt(e).length&&!a)return!1;for(var d=l;d--;){var u=o[d];if(!(a?u in e:Ks.call(e,u)))return!1}var h=r.get(t);if(h&&r.get(e))return h==e;var c=!0;r.set(t,e),r.set(e,t);for(var p=a;++d<l;){u=o[d];var f=t[u],v=e[u];if(s)var g=a?s(v,f,u,e,t,r):s(f,v,u,t,e,r);if(!(g===Re?f===v||n(f,v,i,s,r):g)){c=!1;break}p||(p="constructor"==u)}if(c&&!p){var _=t.constructor,E=e.constructor;_!=E&&"constructor"in t&&"constructor"in e&&!("function"==typeof _&&_ instanceof _&&"function"==typeof E&&E instanceof E)&&(c=!1)}return r.delete(t),r.delete(e),c}(t,e,i,s,n,r))}(t,e,i,s,J,n))}function Q(t){return!(!se(t)||function(t){return!!zs&&zs in t}(t))&&(ee(t)?Js:ts).test(Bt(t))}function Z(t){return"function"==typeof t?t:null==t?ye:"object"==typeof t?$n(t)?function(t,e){return Mt(t)&&Lt(e)?Nt(Ut(t),e):function(i){var s=fe(i,t);return s===Re&&s===e?ve(i,t):J(e,s,Be|je)}}(t[0],t[1]):function(t){var e=function(t){for(var e=ge(t),i=e.length;i--;){var s=e[i],n=t[s];e[i]=[s,n,Lt(n)]}return e}(t);return 1==e.length&&e[0][2]?Nt(e[0][0],e[0][1]):function(i){return i===t||function(t,e,i,s){var n=i.length,r=n,a=!s;if(null==t)return!r;for(t=Object(t);n--;){var o=i[n];if(a&&o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++n<r;){var l=(o=i[n])[0],d=t[l],u=o[1];if(a&&o[2]){if(d===Re&&!(l in t))return!1}else{var h=new L;if(s)var c=s(d,u,l,t,e,h);if(!(c===Re?J(u,d,Be|je,s,h):c))return!1}}return!0}(i,t,e)}}(t):De(t)}function $(t){if(!Ot(t))return fn(t);var e=[];for(var i in Object(t))Ks.call(t,i)&&"constructor"!=i&&e.push(i);return e}function tt(t){if(!se(t))return function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}(t);var e=Ot(t),i=[];for(var s in t)("constructor"!=s||!e&&Ks.call(t,s))&&i.push(s);return i}function et(t,e){return t<e}function it(t,e){var i=-1,s=Zt(t)?Array(t.length):[];return Un(t,function(t,n,r){s[++i]=e(t,n,r)}),s}function st(t,e,i){var s=-1;return e=a(e.length?e:[ye],f(bt())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(it(t,function(t,i,n){return{criteria:a(e,function(e){return e(t)}),index:++s,value:t}}),function(t,e){return function(t,e,i){for(var s=-1,n=t.criteria,r=e.criteria,a=n.length,o=i.length;++s<a;){var l=ft(n[s],r[s]);if(l)return s>=o?l:l*("desc"==i[s]?-1:1)}return t.index-e.index}(t,e,i)})}function nt(t,e){var i="";if(!t||e<1||e>$e)return i;do{e%2&&(i+=t),(e=hn(e/2))&&(t+=t)}while(e);return i}function rt(t,e){return Kn(kt(t,e,ye),t+"")}function at(t,e,i,s){if(!se(t))return t;for(var n=-1,r=(e=ht(e,t)).length,a=r-1,o=t;null!=o&&++n<r;){var l=Ut(e[n]),d=i;if(n!=a){var u=o[l];(d=s?s(u,l,o):Re)===Re&&(d=se(u)?u:Rt(e[n+1])?[]:{})}k(o,l,d),o=o[l]}return t}function ot(t,e,i){var s=-1,n=t.length;e<0&&(e=-e>n?0:n+e),(i=i>n?n:i)<0&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0;for(var r=Array(n);++s<n;)r[s]=t[s+e];return r}function lt(t,e){var i;return Un(t,function(t,s,n){return!(i=e(t,s,n))}),!!i}function dt(t){if("string"==typeof t)return t;if($n(t))return a(t,dt)+"";if(le(t))return kn?kn.call(t):"";var e=t+"";return"0"==e&&1/t==-Ze?"-0":e}function ut(t,e){var i=t;return i instanceof C&&(i=i.value()),function(t,e,i,s){var n=-1,r=null==t?0:t.length;for(s&&r&&(i=t[++n]);++n<r;)i=e(i,t[n],n,t);return i}(e,function(t,e){return e.func.apply(e.thisArg,o([t],e.args))},i)}function ht(t,e){return $n(t)?t:Mt(t,e)?[t]:zn(pe(t))}function ct(t,e,i){var s=t.length;return i=i===Re?s:i,!e&&i>=s?t:ot(t,e,i)}function pt(t){var e=new t.constructor(t.byteLength);return new $s(e).set(new $s(t)),e}function ft(t,e){if(t!==e){var i=t!==Re,s=null===t,n=t==t,r=le(t),a=e!==Re,o=null===e,l=e==e,d=le(e);if(!o&&!d&&!r&&t>e||r&&a&&l&&!o&&!d||s&&a&&l||!i&&l||!n)return 1;if(!s&&!r&&!d&&t<e||d&&i&&n&&!s&&!r||o&&i&&n||!a&&n||!l)return-1}return 0}function vt(t,e){var i=-1,s=t.length;for(e||(e=Array(s));++i<s;)e[i]=t[i];return e}function gt(t,e,i,s){var n=!i;i||(i={});for(var r=-1,a=e.length;++r<a;){var o=e[r],l=s?s(i[o],t[o],o,i,t):Re;l===Re&&(l=t[o]),n?U(i,o,l):k(i,o,l)}return i}function _t(t){return rt(function(e,i){var s=-1,n=i.length,r=n>1?i[n-1]:Re,a=n>2?i[2]:Re;for(r=t.length>3&&"function"==typeof r?(n--,r):Re,a&&Pt(i[0],i[1],a)&&(r=n<3?Re:r,n=1),e=Object(e);++s<n;){var o=i[s];o&&t(e,o,s,r)}return e})}function Et(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=wn(t.prototype),s=t.apply(i,e);return se(s)?s:i}}function mt(t,e,i,s){return t===Re||Qt(t,Vs[i])&&!Ks.call(s,i)?e:t}function At(t,e,i,s,n,r){var a=i&Be,o=t.length,d=e.length;if(o!=d&&!(a&&d>o))return!1;var u=r.get(t);if(u&&r.get(e))return u==e;var h=-1,c=!0,p=i&je?new O:Re;for(r.set(t,e),r.set(e,t);++h<o;){var f=t[h],v=e[h];if(s)var _=a?s(v,f,h,e,t,r):s(f,v,h,t,e,r);if(_!==Re){if(_)continue;c=!1;break}if(p){if(!l(e,function(t,e){if(!g(p,e)&&(f===t||n(f,t,i,s,r)))return p.push(e)})){c=!1;break}}else if(f!==v&&!n(f,v,i,s,r)){c=!1;break}}return r.delete(t),r.delete(e),c}function yt(t){return W(t,ge,Gn)}function St(t){return W(t,_e,Vn)}function bt(){var t=T.iteratee||Se;return t=t===Se?Z:t,arguments.length?t(arguments[0],arguments[1]):t}function Tt(t,e){var i=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?i["string"==typeof e?"string":"hash"]:i.map}function Dt(t,e){var i=function(t,e){return null==t?Re:t[e]}(t,e);return Q(i)?i:Re}function It(t,e,i){for(var s=-1,n=(e=ht(e,t)).length,r=!1;++s<n;){var a=Ut(e[s]);if(!(r=null!=t&&i(t,a)))break;t=t[a]}return r||++s!=n?r:!!(n=null==t?0:t.length)&&ie(n)&&Rt(a,n)&&($n(t)||Zn(t))}function Ct(t){return $n(t)||Zn(t)||!!(an&&t&&t[an])}function Rt(t,e){var i=typeof t;return!!(e=null==e?$e:e)&&("number"==i||"symbol"!=i&&is.test(t))&&t>-1&&t%1==0&&t<e}function Pt(t,e,i){if(!se(i))return!1;var s=typeof e;return!!("number"==s?Zt(i)&&Rt(e,i.length):"string"==s&&e in i)&&Qt(i[e],t)}function Mt(t,e){if($n(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!le(t))||Hi.test(t)||!Vi.test(t)||null!=e&&t in Object(e)}function Ot(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Vs)}function Lt(t){return t==t&&!se(t)}function Nt(t,e){return function(i){return null!=i&&i[t]===e&&(e!==Re||t in Object(i))}}function kt(e,i,s){return i=vn(i===Re?e.length-1:i,0),function(){for(var n=arguments,r=-1,a=vn(n.length-i,0),o=Array(a);++r<a;)o[r]=n[i+r];r=-1;for(var l=Array(i+1);++r<i;)l[r]=n[r];return l[i]=s(o),t(e,this,l)}}function wt(t){var e=0,i=0;return function(){var s=_n(),n=Xe-(s-i);if(i=s,n>0){if(++e>=qe)return arguments[0]}else e=0;return t.apply(Re,arguments)}}function Ut(t){if("string"==typeof t||le(t))return t;var e=t+"";return"0"==e&&1/t==-Ze?"-0":e}function Bt(t){if(null!=t){try{return Ws.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function jt(t,i){return e(si,function(e){var s="_."+e[0];i&e[1]&&!n(t,s)&&t.push(s)}),t.sort()}function Ft(t){if(t instanceof C)return t.clone();var e=new I(t.__wrapped__,t.__chain__);return e.__actions__=vt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function xt(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=null==i?0:he(i);return n<0&&(n=vn(s+n,0)),d(t,bt(e,3),n)}function Gt(t){return null!=t&&t.length?x(t,1):[]}function Vt(t){var e=null==t?0:t.length;return e?t[e-1]:Re}function Ht(t,e){return t&&t.length&&e&&e.length?function(t,e,i,s){var n=s?h:u,r=-1,o=e.length,l=t;for(t===e&&(e=vt(e)),i&&(l=a(t,f(i)));++r<o;)for(var d=0,c=e[r],p=i?i(c):c;(d=n(l,p,d,s))>-1;)l!==t&&rn.call(l,d,1),rn.call(t,d,1);return t}(t,e):t}function Wt(t){return null==t?t:En.call(t)}function Kt(t){var e=T(t);return e.__chain__=!0,e}function zt(t,e){return e(t)}function Yt(t,i){return($n(t)?e:Un)(t,bt(i,3))}function qt(t,e,i){function s(e){var i=l,s=d;return l=d=Re,f=e,h=t.apply(s,i)}function n(t){var i=t-p;return p===Re||i>=e||i<0||g&&t-f>=u}function r(){var t=Qn();if(n(t))return a(t);c=window.setTimeout(r,function(t){var i=e-(t-p);return g?gn(i,u-(t-f)):i}(t))}function a(t){return c=Re,_&&l?s(t):(l=d=Re,h)}function o(){var t=Qn(),i=n(t);if(l=arguments,d=this,p=t,i){if(c===Re)return function(t){return f=t,c=window.setTimeout(r,e),v?s(t):h}(p);if(g)return c=window.setTimeout(r,e),s(p)}return c===Re&&(c=window.setTimeout(r,e)),h}var l,d,u,h,c,p,f=0,v=!1,g=!1,_=!0;if("function"!=typeof t)throw new TypeError(Me);return e=ce(e)||0,se(i)&&(v=!!i.leading,u=(g="maxWait"in i)?vn(ce(i.maxWait)||0,e):u,_="trailing"in i?!!i.trailing:_),o.cancel=function(){c!==Re&&window.clearTimeout(c),f=0,l=p=d=c=Re},o.flush=function(){return c===Re?h:a(Qn())},o}function Xt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Me);var i=function(){var s=arguments,n=e?e.apply(this,s):s[0],r=i.cache;if(r.has(n))return r.get(n);var a=t.apply(this,s);return i.cache=r.set(n,a)||r,a};return i.cache=new(Xt.Cache||M),i}function Jt(t){if("function"!=typeof t)throw new TypeError(Me);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Qt(t,e){return t===e||t!=t&&e!=e}function Zt(t){return null!=t&&ie(t.length)&&!ee(t)}function $t(t){return ne(t)&&Zt(t)}function te(t){if(!ne(t))return!1;var e=K(t);return e==ui||e==di||"string"==typeof t.message&&"string"==typeof t.name&&!ae(t)}function ee(t){if(!se(t))return!1;var e=K(t);return e==hi||e==ci||e==ai||e==Ei}function ie(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=$e}function se(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ne(t){return null!=t&&"object"==typeof t}function re(t){return"number"==typeof t||ne(t)&&K(t)==fi}function ae(t){if(!ne(t)||K(t)!=gi)return!1;var e=en(t);if(null===e)return!0;var i=Ks.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&Ws.call(i)==qs}function oe(t){return"string"==typeof t||!$n(t)&&ne(t)&&K(t)==yi}function le(t){return"symbol"==typeof t||ne(t)&&K(t)==Si}function de(t){if(!t)return[];if(Zt(t))return oe(t)?b(t):vt(t);if(on&&t[on])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[on]());var e=Hn(t);return(e==pi?m:e==Ai?y:me)(t)}function ue(t){return t?(t=ce(t))===Ze||t===-Ze?(t<0?-1:1)*ti:t==t?t:0:0===t?t:0}function he(t){var e=ue(t),i=e%1;return e==e?i?e-i:e:0}function ce(t){if("number"==typeof t)return t;if(le(t))return ei;if(se(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=se(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Ki,"");var i=$i.test(t);return i||es.test(t)?Ds(t.slice(2),i?2:8):Zi.test(t)?ei:+t}function pe(t){return null==t?"":dt(t)}function fe(t,e,i){var s=null==t?Re:H(t,e);return s===Re?i:s}function ve(t,e){return null!=t&&It(t,e,Y)}function ge(t){return Zt(t)?N(t):$(t)}function _e(t){return Zt(t)?N(t,!0):tt(t)}function Ee(t,e){if(null==t)return{};var i=a(St(t),function(t){return[t]});return e=bt(e),function(t,e,i){for(var s=-1,n=e.length,r={};++s<n;){var a=e[s],o=H(t,a);i(o,a)&&at(r,ht(a,t),o)}return r}(t,i,function(t,i){return e(t,i[0])})}function me(t){return null==t?[]:v(t,ge(t))}function Ae(t){return function(){return t}}function ye(t){return t}function Se(t){return Z("function"==typeof t?t:j(t,ke))}function be(t,i,s){var n=ge(i),r=V(i,n);null!=s||se(i)&&(r.length||!n.length)||(s=i,i=t,t=this,r=V(i,ge(i)));var a=!(se(s)&&"chain"in s&&!s.chain),l=ee(t);return e(r,function(e){var s=i[e];t[e]=s,l&&(t.prototype[e]=function(){var e=this.__chain__;if(a||e){var i=t(this.__wrapped__);return(i.__actions__=vt(this.__actions__)).push({func:s,args:arguments,thisArg:t}),i.__chain__=e,i}return s.apply(t,o([this.value()],arguments))})}),t}function Te(){}function De(t){return Mt(t)?p(Ut(t)):function(t){return function(e){return H(e,t)}}(t)}function Ie(){return[]}function Ce(){return!1}var Re,Pe=200,Me="Expected a function",Oe="__lodash_hash_undefined__",Le=500,Ne="__lodash_placeholder__",ke=1,we=2,Ue=4,Be=1,je=2,Fe=1,xe=2,Ge=4,Ve=8,He=16,We=32,Ke=64,ze=128,Ye=512,qe=800,Xe=16,Je=1,Qe=2,Ze=1/0,$e=9007199254740991,ti=1.7976931348623157e308,ei=window.NaN,ii=4294967295,si=[["ary",ze],["bind",Fe],["bindKey",xe],["curry",Ve],["curryRight",He],["flip",Ye],["partial",We],["partialRight",Ke],["rearg",256]],ni="[object Arguments]",ri="[object Array]",ai="[object AsyncFunction]",oi="[object Boolean]",li="[object Date]",di="[object DOMException]",ui="[object Error]",hi="[object Function]",ci="[object GeneratorFunction]",pi="[object Map]",fi="[object Number]",vi="[object Null]",gi="[object Object]",_i="[object Promise]",Ei="[object Proxy]",mi="[object RegExp]",Ai="[object Set]",yi="[object String]",Si="[object Symbol]",bi="[object Undefined]",Ti="[object WeakMap]",Di="[object ArrayBuffer]",Ii="[object DataView]",Ci="[object Float32Array]",Ri="[object Float64Array]",Pi="[object Int8Array]",Mi="[object Int16Array]",Oi="[object Int32Array]",Li="[object Uint8Array]",Ni="[object Uint8ClampedArray]",ki="[object Uint16Array]",wi="[object Uint32Array]",Ui=/\b__p \+= '';/g,Bi=/\b(__p \+=) '' \+/g,ji=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Fi=/[&<>"']/g,xi=RegExp(Fi.source),Gi=/<%=([\s\S]+?)%>/g,Vi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hi=/^\w*$/,Wi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ki=/^\s+|\s+$/g,zi=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Yi=/\{\n\/\* \[wrapped with (.+)\] \*/,qi=/,? & /,Xi=/\\(\\)?/g,Ji=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Qi=/\w*$/,Zi=/^[-+]0x[0-9a-f]+$/i,$i=/^0b[01]+$/i,ts=/^\[object .+?Constructor\]$/,es=/^0o[0-7]+$/i,is=/^(?:0|[1-9]\d*)$/,ss=/($^)/,ns=/['\n\r\u2028\u2029\\]/g,rs="\\ud800-\\udfff",as="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",os="\\ufe0e\\ufe0f",ls="["+rs+"]",ds="["+as+"]",us="\\ud83c[\\udffb-\\udfff]",hs="[^"+rs+"]",cs="(?:\\ud83c[\\udde6-\\uddff]){2}",ps="[\\ud800-\\udbff][\\udc00-\\udfff]",fs="\\u200d",vs="(?:"+ds+"|"+us+")?",gs="["+os+"]?",_s=gs+vs+"(?:"+fs+"(?:"+[hs,cs,ps].join("|")+")"+gs+vs+")*",Es="(?:"+[hs+ds+"?",ds,cs,ps,ls].join("|")+")",ms=RegExp(us+"(?="+us+")|"+Es+_s,"g"),As=RegExp("["+fs+rs+as+os+"]"),ys=-1,Ss={};Ss[Ci]=Ss[Ri]=Ss[Pi]=Ss[Mi]=Ss[Oi]=Ss[Li]=Ss[Ni]=Ss[ki]=Ss[wi]=!0,Ss[ni]=Ss[ri]=Ss[Di]=Ss[oi]=Ss[Ii]=Ss[li]=Ss[ui]=Ss[hi]=Ss[pi]=Ss[fi]=Ss[gi]=Ss[mi]=Ss[Ai]=Ss[yi]=Ss[Ti]=!1;var bs={};bs[ni]=bs[ri]=bs[Di]=bs[Ii]=bs[oi]=bs[li]=bs[Ci]=bs[Ri]=bs[Pi]=bs[Mi]=bs[Oi]=bs[pi]=bs[fi]=bs[gi]=bs[mi]=bs[Ai]=bs[yi]=bs[Si]=bs[Li]=bs[Ni]=bs[ki]=bs[wi]=!0,bs[ui]=bs[hi]=bs[Ti]=!1;var Ts={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ds=window.parseInt,Is="object"==typeof window.global&&window.global&&window.global.Object===Object&&window.global,Cs="object"==typeof window.self&&window.self&&window.self.Object===Object&&window.self,Rs=Is||Cs||Function("return this")(),Ps="object"==typeof window.exports&&window.exports&&!window.exports.nodeType&&window.exports,Ms=Ps&&"object"==typeof window.module&&window.module&&!window.module.nodeType&&window.module,Os=Ms&&Ms.exports===Ps,Ls=Os&&Is.process,Ns=function(){try{return Ls&&Ls.binding&&Ls.binding("util")}catch(t){}}(),ks=Ns&&Ns.isDate,ws=Ns&&Ns.isMap,Us=Ns&&Ns.isSet,Bs=Ns&&Ns.isTypedArray,js=p("length"),Fs=function(t){return function(e){return null==t?Re:t[e]}}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),xs=Array.prototype,Gs=Function.prototype,Vs=Object.prototype,Hs=Rs["__core-js_shared__"],Ws=Gs.toString,Ks=Vs.hasOwnProperty,zs=function(){var t=/[^.]+$/.exec(Hs&&Hs.keys&&Hs.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ys=Vs.toString,qs=Ws.call(Object),Xs=Rs._,Js=RegExp("^"+Ws.call(Ks).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Qs=Os?Rs.Buffer:Re,Zs=Rs.Symbol,$s=Rs.Uint8Array,tn=Qs?Qs.allocUnsafe:Re,en=A(Object.getPrototypeOf,Object),sn=Object.create,nn=Vs.propertyIsEnumerable,rn=xs.splice,an=Zs?Zs.isConcatSpreadable:Re,on=Zs?Zs.iterator:Re,ln=Zs?Zs.toStringTag:Re,dn=function(){try{var t=Dt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),un=Math.ceil,hn=Math.floor,cn=Object.getOwnPropertySymbols,pn=Qs?Qs.isBuffer:Re,fn=A(Object.keys,Object),vn=Math.max,gn=Math.min,_n=Date.now,En=xs.reverse,mn=Dt(Rs,"DataView"),An=Dt(Rs,"Map"),yn=Dt(Rs,"Promise"),Sn=Dt(Rs,"Set"),bn=Dt(Rs,"WeakMap"),Tn=Dt(Object,"create"),Dn=bn&&new bn,In={},Cn=Bt(mn),Rn=Bt(An),Pn=Bt(yn),Mn=Bt(Sn),On=Bt(bn),Ln=Zs?Zs.prototype:Re,Nn=Ln?Ln.valueOf:Re,kn=Ln?Ln.toString:Re,wn=function(){function t(){}return function(e){if(!se(e))return{};if(sn)return sn(e);t.prototype=e;var i=new t;return t.prototype=Re,i}}();T.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Gi,variable:"",imports:{_:T}},T.prototype=D.prototype,T.prototype.constructor=T,I.prototype=wn(D.prototype),I.prototype.constructor=I,C.prototype=wn(D.prototype),C.prototype.constructor=C,R.prototype.clear=function(){this.__data__=Tn?Tn(null):{},this.size=0},R.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},R.prototype.get=function(t){var e=this.__data__;if(Tn){var i=e[t];return i===Oe?Re:i}return Ks.call(e,t)?e[t]:Re},R.prototype.has=function(t){var e=this.__data__;return Tn?e[t]!==Re:Ks.call(e,t)},R.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Tn&&e===Re?Oe:e,this},P.prototype.clear=function(){this.__data__=[],this.size=0},P.prototype.delete=function(t){var e=this.__data__,i=w(e,t);return!(i<0||(i==e.length-1?e.pop():rn.call(e,i,1),--this.size,0))},P.prototype.get=function(t){var e=this.__data__,i=w(e,t);return i<0?Re:e[i][1]},P.prototype.has=function(t){return w(this.__data__,t)>-1},P.prototype.set=function(t,e){var i=this.__data__,s=w(i,t);return s<0?(++this.size,i.push([t,e])):i[s][1]=e,this},M.prototype.clear=function(){this.size=0,this.__data__={hash:new R,map:new(An||P),string:new R}},M.prototype.delete=function(t){var e=Tt(this,t).delete(t);return this.size-=e?1:0,e},M.prototype.get=function(t){return Tt(this,t).get(t)},M.prototype.has=function(t){return Tt(this,t).has(t)},M.prototype.set=function(t,e){var i=Tt(this,t),s=i.size;return i.set(t,e),this.size+=i.size==s?0:1,this},O.prototype.add=O.prototype.push=function(t){return this.__data__.set(t,Oe),this},O.prototype.has=function(t){return this.__data__.has(t)},L.prototype.clear=function(){this.__data__=new P,this.size=0},L.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},L.prototype.get=function(t){return this.__data__.get(t)},L.prototype.has=function(t){return this.__data__.has(t)},L.prototype.set=function(t,e){var i=this.__data__;if(i instanceof P){var s=i.__data__;if(!An||s.length<Pe-1)return s.push([t,e]),this.size=++i.size,this;i=this.__data__=new M(s)}return i.set(t,e),this.size=i.size,this};var Un=function(t,e){return function(i,s){if(null==i)return i;if(!Zt(i))return t(i,s);for(var n=i.length,r=e?n:-1,a=Object(i);(e?r--:++r<n)&&!1!==s(a[r],r,a););return i}}(G),Bn=function(t){return function(e,i,s){for(var n=-1,r=Object(e),a=s(e),o=a.length;o--;){var l=a[t?o:++n];if(!1===i(r[l],l,r))break}return e}}(),jn=Dn?function(t,e){return Dn.set(t,e),t}:ye,Fn=dn?function(t,e){return dn(t,"toString",{configurable:!0,enumerable:!1,value:Ae(e),writable:!0})}:ye,xn=Dn?function(t){return Dn.get(t)}:Te,Gn=cn?function(t){return null==t?[]:(t=Object(t),s(cn(t),function(e){return nn.call(t,e)}))}:Ie,Vn=cn?function(t){for(var e=[];t;)o(e,Gn(t)),t=en(t);return e}:Ie,Hn=K;(mn&&Hn(new mn(new ArrayBuffer(1)))!=Ii||An&&Hn(new An)!=pi||yn&&Hn(yn.resolve())!=_i||Sn&&Hn(new Sn)!=Ai||bn&&Hn(new bn)!=Ti)&&(Hn=function(t){var e=K(t),i=e==gi?t.constructor:Re,s=i?Bt(i):"";if(s)switch(s){case Cn:return Ii;case Rn:return pi;case Pn:return _i;case Mn:return Ai;case On:return Ti}return e});var Wn=wt(jn),Kn=wt(Fn),zn=function(t){var e=Xt(t,function(t){return i.size===Le&&i.clear(),t}),i=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Wi,function(t,i,s,n){e.push(s?n.replace(Xi,"$1"):i||t)}),e}),Yn=rt(Ht),qn=rt(function(t,e){return $t(t)?function(t,e,i,s){var o=-1,l=n,d=!0,u=t.length,h=[],c=e.length;if(!u)return h;i&&(e=a(e,f(i))),s?(l=r,d=!1):e.length>=Pe&&(l=g,d=!1,e=new O(e));t:for(;++o<u;){var p=t[o],v=null==i?p:i(p);if(p=s||0!==p?p:0,d&&v==v){for(var _=c;_--;)if(e[_]===v)continue t;h.push(p)}else l(e,v,s)||h.push(p)}return h}(t,e):[]}),Xn=(function(t){Kn(kt(t,Re,Gt),t+"")}(function(t){var e=t.length,i=e?t[0]:0,s=this.__wrapped__,n=function(e){return function(t,e){for(var i=-1,s=e.length,n=Array(s),r=null==t;++i<s;)n[i]=r?Re:fe(t,e[i]);return n}(e,t)};return!(e>1||this.__actions__.length)&&s instanceof C&&Rt(i)?((s=s.slice(i,+i+(e?1:0))).__actions__.push({func:zt,args:[n],thisArg:Re}),new I(s,this.__chain__).thru(function(t){return e&&!t.length&&t.push(Re),t})):this.thru(n)}),function(t){return function(e,i,s){var n=Object(e);if(!Zt(e)){var r=bt(i,3);e=ge(e),i=function(t){return r(n[t],t,n)}}var a=t(e,i,s);return a>-1?n[r?e[a]:a]:Re}}(xt)),Jn=rt(function(t,e){if(null==t)return[];var i=e.length;return i>1&&Pt(t,e[0],e[1])?e=[]:i>2&&Pt(e[0],e[1],e[2])&&(e=[e[0]]),st(t,x(e,1),[])}),Qn=function(){return Rs.Date.now()};Xt.Cache=M;var Zn=X(function(){return arguments}())?X:function(t){return ne(t)&&Ks.call(t,"callee")&&!nn.call(t,"callee")},$n=Array.isArray,tr=pn||Ce,er=ks?f(ks):function(t){return ne(t)&&K(t)==li},ir=ws?f(ws):function(t){return ne(t)&&Hn(t)==pi},sr=Us?f(Us):function(t){return ne(t)&&Hn(t)==Ai},nr=Bs?f(Bs):function(t){return ne(t)&&ie(t.length)&&!!Ss[K(t)]},rr=_t(function(t,e){if(Ot(e)||Zt(e))gt(e,ge(e),t);else for(var i in e)Ks.call(e,i)&&k(t,i,e[i])}),ar=_t(function(t,e){gt(e,_e(e),t)}),or=_t(function(t,e,i,s){gt(e,_e(e),t,s)}),lr=function(t){return function(e){var i=E(e=pe(e))?b(e):Re,s=i?i[0]:e.charAt(0),n=i?ct(i,1).join(""):e.slice(1);return s[t]()+n}}("toUpperCase"),dr=rt(function(e,i){try{return t(e,Re,i)}catch(e){return te(e)?e:new Error(e)}}),ur=function(t){var e=Math[t];return function(t,i){if(t=ce(t),i=null==i?0:gn(he(i),292)){var s=(pe(t)+"e").split("e");return+((s=(pe(e(s[0]+"e"+(+s[1]+i)))+"e").split("e"))[0]+"e"+(+s[1]-i))}return e(t)}}("round");T.assign=rr,T.assignIn=ar,T.assignInWith=or,T.chain=Kt,T.compact=function(t){for(var e=-1,i=null==t?0:t.length,s=0,n=[];++e<i;){var r=t[e];r&&(n[s++]=r)}return n},T.constant=Ae,T.debounce=qt,T.drop=function(t,e,i){var s=null==t?0:t.length;return s?ot(t,(e=i||e===Re?1:he(e))<0?0:e,s):[]},T.flatten=Gt,T.iteratee=Se,T.keys=ge,T.keysIn=_e,T.map=function(t,e){return($n(t)?a:it)(t,bt(e,3))},T.memoize=Xt,T.mixin=be,T.negate=Jt,T.omitBy=function(t,e){return Ee(t,Jt(bt(e)))},T.pickBy=Ee,T.property=De,T.pull=Yn,T.pullAll=Ht,T.reverse=Wt,T.sortBy=Jn,T.tap=function(t,e){return e(t),t},T.throttle=function(t,e,i){var s=!0,n=!0;if("function"!=typeof t)throw new TypeError(Me);return se(i)&&(s="leading"in i?!!i.leading:s,n="trailing"in i?!!i.trailing:n),qt(t,e,{leading:s,maxWait:e,trailing:n})},T.thru=zt,T.toArray=de,T.values=me,T.without=qn,T.extend=ar,T.extendWith=or,be(T,T),T.attempt=dr,T.capitalize=function(t){return lr(pe(t).toLowerCase())},T.clone=function(t){return j(t,Ue)},T.cloneDeep=function(t){return j(t,ke|Ue)},T.endsWith=function(t,e,i){t=pe(t),e=dt(e);var s=t.length,n=i=i===Re?s:B(he(i),0,s);return(i-=e.length)>=0&&t.slice(i,n)==e},T.eq=Qt,T.escape=function(t){return(t=pe(t))&&xi.test(t)?t.replace(Fi,Fs):t},T.every=function(t,e,s){var n=$n(t)?i:F;return s&&Pt(t,e,s)&&(e=Re),n(t,bt(e,3))},T.find=Xn,T.findIndex=xt,T.forEach=Yt,T.forOwn=function(t,e){return t&&G(t,bt(e,3))},T.get=fe,T.has=function(t,e){return null!=t&&It(t,e,z)},T.hasIn=ve,T.identity=ye,T.includes=function(t,e,i,s){t=Zt(t)?t:me(t),i=i&&!s?he(i):0;var n=t.length;return i<0&&(i=vn(n+i,0)),oe(t)?i<=n&&t.indexOf(e,i)>-1:!!n&&u(t,e,i)>-1},T.indexOf=function(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=null==i?0:he(i);return n<0&&(n=vn(s+n,0)),u(t,e,n)},T.inRange=function(t,e,i){return e=ue(e),i===Re?(i=e,e=0):i=ue(i),function(t,e,i){return t>=gn(e,i)&&t<vn(e,i)}(t=ce(t),e,i)},T.isArguments=Zn,T.isArray=$n,T.isArrayLike=Zt,T.isArrayLikeObject=$t,T.isBoolean=function(t){return!0===t||!1===t||ne(t)&&K(t)==oi},T.isBuffer=tr,T.isDate=er,T.isEmpty=function(t){if(null==t)return!0;if(Zt(t)&&($n(t)||"string"==typeof t||"function"==typeof t.splice||tr(t)||nr(t)||Zn(t)))return!t.length;var e=Hn(t);if(e==pi||e==Ai)return!t.size;if(Ot(t))return!$(t).length;for(var i in t)if(Ks.call(t,i))return!1;return!0},T.isError=te,T.isFunction=ee,T.isLength=ie,T.isMap=ir,T.isNaN=function(t){return re(t)&&t!=+t},T.isNull=function(t){return null===t},T.isNumber=re,T.isObject=se,T.isObjectLike=ne,T.isPlainObject=ae,T.isSet=sr,T.isString=oe,T.isSymbol=le,T.isTypedArray=nr,T.isUndefined=function(t){return t===Re},T.last=Vt,T.min=function(t){return t&&t.length?function(t,e,i){for(var s=-1,n=t.length;++s<n;){var r=t[s],a=e(r);if(null!=a&&(o===Re?a==a&&!le(a):i(a,o)))var o=a,l=r}return l}(t,ye,et):Re},T.stubArray=Ie,T.stubFalse=Ce,T.noConflict=function(){return Rs._===this&&(Rs._=Xs),this},T.noop=Te,T.now=Qn,T.padStart=function(t,e,i){t=pe(t);var s=(e=he(e))?S(t):0;return e&&s<e?function(t,e){var i=(e=e===Re?" ":dt(e)).length;if(i<2)return i?nt(e,t):e;var s=nt(e,un(t/S(e)));return E(e)?ct(b(s),0,t).join(""):s.slice(0,t)}(e-s,i)+t:t},T.round=ur,T.some=function(t,e,i){var s=$n(t)?l:lt;return i&&Pt(t,e,i)&&(e=Re),s(t,bt(e,3))},T.startsWith=function(t,e,i){return t=pe(t),i=null==i?0:B(he(i),0,t.length),e=dt(e),t.slice(i,i+e.length)==e},T.template=function(t,e,i){var s=T.templateSettings;i&&Pt(t,e,i)&&(e=Re),t=pe(t),e=or({},e,s,mt);var n,r,a=or({},e.imports,s.imports,mt),o=ge(a),l=v(a,o),d=0,u=e.interpolate||ss,h="__p += '",c=RegExp((e.escape||ss).source+"|"+u.source+"|"+(u===Gi?Ji:ss).source+"|"+(e.evaluate||ss).source+"|$","g"),p="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++ys+"]")+"\n";t.replace(c,function(e,i,s,a,o,l){return s||(s=a),h+=t.slice(d,l).replace(ns,_),i&&(n=!0,h+="' +\n__e("+i+") +\n'"),o&&(r=!0,h+="';\n"+o+";\n__p += '"),s&&(h+="' +\n((__t = ("+s+")) == null ? '' : __t) +\n'"),d=l+e.length,e}),h+="';\n";var f=e.variable;f||(h="with (obj) {\n"+h+"\n}\n"),h=(r?h.replace(Ui,""):h).replace(Bi,"$1").replace(ji,"$1;"),h="function("+(f||"obj")+") {\n"+(f?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(n?", __e = _.escape":"")+(r?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g=dr(function(){return Function(o,p+"return "+h).apply(Re,l)});if(g.source=h,te(g))throw g;return g},T.toFinite=ue,T.toInteger=he,T.toNumber=ce,T.toString=pe,T.upperFirst=lr,T.each=Yt,be(T,function(){var t={};return G(T,function(e,i){Ks.call(T.prototype,i)||(t[i]=e)}),t}(),{chain:!1}),T.VERSION="4.17.5",e(["drop","take"],function(t,e){C.prototype[t]=function(i){i=i===Re?1:vn(he(i),0);var s=this.__filtered__&&!e?new C(this):this.clone();return s.__filtered__?s.__takeCount__=gn(i,s.__takeCount__):s.__views__.push({size:gn(i,ii),type:t+(s.__dir__<0?"Right":"")}),s},C.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),e(["filter","map","takeWhile"],function(t,e){var i=e+1,s=i==Je||3==i;C.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:bt(t,3),type:i}),e.__filtered__=e.__filtered__||s,e}}),e(["head","last"],function(t,e){var i="take"+(e?"Right":"");C.prototype[t]=function(){return this[i](1).value()[0]}}),e(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");C.prototype[t]=function(){return this.__filtered__?new C(this):this[i](1)}}),C.prototype.compact=function(){return this.filter(ye)},C.prototype.find=function(t){return this.filter(t).head()},C.prototype.findLast=function(t){return this.reverse().find(t)},C.prototype.invokeMap=rt(function(t,e){return"function"==typeof t?new C(this):this.map(function(i){return q(i,t,e)})}),C.prototype.reject=function(t){return this.filter(Jt(bt(t)))},C.prototype.slice=function(t,e){t=he(t);var i=this;return i.__filtered__&&(t>0||e<0)?new C(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==Re&&(i=(e=he(e))<0?i.dropRight(-e):i.take(e-t)),i)},C.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},C.prototype.toArray=function(){return this.take(ii)},G(C.prototype,function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),n=T[s?"take"+("last"==e?"Right":""):e],r=s||/^find/.test(e);n&&(T.prototype[e]=function(){var e=this.__wrapped__,a=s?[1]:arguments,l=e instanceof C,d=a[0],u=l||$n(e),h=function(t){var e=n.apply(T,o([t],a));return s&&c?e[0]:e};u&&i&&"function"==typeof d&&1!=d.length&&(l=u=!1);var c=this.__chain__,p=!!this.__actions__.length,f=r&&!c,v=l&&!p;if(!r&&u){e=v?e:new C(this);var g=t.apply(e,a);return g.__actions__.push({func:zt,args:[h],thisArg:Re}),new I(g,c)}return f&&v?t.apply(this,a):(g=this.thru(h),f?s?g.value()[0]:g.value():g)})}),e(["pop","push","shift","sort","splice","unshift"],function(t){var e=xs[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);T.prototype[t]=function(){var t=arguments;if(s&&!this.__chain__){var n=this.value();return e.apply($n(n)?n:[],t)}return this[i](function(i){return e.apply($n(i)?i:[],t)})}}),G(C.prototype,function(t,e){var i=T[e];if(i){var s=i.name+"";(In[s]||(In[s]=[])).push({name:e,func:i})}}),In[function t(e,i,s,n,r,a,o,l,d,u){var h=i&ze,c=i&Fe,p=i&xe,f=i&(Ve|He),v=i&Ye,g=p?Re:Et(e);return function _(){for(var E=arguments.length,m=Array(E),A=E;A--;)m[A]=arguments[A];if(f)var y=function(t){return(Ks.call(T,"placeholder")?T:t).placeholder}(_),S=function(t,e){for(var i=t.length,s=0;i--;)t[i]===e&&++s;return s}(m,y);if(n&&(m=function(t,e,i,s){for(var n=-1,r=t.length,a=i.length,o=-1,l=e.length,d=vn(r-a,0),u=Array(l+d),h=!s;++o<l;)u[o]=e[o];for(;++n<a;)(h||n<r)&&(u[i[n]]=t[n]);for(;d--;)u[o++]=t[n++];return u}(m,n,r,f)),a&&(m=function(t,e,i,s){for(var n=-1,r=t.length,a=-1,o=i.length,l=-1,d=e.length,u=vn(r-o,0),h=Array(u+d),c=!s;++n<u;)h[n]=t[n];for(var p=n;++l<d;)h[p+l]=e[l];for(;++a<o;)(c||n<r)&&(h[p+i[a]]=t[n++]);return h}(m,a,o,f)),E-=S,f&&E<u){var b=function(t,e){for(var i=-1,s=t.length,n=0,r=[];++i<s;){var a=t[i];a!==e&&a!==Ne||(t[i]=Ne,r[n++]=i)}return r}(m,y);return function(t,e,i,s,n,r,a,o,l,d){var u=e&Ve;e|=u?We:Ke,(e&=~(u?Ke:We))&Ge||(e&=~(Fe|xe));var h=[t,e,n,u?r:Re,u?a:Re,u?Re:r,u?Re:a,o,l,d],c=i.apply(Re,h);return function(t){var e=function(t){for(var e=t.name+"",i=In[e],s=Ks.call(In,e)?i.length:0;s--;){var n=i[s],r=n.func;if(null==r||r==t)return n.name}return e}(t),i=T[e];if("function"!=typeof i||!(e in C.prototype))return!1;if(t===i)return!0;var s=xn(i);return!!s&&t===s[0]}(t)&&Wn(c,h),c.placeholder=s,function(t,e,i){var s=e+"";return Kn(t,function(t,e){var i=e.length;if(!i)return t;var s=i-1;return e[s]=(i>1?"& ":"")+e[s],e=e.join(i>2?", ":" "),t.replace(zi,"{\n/* [wrapped with "+e+"] */\n")}(s,jt(function(t){var e=t.match(Yi);return e?e[1].split(qi):[]}(s),i)))}(c,t,e)}(e,i,t,_.placeholder,s,m,b,l,d,u-E)}var D=c?s:this,I=p?D[e]:e;return E=m.length,l?m=function(t,e){for(var i=t.length,s=gn(e.length,i),n=vt(t);s--;){var r=e[s];t[s]=Rt(r,i)?n[r]:Re}return t}(m,l):v&&E>1&&m.reverse(),h&&d<E&&(m.length=d),this&&this!==Rs&&this instanceof _&&(I=g||Et(I)),I.apply(D,m)}}(Re,xe).name]=[{name:"wrapper",func:Re}],C.prototype.clone=function(){var t=new C(this.__wrapped__);return t.__actions__=vt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=vt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=vt(this.__views__),t},C.prototype.reverse=function(){if(this.__filtered__){var t=new C(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},C.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=$n(t),s=e<0,n=i?t.length:0,r=function(t,e,i){for(var s=-1,n=i.length;++s<n;){var r=i[s],a=r.size;switch(r.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=gn(e,t+a);break;case"takeRight":t=vn(t,e-a)}}return{start:t,end:e}}(0,n,this.__views__),a=r.start,o=r.end,l=o-a,d=s?o:a-1,u=this.__iteratees__,h=u.length,c=0,p=gn(l,this.__takeCount__);if(!i||!s&&n==l&&p==l)return ut(t,this.__actions__);var f=[];t:for(;l--&&c<p;){for(var v=-1,g=t[d+=e];++v<h;){var _=u[v],E=_.iteratee,m=_.type,A=E(g);if(m==Qe)g=A;else if(!A){if(m==Je)continue t;break t}}f[c++]=g}return f},T.prototype.chain=function(){return Kt(this)},T.prototype.commit=function(){return new I(this.value(),this.__chain__)},T.prototype.next=function(){this.__values__===Re&&(this.__values__=de(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?Re:this.__values__[this.__index__++]}},T.prototype.plant=function(t){for(var e,i=this;i instanceof D;){var s=Ft(i);s.__index__=0,s.__values__=Re,e?n.__wrapped__=s:e=s;var n=s;i=i.__wrapped__}return n.__wrapped__=t,e},T.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof C){var e=t;return this.__actions__.length&&(e=new C(this)),(e=e.reverse()).__actions__.push({func:zt,args:[Wt],thisArg:Re}),new I(e,this.__chain__)}return this.thru(Wt)},T.prototype.toJSON=T.prototype.valueOf=T.prototype.value=function(){return ut(this.__wrapped__,this.__actions__)},T.prototype.first=T.prototype.head,on&&(T.prototype[on]=function(){return this}),Ms?((Ms.exports=T)._=T,Ps._=T):Rs._=T}).call(this),"undefined"!=typeof window&&function(t,e){"object"==typeof window.exports&&"object"==typeof window.module?window.module.exports=e():"object"==typeof window.exports?window.exports.Hls=e():t.Hls=e()}(this,function(){return function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)e.d(s,n,function(e){return t[e]}.bind(null,n));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s="./src/hls.js")}({"./node_modules/eventemitter3/index.js":function(t,e,i){"use strict";function s(){}function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,i,s,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new n(i,s||t,r),o=d?d+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],a]:t._events[o].push(a):(t._events[o]=a,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function o(){this._events=new s,this._eventsCount=0}var l=Object.prototype.hasOwnProperty,d="~";Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(d=!1)),o.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)l.call(t,e)&&i.push(d?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},o.prototype.listeners=function(t){var e=d?d+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,n=i.length,r=new Array(n);s<n;s++)r[s]=i[s].fn;return r},o.prototype.listenerCount=function(t){var e=d?d+t:t,i=this._events[e];return i?i.fn?1:i.length:0},o.prototype.emit=function(t,e,i,s,n,r){var a=d?d+t:t;if(!this._events[a])return!1;var o,l,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,s),!0;case 5:return u.fn.call(u.context,e,i,s,n),!0;case 6:return u.fn.call(u.context,e,i,s,n,r),!0}for(l=1,o=new Array(h-1);l<h;l++)o[l-1]=arguments[l];u.fn.apply(u.context,o)}else{var c,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,i);break;case 4:u[l].fn.call(u[l].context,e,i,s);break;default:if(!o)for(c=1,o=new Array(h-1);c<h;c++)o[c-1]=arguments[c];u[l].fn.apply(u[l].context,o)}}return!0},o.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},o.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},o.prototype.removeListener=function(t,e,i,s){var n=d?d+t:t;if(!this._events[n])return this;if(!e)return a(this,n),this;var r=this._events[n];if(r.fn)r.fn!==e||s&&!r.once||i&&r.context!==i||a(this,n);else{for(var o=0,l=[],u=r.length;o<u;o++)(r[o].fn!==e||s&&!r[o].once||i&&r[o].context!==i)&&l.push(r[o]);l.length?this._events[n]=1===l.length?l[0]:l:a(this,n)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=d?d+t:t,this._events[e]&&a(this,e)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=d,o.EventEmitter=o,t.exports=o},"./node_modules/node-libs-browser/node_modules/events/events.js":function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(t){return"function"==typeof t}function n(t){return"object"==typeof t&&null!==t}function r(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||window.isNaN(t))throw window.TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,a,o,l,d;if(this._events||(this._events={}),"error"===t&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}if(r(i=this._events[t]))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(n(i))for(o=Array.prototype.slice.call(arguments,1),a=(d=i.slice()).length,l=0;l<a;l++)d[l].apply(this,o);return!0},i.prototype.addListener=function(t,e){var a;if(!s(e))throw window.TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,s(e.listener)?e.listener:e),this._events[t]?n(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,n(this._events[t])&&!this._events[t].warned&&(a=r(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[t].length>a&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}if(!s(e))throw window.TypeError("listener must be a function");var n=!1;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var i,r,a,o;if(!s(e))throw window.TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(a=(i=this._events[t]).length,r=-1,i===e||s(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(n(i)){for(o=a;o-- >0;)if(i[o]===e||i[o].listener&&i[o].listener===e){r=o;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(s(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?s(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(s(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},"./node_modules/url-toolkit/src/url-toolkit.js":function(t,e,i){!function(e){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,s=/^([^\/?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,a={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var n=a.parseURL(t);if(!n)throw new Error("Error trying to parse base URL.");return n.path=a.normalizePath(n.path),a.buildURLFromParts(n)}var r=a.parseURL(e);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return i.alwaysNormalize?(r.path=a.normalizePath(r.path),a.buildURLFromParts(r)):e;var o=a.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=s.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var d={scheme:o.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(d.netLoc=o.netLoc,"/"!==r.path[0]))if(r.path){var u=o.path,h=u.substring(0,u.lastIndexOf("/")+1)+r.path;d.path=a.normalizePath(h)}else d.path=o.path,r.params||(d.params=o.params,r.query||(d.query=o.query));return null===d.path&&(d.path=i.alwaysNormalize?a.normalizePath(r.path):r.path),a.buildURLFromParts(d)},parseURL:function(t){var e=i.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(r,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=a}()},"./node_modules/webworkify-webpack/index.js":function(t,e,i){function s(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e.oe=function(t){throw console.error(t),t};var s=e(e.s=window.ENTRY_MODULE);return s.default||s}function n(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function r(t){return!window.isNaN(1*t)}function a(t,e,s){var a={};a[s]=[];var o=e.toString(),l=o.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return a;for(var h,c=l[1],p=new RegExp("(\\\\n|\\W)"+n(c)+u,"g");h=p.exec(o);)"dll-reference"!==h[3]&&a[s].push(h[3]);for(p=new RegExp("\\("+n(c)+'\\("(dll-reference\\s('+d+'))"\\)\\)'+u,"g");h=p.exec(o);)t[h[2]]||(a[s].push(h[1]),t[h[2]]=i(h[1]).m),a[h[2]]=a[h[2]]||[],a[h[2]].push(h[4]);for(var f=Object.keys(a),v=0;v<f.length;v++)for(var g=0;g<a[f[v]].length;g++)r(a[f[v]][g])&&(a[f[v]][g]=1*a[f[v]][g]);return a}function o(t){return Object.keys(t).reduce(function(e,i){return e||t[i].length>0},!1)}function l(t,e){for(var i={main:[e]},s={main:[]},n={main:{}};o(i);)for(var r=Object.keys(i),l=0;l<r.length;l++){var d=r[l],u=i[d].pop();if(n[d]=n[d]||{},!n[d][u]&&t[d][u]){n[d][u]=!0,s[d]=s[d]||[],s[d].push(u);for(var h=a(t,t[d][u],d),c=Object.keys(h),p=0;p<c.length;p++)i[c[p]]=i[c[p]]||[],i[c[p]]=i[c[p]].concat(h[c[p]])}}return s}var d="[\\.|\\-|\\+|\\w|/|@]+",u="\\((/\\*.*?\\*/)?s?.*?("+d+").*?\\)";t.exports=function(t,e){e=e||{};var n={main:i.m},r=e.all?{main:Object.keys(n.main)}:l(n,t),a="";Object.keys(r).filter(function(t){return"main"!==t}).forEach(function(t){for(var e=0;r[t][e];)e++;r[t].push(e),n[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+t+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+r[t].map(function(e){return JSON.stringify(e)+": "+n[t][e].toString()}).join(",")+"});\n"}),a=a+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+r.main.map(function(t){return JSON.stringify(t)+": "+n.main[t].toString()}).join(",")+"}))(self);";var o=new window.Blob([a],{type:"text/javascript"});if(e.bare)return o;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(o),u=new window.Worker(d);return u.objectURL=d,u}},"./src/config.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/controller/abr-controller.js"),n=i("./src/controller/buffer-controller.js"),r=i("./src/controller/cap-level-controller.js"),a=i("./src/controller/fps-controller.js"),o=i("./src/utils/xhr-loader.js"),l=i("./src/controller/audio-track-controller.js"),d=i("./src/controller/audio-stream-controller.js"),u=i("./src/utils/cues.js"),h=i("./src/controller/timeline-controller.js"),c=i("./src/controller/subtitle-track-controller.js"),p=i("./src/controller/subtitle-stream-controller.js"),f=i("./src/controller/eme-controller.js"),v=i("./src/utils/mediakeys-helper.js");e.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:o.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:s.default,bufferController:n.default,capLevelController:r.default,fpsController:a.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:v.requestMediaKeySystemAccess},e.hlsDefaultConfig.subtitleStreamController=p.SubtitleStreamController,e.hlsDefaultConfig.subtitleTrackController=c.default,e.hlsDefaultConfig.timelineController=h.default,e.hlsDefaultConfig.cueHandler=u,e.hlsDefaultConfig.enableCEA708Captions=!0,e.hlsDefaultConfig.enableWebVTT=!0,e.hlsDefaultConfig.captionsTextTrack1Label="English",e.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",e.hlsDefaultConfig.captionsTextTrack2Label="Spanish",e.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",e.hlsDefaultConfig.audioStreamController=d.default,e.hlsDefaultConfig.audioTrackController=l.default,e.hlsDefaultConfig.emeController=f.default},"./src/controller/abr-controller.js":function(t,e,i){"use strict";(function(t){var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/utils/buffer-helper.js"),o=i("./src/errors.js"),l=i("./src/utils/logger.js"),d=i("./src/utils/ewma-bandwidth-estimator.js"),u=window.performance,h=function(e){function i(t){var i=e.call(this,t,n.default.FRAG_LOADING,n.default.FRAG_LOADED,n.default.FRAG_BUFFERED,n.default.ERROR)||this;return i.lastLoadedFragLevel=0,i._nextAutoLevel=-1,i.hls=t,i.timer=null,i._bwEstimator=null,i.onCheck=i._abandonRulesCheck.bind(i),i}return s(i,e),i.prototype.destroy=function(){this.clearTimer(),r.default.prototype.destroy.call(this)},i.prototype.onFragLoading=function(t){var e=t.frag;if("main"===e.type&&(this.timer||(this.fragCurrent=e,this.timer=window.setInterval(this.onCheck,100)),!this._bwEstimator)){var i=this.hls,s=i.config,n=e.level,r=void 0,a=void 0;i.levels[n].details.live?(r=s.abrEwmaFastLive,a=s.abrEwmaSlowLive):(r=s.abrEwmaFastVoD,a=s.abrEwmaSlowVoD),this._bwEstimator=new d.default(i,a,r,s.abrEwmaDefaultEstimate)}},i.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,i=this.fragCurrent;if(i){var s=i.loader,r=t.minAutoLevel;if(!s||s.stats&&s.stats.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var o=s.stats;if(e&&o&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&i.autoLevel&&i.level){var d=u.now()-o.trequest,h=Math.abs(e.playbackRate);if(d>500*i.duration/h){var c=t.levels,p=Math.max(1,o.bw?o.bw/8:1e3*o.loaded/d),f=c[i.level],v=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,g=o.total?o.total:Math.max(o.loaded,Math.round(i.duration*v/8)),_=e.currentTime,E=(g-o.loaded)/p,m=(a.BufferHelper.bufferInfo(e,_,t.config.maxBufferHole).end-_)/h;if(m<2*i.duration/h&&E>m){var A=void 0,y=void 0;for(y=i.level-1;y>r;y--){var S=c[y].realBitrate?Math.max(c[y].realBitrate,c[y].bitrate):c[y].bitrate;if((A=i.duration*S/(6.4*p))<m)break}A<E&&(l.logger.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+A.toFixed(1)+"<"+E.toFixed(1)+":"+m.toFixed(1)),t.nextLoadLevel=y,this._bwEstimator.sample(d,o.loaded),s.abort(),this.clearTimer(),t.trigger(n.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:o}))}}}}},i.prototype.onFragLoaded=function(e){var i=e.frag;if("main"===i.type&&t.isFinite(i.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=this.hls.levels[i.level],n=(s.loaded?s.loaded.bytes:0)+e.stats.loaded,r=(s.loaded?s.loaded.duration:0)+e.frag.duration;s.loaded={bytes:n,duration:r},s.realBitrate=Math.round(8*n/r)}if(e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}},i.prototype.onFragBuffered=function(e){var i=e.stats,s=e.frag;if(!0!==i.aborted&&"main"===s.type&&t.isFinite(s.sn)&&(!s.bitrateTest||i.tload===i.tbuffered)){var n=i.tparsed-i.trequest;l.logger.log("latency/loading/parsing/append/kbps:"+Math.round(i.tfirst-i.trequest)+"/"+Math.round(i.tload-i.tfirst)+"/"+Math.round(i.tparsed-i.tload)+"/"+Math.round(i.tbuffered-i.tparsed)+"/"+Math.round(8*i.loaded/(i.tbuffered-i.trequest))),this._bwEstimator.sample(n,i.loaded),i.bwEstimate=this._bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},i.prototype.onError=function(t){switch(t.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},i.prototype.clearTimer=function(){window.clearInterval(this.timer),this.timer=null},Object.defineProperty(i.prototype,"nextAutoLevel",{get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var i=this._nextABRAutoLevel;return-1!==t&&(i=Math.min(t,i)),i},set:function(t){this._nextAutoLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_nextABRAutoLevel",{get:function(){var t=this.hls,e=t.maxAutoLevel,i=t.levels,s=t.config,n=t.minAutoLevel,r=t.media,o=this.lastLoadedFragLevel,d=this.fragCurrent?this.fragCurrent.duration:0,u=r?r.currentTime:0,h=r&&0!==r.playbackRate?Math.abs(r.playbackRate):1,c=this._bwEstimator?this._bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,p=(a.BufferHelper.bufferInfo(r,u,s.maxBufferHole).end-u)/h,f=this._findBestLevel(o,d,c,n,e,p,s.abrBandWidthFactor,s.abrBandWidthUpFactor,i);if(f>=0)return f;l.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=d?Math.min(d,s.maxStarvationDelay):s.maxStarvationDelay,g=s.abrBandWidthFactor,_=s.abrBandWidthUpFactor;if(0===p){var E=this.bitrateTestDelay;E&&(v=(d?Math.min(d,s.maxLoadingDelay):s.maxLoadingDelay)-E,l.logger.trace("bitrate test took "+Math.round(1e3*E)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),g=_=1)}return f=this._findBestLevel(o,d,c,n,e,p+v,g,_,i),Math.max(f,0)},enumerable:!0,configurable:!0}),i.prototype._findBestLevel=function(t,e,i,s,n,r,a,o,d){for(var u=n;u>=s;u--){var h=d[u];if(h){var c,p=h.details,f=p?p.totalduration/p.fragments.length:e,v=!!p&&p.live;c=u<=t?a*i:o*i;var g=d[u].realBitrate?Math.max(d[u].realBitrate,d[u].bitrate):d[u].bitrate,_=g*f/c;if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(c)+"/"+g+"/"+f+"/"+r+"/"+_),c>g&&(!_||v&&!this.bitrateTestDelay||_<r))return u}}return-1},i}(r.default);e.default=h}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/audio-stream-controller.js":function(t,e,i){"use strict";(function(t){var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/utils/binary-search.js"),r=i("./src/utils/buffer-helper.js"),a=i("./src/demux/demuxer.js"),o=i("./src/events.js"),l=i("./src/controller/level-helper.js"),d=i("./src/utils/time-ranges.js"),u=i("./src/errors.js"),h=i("./src/utils/logger.js"),c=i("./src/utils/discontinuities.js"),p=i("./src/controller/fragment-tracker.js"),f=i("./src/loader/fragment.js"),v=i("./src/controller/base-stream-controller.js"),g=window.performance,_=function(e){function i(t,i){var s=e.call(this,t,o.default.MEDIA_ATTACHED,o.default.MEDIA_DETACHING,o.default.AUDIO_TRACKS_UPDATED,o.default.AUDIO_TRACK_SWITCHING,o.default.AUDIO_TRACK_LOADED,o.default.KEY_LOADED,o.default.FRAG_LOADED,o.default.FRAG_PARSING_INIT_SEGMENT,o.default.FRAG_PARSING_DATA,o.default.FRAG_PARSED,o.default.ERROR,o.default.BUFFER_RESET,o.default.BUFFER_CREATED,o.default.BUFFER_APPENDED,o.default.BUFFER_FLUSHED,o.default.INIT_PTS_FOUND)||this;return s.fragmentTracker=i,s.config=t.config,s.audioCodecSwap=!1,s._state=v.State.STOPPED,s.initPTS=[],s.waitingFragment=null,s.videoTrackCC=null,s}return s(i,e),i.prototype.onInitPtsFound=function(t){var e=t.id,i=t.frag.cc,s=t.initPTS;"main"===e&&(this.initPTS[i]=s,this.videoTrackCC=i,h.logger.log("InitPTS for cc: "+i+" found from video track: "+s),this.state===v.State.WAITING_INIT_PTS&&this.tick())},i.prototype.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(h.logger.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=v.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=v.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=v.State.STOPPED},Object.defineProperty(i.prototype,"state",{get:function(){return this._state},set:function(t){if(this.state!==t){var e=this.state;this._state=t,h.logger.log("audio stream:"+e+"->"+t)}},enumerable:!0,configurable:!0}),i.prototype.doTick=function(){var e,i,s,a=this.hls,l=a.config;switch(this.state){case v.State.ERROR:case v.State.PAUSED:case v.State.BUFFER_FLUSHING:break;case v.State.STARTING:this.state=v.State.WAITING_TRACK,this.loadedmetadata=!1;break;case v.State.IDLE:var d=this.tracks;if(!d)break;if(!this.media&&(this.startFragRequested||!l.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var u=this.mediaBuffer?this.mediaBuffer:this.media,f=this.videoBuffer?this.videoBuffer:this.media,_=r.BufferHelper.bufferInfo(u,e,l.maxBufferHole),E=r.BufferHelper.bufferInfo(f,e,l.maxBufferHole),m=_.len,A=_.end,y=this.fragPrevious,S=Math.min(l.maxBufferLength,l.maxMaxBufferLength),b=Math.max(S,E.len),T=this.audioSwitch,D=this.trackId;if((m<b||T)&&D<d.length){if(void 0===(s=d[D].details)){this.state=v.State.WAITING_TRACK;break}if(!T&&this._streamEnded(_,s))return this.hls.trigger(o.default.BUFFER_EOS,{type:"audio"}),void(this.state=v.State.ENDED);var I=s.fragments,C=I.length,R=I[0].start,P=I[C-1].start+I[C-1].duration,M=void 0;if(T)if(s.live&&!s.PTSKnown)h.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),A=0;else if(A=e,s.PTSKnown&&e<R){if(!(_.end>R||_.nextStart))return;h.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=R+.05}if(s.initSegment&&!s.initSegment.data)M=s.initSegment;else if(A<=R){if(M=I[0],null!==this.videoTrackCC&&M.cc!==this.videoTrackCC&&(M=c.findFragWithCC(I,this.videoTrackCC)),s.live&&M.loadIdx&&M.loadIdx===this.fragLoadIdx){var O=_.nextStart?_.nextStart:R;return h.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(O+.05)),void(this.media.currentTime=O+.05)}}else{var L=void 0,N=l.maxFragLookUpTolerance,k=y?I[y.sn-I[0].sn+1]:void 0,w=function(t){var e=Math.min(N,t.duration);return t.start+t.duration-e<=A?1:t.start-e>A&&t.start?-1:0};A<P?(A>P-N&&(N=0),L=k&&!w(k)?k:n.default.search(I,w)):L=I[C-1],L&&(M=L,R=L.start,y&&M.level===y.level&&M.sn===y.sn&&(M.sn<s.endSN?(M=I[M.sn+1-s.startSN],h.logger.log("SN just loaded, load next one: "+M.sn)):M=null))}M&&(M.encrypted?(h.logger.log("Loading key for "+M.sn+" of ["+s.startSN+" ,"+s.endSN+"],track "+D),this.state=v.State.KEY_LOADING,a.trigger(o.default.KEY_LOADING,{frag:M})):(h.logger.log("Loading "+M.sn+", cc: "+M.cc+" of ["+s.startSN+" ,"+s.endSN+"],track "+D+", currentTime:"+e+",bufferEnd:"+A.toFixed(3)),this.fragCurrent=M,(T||this.fragmentTracker.getState(M)===p.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,t.isFinite(M.sn)&&(this.nextLoadPosition=M.start+M.duration),a.trigger(o.default.FRAG_LOADING,{frag:M}),this.state=v.State.FRAG_LOADING)))}break;case v.State.WAITING_TRACK:(i=this.tracks[this.trackId])&&i.details&&(this.state=v.State.IDLE);break;case v.State.FRAG_LOADING_WAITING_RETRY:var U=g.now(),B=this.retryDate,j=(u=this.media)&&u.seeking;(!B||U>=B||j)&&(h.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=v.State.IDLE);break;case v.State.WAITING_INIT_PTS:var F=this.videoTrackCC;if(void 0===this.initPTS[F])break;var x=this.waitingFragment;if(x){var G=x.frag.cc;F!==G?(i=this.tracks[this.trackId]).details&&i.details.live&&(h.logger.warn("Waiting fragment CC ("+G+") does not match video track CC ("+F+")"),this.waitingFragment=null,this.state=v.State.IDLE):(this.state=v.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=v.State.IDLE;break;case v.State.STOPPED:case v.State.FRAG_LOADING:case v.State.PARSING:case v.State.PARSED:case v.State.ENDED:}},i.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)},i.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(h.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.prototype.onAudioTracksUpdated=function(t){h.logger.log("audio tracks updated"),this.tracks=t.audioTracks},i.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=v.State.PAUSED,this.waitingFragment=null,e?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=v.State.IDLE),this.tick()},i.prototype.onAudioTrackLoaded=function(e){var i=e.details,s=e.id,n=this.tracks[s],r=i.totalduration,a=0;if(h.logger.log("track "+s+" loaded ["+i.startSN+","+i.endSN+"],duration:"+r),i.live){var o=n.details;o&&i.fragments.length>0?(l.mergeDetails(o,i),a=i.fragments[0].start,i.PTSKnown?h.logger.log("live audio playlist sliding:"+a.toFixed(3)):h.logger.log("live audio playlist - outdated PTS, unknown sliding")):(i.PTSKnown=!1,h.logger.log("live audio playlist - first load, unknown sliding"))}else i.PTSKnown=!1;if(n.details=i,!this.startFragRequested){if(-1===this.startPosition){var d=i.startTimeOffset;t.isFinite(d)?(h.logger.log("start time offset found in playlist, adjust startPosition to "+d),this.startPosition=d):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===v.State.WAITING_TRACK&&(this.state=v.State.IDLE),this.tick()},i.prototype.onKeyLoaded=function(){this.state===v.State.KEY_LOADING&&(this.state=v.State.IDLE,this.tick())},i.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=t.frag;if(this.state===v.State.FRAG_LOADING&&e&&"audio"===i.type&&i.level===e.level&&i.sn===e.sn){var s=this.tracks[this.trackId],n=s.details,r=n.totalduration,l=e.level,d=e.sn,u=e.cc,c=this.config.defaultAudioCodec||s.audioCodec||"mp4a.40.2",p=this.stats=t.stats;if("initSegment"===d)this.state=v.State.IDLE,p.tparsed=p.tbuffered=g.now(),n.initSegment.data=t.payload,this.hls.trigger(o.default.FRAG_BUFFERED,{stats:p,frag:e,id:"audio"}),this.tick();else{this.state=v.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new a.default(this.hls,"audio"));var f=this.initPTS[u],_=n.initSegment?n.initSegment.data:[];n.initSegment||void 0!==f?(this.pendingBuffering=!0,h.logger.log("Demuxing "+d+" of ["+n.startSN+" ,"+n.endSN+"],track "+l),this.demuxer.push(t.payload,_,c,null,e,r,!1,f)):(h.logger.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+d+" of ["+n.startSN+" ,"+n.endSN+"],track "+l),this.waitingFragment=t,this.state=v.State.WAITING_INIT_PTS)}}this.fragLoadError=0},i.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;if(e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===v.State.PARSING){var s=t.tracks,n=void 0;if(s.video&&delete s.video,n=s.audio){n.levelCodec=n.codec,n.id=t.id,this.hls.trigger(o.default.BUFFER_CODECS,s),h.logger.log("audio track:audio,container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var r=n.initSegment;if(r){var a={type:"audio",data:r,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(o.default.BUFFER_APPENDING,a))}this.tick()}}},i.prototype.onFragParsingData=function(e){var i=this,s=this.fragCurrent,n=e.frag;if(s&&"audio"===e.id&&"audio"===e.type&&n.sn===s.sn&&n.level===s.level&&this.state===v.State.PARSING){var r=this.trackId,a=this.tracks[r],d=this.hls;t.isFinite(e.endPTS)||(e.endPTS=e.startPTS+s.duration,e.endDTS=e.startDTS+s.duration),s.addElementaryStream(f.default.ElementaryStreamTypes.AUDIO),h.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),l.updateFragPTSDTS(a.details,s,e.startPTS,e.endPTS);var c=this.audioSwitch,p=this.media,g=!1;if(c&&p)if(p.readyState){var _=p.currentTime;h.logger.log("switching audio track : currentTime:"+_),_>=e.startPTS&&(h.logger.log("switching audio track : flushing all audio"),this.state=v.State.BUFFER_FLUSHING,d.trigger(o.default.BUFFER_FLUSHING,{startOffset:0,endOffset:t.POSITIVE_INFINITY,type:"audio"}),g=!0,this.audioSwitch=!1,d.trigger(o.default.AUDIO_TRACK_SWITCHED,{id:r}))}else this.audioSwitch=!1,d.trigger(o.default.AUDIO_TRACK_SWITCHED,{id:r});var E=this.pendingData;if(!E)return h.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void d.trigger(o.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&E.push({type:e.type,data:t,parent:"audio",content:"data"})}),!g&&E.length&&(E.forEach(function(t){i.state===v.State.PARSING&&(i.pendingBuffering=!0,i.hls.trigger(o.default.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick()}},i.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===v.State.PARSING&&(this.stats.tparsed=g.now(),this.state=v.State.PARSED,this._checkAppendedParsed())},i.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},i.prototype.onBufferAppended=function(t){if("audio"===t.parent){var e=this.state;e!==v.State.PARSING&&e!==v.State.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},i.prototype._checkAppendedParsed=function(){if(!(this.state!==v.State.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,i=this.hls;if(t){this.fragPrevious=t,e.tbuffered=g.now(),i.trigger(o.default.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var s=this.mediaBuffer?this.mediaBuffer:this.media;h.logger.log("audio buffered : "+d.default.toString(s.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(o.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=v.State.IDLE}this.tick()}},i.prototype.onError=function(e){var i=e.frag;if(!i||"audio"===i.type)switch(e.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:var s=e.frag;if(s&&"audio"!==s.type)break;if(!e.fatal){var n=this.fragLoadError;if(n?n++:n=1,n<=(l=this.config).fragLoadingMaxRetry){this.fragLoadError=n;var a=Math.min(Math.pow(2,n-1)*l.fragLoadingRetryDelay,l.fragLoadingMaxRetryTimeout);h.logger.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=g.now()+a,this.state=v.State.FRAG_LOADING_WAITING_RETRY}else h.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=v.State.ERROR}break;case u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case u.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==v.State.ERROR&&(this.state=e.fatal?v.State.ERROR:v.State.IDLE,h.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case u.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===v.State.PARSING||this.state===v.State.PARSED)){var l,d=this.mediaBuffer,c=this.media.currentTime;d&&r.BufferHelper.isBuffered(d,c)&&r.BufferHelper.isBuffered(d,c+.5)?((l=this.config).maxMaxBufferLength>=l.maxBufferLength&&(l.maxMaxBufferLength/=2,h.logger.warn("AudioStreamController: reduce max buffer length to "+l.maxMaxBufferLength+"s")),this.state=v.State.IDLE):(h.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=v.State.BUFFER_FLUSHING,this.hls.trigger(o.default.BUFFER_FLUSHING,{startOffset:0,endOffset:t.POSITIVE_INFINITY,type:"audio"}))}}},i.prototype.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(h.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach(function(e){t.hls.trigger(o.default.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=v.State.PARSED):(this.state=v.State.IDLE,this.fragPrevious=null,this.tick())},i}(v.default);e.default=_}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/audio-track-controller.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=i("./src/task-loop.js"),a=i("./src/utils/logger.js"),o=i("./src/errors.js"),l=function(t){function e(e){var i=t.call(this,e,n.default.MANIFEST_LOADING,n.default.MANIFEST_PARSED,n.default.AUDIO_TRACK_LOADED,n.default.AUDIO_TRACK_SWITCHED,n.default.LEVEL_LOADED,n.default.ERROR)||this;return i._trackId=-1,i._selectDefaultTrack=!0,i.tracks=[],i.trackIdBlacklist=Object.create(null),i.audioGroupId=null,i}return s(e,t),e.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},e.prototype.onManifestParsed=function(t){var e=this.tracks=t.audioTracks||[];this.hls.trigger(n.default.AUDIO_TRACKS_UPDATED,{audioTracks:e})},e.prototype.onAudioTrackLoaded=function(t){if(t.id>=this.tracks.length)a.logger.warn("Invalid audio track id:",t.id);else{if(a.logger.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.hasInterval()){var e=1e3*t.details.targetduration;this.setInterval(e)}!t.details.live&&this.hasInterval()&&this.clearInterval()}},e.prototype.onAudioTrackSwitched=function(t){var e=this.tracks[t.id].groupId;e&&this.audioGroupId!==e&&(this.audioGroupId=e)},e.prototype.onLevelLoaded=function(t){var e=this.hls.levels[t.level];if(e.audioGroupIds){var i=e.audioGroupIds[e.urlId];this.audioGroupId!==i&&(this.audioGroupId=i,this._selectInitialAudioTrack())}},e.prototype.onError=function(t){t.type===o.ErrorTypes.NETWORK_ERROR&&(t.fatal&&this.clearInterval(),t.details===o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(a.logger.warn("Network failure on audio-track id:",t.context.id),this._handleLoadError()))},Object.defineProperty(e.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioTrack",{get:function(){return this._trackId},set:function(t){this._setAudioTrack(t),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),e.prototype._setAudioTrack=function(t){if(this._trackId===t&&this.tracks[this._trackId].details)a.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(t<0||t>=this.tracks.length)a.logger.warn("Invalid id passed to audio-track controller");else{var e=this.tracks[t];a.logger.log("Now switching to audio-track index "+t),this.clearInterval(),this._trackId=t;var i=e.url,s=e.type,r=e.id;this.hls.trigger(n.default.AUDIO_TRACK_SWITCHING,{id:r,type:s,url:i}),this._loadTrackDetailsIfNeeded(e)}},e.prototype.doTick=function(){this._updateTrack(this._trackId)},e.prototype._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var i=this.tracks[this._trackId],s=null;if(i&&(s=i.name),this._selectDefaultTrack){var r=e.filter(function(t){return t.default});r.length?e=r:a.logger.warn("No default audio tracks defined")}var l=!1,d=function(){e.forEach(function(e){l||t.audioGroupId&&e.groupId!==t.audioGroupId||s&&s!==e.name||(t._setAudioTrack(e.id),l=!0)})};d(),l||(s=null,d()),l||(a.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(n.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},e.prototype._needsTrackLoading=function(t){var e=t.details,i=t.url;return!(e&&!e.live||!i)},e.prototype._loadTrackDetailsIfNeeded=function(t){if(this._needsTrackLoading(t)){var e=t.url,i=t.id;a.logger.log("loading audio-track playlist for id: "+i),this.hls.trigger(n.default.AUDIO_TRACK_LOADING,{url:e,id:i})}},e.prototype._updateTrack=function(t){if(!(t<0||t>=this.tracks.length)){this.clearInterval(),this._trackId=t,a.logger.log("trying to update audio-track "+t);var e=this.tracks[t];this._loadTrackDetailsIfNeeded(e)}},e.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var t=this._trackId,e=this.tracks[t],i=e.name,s=e.language,n=e.groupId;a.logger.warn("Loading failed on audio track id: "+t+", group-id: "+n+', name/language: "'+i+'" / "'+s+'"');for(var r=t,o=0;o<this.tracks.length;o++)if(!this.trackIdBlacklist[o]&&this.tracks[o].name===i){r=o;break}r!==t?(a.logger.log("Attempting audio-track fallback id:",r,"group-id:",this.tracks[r].groupId),this._setAudioTrack(r)):a.logger.warn('No fallback audio-track found for name/language: "'+i+'" / "'+s+'"')},e}(r.default);e.default=l},"./src/controller/base-stream-controller.js":function(t,e,i){"use strict";(function(t){var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/task-loop.js"),r=i("./src/controller/fragment-tracker.js"),a=i("./src/utils/buffer-helper.js"),o=i("./src/utils/logger.js");e.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var l=function(i){function n(){return null!==i&&i.apply(this,arguments)||this}return s(n,i),n.prototype.doTick=function(){},n.prototype.startLoad=function(){},n.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=e.State.STOPPED},n.prototype._streamEnded=function(t,e){var i=this.fragCurrent,s=this.fragmentTracker;if(!e.live&&i&&!i.backtracked&&i.sn===e.endSN&&!t.nextStart){var n=s.getState(i);return n===r.FragmentState.PARTIAL||n===r.FragmentState.OK}return!1},n.prototype.onMediaSeeking=function(){var i=this,s=i.config,n=i.media,r=i.mediaBuffer,l=i.state,d=n?n.currentTime:null,u=a.BufferHelper.bufferInfo(r||n,d,this.config.maxBufferHole);if(t.isFinite(d)&&o.logger.log("media seeking to "+d.toFixed(3)),l===e.State.FRAG_LOADING){var h=this.fragCurrent;if(0===u.len&&h){var c=s.maxFragLookUpTolerance,p=h.start-c,f=h.start+h.duration+c;d<p||d>f?(h.loader&&(o.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),h.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=e.State.IDLE):o.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else l===e.State.ENDED&&(0===u.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=e.State.IDLE);n&&(this.lastCurrentTime=d),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=d),this.tick()},n.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},n.prototype.onHandlerDestroying=function(){this.stopLoad(),i.prototype.onHandlerDestroying.call(this)},n.prototype.onHandlerDestroyed=function(){this.state=e.State.STOPPED,this.fragmentTracker=null},n}(n.default);e.default=l}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/buffer-controller.js":function(t,e,i){"use strict";(function(t){var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/utils/logger.js"),o=i("./src/errors.js"),l=i("./src/utils/mediasource-helper.js").getMediaSource(),d=function(e){function i(t){var i=e.call(this,t,n.default.MEDIA_ATTACHING,n.default.MEDIA_DETACHING,n.default.MANIFEST_PARSED,n.default.BUFFER_RESET,n.default.BUFFER_APPENDING,n.default.BUFFER_CODECS,n.default.BUFFER_EOS,n.default.BUFFER_FLUSHING,n.default.LEVEL_PTS_UPDATED,n.default.LEVEL_UPDATED)||this;return i._msDuration=null,i._levelDuration=null,i._levelTargetDuration=10,i._live=null,i._objectUrl=null,i.bufferCodecEventsExpected=0,i.onsbue=i.onSBUpdateEnd.bind(i),i.onsbe=i.onSBUpdateError.bind(i),i.pendingTracks={},i.tracks={},i}return s(i,e),i.prototype.destroy=function(){r.default.prototype.destroy.call(this)},i.prototype.onLevelPtsUpdated=function(t){var e=t.type,i=this.tracks.audio;if("audio"===e&&i&&"audio/mpeg"===i.container){var s=this.sourceBuffer.audio;if(Math.abs(s.timestampOffset-t.start)>.1){var n=s.updating;try{s.abort()}catch(t){a.logger.warn("can not abort audio buffer: "+t)}n?this.audioTimestampOffset=t.start:(a.logger.warn("change mpeg audio timestamp offset from "+s.timestampOffset+" to "+t.start),s.timestampOffset=t.start)}}},i.prototype.onManifestParsed=function(t){this.bufferCodecEventsExpected=t.altAudio?2:1,a.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.prototype.onMediaAttaching=function(t){var e=this.media=t.media;if(e){var i=this.mediaSource=new l;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),e.src=window.URL.createObjectURL(i),this._objectUrl=e.src}},i.prototype.onMediaDetaching=function(){a.logger.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){a.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):a.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(n.default.MEDIA_DETACHED)},i.prototype.onMediaSourceOpen=function(){a.logger.log("media source opened"),this.hls.trigger(n.default.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},i.prototype.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.pendingTracks,i=Object.keys(e).length;(i&&!t||2===i)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},i.prototype.onMediaSourceClose=function(){a.logger.log("media source closed")},i.prototype.onMediaSourceEnded=function(){a.logger.log("media source ended")},i.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;a.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var e=this.parent,i=this.segments.reduce(function(t,i){return i.parent===e?t+1:t},0),s={},r=this.sourceBuffer;for(var o in r)s[o]=r[o].buffered;this.hls.trigger(n.default.BUFFER_APPENDED,{parent:e,pending:i,timeRanges:s}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===i&&this.flushLiveBackBuffer()},i.prototype.onSBUpdateError=function(t){a.logger.error("sourceBuffer error:",t),this.hls.trigger(n.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},i.prototype.onBufferReset=function(){var t=this.sourceBuffer;for(var e in t){var i=t[e];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.prototype.onBufferCodecs=function(t){var e=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(t).forEach(function(i){e.pendingTracks[i]=t[i]});var i=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),i&&"open"===i.readyState&&this.checkPendingTracks()}},i.prototype.createSourceBuffers=function(t){var e=this.sourceBuffer,i=this.mediaSource;for(var s in t)if(!e[s]){var r=t[s],l=r.levelCodec||r.codec,d=r.container+";codecs="+l;a.logger.log("creating sourceBuffer("+d+")");try{var u=e[s]=i.addSourceBuffer(d);u.addEventListener("updateend",this.onsbue),u.addEventListener("error",this.onsbe),this.tracks[s]={codec:l,container:r.container},r.buffer=u}catch(t){a.logger.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(n.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:d})}}this.hls.trigger(n.default.BUFFER_CREATED,{tracks:t})},i.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},i.prototype.onBufferAppendFail=function(t){a.logger.error("sourceBuffer error:",t.event),this.hls.trigger(n.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},i.prototype.onBufferEos=function(t){var e=this.sourceBuffer,i=t.type;for(var s in e)i&&s!==i||e[s].ended||(e[s].ended=!0,a.logger.log(s+" sourceBuffer now EOS"));this.checkEos()},i.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(e&&"open"===e.readyState){for(var i in t){var s=t[i];if(!s.ended)return;if(s.updating)return void(this._needsEos=!0)}a.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){a.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},i.prototype.flushLiveBackBuffer=function(){if(this._live){var t=this.hls.config.liveBackBufferLength;if(window.isFinite(t)&&!(t<0))for(var e=this.media.currentTime,i=this.sourceBuffer,s=Object.keys(i),n=e-Math.max(t,this._levelTargetDuration),r=s.length-1;r>=0;r--){var a=s[r],o=i[a].buffered;o.length>0&&n>o.start(0)&&this.removeBufferRange(a,i[a],0,n)}}},i.prototype.onLevelUpdated=function(t){var e=t.details;e.fragments.length>0&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._levelTargetDuration=e.averagetargetduration||e.targetduration||10,this._live=e.live,this.updateMediaElementDuration())},i.prototype.updateMediaElementDuration=function(){var e,i=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var s in this.sourceBuffer)if(!0===this.sourceBuffer[s].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===i.liveDurationInfinity?(a.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!t.isFinite(e))&&(a.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,i=this.sourceBuffer;try{for(var s in i)e+=i[s].buffered.length}catch(t){a.logger.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(n.default.BUFFER_FLUSHED)}},i.prototype.doAppending=function(){var t=this,e=t.hls,i=t.segments,s=t.sourceBuffer;if(Object.keys(s).length){if(this.media.error)return this.segments=[],void a.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(i&&i.length){var r=i.shift();try{var l=s[r.type];l?l.updating?i.unshift(r):(l.ended=!1,this.parent=r.parent,l.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){a.logger.error("error while trying to append buffer:"+t.message),i.unshift(r);var d={type:o.ErrorTypes.MEDIA_ERROR,parent:r.parent};22!==t.code?(this.appendError?this.appendError++:this.appendError=1,d.details=o.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(a.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],d.fatal=!0,e.trigger(n.default.ERROR,d)):(d.fatal=!1,e.trigger(n.default.ERROR,d))):(this.segments=[],d.details=o.ErrorDetails.BUFFER_FULL_ERROR,d.fatal=!1,e.trigger(n.default.ERROR,d))}}}},i.prototype.flushBuffer=function(t,e,i){var s,n=this.sourceBuffer;if(Object.keys(n).length){if(a.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var r in n)if(!i||r===i){if((s=n[r]).ended=!1,s.updating)return a.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(r,s,t,e))return this.flushBufferCounter++,!1}}else a.logger.warn("abort flushing too many retries");a.logger.log("buffer flushed")}return!0},i.prototype.removeBufferRange=function(t,e,i,s){try{for(var n=0;n<e.buffered.length;n++){var r=e.buffered.start(n),o=e.buffered.end(n),l=Math.max(r,i),d=Math.min(o,s);if(Math.min(d,o)-l>.5)return a.logger.log("sb remove "+t+" ["+l+","+d+"], of ["+r+","+o+"], pos:"+this.media.currentTime),e.remove(l,d),!0}}catch(t){a.logger.warn("removeBufferRange failed",t)}return!1},i}(r.default);e.default=d}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/cap-level-controller.js":function(t,e,i){"use strict";(function(t){var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=function(e){function i(i){var s=e.call(this,i,n.default.FPS_DROP_LEVEL_CAPPING,n.default.MEDIA_ATTACHING,n.default.MANIFEST_PARSED,n.default.BUFFER_CODECS,n.default.MEDIA_DETACHING)||this;return s.autoLevelCapping=t.POSITIVE_INFINITY,s.firstLevel=null,s.levels=[],s.media=null,s.restrictedLevels=[],s.timer=null,s}return s(i,e),i.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},i.prototype.onFpsDropLevelCapping=function(t){i.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},i.prototype.onMediaAttaching=function(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},i.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&t.video&&this._startCapping()},i.prototype.onBufferCodecs=function(t){this.hls.config.capLevelToPlayerSize&&t.video&&this._startCapping()},i.prototype.onLevelsUpdated=function(t){this.levels=t.levels},i.prototype.onMediaDetaching=function(){this._stopCapping()},i.prototype.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},i.prototype.getMaxLevel=function(t){var e=this;if(!this.levels)return-1;var s=this.levels.filter(function(s,n){return i.isLevelAllowed(n,e.restrictedLevels)&&n<=t});return i.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)},i.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=t.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),window.clearInterval(this.timer),this.timer=window.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},i.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=t.POSITIVE_INFINITY,this.timer&&(this.timer=window.clearInterval(this.timer),this.timer=null)},Object.defineProperty(i.prototype,"mediaWidth",{get:function(){var t,e=this.media;return e&&(t=e.width||e.clientWidth||e.offsetWidth,t*=i.contentScaleFactor),t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mediaHeight",{get:function(){var t,e=this.media;return e&&(t=e.height||e.clientHeight||e.offsetHeight,t*=i.contentScaleFactor),t},enumerable:!0,configurable:!0}),Object.defineProperty(i,"contentScaleFactor",{get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t},enumerable:!0,configurable:!0}),i.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},i.getMaxLevelByMediaSize=function(t,e,i){if(!t||t&&!t.length)return-1;for(var s=function(t,e){return!e||t.width!==e.width||t.height!==e.height},n=t.length-1,r=0;r<t.length;r+=1){var a=t[r];if((a.width>=e||a.height>=i)&&s(a,t[r+1])){n=r;break}}return n},i}(i("./src/event-handler.js").default);e.default=r}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/eme-controller.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/event-handler.js"),r=i("./src/events.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=window.XMLHttpRequest,d="com.widevine.alpha",u="com.microsoft.playready",h=function(t){function e(e){var i=t.call(this,e,r.default.MEDIA_ATTACHED,r.default.MANIFEST_PARSED)||this;return i._widevineLicenseUrl=e.config.widevineLicenseUrl,i._licenseXhrSetup=e.config.licenseXhrSetup,i._emeEnabled=e.config.emeEnabled,i._requestMediaKeySystemAccess=e.config.requestMediaKeySystemAccessFunc,i._mediaKeysList=[],i._media=null,i._hasSetMediaKeys=!1,i._isMediaEncrypted=!1,i._requestLicenseFailureCount=0,i}return s(e,t),e.prototype.getLicenseServerUrl=function(t){var e;switch(t){case d:e=this._widevineLicenseUrl;break;default:e=null}return e||(o.logger.error('No license server URL configured for key-system "'+t+'"'),this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),e},e.prototype._attemptKeySystemAccess=function(t,e,i){var s=this,n=function(t,e,i){switch(t){case d:return function(t,e,i){var s={videoCapabilities:[]};return e.forEach(function(t){s.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"'})}),[s]}(0,i);default:throw Error("Unknown key-system: "+t)}}(t,0,i);n?(o.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(t,n).then(function(e){s._onMediaKeySystemAccessObtained(t,e)}).catch(function(e){o.logger.error('Failed to obtain key-system "'+t+'" access:',e)})):o.logger.warn("Can not create config for key-system (maybe because platform is not supported):",t)},Object.defineProperty(e.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),e.prototype._onMediaKeySystemAccessObtained=function(t,e){var i=this;o.logger.log('Access for key-system "'+t+'" obtained');var s={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(s),e.createMediaKeys().then(function(e){s.mediaKeys=e,o.logger.log('Media-keys created for key-system "'+t+'"'),i._onMediaKeysCreated()}).catch(function(t){o.logger.error("Failed to create media-keys:",t)})},e.prototype._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},e.prototype._onNewMediaKeySession=function(t){var e=this;o.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",function(i){e._onKeySessionMessage(t,i.message)},!1)},e.prototype._onKeySessionMessage=function(t,e){o.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(e){o.logger.log("Received license data, updating key-session"),t.update(e)})},e.prototype._onMediaEncrypted=function(t,e){o.logger.log('Media is encrypted using "'+t+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=t,this._mediaEncryptionInitData=e,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},e.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return o.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});o.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},e.prototype._generateRequestWithPreferredKeySession=function(){var t=this,e=this._mediaKeysList[0];if(!e)return o.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)o.logger.warn("Key-Session already initialized but requested again");else{var i=e.mediaKeysSession;i||(o.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var s=this._mediaEncryptionInitDataType,n=this._mediaEncryptionInitData;o.logger.log('Generating key-session request for "'+s+'" init data type'),e.mediaKeysSessionInitialized=!0,i.generateRequest(s,n).then(function(){o.logger.debug("Key-session generation succeeded")}).catch(function(e){o.logger.error("Error generating key-session request:",e),t.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},e.prototype._createLicenseXhr=function(t,e,i){var s=new l,n=this._licenseXhrSetup;try{if(n)try{n(s,t)}catch(e){s.open("POST",t,!0),n(s,t)}s.readyState||s.open("POST",t,!0)}catch(t){return o.logger.error("Error setting up key-system license XHR",t),void this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return s.responseType="arraybuffer",s.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,s,t,e,i),s},e.prototype._onLicenseRequestReadyStageChange=function(t,e,i,s){switch(t.readyState){case 4:if(200===t.status)this._requestLicenseFailureCount=0,o.logger.log("License request succeeded"),s(t.response);else{if(o.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),++this._requestLicenseFailureCount<=3){var n=3-this._requestLicenseFailureCount+1;return o.logger.warn("Retrying license request, "+n+" attempts left"),void this._requestLicense(i,s)}this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},e.prototype._generateLicenseRequestChallenge=function(t,e){var i;return t.mediaKeySystemDomain===u?o.logger.error("PlayReady is not supported (yet)"):t.mediaKeySystemDomain===d?i=e:o.logger.error("Unsupported key-system:",t.mediaKeySystemDomain),i},e.prototype._requestLicense=function(t,e){o.logger.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return o.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var s=this.getLicenseServerUrl(i.mediaKeySystemDomain),n=this._createLicenseXhr(s,t,e);o.logger.log("Sending license request to URL: "+s),n.send(this._generateLicenseRequestChallenge(i,t))},e.prototype.onMediaAttached=function(t){var e=this;if(this._emeEnabled){var i=t.media;this._media=i,i.addEventListener("encrypted",function(t){e._onMediaEncrypted(t.initDataType,t.initData)})}},e.prototype.onManifestParsed=function(t){if(this._emeEnabled){var e=t.levels.map(function(t){return t.audioCodec}),i=t.levels.map(function(t){return t.videoCodec});this._attemptKeySystemAccess(d,e,i)}},e}(n.default);e.default=h},"./src/controller/fps-controller.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/utils/logger.js"),o=window.performance,l=function(t){function e(e){return t.call(this,e,n.default.MEDIA_ATTACHING)||this}return s(e,t),e.prototype.destroy=function(){this.timer&&window.clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},e.prototype.onMediaAttaching=function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof window.HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),window.clearInterval(this.timer),this.timer=window.setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))},e.prototype.checkFPS=function(t,e,i){var s=o.now();if(e){if(this.lastTime){var r=s-this.lastTime,l=i-this.lastDroppedFrames,d=e-this.lastDecodedFrames,u=1e3*l/r,h=this.hls;if(h.trigger(n.default.FPS_DROP,{currentDropped:l,currentDecoded:d,totalDroppedFrames:i}),u>0&&l>h.config.fpsDroppedMonitoringThreshold*d){var c=h.currentLevel;a.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===h.autoLevelCapping||h.autoLevelCapping>=c)&&(c-=1,h.trigger(n.default.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:h.currentLevel}),h.autoLevelCapping=c,h.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=e}},e.prototype.checkFPSInterval=function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},e}(r.default);e.default=l},"./src/controller/fragment-finders.js":function(t,e,i){"use strict";(function(t){function s(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0);var s=Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-s<=t?1:i.start-s>t&&i.start?-1:0}function n(t,e,i){var s=1e3*Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.endProgramDateTime-s>t}Object.defineProperty(e,"__esModule",{value:!0});var r=i("./src/utils/binary-search.js");e.findFragmentByPDT=function(e,i,s){if(!Array.isArray(e)||!e.length||!t.isFinite(i))return null;if(i<e[0].programDateTime)return null;if(i>=e[e.length-1].endProgramDateTime)return null;s=s||0;for(var r=0;r<e.length;++r){var a=e[r];if(n(i,s,a))return a}return null},e.findFragmentByPTS=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var a=t?e[t.sn-e[0].sn+1]:null;return a&&!s(i,n,a)?a:r.default.search(e,s.bind(null,i,n))},e.fragmentWithinToleranceTest=s,e.pdtWithinToleranceTest=n}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/fragment-tracker.js":function(t,e,i){"use strict";(function(t){var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/event-handler.js"),r=i("./src/events.js");e.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var a=function(i){function a(t){var e=i.call(this,t,r.default.BUFFER_APPENDED,r.default.FRAG_BUFFERED,r.default.FRAG_LOADED)||this;return e.bufferPadding=.2,e.fragments=Object.create(null),e.timeRanges=Object.create(null),e.config=t.config,e}return s(a,i),a.prototype.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,n.default.prototype.destroy.call(this),i.prototype.destroy.call(this)},a.prototype.getBufferedFrag=function(t,e){var i=this.fragments,s=Object.keys(i).filter(function(s){var n=i[s];if(n.body.type!==e)return!1;if(!n.buffered)return!1;var r=n.body;return r.startPTS<=t&&t<=r.endPTS});if(0===s.length)return null;var n=s.pop();return i[n].body},a.prototype.detectEvictedFragments=function(t,e){var i,s,n=this;Object.keys(this.fragments).forEach(function(r){var a=n.fragments[r];if(!0===a.buffered){var o=a.range[t];if(o){i=o.time;for(var l=0;l<i.length;l++)if(s=i[l],!1===n.isTimeBuffered(s.startPTS,s.endPTS,e)){n.removeFragment(a.body);break}}}})},a.prototype.detectPartialFragments=function(t){var e=this,i=this.getFragmentKey(t),s=this.fragments[i];s&&(s.buffered=!0,Object.keys(this.timeRanges).forEach(function(i){if(t.hasElementaryStream(i)){var n=e.timeRanges[i];s.range[i]=e.getBufferedTimes(t.startPTS,t.endPTS,n)}}))},a.prototype.getBufferedTimes=function(t,e,i){for(var s,n,r=[],a=!1,o=0;o<i.length;o++){if(s=i.start(o)-this.bufferPadding,n=i.end(o)+this.bufferPadding,t>=s&&e<=n){r.push({startPTS:Math.max(t,i.start(o)),endPTS:Math.min(e,i.end(o))});break}if(t<n&&e>s)r.push({startPTS:Math.max(t,i.start(o)),endPTS:Math.min(e,i.end(o))}),a=!0;else if(e<=s)break}return{time:r,partial:a}},a.prototype.getFragmentKey=function(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn},a.prototype.getPartialFragment=function(t){var e,i,s,n=this,r=null,a=0;return Object.keys(this.fragments).forEach(function(o){var l=n.fragments[o];n.isPartial(l)&&(i=l.body.startPTS-n.bufferPadding,s=l.body.endPTS+n.bufferPadding,t>=i&&t<=s&&(e=Math.min(t-i,s-t),a<=e&&(r=l.body,a=e)))}),r},a.prototype.getState=function(t){var i=this.getFragmentKey(t),s=this.fragments[i],n=e.FragmentState.NOT_LOADED;return void 0!==s&&(n=s.buffered?!0===this.isPartial(s)?e.FragmentState.PARTIAL:e.FragmentState.OK:e.FragmentState.APPENDING),n},a.prototype.isPartial=function(t){return!0===t.buffered&&(void 0!==t.range.video&&!0===t.range.video.partial||void 0!==t.range.audio&&!0===t.range.audio.partial)},a.prototype.isTimeBuffered=function(t,e,i){for(var s,n,r=0;r<i.length;r++){if(s=i.start(r)-this.bufferPadding,n=i.end(r)+this.bufferPadding,t>=s&&e<=n)return!0;if(e<=s)return!1}return!1},a.prototype.onFragLoaded=function(e){var i=e.frag;t.isFinite(i.sn)&&!i.bitrateTest&&(this.fragments[this.getFragmentKey(i)]={body:i,range:Object.create(null),buffered:!1})},a.prototype.onBufferAppended=function(t){var e=this;this.timeRanges=t.timeRanges,Object.keys(this.timeRanges).forEach(function(t){var i=e.timeRanges[t];e.detectEvictedFragments(t,i)})},a.prototype.onFragBuffered=function(t){this.detectPartialFragments(t.frag)},a.prototype.hasFragment=function(t){var e=this.getFragmentKey(t);return void 0!==this.fragments[e]},a.prototype.removeFragment=function(t){var e=this.getFragmentKey(t);delete this.fragments[e]},a.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},a}(n.default);e.FragmentTracker=a}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/gap-controller.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/buffer-helper.js"),n=i("./src/errors.js"),r=i("./src/events.js"),a=i("./src/utils/logger.js"),o=function(){function t(t,e,i,s){this.config=t,this.media=e,this.fragmentTracker=i,this.hls=s,this.stallReported=!1}return t.prototype.poll=function(t,e){var i=this.config,n=this.media,r=n.currentTime,o=window.performance.now();if(r!==t)return this.stallReported&&(a.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(o-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(n.ended||!n.buffered.length||n.readyState>2||n.seeking&&s.BufferHelper.isBuffered(n,r))){var l=o-this.stalled,d=s.BufferHelper.bufferInfo(n,r,i.maxBufferHole);if(!this.stalled)return void(this.stalled=o);l>=1e3&&this._reportStall(d.len),this._tryFixBufferStall(d,l)}},t.prototype._tryFixBufferStall=function(t,e){var i=this,s=i.config,n=i.fragmentTracker,r=i.media.currentTime,a=n.getPartialFragment(r);a&&this._trySkipBufferHole(a),t.len>.5&&e>1e3*s.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},t.prototype._reportStall=function(t){var e=this,i=e.hls,s=e.media;e.stallReported||(this.stallReported=!0,a.logger.warn("Playback stalling at @"+s.currentTime+" due to low buffer"),i.trigger(r.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},t.prototype._trySkipBufferHole=function(t){for(var e=this.hls,i=this.media,s=i.currentTime,o=0,l=0;l<i.buffered.length;l++){var d=i.buffered.start(l);if(s>=o&&s<d)return i.currentTime=Math.max(d,i.currentTime+.1),a.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+i.currentTime),this.stalled=null,void e.trigger(r.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+i.currentTime,frag:t});o=i.buffered.end(l)}},t.prototype._tryNudgeBuffer=function(){var t=this,e=t.config,i=t.hls,s=t.media,o=s.currentTime,l=(this.nudgeRetry||0)+1;if(this.nudgeRetry=l,l<e.nudgeMaxRetry){var d=o+l*e.nudgeOffset;a.logger.log("adjust currentTime from "+o+" to "+d),s.currentTime=d,i.trigger(r.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else a.logger.error("still stuck in high buffer @"+o+" after "+e.nudgeMaxRetry+", raise fatal error"),i.trigger(r.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},t}();e.default=o},"./src/controller/id3-track-controller.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/demux/id3.js"),o=i("./src/utils/texttrack-utils.js"),l=function(t){function e(e){var i=t.call(this,e,n.default.MEDIA_ATTACHED,n.default.MEDIA_DETACHING,n.default.FRAG_PARSING_METADATA)||this;return i.id3Track=void 0,i.media=void 0,i}return s(e,t),e.prototype.destroy=function(){r.default.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){this.media=t.media,this.media},e.prototype.onMediaDetaching=function(){o.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},e.prototype.getID3Track=function(t){for(var e=0;e<t.length;e++){var i=t[e];if("metadata"===i.kind&&"id3"===i.label)return o.sendAddTrackEvent(i,this.media),i}return this.media.addTextTrack("metadata","id3")},e.prototype.onFragParsingMetadata=function(t){var e=t.frag,i=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var s=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0;n<i.length;n++){var r=a.default.getID3Frames(i[n].data);if(r){var o=i[n].pts,l=n<i.length-1?i[n+1].pts:e.endPTS;o===l&&(l+=1e-4);for(var d=0;d<r.length;d++){var u=r[d];if(!a.default.isTimeStampFrame(u)){var h=new s(o,l,"");h.value=u,this.id3Track.addCue(h)}}}}},e}(r.default);e.default=l},"./src/controller/level-controller.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n,r=i("./src/events.js"),a=i("./src/event-handler.js"),o=i("./src/utils/logger.js"),l=i("./src/errors.js"),d=i("./src/utils/codecs.js"),u=i("./src/controller/level-helper.js"),h=(window.performance,function(t){function e(e){var i=t.call(this,e,r.default.MANIFEST_LOADED,r.default.LEVEL_LOADED,r.default.AUDIO_TRACK_SWITCHED,r.default.FRAG_LOADED,r.default.ERROR)||this;return i.canload=!1,i.currentLevelIndex=null,i.manualLevelIndex=-1,i.timer=null,n=/chrome|firefox/.test(window.navigator.userAgent.toLowerCase()),i}return s(e,t),e.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},e.prototype.clearTimer=function(){null!==this.timer&&(window.clearTimeout(this.timer),this.timer=null)},e.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},e.prototype.stopLoad=function(){this.canload=!1},e.prototype.onManifestLoaded=function(t){var e,i=[],s=[],a={},h=null,c=!1,p=!1;if(t.levels.forEach(function(t){var e=t.attrs;t.loadError=0,t.fragmentError=!1,c=c||!!t.videoCodec,p=p||!!t.audioCodec,n&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),(h=a[t.bitrate])?h.url.push(t.url):(t.url=[t.url],t.urlId=0,a[t.bitrate]=t,i.push(t)),e&&(e.AUDIO&&(p=!0,u.addGroupId(h||t,"audio",e.AUDIO)),e.SUBTITLES&&u.addGroupId(h||t,"text",e.SUBTITLES))}),c&&p&&(i=i.filter(function(t){return!!t.videoCodec})),i=i.filter(function(t){var e=t.audioCodec,i=t.videoCodec;return(!e||d.isCodecSupportedInMp4(e,"audio"))&&(!i||d.isCodecSupportedInMp4(i,"video"))}),t.audioTracks&&(s=t.audioTracks.filter(function(t){return!t.audioCodec||d.isCodecSupportedInMp4(t.audioCodec,"audio")})).forEach(function(t,e){t.id=e}),i.length>0){e=i[0].bitrate,i.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=i;for(var f=0;f<i.length;f++)if(i[f].bitrate===e){this._firstLevel=f,o.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+e);break}this.hls.trigger(r.default.MANIFEST_PARSED,{levels:i,audioTracks:s,firstLevel:this._firstLevel,stats:t.stats,audio:p,video:c,altAudio:s.some(function(t){return!!t.url})})}else this.hls.trigger(r.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&e[t].details||this.setLevelInternal(t))},enumerable:!0,configurable:!0}),e.prototype.setLevelInternal=function(t){var e=this._levels,i=this.hls;if(t>=0&&t<e.length){if(this.clearTimer(),this.currentLevelIndex!==t){o.logger.log("switching to level "+t),this.currentLevelIndex=t;var s=e[t];s.level=t,i.trigger(r.default.LEVEL_SWITCHING,s)}var n=e[t],a=n.details;if(!a||a.live){var d=n.urlId;i.trigger(r.default.LEVEL_LOADING,{url:n.url[d],level:t,id:d})}}else i.trigger(r.default.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(e.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(t){this._firstLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startLevel",{get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t},enumerable:!0,configurable:!0}),e.prototype.onError=function(t){if(t.fatal)t.type===l.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var e,i=!1,s=!1;switch(t.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:e=t.frag.level,s=!0;break;case l.ErrorDetails.LEVEL_LOAD_ERROR:case l.ErrorDetails.LEVEL_LOAD_TIMEOUT:e=t.context.level,i=!0;break;case l.ErrorDetails.REMUX_ALLOC_ERROR:e=t.level,i=!0}void 0!==e&&this.recoverLevel(t,e,i,s)}},e.prototype.recoverLevel=function(t,e,i,s){var n,r,a,l=this,d=this.hls.config,u=t.details,h=this._levels[e];if(h.loadError++,h.fragmentError=s,i){if(!(this.levelRetryCount+1<=d.levelLoadingMaxRetry))return o.logger.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);r=Math.min(Math.pow(2,this.levelRetryCount)*d.levelLoadingRetryDelay,d.levelLoadingMaxRetryTimeout),this.timer=window.setTimeout(function(){return l.loadLevel()},r),t.levelRetry=!0,this.levelRetryCount++,o.logger.warn("level controller, "+u+", retry in "+r+" ms, current retry count is "+this.levelRetryCount)}(i||s)&&((n=h.url.length)>1&&h.loadError<n?(h.urlId=(h.urlId+1)%n,h.details=void 0,o.logger.warn("level controller, "+u+" for level "+e+": switching to redundant URL-id "+h.urlId)):-1===this.manualLevelIndex?(a=0===e?this._levels.length-1:e-1,o.logger.warn("level controller, "+u+": switch to "+a),this.hls.nextAutoLevel=this.currentLevelIndex=a):s&&(o.logger.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},e.prototype.onFragLoaded=function(t){var e=t.frag;if(void 0!==e&&"main"===e.type){var i=this._levels[e.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},e.prototype.onLevelLoaded=function(t){var e=this,i=t.level,s=t.details;if(i===this.currentLevelIndex){var n=this._levels[i];if(n.fragmentError||(n.loadError=0,this.levelRetryCount=0),s.live){var r=u.computeReloadInterval(n.details,s,t.stats.trequest);o.logger.log("live playlist, reload in "+Math.round(r)+" ms"),this.timer=window.setTimeout(function(){return e.loadLevel()},r)}else this.clearTimer()}},e.prototype.onAudioTrackSwitched=function(t){var e=this.hls.audioTracks[t.id].groupId,i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var s=-1,n=0;n<i.audioGroupIds.length;n++)if(i.audioGroupIds[n]===e){s=n;break}s!==i.urlId&&(i.urlId=s,this.startLoad())}},e.prototype.loadLevel=function(){if(o.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var t=this._levels[this.currentLevelIndex];if("object"==typeof t&&t.url.length>0){var e=this.currentLevelIndex,i=t.urlId,s=t.url[i];o.logger.log("Attempt loading level index "+e+" with URL-id "+i),this.hls.trigger(r.default.LEVEL_LOADING,{url:s,level:e,id:i})}}},Object.defineProperty(e.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)},enumerable:!0,configurable:!0}),e}(a.default));e.default=h},"./src/controller/level-helper.js":function(t,e,i){"use strict";(function(t){function s(e,i,s){var n=e[i],r=e[s],a=r.startPTS;t.isFinite(a)?s>i?(n.duration=a-n.start,n.duration<0&&o.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(r.duration=n.start-a,r.duration<0&&o.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):r.start=s>i?n.start+n.duration:Math.max(n.start-r.duration,0)}function n(e,i,n,r,a,o){var l=n;if(t.isFinite(i.startPTS)){var d=Math.abs(i.startPTS-n);t.isFinite(i.deltaPTS)?i.deltaPTS=Math.max(d,i.deltaPTS):i.deltaPTS=d,l=Math.max(n,i.startPTS),n=Math.min(n,i.startPTS),r=Math.max(r,i.endPTS),a=Math.min(a,i.startDTS),o=Math.max(o,i.endDTS)}var u=n-i.start;i.start=i.startPTS=n,i.maxStartPTS=l,i.endPTS=r,i.startDTS=a,i.endDTS=o,i.duration=r-n;var h,c,p,f=i.sn;if(!e||f<e.startSN||f>e.endSN)return 0;for(h=f-e.startSN,(c=e.fragments)[h]=i,p=h;p>0;p--)s(c,p,p-1);for(p=h;p<c.length-1;p++)s(c,p,p+1);return e.PTSKnown=!0,u}function r(t,e,i){if(t&&e)for(var s=Math.max(t.startSN,e.startSN)-e.startSN,n=Math.min(t.endSN,e.endSN)-e.startSN,r=e.startSN-t.startSN,a=s;a<=n;a++){var o=t.fragments[r+a],l=e.fragments[a];if(!o||!l)break;i(o,l,a)}}function a(t,e){var i=e.startSN-t.startSN,s=t.fragments,n=e.fragments;if(!(i<0||i>s.length))for(var r=0;r<n.length;r++)n[r].start+=s[i].start}Object.defineProperty(e,"__esModule",{value:!0});var o=i("./src/utils/logger.js");e.addGroupId=function(t,e,i){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(i);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(i)}},e.updatePTS=s,e.updateFragPTSDTS=n,e.mergeDetails=function(e,i){i.initSegment&&e.initSegment&&(i.initSegment=e.initSegment);var s,l=0;if(r(e,i,function(e,n){l=e.cc-n.cc,t.isFinite(e.startPTS)&&(n.start=n.startPTS=e.startPTS,n.endPTS=e.endPTS,n.duration=e.duration,n.backtracked=e.backtracked,n.dropped=e.dropped,s=n),i.PTSKnown=!0}),i.PTSKnown){if(l){o.logger.log("discontinuity sliding from playlist, take drift into account");for(var d=i.fragments,u=0;u<d.length;u++)d[u].cc+=l}s?n(i,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):a(e,i),i.PTSKnown=e.PTSKnown}},e.mergeSubtitlePlaylists=function(t,e,i){void 0===i&&(i=0);var s=-1;r(t,e,function(t,e,i){e.start=t.start,s=i});var n=e.fragments;if(s<0)n.forEach(function(t){t.start+=i});else for(var a=s+1;a<n.length;a++)n[a].start=n[a-1].start+n[a-1].duration},e.mapFragmentIntersection=r,e.adjustSliding=a,e.computeReloadInterval=function(t,e,i){var s=1e3*(e.averagetargetduration?e.averagetargetduration:e.targetduration),n=s/2;return t&&e.endSN===t.endSN&&(s=n),i&&(s=Math.max(n,s-(window.performance.now()-i))),Math.round(s)}}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/stream-controller.js":function(t,e,i){"use strict";(function(t){var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/utils/binary-search.js"),r=i("./src/utils/buffer-helper.js"),a=i("./src/demux/demuxer.js"),o=i("./src/events.js"),l=i("./src/controller/fragment-tracker.js"),d=i("./src/loader/fragment.js"),u=i("./src/loader/playlist-loader.js"),h=i("./src/controller/level-helper.js"),c=i("./src/utils/time-ranges.js"),p=i("./src/errors.js"),f=i("./src/utils/logger.js"),v=i("./src/utils/discontinuities.js"),g=i("./src/controller/fragment-finders.js"),_=i("./src/controller/gap-controller.js"),E=i("./src/controller/base-stream-controller.js"),m=function(e){function i(t,i){var s=e.call(this,t,o.default.MEDIA_ATTACHED,o.default.MEDIA_DETACHING,o.default.MANIFEST_LOADING,o.default.MANIFEST_PARSED,o.default.LEVEL_LOADED,o.default.KEY_LOADED,o.default.FRAG_LOADED,o.default.FRAG_LOAD_EMERGENCY_ABORTED,o.default.FRAG_PARSING_INIT_SEGMENT,o.default.FRAG_PARSING_DATA,o.default.FRAG_PARSED,o.default.ERROR,o.default.AUDIO_TRACK_SWITCHING,o.default.AUDIO_TRACK_SWITCHED,o.default.BUFFER_CREATED,o.default.BUFFER_APPENDED,o.default.BUFFER_FLUSHED)||this;return s.fragmentTracker=i,s.config=t.config,s.audioCodecSwap=!1,s._state=E.State.STOPPED,s.stallReported=!1,s.gapController=null,s}return s(i,e),i.prototype.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var s=i.startLevel;-1===s&&(s=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=s,this.loadedmetadata=!1}e>0&&-1===t&&(f.logger.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=E.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=E.State.STOPPED},i.prototype.stopLoad=function(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},i.prototype.doTick=function(){switch(this.state){case E.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case E.State.IDLE:this._doTickIdle();break;case E.State.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=E.State.IDLE);break;case E.State.FRAG_LOADING_WAITING_RETRY:var e=window.performance.now(),i=this.retryDate;(!i||e>=i||this.media&&this.media.seeking)&&(f.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=E.State.IDLE);break;case E.State.ERROR:case E.State.STOPPED:case E.State.FRAG_LOADING:case E.State.PARSING:case E.State.PARSED:case E.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},i.prototype._doTickIdle=function(){var t=this.hls,e=t.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&e.startFragPrefetch)){var s;s=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var n=t.nextLoadLevel,a=this.levels[n];if(a){var l,d=a.bitrate;l=d?Math.max(8*e.maxBufferSize/d,e.maxBufferLength):e.maxBufferLength,l=Math.min(l,e.maxMaxBufferLength);var u=r.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,s,e.maxBufferHole),h=u.len;if(!(h>=l)){f.logger.trace("buffer length of "+h.toFixed(3)+" is below max of "+l.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=n;var c=a.details;if(!c||c.live&&this.levelLastLoaded!==n)return void(this.state=E.State.WAITING_LEVEL);if(this._streamEnded(u,c)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(o.default.BUFFER_EOS,p),void(this.state=E.State.ENDED)}this._fetchPayloadOrEos(s,u,c)}}}},i.prototype._fetchPayloadOrEos=function(t,e,i){var s=this.fragPrevious,n=this.level,r=i.fragments,a=r.length;if(0!==a){var o,l=r[0].start,d=r[a-1].start+r[a-1].duration,u=e.end;if(i.initSegment&&!i.initSegment.data)o=i.initSegment;else if(i.live){var h=this.config.initialLiveManifestSize;if(a<h)return void f.logger.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+h);if(null===(o=this._ensureFragmentAtLivePoint(i,u,l,d,s,r,a)))return}else u<l&&(o=r[0]);o||(o=this._findFragment(l,s,a,r,u,d,i)),o&&(o.encrypted?(f.logger.log("Loading key for "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n),this._loadKey(o)):(f.logger.log("Loading "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n+", currentTime:"+t.toFixed(3)+",bufferEnd:"+u.toFixed(3)),this._loadFragment(o)))}},i.prototype._ensureFragmentAtLivePoint=function(t,e,i,s,r,a,o){var l,d=this.hls.config,u=this.media,h=void 0!==d.liveMaxLatencyDuration?d.liveMaxLatencyDuration:d.liveMaxLatencyDurationCount*t.targetduration;if(e<Math.max(i-d.maxFragLookUpTolerance,s-h)){var c=this.liveSyncPosition=this.computeLivePosition(i,t);f.logger.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+c.toFixed(3)),e=c,u&&u.readyState&&u.duration>c&&(u.currentTime=c),this.nextLoadPosition=c}if(t.PTSKnown&&e>s&&u&&u.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(r)if(t.hasProgramDateTime)f.logger.log("live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),l=g.findFragmentByPDT(a,r.endProgramDateTime,d.maxFragLookUpTolerance);else{var p=r.sn+1;if(p>=t.startSN&&p<=t.endSN){var v=a[p-t.startSN];r.cc===v.cc&&(l=v,f.logger.log("live playlist, switching playlist, load frag with next SN: "+l.sn))}l||(l=n.default.search(a,function(t){return r.cc-t.cc}))&&f.logger.log("live playlist, switching playlist, load frag with same CC: "+l.sn)}l||(l=a[Math.min(o-1,Math.round(o/2))],f.logger.log("live playlist, switching playlist, unknown, load middle frag : "+l.sn))}return l},i.prototype._findFragment=function(t,e,i,s,n,r,a){var o,l=this.hls.config;if(n<r){var d=n>r-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance;o=g.findFragmentByPTS(e,s,n,d)}else o=s[i-1];if(o){var u=o.sn-a.startSN,h=e&&o.level===e.level,c=s[u-1],p=s[u+1];if(e&&o.sn===e.sn)if(h&&!o.backtracked)if(o.sn<a.endSN){var v=e.deltaPTS;v&&v>l.maxBufferHole&&e.dropped&&u?(o=c,f.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(o=p,f.logger.log("SN just loaded, load next one: "+o.sn,o))}else o=null;else o.backtracked&&(p&&p.backtracked?(f.logger.warn("Already backtracked from fragment "+p.sn+", will not backtrack to fragment "+o.sn+". Loading fragment "+p.sn),o=p):(f.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),o.dropped=0,c?(o=c).backtracked=!0:u&&(o=null)))}return o},i.prototype._loadKey=function(t){this.state=E.State.KEY_LOADING,this.hls.trigger(o.default.KEY_LOADING,{frag:t})},i.prototype._loadFragment=function(e){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,t.isFinite(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||i===l.FragmentState.NOT_LOADED||i===l.FragmentState.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(o.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new a.default(this.hls,"main")),this.state=E.State.FRAG_LOADING):i===l.FragmentState.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},Object.defineProperty(i.prototype,"state",{get:function(){return this._state},set:function(t){if(this.state!==t){var e=this.state;this._state=t,f.logger.log("main stream:"+e+"->"+t),this.hls.trigger(o.default.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},enumerable:!0,configurable:!0}),i.prototype.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,u.default.LevelType.MAIN)},Object.defineProperty(i.prototype,"currentLevel",{get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextBufferedFrag",{get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null},enumerable:!0,configurable:!0}),i.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},Object.defineProperty(i.prototype,"nextLevel",{get:function(){var t=this.nextBufferedFrag;return t?t.level:-1},enumerable:!0,configurable:!0}),i.prototype._checkFragmentChanged=function(){var t,e,i=this.media;if(i&&i.readyState&&!1===i.seeking&&((e=i.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=e),r.BufferHelper.isBuffered(i,e)?t=this.getBufferedFrag(e):r.BufferHelper.isBuffered(i,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var s=t;if(s!==this.fragPlaying){this.hls.trigger(o.default.FRAG_CHANGED,{frag:s});var n=s.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(o.default.LEVEL_SWITCHED,{level:n}),this.fragPlaying=s}}},i.prototype.immediateLevelSwitch=function(){if(f.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,i=void 0;e?(i=e.paused,e.pause()):i=!0,this.previouslyPaused=i}var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,t.POSITIVE_INFINITY)},i.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,r.BufferHelper.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},i.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var i,s=void 0,n=void 0;if((i=this.getBufferedFrag(e.currentTime))&&i.startPTS>1&&this.flushMainBuffer(0,i.startPTS-1),e.paused)s=0;else{var r=this.hls.nextLoadLevel,a=this.levels[r],o=this.fragLastKbps;s=o&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*o)+1:0}if((n=this.getBufferedFrag(e.currentTime+s))&&(n=this.followingBufferedFrag(n))){var l=this.fragCurrent;l&&l.loader&&l.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(n.maxStartPTS,t.POSITIVE_INFINITY)}}},i.prototype.flushMainBuffer=function(t,e){this.state=E.State.BUFFER_FLUSHING;var i={startOffset:t,endOffset:e};this.altAudio&&(i.type="video"),this.hls.trigger(o.default.BUFFER_FLUSHING,i)},i.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition),this.gapController=new _.default(i,e,this.fragmentTracker,this.hls)},i.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(f.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.prototype.onMediaSeeked=function(){var e=this.media,i=e?e.currentTime:void 0;t.isFinite(i)&&f.logger.log("media seeked to "+i.toFixed(3)),this.tick()},i.prototype.onManifestLoading=function(){f.logger.log("trigger BUFFER_RESET"),this.hls.trigger(o.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},i.prototype.onManifestParsed=function(t){var e,i=!1,s=!1;t.levels.forEach(function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(i=!0),-1!==e.indexOf("mp4a.40.5")&&(s=!0))}),this.audioCodecSwitch=i&&s,this.audioCodecSwitch&&f.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},i.prototype.onLevelLoaded=function(e){var i=e.details,s=e.level,n=this.levels[this.levelLastLoaded],r=this.levels[s],a=i.totalduration,l=0;if(f.logger.log("level "+s+" loaded ["+i.startSN+","+i.endSN+"],duration:"+a),i.live){var d=r.details;d&&i.fragments.length>0?(h.mergeDetails(d,i),l=i.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(l,d),i.PTSKnown&&t.isFinite(l)?f.logger.log("live playlist sliding:"+l.toFixed(3)):(f.logger.log("live playlist - outdated PTS, unknown sliding"),v.alignStream(this.fragPrevious,n,i))):(f.logger.log("live playlist - first load, unknown sliding"),i.PTSKnown=!1,v.alignStream(this.fragPrevious,n,i))}else i.PTSKnown=!1;if(r.details=i,this.levelLastLoaded=s,this.hls.trigger(o.default.LEVEL_UPDATED,{details:i,level:s}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var u=i.startTimeOffset;t.isFinite(u)?(u<0&&(f.logger.log("negative start time offset "+u+", count from end of last fragment"),u=l+a+u),f.logger.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u):i.live?(this.startPosition=this.computeLivePosition(l,i),f.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===E.State.WAITING_LEVEL&&(this.state=E.State.IDLE),this.tick()},i.prototype.onKeyLoaded=function(){this.state===E.State.KEY_LOADING&&(this.state=E.State.IDLE,this.tick())},i.prototype.onFragLoaded=function(t){var e=this,i=e.fragCurrent,s=e.hls,n=e.levels,r=e.media,l=t.frag;if(this.state===E.State.FRAG_LOADING&&i&&"main"===l.type&&l.level===i.level&&l.sn===i.sn){var d=t.stats,u=n[i.level],h=u.details;if(this.bitrateTest=!1,this.stats=d,f.logger.log("Loaded "+i.sn+" of ["+h.startSN+" ,"+h.endSN+"],level "+i.level),l.bitrateTest&&s.nextLoadLevel)this.state=E.State.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=window.performance.now(),s.trigger(o.default.FRAG_BUFFERED,{stats:d,frag:i,id:"main"}),this.tick();else if("initSegment"===l.sn)this.state=E.State.IDLE,d.tparsed=d.tbuffered=window.performance.now(),h.initSegment.data=t.payload,s.trigger(o.default.FRAG_BUFFERED,{stats:d,frag:i,id:"main"}),this.tick();else{f.logger.log("Parsing "+i.sn+" of ["+h.startSN+" ,"+h.endSN+"],level "+i.level+", cc "+i.cc),this.state=E.State.PARSING,this.pendingBuffering=!0,this.appended=!1,l.bitrateTest&&(l.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:l}));var c=!(r&&r.seeking)&&(h.PTSKnown||!h.live),p=h.initSegment?h.initSegment.data:[],v=this._getAudioCodec(u);(this.demuxer=this.demuxer||new a.default(this.hls,"main")).push(t.payload,p,v,u.videoCodec,i,h.totalduration,c)}}this.fragLoadError=0},i.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;if(e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===E.State.PARSING){var s=t.tracks,n=void 0,r=void 0;if(s.audio&&this.altAudio&&delete s.audio,r=s.audio){var a=this.levels[this.level].audioCodec,l=window.navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(f.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===l.indexOf("firefox")&&(a="mp4a.40.5"),-1!==l.indexOf("android")&&"audio/mpeg"!==r.container&&(a="mp4a.40.2",f.logger.log("Android: force audio codec to "+a)),r.levelCodec=a,r.id=t.id}for(n in(r=s.video)&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=t.id),this.hls.trigger(o.default.BUFFER_CODECS,s),s){r=s[n],f.logger.log("main track:"+n+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var d=r.initSegment;d&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(o.default.BUFFER_APPENDING,{type:n,data:d,parent:"main",content:"initSegment"}))}this.tick()}},i.prototype.onFragParsingData=function(e){var i=this,s=this.fragCurrent,n=e.frag;if(s&&"main"===e.id&&n.sn===s.sn&&n.level===s.level&&("audio"!==e.type||!this.altAudio)&&this.state===E.State.PARSING){var r=this.levels[this.level],a=s;if(t.isFinite(e.endPTS)||(e.endPTS=e.startPTS+s.duration,e.endDTS=e.startDTS+s.duration),!0===e.hasAudio&&a.addElementaryStream(d.default.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&a.addElementaryStream(d.default.ElementaryStreamTypes.VIDEO),f.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(a.dropped=e.dropped,a.dropped)if(a.backtracked)f.logger.warn("Already backtracked on this fragment, appending with the gap",a.sn);else{var l=r.details;if(!l||a.sn!==l.startSN)return f.logger.warn("missing video frame(s), backtracking fragment",a.sn),this.fragmentTracker.removeFragment(a),a.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=E.State.IDLE,this.fragPrevious=a,void this.tick();f.logger.warn("missing video frame(s) on first frag, appending with gap",a.sn)}else a.backtracked=!1;var u=h.updateFragPTSDTS(r.details,a,e.startPTS,e.endPTS,e.startDTS,e.endDTS),c=this.hls;c.trigger(o.default.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:u,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(t){t&&t.length&&i.state===E.State.PARSING&&(i.appended=!0,i.pendingBuffering=!0,c.trigger(o.default.BUFFER_APPENDING,{type:e.type,data:t,parent:"main",content:"data"}))}),this.tick()}},i.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===E.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=E.State.PARSED,this._checkAppendedParsed())},i.prototype.onAudioTrackSwitching=function(e){var i=!!e.url,s=e.id;if(!i){if(this.mediaBuffer!==this.media){f.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n.loader&&(f.logger.log("switching to main audio track, cancel main fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=E.State.IDLE}var r=this.hls;r.trigger(o.default.BUFFER_FLUSHING,{startOffset:0,endOffset:t.POSITIVE_INFINITY,type:"audio"}),r.trigger(o.default.AUDIO_TRACK_SWITCHED,{id:s}),this.altAudio=!1}},i.prototype.onAudioTrackSwitched=function(t){var e=t.id,i=!!this.hls.audioTracks[e].url;if(i){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(f.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i,this.tick()},i.prototype.onBufferCreated=function(t){var e,i,s=t.tracks,n=!1;for(var r in s){var a=s[r];"main"===a.id?(i=r,e=a,"video"===r&&(this.videoBuffer=s[r].buffer)):n=!0}n&&e?(f.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=e.buffer):this.mediaBuffer=this.media},i.prototype.onBufferAppended=function(t){if("main"===t.parent){var e=this.state;e!==E.State.PARSING&&e!==E.State.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},i.prototype._checkAppendedParsed=function(){if(!(this.state!==E.State.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;f.logger.log("main buffered : "+c.default.toString(e.buffered)),this.fragPrevious=t;var i=this.stats;i.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(o.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.state=E.State.IDLE}this.tick()}},i.prototype.onError=function(e){var i=e.frag||this.fragCurrent;if(!i||"main"===i.type){var s=!!this.media&&r.BufferHelper.isBuffered(this.media,this.media.currentTime)&&r.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);f.logger.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=window.performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=E.State.FRAG_LOADING_WAITING_RETRY}else f.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=E.State.ERROR;break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==E.State.ERROR&&(e.fatal?(this.state=E.State.ERROR,f.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==E.State.WAITING_LEVEL||(this.state=E.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==E.State.PARSING&&this.state!==E.State.PARSED||(s?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=E.State.IDLE):(f.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,t.POSITIVE_INFINITY)))}}},i.prototype._reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,f.logger.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},i.prototype._checkBuffer=function(){var t=this.media;if(t&&0!==t.readyState){var e=(this.mediaBuffer?this.mediaBuffer:t).buffered;!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e)}},i.prototype.onFragLoadEmergencyAborted=function(){this.state=E.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},i.prototype.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;t&&this.fragmentTracker.detectEvictedFragments(d.default.ElementaryStreamTypes.VIDEO,t.buffered),this.state=E.State.IDLE,this.fragPrevious=null},i.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.prototype.computeLivePosition=function(t,e){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-i)},i.prototype._seekToStartPos=function(){var t=this.media,e=t.currentTime,i=t.seeking?e:this.startPosition;e!==i&&(f.logger.log("target start position not buffered, seek to buffered.start(0) "+i+" from current time "+e+" "),t.currentTime=i)},i.prototype._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(f.logger.log("swapping playlist audio codec"),e&&(e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),e},Object.defineProperty(i.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t},enumerable:!0,configurable:!0}),i}(E.default);e.default=m}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/subtitle-stream-controller.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=i("./src/utils/logger.js"),a=i("./src/crypt/decrypter.js"),o=i("./src/utils/buffer-helper.js"),l=i("./src/controller/fragment-finders.js"),d=i("./src/controller/fragment-tracker.js"),u=i("./src/controller/base-stream-controller.js"),h=i("./src/controller/level-helper.js"),c=window.performance,p=function(t){function e(e,i){var s=t.call(this,e,n.default.MEDIA_ATTACHED,n.default.MEDIA_DETACHING,n.default.ERROR,n.default.KEY_LOADED,n.default.FRAG_LOADED,n.default.SUBTITLE_TRACKS_UPDATED,n.default.SUBTITLE_TRACK_SWITCH,n.default.SUBTITLE_TRACK_LOADED,n.default.SUBTITLE_FRAG_PROCESSED,n.default.LEVEL_UPDATED)||this;return s.fragmentTracker=i,s.config=e.config,s.state=u.State.STOPPED,s.tracks=[],s.tracksBuffered=[],s.currentTrackId=-1,s.decrypter=new a.default(e,e.config),s.lastAVStart=0,s._onMediaSeeking=s.onMediaSeeking.bind(s),s}return s(e,t),e.prototype.onSubtitleFragProcessed=function(t){var e=t.frag,i=t.success;if(this.fragPrevious=e,this.state=u.State.IDLE,i){var s=this.tracksBuffered[this.currentTrackId];if(s){for(var n,r=e.start,a=0;a<s.length;a++)if(r>=s[a].start&&r<=s[a].end){n=s[a];break}var o=e.start+e.duration;n?n.end=o:(n={start:r,end:o},s.push(n))}}},e.prototype.onMediaAttached=function(t){var e=t.media;this.media=e,e.addEventListener("seeking",this._onMediaSeeking),this.state=u.State.IDLE},e.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=u.State.STOPPED},e.prototype.onError=function(t){var e=t.frag;e&&"subtitle"===e.type&&(this.state=u.State.IDLE)},e.prototype.onSubtitleTracksUpdated=function(t){var e=this;r.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=t.subtitleTracks,this.tracks.forEach(function(t){e.tracksBuffered[t.id]=[]})},e.prototype.onSubtitleTrackSwitch=function(t){if(this.currentTrackId=t.id,this.tracks&&-1!==this.currentTrackId){var e=this.tracks[this.currentTrackId];e&&e.details&&this.setInterval(500)}else this.clearInterval()},e.prototype.onSubtitleTrackLoaded=function(t){var e=t.id,i=t.details,s=this.currentTrackId,n=this.tracks,r=n[s];e>=n.length||e!==s||!r||(i.live&&h.mergeSubtitlePlaylists(r.details,i,this.lastAVStart),r.details=i,this.setInterval(500))},e.prototype.onKeyLoaded=function(){this.state===u.State.KEY_LOADING&&(this.state=u.State.IDLE)},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=t.frag.decryptdata,s=t.frag,r=this.hls;if(this.state===u.State.FRAG_LOADING&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&t.payload.byteLength>0&&i&&i.key&&"AES-128"===i.method){var a=c.now();this.decrypter.decrypt(t.payload,i.key.buffer,i.iv.buffer,function(t){var e=c.now();r.trigger(n.default.FRAG_DECRYPTED,{frag:s,payload:t,stats:{tstart:a,tdecrypt:e}})})}},e.prototype.onLevelUpdated=function(t){var e=t.details.fragments;this.lastAVStart=e.length?e[0].start:0},e.prototype.doTick=function(){if(this.media)switch(this.state){case u.State.IDLE:var t=this,e=t.config,i=t.currentTrackId,s=t.fragmentTracker,a=t.media,h=t.tracks;if(!h||!h[i]||!h[i].details)break;var c=e.maxBufferHole,p=e.maxFragLookUpTolerance,f=Math.min(e.maxBufferLength,e.maxMaxBufferLength),v=o.BufferHelper.bufferedInfo(this._getBuffered(),a.currentTime,c),g=v.end,_=v.len,E=h[i].details,m=E.fragments,A=m.length,y=m[A-1].start+m[A-1].duration;if(_>f)return;var S=void 0,b=this.fragPrevious;g<y?(b&&E.hasProgramDateTime&&(S=l.findFragmentByPDT(m,b.endProgramDateTime,p)),S||(S=l.findFragmentByPTS(b,m,g,p))):S=m[A-1],S&&S.encrypted?(r.logger.log("Loading key for "+S.sn),this.state=u.State.KEY_LOADING,this.hls.trigger(n.default.KEY_LOADING,{frag:S})):S&&s.getState(S)===d.FragmentState.NOT_LOADED&&(this.fragCurrent=S,this.state=u.State.FRAG_LOADING,this.hls.trigger(n.default.FRAG_LOADING,{frag:S}))}else this.state=u.State.IDLE},e.prototype.stopLoad=function(){this.lastAVStart=0,t.prototype.stopLoad.call(this)},e.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},e.prototype.onMediaSeeking=function(){this.fragPrevious=null},e}(u.default);e.SubtitleStreamController=p},"./src/controller/subtitle-track-controller.js":function(t,e,i){"use strict";(function(t){function s(t){for(var e=[],i=0;i<t.length;i++){var s=t[i];"subtitles"===s.kind&&s.label&&e.push(t[i])}return e}var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i("./src/events.js"),a=i("./src/event-handler.js"),o=i("./src/utils/logger.js"),l=i("./src/controller/level-helper.js"),d=function(e){function i(t){var i=e.call(this,t,r.default.MEDIA_ATTACHED,r.default.MEDIA_DETACHING,r.default.MANIFEST_LOADED,r.default.SUBTITLE_TRACK_LOADED)||this;return i.tracks=[],i.trackId=-1,i.media=null,i.stopped=!0,i.subtitleDisplay=!0,i}return n(i,e),i.prototype.destroy=function(){a.default.prototype.destroy.call(this)},i.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=window.setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},i.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?window.clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},i.prototype.onManifestLoaded=function(t){var e=this,i=t.subtitles||[];this.tracks=i,this.hls.trigger(r.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)})},i.prototype.onSubtitleTrackLoaded=function(t){var e=this,i=t.id,s=t.details,n=this.trackId,r=this.tracks,a=r[n];if(i>=r.length||i!==n||!a||this.stopped)this._clearReloadTimer();else if(o.logger.log("subtitle track "+i+" loaded"),s.live){var d=l.computeReloadInterval(a.details,s,t.stats.trequest);o.logger.log("Reloading live subtitle playlist in "+d+"ms"),this.timer=window.setTimeout(function(){e._loadCurrentTrack()},d)}else this._clearReloadTimer()},i.prototype.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},i.prototype.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},Object.defineProperty(i.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(t){this.trackId!==t&&(this._toggleTrackModes(t),this._setSubtitleTrackInternal(t))},enumerable:!0,configurable:!0}),i.prototype._clearReloadTimer=function(){this.timer&&(window.clearTimeout(this.timer),this.timer=null)},i.prototype._loadCurrentTrack=function(){var t=this,e=t.trackId,i=t.tracks,s=t.hls,n=i[e];e<0||!n||n.details&&!n.details.live||(o.logger.log("Loading subtitle track "+e),s.trigger(r.default.SUBTITLE_TRACK_LOADING,{url:n.url,id:e}))},i.prototype._toggleTrackModes=function(t){var e=this,i=e.media,n=e.subtitleDisplay,r=e.trackId;if(i){var a=s(i.textTracks);if(-1===t)[].slice.call(a).forEach(function(t){t.mode="disabled"});else{var o=a[r];o&&(o.mode="disabled")}var l=a[t];l&&(l.mode=n?"showing":"hidden")}},i.prototype._setSubtitleTrackInternal=function(e){var i=this.hls,s=this.tracks;!t.isFinite(e)||e<-1||e>=s.length||(this.trackId=e,o.logger.log("Switching to subtitle track "+e),i.trigger(r.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},i.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=s(this.media.textTracks),i=0;i<e.length;i++)if("hidden"===e[i].mode)t=i;else if("showing"===e[i].mode){t=i;break}this.subtitleTrack=t}},i}(a.default);e.default=d}).call(this,i("./src/polyfills/number.js").Number)},"./src/controller/timeline-controller.js":function(t,e,i){"use strict";(function(t){function s(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function n(t,e,i,s){return Math.min(e,s)-Math.max(t,i)}var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var a=i("./src/events.js"),o=i("./src/event-handler.js"),l=i("./src/utils/cea-608-parser.js"),d=i("./src/utils/output-filter.js"),u=i("./src/utils/webvtt-parser.js"),h=i("./src/utils/logger.js"),c=i("./src/utils/texttrack-utils.js"),p=function(e){function i(t){var i=e.call(this,t,a.default.MEDIA_ATTACHING,a.default.MEDIA_DETACHING,a.default.FRAG_PARSING_USERDATA,a.default.FRAG_DECRYPTED,a.default.MANIFEST_LOADING,a.default.MANIFEST_LOADED,a.default.FRAG_LOADED,a.default.LEVEL_SWITCHING,a.default.INIT_PTS_FOUND)||this;if(i.hls=t,i.config=t.config,i.enabled=!0,i.Cues=t.config.cueHandler,i.textTracks=[],i.tracks=[],i.unparsedVttFrags=[],i.initPTS=[],i.cueRanges=[],i.captionsTracks={},i.captionsProperties={textTrack1:{label:i.config.captionsTextTrack1Label,languageCode:i.config.captionsTextTrack1LanguageCode},textTrack2:{label:i.config.captionsTextTrack2Label,languageCode:i.config.captionsTextTrack2LanguageCode}},i.config.enableCEA708Captions){var s=new d.default(i,"textTrack1"),n=new d.default(i,"textTrack2");i.cea608Parser=new l.default(0,s,n)}return i}return r(i,e),i.prototype.addCues=function(t,e,i,s){for(var r=this.cueRanges,a=!1,o=r.length;o--;){var l=r[o],d=n(l[0],l[1],e,i);if(d>=0&&(l[0]=Math.min(l[0],e),l[1]=Math.max(l[1],i),a=!0,d/(i-e)>.5))return}a||r.push([e,i]),this.Cues.newCue(this.captionsTracks[t],e,i,s)},i.prototype.onInitPtsFound=function(t){var e=this;if("main"===t.id&&(this.initPTS[t.frag.cc]=t.initPTS),this.unparsedVttFrags.length){var i=this.unparsedVttFrags;this.unparsedVttFrags=[],i.forEach(function(t){e.onFragLoaded(t)})}},i.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var i=0;i<e.textTracks.length;i++){var s=e.textTracks[i];if(s[t])return s}return null},i.prototype.createCaptionsTrack=function(t){var e=this.captionsProperties[t],i=e.label,s=e.languageCode,n=this.captionsTracks;if(!n[t]){var r=this.getExistingTrack(t);if(r)n[t]=r,c.clearCurrentCues(n[t]),c.sendAddTrackEvent(n[t],this.media);else{var a=this.createTextTrack("captions",i,s);a&&(a[t]=!0,n[t]=a)}}},i.prototype.createTextTrack=function(t,e,i){var s=this.media;if(s)return s.addTextTrack(t,e,i)},i.prototype.destroy=function(){o.default.prototype.destroy.call(this)},i.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},i.prototype.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){c.clearCurrentCues(t[e]),delete t[e]})},i.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},i.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var i=0;i<e.length;i++)c.clearCurrentCues(e[i])}},i.prototype.onManifestLoaded=function(t){var e=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=t.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,n){var r;if(n<i.length){for(var a=null,o=0;o<i.length;o++)if(s(i[o],t)){a=i[o];break}a&&(r=a)}r||(r=e.createTextTrack("subtitles",t.name,t.lang)),t.default?r.mode=e.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",e.textTracks.push(r)})}},i.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},i.prototype.onFragLoaded=function(e){var i=e.frag,s=e.payload;if("main"===i.type){var n=i.sn;if(n!==this.lastSn+1){var r=this.cea608Parser;r&&r.reset()}this.lastSn=n}else if("subtitle"===i.type)if(s.byteLength){if(!t.isFinite(this.initPTS[i.cc]))return this.unparsedVttFrags.push(e),void(this.initPTS.length&&this.hls.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i}));var o=i.decryptdata;null!=o&&null!=o.key&&"AES-128"===o.method||this._parseVTTs(i,s)}else this.hls.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i})},i.prototype._parseVTTs=function(t,e){var i=this.vttCCs;i[t.cc]||(i[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var s=this.textTracks,n=this.hls;u.default.parse(e,this.initPTS[t.cc],i,t.cc,function(e){var i=s[t.level];"disabled"!==i.mode?(e.forEach(function(t){if(!i.cues.getCueById(t.id))try{i.addCue(t)}catch(s){var e=new window.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,i.addCue(e)}}),n.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})):n.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},function(e){h.logger.log("Failed to parse VTT cue: "+e),n.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},i.prototype.onFragDecrypted=function(e){var i=e.payload,s=e.frag;if("subtitle"===s.type){if(!t.isFinite(this.initPTS[s.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(s,i)}},i.prototype.onFragParsingUserdata=function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var i=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,i)}},i.prototype.extractCea608Data=function(t){for(var e,i,s,n=31&t[0],r=2,a=[],o=0;o<n;o++)e=t[r++],i=127&t[r++],s=127&t[r++],0===i&&0===s||0!=(4&e)&&0==(3&e)&&(a.push(i),a.push(s));return a},i}(o.default);e.default=p}).call(this,i("./src/polyfills/number.js").Number)},"./src/crypt/aes-crypto.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}();e.default=s},"./src/crypt/aes-decryptor.js":function(t,e,i){"use strict";function s(t){var e=t.byteLength,i=e&&new DataView(t).getUint8(e-1);return i?t.slice(0,e-i):t}Object.defineProperty(e,"__esModule",{value:!0}),e.removePadding=s;var n=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return t.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new window.DataView(t),i=new Uint32Array(4),s=0;s<4;s++)i[s]=e.getUint32(4*s);return i},t.prototype.initTable=function(){var t=this.sBox,e=this.invSBox,i=this.subMix,s=i[0],n=i[1],r=i[2],a=i[3],o=this.invSubMix,l=o[0],d=o[1],u=o[2],h=o[3],c=new Uint32Array(256),p=0,f=0,v=0;for(v=0;v<256;v++)c[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var g=f^f<<1^f<<2^f<<3^f<<4;g=g>>>8^255&g^99,t[p]=g,e[g]=p;var _=c[p],E=c[_],m=c[E],A=257*c[g]^16843008*g;s[p]=A<<24|A>>>8,n[p]=A<<16|A>>>16,r[p]=A<<8|A>>>24,a[p]=A,A=16843009*m^65537*E^257*_^16843008*p,l[g]=A<<24|A>>>8,d[g]=A<<16|A>>>16,u[g]=A<<8|A>>>24,h[g]=A,p?(p=_^c[c[c[m^_]]],f^=c[c[f]]):p=f=1}},t.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),i=!0,s=0;s<e.length&&i;)i=e[s]===this.key[s],s++;if(!i){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var r,a,o,l,d=this.ksRows=4*(n+6+1),u=this.keySchedule=new Uint32Array(d),h=this.invKeySchedule=new Uint32Array(d),c=this.sBox,p=this.rcon,f=this.invSubMix,v=f[0],g=f[1],_=f[2],E=f[3];for(r=0;r<d;r++)r<n?o=u[r]=e[r]:(l=o,r%n==0?(l=c[(l=l<<8|l>>>24)>>>24]<<24|c[l>>>16&255]<<16|c[l>>>8&255]<<8|c[255&l],l^=p[r/n|0]<<24):n>6&&r%n==4&&(l=c[l>>>24]<<24|c[l>>>16&255]<<16|c[l>>>8&255]<<8|c[255&l]),u[r]=o=(u[r-n]^l)>>>0);for(a=0;a<d;a++)r=d-a,l=3&a?u[r]:u[r-4],h[a]=a<4||r<=4?l:v[c[l>>>24]]^g[c[l>>>16&255]]^_[c[l>>>8&255]]^E[c[255&l]],h[a]=h[a]>>>0}},t.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},t.prototype.decrypt=function(t,e,i,n){for(var r,a,o,l,d,u,h,c,p,f,v,g,_,E,m=this.keySize+6,A=this.invKeySchedule,y=this.invSBox,S=this.invSubMix,b=S[0],T=S[1],D=S[2],I=S[3],C=this.uint8ArrayToUint32Array_(i),R=C[0],P=C[1],M=C[2],O=C[3],L=new Int32Array(t),N=new Int32Array(L.length),k=this.networkToHostOrderSwap;e<L.length;){for(p=k(L[e]),f=k(L[e+1]),v=k(L[e+2]),g=k(L[e+3]),d=p^A[0],u=g^A[1],h=v^A[2],c=f^A[3],_=4,E=1;E<m;E++)r=b[d>>>24]^T[u>>16&255]^D[h>>8&255]^I[255&c]^A[_],a=b[u>>>24]^T[h>>16&255]^D[c>>8&255]^I[255&d]^A[_+1],o=b[h>>>24]^T[c>>16&255]^D[d>>8&255]^I[255&u]^A[_+2],l=b[c>>>24]^T[d>>16&255]^D[u>>8&255]^I[255&h]^A[_+3],d=r,u=a,h=o,c=l,_+=4;r=y[d>>>24]<<24^y[u>>16&255]<<16^y[h>>8&255]<<8^y[255&c]^A[_],a=y[u>>>24]<<24^y[h>>16&255]<<16^y[c>>8&255]<<8^y[255&d]^A[_+1],o=y[h>>>24]<<24^y[c>>16&255]<<16^y[d>>8&255]<<8^y[255&u]^A[_+2],l=y[c>>>24]<<24^y[d>>16&255]<<16^y[u>>8&255]<<8^y[255&h]^A[_+3],_+=3,N[e]=k(r^R),N[e+1]=k(l^P),N[e+2]=k(o^M),N[e+3]=k(a^O),R=p,P=f,M=v,O=g,e+=4}return n?s(N.buffer):N.buffer},t.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}();e.default=n},"./src/crypt/decrypter.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/crypt/aes-crypto.js"),n=i("./src/crypt/fast-aes-key.js"),r=i("./src/crypt/aes-decryptor.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=i("./src/events.js"),d=i("./src/utils/get-self-scope.js").getSelfScope(),u=function(){function t(t,e,i){var s=(void 0===i?{}:i).removePKCS7Padding,n=void 0===s||s;if(this.logEnabled=!0,this.observer=t,this.config=e,this.removePKCS7Padding=n,n)try{var r=d.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch(t){}this.disableWebCrypto=!this.subtle}return t.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.prototype.decrypt=function(t,e,i,a){var l=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(o.logger.log("JS AES decrypt"),this.logEnabled=!1);var d=this.decryptor;d||(this.decryptor=d=new r.default),d.expandKey(e),a(d.decrypt(t,0,i,this.removePKCS7Padding))}else{this.logEnabled&&(o.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var u=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new n.default(u,e)),this.fastAesKey.expandKey().then(function(n){new s.default(u,i).decrypt(t,n).catch(function(s){l.onWebCryptoError(s,t,e,i,a)}).then(function(t){a(t)})}).catch(function(s){l.onWebCryptoError(s,t,e,i,a)})}},t.prototype.onWebCryptoError=function(t,e,i,s,n){this.config.enableSoftwareAES?(o.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,i,s,n)):(o.logger.error("decrypting error : "+t.message),this.observer.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},t.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},t}();e.default=u},"./src/crypt/fast-aes-key.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}();e.default=s},"./src/demux/aacdemuxer.js":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/demux/adts.js"),n=i("./src/utils/logger.js"),r=i("./src/demux/id3.js"),a=function(){function e(t,e,i){this.observer=t,this.config=i,this.remuxer=e}return e.prototype.resetInitSegment=function(t,e,i,s){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:s,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(t){if(!t)return!1;for(var e=(r.default.getID3Data(t,0)||[]).length,i=t.length;e<i;e++)if(s.probe(t,e))return n.logger.log("ADTS sync word found !"),!0;return!1},e.prototype.append=function(e,i,a,o){for(var l=this._audioTrack,d=r.default.getID3Data(e,0)||[],u=r.default.getTimeStamp(d),h=t.isFinite(u)?90*u:9e4*i,c=0,p=h,f=e.length,v=d.length,g=[{pts:p,dts:p,data:d}];v<f-1;)if(s.isHeader(e,v)&&v+5<f){s.initTrackConfig(l,this.observer,e,v,l.manifestCodec);var _=s.appendFrame(l,e,v,h,c);if(!_){n.logger.log("Unable to parse AAC frame");break}v+=_.length,p=_.sample.pts,c++}else r.default.isHeader(e,v)?(d=r.default.getID3Data(e,v),g.push({pts:p,dts:p,data:d}),v+=d.length):v++;this.remuxer.remux(l,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},i,a,o)},e.prototype.destroy=function(){},e}();e.default=a}).call(this,i("./src/polyfills/number.js").Number)},"./src/demux/adts.js":function(t,e,i){"use strict";function s(t,e,i,s){var n,r,a,o,l,c=window.navigator.userAgent.toLowerCase(),p=s,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return n=1+((192&e[i+2])>>>6),(r=(60&e[i+2])>>>2)>f.length-1?void t.trigger(h.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+r}):(o=(1&e[i+2])<<2,o|=(192&e[i+3])>>>6,d.logger.log("manifest codec:"+s+",ADTS data:type:"+n+",sampleingIndex:"+r+"["+f[r]+"Hz],channelConfig:"+o),/firefox/i.test(c)?r>=6?(n=5,l=new Array(4),a=r-3):(n=2,l=new Array(2),a=r):-1!==c.indexOf("android")?(n=2,l=new Array(2),a=r):(n=5,l=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&r>=6?a=r-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(r>=6&&1===o||/vivaldi/i.test(c))||!s&&1===o)&&(n=2,l=new Array(2)),a=r)),l[0]=n<<3,l[0]|=(14&r)>>1,l[1]|=(1&r)<<7,l[1]|=o<<3,5===n&&(l[1]|=(14&a)>>1,l[2]=(1&a)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:f[r],channelCount:o,codec:"mp4a.40."+n,manifestCodec:p})}function n(t,e){return 255===t[e]&&240==(246&t[e+1])}function r(t,e){return 1&t[e+1]?7:9}function a(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function o(t){return 9216e4/t}function l(t,e,i,s,n){var o,l,d=t.length;if(o=r(t,e),l=a(t,e),(l-=o)>0&&e+o+l<=d)return{headerLength:o,frameLength:l,stamp:i+s*n}}Object.defineProperty(e,"__esModule",{value:!0});var d=i("./src/utils/logger.js"),u=i("./src/errors.js"),h=i("./src/events.js");e.getAudioConfig=s,e.isHeaderPattern=n,e.getHeaderLength=r,e.getFullFrameLength=a,e.isHeader=function(t,e){return!!(e+1<t.length&&n(t,e))},e.probe=function(t,e){if(e+1<t.length&&n(t,e)){var i=r(t,e);e+5<t.length&&(i=a(t,e));var s=e+i;if(s===t.length||s+1<t.length&&n(t,s))return!0}return!1},e.initTrackConfig=function(t,e,i,n,r){if(!t.samplerate){var a=s(e,i,n,r);t.config=a.config,t.samplerate=a.samplerate,t.channelCount=a.channelCount,t.codec=a.codec,t.manifestCodec=a.manifestCodec,d.logger.log("parsed codec:"+t.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)}},e.getFrameDuration=o,e.parseFrameHeader=l,e.appendFrame=function(t,e,i,s,n){var r=l(e,i,s,n,o(t.samplerate));if(r){var a=r.stamp,d=r.headerLength,u=r.frameLength,h={unit:e.subarray(i+d,i+d+u),pts:a,dts:a};return t.samples.push(h),t.len+=u,{sample:h,length:u+d}}}},"./src/demux/demuxer-inline.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=i("./src/events.js"),r=i("./src/errors.js"),a=i("./src/crypt/decrypter.js"),o=i("./src/demux/aacdemuxer.js"),l=i("./src/demux/mp4demuxer.js"),d=i("./src/demux/tsdemuxer.js"),u=i("./src/demux/mp3demuxer.js"),h=i("./src/remux/mp4-remuxer.js"),c=i("./src/remux/passthrough-remuxer.js"),p=i("./src/utils/get-self-scope.js"),f=i("./src/utils/logger.js"),v=p.getSelfScope();try{s=v.performance.now.bind(v.performance)}catch(t){f.logger.debug("Unable to use Performance API on this environment"),s=v.Date.now}var g=function(){function t(t,e,i,s){this.observer=t,this.typeSupported=e,this.config=i,this.vendor=s}return t.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},t.prototype.push=function(t,e,i,r,o,l,d,u,h,c,p,f){var v=this;if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var g=this.decrypter;null==g&&(g=this.decrypter=new a.default(this.observer,this.config));var _=s();g.decrypt(t,e.key.buffer,e.iv.buffer,function(t){var a=s();v.observer.trigger(n.default.FRAG_DECRYPTED,{stats:{tstart:_,tdecrypt:a}}),v.pushDecrypted(new Uint8Array(t),e,new Uint8Array(i),r,o,l,d,u,h,c,p,f)})}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(i),r,o,l,d,u,h,c,p,f)},t.prototype.pushDecrypted=function(t,e,i,s,a,p,f,v,g,_,E,m){var A=this.demuxer;if(!A||(f||v)&&!this.probe(t)){for(var y=this.observer,S=this.typeSupported,b=this.config,T=[{demux:d.default,remux:h.default},{demux:l.default,remux:c.default},{demux:o.default,remux:h.default},{demux:u.default,remux:h.default}],D=0,I=T.length;D<I;D++){var C=T[D],R=C.demux.probe;if(R(t)){var P=this.remuxer=new C.remux(y,b,S,this.vendor);A=new C.demux(y,P,b,S),this.probe=R;break}}if(!A)return void y.trigger(n.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=A}var M=this.remuxer;(f||v)&&(A.resetInitSegment(i,s,a,_),M.resetInitSegment()),f&&(A.resetTimeStamp(m),M.resetTimeStamp(m)),"function"==typeof A.setDecryptData&&A.setDecryptData(e),A.append(t,p,g,E)},t}();e.default=g},"./src/demux/demuxer-worker.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/demux/demuxer-inline.js"),n=i("./src/events.js"),r=i("./src/utils/logger.js"),a=i("./node_modules/node-libs-browser/node_modules/events/events.js");e.default=function(t){var e=new a.EventEmitter;e.trigger=function(t){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];e.emit.apply(e,[t,t].concat(i))},e.off=function(t){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];e.removeListener.apply(e,[t].concat(i))};var i=function(e,i){t.postMessage({event:e,data:i})};t.addEventListener("message",function(n){var a=n.data;switch(a.cmd){case"init":var o=JSON.parse(a.config);t.demuxer=new s.default(e,a.typeSupported,o,a.vendor),r.enableLogs(o.debug),i("init",null);break;case"demux":t.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}}),e.on(n.default.FRAG_DECRYPTED,i),e.on(n.default.FRAG_PARSING_INIT_SEGMENT,i),e.on(n.default.FRAG_PARSED,i),e.on(n.default.ERROR,i),e.on(n.default.FRAG_PARSING_METADATA,i),e.on(n.default.FRAG_PARSING_USERDATA,i),e.on(n.default.INIT_PTS_FOUND,i),e.on(n.default.FRAG_PARSING_DATA,function(e,i){var s=[],n={event:e,data:i};i.data1&&(n.data1=i.data1.buffer,s.push(i.data1.buffer),delete i.data1),i.data2&&(n.data2=i.data2.buffer,s.push(i.data2.buffer),delete i.data2),t.postMessage(n,s)})}},"./src/demux/demuxer.js":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var s=i("./node_modules/webworkify-webpack/index.js"),n=i("./src/events.js"),r=i("./src/demux/demuxer-inline.js"),a=i("./src/utils/logger.js"),o=i("./src/errors.js"),l=i("./src/utils/mediasource-helper.js"),d=i("./src/utils/get-self-scope.js"),u=i("./src/observer.js"),h=d.getSelfScope(),c=l.getMediaSource(),p=function(){function e(t,e){var i=this;this.hls=t,this.id=e;var l=this.observer=new u.Observer,d=t.config,p=function(e,s){(s=s||{}).frag=i.frag,s.id=i.id,t.trigger(e,s)};l.on(n.default.FRAG_DECRYPTED,p),l.on(n.default.FRAG_PARSING_INIT_SEGMENT,p),l.on(n.default.FRAG_PARSING_DATA,p),l.on(n.default.FRAG_PARSED,p),l.on(n.default.ERROR,p),l.on(n.default.FRAG_PARSING_METADATA,p),l.on(n.default.FRAG_PARSING_USERDATA,p),l.on(n.default.INIT_PTS_FOUND,p);var f={mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')},v=window.navigator.vendor;if(d.enableWorker&&"undefined"!=typeof window.Worker){a.logger.log("demuxing in webworker");var g=void 0;try{g=this.w=s("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(e){t.trigger(n.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},g.postMessage({cmd:"init",typeSupported:f,vendor:v,id:e,config:JSON.stringify(d)})}catch(t){a.logger.warn("Error in worker:",t),a.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),g&&h.URL.revokeObjectURL(g.objectURL),this.demuxer=new r.default(l,f,d,v),this.w=void 0}}else this.demuxer=new r.default(l,f,d,v)}return e.prototype.destroy=function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},e.prototype.push=function(e,i,s,n,r,o,l,d){var u=this.w,h=t.isFinite(r.startPTS)?r.startPTS:r.start,c=r.decryptdata,p=this.frag,f=!(p&&r.cc===p.cc),v=!(p&&r.level===p.level),g=p&&r.sn===p.sn+1,_=!v&&g;if(f&&a.logger.log(this.id+":discontinuity detected"),v&&a.logger.log(this.id+":switch detected"),this.frag=r,u)u.postMessage({cmd:"demux",data:e,decryptdata:c,initSegment:i,audioCodec:s,videoCodec:n,timeOffset:h,discontinuity:f,trackSwitch:v,contiguous:_,duration:o,accurateTimeOffset:l,defaultInitPTS:d},e instanceof ArrayBuffer?[e]:[]);else{var E=this.demuxer;E&&E.push(e,c,i,s,n,h,f,v,_,o,l,d)}},e.prototype.onWorkerMessage=function(t){var e=t.data,i=this.hls;switch(e.event){case"init":h.URL.revokeObjectURL(this.w.objectURL);break;case n.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data)}},e}();e.default=p}).call(this,i("./src/polyfills/number.js").Number)},"./src/demux/exp-golomb.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=function(){function t(t){this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,i=t.byteLength-e,s=new Uint8Array(4),n=Math.min(4,e);if(0===n)throw new Error("no bytes available");s.set(t.subarray(i,i+n)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},t.prototype.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},t.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return t>32&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),(e=t-e)>0&&this.bitsAvailable?i<<e|this.readBits(e):i},t.prototype.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.prototype.readBoolean=function(){return 1===this.readBits(1)},t.prototype.readUByte=function(){return this.readBits(8)},t.prototype.readUShort=function(){return this.readBits(16)},t.prototype.readUInt=function(){return this.readBits(32)},t.prototype.skipScalingList=function(t){var e,i=8,s=8;for(e=0;e<t;e++)0!==s&&(s=(i+this.readEG()+256)%256),i=0===s?i:s},t.prototype.readSPS=function(){var t,e,i,s,n,r,a,o=0,l=0,d=0,u=0,h=this.readUByte.bind(this),c=this.readBits.bind(this),p=this.readUEG.bind(this),f=this.readBoolean.bind(this),v=this.skipBits.bind(this),g=this.skipEG.bind(this),_=this.skipUEG.bind(this),E=this.skipScalingList.bind(this);if(h(),t=h(),c(5),v(3),h(),_(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var m=p();if(3===m&&v(1),_(),_(),v(1),f())for(r=3!==m?8:12,a=0;a<r;a++)f()&&E(a<6?16:64)}_();var A=p();if(0===A)p();else if(1===A)for(v(1),g(),g(),e=p(),a=0;a<e;a++)g();_(),v(1),i=p(),s=p(),0===(n=c(1))&&v(1),v(1),f()&&(o=p(),l=p(),d=p(),u=p());var y=[1,1];if(f()&&f())switch(h()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[h()<<8|h(),h()<<8|h()]}return{width:Math.ceil(16*(i+1)-2*o-2*l),height:(2-n)*(s+1)*16-(n?2:4)*(d+u),pixelRatio:y}},t.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}();e.default=n},"./src/demux/id3.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.getID3Data=function(e,i){for(var s=i,n=0;t.isHeader(e,i);)n+=10,n+=t._readSize(e,i+6),t.isFooter(e,i+10)&&(n+=10),i+=n;if(n>0)return e.subarray(s,s+n)},t._readSize=function(t,e){var i=0;return i=(127&t[e])<<21,i|=(127&t[e+1])<<14,(i|=(127&t[e+2])<<7)|127&t[e+3]},t.getTimeStamp=function(e){for(var i=t.getID3Frames(e),s=0;s<i.length;s++){var n=i[s];if(t.isTimeStampFrame(n))return t._readTimeStamp(n)}},t.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},t._getFrameData=function(e){var i=String.fromCharCode(e[0],e[1],e[2],e[3]),s=t._readSize(e,4);return{type:i,size:s,data:e.subarray(10,10+s)}},t.getID3Frames=function(e){for(var i=0,s=[];t.isHeader(e,i);){for(var n=t._readSize(e,i+6),r=(i+=10)+n;i+8<r;){var a=t._getFrameData(e.subarray(i)),o=t._decodeFrame(a);o&&s.push(o),i+=a.size+10}t.isFooter(e,i)&&(i+=10)}return s},t._decodeFrame=function(e){return"PRIV"===e.type?t._decodePrivFrame(e):"T"===e.type[0]?t._decodeTextFrame(e):"W"===e.type[0]?t._decodeURLFrame(e):void 0},t._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),i=1&e[3],s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,i&&(s+=47721858.84),Math.round(s)}},t._decodePrivFrame=function(e){if(!(e.size<2)){var i=t._utf8ArrayToStr(e.data,!0),s=new Uint8Array(e.data.subarray(i.length+1));return{key:e.type,info:i,data:s.buffer}}},t._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var i=1,s=t._utf8ArrayToStr(e.data.subarray(i));i+=s.length+1;var n=t._utf8ArrayToStr(e.data.subarray(i));return{key:e.type,info:s,data:n}}var r=t._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:r}}},t._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var i=1,s=t._utf8ArrayToStr(e.data.subarray(i));i+=s.length+1;var n=t._utf8ArrayToStr(e.data.subarray(i));return{key:e.type,info:s,data:n}}var r=t._utf8ArrayToStr(e.data);return{key:e.type,data:r}},t._utf8ArrayToStr=function(t,e){void 0===e&&(e=!1);for(var i,s,n,r=t.length,a="",o=0;o<r;){if(0===(i=t[o++])&&e)return a;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=t[o++],a+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=t[o++],n=t[o++],a+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&n)<<0)}}return a},t}(),n=s._utf8ArrayToStr;e.utf8ArrayToStr=n,e.default=s},"./src/demux/mp3demuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/demux/id3.js"),n=i("./src/utils/logger.js"),r=i("./src/demux/mpegaudio.js"),a=function(){function t(t,e,i){this.observer=t,this.config=i,this.remuxer=e}return t.prototype.resetInitSegment=function(t,e,i,s){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:s,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){var e,i,a=s.default.getID3Data(t,0);if(a&&void 0!==s.default.getTimeStamp(a))for(e=a.length,i=Math.min(t.length-1,e+100);e<i;e++)if(r.default.probe(t,e))return n.logger.log("MPEG Audio sync word found !"),!0;return!1},t.prototype.append=function(t,e,i,n){for(var a=s.default.getID3Data(t,0),o=s.default.getTimeStamp(a),l=o?90*o:9e4*e,d=a.length,u=t.length,h=0,c=0,p=this._audioTrack,f=[{pts:l,dts:l,data:a}];d<u;)if(r.default.isHeader(t,d)){var v=r.default.appendFrame(p,t,d,l,h);if(!v)break;d+=v.length,c=v.sample.pts,h++}else s.default.isHeader(t,d)?(a=s.default.getID3Data(t,d),f.push({pts:c,dts:c,data:a}),d+=a.length):d++;this.remuxer.remux(p,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},e,i,n)},t.prototype.destroy=function(){},t}();e.default=a},"./src/demux/mp4demuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=i("./src/events.js"),r=Math.pow(2,32)-1,a=function(){function t(t,e){this.observer=t,this.remuxer=e}return t.prototype.resetTimeStamp=function(t){this.initPTS=t},t.prototype.resetInitSegment=function(e,i,s,r){if(e&&e.byteLength){var a=this.initData=t.parseInitSegment(e);null==i&&(i="mp4a.40.5"),null==s&&(s="avc1.42e01e");var o={};a.audio&&a.video?o.audiovideo={container:"video/mp4",codec:i+","+s,initSegment:r?e:null}:(a.audio&&(o.audio={container:"audio/mp4",codec:i,initSegment:r?e:null}),a.video&&(o.video={container:"video/mp4",codec:s,initSegment:r?e:null})),this.observer.trigger(n.default.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else i&&(this.audioCodec=i),s&&(this.videoCodec=s)},t.probe=function(e){return t.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.bin2str=function(t){return String.fromCharCode.apply(null,t)},t.readUint16=function(t,e){t.data&&(e+=t.start,t=t.data);var i=t[e]<<8|t[e+1];return i<0?65536+i:i},t.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var i=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return i<0?4294967296+i:i},t.writeUint32=function(t,e,i){t.data&&(e+=t.start,t=t.data),t[e]=i>>24,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=255&i},t.findBox=function(e,i){var s,n,r,a,o,l,d=[];if(e.data?(o=e.start,r=e.end,e=e.data):(o=0,r=e.byteLength),!i.length)return null;for(s=o;s<r;)l=(n=t.readUint32(e,s))>1?s+n:r,t.bin2str(e.subarray(s+4,s+8))===i[0]&&(1===i.length?d.push({data:e,start:s+8,end:l}):(a=t.findBox({data:e,start:s+8,end:l},i.slice(1))).length&&(d=d.concat(a))),s=l;return d},t.parseSegmentIndex=function(e){var i,s=t.findBox(e,["moov"])[0],n=s?s.end:null,r=0,a=t.findBox(e,["sidx"]);if(!a||!a[0])return null;i=[];var o=(a=a[0]).data[0];r=0===o?8:16;var l=t.readUint32(a,r);r+=4,r+=0===o?8:16,r+=2;var d=a.end+0,u=t.readUint16(a,r);r+=2;for(var h=0;h<u;h++){var c=r,p=t.readUint32(a,c);c+=4;var f=2147483647&p;if(1==(2147483648&p)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var v=t.readUint32(a,c);c+=4,i.push({referenceSize:f,subsegmentDuration:v,info:{duration:v/l,start:d,end:d+f-1}}),d+=f,r=c+=4}return{earliestPresentationTime:0,timescale:l,version:o,referencesCount:u,references:i,moovEndOffset:n}},t.parseInitSegment=function(e){var i=[];return t.findBox(e,["moov","trak"]).forEach(function(e){var n=t.findBox(e,["tkhd"])[0];if(n){var r=n.data[n.start],a=0===r?12:20,o=t.readUint32(n,a),l=t.findBox(e,["mdia","mdhd"])[0];if(l){a=0===(r=l.data[l.start])?12:20;var d=t.readUint32(l,a),u=t.findBox(e,["mdia","hdlr"])[0];if(u){var h={soun:"audio",vide:"video"}[t.bin2str(u.data.subarray(u.start+8,u.start+12))];if(h){var c=t.findBox(e,["mdia","minf","stbl","stsd"]);if(c.length){c=c[0];var p=t.bin2str(c.data.subarray(c.start+12,c.start+16));s.logger.log("MP4Demuxer:"+h+":"+p+" found")}i[o]={timescale:d,type:h},i[h]={timescale:d,id:o}}}}}}),i},t.getStartDTS=function(e,i){var s,n,r;return s=t.findBox(i,["moof","traf"]),n=[].concat.apply([],s.map(function(i){return t.findBox(i,["tfhd"]).map(function(s){var n,r;return n=t.readUint32(s,4),r=e[n].timescale||9e4,t.findBox(i,["tfdt"]).map(function(e){var i,s;return i=e.data[e.start],s=t.readUint32(e,4),1===i&&(s*=Math.pow(2,32),s+=t.readUint32(e,8)),s})[0]/r})})),r=Math.min.apply(null,n),window.isFinite(r)?r:0},t.offsetStartDTS=function(e,i,s){t.findBox(i,["moof","traf"]).map(function(i){return t.findBox(i,["tfhd"]).map(function(n){var a=t.readUint32(n,4),o=e[a].timescale||9e4;t.findBox(i,["tfdt"]).map(function(e){var i=e.data[e.start],n=t.readUint32(e,4);if(0===i)t.writeUint32(e,4,n-s*o);else{n*=Math.pow(2,32),n+=t.readUint32(e,8),n-=s*o,n=Math.max(n,0);var a=Math.floor(n/(r+1)),l=Math.floor(n%(r+1));t.writeUint32(e,4,a),t.writeUint32(e,8,l)}})})})},t.prototype.append=function(e,i,s,r){var a=this.initData;a||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),a=this.initData);var o,l=this.initPTS;if(void 0===l){var d=t.getStartDTS(a,e);this.initPTS=l=d-i,this.observer.trigger(n.default.INIT_PTS_FOUND,{initPTS:l})}t.offsetStartDTS(a,e,l),o=t.getStartDTS(a,e),this.remuxer.remux(a.audio,a.video,null,null,o,s,r,e)},t.prototype.destroy=function(){},t}();e.default=a},"./src/demux/mpegaudio.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,i,s,n){if(!(i+24>e.length)){var r=this.parseHeader(e,i);if(r&&i+r.frameLength<=e.length){var a=s+n*(9e4*r.samplesPerFrame/r.sampleRate),o={unit:e.subarray(i,i+r.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=r.channelCount,t.samplerate=r.sampleRate,t.samples.push(o),t.len+=r.frameLength,{sample:o,length:r.frameLength}}}},parseHeader:function(t,e){var i=t[e+1]>>3&3,n=t[e+1]>>1&3,r=t[e+2]>>4&15,a=t[e+2]>>2&3,o=t[e+2]>>1&1;if(1!==i&&0!==r&&15!==r&&3!==a){var l=3===i?3-n:3===n?3:4,d=1e3*s.BitratesMap[14*l+r-1],u=3===i?0:2===i?1:2,h=s.SamplingRateMap[3*u+a],c=t[e+3]>>6==3?1:2,p=s.SamplesCoefficients[i][n],f=s.BytesInSlot[n],v=8*p*f;return{sampleRate:h,channelCount:c,frameLength:window.parseInt(p*d/h+o,10)*f,samplesPerFrame:v}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var i=this.parseHeader(t,e),s=4;i&&i.frameLength&&(s=i.frameLength);var n=e+s;if(n===t.length||n+1<t.length&&this.isHeaderPattern(t,n))return!0}return!1}};e.default=s},"./src/demux/sample-aes.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/crypt/decrypter.js"),n=function(){function t(t,e,i,n){this.decryptdata=i,this.discardEPB=n,this.decrypter=new s.default(t,e,{removePKCS7Padding:!1})}return t.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},t.prototype.decryptAacSample=function(t,e,i,s){var n=t[e].unit,r=n.subarray(16,n.length-n.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length),o=this;this.decryptBuffer(a,function(r){r=new Uint8Array(r),n.set(r,16),s||o.decryptAacSamples(t,e+1,i)})},t.prototype.decryptAacSamples=function(t,e,i){for(;;e++){if(e>=t.length)return void i();if(!(t[e].unit.length<32)){var s=this.decrypter.isSync();if(this.decryptAacSample(t,e,i,s),!s)return}}},t.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(e),s=0,n=32;n<=t.length-16;n+=160,s+=16)i.set(t.subarray(n,n+16),s);return i},t.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var i=0,s=32;s<=t.length-16;s+=160,i+=16)t.set(e.subarray(i,i+16),s);return t},t.prototype.decryptAvcSample=function(t,e,i,s,n,r){var a=this.discardEPB(n.data),o=this.getAvcEncryptedData(a),l=this;this.decryptBuffer(o.buffer,function(o){n.data=l.getAvcDecryptedUnit(a,o),r||l.decryptAvcSamples(t,e,i+1,s)})},t.prototype.decryptAvcSamples=function(t,e,i,s){for(;;e++,i=0){if(e>=t.length)return void s();for(var n=t[e].units;!(i>=n.length);i++){var r=n[i];if(!(r.length<=48||1!==r.type&&5!==r.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(t,e,i,s,r,a),!a)return}}}},t}();e.default=n},"./src/demux/tsdemuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/demux/adts.js"),n=i("./src/demux/mpegaudio.js"),r=i("./src/events.js"),a=i("./src/demux/exp-golomb.js"),o=i("./src/demux/sample-aes.js"),l=i("./src/utils/logger.js"),d=i("./src/errors.js"),u={video:1,audio:2,id3:3,text:4},h=function(){function t(t,e,i,s){this.observer=t,this.config=i,this.typeSupported=s,this.remuxer=e,this.sampleAes=null}return t.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new o.default(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},t.probe=function(e){var i=t._syncOffset(e);return!(i<0||(i&&l.logger.warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),0))},t._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),i=0;i<e;){if(71===t[i]&&71===t[i+188]&&71===t[i+376])return i;i++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:u[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},t.prototype.resetInitSegment=function(e,i,s,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",n),this._audioTrack=t.createTrack("audio",n),this._id3Track=t.createTrack("id3",n),this._txtTrack=t.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=s,this._duration=n},t.prototype.resetTimeStamp=function(){},t.prototype.append=function(e,i,s,n){var a,o,u,h,c,p=e.length,f=!1;this.contiguous=s;var v=this.pmtParsed,g=this._avcTrack,_=this._audioTrack,E=this._id3Track,m=g.pid,A=_.pid,y=E.pid,S=this._pmtId,b=g.pesData,T=_.pesData,D=E.pesData,I=this._parsePAT,C=this._parsePMT,R=this._parsePES,P=this._parseAVCPES.bind(this),M=this._parseAACPES.bind(this),O=this._parseMPEGPES.bind(this),L=this._parseID3PES.bind(this),N=t._syncOffset(e);for(p-=(p+N)%188,a=N;a<p;a+=188)if(71===e[a]){if(o=!!(64&e[a+1]),u=((31&e[a+1])<<8)+e[a+2],(48&e[a+3])>>4>1){if((h=a+5+e[a+4])===a+188)continue}else h=a+4;switch(u){case m:o&&(b&&(c=R(b))&&void 0!==c.pts&&P(c,!1),b={data:[],size:0}),b&&(b.data.push(e.subarray(h,a+188)),b.size+=a+188-h);break;case A:o&&(T&&(c=R(T))&&void 0!==c.pts&&(_.isAAC?M(c):O(c)),T={data:[],size:0}),T&&(T.data.push(e.subarray(h,a+188)),T.size+=a+188-h);break;case y:o&&(D&&(c=R(D))&&void 0!==c.pts&&L(c),D={data:[],size:0}),D&&(D.data.push(e.subarray(h,a+188)),D.size+=a+188-h);break;case 0:o&&(h+=e[h]+1),S=this._pmtId=I(e,h);break;case S:o&&(h+=e[h]+1);var k=C(e,h,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(m=k.avc)>0&&(g.pid=m),(A=k.audio)>0&&(_.pid=A,_.isAAC=k.isAAC),(y=k.id3)>0&&(E.pid=y),f&&!v&&(l.logger.log("reparse from beginning"),f=!1,a=N-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:f=!0}}else this.observer.trigger(r.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});b&&(c=R(b))&&void 0!==c.pts?(P(c,!0),g.pesData=null):g.pesData=b,T&&(c=R(T))&&void 0!==c.pts?(_.isAAC?M(c):O(c),_.pesData=null):(T&&T.size&&l.logger.log("last AAC PES packet truncated,might overlap between fragments"),_.pesData=T),D&&(c=R(D))&&void 0!==c.pts?(L(c),E.pesData=null):E.pesData=D,null==this.sampleAes?this.remuxer.remux(_,g,E,this._txtTrack,i,s,n):this.decryptAndRemux(_,g,E,this._txtTrack,i,s,n)},t.prototype.decryptAndRemux=function(t,e,i,s,n,r,a){if(t.samples&&t.isAAC){var o=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){o.decryptAndRemuxAvc(t,e,i,s,n,r,a)})}else this.decryptAndRemuxAvc(t,e,i,s,n,r,a)},t.prototype.decryptAndRemuxAvc=function(t,e,i,s,n,r,a){if(e.samples){var o=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){o.remuxer.remux(t,e,i,s,n,r,a)})}else this.remuxer.remux(t,e,i,s,n,r,a)},t.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},t.prototype._parsePMT=function(t,e,i,s){var n,r,a={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=e+3+((15&t[e+1])<<8|t[e+2])-4,e+=12+((15&t[e+10])<<8|t[e+11]);e<n;){switch(r=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!s){l.logger.log("unkown stream type:"+t[e]);break}case 15:-1===a.audio&&(a.audio=r);break;case 21:-1===a.id3&&(a.id3=r);break;case 219:if(!s){l.logger.log("unkown stream type:"+t[e]);break}case 27:-1===a.avc&&(a.avc=r);break;case 3:case 4:i?-1===a.audio&&(a.audio=r,a.isAAC=!1):l.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:l.logger.warn("HEVC stream type found, not supported for now");break;default:l.logger.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return a},t.prototype._parsePES=function(t){var e,i,s,n,r,a,o,d,u=0,h=t.data;if(!t||0===t.size)return null;for(;h[0].length<19&&h.length>1;){var c=new Uint8Array(h[0].length+h[1].length);c.set(h[0]),c.set(h[1],h[0].length),h[0]=c,h.splice(1,1)}if(1===((e=h[0])[0]<<16)+(e[1]<<8)+e[2]){if((s=(e[4]<<8)+e[5])&&s>t.size-6)return null;192&(i=e[7])&&((a=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2)>4294967295&&(a-=8589934592),64&i?((o=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>4294967295&&(o-=8589934592),a-o>54e5&&(l.logger.warn(Math.round((a-o)/9e4)+"s delta between PTS and DTS, align them"),a=o)):o=a),d=(n=e[8])+9,t.size-=d,r=new Uint8Array(t.size);for(var p=0,f=h.length;p<f;p++){var v=(e=h[p]).byteLength;if(d){if(d>v){d-=v;continue}e=e.subarray(d),v-=d,d=0}r.set(e,u),u+=v}return s&&(s-=n+3),{data:r,pts:a,dts:o,len:s}}return null},t.prototype.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var i=e.samples,s=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(s||this.contiguous)?(t.id=s,i.push(t)):e.dropped++}t.debug.length&&l.logger.log(t.pts+"/"+t.dts+":"+t.debug)},t.prototype._parseAVCPES=function(t,e){var i,s,n,r=this,o=this._avcTrack,l=this._parseAVCNALu(t.data),d=this.avcSample,u=!1,h=this.pushAccesUnit.bind(this),c=function(t,e,i,s){return{key:t,pts:e,dts:i,units:[],debug:s}};t.data=null,d&&l.length&&!o.audFound&&(h(d,o),d=this.avcSample=c(!1,t.pts,t.dts,"")),l.forEach(function(e){switch(e.type){case 1:s=!0,d||(d=r.avcSample=c(!0,t.pts,t.dts,"")),d.frame=!0;var l=e.data;if(u&&l.length>4){var p=new a.default(l).readSliceType();2!==p&&4!==p&&7!==p&&9!==p||(d.key=!0)}break;case 5:s=!0,d||(d=r.avcSample=c(!0,t.pts,t.dts,"")),d.key=!0,d.frame=!0;break;case 6:s=!0,(i=new a.default(r.discardEPB(e.data))).readUByte();for(var f=0,v=0,g=!1,_=0;!g&&i.bytesAvailable>1;){f=0;do{f+=_=i.readUByte()}while(255===_);v=0;do{v+=_=i.readUByte()}while(255===_);if(4===f&&0!==i.bytesAvailable){if(g=!0,181===i.readUByte()&&49===i.readUShort()&&1195456820===i.readUInt()&&3===i.readUByte()){var E=i.readUByte(),m=31&E,A=[E,i.readUByte()];for(n=0;n<m;n++)A.push(i.readUByte()),A.push(i.readUByte()),A.push(i.readUByte());r._insertSampleInOrder(r._txtTrack.samples,{type:3,pts:t.pts,bytes:A})}}else if(v<i.bytesAvailable)for(n=0;n<v;n++)i.readUByte()}break;case 7:if(s=!0,u=!0,!o.sps){var y=(i=new a.default(e.data)).readSPS();o.width=y.width,o.height=y.height,o.pixelRatio=y.pixelRatio,o.sps=[e.data],o.duration=r._duration;var S=e.data.subarray(1,4),b="avc1.";for(n=0;n<3;n++){var T=S[n].toString(16);T.length<2&&(T="0"+T),b+=T}o.codec=b}break;case 8:s=!0,o.pps||(o.pps=[e.data]);break;case 9:s=!1,o.audFound=!0,d&&h(d,o),d=r.avcSample=c(!1,t.pts,t.dts,"");break;case 12:s=!1;break;default:s=!1,d&&(d.debug+="unknown NAL "+e.type+" ")}d&&s&&d.units.push(e)}),e&&d&&(h(d,o),this.avcSample=null)},t.prototype._insertSampleInOrder=function(t,e){var i=t.length;if(i>0){if(e.pts>=t[i-1].pts)t.push(e);else for(var s=i-1;s>=0;s--)if(e.pts<t[s].pts){t.splice(s,0,e);break}}else t.push(e)},t.prototype._getLastNalUnit=function(){var t,e=this.avcSample;if(!e||0===e.units.length){var i=this._avcTrack.samples;e=i[i.length-1]}if(e){var s=e.units;t=s[s.length-1]}return t},t.prototype._parseAVCNALu=function(t){var e,i,s,n,r=0,a=t.byteLength,o=this._avcTrack,l=o.naluState||0,d=l,u=[],h=-1;for(-1===l&&(h=0,n=31&t[0],l=0,r=1);r<a;)if(e=t[r++],l)if(1!==l)if(e)if(1===e){var c,p;h>=0?(s={data:t.subarray(h,r-l-1),type:n},u.push(s)):(c=this._getLastNalUnit())&&(d&&r<=4-d&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-d)),(i=r-l-1)>0)&&((p=new Uint8Array(c.data.byteLength+i)).set(c.data,0),p.set(t.subarray(0,i),c.data.byteLength),c.data=p),r<a?(h=r,n=31&t[r],l=0):l=-1}else l=0;else l=3;else l=e?0:2;else l=e?0:1;return h>=0&&l>=0&&(s={data:t.subarray(h,a),type:n,state:l},u.push(s)),0===u.length&&(c=this._getLastNalUnit())&&((p=new Uint8Array(c.data.byteLength+t.byteLength)).set(c.data,0),p.set(t,c.data.byteLength),c.data=p),o.naluState=l,u},t.prototype.discardEPB=function(t){for(var e,i,s=t.byteLength,n=[],r=1;r<s-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return t;e=s-n.length,i=new Uint8Array(e);var a=0;for(r=0;r<e;a++,r++)a===n[0]&&(a++,n.shift()),i[r]=t[a];return i},t.prototype._parseAACPES=function(t){var e,i,n,a,o,u=this._audioTrack,h=t.data,c=t.pts,p=this.aacOverFlow,f=this.aacLastPTS;if(p){var v=new Uint8Array(p.byteLength+h.byteLength);v.set(p,0),v.set(h,p.byteLength),h=v}for(n=0,o=h.length;n<o-1&&!s.isHeader(h,n);n++);if(n){var g=void 0,_=void 0;if(n<o-1?(g="AAC PES did not start with ADTS header,offset:"+n,_=!1):(g="no ADTS header found in AAC PES",_=!0),l.logger.warn("parsing error:"+g),this.observer.trigger(r.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:_,reason:g}),_)return}if(s.initTrackConfig(u,this.observer,h,n,this.audioCodec),i=0,e=s.getFrameDuration(u.samplerate),p&&f){var E=f+e;Math.abs(E-c)>1&&(l.logger.log("AAC: align PTS for overlapping frames by "+Math.round((E-c)/90)),c=E)}for(;n<o;)if(s.isHeader(h,n)&&n+5<o){var m=s.appendFrame(u,h,n,c,i);if(!m)break;n+=m.length,a=m.sample.pts,i++}else n++;p=n<o?h.subarray(n,o):null,this.aacOverFlow=p,this.aacLastPTS=a},t.prototype._parseMPEGPES=function(t){for(var e=t.data,i=e.length,s=0,r=0,a=t.pts;r<i;)if(n.default.isHeader(e,r)){var o=n.default.appendFrame(this._audioTrack,e,r,a,s);if(!o)break;r+=o.length,s++}else r++},t.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},t}();e.default=h},"./src/errors.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},e.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=i("./src/errors.js"),r=i("./src/events.js"),a={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},o=function(){function t(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.hls=t,this.onEvent=this.onEvent.bind(this),this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}return t.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.prototype.onHandlerDestroying=function(){},t.prototype.onHandlerDestroyed=function(){},t.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if(a[t])throw new Error("Forbidden event-name: "+t);this.hls.on(t,this.onEvent)},this)},t.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},t.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},t.prototype.onEventGeneric=function(t,e){try{(function(t,e){var i="on"+t.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,e)}).call(this,t,e).call()}catch(e){s.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(r.default.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},t}();e.default=o},"./src/events.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},"./src/hls.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./node_modules/url-toolkit/src/url-toolkit.js"),r=i("./src/errors.js"),a=i("./src/loader/playlist-loader.js"),o=i("./src/loader/fragment-loader.js"),l=i("./src/loader/key-loader.js"),d=i("./src/controller/fragment-tracker.js"),u=i("./src/controller/stream-controller.js"),h=i("./src/controller/level-controller.js"),c=i("./src/controller/id3-track-controller.js"),p=i("./src/is-supported.js"),f=i("./src/utils/logger.js"),v=i("./src/config.js"),g=i("./src/events.js"),_=function(t){function e(i){void 0===i&&(i={});var s=t.call(this)||this,n=e.DefaultConfig;if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var r in n)r in i||(i[r]=n[r]);if(void 0!==i.liveMaxLatencyDurationCount&&i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(i.liveMaxLatencyDuration<=i.liveSyncDuration||void 0===i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');f.enableLogs(i.debug),s.config=i,s._autoLevelCapping=-1;var p=s.abrController=new i.abrController(s),v=new i.bufferController(s),g=new i.capLevelController(s),_=new i.fpsController(s),E=new a.default(s),m=new o.default(s),A=new l.default(s),y=new c.default(s),S=s.levelController=new h.default(s),b=new d.FragmentTracker(s),T=[S,s.streamController=new u.default(s,b)],D=i.audioStreamController;D&&T.push(new D(s,b)),s.networkControllers=T;var I=[E,m,A,p,v,g,_,y,b];if(D=i.audioTrackController){var C=new D(s);s.audioTrackController=C,I.push(C)}if(D=i.subtitleTrackController){var R=new D(s);s.subtitleTrackController=R,T.push(R)}if(D=i.emeController){var P=new D(s);s.emeController=P,I.push(P)}return(D=i.subtitleStreamController)&&T.push(new D(s,b)),(D=i.timelineController)&&I.push(new D(s)),s.coreComponents=I,s}return s(e,t),Object.defineProperty(e,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),e.isSupported=function(){return p.isSupported()},Object.defineProperty(e,"Events",{get:function(){return g.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ErrorTypes",{get:function(){return r.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ErrorDetails",{get:function(){return r.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DefaultConfig",{get:function(){return e.defaultConfig?e.defaultConfig:v.hlsDefaultConfig},set:function(t){e.defaultConfig=t},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){f.logger.log("destroy"),this.trigger(g.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},e.prototype.attachMedia=function(t){f.logger.log("attachMedia"),this.media=t,this.trigger(g.default.MEDIA_ATTACHING,{media:t})},e.prototype.detachMedia=function(){f.logger.log("detachMedia"),this.trigger(g.default.MEDIA_DETACHING),this.media=null},e.prototype.loadSource=function(t){t=n.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),f.logger.log("loadSource:"+t),this.url=t,this.trigger(g.default.MANIFEST_LOADING,{url:t})},e.prototype.startLoad=function(t){void 0===t&&(t=-1),f.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},e.prototype.stopLoad=function(){f.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},e.prototype.swapAudioCodec=function(){f.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.prototype.recoverMediaError=function(){f.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},Object.defineProperty(e.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(t){f.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(t){f.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(t){f.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){f.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(t){f.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(t){f.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minAutoLevel",{get:function(){for(var t=this.levels,e=this.config.minAutoBitrate,i=t?t.length:0,s=0;s<i;s++)if((t[s].realBitrate?Math.max(t[s].realBitrate,t[s].bitrate):t[s].bitrate)>e)return s;return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAutoLevel",{get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextAutoLevel",{get:function(){var t=this;return Math.min(Math.max(t.abrController.nextAutoLevel,t.minAutoLevel),t.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioTracks",{get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioTrack",{get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subtitleTracks",{get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subtitleTrack",{get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subtitleDisplay",{get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)},enumerable:!0,configurable:!0}),e}(i("./src/observer.js").Observer);e.default=_},"./src/is-supported.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/mediasource-helper.js");e.isSupported=function(){var t=s.getMediaSource(),e=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!i&&!!n}},"./src/loader/fragment-loader.js":function(t,e,i){"use strict";(function(t){var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=function(e){function i(t){var i=e.call(this,t,n.default.FRAG_LOADING)||this;return i.loaders={},i}return s(i,e),i.prototype.destroy=function(){var t=this.loaders;for(var i in t){var s=t[i];s&&s.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.prototype.onFragLoading=function(e){var i=e.frag,s=i.type,n=this.loaders,r=this.hls.config,a=r.fLoader,l=r.loader;i.loaded=0;var d,u,h,c=n[s];c&&(o.logger.warn("abort previous fragment loader for type: "+s),c.abort()),c=n[s]=i.loader=r.fLoader?new a(r):new l(r),d={url:i.url,frag:i,responseType:"arraybuffer",progressData:!1};var p=i.byteRangeStartOffset,f=i.byteRangeEndOffset;t.isFinite(p)&&t.isFinite(f)&&(d.rangeStart=p,d.rangeEnd=f),u={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},c.load(d,u,h)},i.prototype.loadsuccess=function(t,e,i,s){void 0===s&&(s=null);var r=t.data,a=i.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(n.default.FRAG_LOADED,{payload:r,frag:a,stats:e,networkDetails:s})},i.prototype.loaderror=function(t,e,i){void 0===i&&(i=null);var s=e.frag,r=s.loader;r&&r.abort(),this.loaders[s.type]=void 0,this.hls.trigger(n.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:i})},i.prototype.loadtimeout=function(t,e,i){void 0===i&&(i=null);var s=e.frag,r=s.loader;r&&r.abort(),this.loaders[s.type]=void 0,this.hls.trigger(n.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:i})},i.prototype.loadprogress=function(t,e,i,s){void 0===s&&(s=null);var r=e.frag;r.loaded=t.loaded,this.hls.trigger(n.default.FRAG_LOAD_PROGRESS,{frag:r,stats:t,networkDetails:s})},i}(r.default);e.default=l}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/fragment.js":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var s=i("./node_modules/url-toolkit/src/url-toolkit.js"),n=i("./src/loader/level-key.js"),r=function(){function e(){var t;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=((t={})[e.ElementaryStreamTypes.AUDIO]=!1,t[e.ElementaryStreamTypes.VIDEO]=!1,t)}return Object.defineProperty(e,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=s.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var t=[];if(this.rawByteRange){var e=this.rawByteRange.split("@",2);if(1===e.length){var i=this.lastByteRangeEndOffset;t[0]=i||0}else t[0]=window.parseInt(e[1]);t[1]=window.parseInt(e[0])+t[0],this._byteRange=t}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endProgramDateTime",{get:function(){if(!t.isFinite(this.programDateTime))return null;var e=t.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),e.prototype.addElementaryStream=function(t){this._elementaryStreams[t]=!0},e.prototype.hasElementaryStream=function(t){return!0===this._elementaryStreams[t]},e.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e},e.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var i=t;return t&&t.method&&t.uri&&!t.iv&&((i=new n.default).method=t.method,i.baseuri=t.baseuri,i.reluri=t.reluri,i.iv=this.createInitializationVector(e)),i},e}();e.default=r}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/key-loader.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=function(t){function e(e){var i=t.call(this,e,n.default.KEY_LOADING)||this;return i.loaders={},i.decryptkey=null,i.decrypturl=null,i}return s(e,t),e.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},r.default.prototype.destroy.call(this)},e.prototype.onKeyLoading=function(t){var e=t.frag,i=e.type,s=this.loaders[i],r=e.decryptdata,a=r.uri;if(a!==this.decrypturl||null===this.decryptkey){var l,d,u,h=this.hls.config;s&&(o.logger.warn("abort previous key loader for type:"+i),s.abort()),e.loader=this.loaders[i]=new h.loader(h),this.decrypturl=a,this.decryptkey=null,l={url:a,frag:e,responseType:"arraybuffer"},d={timeout:h.fragLoadingTimeOut,maxRetry:0,retryDelay:h.fragLoadingRetryDelay,maxRetryDelay:h.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},e.loader.load(l,d,u)}else this.decryptkey&&(r.key=this.decryptkey,this.hls.trigger(n.default.KEY_LOADED,{frag:e}))},e.prototype.loadsuccess=function(t,e,i){var s=i.frag;this.decryptkey=s.decryptdata.key=new Uint8Array(t.data),s.loader=void 0,this.loaders[s.type]=void 0,this.hls.trigger(n.default.KEY_LOADED,{frag:s})},e.prototype.loaderror=function(t,e){var i=e.frag,s=i.loader;s&&s.abort(),this.loaders[e.type]=void 0,this.hls.trigger(n.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:t})},e.prototype.loadtimeout=function(t,e){var i=e.frag,s=i.loader;s&&s.abort(),this.loaders[e.type]=void 0,this.hls.trigger(n.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},e}(r.default);e.default=l},"./src/loader/level-key.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./node_modules/url-toolkit/src/url-toolkit.js"),n=function(){function t(){this.method=null,this.key=null,this.iv=null,this._uri=null}return Object.defineProperty(t.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=s.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),t}();e.default=n},"./src/loader/level.js":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(t){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=t,this.version=null}return Object.defineProperty(e.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!t.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),e}();e.default=i}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/m3u8-parser.js":function(t,e,i){"use strict";(function(t){function s(e,i){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):i&&i.programDateTime&&(e.programDateTime=i.endProgramDateTime),t.isFinite(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}Object.defineProperty(e,"__esModule",{value:!0});var n=i("./node_modules/url-toolkit/src/url-toolkit.js"),r=i("./src/loader/fragment.js"),a=i("./src/loader/level.js"),o=i("./src/loader/level-key.js"),l=i("./src/utils/attr-list.js"),d=i("./src/utils/logger.js"),u=i("./src/utils/codecs.js"),h=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,c=/#EXT-X-MEDIA:(.*)/g,p=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),f=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,v=/\.(mp4|m4s|m4v|m4a)$/i,g=function(){function e(){}return e.findGroup=function(t,e){if(!t)return null;for(var i=null,s=0;s<t.length;s++){var n=t[s];n.id===e&&(i=n)}return i},e.convertAVC1ToAVCOTI=function(t){var e,i=t.split(".");return i.length>2?(e=i.shift()+".",e+=window.parseInt(i.shift()).toString(16),e+=("000"+window.parseInt(i.shift()).toString(16)).substr(-4)):e=t,e},e.resolve=function(t,e){return n.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,i){function s(t,e){["video","audio"].forEach(function(i){var s=t.filter(function(t){return u.isCodecType(t,i)});if(s.length){var n=s.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)});e[i+"Codec"]=n.length>0?n[0]:s[0],t=t.filter(function(t){return-1===s.indexOf(t)})}}),e.unknownCodecs=t}var n,r=[];for(h.lastIndex=0;null!=(n=h.exec(t));){var a={},o=a.attrs=new l.default(n[1]);a.url=e.resolve(n[2],i);var d=o.decimalResolution("RESOLUTION");d&&(a.width=d.width,a.height=d.height),a.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),a.name=o.NAME,s([].concat((o.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=e.convertAVC1ToAVCOTI(a.videoCodec)),r.push(a)}return r},e.parseMasterPlaylistMedia=function(t,i,s,n){void 0===n&&(n=[]);var r,a=[],o=0;for(c.lastIndex=0;null!==(r=c.exec(t));){var d={},u=new l.default(r[1]);if(u.TYPE===s){if(d.groupId=u["GROUP-ID"],d.name=u.NAME,d.type=s,d.default="YES"===u.DEFAULT,d.autoselect="YES"===u.AUTOSELECT,d.forced="YES"===u.FORCED,u.URI&&(d.url=e.resolve(u.URI,i)),d.lang=u.LANGUAGE,d.name||(d.name=d.lang),n.length){var h=e.findGroup(n,d.groupId);d.audioCodec=h?h.codec:n[0].codec}d.id=o++,a.push(d)}}return a},e.parseLevelPlaylist=function(e,i,n,u,h){var c,g,_=0,E=0,m=new a.default(i),A=new o.default,y=0,S=null,b=new r.default,T=null;for(p.lastIndex=0;null!==(c=p.exec(e));){var D=c[1];if(D){b.duration=window.parseFloat(D);var I=(" "+c[2]).slice(1);b.title=I||null,b.tagList.push(I?["INF",D,I]:["INF",D])}else if(c[3]){if(t.isFinite(b.duration)){var C=_++;b.type=u,b.start=E,b.levelkey=A,b.sn=C,b.level=n,b.cc=y,b.urlId=h,b.baseurl=i,b.relurl=(" "+c[3]).slice(1),s(b,S),m.fragments.push(b),S=b,E+=b.duration,b=new r.default}}else if(c[4]){if(b.rawByteRange=(" "+c[4]).slice(1),S){var R=S.byteRangeEndOffset;R&&(b.lastByteRangeEndOffset=R)}}else if(c[5])b.rawProgramDateTime=(" "+c[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),null===T&&(T=m.fragments.length);else{for(c=c[0].match(f),g=1;g<c.length&&void 0===c[g];g++);var P=(" "+c[g+1]).slice(1),M=(" "+c[g+2]).slice(1);switch(c[g]){case"#":b.tagList.push(M?[P,M]:[P]);break;case"PLAYLIST-TYPE":m.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":_=m.startSN=window.parseInt(P);break;case"TARGETDURATION":m.targetduration=window.parseFloat(P);break;case"VERSION":m.version=window.parseInt(P);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"DIS":y++,b.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":y=window.parseInt(P);break;case"KEY":var O=P,L=new l.default(O),N=L.enumeratedString("METHOD"),k=L.URI,w=L.hexadecimalInteger("IV");N&&(A=new o.default,k&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(N)>=0&&(A.method=N,A.baseuri=i,A.reluri=k,A.key=null,A.iv=w));break;case"START":var U=P,B=new l.default(U).decimalFloatingPoint("TIME-OFFSET");t.isFinite(B)&&(m.startTimeOffset=B);break;case"MAP":var j=new l.default(P);b.relurl=j.URI,b.rawByteRange=j.BYTERANGE,b.baseurl=i,b.level=n,b.type=u,b.sn="initSegment",m.initSegment=b,(b=new r.default).rawProgramDateTime=m.initSegment.rawProgramDateTime;break;default:d.logger.warn("line parsed but not handled: "+c)}}}return(b=S)&&!b.relurl&&(m.fragments.pop(),E-=b.duration),m.totalduration=E,m.averagetargetduration=E/m.fragments.length,m.endSN=_-1,m.startCC=m.fragments[0]?m.fragments[0].cc:0,m.endCC=y,!m.initSegment&&m.fragments.length&&m.fragments.every(function(t){return v.test(t.relurl)})&&(d.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(b=new r.default).relurl=m.fragments[0].relurl,b.baseurl=i,b.level=n,b.type=u,b.sn="initSegment",m.initSegment=b,m.needSidxRanges=!0),T&&function(t,e){for(var i=t[e],s=e-1;s>=0;s--){var n=t[s];n.programDateTime=i.programDateTime-1e3*n.duration,i=n}}(m.fragments,T),m},e}();e.default=g}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/playlist-loader.js":function(t,e,i){"use strict";(function(t){var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/events.js"),r=i("./src/event-handler.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=i("./src/demux/mp4demuxer.js"),d=i("./src/loader/m3u8-parser.js"),u=window.performance,h={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},c={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},p=function(e){function i(t){var i=e.call(this,t,n.default.MANIFEST_LOADING,n.default.LEVEL_LOADING,n.default.AUDIO_TRACK_LOADING,n.default.SUBTITLE_TRACK_LOADING)||this;return i.loaders={},i}return s(i,e),Object.defineProperty(i,"ContextType",{get:function(){return h},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LevelType",{get:function(){return c},enumerable:!0,configurable:!0}),i.canHaveQualityLevels=function(t){return t!==h.AUDIO_TRACK&&t!==h.SUBTITLE_TRACK},i.mapContextToLevelType=function(t){switch(t.type){case h.AUDIO_TRACK:return c.AUDIO;case h.SUBTITLE_TRACK:return c.SUBTITLE;default:return c.MAIN}},i.getResponseUrl=function(t,e){var i=t.url;return void 0!==i&&0!==i.indexOf("data:")||(i=e.url),i},i.prototype.createInternalLoader=function(t){var e=this.hls.config,i=e.pLoader,s=e.loader,n=new(i||s)(e);return t.loader=n,this.loaders[t.type]=n,n},i.prototype.getInternalLoader=function(t){return this.loaders[t.type]},i.prototype.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},i.prototype.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},i.prototype.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},i.prototype.onManifestLoading=function(t){this.load(t.url,{type:h.MANIFEST,level:0,id:null})},i.prototype.onLevelLoading=function(t){this.load(t.url,{type:h.LEVEL,level:t.level,id:t.id})},i.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:h.AUDIO_TRACK,level:null,id:t.id})},i.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:h.SUBTITLE_TRACK,level:null,id:t.id})},i.prototype.load=function(t,e){var i=this.hls.config;o.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var s,n,r,a,l=this.getInternalLoader(e);if(l){var d=l.context;if(d&&d.url===t)return o.logger.trace("playlist request ongoing"),!1;o.logger.warn("aborting previous loader for type: "+e.type),l.abort()}switch(e.type){case h.MANIFEST:s=i.manifestLoadingMaxRetry,n=i.manifestLoadingTimeOut,r=i.manifestLoadingRetryDelay,a=i.manifestLoadingMaxRetryTimeout;break;case h.LEVEL:s=0,n=i.levelLoadingTimeOut;break;default:s=i.levelLoadingMaxRetry,n=i.levelLoadingTimeOut,r=i.levelLoadingRetryDelay,a=i.levelLoadingMaxRetryTimeout}l=this.createInternalLoader(e),e.url=t,e.responseType=e.responseType||"";var u={timeout:n,maxRetry:s,retryDelay:r,maxRetryDelay:a},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return o.logger.debug("Calling internal loader delegate for URL: "+t),l.load(e,u,c),!0},i.prototype.loadsuccess=function(t,e,i,s){if(void 0===s&&(s=null),i.isSidxRequest)return this._handleSidxRequest(t,i),void this._handlePlaylistLoaded(t,e,i,s);this.resetInternalLoader(i.type);var n=t.data;e.tload=u.now(),0===n.indexOf("#EXTM3U")?n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(t,e,i,s):this._handleMasterPlaylist(t,e,i,s):this._handleManifestParsingError(t,i,"no EXTM3U delimiter",s)},i.prototype.loaderror=function(t,e,i){void 0===i&&(i=null),this._handleNetworkError(e,i,!1,t)},i.prototype.loadtimeout=function(t,e,i){void 0===i&&(i=null),this._handleNetworkError(e,i,!0)},i.prototype._handleMasterPlaylist=function(t,e,s,r){var a=this.hls,l=t.data,u=i.getResponseUrl(t,s),h=d.default.parseMasterPlaylist(l,u);if(h.length){var c=h.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),p=d.default.parseMasterPlaylistMedia(l,u,"AUDIO",c),f=d.default.parseMasterPlaylistMedia(l,u,"SUBTITLES");if(p.length){var v=!1;p.forEach(function(t){t.url||(v=!0)}),!1===v&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(o.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main"}))}a.trigger(n.default.MANIFEST_LOADED,{levels:h,audioTracks:p,subtitles:f,url:u,stats:e,networkDetails:r})}else this._handleManifestParsingError(t,s,"no level found in manifest",r)},i.prototype._handleTrackOrLevelPlaylist=function(e,s,r,a){var o=this.hls,l=r.id,c=r.level,p=r.type,f=i.getResponseUrl(e,r),v=t.isFinite(l)?l:0,g=t.isFinite(c)?c:v,_=i.mapContextToLevelType(r),E=d.default.parseLevelPlaylist(e.data,f,g,_,v);if(E.tload=s.tload,p===h.MANIFEST){var m={url:f,details:E};o.trigger(n.default.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:f,stats:s,networkDetails:a})}if(s.tparsed=u.now(),E.needSidxRanges){var A=E.initSegment.url;this.load(A,{isSidxRequest:!0,type:p,level:c,levelDetails:E,id:l,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else r.levelDetails=E,this._handlePlaylistLoaded(e,s,r,a)},i.prototype._handleSidxRequest=function(t,e){var i=l.default.parseSegmentIndex(new Uint8Array(t.data));if(i){var s=i.references,n=e.levelDetails;s.forEach(function(t,e){var i=t.info,s=n.fragments[e];0===s.byteRange.length&&(s.rawByteRange=String(1+i.end-i.start)+"@"+String(i.start))}),n.initSegment.rawByteRange=String(i.moovEndOffset)+"@0"}},i.prototype._handleManifestParsingError=function(t,e,i,s){this.hls.trigger(n.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:t.url,reason:i,networkDetails:s})},i.prototype._handleNetworkError=function(t,e,i,s){void 0===i&&(i=!1),void 0===s&&(s=null),o.logger.info("A network error occured while loading a "+t.type+"-type playlist");var r,l,d=this.getInternalLoader(t);switch(t.type){case h.MANIFEST:r=i?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case h.LEVEL:r=i?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case h.AUDIO_TRACK:r=i?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;default:l=!1}d&&(d.abort(),this.resetInternalLoader(t.type));var u={type:a.ErrorTypes.NETWORK_ERROR,details:r,fatal:l,url:d.url,loader:d,context:t,networkDetails:e};s&&(u.response=s),this.hls.trigger(n.default.ERROR,u)},i.prototype._handlePlaylistLoaded=function(t,e,s,r){var a=s.type,o=s.level,l=s.id,d=s.levelDetails;if(d.targetduration)if(i.canHaveQualityLevels(s.type))this.hls.trigger(n.default.LEVEL_LOADED,{details:d,level:o||0,id:l||0,stats:e,networkDetails:r});else switch(a){case h.AUDIO_TRACK:this.hls.trigger(n.default.AUDIO_TRACK_LOADED,{details:d,id:l,stats:e,networkDetails:r});break;case h.SUBTITLE_TRACK:this.hls.trigger(n.default.SUBTITLE_TRACK_LOADED,{details:d,id:l,stats:e,networkDetails:r})}else this._handleManifestParsingError(t,s,"invalid target duration",r)},i}(r.default);e.default=p}).call(this,i("./src/polyfills/number.js").Number)},"./src/observer.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.emit.apply(this,[t,t].concat(e))},e}(i("./node_modules/eventemitter3/index.js").EventEmitter);e.Observer=n},"./src/polyfills/number.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/get-self-scope.js").getSelfScope().Number;e.Number=s,s.isFinite=s.isFinite||function(t){return"number"==typeof t&&window.isFinite(t)}},"./src/remux/aac-helper.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}();e.default=s},"./src/remux/mp4-generator.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=Math.pow(2,32)-1,n=function(){function t(){}return t.init=function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:i,audio:s};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=r,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,a,l,a,o),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,n))},t.box=function(t){for(var e,i=Array.prototype.slice.call(arguments,1),s=8,n=i.length,r=n;n--;)s+=i[n].byteLength;for((e=new Uint8Array(s))[0]=s>>24&255,e[1]=s>>16&255,e[2]=s>>8&255,e[3]=255&s,e.set(t,4),n=0,s=8;n<r;n++)e.set(i[n],s),s+=i[n].byteLength;return e},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,i){i*=e;var n=Math.floor(i/(s+1)),r=Math.floor(i%(s+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,i,s){return t.box(t.types.moof,t.mfhd(e),t.traf(s,i))},t.moov=function(e){for(var i=e.length,s=[];i--;)s[i]=t.trak(e[i]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(s).concat(t.mvex(e)))},t.mvex=function(e){for(var i=e.length,s=[];i--;)s[i]=t.trex(e[i]);return t.box.apply(null,[t.types.mvex].concat(s))},t.mvhd=function(e,i){i*=e;var n=Math.floor(i/(s+1)),r=Math.floor(i%(s+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,a)},t.sdtp=function(e){var i,s,n=e.samples||[],r=new Uint8Array(4+n.length);for(s=0;s<n.length;s++)i=n[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return t.box(t.types.sdtp,r)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var i,s,n,r=[],a=[];for(i=0;i<e.sps.length;i++)n=(s=e.sps[i]).byteLength,r.push(n>>>8&255),r.push(255&n),r=r.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)n=(s=e.pps[i]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(s));var o=t.box(t.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(a))),l=e.width,d=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,h>>24,h>>16&255,h>>8&255,255&h])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var i=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var i=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var i=e.id,n=e.duration*e.timescale,r=e.width,a=e.height,o=Math.floor(n/(s+1)),l=Math.floor(n%(s+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))},t.traf=function(e,i){var n=t.sdtp(e),r=e.id,a=Math.floor(i/(s+1)),o=Math.floor(i%(s+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o])),t.trun(e,n.length+16+20+8+16+8+8),n)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var i=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,i){var s,n,r,a,o,l,d=e.samples||[],u=d.length,h=12+16*u,c=new Uint8Array(h);for(i+=8+h,c.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),s=0;s<u;s++)r=(n=d[s]).duration,a=n.size,o=n.flags,l=n.cts,c.set([r>>>24&255,r>>>16&255,r>>>8&255,255&r,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*s);return t.box(t.types.trun,c)},t.initSegment=function(e){t.types||t.init();var i,s=t.moov(e);return(i=new Uint8Array(t.FTYP.byteLength+s.byteLength)).set(t.FTYP),i.set(s,t.FTYP.byteLength),i},t}();e.default=n},"./src/remux/mp4-remuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/remux/aac-helper.js"),n=i("./src/remux/mp4-generator.js"),r=i("./src/events.js"),a=i("./src/errors.js"),o=i("./src/utils/logger.js"),l=function(){function t(t,e,i,s){this.observer=t,this.config=e,this.typeSupported=i;var n=window.navigator.userAgent;this.isSafari=s&&s.indexOf("Apple")>-1&&n&&!n.match("CriOS"),this.ISGenerated=!1}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},t.prototype.resetInitSegment=function(){this.ISGenerated=!1},t.prototype.remux=function(t,e,i,s,n,a,l){if(this.ISGenerated||this.generateIS(t,e,n),this.ISGenerated){var d=t.samples.length,u=e.samples.length,h=n,c=n;if(d&&u){var p=(t.samples[0].pts-e.samples[0].pts)/e.inputTimeScale;h+=Math.max(0,p),c+=Math.max(0,-p)}if(d){t.timescale||(o.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,n));var f=this.remuxAudio(t,h,a,l);if(u){var v=void 0;f&&(v=f.endPTS-f.startPTS),e.timescale||(o.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,n)),this.remuxVideo(e,c,a,v,l)}}else if(u){var g=this.remuxVideo(e,c,a,0,l);g&&t.codec&&this.remuxEmptyAudio(t,h,a,g)}}i.samples.length&&this.remuxID3(i,n),s.samples.length&&this.remuxText(s,n),this.observer.trigger(r.default.FRAG_PARSED)},t.prototype.generateIS=function(t,e,i){var s,l,d=this.observer,u=t.samples,h=e.samples,c=this.typeSupported,p="audio/mp4",f={},v={tracks:f},g=void 0===this._initPTS;if(g&&(s=l=1/0),t.config&&u.length&&(t.timescale=t.samplerate,o.logger.log("audio sampling rate : "+t.samplerate),t.isAAC||(c.mpeg?(p="audio/mpeg",t.codec=""):c.mp3&&(t.codec="mp3")),f.audio={container:p,codec:t.codec,initSegment:!t.isAAC&&c.mpeg?new Uint8Array:n.default.initSegment([t]),metadata:{channelCount:t.channelCount}},g&&(s=l=u[0].pts-t.inputTimeScale*i)),e.sps&&e.pps&&h.length){var _=e.inputTimeScale;e.timescale=_,f.video={container:"video/mp4",codec:e.codec,initSegment:n.default.initSegment([e]),metadata:{width:e.width,height:e.height}},g&&(s=Math.min(s,h[0].pts-_*i),l=Math.min(l,h[0].dts-_*i),this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:s}))}Object.keys(f).length?(d.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,v),this.ISGenerated=!0,g&&(this._initPTS=s,this._initDTS=l)):d.trigger(r.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.prototype.remuxVideo=function(t,e,i,s,l){var d,u,h,c,p,f,v,g=8,_=t.timescale,E=t.samples,m=[],A=E.length,y=this._PTSNormalize,S=this._initPTS,b=this.nextAvcDts,T=this.isSafari;if(0!==A){T&&(i|=E.length&&b&&(l&&Math.abs(e-b/_)<.1||Math.abs(E[0].pts-b-S)<_/5)),i||(b=e*_),E.forEach(function(t){t.pts=y(t.pts-S,b),t.dts=y(t.dts-S,b)}),E.sort(function(t,e){var i=t.dts-e.dts,s=t.pts-e.pts;return i||s||t.id-e.id});var D=E.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(D<0){o.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(D/90)+" ms to overcome this issue");for(var I=0;I<E.length;I++)E[I].dts+=D}var C=E[0];p=Math.max(C.dts,0),c=Math.max(C.pts,0);var R=Math.round((p-b)/90);i&&R&&(R>1?o.logger.log("AVC:"+R+" ms hole between fragments detected,filling it"):R<-1&&o.logger.log("AVC:"+-R+" ms overlapping between fragments detected"),p=b,E[0].dts=p,c=Math.max(c-R,b),E[0].pts=c,o.logger.log("Video/PTS/DTS adjusted: "+Math.round(c/90)+"/"+Math.round(p/90)+",delta:"+R+" ms")),C=E[E.length-1],v=Math.max(C.dts,0),f=Math.max(C.pts,0,v),T&&(d=Math.round((v-p)/(E.length-1)));var P=0,M=0;for(I=0;I<A;I++){for(var O=E[I],L=O.units,N=L.length,k=0,w=0;w<N;w++)k+=L[w].data.length;M+=k,P+=N,O.length=k,O.dts=T?p+I*d:Math.max(O.dts,p),O.pts=Math.max(O.pts,O.dts)}var U=M+4*P+8;try{u=new Uint8Array(U)}catch(t){return void this.observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating video mdat "+U})}var B=new window.DataView(u.buffer);for(B.setUint32(0,U),u.set(n.default.types.mdat,4),I=0;I<A;I++){var j=E[I],F=j.units,x=0,G=void 0;for(w=0,N=F.length;w<N;w++){var V=F[w],H=V.data,W=V.data.byteLength;B.setUint32(g,W),g+=4,u.set(H,g),g+=W,x+=4+W}if(T)G=Math.max(0,d*Math.round((j.pts-j.dts)/d));else{if(I<A-1)d=E[I+1].dts-j.dts;else{var K=this.config,z=j.dts-E[I>0?I-1:I].dts;if(K.stretchShortVideoTrack){var Y=K.maxBufferHole,q=Math.floor(Y*_),X=(s?c+s*_:this.nextAudioPts)-j.pts;X>q?((d=X-z)<0&&(d=z),o.logger.log("It is approximately "+X/90+" ms to the next segment; using duration "+d/90+" ms for the last video frame.")):d=z}else d=z}G=Math.round(j.pts-j.dts)}m.push({size:x,duration:d,cts:G,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:j.key?2:1,isNonSync:j.key?0:1}})}this.nextAvcDts=v+d;var J=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,m.length&&window.navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Q=m[0].flags;Q.dependsOn=2,Q.isNonSync=0}t.samples=m,h=n.default.moof(t.sequenceNumber++,p,t),t.samples=[];var Z={data1:h,data2:u,startPTS:c/_,endPTS:(f+d)/_,startDTS:p/_,endDTS:this.nextAvcDts/_,type:"video",hasAudio:!1,hasVideo:!0,nb:m.length,dropped:J};return this.observer.trigger(r.default.FRAG_PARSING_DATA,Z),Z}},t.prototype.remuxAudio=function(t,e,i,l){var d,u,h,c,p,f,v,g=t.inputTimeScale,_=t.timescale,E=g/_,m=(t.isAAC?1024:1152)*E,A=this._PTSNormalize,y=this._initPTS,S=!t.isAAC&&this.typeSupported.mpeg,b=t.samples,T=[],D=this.nextAudioPts;if(i|=b.length&&D&&(l&&Math.abs(e-D/g)<.1||Math.abs(b[0].pts-D-y)<20*m),b.forEach(function(t){t.pts=t.dts=A(t.pts-y,e*g)}),0!==(b=b.filter(function(t){return t.pts>=0})).length){if(i||(D=l?e*g:b[0].pts),t.isAAC)for(var I=this.config.maxAudioFramesDrift,C=0,R=D;C<b.length;){var P,M=b[C];P=(j=M.pts)-R;var O=Math.abs(1e3*P/g);if(P<=-I*m)o.logger.warn("Dropping 1 audio frame @ "+(R/g).toFixed(3)+"s due to "+Math.round(O)+" ms overlap."),b.splice(C,1),t.len-=M.unit.length;else if(P>=I*m&&O<1e4&&R){var L=Math.round(P/m);o.logger.warn("Injecting "+L+" audio frame @ "+(R/g).toFixed(3)+"s due to "+Math.round(1e3*P/g)+" ms gap.");for(var N=0;N<L;N++){var k=Math.max(R,0);(h=s.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),h=M.unit.subarray()),b.splice(C,0,{unit:h,pts:k,dts:k}),t.len+=h.length,R+=m,C++}M.pts=M.dts=R,R+=m,C++}else Math.abs(P),M.pts=M.dts=R,R+=m,C++}N=0;for(var w=b.length;N<w;N++){var U=b[N],B=U.unit,j=U.pts;if(void 0!==v)u.duration=Math.round((j-v)/E);else{var F=Math.round(1e3*(j-D)/g),x=0;if(i&&t.isAAC&&F){if(F>0&&F<1e4)x=Math.round((j-D)/m),o.logger.log(F+" ms hole between AAC samples detected,filling it"),x>0&&((h=s.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(h=B.subarray()),t.len+=x*h.length);else if(F<-12){o.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(D/g).toFixed(3)+"s/"+(j/g).toFixed(3)+"s/"+-F+"ms"),t.len-=B.byteLength;continue}j=D}if(f=j,!(t.len>0))return;var G=S?t.len:t.len+8;d=S?0:8;try{c=new Uint8Array(G)}catch(t){return void this.observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating audio mdat "+G})}for(S||(new DataView(c.buffer).setUint32(0,G),c.set(n.default.types.mdat,4)),C=0;C<x;C++)(h=s.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),h=B.subarray()),c.set(h,d),d+=h.byteLength,u={size:h.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(u)}c.set(B,d);var V=B.byteLength;d+=V,u={size:V,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(u),v=j}var H=0,W=T.length;if(W>=2&&(H=T[W-2].duration,u.duration=H),W){this.nextAudioPts=D=v+E*H,t.len=0,t.samples=T,p=S?new Uint8Array:n.default.moof(t.sequenceNumber++,f/E,t),t.samples=[];var K=f/g,z=D/g,Y={data1:p,data2:c,startPTS:K,endPTS:z,startDTS:K,endDTS:z,type:"audio",hasAudio:!0,hasVideo:!1,nb:W};return this.observer.trigger(r.default.FRAG_PARSING_DATA,Y),Y}return null}},t.prototype.remuxEmptyAudio=function(t,e,i,n){var r=t.inputTimeScale,a=r/(t.samplerate?t.samplerate:r),l=this.nextAudioPts,d=(void 0!==l?l:n.startDTS*r)+this._initDTS,u=n.endDTS*r+this._initDTS,h=1024*a,c=Math.ceil((u-d)/h),p=s.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(o.logger.warn("remux empty Audio"),p){for(var f=[],v=0;v<c;v++){var g=d+v*h;f.push({unit:p,pts:g,dts:g}),t.len+=p.length}t.samples=f,this.remuxAudio(t,e,i)}else o.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.prototype.remuxID3=function(t){var e,i=t.samples.length,s=t.inputTimeScale,n=this._initPTS,a=this._initDTS;if(i){for(var o=0;o<i;o++)(e=t.samples[o]).pts=(e.pts-n)/s,e.dts=(e.dts-a)/s;this.observer.trigger(r.default.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[]},t.prototype.remuxText=function(t){t.samples.sort(function(t,e){return t.pts-e.pts});var e,i=t.samples.length,s=t.inputTimeScale,n=this._initPTS;if(i){for(var a=0;a<i;a++)(e=t.samples[a]).pts=(e.pts-n)/s;this.observer.trigger(r.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]},t.prototype._PTSNormalize=function(t,e){var i;if(void 0===e)return t;for(i=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=i;return t},t}();e.default=l},"./src/remux/passthrough-remuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/events.js"),n=function(){function t(t){this.observer=t}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(){},t.prototype.resetInitSegment=function(){},t.prototype.remux=function(t,e,i,n,r,a,o,l){var d=this.observer,u="";t&&(u+="audio"),e&&(u+="video"),d.trigger(s.default.FRAG_PARSING_DATA,{data1:l,startPTS:r,startDTS:r,type:u,hasAudio:!!t,hasVideo:!!e,nb:1,dropped:0}),d.trigger(s.default.FRAG_PARSED)},t}();e.default=n},"./src/task-loop.js":function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];var n=t.apply(this,[e].concat(i))||this;return n._tickInterval=null,n._tickTimer=null,n._tickCallCount=0,n._boundTick=n.tick.bind(n),n}return s(e,t),e.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.prototype.hasInterval=function(){return!!this._tickInterval},e.prototype.hasNextTick=function(){return!!this._tickTimer},e.prototype.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=window.setInterval(this._boundTick,t),!0)},e.prototype.clearInterval=function(){return!!this._tickInterval&&(window.clearInterval(this._tickInterval),this._tickInterval=null,!0)},e.prototype.clearNextTick=function(){return!!this._tickTimer&&(window.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.prototype.tick=function(){1==++this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=window.setTimeout(this._boundTick,0)),this._tickCallCount=0)},e.prototype.doTick=function(){},e}(i("./src/event-handler.js").default);e.default=n},"./src/utils/attr-list.js":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=/^(\d+)x(\d+)$/,s=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,n=function(){function e(t){for(var i in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(i)&&(this[i]=t[i])}return e.prototype.decimalInteger=function(e){var i=window.parseInt(this[e],10);return i>t.MAX_SAFE_INTEGER?1/0:i},e.prototype.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var i=new Uint8Array(e.length/2),s=0;s<e.length/2;s++)i[s]=window.parseInt(e.slice(2*s,2*s+2),16);return i}return null},e.prototype.hexadecimalIntegerAsNumber=function(e){var i=window.parseInt(this[e],16);return i>t.MAX_SAFE_INTEGER?1/0:i},e.prototype.decimalFloatingPoint=function(t){return window.parseFloat(this[t])},e.prototype.enumeratedString=function(t){return this[t]},e.prototype.decimalResolution=function(t){var e=i.exec(this[t]);if(null!==e)return{width:window.parseInt(e[1],10),height:window.parseInt(e[2],10)}},e.parseAttrList=function(t){var e,i={};for(s.lastIndex=0;null!==(e=s.exec(t));){var n=e[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[e[1]]=n}return i},e}();e.default=n}).call(this,i("./src/polyfills/number.js").Number)},"./src/utils/binary-search.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={search:function(t,e){for(var i=0,s=t.length-1,n=null,r=null;i<=s;){var a=e(r=t[n=(i+s)/2|0]);if(a>0)i=n+1;else{if(!(a<0))return r;s=n-1}}return null}}},"./src/utils/buffer-helper.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.isBuffered=function(t,e){try{if(t)for(var i=t.buffered,s=0;s<i.length;s++)if(e>=i.start(s)&&e<=i.end(s))return!0}catch(t){}return!1},t.bufferInfo=function(t,e,i){try{if(t){var s=t.buffered,n=[],r=void 0;for(r=0;r<s.length;r++)n.push({start:s.start(r),end:s.end(r)});return this.bufferedInfo(n,e,i)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},t.bufferedInfo=function(t,e,i){var s,n,r,a,o,l=[];for(t.sort(function(t,e){return t.start-e.start||e.end-t.end}),o=0;o<t.length;o++){var d=l.length;if(d){var u=l[d-1].end;t[o].start-u<i?t[o].end>u&&(l[d-1].end=t[o].end):l.push(t[o])}else l.push(t[o])}for(o=0,s=0,n=r=e;o<l.length;o++){var h=l[o].start,c=l[o].end;if(e+i>=h&&e<c)n=h,s=(r=c)-e;else if(e+i<h){a=h;break}}return{len:s,start:n,end:r,nextStart:a}},t}();e.BufferHelper=s},"./src/utils/cea-608-parser.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(t){var e=t;return s.hasOwnProperty(t)&&(e=s[t]),String.fromCharCode(e)},r=15,a=100,o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},l={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},u={25:2,26:4,29:6,30:8,31:10,27:13,28:15},h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){this.verboseFilter[t],this.verboseLevel}},p=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].toString(16));return e},f=function(){function t(t,e,i,s,n){this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=s||"black",this.flash=n||!1}return t.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],i=0;i<e.length;i++){var s=e[i];t.hasOwnProperty(s)&&(this[s]=t[s])}},t.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},t.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},t.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),v=function(){function t(t,e,i,s,n,r){this.uchar=t||" ",this.penState=new f(e,i,s,n,r)}return t.prototype.reset=function(){this.uchar=" ",this.penState.reset()},t.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},t.prototype.setPenState=function(t){this.penState.copy(t)},t.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},t.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},t.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),g=function(){function t(){this.chars=[];for(var t=0;t<a;t++)this.chars.push(new v);this.pos=0,this.currPenState=new f}return t.prototype.equals=function(t){for(var e=!0,i=0;i<a;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<a;e++)this.chars[e].copy(t.chars[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<a;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},t.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(c.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>a&&(c.log("ERROR","Too large cursor position "+this.pos),this.pos=a)},t.prototype.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)},t.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.prototype.insertChar=function(t){t>=144&&this.backSpace();var e=n(t);this.pos>=a?c.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},t.prototype.clearFromPos=function(t){var e;for(e=t;e<a;e++)this.chars[e].reset()},t.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.prototype.getTextString=function(){for(var t=[],e=!0,i=0;i<a;i++){var s=this.chars[i].uchar;" "!==s&&(e=!1),t.push(s)}return e?"":t.join("")},t.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),_=function(){function t(){this.rows=[];for(var t=0;t<r;t++)this.rows.push(new g);this.currRow=r-1,this.nrRollUpRows=null,this.reset()}return t.prototype.reset=function(){for(var t=0;t<r;t++)this.rows[t].clear();this.currRow=r-1},t.prototype.equals=function(t){for(var e=!0,i=0;i<r;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<r;e++)this.rows[e].copy(t.rows[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<r;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},t.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},t.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},t.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},t.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},t.prototype.setCursor=function(t){c.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},t.prototype.setPAC=function(t){c.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var i=0;i<r;i++)this.rows[i].clear();var s=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var a=n.rows[s].cueStartTime;if(a&&a<c.time)for(i=0;i<this.nrRollUpRows;i++)this.rows[e-this.nrRollUpRows+i+1].copy(n.rows[s+i])}}this.currRow=e;var o=this.rows[this.currRow];if(null!==t.indent){var l=t.indent,d=Math.max(l-1,0);o.setCursor(t.indent),t.color=o.chars[d].penState.foreground}var u={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(u)},t.prototype.setBkgData=function(t){c.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},t.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},t.prototype.rollUp=function(){if(null!==this.nrRollUpRows){c.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),c.log("INFO","Rolling up")}else c.log("DEBUG","roll_up but nrRollUpRows not set yet")},t.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],i="",s=-1,n=0;n<r;n++){var a=this.rows[n].getTextString();a&&(s=n+1,t?e.push("Row "+s+": '"+a+"'"):e.push(a.trim()))}return e.length>0&&(i=t?"["+e.join(" | ")+"]":e.join("\n")),i},t.prototype.getTextAndFormat=function(){return this.rows},t}(),E=function(){function t(t,e){this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new _,this.nonDisplayedMemory=new _,this.lastOutputScreen=new _,this.currRollUpRow=this.displayedMemory.rows[r-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return t.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[r-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},t.prototype.getHandler=function(){return this.outputFilter},t.prototype.setHandler=function(t){this.outputFilter=t},t.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},t.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},t.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,c.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},t.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";c.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(c.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.prototype.ccRCL=function(){c.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.prototype.ccBS=function(){c.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.prototype.ccAOF=function(){},t.prototype.ccAON=function(){},t.prototype.ccDER=function(){c.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.prototype.ccRU=function(t){c.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},t.prototype.ccFON=function(){c.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.prototype.ccRDC=function(){c.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.prototype.ccTR=function(){c.log("INFO","TR"),this.setMode("MODE_TEXT")},t.prototype.ccRTD=function(){c.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.prototype.ccEDM=function(){c.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.prototype.ccCR=function(){c.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.prototype.ccENM=function(){c.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.prototype.ccEOC=function(){if(c.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,c.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.prototype.ccTO=function(t){c.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},t.prototype.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var i=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}c.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},t.prototype.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=c.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},t.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),m=function(){function t(t,e,i){this.field=t||1,this.outputs=[e,i],this.channels=[new E(1,e),new E(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return t.prototype.getHandler=function(t){return this.channels[t].getHandler()},t.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},t.prototype.addData=function(t,e){var i,s,n,r=!1;this.lastTime=t,c.setTime(t);for(var a=0;a<e.length;a+=2)s=127&e[a],n=127&e[a+1],0!==s||0!==n?(c.log("DATA","["+p([e[a],e[a+1]])+"] -> ("+p([s,n])+")"),(i=this.parseCmd(s,n))||(i=this.parseMidrow(s,n)),i||(i=this.parsePAC(s,n)),i||(i=this.parseBackgroundAttributes(s,n)),!i&&(r=this.parseChars(s,n))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(r):c.log("WARNING","No channel found yet. TEXT-MODE?")),i?this.dataCounters.cmd+=2:r?this.dataCounters.char+=2:(this.dataCounters.other+=2,c.log("WARNING","Couldn't parse cleaned data "+p([s,n])+" orig: "+p([e[a],e[a+1]])))):this.dataCounters.padding+=2},t.prototype.parseCmd=function(t,e){var i;if(!((20===t||28===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=33&&e<=35))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,c.log("DEBUG","Repeated command ("+p([t,e])+") is dropped"),!0;i=20===t||23===t?1:2;var s=this.channels[i-1];return 20===t||28===t?32===e?s.ccRCL():33===e?s.ccBS():34===e?s.ccAOF():35===e?s.ccAON():36===e?s.ccDER():37===e?s.ccRU(2):38===e?s.ccRU(3):39===e?s.ccRU(4):40===e?s.ccFON():41===e?s.ccRDC():42===e?s.ccTR():43===e?s.ccRTD():44===e?s.ccEDM():45===e?s.ccCR():46===e?s.ccENM():47===e&&s.ccEOC():s.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},t.prototype.parseMidrow=function(t,e){var i=null;return(17===t||25===t)&&e>=32&&e<=47&&((i=17===t?1:2)!==this.currChNr?(c.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(e),c.log("DEBUG","MIDROW ("+p([t,e])+")"),!0))},t.prototype.parsePAC=function(t,e){var i,s;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(16===t||24===t)&&e>=64&&e<=95))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;i=t<=23?1:2,s=e>=64&&e<=95?1===i?o[t]:d[t]:1===i?l[t]:u[t];var n=this.interpretPAC(s,e);return this.channels[i-1].setPAC(n),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},t.prototype.interpretPAC=function(t,e){var i,s={color:null,italics:!1,indent:null,underline:!1,row:t};return i=e>95?e-96:e-64,s.underline=1==(1&i),i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=4*Math.floor((i-16)/2),s},t.prototype.parseChars=function(t,e){var i,s=null,r=null,a=null;(t>=25?(s=2,a=t-8):(s=1,a=t),a>=17&&a<=19)?(i=17===a?e+80:18===a?e+112:e+144,c.log("INFO","Special char '"+n(i)+"' in channel "+s),r=[i]):t>=32&&t<=127&&(r=0===e?[t]:[t,e]);if(r){var o=p(r);c.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r},t.prototype.parseBackgroundAttributes=function(t,e){var i,s,n,r;return!(!((16===t||24===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=45&&e<=47)||(i={},16===t||24===t?(s=Math.floor((e-32)/2),i.background=h[s],e%2==1&&(i.background=i.background+"_semi")):45===e?i.background="transparent":(i.foreground="black",47===e&&(i.underline=!0)),n=t<24?1:2,r=this.channels[n-1],r.setBkgData(i),this.lastCmdA=null,this.lastCmdB=null,0))},t.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},t.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},t}();e.default=m},"./src/utils/codecs.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};e.isCodecType=function(t,e){var i=s[e];return!!i&&!0===i[t.slice(0,4)]},e.isCodecSupportedInMp4=function(t,e){return window.MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}},"./src/utils/cues.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/vttparser.js");e.newCue=function(t,e,i,n){for(var r,a,o,l,d,u=window.VTTCue||window.TextTrackCue,h=0;h<n.rows.length;h++)if(o=!0,l=0,d="",!(r=n.rows[h]).isEmpty()){for(var c=0;c<r.chars.length;c++)r.chars[c].uchar.match(/\s/)&&o?l++:(d+=r.chars[c].uchar,o=!1);r.cueStartTime=e,e===i&&(i+=1e-4),a=new u(e,i,s.fixLineBreaks(d.trim())),l>=16?l--:l++,window.navigator.userAgent.match(/Firefox\//)?a.line=h+1:a.line=h>7?h-2:h+1,a.align="left",a.position=Math.max(0,Math.min(100,l/32*100+(window.navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(a)}}},"./src/utils/discontinuities.js":function(t,e,i){"use strict";(function(t){function s(t,e){for(var i=null,s=0;s<t.length;s+=1){var n=t[s];if(n&&n.cc===e){i=n;break}}return i}function n(t,e,i){var s=!1;return e&&e.details&&i&&(i.endCC>i.startCC||t&&t.cc<i.startCC)&&(s=!0),s}function r(t,e){var i=t.fragments,n=e.fragments;if(n.length&&i.length){var r=s(i,n[0].cc);return!r||r&&!r.startPTS?void u.logger.log("No frag in previous level to align on"):r}u.logger.log("No fragments to align")}function a(t,e){e.fragments.forEach(function(e){if(e){var i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}),e.PTSKnown=!0}function o(t,e,i){if(n(t,i,e)){var s=r(i.details,e);s&&(u.logger.log("Adjusting PTS using last level due to CC increase within current level"),a(s.start,e))}}function l(e,i){if(i&&i.fragments.length){if(!e.hasProgramDateTime||!i.hasProgramDateTime)return;var s=i.fragments[0].programDateTime,n=(e.fragments[0].programDateTime-s)/1e3+i.fragments[0].start;t.isFinite(n)&&(u.logger.log("adjusting PTS using programDateTime delta, sliding:"+n.toFixed(3)),a(n,e))}}Object.defineProperty(e,"__esModule",{value:!0});var d=i("./src/utils/binary-search.js"),u=i("./src/utils/logger.js");e.findFirstFragWithCC=s,e.findFragWithCC=function(t,e){return d.default.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})},e.shouldAlignOnDiscontinuities=n,e.findDiscontinuousReferenceFrag=r,e.adjustPts=a,e.alignStream=function(t,e,i){o(t,i,e),!i.PTSKnown&&e&&l(i,e.details)},e.alignDiscontinuities=o,e.alignPDT=l}).call(this,i("./src/polyfills/number.js").Number)},"./src/utils/ewma-bandwidth-estimator.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/ewma.js"),n=function(){function t(t,e,i,n){this.hls=t,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new s.default(e),this.fast_=new s.default(i)}return t.prototype.sample=function(t,e){var i=8e3*e/(t=Math.max(t,this.minDelayMs_)),s=t/1e3;this.fast_.sample(s,i),this.slow_.sample(s,i)},t.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},t.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.prototype.destroy=function(){},t}();e.default=n},"./src/utils/ewma.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t){this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return t.prototype.sample=function(t,e){var i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t},t.prototype.getTotalWeight=function(){return this.totalWeight_},t.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},t}();e.default=s},"./src/utils/get-self-scope.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getSelfScope=function(){return"undefined"==typeof window?window.self:window}},"./src/utils/logger.js":function(t,e,i){"use strict";function s(){}function n(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];e.forEach(function(e){o[e]=t[e]?t[e].bind(t):function(t){var e=l.console[t];return e?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];i[0]&&(i[0]=function(t,e){return"["+t+"] > "+e}(t,i[0])),e.apply(l.console,i)}:s}(e)})}Object.defineProperty(e,"__esModule",{value:!0});var r=i("./src/utils/get-self-scope.js"),a={trace:s,debug:s,log:s,warn:s,info:s,error:s},o=a,l=r.getSelfScope();e.enableLogs=function(t){if(!0===t||"object"==typeof t){n(t,"debug","log","info","warn","error");try{o.log()}catch(t){o=a}}else o=a},e.logger=o},"./src/utils/mediakeys-helper.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;e.requestMediaKeySystemAccess=s},"./src/utils/mediasource-helper.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getMediaSource=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}},"./src/utils/output-filter.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this.timelineController=t,this.trackName=e,this.startTime=null,this.endTime=null,this.screen=null}return t.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},t.prototype.newCue=function(t,e,i){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},t}();e.default=s},"./src/utils/texttrack-utils.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sendAddTrackEvent=function(t,e){var i=null;try{i=new window.Event("addtrack")}catch(t){(i=window.document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)},e.clearCurrentCues=function(t){if(t&&t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}},"./src/utils/time-ranges.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={toString:function(t){for(var e="",i=t.length,s=0;s<i;s++)e+="["+t.start(s).toFixed(3)+","+t.end(s).toFixed(3)+"]";return e}}},"./src/utils/vttcue.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t){return"string"==typeof t&&!!r[t.toLowerCase()]&&t.toLowerCase()}function e(t){return"string"==typeof t&&!!a[t.toLowerCase()]&&t.toLowerCase()}function i(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)t[s]=i[s]}return t}function s(s,r,a){var o=this,l=function(){if("undefined"!=typeof window.navigator)return/MSIE\s8\.0/.test(window.navigator.userAgent)}(),d={};l?o=window.document.createElement("custom"):d.enumerable=!0,o.hasBeenReset=!1;var u="",h=!1,c=s,p=r,f=a,v=null,g="",_=!0,E="auto",m="start",A=50,y="middle",S=50,b="middle";if(Object.defineProperty(o,"id",i({},d,{get:function(){return u},set:function(t){u=""+t}})),Object.defineProperty(o,"pauseOnExit",i({},d,{get:function(){return h},set:function(t){h=!!t}})),Object.defineProperty(o,"startTime",i({},d,{get:function(){return c},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},d,{get:function(){return p},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},d,{get:function(){return f},set:function(t){f=""+t,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},d,{get:function(){return v},set:function(t){v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},d,{get:function(){return g},set:function(e){var i=t(e);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},d,{get:function(){return _},set:function(t){_=!!t,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},d,{get:function(){return E},set:function(t){if("number"!=typeof t&&t!==n)throw new SyntaxError("An invalid number or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},d,{get:function(){return m},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");m=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},d,{get:function(){return A},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");A=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},d,{get:function(){return y},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");y=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},d,{get:function(){return S},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");S=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},d,{get:function(){return b},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");b=i,this.hasBeenReset=!0}})),o.displayState=void 0,l)return o}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var n="auto",r={"":!0,lr:!0,rl:!0},a={start:!0,middle:!0,end:!0,left:!0,right:!0};return s.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},s}()},"./src/utils/vttparser.js":function(t,e,i){"use strict";function s(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new d,this.regionList=[]}function n(){this.values=Object.create(null)}function r(t,e,i,s){var n=s?t.split(s):[t];for(var r in n)if("string"==typeof n[r]){var a=n[r].split(i);2===a.length&&e(a[0],a[1])}}function a(t,e,i){function s(){var e=function(t){function e(t,e,i,s){return 3600*(0|t)+60*(0|e)+(0|i)+(0|s)/1e3}var i=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?e(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?e(i[1],i[2],0,i[4]):e(0,i[1],i[2],i[4]):null}(t);if(null===e)throw new Error("Malformed timestamp: "+o);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function a(){t=t.replace(/^\s+/,"")}var o=t;if(a(),e.startTime=s(),a(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+o);t=t.substr(3),a(),e.endTime=s(),a(),function(t,e){var s=new n;r(t,function(t,e){switch(t){case"region":for(var n=i.length-1;n>=0;n--)if(i[n].id===e){s.set(t,i[n].region);break}break;case"vertical":s.alt(t,e,["rl","lr"]);break;case"line":var r=e.split(","),a=r[0];s.integer(t,a),s.percent(t,a)&&s.set("snapToLines",!1),s.alt(t,a,["auto"]),2===r.length&&s.alt("lineAlign",r[1],["start",h,"end"]);break;case"position":r=e.split(","),s.percent(t,r[0]),2===r.length&&s.alt("positionAlign",r[1],["start",h,"end","line-left","line-right","auto"]);break;case"size":s.percent(t,e);break;case"align":s.alt(t,e,["start",h,"end","left","right"])}},/:/,/\s/),e.region=s.get("region",null),e.vertical=s.get("vertical","");var a=s.get("line","auto");"auto"===a&&-1===u.line&&(a=-1),e.line=a,e.lineAlign=s.get("lineAlign","start"),e.snapToLines=s.get("snapToLines",!0),e.size=s.get("size",100),e.align=s.get("align",h);var o=s.get("position","auto");"auto"===o&&50===u.position&&(o="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=o}(t,e)}function o(t){return t.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(e,"__esModule",{value:!0});var l=i("./src/utils/vttcue.js"),d=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return window.decodeURIComponent(window.encodeURIComponent(t))}}};n.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,i){for(var s=0;s<i.length;++s)if(e===i[s]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,window.parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=window.parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var u=new l.default(0,0,0),h="middle"===u.align?"middle":"center";e.fixLineBreaks=o,s.prototype={parse:function(t){function e(){var t=s.buffer,e=0;for(t=o(t);e<t.length&&"\r"!==t[e]&&"\n"!==t[e];)++e;var i=t.substr(0,e);return"\r"===t[e]&&++e,"\n"===t[e]&&++e,s.buffer=t.substr(e),i}function i(t){r(t,function(t,e){},/:/)}var s=this;t&&(s.buffer+=s.decoder.decode(t,{stream:!0}));try{var n=void 0;if("INITIAL"===s.state){if(!/\r\n|\n/.test(s.buffer))return this;var d=(n=e()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!d||!d[0])throw new Error("Malformed WebVTT signature.");s.state="HEADER"}for(var u=!1;s.buffer;){if(!/\r\n|\n/.test(s.buffer))return this;switch(u?u=!1:n=e(),s.state){case"HEADER":/:/.test(n)?i(n):n||(s.state="ID");continue;case"NOTE":n||(s.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){s.state="NOTE";break}if(!n)continue;if(s.cue=new l.default(0,0,""),s.state="CUE",-1===n.indexOf("--\x3e")){s.cue.id=n;continue}case"CUE":try{a(n,s.cue,s.regionList)}catch(t){s.cue=null,s.state="BADCUE";continue}s.state="CUETEXT";continue;case"CUETEXT":var h=-1!==n.indexOf("--\x3e");if(!n||h&&(u=!0)){s.oncue&&s.oncue(s.cue),s.cue=null,s.state="ID";continue}s.cue.text&&(s.cue.text+="\n"),s.cue.text+=n;continue;case"BADCUE":n||(s.state="ID");continue}}}catch(t){"CUETEXT"===s.state&&s.cue&&s.oncue&&s.oncue(s.cue),s.cue=null,s.state="INITIAL"===s.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),(t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return t.onflush&&t.onflush(),this}},e.default=s},"./src/utils/webvtt-parser.js":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/vttparser.js"),n=i("./src/demux/id3.js"),r=function(t,e,i){return t.substr(i||0,e.length)===e},a=function(e){var i=window.parseInt(e.substr(-3)),s=window.parseInt(e.substr(-6,2)),n=window.parseInt(e.substr(-9,2)),r=e.length>9?window.parseInt(e.substr(0,e.indexOf(":"))):0;return t.isFinite(i)&&t.isFinite(s)&&t.isFinite(n)&&t.isFinite(r)?(i+=1e3*s,i+=6e4*n,i+=36e5*r):-1},o=function(t){for(var e=5381,i=t.length;i;)e=33*e^t.charCodeAt(--i);return(e>>>0).toString()},l={parse:function(t,e,i,l,d,u){var h,c=n.utf8ArrayToStr(new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),p="00:00.000",f=0,v=0,g=0,_=[],E=!0,m=new s.default;m.oncue=function(t){var e=i[l],s=i.ccOffset;e&&e.new&&(void 0!==v?s=i.ccOffset=e.start:function(t,e,i){var s=t[e],n=t[s.prevCC];if(!n||!n.new&&s.new)return t.ccOffset=t.presentationOffset=s.start,void(s.new=!1);for(;n&&n.new;)t.ccOffset+=s.start-n.start,s.new=!1,n=t[(s=n).prevCC];t.presentationOffset=i}(i,l,g)),g&&(s=g-i.presentationOffset),t.startTime+=s-v,t.endTime+=s-v,t.id=o(t.startTime.toString())+o(t.endTime.toString())+o(t.text),t.text=window.decodeURIComponent(window.encodeURIComponent(t.text)),t.endTime>0&&_.push(t)},m.onparsingerror=function(t){h=t},m.onflush=function(){h&&u?u(h):d(_)},c.forEach(function(t){if(E){if(r(t,"X-TIMESTAMP-MAP=")){E=!1,t.substr(16).split(",").forEach(function(t){r(t,"LOCAL:")?p=t.substr(6):r(t,"MPEGTS:")&&(f=window.parseInt(t.substr(7)))});try{e+(9e4*i[l].start||0)<0&&(e+=8589934592),f-=e,v=a(p)/1e3,g=f/9e4,-1===v&&(h=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){h=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(E=!1)}m.parse(t+"\n")}),m.flush()}};e.default=l}).call(this,i("./src/polyfills/number.js").Number)},"./src/utils/xhr-loader.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=window.performance,r=window.XMLHttpRequest,a=function(){function t(t){t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return t.prototype.destroy=function(){this.abort(),this.loader=null},t.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.prototype.load=function(t,e,i){this.context=t,this.config=e,this.callbacks=i,this.stats={trequest:n.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},t.prototype.loadInternal=function(){var t,e=this.context;t=this.loader=new r;var i=this.stats;i.tfirst=0,i.loaded=0;var s=this.xhrSetup;try{if(s)try{s(t,e.url)}catch(i){t.open("GET",e.url,!0),s(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(i){return void this.callbacks.onError({code:t.status,text:i.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.prototype.readystatechange=function(t){var e=t.currentTarget,i=e.readyState,r=this.stats,a=this.context,o=this.config;if(!r.aborted&&i>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(n.now(),r.trequest)),4===i){var l=e.status;if(l>=200&&l<300){r.tload=Math.max(r.tfirst,n.now());var d=void 0,u=void 0;u="arraybuffer"===a.responseType?(d=e.response).byteLength:(d=e.responseText).length,r.loaded=r.total=u;var h={url:e.responseURL,data:d};this.callbacks.onSuccess(h,r,a,e)}else r.retry>=o.maxRetry||l>=400&&l<499?(s.logger.error(l+" while loading "+a.url),this.callbacks.onError({code:l,text:e.statusText},a,e)):(s.logger.warn(l+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},t.prototype.loadtimeout=function(){s.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.prototype.loadprogress=function(t){var e=t.currentTarget,i=this.stats;i.loaded=t.loaded,t.lengthComputable&&(i.total=t.total);var s=this.callbacks.onProgress;s&&s(i,this.context,null,e)},t}();e.default=a}}).default}),function(e){"use strict";function i(t,e){var i=e||0,s=u;return s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]}function s(t,e,s){var r=e&&s||0;"string"==typeof t&&(e="binary"===t?new d(16):null,t=null);var a=(t=t||{}).random||(t.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var o=0;o<16;o++)e[r+o]=a[o];return e||i(a)}var n,r,a,o,l;e?function(){var t=e.crypto||e.msCrypto;if(!n&&t&&t.getRandomValues)try{var i=new Uint8Array(16);o=n=function(){return t.getRandomValues(i),i},n()}catch(t){}if(!n){var s=new Array(16);r=n=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),s[e]=t>>>((3&e)<<3)&255;return s},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}():function(){if("function"==typeof t)try{var e=t("crypto").randomBytes;a=n=e&&function(){return e(16)},n()}catch(e){}}();for(var d="function"==typeof window.Buffer?window.Buffer:Array,u=[],h={},c=0;c<256;c++)u[c]=(c+256).toString(16).substr(1),h[u[c]]=c;var p=n(),f=[1|p[0],p[1],p[2],p[3],p[4],p[5]],v=16383&(p[6]<<8|p[7]),g=0,_=0,E=s;E.v1=function(t,e,s){var n=e&&s||0,r=e||[],a=null!=(t=t||{}).clockseq?t.clockseq:v,o=null!=t.msecs?t.msecs:(new Date).getTime(),l=null!=t.nsecs?t.nsecs:_+1,d=o-g+(l-_)/1e4;if(d<0&&null==t.clockseq&&(a=a+1&16383),(d<0||o>g)&&null==t.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=o,_=l,v=a;var u=(1e4*(268435455&(o+=122192928e5))+l)%4294967296;r[n++]=u>>>24&255,r[n++]=u>>>16&255,r[n++]=u>>>8&255,r[n++]=255&u;var h=o/4294967296*1e4&268435455;r[n++]=h>>>8&255,r[n++]=255&h,r[n++]=h>>>24&15|16,r[n++]=h>>>16&255,r[n++]=a>>>8|128,r[n++]=255&a;for(var c=t.node||f,p=0;p<6;p++)r[n+p]=c[p];return e||i(r)},E.v4=s,E.parse=function(t,e,i){var s=e&&i||0,n=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){n<16&&(e[s+n++]=h[t])});n<16;)e[s+n++]=0;return e},E.unparse=i,E.BufferClass=d,E._rng=n,E._mathRNG=r,E._nodeRNG=a,E._whatwgRNG=o,"undefined"!=typeof window.module&&window.module.exports?window.module.exports=E:(l=e.uuid,E.noConflict=function(){return e.uuid=l,E},e.uuid=E)}("undefined"!=typeof window?window:null),function(){function t(t){var e=t.__resizeTriggers__,i=e.firstElementChild,s=e.lastElementChild,n=i.firstElementChild;s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,n.style.width=i.offsetWidth+1+"px",n.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}function e(e){var i=this;t(this),this.__resizeRAF__&&a(this.__resizeRAF__),this.__resizeRAF__=r(function(){var t;((t=i).offsetWidth!=t.__resizeLast__.width||t.offsetHeight!=t.__resizeLast__.height)&&(i.__resizeLast__.width=i.offsetWidth,i.__resizeLast__.height=i.offsetHeight,i.__resizeListeners__.forEach(function(t){t.call(i,e)}))})}function i(){if(!n){var t=(v||"")+".resize-triggers { "+(g||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',e=window.document.head||window.document.getElementsByTagName("head")[0],i=window.document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(window.document.createTextNode(t)),e.appendChild(i),n=!0}}var s=window.document.attachEvent,n=!1;if(!s){var r=function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)};return function(e){return t(e)}}(),a=function(){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(e){return t(e)}}(),o=!1,l="",d="animationstart",u="Webkit Moz O ms".split(" "),h="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),c=window.document.createElement("fakeelement");if(void 0!==c.style.animationName&&(o=!0),!1===o)for(var p=0;p<u.length;p++)if(void 0!==c.style[u[p]+"AnimationName"]){l="-"+u[p].toLowerCase()+"-",d=h[p],o=!0;break}var f="resizeanim",v="@"+l+"keyframes "+f+" { from { opacity: 0; } to { opacity: 0; } } ",g=l+"animation: 1ms "+f+"; "}window.addResizeListener=function(n,r){s?n.attachEvent("onresize",r):(n.__resizeTriggers__||("static"==window.getComputedStyle(n).position&&(n.style.position="relative"),i(),n.__resizeLast__={},n.__resizeListeners__=[],(n.__resizeTriggers__=window.document.createElement("div")).className="resize-triggers",n.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',n.appendChild(n.__resizeTriggers__),t(n),n.addEventListener("scroll",e,!0),d&&n.__resizeTriggers__.addEventListener(d,function(e){e.animationName==f&&t(n)})),n.__resizeListeners__.push(r))},window.removeResizeListener=function(t,i){s?t.detachEvent("onresize",i):(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(i),1),t.__resizeListeners__.length||(t.removeEventListener("scroll",e),t.__resizeTriggers__=!t.removeChild(t.__resizeTriggers__)))}}(),function(t,e){"object"==typeof window.module&&window.module.exports?window.module.exports=e():t.Spinner=e()}(this,function(){"use strict";function t(t,e){var i,s=window.document.createElement(t||"div");for(i in e)s[i]=e[i];return s}function e(t){for(var e=1,i=arguments.length;i>e;e++)t.appendChild(arguments[e]);return t}function i(t,e,i,s){var n=["opacity",e,~~(100*t),i,s].join("-"),r=.01+i/s*100,a=Math.max(1-(1-t)/e*(100-r),t),o=l.substring(0,l.indexOf("Animation")).toLowerCase(),u=o&&"-"+o+"-"||"";return h[n]||(d.insertRule("@"+u+"keyframes "+n+"{0%{opacity:"+a+"}"+r+"%{opacity:"+t+"}"+(r+.01)+"%{opacity:1}"+(r+e)%100+"%{opacity:"+t+"}100%{opacity:"+a+"}}",d.cssRules.length),h[n]=1),n}function s(t,e){var i,s,n=t.style;if(void 0!==n[e=e.charAt(0).toUpperCase()+e.slice(1)])return e;for(s=0;s<u.length;s++)if(void 0!==n[i=u[s]+e])return i}function n(t,e){for(var i in e)t.style[s(t,i)||i]=e[i];return t}function r(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)void 0===t[s]&&(t[s]=i[s])}return t}function a(t,e){return"string"==typeof t?t:t[e%t.length]}function o(t){this.opts=r(t||{},o.defaults,c)}var l,d,u=["webkit","Moz","ms","O"],h={},c={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(o.defaults={},r(o.prototype,{spin:function(e){this.stop();var i=this,s=i.opts,r=i.el=t(null,{className:s.className});if(n(r,{position:s.position,width:0,zIndex:s.zIndex,left:s.left,top:s.top}),e&&e.insertBefore(r,e.firstChild||null),r.setAttribute("role","progressbar"),i.lines(r,i.opts),!l){var a,o=0,d=(s.lines-1)*(1-s.direction)/2,u=s.fps,h=u/s.speed,c=(1-s.opacity)/(h*s.trail/100),p=h/s.lines;!function t(){o++;for(var e=0;e<s.lines;e++)a=Math.max(1-(o+(s.lines-e)*p)%h*c,s.opacity),i.opacity(r,e*s.direction+d,a,s);i.timeout=i.el&&window.setTimeout(t,~~(1e3/u))}()}return i},stop:function(){var t=this.el;return t&&(window.clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(s,r){function o(e,i){return n(t(),{position:"absolute",width:r.scale*(r.length+r.width)+"px",height:r.scale*r.width+"px",background:e,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/r.lines*u+r.rotate)+"deg) translate("+r.scale*r.radius+"px,0)",borderRadius:(r.corners*r.scale*r.width>>1)+"px"})}for(var d,u=0,h=(r.lines-1)*(1-r.direction)/2;u<r.lines;u++)d=n(t(),{position:"absolute",top:1+~(r.scale*r.width/2)+"px",transform:r.hwaccel?"translate3d(0,0,0)":"",opacity:r.opacity,animation:l&&i(r.opacity,r.trail,h+u*r.direction,r.lines)+" "+1/r.speed+"s linear infinite"}),r.shadow&&e(d,n(o("#000","0 0 4px #000"),{top:"2px"})),e(s,e(d,o(a(r.color,u),"0 0 1px rgba(0,0,0,.1)")));return s},opacity:function(t,e,i){e<t.childNodes.length&&(t.childNodes[e].style.opacity=i)}}),"undefined"!=typeof window.document){d=function(){var i=t("style",{type:"text/css"});return e(window.document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}();var p=n(t("group"),{behavior:"url(#default#VML)"});!s(p,"transform")&&p.adj?function(){function i(e,i){return t("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}d.addRule(".spin-vml","behavior:url(#default#VML)"),o.prototype.lines=function(t,s){function r(){return n(i("group",{coordsize:u+" "+u,coordorigin:-d+" "+-d}),{width:u,height:u})}function o(t,o,l){e(c,e(n(r(),{rotation:360/s.lines*t+"deg",left:~~o}),e(n(i("roundrect",{arcsize:s.corners}),{width:d,height:s.scale*s.width,left:s.scale*s.radius,top:-s.scale*s.width>>1,filter:l}),i("fill",{color:a(s.color,t),opacity:s.opacity}),i("stroke",{opacity:0}))))}var l,d=s.scale*(s.length+s.width),u=2*s.scale*d,h=-(s.width+s.length)*s.scale*2+"px",c=n(r(),{position:"absolute",top:h,left:h});if(s.shadow)for(l=1;l<=s.lines;l++)o(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=s.lines;l++)o(l);return e(t,c)},o.prototype.opacity=function(t,e,i,s){var n=t.firstChild;s=s.shadow&&s.lines||0,n&&e+s<n.childNodes.length&&(n=(n=(n=n.childNodes[e+s])&&n.firstChild)&&n.firstChild)&&(n.opacity=i)}}():l=s(p,"animation")}return o}),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_BUFFERING:"onAdBuffering",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},ErrorCode:{1001:"1200",1002:"",1003:"",2000:"1000",2001:"1101",2002:"1100",2003:"1106",2004:"2004",2005:"2000",3000:"3400",3001:"3100",3002:"3001",3003:"3200",3004:"3101",3005:"",3006:"3002",3007:"3102",3008:"3202",3009:"3401",3011:"3300",3012:"3301",3013:"",4000:"4000",4001:"4300"},mapErrorCode:function(t){return window.uvpjs.ErrorCode[t]||t},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam"},getVideoManager:function(){return window.uvpjs.VideoManager.getInstance()},register:function(t){var e,i,s=t.split("."),n=window,r=s.length;for(e=0;e<r;e++)void 0===n[i=s[e]]&&(n[i]={}),n=n[i];return n},getClass:function(t){var e,i,s,n,r,a;if("string"!=typeof t)return t;for(e=t.split("."),i=window,s=e.length,n="",r=0;r<s;r++){if(n+=a=e[r],void 0===i[a])throw new Error("uvpjs.getClass(): "+n+" is undefined.");r<s-1&&(n+="."),i=i[a]}return i},getObject:function(t){return window.uvpjs.getClass(t)}},function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},window.Class.subClass=function(i){function s(){!t&&this.init&&this.init.apply(this,arguments)}var n,r,a,o,l=this.prototype;for(o in t=!0,r=new this,t=!1,n=function(t,e){return function(){var i,s=this._super;return this._super=l[t],i=e.apply(this,arguments),this._super=s,i}},i)i.hasOwnProperty(o)&&(a=i[o],r[o]="function"==typeof a&&"function"==typeof l[o]&&e.test(a)?n(o,a):a);return s.prototype=r,s.prototype.constructor=s,s.subClass=arguments.callee,s}}(),window.uvpjs.Class=window.Class,window.uvpjs._=window._.noConflict(),window.uvpjs.register("uvpjs").b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",function(t){"use strict";window.uvpjs.register("uvpjs").util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(t){return t&&this.xhrMessages[t]||"XHR status: "+t},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(t){var e=window.document.createElement("a");return e.href=t,{host:e.hostname,pathname:e.pathname,protocol:e.protocol,search:e.search}},objFromQueryStr:function(t){var e,i,s,n="string"==typeof t?t:"",r=(n.indexOf("?")>-1?n.split("?")[1]:n).split("&"),a={};for(i=0,s=r.length;i<s;i++)a[(e=r[i].split("="))[0]]=e[1];return a},queryStrFromObj:function(t,e){var i,s="",n=!1;for(i in t)s+=(n?"&":"")+i+"="+(e?window.encodeURIComponent(t[i]):t[i]),n=!0;return s},uid8:function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()},getUserStatusForQuery:function(t){var e="";switch(t){case"anon":e="sb=0";break;case"reg;sub;pay":e="sb=1";break;case"reg":e="sb=2";break;case"reg;sub;susp":e="sb=3";break;case"reg;sub;exsub":e="sb=4";break;case"reg;sub;trial":e="sb=5";break;default:if(t.indexOf("|")>-1){var i,s,n,r,a="",o=t.split(","),l=o.length;for(o.sort(),r=0;r<l;r++)2==(i=o[r].split("|")).length&&(s=i[0],n=i[1],a!=s?(e.length>0&&(e+="&"),e+=s+"="+n):e+=","+n,a=s)}}return""==e&&(e="sb=0"),e},firstInt:function(){var t,e,i=arguments.length;for(e=0;e<i;e++)if(t=arguments[e],window.parseInt(t)===t)return t},inRange:function(t,e,i){return"number"==typeof t&&t>=e&&t<=i},isEmpty:function(t){return null==t||Array.isArray(t)&&0===t.length||"object"==typeof t&&0===Object.keys(t).length||"string"==typeof t&&""===t},isPlainObject:function(t){return t&&"object"==typeof t&&t.constructor===Object},isFunction:function(t){return"function"==typeof t},isDefinedString:function(t){return!!(t&&"string"==typeof t&&t.length>0)},isNumber:function(t){return!window.isNaN(window.parseFloat(t))&&window.isFinite(t)},isDefined:function(t){return void 0!==t},isFlagTrue:function(t){return!0===t||"true"===t||1===t||"1"===t},getDefinedString:function(){var t,e,i=arguments.length;for(e=0;e<i;e++)if(t=arguments[e],this.isDefinedString(t))return t;return""},supportsLocalStorage:function(){var t,e="test";if(null===this.isLocalStorageSupported)try{window.localStorage.setItem(e,"1"),t=window.localStorage.getItem(e),this.isLocalStorageSupported="1"===t,window.localStorage.removeItem(e)}catch(t){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(t){var e=window.document.createElement("div");return e.innerHTML=t,e.firstChild},createStyleSheet:function(t,e){var i,s,n,r,a,o,l,d,u,h,c=window.document.styleSheets,p=c.length;for(u=function(){h||(t(a),h=!0)},i=0;i<p;i++){a=c[i];try{if((a.href&&a.href.replace(/http(s)?:/,""))===e)return void u()}catch(t){}}s="string"==typeof e&&""!==e,n=window.uvpjs.mediaCapabilities.isFirefox(),r=!s||n?"style":"link",(a=window.document.createElement(r)).setAttribute("type","text/css"),a.appendChild(window.document.createTextNode("")),s&&(a.setAttribute("rel","stylesheet"),a.setAttribute("href",e),a.textContent='@import "'+e+'"'),"function"==typeof t&&(a.onload=u,a.addEventListener&&a.addEventListener("load",u,!1),a.onreadystatechange=function(){"loaded"!==(o=a.readyState)&&"complete"!==o||(window.link.onreadystatechange=null,u())},l=window.setInterval(function(){window.document.styleSheets.length>p&&(u(),window.clearInterval(l))},10),n&&(d=window.setInterval(function(){try{a.sheet.cssRules,window.clearInterval(d),u()}catch(t){}},10)),window.document.getElementsByTagName("head")[0].appendChild(a))},addCSSObject:function(t,e,i,s){var n,r=window.uvpjs.util,a="#"+e.id+" "+(s||"");for(n in i)r.addCSSRule(t,a,n,i[n])},addCSSRule:function(t,e,i,s){var n,r,a,o=window.uvpjs.mediaCapabilities,l="string"==typeof s&&s.match(/NaN(%|px)/);if(t&&t.sheet)if(!l||o.isAndroid()&&o.isChrome()||(s="0"),r=((n=t.sheet).rules||n.cssRules).length,a=i+":"+s+";",n.insertRule)try{n.insertRule(e+"{"+a+"}",r)}catch(t){console.warn("Unable to add CSS rule: "+t.message)}else n.addRule&&n.addRule(e,a,r)},addCSSRules:function(t,e,i){for(var s,n=i.length;n--;)s=i[n],window.uvpjs.util.addCSSRule(t,e,s.name,s.value)},copyObjectWithKeyMap:function(t){var e=t,i=null;return this.from=function(t){return i=t,this},this.to=function(t){if(!(e&&i&&t))return t;for(var s in e)e.hasOwnProperty(s)&&i.hasOwnProperty(s)&&null!==i[s]&&(t[e[s]]=i[s]);return t},this}}}(),function(t){var e=window.uvpjs._,i=/\{mediaReferenceId}/g,s=/PARTNER/g,n=/\{ptype}/g,r=/\{VGUID}/g,a=/%7Bptype%7D/g,o=/%7BVGUID%7D/g,l=/;/g;t.adUtil={MOAT_PARTNER_CODE:"cbsiimajsint708425247896",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(t,l,d,u){var h,c,p,f,v,g,_,E,m=window.uvpjs.util,A="cust_params",y=t.split("?"),S=y[1],b=t.indexOf("%7Bptype%7D")>-1,T=t.indexOf("{ptype}")>-1,D=this.getAdParams(l,d,u);return S=S.replace(i,D.vid).replace(s,D.partner),b&&(S=S.replace(o,D.vguid).replace(a,D.ptype)),T&&(S=S.replace(r,D.vguid).replace(n,D.ptype)),c=m.objFromQueryStr(S),this.isExcludedFromVpaid(l)&&delete c.pp,(p=c[A])&&(h=m.objFromQueryStr(window.decodeURIComponent(p)),delete c[A]),f=D[A],delete D[A],delete D.partner,delete D.vguid,delete D.ptype,v=e.assign(D,c),g=e.assign(f,h||{}),window.decodeURIComponent(v.iu).indexOf("/8264/")>=0&&l.isMuteAtPlayStart&&!l.userHasUnmuted&&(v.sz="640x483"),this.removeEmpty(v),this.removeEmpty(g),_=m.queryStrFromObj(v,!1),E=m.queryStrFromObj(g,!1),_+="&"+A+"="+window.encodeURIComponent(E),y[0]+"?"+_},getAdParams:function(t,i,s){var n,r,a=t.dwPageParams,o=this.getDwViewGuid(t),l=this.getPpidValue(t),d=t.contentVideoState,u=window.encodeURIComponent(t.sessionOptions.partner),h=a.pagetype||"",c=this.getUserStatusKey(t.getSessionOption("userStatus")),p=""===d.contPlayState||window.uvpjs.util.isFlagTrue(s)?"0":"1",f=t.getSessionOption("isEmbedded")?"1":"0",v=this.getHost("1"===f,t),g=d.pid,_={cust_params:{}},E=window.uvpjs.Configuration.env,m=t.getAdCallParams();for(r in n=i?this.getVideoDfpId(t):"",_.vid=n,_.partner=u,_.ptype=h,_.vguid=o,_.cust_params.vguid=o,_.cust_params.embed=f,v&&(_.cust_params.host=v),this.populateCustParamsWithAdSessionValues(_.cust_params,g),d.podsToSkip.length>0&&(_.cust_params.resume=1,_.cust_params.skippod=d.podsToSkip),c)_.cust_params[r]=c[r];if(l&&(_.ppid=l,_.cust_params.ppid=l),"cbs"===u&&(_.cust_params.cpSession=p,_.cust_params.cpPre=p,_.cust_params.sub=e.isEmpty(t.sessionOptions.userId)?"":t.sessionOptions.userId),m&&!window.uvpjs.util.isEmpty(m.standardParams))for(r in m.standardParams)_[r]=m.standardParams[r];if(m&&!window.uvpjs.util.isEmpty(m.customParams))for(r in m.customParams)_.cust_params[r]=m.customParams[r];return this.isExcludedFromVpaid(t)?_.pp="ssai":("local"===E||"dev"===E)&&(_.pp="vpaid_js"),_},getVideoDfpId:function(t){return window.uvpjs.util.isEmpty(t.contentVideoState.dfpMediaId)?t.contentVideoState.cmsRefGuid:t.contentVideoState.dfpMediaId},isExcludedFromVpaid:function(t){return"AA Original"===t.contentVideoState.contentType},getDwViewGuid:function(t){var e=t.dwPageParams;return e&&e.viewguid||e.pguid||""},extractAdInfo:function(t,i){var s,n,r=i===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return window.uvpjs.util.isEmpty(t)||!i?(!i&&console.error("No 'context' arg supplied"),null):((s={adId:t.getAdId(),adSystem:t.getAdSystem(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId()}).adPodInfo=this.extractPodInfo(t.getAdPodInfo()),n=this[r](t),e.assign(s,n))},extractAdStateData:function(t,e,i){var s=t.getAdPodInfo(),n=s.getPodIndex(),r=s.getAdPosition(),a=t.getDuration(),o=i?"mid":0===n?"pre":n>=1?"mid":-1===n?"post":"",l=("mid"!==o?o+"_0":"mid_"+n)+"_"+r,d=e===this.context.IMA,u=d?this.extractIdInfo(t):null,h=this.getAdStateBlank();return h.adPosition=r,h.adBitrate=t.getVastMediaBitrate?t.getVastMediaBitrate():window.NaN,h.adServerName=d?this.context.IMA:this.context.DAI,h.adVideoTitle=t.getTitle(),h.duration=a,h.adType=o,h.adClipID=l,h.wrapperAdId=d&&u.wrapperAdId||"",h.adVideoId=d?u.wrapperAdId||u.adId:t.getAdId(),h.creativeId=d?u.wrapperCreativeId||u.creativeId:t.getCreativeId(),e===this.context.DAI&&(h.sourceWidth=t.getVastMediaWidth(),h.sourceHeight=t.getVastMediaHeight()),h},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(t){var e=t.getWrapperAdIds(),i=t.getWrapperCreativeIds(),s=Array.isArray(e)&&e.length||0,n=Array.isArray(i)&&i.length||0,r=null,a=null,o=t.getAdId()||"",l=t.getCreativeId()||"";return s&&(s>1&&(r=e[1]),o=e[0]),n&&(n>1&&(a=i[1]),l=i[0]),{adId:o,wrapperAdId:r,creativeId:l,wrapperCreativeId:a}},getHost:function(t,e){var i,s;return t?(i=e.getSessionOption("referrer"))&&(s=window.uvpjs.util.parseUrl(i).host):s=window.location.hostname,s&&""!==s?s:null},getUserStatusKey:function(t){for(var e,i=window.uvpjs.util.getUserStatusForQuery(t).split("&"),s=i.length,n={};s--;)n[(e=i[s].split("="))[0]]=e[1];return n},trackAd:function(t){var e,i,s,n=t.model,r=t.context,a=n.getAdVideoState(),o=r===this.context.IMA,l=r===this.context.DAI;return o||l?(i=n.dwPageParams.pagetype||"",e={level1:"",level2:"",level3:a.adVideoId,level4:a.creativeId,slicer1:"vaw-can",slicer2:n.sessionOptions.partner,slicer3:i,moatVASTSystem:a.adServerName,moatVASTAdID:a.wrapperAdId},""!==(s=this.getDwViewGuid(n))&&(e.zMoatVGUID=s),""!==i&&(e.zMoatPT=i),this.initMoatTracking(t.adVideoContainer,e,a.duration,this.MOAT_PARTNER_CODE,null)):void console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(t){var e=this.getVpaidEventForEvent(t.eventName,t.context);e&&t.trackingHandle.dispatchEvent({type:e,adVolume:t.volume})},checkForAdBlocker:function(t){var e=t.getSessionOption("adBlockerCallback");return e&&e()},populateCustParamsWithAdSessionValues:function(t,e){var i,s,n;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(i=window.getVideoAdSessionValues(e))&&""!==i)for(n in i=i.replace(l,"&"),s=window.uvpjs.util.objFromQueryStr(i))t[n]=s[n]},removeEmpty:function(t){for(var e in t)(null===t[e]||""===t[e])&&delete t[e]},extractAdInfoIma:function(t){return{contentType:t.getContentType(),isLinear:t.isLinear()}},extractAdInfoDai:function(t){return{advertiserName:t.getAdvertiserName(),description:t.getDescription(),duration:t.getDuration(),title:t.getTitle()}},extractPodInfo:function(t){return t?{adPosition:t.getAdPosition(),podIndex:t.getPodIndex(),timeOffset:t.getTimeOffset(),totalAds:t.getTotalAds()}:null},getPpidValue:function(t){var e=t.getSessionOption("userPPID");return window.uvpjs.util.isDefinedString(e)?e:null},initMoatTracking:function(t,e,i,s,n){var r,a,o,l=window.document.createElement("script"),d=[];e={adData:{ids:e,duration:i,url:n},dispatchEvent:function(t){this.sendEvent?(d&&(d.push(t),t=d,d=!1),this.sendEvent(t)):d.push(t)}},o="_moatApi"+Math.floor(1e8*Math.random());try{a=(r=t.ownerDocument).defaultView||r.parentWindow}catch(t){a=window}return a[o]=e,l.type="text/javascript",t&&t.insertBefore(l,t.childNodes[0]||null),l.src="https://z.moatads.com/"+s+"/moatvideo.js#"+o,e},getVpaidEventForEvent:function(t,e){var i=this.moatEventMapping[e][t];return window.uvpjs.util.isEmpty(i)?null:this.vpaidEvents[i]}}}(window.uvpjs.register("uvpjs")),function(t){"use strict";window.uvpjs.Configuration={env:"prod",hostname:"vidtech.cbsinteractive.com",name:"UVPJS",version:"3.0.0",date:"12/06/19 10:32:04 AM (PST)",path:"//vidtech.cbsinteractive.com/uvpjs/3.0.0/",playerName:"CBSI-PLAYER"}}(),window.uvpjs.register("uvpjs").AutoplayDetectionService=window.uvpjs.Class.subClass({init:function(t){this.mc=t.mediaCapabilities,this.completeCallback=t.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=t.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(t,e){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:t,supportsMutedAutoplay:e})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(t,e){this.killVid(),this.setInfo(t,e),window.setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var t,e;this.vidEl=e=this.createVideoElement(!1),e.load(),void 0===(t=e.play())?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):t.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var t;this.killVid(),this.checkForEarlySafari()?this.finishCheck(!1,!1):(this.vidEl=t=this.createVideoElement(!0),t.load(),t.play().then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1)))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var t=this.mc.getBrowserName()===this.mc.SAFARI,e=this.mc.isDesktop(),i=t&&e?this.mc.getBrowserVersion():null,s=i&&i.split("."),n=s?11===window.parseInt(s[0])&&0===window.parseInt(s[1]):null;return null!==i&&n&&(!s[2]||window.parseInt(s[2])<3)},detectMobileCapabilities:function(){var t=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(!1,t)},isAutoplayEligibleAndroid:function(){return this.mc.isAndroid()&&this.mc.isChrome()&&this.isChromeAutoplayEligible()},isAutoplayEligibleIos:function(){var t=this.mc.isIOSTen(),e=t&&this.mc.isSafari(),i=t&&!e&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return e||i},isChromeAutoplayEligible:function(){return window.parseInt(this.mc.getBrowserMajorVersion())>=54},createVideoElement:function(t){var e=window.document.createElement("video");return t&&(e.muted=!0,e.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(e,!0),e.volume=.005,e.style.width="100%",e.style.height="100%",e.src=this.testVidPath,this.testDom.appendChild(e),e},createTestDom:function(){var t=window.document.createElement("div"),e=t.style,i="-1000px";return e.position="absolute",e.top=i,e.left=i,e.width="320px",e.height="180px",window.document.body.appendChild(t),t}}),window.uvpjs.MediaCapabilities=function(){var t,e,i,s,n,r,a,o,l,d,u,h,c,p=window.uvpjs._,f=window.uuid.noConflict(),v=!1,g={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLACEHOLDER_M3U8_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLACEHOLDER_MP4_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",MP4_BLANK_FILE:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLATFORM_OUTLET_ACCOUNT_ID:"dJ5BDC",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"http://can.cbs.com/thunder/player/videoManifest.php?assetType=HLS&authn=",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",FIREFOX_IOS:"FxiOS",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",FACEBOOK_IOS:"Facebook Browser iOS",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(e,i){var r=this.systemInfo;return typeof e===this.STRING?t=e:t=window.navigator.userAgent||null,s=window.document.createElement(this.VIDEO),n=window.document.createElement(this.AUDIO),this.BOOLEAN,_(),y(),k(),v="https:"===window.location.protocol,r.browser=this.getBrowserName(),r.version=window.parseInt(this.getBrowserMajorVersion()),r.isMobile=this.isMobile(),r.isDesktop=this.isDesktop(),r.os=this.getOS()+"; ver. "+this.getOSVersion(),r.supportsMse=this.hasMediaSourceSupport(),r.isHlsjsEligible=this.canPlayHLSJS(),r.supportsNativeHls=this.canPlayNativeHLS(),r.supportsMp4=this.canPlayH264(),r.supportsDash=this.canPlayDASH(),this.canUseDataUrl()||(this.PLACEHOLDER_MP4_URL=this.MP4_BLANK_FILE),this},canUseDataUrl:function(){return!1},determineAutoplayCapabilities:function(t){var e;null===this.systemInfo.supportsUnmutedAutoplay?(e=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,t()}.bind(this),this.apDetectionService=new window.uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:e,testVidPath:this.PLACEHOLDER_MP4_URL})):t()},setTrackingInfo:function(t){var e,i,s=window.uvpjs.tracking,n={};for(i in s)e=s[i],n[i]=!!t[e];this.systemInfo.trackingAvailability=n},setAutoplayInfo:function(t){this.systemInfo.supportsUnmutedAutoplay=t.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=t.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return f.v1().replace(/-/g,"")},checkBrowserName:function(t){return typeof t===this.STRING&&this.getBrowserName()===t},canPlayHTML5Video:function(){var t=window.document.createElement(this.VIDEO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var t=window.document.createElement(this.AUDIO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},getBrowserName:function(){return u||"unknown"},getBrowserVersion:function(){return h||-1},getBrowserMajorVersion:function(){return c||-1},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(t,e){if(typeof e===this.OBJECT){var i=e.exec(this.getUserAgent()),s="",n="";if(i&&typeof i===this.OBJECT&&i.length&&i.length>1){if((s=i[1]||"").indexOf(".")){var r=s.split(".");"object"==typeof r&&r.length&&r.length>0&&(n=r[0])}else n=s;return u=t,h=s,c=n,!0}}return!1},hasTealium:function(){return p.has(window,"utag")||p.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in window.document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)||this.checkBrowserName(this.FIREFOX_IOS)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(t){return typeof t===this.STRING&&(this._detectEnvironment(t),!0)},getUserAgent:function(){return t},getMimeTypesObj:function(){return e||(typeof window.navigator===this.OBJECT&&window.navigator.mimeTypes&&window.navigator.mimeTypes.length>0&&(e=window.navigator.mimeTypes),e)},getMimeTypes:function(){if(typeof i===this.OBJECT)return i;var t={length:0},e=this.getMimeTypesObj();if(typeof e===this.OBJECT){for(var s=0;s<this.length;s++){var n=e[s].enabledPlugin&&e[s].enabledPlugin.name?e[s].enabledPlugin.name:"";t[e[s].type]={type:e[s].type,description:e[s].description,suffixes:e[s].suffixes,enabledPlugin:e[s].enabledPlugin,enabledPluginName:n},t.length++}return i=t}},getPlatform:function(){return typeof a===this.STRING?a:null},getOS:function(){return typeof o===this.STRING?o:null},getOSVersion:function(){return typeof l===this.STRING?l:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())>=0},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof d===this.BOOLEAN?d:d=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return S()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){if(null===this.hasMse){var t=window.MediaSource||window.WebKitMediaSource,e=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;this.hasMse=!(!i||!s)}return this.hasMse},canPlayHLSJS:function(t){var e=this.isMobile(),i=!!S(),s=this.hasMediaSourceSupport(),n=this.isFirefox()||this.isChrome(),r=this.isIE()&&this.getBrowserMajorVersion()>=11||this.isEdge(),a=this.isOpera()&&this.getBrowserMajorVersion()>=30,o=this.isPlaystation();return!(!s||!i||o||e&&!this.canPlayHlsjsAndriod(t))&&(!!t||n||r||a)},canPlayHlsjsAndriod:function(t){var e=this.getUserAgent();return!!(e.indexOf("Android")>=0&&window.parseFloat(e.slice(e.indexOf("Android")+8))>=5&&t)},canPlayNativeHLSAudio:function(){return b()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return S()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return S()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return S()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(t,e){return S()&&this.canPlayMediaType(this.VIDEO,t,e||!1)},canPlayAudioType:function(t,e){return S()&&this.canPlayMediaType(this.AUDIO,t,e||!1)},canPlayMediaType:function(t,e,i){var s=t===this.AUDIO?window.document.createElement(this.AUDIO):window.document.createElement(this.VIDEO);return i=1==i,!(typeof s!==this.OBJECT||typeof s.canPlayType!==this.FUNCTION||!(i&&s.canPlayType(e)===this.PROBABLY||!i&&""!==s.canPlayType(e)))},canPlayType:function(t,e){e=1==e;var i=/audio\//.test(t)?window.document.createElement(this.AUDIO):window.document.createElement(this.VIDEO);return!(typeof i!==this.OBJECT||typeof i.canPlayType!==this.FUNCTION||!(e&&i.canPlayType(t)===this.PROBABLY||!e&&""!==i.canPlayType(t)))},nativeCanPlayType:function(t,e){var i=t===this.AUDIO?window.document.createElement(this.AUDIO):window.document.createElement(this.VIDEO);return typeof i===this.OBJECT&&typeof i.canPlayType===this.FUNCTION&&i.canPlayType(e)||null},canPlayDASHType:function(t){if(typeof t!==this.STRING||t.length<1)return null;var e=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(t)&&this.hasMSE()&&e.isTypeSupported(t)},canPlayDASH264:function(t){return t=typeof t===this.STRING?t:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(t)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var t=this.getUserAgent();return t&&!(this.isChromecast()||this.isIOS()||t.indexOf("Android 2.")>-1||t.indexOf("Android 4.0")>-1||t.indexOf("Android 4.1")>-1)},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(t){return!(t&&this.supportsAutoplay()||this.isChromecast()||this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(t){return t&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(t){return!t&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(t,e){var i=this.getInlinePlayAttribute(),s=i&&i.name;e&&i?i&&t.setAttribute(s,i.value):!e&&s&&t.removeAttribute(s)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&window.parseInt(this.getBrowserVersion())>=10},getPreferredPlaceholderURL:function(){return this.isIOS()?this.PLACEHOLDER_M3U8_URL:this.PLACEHOLDER_MP4_URL},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var t="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return t&&!t.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof window.google},getStandaloneMode:function(){return window.navigator.standalone||null},hasNativeFullscreen:function(){return!window.uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var t,e;return void 0===this._hasFullscreenApiSupport&&(this.isIOS()?this._hasFullscreenApiSupport=!1:(t=window.document.createElement("div"),e=window.uvpjs.util,this._hasFullscreenApiSupport=!!(e.isFunction(t.requestFullscreen)||e.isFunction(t.webkitRequestFullscreen)||e.isFunction(t.mozRequestFullScreen)||e.isFunction(t.msRequestFullscreen)))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(t){var e=window.document,i=this.supportsFullscreenApi()&&(e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled);return!i&&(i=t&&t.webkitSupportsFullscreen),i},getDevice:function(){return r||null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var t=this.isIOS();return!t||t&&window.parseInt(this.getBrowserVersion())>=10},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||window.navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(t){return/\.m3u|assetType=hls/i.test(t)},isDashUrl:function(t){return/\.mpd/i.test(t)},isSecure:function(){return v},setUrlProtocol:function(t){return v?t.replace("http:","https:"):t},getDrmType:function(t){var e="none";return t.enabled?((this.isIOS()||this.isSafari())&&null!==t.fairplay.appCertURL?e="Fairplay":(this.isIE()||this.isEdge())&&null!==t.dash.playreadyURL?e="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==t.dash.widevineURL&&(e="Widevine"),e):e}},_=function(){var t=new RegExp(/\s(\([^)]+\))/).exec(g.getUserAgent());t&&t.length&&t.length>1&&(t=t[1].replace(/_/gi,"."),m(t)||A(t)||E(t)||I(t))},E=function(t){return(-1!==t.indexOf(g.LINUX)||-1!==t.indexOf(g.ANDROID))&&(a=g.LINUX,-1!==t.indexOf(g.ANDROID)&&(t=new RegExp(/\ Android\ ([^\s]+);/).exec(t),r=g.ANDROID,o=g.ANDROID,l=t&&t[1]?t[1]:""),!0)},m=function(t){if(-1!==t.indexOf(g.MAC))return a=g.MAC,r=g.DESKTOP,-1!==t.indexOf(g.OSX)&&(t=new RegExp(/Mac\ OS\ X\ ([\d\.]+)/).exec(t),o=g.OSX,l=t&&t[1]?t[1]:null),!0;if(-1!==t.indexOf("like Mac OS X")){a=g.MAC,o=g.IOS;var e=/\sOS\s([^\s]*)\s/.exec(t);if(e&&e[1]&&(l=e[1]),/\(iPhone;/.test(t))r=g.IPHONE;else if(/\(iPad;/.test(t))r=g.IPAD;else{if(!/\(iPod;/.test(t))return!1;r=g.IPOD}return!0}return!1},A=function(t){var e=new RegExp(/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/);if((t=e.exec(g.getUserAgent()))&&t[2])return a=g.WINDOWS,o=g.WINDOWS_PHONE,l=t[2],r=g.PHONE,!0;if((t=(e=new RegExp(/Windows\ NT\ ([^\s]+)[;\)]/)).exec(g.getUserAgent()))&&t[1]){a=g.WINDOWS,o=g.WINDOWS;var i=t[1];return 6==i?o=g.WINDOWS_VISTA:6.1==i?(o=g.WINDOWS7,l=7):6.2==i?(o=g.WINDOWS8,l=8):10==window.parseInt(i)&&(o=g.WINDOWS10,l=i),r=g.DESKTOP,!0}return!1},y=function(){return!!(T()||C()||R()||P()||M()||O()||L()||D()||N())},S=function(){return s},b=function(){return n},T=function(){var t=/Chrome\/(\S+)/,e=/CriOS\/(\S+)/,i=g.getUserAgent(),s=e.test(i);return!(!t.test(i)&&!s||/(Opera|OPR)/.test(i)||/Edge/.test(i)||/CrKey/.test(i)||(g.setBrowserVersion(g.CHROME,s?e:t),0))},D=function(){var t=/Playstation (\S+)/i;return!!t.test(g.getUserAgent())&&(g.setBrowserVersion(g.PLAYSTATION,t),!0)},I=function(){return null!=g.getUserAgent()&&g.getUserAgent().indexOf(g.CHROMECAST_USER_AGENT)>-1&&(a=g.LINUX,r=g.CHROMECAST,o=g.ANDROID,!0)},C=function(){var t=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,e=/\ Edge\/([^\s]+)/,i=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return t.test(g.getUserAgent())?(g.setBrowserVersion(g.IE,t),!0):e.test(g.getUserAgent())?(g.setBrowserVersion(g.EDGE,e),!0):!!i.test(g.getUserAgent())&&(g.setBrowserVersion(g.IE,i),!0)},R=function(){var t=/Firefox\/(\S+)/,e=/FxiOS\/(\S+)/,i=g.getUserAgent(),s=e.test(i),n=!s&&t.test(i)?g.FIREFOX:s?g.FIREFOX_IOS:null;return!!n&&(g.setBrowserVersion(n,s?e:t),!0)},P=function(){var t,e=/Version\/(\S+).*Safari\//,i=e.test(g.getUserAgent());return t=o===g.ANDROID?g.ANDROID:g.SAFARI,!!i&&(g.setBrowserVersion(t,e),!0)},M=function(){var t=new RegExp(/Opera|OPR\/(\S+)/).exec(g.getUserAgent());if(t){var e=-1!==t.indexOf("Opera Mini/")||-1!==t.indexOf("Opera Mobi")?g.OPERA_MOBILE:g.OPERA;return g.setBrowserVersion(e,/Opera|OPR\/(\S+)/),!0}return!1},O=function(){return!!/Silk/i.test(g.getUserAgent())&&(g.setBrowserVersion(g.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},L=function(){return!!/Android/.test(g.getUserAgent())&&(u=g.ANDROID_BROWSER,!0)},N=function(){var t=g.getUserAgent();if(!/FBAN/.test(t))return!1;var e=function(t){var e=t.match(/\[(.*)\]/),i=null,s={};return e&&e.length>0&&(i=e[1]),i.split(";").forEach(function(t){var e=t.split("/");e.length>0&&(s[e[0]]=e[1])}),s}(t);return e.FBSN&&(o=e.FBSN),e.FBSV&&(l=e.FBSV),!(!e.FBAN||!/iOS/i.test(e.FBAN)||(u=g.FACEBOOK_IOS,0))},k=function(){var t=S(),e=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],i=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"],s=null;g.isIOS()?s=i:t.requestFullscreen?s=e:t.webkitRequestFullscreen?s=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:t.mozRequestFullScreen?s=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:t.msRequestFullscreen?g.getBrowserVersion()<12?s=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(s=e.slice())[5]=null:g.isAndroid()&&(s=i),function(t,e){t._fullscreenEventName=e?e[0]:null,t._fullscreenEnterEventName=e?e[1]:null,t._fullscreenExitEventName=e?e[2]:null,t._enterFullscreenMethodName=e?e[3]:null,t._exitFullscreenMethodName=e?e[4]:null,t._isFullscreenPropertyName=e?e[5]:null,t._fullscreenElementName=e?e[6]:null,t._fullscreenErrorEventName=e?e[7]:null}(g,s)};return g},window.uvpjs.mediaCapabilities=window.uvpjs.MediaCapabilities()._detectEnvironment(),window.uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(t){var e=window.uvpjs._,i=window.uvpjs.mediaCapabilities;this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,e.isObject(t)?(this.cookie=this._getCookie(),this.CDO=t,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=i.isChrome()||i.isFirefox()||i.isSafari(),this.setSessionStartTime()):this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.")},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(t,e,i){this.debugCount++;var s=window.uvpjs._;if(this.isEnabled||s.isUndefined(this.CDO)){if(!s.isString(t)||!s.isString(e)||s.isUndefined(i))return void console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+i,e);if(this.showAll||s.isUndefined(this.CDO)||this.isParamEnabled(e)||!0===this.cookie[e]){var n=this.showTimestamps?"["+this._timestamp()+"] ":"",r=s.drop(arguments,3),a=s.isEmpty(r)?"":r,o={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[t]("%sUVPJS %s %s",n,e,i,a);console[t]("%s%cUVPJS %c%s%c %s",n,o.bold,o.underline,e,o.normal,i,a)}}},isParamEnabled:function(t){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,t)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var t=window.uvpjs._,e=new Date-this.adjustedStartTime,i=e%1e3,s=(e=(e-i)/1e3)%60,n=(e=(e-s)/60)%60,r=(e=(e-n)/60)%24-this.adjustedTimezone;return t.padStart(r,2,"0")+":"+t.padStart(n,2,"0")+":"+t.padStart(s,2,"0")+"."+t.padStart(i,3,"0")},_getCookie:function(){var t=this._readCookie(this.COOKIE_NAME),e={};if(!t)return e;window.uvpjs.log(this.DEBUG_ID,"_getCookie cookie",t);try{e=JSON.parse(t)}catch(t){window.uvpjs.error(this.DEBUG_ID,"Error reading cookie.",t)}return window.uvpjs.log(this.DEBUG_ID,"_getCookie obj",e),e},_readCookie:function(t){for(var e=t+"=",i=window.document.cookie.split(";"),s=0,n=i.length;s<n;s++){for(var r=i[s];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(e))return r.substring(e.length,r.length)}return null}},function(t){var e,i=t._;t.DOMManager=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(t){this.debug=window.uvpjs.debug,this.debug&&window.uvpjs.log(this.DEBUG_ID,"init",t),this.mc=null,this._createControls=t.createControls,this._createAds=t.createAds,this._useInlinePlayAttribute=t.useInlinePlayAttribute,this._useMutedAttribute=t.useMutedAttribute,this._DOMReadyCB=t.callback,this._useAutoplayAttribute=t.useAutoplayAttribute,this._userAgent=null,this.adClickElement=null,this.dom=e(),this.dom.outer.id=t.containerID},initialize:function(){window.uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=window.uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var t=this.dom.video.el;t&&t instanceof window.HTMLElement&&(t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeEventListener(this.PLAY,this._handleEvent,!1),t.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return i.clone(this.dom)},createAdClickElement:function(){var t={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};for(var e in this.adClickElement=window.document.createElement("div"),t)this.adClickElement.style[e]=t[e];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(t){this.dom.ad.el&&(this.dom.ad.el.style.display=t?"block":"none")},showAdClickElement:function(t){this.adClickElement&&(this.adClickElement.style.display=t?"inline-block":"none")},getAdClickElement:function(){return this.adClickElement||this.createAdClickElement(),this.adClickElement},_disableVideoContextMenu:function(){var t=this.dom.video.el;t.addEventListener?t.addEventListener("contextmenu",function(t){t.preventDefault()},!1):t.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var t=this.dom;t.outer.el=window.document.getElementById(t.outer.id),i.isNull(this.dom.outer.el)?this.debug&&window.uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",t.outer.id):(t.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),t.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),t.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),t.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),t.content.el=this._getOrCreateElement("content"),t.outer.el.insertBefore(t.content.el,t.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),t.ad.el=this._getOrCreateElement("ad"),t.outer.el.insertBefore(t.ad.el,t.content.el.nextSibling)),this._createControls?(t.controls.el=this._getOrCreateElement("controls"),t.outer.el.appendChild(t.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB())},_createVideoElement:function(){var t,e=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),i=window.document.querySelectorAll(e);if(i instanceof window.NodeList&&i[0]instanceof window.HTMLElement&&i[0].id)this._checkVideoTagAttributes(i);else{if(e=[this.dom.outer.id,this.dom.video.id].join(" "),(i=window.document.querySelectorAll(e))instanceof window.NodeList&&i[0]instanceof window.HTMLElement){if(i[0].id)return;return i[0].id=this.dom.video.id,void this.dom.content.el.appendChild(i[0])}t=this._getOrCreateElement("video"),this._checkVideoTagAttributes(t),this.dom.content.el.appendChild(t),this.dom.video.el=t}},_createPlaceholderContent:function(){var t=this.dom.video.el;window.uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||i.isNull(this._userAgent)&&this.mc.isIPhone()?t.innerHTML='<source src="'+this.dom.video.url+'">':t.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),t.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY,this._handleEvent,!1),t.addEventListener(this.PLAY,this._handleEvent,!1),t.addEventListener(this.PAUSE,this._handleEvent,!1),t.style.width="100%",this._DOMReadyCB()},_handleEvent:function(t){var e=this.dom.video.el;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_handleEvent",t),!i.isNull(e)){var s=this._useSeparateTags?e.getElementsByTagName("source")[0]:e;if(!i.isNull(s)){if(t.type===this.LOADED_METADATA&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&window.uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,t.target),e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===s.src.indexOf(this.dom.video.url))return e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeEventListener(this.PLAY,this._handleEvent,!1),void e.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&window.uvpjs.log(this.DEBUG_ID,"removeEventListener",t.type),t.type){case this.CAN_PLAY:e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(e.removeEventListener(this.PLAY,this._handleEvent,!1),e.pause(),!i.isFunction(this.dom.video.callback)){this.debug&&window.uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:e.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(t){this._useMutedAttribute&&t.setAttribute("muted","muted"),this._useAutoplayAttribute&&t.setAttribute("autoplay","autoplay"),this.mc.setVideoForInlinePlay(t,this._useInlinePlayAttribute)},_addInlineStyles:function(){if(this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds){var t=this.dom.ad.el;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0"}},_getIdByPrefix:function(t){if(!i.isNull(t))return window.uvpjs.domConstants[t]+this.dom.outer.id},_getOrCreateElement:function(t){var e=this.dom[t],s=window.document.getElementById(e.id);return i.isNull(s)&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"Creating element <"+e.type+' id="'+e.id+'">.'),(s=window.document.createElement(e.type)).id=e.id),s}}),e=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}}}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.CVI_Model=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:window.uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,uvpc:null,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,audioInfo:{},bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:window.uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:window.uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:window.uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=window.uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=window.uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=window.uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(t,i,s,n){e.isString(t)&&e.isObject(i)&&e.isObject(s)?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+t),this.vidContId=t,this.cviMgr=i,this.CDO=s,this.sessionOptions=n,this.eventsMgr=i.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()):this.debug&&window.uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN")},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(t){if(e.isPlainObject(t)&&t.target===this.vidContId&&e.isNumber(t.payload.newState)){this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+t.payload.newState);var i=t.payload.newState;i!==window.uvpjs.mediaCapabilities.EMPTY&&i!==window.uvpjs.mediaCapabilities.LOADING&&i!==window.uvpjs.mediaCapabilities.STOPPED&&i!==window.uvpjs.mediaCapabilities.PLAYING&&i!==window.uvpjs.mediaCapabilities.PAUSED&&i!==window.uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=i,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(t){var e=t.payload;t.target===this.vidContId&&(this.isCurrVideoAd=e.isAd,this.playbackState=e.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=e.currentTime,this.adPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.adPlaybackState.duration=e.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=e.playbackStarted,this.adPlaybackState.playbackComplete=e.playbackComplete,this.adPlaybackState.sourceBitrate=e.sourceBitrate,this.adPlaybackState.playbackBitrate=e.playbackBitrate,this.adPlaybackState.errorInfo=e.errorInfo,this.adPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=e.currentTime,this.contentPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=e.playbackStarted,this.contentPlaybackState.playbackComplete=e.playbackComplete,this.contentPlaybackState.sourceBitrate=e.sourceBitrate,this.contentPlaybackState.playbackBitrate=e.playbackBitrate,this.contentPlaybackState.videoFramerate=e.videoFramerate,this.contentPlaybackState.isSeeking=e.isSeeking,this.contentPlaybackState.isHDStreamLive=e.isHDStreamLive,this.contentPlaybackState.isPlayingLive=e.isPlayingLive,this.contentPlaybackState.currentContentSegment=e.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=e.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=e.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.contentPlaybackState.bufferLength=e.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=e.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&e.isNumber(t.payload.vol)&&(this.volume=t.payload.vol,this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.isFullscreen=t.payload.isFs)},onContextMetadata:function(t){!e.isPlainObject(t)||t.target!==this.vidContId||e.isPlainObject(t.target.contextMetadata)},onResourceStart:function(t){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){e.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){e.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){e.assign(this.contentVideoState,this.contentVideoStateDefaults)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(t){this.CDO.setAdCallParams(t)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var t=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof t&&t.length?t:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(t){var i=void 0;return t&&e.isString(t)&&this.hasOwnProperty(t)&&!e.isFunction(this[t])&&(i=this[t]),i},getModule:function(t){if(e.isString(t))return this.CDO.getModule(t)},getModuleParam:function(t,i){if(e.isString(t)&&e.isString(i))return this.CDO.getModuleParam(t,i)},getModules:function(){return this.CDO.getModules()},copyModules:function(t){this.CDO.copyModules(t)},isModuleEnabled:function(t){return!(!t||!e.isString(t))&&this.CDO.isModuleEnabled(t)},isModuleSet:function(t){return!window.uvpjs.util.isEmpty(t)&&this.CDO.isModuleSet(t)},getSessionOption:function(t){return t?this.sessionOptions[t]:null},getClass:function(t){if(e.isString(t))return this.CDO.getClass(t)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(t,e){return this.CDO.getClassProperty(t,e)},getClassListItems:function(t){return this.CDO.getClassListItems(t)},getClassListItemProperty:function(t,e,i){return this.CDO.getClassListItemProperty(t,e,i)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var t={};return e.assign(t,this.contentVideoState),t},getAdVideoState:function(){var t={};return e.assign(t,this.adVideoState),t},getContentPlaybackState:function(){var t={};return e.assign(t,this.contentPlaybackState),t},getAdPlaybackState:function(){return e.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(t){this.contentVideoState.abrInfo=t,this.contentPlaybackState.abrInfo=t},setAdVideoState:function(t){this.adVideoState=e.assign({},this.adVideoStateDefaults,t||{})},setContentVideoStateItems:function(t){this._addItemsToInstanceObj("contentVideoState",t)},setContentPlaybackStateItems:function(t){this._addItemsToInstanceObj("contentPlaybackState",t)},setAdVideoStateItems:function(t){this._addItemsToInstanceObj("adVideoState",t)},setAdPlaybackStateItems:function(t){this._addItemsToInstanceObj("adPlaybackState",t)},setNonDefaultContentVideoStateItems:function(t){this.setContentVideoStateItems(this._removeDefaults(t,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(t){this.setAdVideoStateItems(this._removeDefaults(t,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},getVideoPlaybackCDOProperty:function(t){var e=this.VIDEO_PLAYBACK_SETTINGS,i=this.isModuleEnabled(e),s=this.getModuleParam(e,t);if(i&&s)return s},setAbrStartBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==t&&this.setStartBitrate(t)},setAbrMinBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==t&&this.setMinBitrate(t)},setAbrMaxBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==t&&this.setMaxBitrate(t)},setLiveSyncDurationCountFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==t&&this.setLiveSyncDurationCount(t)},setCapLevelToPlayerSizeFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==t&&this.setCapLevelToPlayerSize(t)},setDashJSFastSwitchABRFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==t&&this.setDashJSFastSwitchABR(t)},setStartBitrate:function(t){this.startBitrate=t,this.setContentPlaybackStateItems({startBitrate:t}),this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(t){this.minBitrate=t,this.setContentPlaybackStateItems({minBitrate:t}),this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(t){this.maxBitrate=t,this.setContentPlaybackStateItems({maxBitrate:t}),this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(t){this.liveSyncDurationCount=t,this.setContentPlaybackStateItems({liveSyncDurationCount:t}),this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(t){this.capLevelToPlayerSize=t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(t){this.enableDashJSFastSwitchABR=t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setAudioTrackInfo:function(t){this.contentPlaybackState.audioInfo=t},getAudioTrackInfo:function(){return this.contentPlaybackState.audioInfo},setErrorRecovery:function(t){this.errorRecovery=t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(t){this.useDynamicSwitching=t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var t=this;e.forOwn(this.sessionOptions,function(i,s){if(e.isString(i))return e.has(t.contentVideoState,s)?void(t.contentVideoState[s]=i):e.has(t.adVideoState,s)?void(t.adVideoState[s]=i):void 0}),this.debug&&(window.uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),window.uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(t,i){return e.omitBy(t,function(e,s){return t[s]===i[s]})},_addItemsToInstanceObj:function(t,i){var s,n,r;if(s=this[t])if(e.isObject(i))for(n in this.debug,s)r=i[n],!i.hasOwnProperty(n)||e.isUndefined(r)||e.isFunction(r)||(s[n]=r);else this.debug&&window.uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",i);else this.debug&&window.uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+t)}})}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.CodeLoader=window.uvpjs.Class.subClass({init:function(){this.debug=window.uvpjs.debug,this._setUrlProtocol=window.uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,window.clearTimeout(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(t,i,s){var n,r;for(this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadScript urls",t),this.scriptsLoadedCB=i,this.timeout=s||this.REQUEST_TIMEOUT,e.isString(t)&&this.urls.push(t),e.isArray(t)&&(this.urls=t),r=this.urls.length,n=0;n<r;n++)this._getScript(this.urls[n])},_getScript:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_getScript url",t);var i=this,s=function(t,s){e.isFunction(i._onScriptLoaded)&&!i._onScriptLoaded.done?(i.urls=e.without(i.urls,t),i._onScriptLoaded({url:t,error:s})):i.debug&&window.uvpjs.warn(i.DEBUG_ID,"_getScript _doCallback callback not a function or already called.")},n=window.document.createElement("script");n.src=this._setUrlProtocol(t),n.async=!0,n.onreadystatechange=n.onload=function(){n.readyState&&!/loaded|complete/.test(n.readyState)||s(t)},n.onerror=function(e){window.uvpjs.error(i.DEBUG_ID,"_getScript "+e.target.src+" is not accessible."),s(t,e)},window.document.querySelector("head").appendChild(n),this.timeoutHandle=window.setTimeout(function(t){-1===e.indexOf(i.urls,t)||(this.debug&&window.uvpjs.warn(i.DEBUG_ID,"_getScript request timeout"),s(t,"timeout"))}.bind(this,t),this.timeout)},_onScriptLoaded:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var i=e.isEmpty(this.urls);this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),i&&e.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(t))},createCORSRequest:function(t,e){var i=new XMLHttpRequest;return e=this._setUrlProtocol(e),"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof window.XDomainRequest?(i=new window.XDomainRequest).open(t,e):i=!1,i},loadXHR:function(t,i,s,n){var r,a;if(t=this._setUrlProtocol(t),!1===(r=this.createCORSRequest("GET",t)))return a="loadXHR CORS not supported for url = "+t,window.uvpjs.warn(this.DEBUG_ID,a),void s(r);n&&!window.uvpjs.util.isEmpty(n)&&(r.responseType=n),r.timeout=this.REQUEST_TIMEOUT,r.onload=function(){e.inRange(r.status,200,400)?i(r):s(r)},r.onerror=function(){s(r)},r.ontimeout=function(){s(r)},r.send()},loadXML:function(t,e,i){this.loadXHR(t,e,i,"document")},loadArrayBuffer:function(t,e,i){this.loadXHR(t,e,i,"arraybuffer")}})}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.CoreVideoInstanceManager=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t){var e=t.vidContId;if(!t.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=window.uvpjs.debug,this.vidContId=e,this.eventsMgr=t.eventsMgr,this.cviModel=new window.uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=t.readyCallback,this.cachedOptions={suppressFacadePlay:t.suppressFacadePlay,deferLoadingCaptions:t.playerOptions.deferLoadingCaptions},this.cviModel.initialize(e,this,t.CDO,t.playerOptions),this.initialPlaybackInfo={},window.setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new window.uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(t){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(t)},setAdCallParams:function(t){this.cviModel.setAdCallParams(t)},setInitialPlaybackType:function(t,e){this.initialPlaybackInfo.isAutoplay=t,this.initialPlaybackInfo.isMuteAtPlayStart=e},setContextMetadata:function(t){this.cviModel.contentVideoState.contextMetadata=t||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(t,e){this.debug&&window.uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var i=this.cachedOptions;this.RPM=new window.uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:i.suppressFacadePlay,p2pClient:t||null,multiCdnClient:e||null,deferLoadingCaptions:i.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new window.uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new window.uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:i.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(t){var i=this.cviModel.getSessionOption("adBlockerCallback"),s=!(!i||!i()),n=this.eventsMgr.eventTypes,r=window.uvpjs.ErrorInfo,a=window.google&&window.google.ima;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+s),s&&this.eventsMgr.dispatchEvent(n.AD_BLOCKED,{errorInfo:new r({eventType:n.AD_BLOCKED,errorCode:r.errorCodes.AD_BLOCKING_DETECTED,message:r.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),s||a){if(a){if(!e.isEmpty(this.imaAdDisplayContainer))return void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed"));this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(t),this.imaAdDisplayContainer.initialize(),this.adsLoader=new window.google.ima.AdsLoader(this.imaAdDisplayContainer);var o=this.adsLoader.getSettings();o.setAutoPlayAdBreaks(!0),o.setVpaidMode(window.google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(window.google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(window.google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}}else this.eventsMgr.dispatchEvent(n.PLAYER_START_ERROR,{errorInfo:new r({eventType:n.PLAYER_START_ERROR,errorCode:r.errorCodes.IMA_SDK_MISSING,message:r.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId)},_createIMAAdDisplayContainer:function(t){var e,i;return this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=window.document.getElementById(window.uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),e=window.document.getElementById(window.uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId).getElementsByTagName("video")[0],i=new window.google.ima.AdDisplayContainer(this.adVideoDiv,e,t),this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",t),this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",i),i},onAdsManagerLoaded:function(t){var e,i=window.uvpjs.util,s=i.isEmpty(this.RPM),n=i.isEmpty(this.RPM.currRP),r=this.RPM.currRP.getProviderType()!==window.uvpjs.mediaCapabilities.RP_IMA;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",t),s||n||r)return e="CVI mgr: onAdsManagerLoaded; ",e+=s?"no RPM found":n?"no current RP found":"RP not of type RP_IMA",this.debug&&window.uvpjs.log(this.DEBUG_ID,e),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:window.uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+e,isFatal:!1})},this.vidContId);this.RPM.currRP.onAdsManagerLoaded(t)},onAdError:function(t){var i=!e.isEmpty(this.RPM)&&this.RPM,s=i&&!e.isEmpty(i.currRP)&&i.currRP;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",t),!i||!s)return this.debug&&window.uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:window.uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId);"function"==typeof s.handleAdsLoaderError&&s.handleAdsLoaderError(t)},destroyIMAAdsLoader:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&window.uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(window.google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(window.google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),this.RPM.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,{},this.vidContId)},seekToRequest:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"seekToRequest = "+t),e.isNaN(t)?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+t):(-1===t&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:t},this.vidContId))},seekToLiveRequest:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",t),e.isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:t},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",t),e.isString(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:t},this.vidContId)},showCaptionsRequest:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{language:t},this.vidContId)},setCaptionLanguage:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SET_CAPTIONS_LANG,{language:t},this.vidContId)},hideCaptionsRequest:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},getCaptionInfo:function(){return this.captionsMgr.getCaptionInfo()},setCaptionsStyleRequest:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",t),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(t):this.captionsMgr.setStyles(t)},setCaptionsCuePropertyRequest:function(t,e){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",t,e),this.captionsMgr.setCueProperty(t,e)},getCaptionsStyleRequest:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},getAudioTrackInfo:function(){return this.cviModel.getAudioTrackInfo()},setAudioTrack:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_AUDIO_TRACK,{id:t})},resizeRequest:function(t,i){this.debug&&window.uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+t+"  height = "+i),!e.isNaN(t)&&!e.isNaN(i)&&t>=0&&i>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:t,height:i},this.vidContId)},fullscreenRequest:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",t),e.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:t},this.vidContId)},setUserGesture:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:t},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",t),e.isPlainObject(t)},setNativeControls:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",t),e.isBoolean(t)&&(this.cviModel.nativeControls=t)},createPauseAdRetriever:function(){var t=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),e={eventsMgr:this.eventsMgr,adCallUrl:t,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};return t?window.uvpjs.PauseAdRetriever?void(this.pauseAdRetriever=new window.uvpjs.PauseAdRetriever(e)):void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path.")):void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+t))},checkForPauseAd:function(){var t=this.cviModel.isModuleEnabled("PauseAd"),e=window.uvpjs.Configuration.path+"lib/PauseAdRetriever.js";t&&(window.uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(new window.uvpjs.CodeLoader).loadScript(e,this.createPauseAdRetriever.bind(this)))}})}(window.uvpjs.register("uvpjs")),function(t){t.ErrorInfo=window.uvpjs.Class.subClass({init:function(t){var e=t||{};this.errorCode=e.errorCode||null,this.eventType=e.eventType||null,this.isFatal=!!e.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=e.message||null,this.adInfo=e.adInfo||null,this.serverCode=e.serverCode||null,this.hlsjsErrorCode=null}}),t.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},t.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."}}(window.uvpjs.register("uvpjs")),function(t){var e=t._,i=Math.random();t.EventsManager=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(t){this.debug=window.uvpjs.debug,t&&t===i?(this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)):this.debug&&window.uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance().")},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],window.uvpjs.EventsManager.destroyInstance()},addEventListener:function(t,i){if(t&&e.isString(t)&&i&&e.isFunction(i)){var s=this._returnValidEvtTypeAndNameSpace(t);if(!1!==s){var n=s[0],r=s[1];this.registeredEventsTable[n]||(this.registeredEventsTable[n]={}),this.registeredEventsTable[n][r]?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",n," ns = ",r):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",n," ns = ",r),this.registeredEventsTable[n][r]=i)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+t},this.internalNS)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(t){if(!t||!e.isString(t))return this.debug&&window.uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",t),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var i=this._returnValidEvtTypeAndNameSpace(t);if(!1!==i){var s=i[0],n=i[1];this.registeredEventsTable[s]&&this.registeredEventsTable[s][n]?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",t),delete this.registeredEventsTable[s][n]):this.debug&&window.uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",t)}else this.debug&&window.uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",t)},dispatchEvent:function(t,i,s){var n={};if(t&&e.isString(t))if(e.isUndefined(i)||e.isPlainObject(i))if(e.isUndefined(s)||e.isString(s)){var r=this.registeredEventsTable[t];if(r)for(var a in e.isUndefined(i)&&(i={}),e.isUndefined(s)&&(s=""),n.type=t,n.payload=i,n.target=s,r)r.hasOwnProperty(a)&&r[a](n)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+t+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS)},_returnValidEvtTypeAndNameSpace:function(t){var e=[],i=t.split(".");if(i.length<2)return!1;var s=i[0];i.shift();var n=i.join("_");return!(!this._validateEventType(s)||n.indexOf("undefined")>-1)&&(e[0]=s,e[1]=n,e)},_validateEventType:function(t){var e=!1,i=this.eventTypes;for(var s in i)if(i.hasOwnProperty(s)&&i[s]===t){e=!0;break}return e},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(t){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&window.clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=window.setInterval(this.uvpClockTick.bind(this),t)},destroyUVPJSClock:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&window.clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(t,i,s,n){this.debug&&window.uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",i);var r={};t&&e.isNumber(t)&&i&&e.isString(i)&&s&&e.isFunction(s)&&(!n||e.isNumber(n)||!(n>=1||-1===n))?(t<this.uvpjsClockInterval&&(t=this.uvpjsClockInterval),r={freq:t,ns:i=i.split(".").join("_"),cb:s,rptCnt:-1,nextTime:Date.now()+t},n&&(r.rptCnt=n),this.debug&&window.uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",t),this.timerCBOs.push(r)):this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeTimedEventCallback:function(t,i){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",t+" ns = "+i),t&&e.isNumber(t)&&i&&e.isString(i)){var s,n,r=i.split(".");for(i=r.join("_"),s=this.timerCBOs.length;s--;)(n=this.timerCBOs[s]).freq===t&&n.ns===i&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",n.freq+" CBO.ns = "+n.ns),this.timerCBOs.splice(s,1))}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;var t,e,i=Date.now();for(t=this.timerCBOs.length-1;t>=0;t--)i>=(e=this.timerCBOs[t]).nextTime&&(e.cb(),e.nextTime=i+e.freq,-1!==e.rptCnt&&(e.rptCnt=e.rptCnt-1,0===e.rptCnt&&this.timerCBOs.splice(t,1)))},eventTypes:{SWITCH_AUDIO_TRACK:"switchAudioTrack",FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:window.uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:window.uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:window.uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:window.uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:window.uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:window.uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:window.uvpjs.EventType.RESOURCE_START,RESOURCE_END:window.uvpjs.EventType.RESOURCE_END,CONTENT_START:window.uvpjs.EventType.CONTENT_START,CONTENT_END:window.uvpjs.EventType.CONTENT_END,AD_LOADED:window.uvpjs.EventType.AD_LOADED,AD_REQUEST:window.uvpjs.EventType.AD_REQUEST,AD_RESPONSE:window.uvpjs.EventType.AD_RESPONSE,AD_START:window.uvpjs.EventType.AD_START,AD_END:window.uvpjs.EventType.AD_END,AD_SKIPPED:window.uvpjs.EventType.AD_SKIPPED,AD_CLICK:window.uvpjs.EventType.AD_CLICK,AD_POD_START:window.uvpjs.EventType.AD_POD_START,AD_POD_END:window.uvpjs.EventType.AD_POD_END,AD_BLOCKED:window.uvpjs.EventType.AD_BLOCKED,AD_BUFFERING:window.uvpjs.EventType.AD_BUFFERING,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:window.uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",SET_CAPTIONS_LANG:"onSetCaptionLang",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:window.uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:window.uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:window.uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:window.uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),t.EventsManager._instance=null,t.EventsManager.destroyInstance=function(){this._instance=null},t.EventsManager.getInstance=function(){return this._instance||(this._instance=new window.uvpjs.EventsManager(i)),this._instance}}(window.uvpjs.register("uvpjs")),function(t){var e="www.nielsen.com";t.AbstractId3Parser=window.uvpjs.Class.subClass({init:function(t){this.findNielsen=t.findNielsen,this.dataCallback=t.dataCallback,this.ownerIds=this.assembleOwnerIds(t.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(t){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(t){for(var e=t.length,i=[];e--;)i[e]=t[e].length;return i},assembleOwnerIds:function(t,i){var s,n,r=[];if("string"==typeof t)for(n=(s=t.split(",")).length;n--;)r.push(s[n].trim());return i&&-1===r.indexOf(e)&&r.push(e),r}})}(window.uvpjs.register("uvpjs")),window.uvpjs.register("uvpjs").FrameId3Parser=window.uvpjs.AbstractId3Parser.subClass({parse:function(t){var e,i=t.length;for(e=0;e<i;e++)t[e].data&&this.findId3(t[e])},findId3:function(t){var e,i,s,n,r,a,o=0,l=t.data;a=this.readStr(l,o,3),o+=3,"ID3"===a&&(o+=3,e=127&l[o++],i=127&l[o++],s=127&l[o++],n=127&l[o++],r=o+((e<<21)+(i<<14)+(s<<7)+n),this.findId3PrivateFrame(t,o,r))},findId3PrivateFrame:function(t,e,i){for(var s,n=t.data;e+8<=i;)s=this.readStr(n,e,4),e+=4,n[e++],n[e++],n[e++],n[e++],n[e++],n[e++],"PRIV"===s&&this.parseFrame(t,e)},parseFrame:function(t,e){for(var i,s,n,r=this.idLengths,a=this.totalIds,o=t.data;a--;)if(n=r[a],(s=this.readStr(o,e,n))===this.ownerIds[a]){e+=n,i="www.nielsen.com"===s?this.parseNielsen(s,o,e):this.readStr(o,++e,o.length),this.dataCallback({name:s,data:i,pts:t.pts});break}},parseNielsen:function(t,e,i){var s=t+this.readStr(e,i,e.length-(i+2));return 249===s.length?s:null},readStr:function(t,e,i){var s="",n=e||0,r=e+i;do{s+=String.fromCharCode(t[n++])}while(n<r);return s}}),window.uvpjs.register("uvpjs").TrackId3Parser=window.uvpjs.AbstractId3Parser.subClass({parse:function(t){if(1===t.length){var e=t[0];if("PRIV"===e.value.key)for(var i=0;i<this.ownerIds.length;i++){var s=this.ownerIds[i];-1!==e.value.info.indexOf(s)&&this.dataCallback({name:s,data:"www.nielsen.com"===s?e.value.info:String.fromCharCode.apply(null,new Uint8Array(e.value.data)),pts:e.startTime})}}}}),function(t){t.SdkLoadManager=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var t={};for(var e in this.historyItems)t[e]=this.historyItems[e];return t},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(t){var e="//79423.analytics.edgesuite.net/js/csma.js";return e=t&&t.getModuleParam("AkamaiQOSPluginJS","libpath")||e,window.uvpjs.mediaCapabilities.isSecure()?[e.replace("edgesuite","edgekey")]:[e]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[window.uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefined:function(){return void 0!==window.ns_&&void 0!==window.ns_.ReducedRequirementsStreamingAnalytics},getPath:function(){return[window.uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[window.uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPath:function(){return["//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js"]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof window.ADB||"undefined"===t._.get(window.ADB,"va.Heartbeat"))},getPath:function(t){var e=window.uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",i=window.uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return t.sessionOptions.usesTealium?[i]:[e,i]}},OzTam:{isDefined:function(){return void 0!==window.OzTAMService},getPath:function(){return[window.uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}}},init:function(t,e){var i=[],s=t.getModules(),n=window.uvpjs.util;if(this.debug=window.uvpjs.debug,this.debug&&window.uvpjs.log(this.DEBUG_ID,"init",t),this.cdo=t,this.initCallback=e,n.isEmpty(s))this.invokeCallbackWithHistory();else{t.getModule("MuxQOSPluginJS")||s.push({name:"MuxQOSPluginJS",enabled:"true"});for(var r=s.length;r--;){var a,o,l=s[r],d=l.name,u=this.sdkModules[l.name];if(l.enabled&&u)if(u.isDefined())this.addToHistory({name:l.name,loaded:!0});else for(o=(a=u.getPath(t)).length;o--;)i.push({name:d,path:a[o]})}n.isEmpty(i)?this.invokeCallbackWithHistory():this.bulkLoad(i)}},invokeCallbackWithHistory:function(){var t=this.initCallback,e=this.getHistory();window.setTimeout(function(){t(e)},1)},bulkLoad:function(t){var e=t,i=[],s=(this.handleAllLoadResults,function(t,s,r){i.push({name:t,result:r}),s.destroy(),0===e.length?this.handleAllLoadResults(i):n()}),n=function(){var t=e.shift(),i=new window.uvpjs.CodeLoader;i.loadScript(t.path,s.bind(this,t.name,i))}.bind(this);n()},handleAllLoadResults:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",t);for(var e=t.length;e--;){var i=t[e];i.result.error&&window.uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+i.result.error),this.addToHistory({name:i.name,loaded:!i.result.error})}this.initCallback(this.getHistory())},addToHistory:function(t){t.name?!1!==this.historyItems[t.name]&&(this.historyItems[t.name]=!t.error&&t.loaded):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"module name not found",t)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}})}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.ResourcePlaylistManager=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(t){this.debug=window.uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=t.p2pClient||null,this.multiCdnClient=t.multiCdnClient||null,this.mc=window.uvpjs.mediaCapabilities,this.suppressFacadePlay=t.suppressFacadePlay,this.deferLoadingCaptions=t.deferLoadingCaptions,this.playlistPaused=!1,!e.isEmpty(t)&&this.initialize(t.vidContId,t.cviMgr)},initialize:function(t,i){this.debug&&window.uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",t),e.isString(t)&&e.isObject(i)?(this.vidContId=t,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()):this.debug&&window.uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS")},setContainers:function(t){this.containers=t},setCaptionStyle:function(t){!window.uvpjs.util.isEmpty(this.currRP)&&this.currRP.setCaptionStyle(t)},onResourceLoadRequest:function(t){if(t.target===this.vidContId){this.debug&&window.uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",t.payload.rcObj),this.playlistPaused=!1;var e=this._createResourceProvider(t.payload.rcObj);this.rscProviders.unshift(e),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(t){if(t.target===this.vidContId){this.debug&&window.uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",t.payload.rcObjs);var i,s,n=t.payload.rcObjs,r=n.length;for(i=0;i<r;i++)s=this._createResourceProvider(n[i]),this.rscProviders.push(s);e.isEmpty(this.currRP)&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(t){if(t.target===this.vidContId){for(var e,i=t.payload.rcObjs,s=i.length,n=this.rscProviders,r=this.usedRPs,a=!1,o=!window.uvpjs.util.isEmpty(this.currRP);s--;)e=i[s],this.removeFromList(e,n),this.removeFromList(e,r),o&&!a&&(a=this.isMatchingResource(e,this.currRP.rco.rcoSeed));a&&this.advancePlaylist()}},removeFromList:function(t,e){for(var i=e.length;i--;)this.isMatchingResource(t,e[i].rco.rcoSeed)&&e.splice(i,1)},isMatchingResource:function(t,e){var i=window.uvpjs.util;return t.type===e.type&&(!i.isEmpty(t.pid)&&t.pid===e.pid||!i.isEmpty(t.assetURL)&&t.assetURL===e.assetURL||!i.isEmpty(t.selectorCall)&&t.selectorCall===e.selectorCall)},onResourcePlaylistPause:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),t.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(t){t.target===this.vidContId&&this.playlistPaused&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,e.isEmpty(this.currRP)&&this.rscProviders.length>0&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(t){t.target===this.vidContId&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(t){t.target===this.vidContId&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),e.isEmpty(this.currRP)||e.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){!e.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),e.isEmpty(this.currRP)||e.isNull(this.currRP.rco)?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(t){var e,i={rco:t,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",t),t.type){case this.mc.RP_URL:e=new window.uvpjs.RP_URL(i);break;case this.mc.RP_PLATFORM:e=new window.uvpjs.RP_Platform(i);break;case this.mc.RP_DAI:e=new(t.useSsb()?window.uvpjs.DaiSsbResourceProvider:window.uvpjs.DaiResourceProvider)(i);break;case this.mc.RP_IMA:e=new window.uvpjs.RP_IMA(i);break;case this.mc.RP_MDIALOG:e=new window.uvpjs.RP_Mdialog(i)}return e},_loadNextRP:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&window.uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),e.isEmpty(this.currRP)||e.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&window.uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&window.uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),!e.isObject(this.currRP))return this.debug&&window.uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist();this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay)},rpDataLoadErrorCB:function(t){this.debug&&window.uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",t.message),this.eventsMgr.dispatchEvent(t.eventType,{errorInfo:t},this.vidContId),this.advancePlaylist()},resourceStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:t},this.vidContId)},resourceEnd:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",t),this.currRP&&this.debug&&window.uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:t,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&window.uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!e.isEmpty(this.currRP)&&e.isNull(this.currRP.rco)&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}})}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.VideoControlInterface=window.uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=window.uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(t,i,s,n,r){var a=!0===r.skin;this.debug&&window.uvpjs.log(this.DEBUG_ID,"initialize vidContId =",t),e.isString(t)&&e.isObject(i)&&e.isObject(s)&&e.isFunction(n)?(this.vidContId=t,this.namespace=".vci_"+t,this.eventsMgr=i,this.CDO=s,this.vciReadyCB=n,this._usesIMA=r.usesIMA,this._loadSkinFlag=a,this._isPreviewBtnInternallyManaged=a,this._isUnmutedAutoplay=r.enableUnmutedAutoplay,this._isMutedAutoplay=r.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!r.useBrowserControls,this.CVI_Mgr=new window.uvpjs.CoreVideoInstanceManager({vidContId:t,eventsMgr:i,CDO:s,playerOptions:r,suppressFacadePlay:this.checkNativeAutoplay(r.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,r)})):this.debug&&window.uvpjs.log(this.DEBUG_ID,"-")},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),window.removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(t){var e={skin:!0===t.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:t.customCSS,enableReplay:t.enableReplay,previewImage:t.previewImage,themeName:t.themeName};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new window.uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:t.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(t.enableNativeMobileAutoplay),callback:this.onDOMReady.bind(this,e)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(window.uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(window.uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(window.uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(window.uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(window.uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(window.uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(t){},onAdStart:function(t){var e=t.payload.adData;this.DOMMgr.showAdContainer(!0),!this.autoplayRestrictionChecked&&this.checkAutoplayRestriction(e),e.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(t){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){if(this.handleFirstGesture(),this.skinMgr){var t=this.skinMgr,e=this.mc.PAUSED;window.setTimeout(function(){t.setPlaystate(e)},200)}},setAdCallParams:function(t){this.CVI_Mgr.setAdCallParams(t)},checkAutoplayRestriction:function(t){this.autoplayRestrictionChecked=!0,!this.contentStartReceived&&"pre"===t.adType&&"ima"===t.adServerName&&this._isMutedAutoplay&&!this.mc.isSingleVideoIma()&&!this.mc.supportsUnmutedAutoplay()&&!this.isPreparedForAutoplay&&(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(t){this.eventsMgr.dispatchEvent(window.uvpjs.EventType.FIRST_GESTURE,t,this.vidContId)},prepForRestrictedAutoplay:function(t){var e=this.dom.video.el,i=function(){this.isPreparedForAutoplay=!0,e.removeEventListener("play",i,!1),e.muted=!1,t&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this);this.debug&&window.uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),e.src=this.mc.getPreferredPlaceholderURL(),e.addEventListener("play",i,!1),e.muted=!0,e.load();var s=e.play();void 0!==s&&s.then(Function.prototype).catch(function(t){console.warn("UVPJS:VCI.prepForRestrictedAutoplay: priming Promise rejected.")})},handleFirstGesture:function(t){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:t||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(t){this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):window.addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new window.uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),this.useBrowserNativeControls||!this._loadSkinFlag?this.onVCIReady():this.skinMgr=new window.uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:t})},checkNativeAutoplay:function(t){return t&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVCIReady"),!this._vciReadySent){if(!this._autoPlay&&this._isPreviewBtnInternallyManaged&&!this._previewButtonDone)return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId);this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)}},loadDynamicAdCall:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),e.isString(t)?this.CVI_Mgr.loadDynamicAdCall(t):this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)")},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(t){return window.uvpjs.log(this.DEBUG_ID,"onPreviewButton"),window.uvpjs.util.isFunction(t)?(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone?(window.uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=t,void this.playBlankVideo()):(window.uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),void t())):void(this.debug&&window.uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function."))},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(t){var e,i;if(!0!==t&&!this.canOverrideUserGesture())return e=window.uvpjs.ErrorInfo,void(i=this.eventsMgr).dispatchEvent(i.eventTypes.PLAYER_START_ERROR,{errorInfo:new e({eventType:i.eventTypes.PLAYER_START_ERROR,errorCode:e.errorCodes.USER_GESTURE_REQUIRED,message:e.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId);this.onPreviewButton(this.onVCIReady.bind(this))},addEventListener:function(t,i){t&&e.isString(t)&&e.isFunction(i)?this.eventsMgr.addEventListener(t,i):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId)},removeEventListener:function(t){t&&e.isString(t)?this.eventsMgr.removeEventListener(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){window.uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(t){var i;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&window.uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,t),void this.playBlankVideo();i=this.createResourceConfig(t),e.isObject(i)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:i},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&window.uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,t),void this.playBlankVideo();if(e.isArray(t)&&t.length>0){var i,s,n=[];for(i in t)s=this.createResourceConfig(t[i]),e.isObject(s)?n.push(s):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);n.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:n},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(t){var e,i,s,n,r,a="",o=!1,l=t.type===this.mc.RP_IMA,d=!1,u=null;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",t),(r=this.prevalidateRcObj(t)).error)return a="Resource configuration error: "+r.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(a,null),!1;switch(t.type){case this.mc.RP_URL:e=window.uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:e=window.uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(a="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",o=!0),d=!0,e=window.uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:e=window.uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:d=!t.useSsb,e=window.uvpjs.DaiRco;break;default:a="VCI createResourceConfig Unknown resource type "+t.type+"; this.vidContId = "+this.vidContId,o=!0}return o?(this.dispatchStartError(a,null),!1):(this.rcoIdIndex++,r=(i=new e(t,this.rcoIdIndex+"_"+this.vidContId,this.vidContId)).getValidationInfo(),d&&this.checkForAdBlocker()?(!0===r.missingSDK&&(u=l?"IMA":"DAI"),this.dispatchAdBlocked(u,!0),!1):r.error?(a="VCI error initializing RCO: "+r.message,s=window.uvpjs.ErrorInfo.errorCodes,!0===r.missingSDK?(n=l?s.IMA_SDK_MISSING:s.DAI_SDK_MISSING,this.dispatchStartError(a,n)):this.dispatchStartError(a,null),!1):(this._replayRco=t,i))},prevalidateRcObj:function(t){var e=window.uvpjs.util,i="",s=!1;return e.isPlainObject(t)?e.isDefinedString(t.type)||(i="Invalid resource type encountered",s=!0):(i="Invalid resource config object format",s=!0),{error:s,message:i}},dispatchStartError:function(t,e){this.debug&&window.uvpjs.error(this.DEBUG_ID,t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:e||window.uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:window.uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+t,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(t,e){var i=t?" (Missing "+t+" SDK)":"";this.debug&&window.uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+i,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:window.uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:window.uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+i,isFatal:!!e})},this.vidContId)},checkForAdBlocker:function(){return window.uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(t){e.isArray(t)&&t.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:t},this.vidContId)},destroyPlaylist:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest()},replayVideo:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",t),window.isNaN(t)||this.CVI_Mgr.seekToRequest(t)},seekToLive:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"disableButton",t),e.isEmpty(this.skinMgr)||e.isEmpty(t)||this.skinMgr.disableButton(t)},enableButton:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"enableButton",t),e.isEmpty(this.skinMgr)||e.isEmpty(t)||this.skinMgr.enableButton(t)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(t){e.isNaN(t)||this.CVI_Mgr.volumeChangeRequest(t)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",t),e.isString(t)&&this.CVI_Mgr.loadCaptionsRequest(t)},showCaptions:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest(t)},setCaptionLanguage:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setCaptionLanguage to "+t),this.CVI_Mgr.setCaptionLanguage(t)},getCaptionInfo:function(){return this.CVI_Mgr.getCaptionInfo()},hideCaptions:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},getAudioTrackInfo:function(){return this.CVI_Mgr.getAudioTrackInfo()},setAudioTrack:function(t){this.CVI_Mgr.setAudioTrack(t)},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",t),this.CVI_Mgr.setCaptionsStyleRequest(t)},setCaptionsStyleProperty:function(t,e){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",t,e),this.CVI_Mgr.setCaptionsStyleRequest([{name:t,value:e}])},getCaptionsStyle:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(t,e){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",t,e),this.CVI_Mgr.setCaptionsCuePropertyRequest(t,e)},setSize:function(t,i){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setSize  width = "+t+"  height = "+i),e.isNumber(t)||e.isNumber(i)||this.CVI_Mgr.resizeRequest(t,i)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),!e.isEmpty(t)&&(e.isArray(t)&&t.length>0||window.uvpjs.util.isDefinedString(t))&&this.CVI_Mgr.setUserGesture(t)},setQosMetadata:function(t,i){this.debug&&window.uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",t),this.debug&&window.uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",i),e.isEmpty(t)||e.isEmpty(i)||!e.isArray(t)||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:t,paramsObj:i},this.vidContId))},fullscreen:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",t),e.isBoolean(t)&&this.CVI_Mgr.fullscreenRequest(t)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(t){t&&e.isPlainObject(t)&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:t},this.vidContId))},forceTrackSessionEnd:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FORCE_TRACK_SESSION_END,{},this.vidContId)},removeNativeControls:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",t),e.isBoolean(t)&&this.CVI_Mgr.setNativeControls(t)},useDynamicSwitching:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",t),e.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:t},this.vidContId)},switchUp:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(t){t&&"number"==typeof t?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"switch to bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",t)},switchTo:function(t){var e=null!=t&&"string"==typeof t&&-1!=="up,down".indexOf(t),i=null!=t&&"number"==typeof t&&!window.isNaN(t);e||i?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"Switch To:",t),i?this.switchBitrateTo(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",t,e,i,typeof t)},setMinimumBitrateAllowed:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},setMaximumBitrateAllowed:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},pauseAdRequest:function(t,e){this.debug&&window.uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:t||null,height:e||null},this.vidContId)},_dispatchResizeEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:t},this.vidContId)},liveSegmentStart:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_START,i={liveSegmentData:t};this.eventsMgr.dispatchEvent(e,i,this.vidContId)},liveSegmentEnd:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_END,i={liveSegmentData:t};this.eventsMgr.dispatchEvent(e,i,this.vidContId)}})}(window.uvpjs.register("uvpjs")),function(t){var e=Math.random(),i=t._;t.VideoManager=window.uvpjs.Class.subClass({init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.VIDEO_MANAGER,window.uvpjs.VideoManager._instance?console.warn("UVPJS: An instance of VideoManager has already been created."):(window.uvpjs.VideoManager._instance=this,this.initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=window.uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1)},destroy:function(){for(var t in this.VCIs)this.destroyVideoPlayer(t);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,window.uvpjs.VideoManager.destroyInstance()},initialize:function(t,e,i){var s=window.uvpjs.Configuration,n=window.uvpjs.VideoManager._instance,r=window.uvpjs.DebugManager,a=this.validateParams(t,e,i),o=a.message,l=a.isValid;if(!o||(console[l?"warn":"error"](o),!l&&a.errorCb&&a.errorCb(o),l)){if(n){if(n.isInitializing())return void n.addInitCallback(e);if(n.isReady())return void(window.uvpjs.util.isFunction(e)&&e(this.mc.systemInfo))}console.log([s.name,s.version,s.date].join(" ")),window.uvpjs.log=r.log.bind(r),window.uvpjs.warn=r.warn.bind(r),window.uvpjs.error=r.error.bind(r),r.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!t.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(e),this.debug&&window.uvpjs.log(this.DEBUG_ID,"initialize options = ",t),this.eventsMgr=window.uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=window.uvpjs.ConfigManager.getInstance(t,this.onCongfigMgrReady.bind(this))}},validateParams:function(t,e,s){var n=window.uvpjs.util,r=null,a=!1,o="VideoManager.initialize()",l=n.isFunction(s)?s:null;return t&&i.isPlainObject(t)||(r=o+" was invoked with invalid session options.",a=!0),n.isFunction(e)||(r=o+": A success callback function is required.",a=!0),l||(r=o+" did not receive a valid error callback function.",a=!1),{errorCb:l,message:r,isValid:!a}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(t){var e=this.successCallbacks.length;if(window.uvpjs.util.isFunction(t)){for(;e--;)if(this.successCallbacks[e]===t)return;this.successCallbacks.push(t)}},onCongfigMgrReady:function(t){i.isObject(t)?(this.CDO=t,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new window.uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS)},onSdkLoadManagerReady:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",t),window.uvpjs.mediaCapabilities.setTrackingInfo(t),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(t){var e,i=t.isModuleEnabled("VideoPlaybackSettings")&&t.getModuleParam("VideoPlaybackSettings","forceHlsjs"),s="string"==typeof i,n=s&&i.toLowerCase();i&&!window.uvpjs.util.isEmpty(i)&&(!0===i||1===i||s&&("1"===n||"y"===n||"yes"===n))&&((e=this.mc.canPlayHLSJS(!0))&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=e)},checkAutoplay:function(){window.uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){window.uvpjs.DebugManager.initialize(this.CDO),window.uvpjs.debug=window.uvpjs.DebugManager.isEnabled},addEventListener:function(t,e){if(this.eventsMgr)return t&&i.isString(t)&&i.isFunction(e)?void this.eventsMgr.addEventListener(t,e):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(t){t&&i.isString(t)?this.eventsMgr.removeEventListener(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS)},getVideoPlayers:function(){var t,e={};for(t in this.VCIs)e[t]=this.VCIs[t];return e},createVideoPlayer:function(t,e,s){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),i.isString(t)&&i.isFunction(e)&&(!s||i.isPlainObject(s))){var n=[t,e];s&&n.push(s),this.createMultipleVideoPlayers([n])}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS)},destroyVideoPlayer:function(t){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),i.isString(t)?i.isEmpty(this.VCIs)||!this.VCIs[t]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+t},this.internalNS),!1):(this.VCIs[t].destroy(),delete this.VCIs[t]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(t){var e,s,n,r,a,o,l,d;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!i.isEmpty(this.VCIs)),i.isArray(t)){for(r=t.length,n=0;n<r;n++)if(o=(a=t[n])[0],l=a[1],d=a[2],a.length<2||!i.isString(o)||!i.isFunction(l)||!i.isUndefined(d)&&!i.isPlainObject(d))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&window.uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),n=0;n<r;n++)o=(a=t[n])[0],l=a[1],d=a[2]||{},this.debug&&window.uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",o),d=this.CDO.getSessionOptions(d),e=this.validateAutoplay(d),!1===this._allowConcurrentPlayback&&e&&(this._disableAutoplay&&(d.enableMutedAutoplay=!1,d.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),s=new window.uvpjs.VideoControlInterface,this.VCIs[o]=s,s.initialize(o,this.eventsMgr,this.CDO,l,d);this.debug&&(window.uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),window.uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS)},validateAutoplay:function(t){var e=t.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),i=!!(t.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||e);return e&&(t.enableMutedAutoplay=!1),i||(t.enableMutedAutoplay=!1,t.enableUnmutedAutoplay=!1),i},overrideSessionOptions:function(t){t&&i.isPlainObject(t)&&this.CDO.overrideSessionOptions(t)},onVideoProgress:function(t){if(!(this._allowConcurrentPlayback||!i.isPlainObject(t)||i.isUndefined(t.target)||i.isUndefined(t.payload)||i.isUndefined(t.payload.playbackState)||t.payload.playbackState!==this.mc.PLAYING)){var e=t.target;i.isEmpty(this.currActiveVCI)&&!i.isUndefined(this.VCIs[e])&&(this.currActiveVCI=this.VCIs[e]),e===this.currActiveVCI.vidContId||i.isUndefined(this.VCIs[e])||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",e),this.VCIs[e].pauseVideo())}},onVideoPlaybackInitiated:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",t),!this._allowConcurrentPlayback&&i.isPlainObject(t)&&!i.isUndefined(t.target)){var e=t.target;this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),i.isEmpty(this.VCIs)||i.isUndefined(this.VCIs[e])||this.currActiveVCI&&this.currActiveVCI.vidContId===e||(this.currActiveVCI=this.VCIs[e],this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))}},uvpjsError:function(t){t?this.debug&&window.uvpjs.error(this.DEBUG_ID,"ERROR: ",t.payload.msg):this.debug&&window.uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(t){t?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"WARNING: ",t.payload.msg):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),t.VideoManager._instance=null,t.VideoManager.destroyInstance=function(){this._instance=null},t.VideoManager.getInstance=function(){return this._instance||(this._instance=new window.uvpjs.VideoManager(e)),this._instance}}(window.uvpjs.register("uvpjs")),function(t){var e,i,s,n,r,a,o,l,d,u,h,c,p,f,v,g=t._;t.CaptionsManager=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:window.uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:window.uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(t){var e=window.uvpjs.mediaCapabilities;this.debug=window.uvpjs.debug,t&&(this._cviModel=t.cviModel,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&window.uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=i(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=e.getCaptionsLineOffset(),this._lineAlign=e.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=t.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._disabled=!1,this.subtitleLanguage="en",this.subtitleMasterList=null,this.ccDisplayRequested=!1,this.isAndroidOnHlsjs=window.uvpjs.mediaCapabilities.canPlayHlsjsAndriod(this._cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),window.uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=t,this.isAndroidOnHlsjs||!this._ccEl&&this._createCaptionsElement()},showCaptions:function(t){if(this._deferLoadingCaptions&&!this._hasCaptions())return this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this));this.setCaptionLanguage(t),this.ccDisplayRequested=!0,!this._getActiveTrack()&&window.uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(t,"showing")},setCaptionLanguage:function(t){var e=t.payload.language;if(window.uvpjs.util.isDefinedString(e)){var i=this._getActiveTrack();i&&i.language===this.subtitleLanguage&&this.subtitleLanguage!==e&&this._clearCaptionTrack(i),this._ccEl&&(this._ccEl.innerHTML=""),this.subtitleLanguage=e}},getCaptionInfo:function(){for(var t=[],e=this.subtitleMasterList||this._getTextTracks(),i=this._getActiveTrack(),s=0;s<e.length;s++){var n=e[s];window.enabled=i&&i.language===n.language||!1,t.push({language:n.language,label:n.label,kind:n.kind,enabled:window.enabled})}return this.subtitleMasterList=t,this.subtitleMasterList},hideCaptions:function(t){this.ccDisplayRequested=!1,this._toggleVisibility(t,"hidden")},getStyles:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:g.clone(this.styles)},setStyles:function(t){var e,i,s,n=this._pageStyles,r=t.length;if(!this._disabled){for(this.debug&&window.uvpjs.log(this.DEBUG_ID,"setStyles",t);r--;)s=t[r],e=p(s.name),i=s.value,n[e]=i;this._updateStylesObject(n),this._applyStyles(),this._setPosition(n["text-position"]||null)}},setCueProperty:function(t,e){var i;if(!this._disabled){if(i=this._getActiveTrack(),!(t&&e&&i&&this._supportsVTTCue))return void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",t,e));this.debug&&window.uvpjs.log(this.DEBUG_ID,"setCueProperty",i,t,e),this._props[t]=window.isNaN(e)?e:Number(e)}},_addEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace,s=this._cviModel.contentVideoState.isLive;this.debug&&window.uvpjs.log(this.DEBUG_ID,"_addEventListeners",s),t.addEventListener(e.CONTAINER_RESIZE+i,this._onContainerResize.bind(this)),t.addEventListener(e.CONTROL_LOAD_CAPTIONS+i,this._onControlLoadCaptions.bind(this)),t.addEventListener(e.CONTENT_DATA_LOADED+i,this._onContentDataLoaded.bind(this)),t.addEventListener(e.CONTROL_SHOW_CAPTIONS+i,this.showCaptions.bind(this)),t.addEventListener(e.CONTROL_HIDE_CAPTIONS+i,this.hideCaptions.bind(this)),t.addEventListener(e.SET_CAPTIONS_LANG+i,this.setCaptionLanguage.bind(this)),t.addEventListener(e.CONTENT_FACADE_CREATED+i,this._onContentFacadeCreated.bind(this)),t.addEventListener(e.RESOURCE_END+i,this._onVideoComplete.bind(this)),t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this))},_removeEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace;this._cviModel.contentVideoState.isLive,this.debug&&window.uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),t.removeEventListener(e.CONTAINER_RESIZE+i),t.removeEventListener(e.CONTROL_LOAD_CAPTIONS+i),t.removeEventListener(e.CONTENT_DATA_LOADED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.SET_CAPTIONS_LANG+i),t.removeEventListener(e.CONTENT_FACADE_CREATED+i),t.removeEventListener(e.RESOURCE_END+i),t.removeEventListener(e.VIDEO_PROGRESS+i)},_createTrackElement:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createTrackElement",t);var e=window.document.createElement("track");e.default=!0,e.kind="captions",e.label="English",e.srclang="en",e.id=this._trackId,e.src=t,this._videoEl.appendChild(e)},_createCaptionsElement:function(){var t=window.uvpjs.util,e=this._styleEl,i=window.document.createElement("div"),s=window.document.getElementById(window.uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);i.id=this._captionsId,this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),s?(s.appendChild(i),this._ccEl=i,t.addCSSObject(e,i,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),t.addCSSObject(e,i,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),t.addCSSObject(e,i,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container.")},_dispatchCaptionsError:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",t),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:t},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this.adjustVttCuesLinePosition(),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(t){t.target===this._containerId&&this._setRect()},_onVideoComplete:function(t){var e,i,s=t.target,n=this._videoEl;s===this._containerId&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onVideoComplete",s),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,n&&n.removeEventListener("loadeddata",this._onLoadedData),n&&n.removeEventListener("timeupdate",this._onTimeUpdate),(i=this._getTextTracks())&&(i.onaddtrack=null),(e=this._getActiveTrack())instanceof window.TextTrack&&o(e)&&(e.mode="disabled",e.oncuechange=null),this._trackCount++)},_onContentDataLoaded:function(t){var e,i=window.uvpjs.util,s=t.target,n=t.payload.vidState,r=n.closedCaptionPath;n.isLive,s===this._containerId&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",s),this._videoEl=window.document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,(e=this._getTextTracks())&&(e.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),i.isDefinedString(r)&&(this._captionsUrl=r))},_onLoadedData:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onLoadedData",t),this._checkForLiveCaptions()},_onTimeUpdate:function(t){!this.hasDispatchedCaptionsReady&&!!this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(t)},_onControlLoadCaptions:function(t){var e;t.target===this._containerId&&(e=t.payload.url,g.isString(e)&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",t.target),this._loadCaptionsUrl(e)))},_onContentFacadeCreated:function(t){t.target===this._containerId&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",t.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(t){var e=t.responseText;this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",t);try{e=(e=e.replace(/\n/g,"")).substr(e.indexOf("<?xml"));var i=(new DOMParser).parseFromString(e,"text/xml");this._xmlToCues(i)}catch(t){var s="Error parsing closed captions XML.";this._dispatchCaptionsError(s),this.debug&&window.uvpjs.error(this.DEBUG_ID,s,t)}},_onLoadError:function(t){var e=t.status,i="Unknown error";switch(e){case 404:i="File not found";break;case 500:i="Server error";break;case 0:i="Request aborted"}i+=" "+e,this._dispatchCaptionsError(i),this.debug&&window.uvpjs.error(this.DEBUG_ID,"onLoadError",i)},_onAddTrack:function(t){var e=t.track;e.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(e,!1),o(e)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onAddTrack",t)},_syncCCTrackMode:function(t,e){if(t)return e?void(t.mode="disabled"):void(this.useNativeBrowserControls||window.uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(t.mode="showing"):"hidden"!==t.mode&&(t.mode="hidden"))},_onVideoProgress:function(t){var e;if(t.target===this._containerId){var i=this._getActiveTrack();if(this.isAndroidOnHlsjs||this._syncCCTrackMode(i,!1),!this._hasCaptions())return void(this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1));if(!this._liveCaptionsInitalized)return void this._checkForLiveCaptions();if(i&&i.activeCues&&(e=i.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);e--;)t.payload.currentTime-i.activeCues[e].endTime>1&&this.showCcContainer(!1);else this.showCcContainer(!1)}},_finalizeLiveCaptions:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!t||!this._liveCaptionsInitalized){try{!t&&this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(t){this.debug&&window.uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",t),this._dispatchCaptionsError(t)}t&&(this._liveCaptionsInitalized=!0),this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var t=this._getActiveTrack(),e=this._onTimeUpdate;this.debug&&window.uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),t&&(t.oncuechange=e)||this._videoEl.addEventListener("timeupdate",e)},_finalizeStyles:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var t=g.get(this._captionsJson,"tt.head.styling.style");t=g.isArray(t)?t[0]:t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",t),t?this._inlineStyles={backgroundColor:t["tts:backgroundColor"],color:t["tts:color"],fontFamily:t["tts:fontFamily"],fontSize:t["tts:fontSize"],fontStyle:t["tts:fontStyle"],fontWeight:t["tts:fontWeight"],textAlign:t["tts:textAlign"],textDecoration:t["tts:textDecoration"]}:this.debug&&window.uvpjs.log(this.DEBUG_ID,"No styling found in XML file.")},_applyStyles:function(){var t,i,s,n=window.uvpjs.util,r=this.styles,a=this._styleSelector,o=[];for(i in this.debug&&window.uvpjs.log(this.DEBUG_ID,"_applyStyles styles",r),r){switch(s=r[i],t=!1,i){case"background-opacity":case"font-opacity":t=!0;break;case"text-position":t=!0,this._setPosition(s);break;case"background-color":s=e(s,r["background-opacity"]);break;case"color":case"font-color":i="color",s=e(s,r["font-opacity"]);break;case"text-edge-style":i="text-shadow",s=f(s)}t||(l(i,s)?o.push({name:i,value:s}):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",i,s))}this.debug&&window.uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",a,o),n.addCSSRules(this._styleEl,a,o)},_updateStylesObject:function(t){var e,i,n;for(e in t){if(!(i=t[e])||!e)return;if((n=p(e))in this.styles){switch(n){case"font-size":i=s(i)}this.styles[n]=i}else this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",n)}},_hasCaptions:function(){return o(this._getActiveTrack())},_loadOrDeferCaptions:function(t){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(t)},_loadCaptionsUrl:function(t){var e=window.uvpjs.util.isDefinedString(t),i=e&&-1!==t.indexOf(".vtt");if(e&&!this._cviModel.contentVideoState.isFlash){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=window.document.getElementById(this._videoId),i)return void this._createTrackElement(t);(new window.uvpjs.CodeLoader).loadXHR(t,this._onLoadComplete.bind(this),this._onLoadError.bind(this))}},_checkForLiveCaptions:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),this._hasCaptions()?(this._finalizeTrackElement(),this._finalizeLiveCaptions()):this.debug&&window.uvpjs.log(this.DEBUG_ID,"No captions track to finalize.")},_clearAllCaptionTracks:function(){var t=this._getTextTracks(),e=t&&t.length||0;for(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",t);e--;)this._clearCaptionTrack(t[e]);this._ccEl&&(this._ccEl.innerHTML="")},_clearCaptionTrack:function(t){var e,i;if(o(t)){for(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",t),i=(e=t&&t.cues)&&e.length||0;i--;)t.removeCue(e[i]);this._syncCCTrackMode(t,!0),t.cues=null}},_toggleVisibility:function(t,e){t.target===this._containerId&&this._hasCaptions()&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_toggleVisibility",e),this.showCcContainer("hidden"!==e))},showCcContainer:function(t){this.isAndroidOnHlsjs?this._getActiveTrack().mode=t?"showing":"hidden":this._ccEl&&(this._ccEl.style.display=!1===t?"none":"block")},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){var t,e,i,s=this._getTextTracks(),n=s&&s.length||0;for(i=0;i<n;i++)if((e=(t=s[i])&&t.cues)&&e.length&&o(t))return t},enableCaptionsTracks:function(){for(var t,e=this._getTextTracks(),i=e&&e.length||0;i--;)t=e[i],o(t)&&(t.mode="hidden")},_getTrackById:function(t){var e=this._getTextTracks();return e&&e.getTrackById(t||this._trackId)},_getActiveCues:function(){var t=this._getActiveTrack();return t&&t.activeCues},_getAllCues:function(){var t=this._getActiveTrack();return t&&t.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var t,e,i=this._cviModel.getModule(this.CONFIG_MODULE_NAME),s={};return this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setCDOParams module",i),i?!0!==i.enabled?void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled.")):g.isEmpty(i.params)?void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty.")):(g.each(i.params,function(i){t=i.name,e=i.value,t&&e&&(p(t),s[t]=e)}),this.debug&&window.uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(s,null,2)),void(this._configStyles=s)):void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found."))},_setPosition:function(t){var e=["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"].indexOf(t)>-1?t:"bottom-center-floated";this._setPositionCSS(e)},_setPositionCSS:function(t){var e,i,s,n,r,a,o=window.uvpjs.util,l=this._styleEl,d=this._ccEl,u=d&&d.style.marginBottom,h=window.parseInt(this.BASE_CONTROLS_HEIGHT);l&&d&&(n=(i=t.split("-"))[0],s=i[1],r="inherit"===u?0:window.parseInt(u),a=window.isNaN(r)?h+"px":(r>h?10:h-r)+"px",e={top:{top:"10px",middle:"50%",bottom:"auto"}[n],bottom:{top:"auto",middle:"auto",bottom:a}[n],"text-align":s,transform:"initial"},"middle"===n&&(e.transform="translateY(-50%)"),o.addCSSObject(l,d,e,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var t=this.styles;t&&this._setPosition(t["text-position"])},_setRect:function(){function t(){g.assign(c.style,a),p&&(g.assign(p.style,a),this._checkBottomPosition())}var e,i,s,n,r,a,o,l,d,u,h,c=this._videoEl,p=this._ccEl,f=c&&c.parentNode;c&&f&&(n=c.videoHeight,(r=c.videoWidth)&&n&&(i=c.getBoundingClientRect(),e=f.getBoundingClientRect(),s=i.height/i.width/(n/r),d=e.height-i.height,l=e.width-i.width,h=s<1||0!==l&&0===d,(a=(u=s>1||0===l&&0!==d)?{height:"auto","max-height":"100%",width:"100%",margin:0}:h?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0})&&t.call(this),i=c.getBoundingClientRect(),d=(e=f.getBoundingClientRect()).height-i.height,l=e.width-i.width,u?a={margin:"inherit","margin-top":o=d/2+"px","margin-bottom":o}:h&&(a={margin:"inherit","margin-left":o=l/2+"px","margin-right":o}),p&&(a["font-size"]=this._calculateFontSize(i.width)),a&&t.call(this)))},_calculateFontSize:function(t){var e;try{e=t/window.parseInt(this.BASE_VIDEO_WIDTH)*window.parseInt(this.BASE_FONT_SIZE),e=Math.max(e,window.parseInt(this.MIN_FONT_SIZE))}catch(t){console.error(t)}return e&&e+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(t){var e=t&&t.target,i=e&&e.activeCues||this._getActiveCues();this._setCueProps(i)},adjustVttCuesLinePosition:function(){if(this.isAndroidOnHlsjs){var t=this._getAllCues();if(t&&t.length>0){this._syncCCTrackMode(this._getActiveTrack(),!1);for(var e=0;e<t.length;e++){var i=t[e];!i||"auto"!==i.line&&-1!==i.line&&-2!==i.line||(i.line=-3)}}}},_setCueProps:function(t){this._addCuesToCaptionsElement(t)},_xmlToCues:function(t){var e,i,s,a,o,l,d,h,c,p,f,_=v(t);if(this._captionsJson=_,this.debug&&window.uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",_),!g.isEmpty(_)&&g.isPlainObject(_)){if(i=g.get(_,"tt.body.div.p"),this.debug&&window.uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",i),g.isUndefined(i)||g.isEmpty(i))return void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"No cues found in XML file."));if(!(e=this._supportsVTTCue?window.VTTCue:window.TextTrackCue))return void(this.debug&&window.uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions."));for((o=this._videoEl.addTextTrack("captions","English","en")).id=this._trackId,p=i.length,h=0;h<p;h++)if(c=h+1,d=i[h],a=i[c],l=d.text,!g.isEmpty(l)){for(l=(l=(l=l.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3")).replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3")).replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),f=n(l),d._lineCountPrev=d._lineCountPrev||0,d._lineCountNext=d._lineCountNext||0;(a&&a.begin)===d.begin;)a._lineCountPrev=f+d._lineCountNext,d._lineCountNext+=n(a.text),a=i[++c];(s=new e(r(d.begin),r(d.end),l))._lineCount=f,s._lineCountPrev=d._lineCountPrev,s._lineCountNext=d._lineCountNext,s._metadata=d.metadata,s=u.call(this,s),o.addCue(s)}this._finalizeCaptions()}},_addCuesToCaptionsElement:function(t){var e,i,s=window.uvpjs.util,n=this._ccEl,r='<div class="{{cntrClass}}">{{spans}}</div>',a="",o=t&&t.length;if(o){for(e=0;e<o;e++)i=t[e].text,s.isDefinedString(i)&&(a+='<span class="{{txtClass}}">'+(i=i.replace(/(\r\n|\n|\r)/g,"<br/>"))+"</span>",e+1!==o&&(a+="<br/>"));r=(r=(r=r.replace("{{spans}}",a)).replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME)).replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),n&&(n.innerHTML=r)}}}),e=function(t,e){var i=h(t)||a(t)||a(d(t));return i&&e?c(i.r,i.g,i.b,e):t},i=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},s=function(t){var e="100%";return t.indexOf("px")>-1?(e=t.replace("px",""),e=100*(e/=18)+"%"):t.indexOf("%")>-1&&(e=t),e},n=function(t){return t&&(t.match(/\n/g)||[]).length+1},r=function(t){var e,i;if(!g.isNull(t)&&!g.isUndefined(t))return i=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},e=t.split(":"),i(60*Number(e[0])*60+60*Number(e[1])+Number(e[2]),2)},a=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:window.parseInt(e[1],16),g:window.parseInt(e[2],16),b:window.parseInt(e[3],16)}:null},o=function(t){return t instanceof window.TextTrack&&("captions"===t.kind||"subtitles"===t.kind)},l=function(t,e){if(t&&e)return g.get(window,"CSS.supports")?window.CSS.supports(t,e):"string"==typeof window.document.createElement("div").style[t]},u=function(t){var e,i=t._metadata;if(i){t.snapToLines=!0,e=Math.round(i.cccol/35*100),t.position=e;try{t.align=e<45?"start":e>55?"end":this._lineAlign}catch(e){t.align="center"}t.positionAlign=e<45?"line-left":e>55?"line-right":"center",t.line=i.ccrow-17+this._lineOffset,t._defaults={line:t.line,position:t.position,align:t.align,positionAlign:t.positionAlign}}return t},d=function(t){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[t.toLowerCase()]},h=function(t){var e;if(-1!==t.indexOf("rgba"))return{r:(e=t.substr(5,t.length).split(","))[0],g:e[1],b:e[2]}},p=function(t){if(g.isString(t)&&!g.isEmpty(t))return t.replace(/([A-Z])/g,"-$1").toLowerCase()},c=function(t,e,i,s){return"rgba("+[t,e,i,s].join(",")+")"},f=function(t){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[t]||"none"},v=function(t){var e={};if(1===t.nodeType&&t.attributes.length>0)for(var i=0,s=t.attributes.length;i<s;i++){var n=t.attributes.item(i);e[n.nodeName]=n.nodeValue}else 3===t.nodeType&&(e=t.nodeValue);if("p"===t.nodeName&&(e.text="",g.each(t.childNodes,function(t){if("metadata"!==t.nodeName){var i=(new XMLSerializer).serializeToString(t);1===t.nodeType&&(e.text+="br"===t.tagName?"\n":i),3===t.nodeType&&(e.text+=i)}})),t.hasChildNodes())for(var r=0,a=t.childNodes.length;r<a;r++){var o=t.childNodes.item(r),l=o.nodeName;if(void 0!==e[l]){if(void 0===e[l].push){var d=e[l];e[l]=[],e[l].push(d)}e[l].push(v(o))}else e[l]=v(o)}return e}}(window.uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.ConfigDataObject=window.uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=window.document.referrer),this.initialize(t)},initialize:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",t),this.overrideSessionOptions(t)},destroy:function(){this.modules=null,this.classes=null},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(t){var e;if(!window.uvpjs.util.isEmpty(t.standardParams)&&null===this.adCallParams.standardParams)for(e in this.adCallParams.standardParams={},t.standardParams)this.adCallParams.standardParams[e]=t.standardParams[e];if(!window.uvpjs.util.isEmpty(t.customParams)&&null===this.adCallParams.customParams)for(e in this.adCallParams.customParams={},t.customParams)this.adCallParams.customParams[e]=t.customParams[e]},overrideSessionOptions:function(t){var i=this.getSessionOptions(t);i&&e.isPlainObject(i)?this.sessionOptions=i:this.debug&&window.uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type.")},getSessionOption:function(t){return this.sessionOptions[t]||null},getSessionOptions:function(t){var i,s,n;if(i=e.clone(this.sessionOptions),!t||!e.isPlainObject(t))return i;if((s=t.skinConfig)&&!e.isEmpty(s))for(n in window.uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object."),s)i.hasOwnProperty(n)&&(i[n]=s[n]);for(n in i)t.hasOwnProperty(n)&&(i[n]=t[n]);return i},getModule:function(t){return s(this.modules,t)},getModules:function(){return this.modules},getModuleParam:function(t,e){var i=s(this.modules,t),n=s(i.params,e);if(n&&n.hasOwnProperty("value"))return n.value},setModule:function(t){a(this.modules,t,"name",this.DEBUG_ID)},isModuleEnabled:function(t){var e=this.getModule(t);if(!e){var i="ConfigDataObject isModuleEnabled module not found: "+t;return this.debug&&window.uvpjs.log(this.DEBUG_ID,i),!1}return this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+t+":",e.enabled),e.enabled},isModuleSet:function(t){return!!this.getModule(t)},getClass:function(t){return s(this.classes,t)},getClasses:function(){return this.classes},getClassProperty:function(t,e){var i=s(this.classes,t),n=r.call(this,i,"properties",this.DEBUG_ID),a=s(n,e);return r.call(this,a,"value",this.DEBUG_ID)},getClassListItems:function(t){var e=s(this.classes,t);return r.call(this,e,"list",this.DEBUG_ID)},getClassListItemProperty:function(t,e,i){var a=this.getClassListItems(t),o=n(a,e),l=r.call(this,o,"properties",this.DEBUG_ID),d=s(l,i);return r.call(this,d,"value",this.DEBUG_ID)},setClass:function(t){a(this.classes,t,"name",this.DEBUG_ID)},isCAN:function(){return e.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()},copyModules:function(t){for(var e=t.length;e--;)for(var i=t[e],s=this.modules.length;s--;)if(this.modules[s].name===i.name){this.modules[s]=i;break}}});var i=function(t,e,i){for(var s in t)if(t[s][e]==i)return t[s];return!1},s=function(t,e){return i(t,"name",e)},n=function(t,e){return i(t,"id",e)},r=function(t,e,i){return t?t.hasOwnProperty(e)?t[e]:(this.debug&&window.uvpjs.warn(i,"ConfigDataObject findItemProperty no item property:",t,e),!1):(this.debug&&window.uvpjs.warn(i,"ConfigDataObject findItemProperty item not found:",t),!1)},a=function(t,e,i,s){for(var n in t)if(t[n][i]==e[i])return this.debug&&window.uvpjs.log(s,"ConfigDataObject _addItemToArray updating existing item",e),void(t[n]=e);this.debug&&window.uvpjs.log(s,"ConfigDataObject _addItemToArray creating item",e),t.push(e)}}(window.uvpjs.register("uvpjs")),function(t){var e=t._,i=Math.random();t.ConfigManager=window.uvpjs.Class.subClass({init:function(t,e,s){this.debug=window.uvpjs.debug,t&&t===i?(this.initCallback=s,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&window.uvpjs.log(this.DEBUG_ID,"init sessionOptions =",e),this.CDO=new window.uvpjs.ConfigDataObject(e),this.debug&&window.uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.debug&&window.uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()):this.debug&&window.uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance().")},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,window.uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(this.configSources.length){var t=this.configSources.shift();if(null!=t)switch(t.constructor){case String:if(""===t)break;return void(new window.uvpjs.CodeLoader).loadXHR(t,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=t.concat(this.configSources);break;case Object:this.updateCDO(t)}this.loadConfig()}else e.isFunction(this.initCallback)&&this.initCallback(this.CDO)},onLoadComplete:function(t){var e,i,s=t.responseText,n=t.getResponseHeader("Content-Type");n.indexOf("application/json")>-1?i=JSON.parse(s):n.indexOf("text/xml")>-1||n.indexOf("application/xml")>-1?(e=(new DOMParser).parseFromString(s,"text/xml"),i=this.xmlToCDO(e)):this.debug&&window.uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",n),i&&this.updateCDO(i),this.loadConfig()},onLoadError:function(t){var e="unknown error";switch(t.status){case 0:e="request timeout"}this.debug&&window.uvpjs.error(this.DEBUG_ID,"onLoadError error =",e,t),this.loadConfig()},updateCDO:function(t){e.isEmpty(t)?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"):["classes","modules"].map(function(e){t.hasOwnProperty(e)&&(this.CDO[e]=s(this.CDO[e],t[e]))},this)},xmlToCDO:function(t){var e={},i=function(t){return"y"===t||"n"===t},s=function(t){return"y"===t},a=n(t);return a.hasOwnProperty("player-config")&&(a=a["player-config"]),e.modules=function(){var t,e=[];if(a.modules){for(var n in t=r(a.modules.module)){var o=t[n],l={name:o.name,category:o.category,enabled:s(o.enabled),params:[]};if(t[n].hasOwnProperty("params")){var d=r(o.params.param);for(var u in d){var h=d[u];h.name&&(i(h.value)&&(h.value=s(h.value)),l.params.push(h))}}o.category,e.push(l)}return e}}(),e.classes=function(){var t=r(a.classes),e=[];for(var i in t){var s=t[i];if(s.hasOwnProperty("classDef")&&(s=s.classDef),s.name){var n={name:s.name,className:s.className,properties:[],list:[]};if(s.hasOwnProperty("list")){var o=r(s.list.listitem);for(var l in o){var d=o[l];d.id&&(d.hasOwnProperty("properties")&&(d.properties=d.properties.property),n.list.push(d))}}s.hasOwnProperty("properties")&&(n.properties=s.properties.property),e.push(n)}}return e}(),e},getCDO:function(){return this.CDO}}),t.ConfigManager._instance=null,t.ConfigManager.destroyInstance=function(){this._instance=null},t.ConfigManager.getInstance=function(t,e){return this._instance||(this._instance=new window.uvpjs.ConfigManager(i,t,e)),this._instance};var s=function(t,e){for(var i in e){var s=!1;for(var n in t)if(t[n].name===e[i].name){s=!0;break}s||t.push(e[i])}return t},n=function(t){var e,i={};if(1===t.nodeType&&t.attributes.length>0){e=t.attributes.length;for(var s=0;s<e;s++){var r=t.attributes.item(s);i[r.nodeName]=r.nodeValue}}if(t.hasChildNodes()){e=t.childNodes.length;for(var a=0;a<e;a++){var o=t.childNodes.item(a),l=o.nodeName;if(3!==o.nodeType)if(void 0!==i[l]){if(void 0===i[l].push){var d=i[l];i[l]=[],i[l].push(d)}i[l].push(n(o))}else i[l]=n(o)}}return i},r=function(t){if(void 0!==t&&t.constructor!==String)return t.constructor===Object&&(t=[t]),t}}(window.uvpjs.register("uvpjs")),function(t){"use strict";var e=null,i=null,s=t._;t.VideoPlayerFacade=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=window.uvpjs.debug,this.debug&&window.uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=window.uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1,this.isMobile=!1},initialize:function(t){var s=t.resourceProvider,n=s.vidContId;this.resourceProvider=s,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=n,this.assetURL=t.assetURL,this.vidContentId=this.PREFIX_CONTENT+n,this.internalNS="."+n+".facade",this.videoTagRef=window.document.getElementById(this.VIDEO+"_"+n),this.deferLoadingCaptions=t.deferLoadingCaptions,this._updateVolumeSettings(t),s.createWatermark()&&!t.suppressWatermark&&(e=new window.uvpjs.Watermark({containerId:n,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),s.is360()&&!t.suppress360&&(i=new window.uvpjs.Kaleidoscope360({containerId:n,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==t.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){s.isEmpty(this.resourceProvider)?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),e&&(e.destroy(),e=null),i&&(i.destroy(),i=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1)},_updateVolumeSettings:function(t){var e=(t=t||{}).volume,i=!0===t.isMuted,s=this.videoTagRef;this.debug&&window.uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",t),window.uvpjs.util.inRange(e,0,1)&&s.volume!==e&&(s.volume=e),"isMuted"in t&&s.muted!==i&&this.muteVideo(i)},_addHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(t in this.debug&&window.uvpjs.log(this.DEBUG_ID,"_addHTML5Events"),e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.addEventListener(e[t],this,!1);this.videoTagRef.addEventListener(e[i],this,!1)},_removeHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(t in this.debug&&window.uvpjs.log(this.DEBUG_ID,"_removeHTML5Events"),e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.removeEventListener(e[t],this,!1);this.videoTagRef.removeEventListener(e[i],this,!1)},handleEvent:function(t){var e=this.eventTypes.HTML5;if(this.videoTagRef)switch(t.type){case e.ABORT:break;case e.CAN_PLAY:this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(e.CAN_PLAY,this,!1);break;case e.CAN_PLAY_THROUGH:this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(e.CAN_PLAY_THROUGH,this,!1),window.uvpjs.mediaCapabilities.isIOS()&&(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.CLICK:case e.DURATION_CHANGE:break;case e.EMPTIED:this.playbackStateChange(window.uvpjs.mediaCapabilities.EMPTY);break;case e.ENDED:this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case e.ERROR:this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(t.target.error);break;case e.LOAD_START:if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),s.isEmpty(this.resourceProvider))return void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(window.uvpjs.mediaCapabilities.isIOS())return void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case e.LOADED_METADATA:this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),window.uvpjs.mediaCapabilities.isIOS()||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.LOADED_DATA:this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case e.PAUSE:this.debug&&window.uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===window.uvpjs.mediaCapabilities.PLAYING&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(window.uvpjs.mediaCapabilities.PAUSED));break;case e.PLAY:break;case e.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(window.uvpjs.mediaCapabilities.PLAYING);break;case e.PROGRESS:this.videoLoading();break;case e.RATE_CHANGE:break;case e.SEEKING:this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",t);break;case e.SEEKED:this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",t),this.seeked(t.target.currentTime);break;case e.STALLED:case e.SUSPEND:break;case e.TIME_UPDATE:this.timeUpdated();break;case e.VOL_CHANGE:this.volumeChanged();break;case e.WAITING:}},seeked:function(t){var e=this.videoTagRef.paused,i=window.uvpjs.mediaCapabilities;this.playbackStateChange(e?i.PAUSED:i.PLAYING),this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:t,paused:e,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:t})},videoLoading:function(){var t;try{t=this.videoTagRef.buffered.end(0)||0}catch(e){t=0}var e={bufferLength:t,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(e)},volumeChanged:function(){var t=this.videoTagRef.volume;!s.isNumber(t)||t<0?t=0:t>1&&(t=1),this.resourceProvider.facadeVolumeChange(t)},timeUpdated:function(){var t=this.videoTagRef.currentTime;"number"==typeof t&&this.resourceProvider.facadeTimeUpdate(t)},error:function(t){var e=window.uvpjs.ErrorInfo.messages,i=window.uvpjs.ErrorInfo.errorCodes,n=e.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,r=i.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,a=!0;if(t)switch(t.code){case t.MEDIA_ERR_ABORTED:a=!1,n=e.MEDIA_ERR_ABORTED,r=i.MEDIA_ERR_ABORTED;break;case t.MEDIA_ERR_NETWORK:n=e.MEDIA_ERR_NETWORK,r=i.MEDIA_ERR_NETWORK;break;case t.MEDIA_ERR_DECODE:n=e.MEDIA_ERR_DECODE,r=i.MEDIA_ERR_DECODE;break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:n=e.MEDIA_ERR_SRC_NOT_SUPPORTED,r=i.MEDIA_ERR_SRC_NOT_SUPPORTED}this.debug&&window.uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+n),s.isEmpty(this.resourceProvider)?this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."):this.resourceProvider.facadeError(new window.uvpjs.ErrorInfo({errorCode:r,message:n,isFatal:a}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(window.uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var t;this.videoTagRef&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(t=this.videoTagRef.play())&&t.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+t.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(t.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"seekTo",t),window.isNaN(t)||this.videoTagRef&&t>=0&&t<this.videoTagRef.duration&&(this.videoTagRef.currentTime=t)},seekToLive:function(){if(this.isHDStreamLive()||this.debug&&window.uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef){var t=this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&this.videoTagRef.seekable.end(0);!window.isNaN(t)&&t>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=t)}},toggleMute:function(){var t;this.videoTagRef&&(t=!this.videoTagRef.muted,this.muteVideo(t))},setFullscreenState:function(t){},loadVideo:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(t){var e=!1!==t;this.videoTagRef&&(this.videoTagRef.muted=e,e&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),!e&&this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(t){this.videoTagRef&&t>=0&&t<=1&&(this.videoTagRef.volume=t)},getDuration:function(){var t=0;return this.videoTagRef&&(t=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&(t=this.videoTagRef.seekable.end(0)),t},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(t){(!this.isAbrStreamingSupported()||"boolean"!=typeof t)&&this.debug&&window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(t){return!this.isAbrStreamingSupported()&&this.debug&&window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(t,e,i){if(t.length>0){var s=t.length,n=t[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(e>=t[s-1][n])return s-1;for(;s--;)if(e>=t[s][n])return i?s+1:s}return 0},addSessionIdAndTicketToURL:function(t,e,i){if(!t)return t;var s=function(t){return-1!==t.indexOf("?")?"&":"?"};return e&&-1===t.indexOf("SessionId=")&&(t+=s(t)+"SessionId="+e),i&&-1===t.indexOf("Ticket=")&&(t+=s(t)+"Ticket="+i),t},processResponseHeader:function(t,e){switch(e){case this.responseHeaders.MULTI_CDN:this.resourceProvider.getContentVideoStateCdn()!==t&&this.resourceProvider.setContentVideoStateCdn(t)}},getCdnNameAtStartup:function(t){return""},videoDone:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(window.uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(t,e){},getBuffered:function(){var t,e=this.videoTagRef,i=e&&e.buffered,s=0,n=0;return i&&i.length>0&&(s=i.start&&i.start(0),n=i.end&&i.end(0)),(t=n-s)>0&&t||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(t){if(this.videoTagRef){var e=this.videoTagRef.hasAttribute(this.CONTROLS);t&&!e?this.videoTagRef.setAttribute("controls",this.CONTROLS):!t&&e&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(t){if(t!==this.playbackState){if(this.playbackState=t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+t),s.isEmpty(this.resourceProvider))return void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"));this.resourceProvider.facadePlaybackStateChange(t)}},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var t=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!s.isUndefined(t),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,t=this.resourceProvider.getAssetURL()),this.debug&&window.uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",t),t},normalizeAudioTrackInfo:function(t,e){if(t){for(var i=[],s=0;s<t.length;s++){var n=t[s];this.checkCodecForWeb(n)&&i.push({index:s,id:n.id,type:n.type||n.kind,codec:n.codec||"n/a",label:e===window.uvpjs.mediaCapabilities.DASHJS?n.lang:n.label||n.name})}return i}},checkCodecForWeb:function(t){return!t.codec||-1!==t.codec.indexOf("mp4a")}})}(window.uvpjs.register("uvpjs")),function(t){"use strict";var e="www.nielsen.com";t.VPF_Flash=window.uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&window.uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=window.uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(t){for(var e in t)this.initOptions[e]=t[e];t.suppress360=!0,t.suppressCreatedEvent=!0,this._super(t),this.swfService=t.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){var t;for(t in this.windowLabels)window[this.windowLabels[t]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(t){this.player&&this.player.setVolume(t)},seekTo:function(t){this.player&&this.player.seekTo(t)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(t){this.swfService.resetSize()},loadCaptions:function(t){this.captionsUrl=window.uvpjs.util.isEmpty(t)?null:t,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(t)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl?(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0,this.player.showCaptions()):this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(t){for(var e,i,s,n=Array.isArray(t)&&t.length||0,r=window.uvpjs.util,a=window.uvpjs.VPF_Flash.styleTransform;n--;)e=t[n],s=a[i=this.dashToCamel(e.name)]?a[i](e.value):e.value,!r.isEmpty(e.value)&&this.player.setStyleAttribute(i,s)},setId3Options:function(t){this.id3Options=t},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(t){var e=!1===t?"false":"true";this.player.enableDynamicStreaming(e)},switchToBitrate:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&this.player.switchStreamingIndex(e.index)},setMinBitrateAllowed:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&(this.bitrateInfo.min=e.bitrate,this.player.setMinimumStreamingIndex(e.index))},setMaxBitrateAllowed:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&(this.bitrateInfo.max=e.bitrate,this.player.setMaximumStreamingIndex(e.index))},switchUp:function(){var t=this.currFlashVideoState.playbackBitrate,e=this.findClosestBitrate(t),i=-1!==e.index&&this.bitrateInfo.bitrates.length;-1!==e.index&&e.index<i-1&&this.player.switchStreamingIndex(e.index+1)},switchDown:function(){var t=this.currFlashVideoState.playbackBitrate,e=this.findClosestBitrate(t);-1!==e.index&&e.index>0&&this.player.switchStreamingIndex(e.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var t=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return t?this.bitrateInfo.bitrates[t-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(t){for(var e,i=this.bitrateInfo.bitrates,s=i?i.length:0,n={bitrate:0,delta:1/0,index:-1};s--;)(e=Math.abs(t-i[s]))<n.delta&&(n.bitrate=i[s],n.index=s,n.delta=e);return n},hContentEvent:function(t){var e=window.uvpjs.VPF_Flash.uvpFlashEvent.content;switch(t){case e.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case e.CONTENT_END:}},hPlaybackEvent:function(t,e){var i,s=window.uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(t){case s.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+e);break;case s.VIDEO_PROGRESS:this.processCvioPayload(e);break;case s.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(e);break;case s.VIDEO_ERROR:this.processCvioPayload(e),this.dispatchError();break;case s.VIDEO_DONE:this.processCvioPayload(e),window.uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case s.VIDEO_TRANSITION_COMPLETE:i=this.parsePayload(e),this.resourceProvider.facadeVideoTransitionComplete(i.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case s.VIDEO_TRANSITION_START:i=this.parsePayload(e),this.pendingSwitchMode=i.reason.toLowerCase().indexOf("manual")>=0?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(i.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new window.uvpjs.ErrorInfo({eventType:window.uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(t){var e,i,s=this.parsePayload(t,"ContentVIO");if(s){for(e in i=s.ContentVIO)this.currFlashVideoState[e]=this.getCvioValue(i[e]);null===this.bitrateInfo.bitrates&&i.currentTime>0&&this.captureBitrateInfo()}},setStartBitrate:function(){this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var t=[],e=[],i=this.player.getContentBitrateInfo(),s="string"==typeof i&&i.split(","),n=Array.isArray(s)?s.length:0;n--;)t[n]=+s[n],e[n]={bitrate:+s[n]};this.bitrateInfo.bitrates=t,this.bitrateInfo.abrInfo=e},processCuepointPayload:function(t){var i=this.parsePayload(t,"Cuepoint"),s=this.id3Options,n={pts:null};!i||!s.dataCallback||i.text.indexOf("syncbak.cc")>=0||(n.name=s.findNielsen&&i.text.indexOf(e)>-1?e:i.name,n.data=i.text,s.dataCallback(n))},getCvioValue:function(t){var e,i,s,n,r;return"boolean"==typeof t||"number"==typeof t?t:"string"==typeof t?(i=!(e="NaN"===t||"null"===t||""===t)&&"true"===t.toLowerCase(),s=!e&&!i&&"false"===t.toLowerCase(),n=!e&&!i&&!s&&window.parseInt(t),r=window.isNaN(n)?t:n,e?-1:!!i||!s&&r):void 0},parsePayload:function(t,e){var i=null;if(0===t.indexOf("{")||0===t.indexOf("[")){try{i=JSON.parse(t)}catch(t){return this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to parse "+e+"as JSON; "+t.message),null}return i}return t},addUvpFlashEventListeners:function(){var t,e,i,s,n,r=window.uvpjs.VPF_Flash.uvpFlashEvent,a={},o=function(t,e,i){return t["h"+(e.charAt(0).toUpperCase()+e.substr(1))+"Event"].bind(t,i)};for(i in r)for(n in e=r[i])a[s=e[n]]=o(this,i,s);for(i in t=this.windowLabels=window.uvpjs.UvpSwfService.setWindowMethods(a))this.player.addEventJSCallback(i,t[i])},loadVideo:function(){var t={cdn:window.uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(t.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,t)},initializeCaptionStyles:function(){var t,e={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(t in e)this.player.setStyleAttribute(t,e[t])},dashToCamel:function(t){return t.replace(/(-\w)/g,function(t){return t[1].toUpperCase()})}}),t.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},t.VPF_Flash.styleTransform={_opacity:function(t){return 100*+t},backgroundOpacity:function(t){return window.uvpjs.VPF_Flash.styleTransform._opacity(t)},fontOpacity:function(t){return window.uvpjs.VPF_Flash.styleTransform._opacity(t)},fontSize:function(t){var e=.01*+t.substr(0,t.indexOf("%"));return Math.round(14*e)}}}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.VPF_HTML5=window.uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=window.uvpjs.debug,this.debug&&window.uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=window.uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.hVideoEvent=this.onVideoEvent.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(t){this.debug&&(window.uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",t.resourceProvider.rco.id),window.uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",t)),this._super(t),t.drm.enabled&&(this.fairplayDRM=new window.uvpjs.FairPlayDRM({drm:t.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),!window.uvpjs.util.isEmpty(t.startTime)&&(this.startTime=Math.floor(t.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&window.uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",t)},handleEvent:function(t){var e=this.eventTypes.HTML5;this.videoTagRef&&(this._super(t),t.type===e.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(t,e){this.resourceProvider.facadeError(new window.uvpjs.ErrorInfo({errorCode:t,message:e,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(t){console.log("Error caught at setSource: ",t)}this.debug&&window.uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onVideoEvent:function(t){t.type===this.eventTypes.HTML5.CAN_PLAY&&(this.videoTagRef.removeEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.updateAudioTracksInfo())},switchAudioTrack:function(t){this.videoTagRef.audioTracks?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+t),this.videoTagRef.audioTracks[t].enabled=!0,this.updateAudioTracksInfo()):this.debug&&window.uvpjs.log(this.DEBUG_ID,"Audio Track switching is not supported on this user agent")},updateAudioTracksInfo:function(){var t=this.normalizeAudioTrackInfo(this.videoTagRef.audioTracks,window.uvpjs.mediaCapabilities.HTML5);if(t){var e=this.getCurrentEnabledAudioTrackIndex(this.videoTagRef.audioTracks),i={tracks:t,track:t[e],index:e};this.resourceProvider.facadeSetAudioTrackInfo(i)}},getCurrentEnabledAudioTrackIndex:function(t){for(var e=t.length;e--;)if(t[e].enabled)return e;return e},onAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(this.activeMetadataTrack=t.track),t.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(t){t&&t.target&&t.target.activeCues&&t.target.activeCues.length>=1&&("metadata"===t.target.kind?this.resourceProvider.facadeId3Data(t.target.activeCues):"captions"!==t.target.kind&&"subtitles"!==t.target.kind||(t.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},showCaptions:function(t){if(window.uvpjs.util.isDefinedString(t))for(var e=this.videoTagRef.textTracks,i=0,s=e.length;i<s;i++){var n=e[i];n.mode=n.language===t?"hidden":"disabled"}},removeEvents:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return window.uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(t){if(e.isEmpty(this.resourceProvider)||e.isEmpty(this.resourceProvider.cviModel))this.debug&&window.uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",t);else{var i=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;this.debug&&window.uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",t,i)}}})}(window.uvpjs.register("uvpjs")),window.uvpjs.register("uvpjs").VPF_HLSJS=window.uvpjs.VideoPlayerFacade.subClass({debug:"prod"!==window.uvpjs.Configuration.env,DEBUG_ID:window.uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:window.uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:window.uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:window.uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:window.uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=window.uvpjs.debug,this._super(),this.debug&&window.uvpjs.log(this.DEBUG_ID,"HLS.js version: "+window.Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isHdStreamLive=!1,this.id3HandlingEnabled=!1,this.mc=window.uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.levelDetails=null,this.isMobile=window.uvpjs.mediaCapabilities.isMobile(),this.libConfig={debug:window.uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onAudioEvent=this.onAudioEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"destroy");for(var t=this.videoTagRef.textTracks,e=0;e<t.length;e++){var i=t[e];"captions"!==i.kind&&"subtitles"!==i.kind||(i.textTrack1&&(i.textTrack1=!1),i.textTrack2&&(i.textTrack2=!1))}this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null,this.levelDetails=null},initialize:function(t){return this._super(t),this.id3HandlingEnabled=t.enableId3Handling,"number"==typeof t.liveSyncDurationCount&&t.liveSyncDurationCount>0&&(this.libConfig.liveSyncDurationCount=t.liveSyncDurationCount),!0===t.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=t.capLevelToPlayerSize),this.isMobile&&(this.libConfig.maxBufferLength=20,this.libConfig.maxMaxBufferLength=60,this.libConfig.liveBackBufferLength=30),window.uvpjs.util.isEmpty(t.hlsjsLoader)||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=t.hlsjsLoader),this.player=new window.Hls(this.libConfig),this.addEvents(),"number"==typeof t.startBitrate&&t.startBitrate>-1&&(this.startBitrate=t.startBitrate),"number"==typeof t.maxBitrate&&t.maxBitrate>-1&&(this.maxBitrate=t.maxBitrate),"number"==typeof t.minBitrate&&t.minBitrate>-1&&(this.minBitrate=t.minBitrate),t.startTime&&(this.startTime=Math.round(t.startTime)),t.errorRecovery&&this.setErrorRecoveryOverrides(t.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){this.player&&this._isHdStreamLive?this.seekTo(this.getLiveEdgeOffset()):window.uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+window.isHDStreamLive)},isAbrStreamingSupported:function(){return this.bitrateList?this.bitrateList.length>0:this._super()},useDynamicSwitching:function(t){this._super(),this.player?this.player.nextLevel=t?-1:this.player.currentLevel:window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchAudioTrack:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+t),this.player.audioTrack=t},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(t){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,t,!1))},switchToIndex:function(t){if(this.isAbrStreamingSupported()){this.getMinBitrateAllowed()>0&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&this.getMaxBitrateAllowed()>0&&this.setMaxBitrateAllowed(-1);var e=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):window.NaN,i=window.isNaN(e)?this.bitrateList.length-1:e;t>=0&&t<=i?this.player.nextLevel=t:window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",i," : Index=",t)}else window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){this.player.subtitleTracks.length>0&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var t=this.player;return this.startBitrate||this.minBitrate||t&&t.levels&&t.levels[0]&&t.levels[0].bitrate||-1},setStartBitrate:function(t){this.player?(t<this.getMinBitrateAllowed()&&(t=this.getMinBitrateAllowed(),this.debug&&window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,t,!1)):window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var t=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[t].bitrate:this._super()}return window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(t){if(this.player){this.player.config.minAutoBitrate=t-1;var e=this.getIndexForBitrate(this.bitrateList,t,!0);this.player.currentLevel<e&&(this.player.nextAutoLevel=e),window.uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",t)}else window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var t=this.player.maxAutoLevel;return void 0!==t?this.bitrateList[t].bitrate:this._super()}return window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(t){if(!this.player)return window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===t?t:this.getIndexForBitrate(this.bitrateList,t,!1),window.uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",t)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(window.uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var t=-1;return this.bitrateList&&this.bitrateList[this.player.currentLevel]&&(t=this.bitrateList[this.player.currentLevel].bitrate),t},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var t,e;if(this.player)return(e=(t=this.player.media).getVideoPlaybackQuality)&&"function"==typeof e?e.call(t).droppedVideoFrames:t.webkitDroppedFrameCount||0},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var t=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,e=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(e,t)},getFacadeState:function(){this.videoTagRef&&this.videoTagRef.textTracks.length>0&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var t={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(t.abrInfo=this.bitrateList,t.currentAbr=this.bitrateList[this.player.currentLevel],t.cappedAbrInfo=this.getCappedAbrInfo(),t.startBitrate=this.getStartBitrate(),t.currentBitrate=this.getCurrentBitrate(),t.minBitrate=this.getMinBitrateAllowed(),t.maxBitrate=this.getMaxBitrateAllowed()),t},getStreamType:function(){return"HLS"},isPlayingLive:function(){var t=!1;if(this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.currentTime>=0){var e=Math.floor(this.getLiveEdgeOffset());t=Math.ceil(this.videoTagRef.currentTime)>=e}return t},getLiveEdgeOffset:function(){var t=Number.POSITIVE_INFINITY;return this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.duration>0&&(t=this.videoTagRef.duration-this.player.config.liveSyncDurationCount*this.levelDetails.targetduration),t},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var t=window.Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onAudioEvent,n=this.onFragmentEvent;this.player.on(t.MEDIA_ATTACHING,e,!1),this.player.on(t.MEDIA_ATTACHED,e,!1),this.player.on(t.MEDIA_DETACHING,e,!1),this.player.on(t.MANIFEST_PARSED,e,!1),this.player.on(t.MANIFEST_LOADED,e,!1),this.player.on(t.MANIFEST_LOADING,e,!1),this.player.on(t.FPS_DROP,e,!1),this.player.on(t.SUBTITLE_TRACKS_UPDATED,e,!1),this.player.on(t.LEVEL_SWITCHING,i,!1),this.player.on(t.LEVEL_SWITCHED,i,!1),this.player.on(t.LEVEL_LOADING,i,!1),this.player.on(t.LEVEL_LOADED,i,!1),this.player.on(t.LEVEL_UPDATED,i,!1),this.player.on(t.LEVEL_PTS_UPDATED,i,!1),this.player.on(t.AUDIO_TRACKS_UPDATED,s,!1),this.player.on(t.AUDIO_TRACK_SWITCHED,s,!1),this.player.on(t.FRAG_LOADING,n,!1),this.player.on(t.FRAG_LOAD_PROGRESS,n,!1),this.player.on(t.FRAG_LOADED,n,!1),this.player.on(t.FRAG_PARSED,n,!1),this.player.on(t.FRAG_BUFFERED,n,!1),this.player.on(t.FRAG_CHANGED,n,!1),this.player.on(t.FRAG_PARSING_DATA,n,!1),this.id3HandlingEnabled&&this.player.on(t.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(t.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var t=window.Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onAudioEvent,n=this.onFragmentEvent;this.player.off(t.MEDIA_ATTACHING,e),this.player.off(t.MEDIA_ATTACHED,e),this.player.off(t.MEDIA_DETACHING,e),this.player.off(t.MANIFEST_PARSED,e),this.player.off(t.MANIFEST_LOADED,e),this.player.off(t.MANIFEST_LOADING,e),this.player.off(t.FPS_DROP,e),this.player.off(t.SUBTITLE_TRACKS_UPDATED,e),this.player.off(t.LEVEL_SWITCHING,i),this.player.off(t.LEVEL_SWITCHED,i),this.player.off(t.LEVEL_LOADING,i),this.player.off(t.LEVEL_LOADED,i),this.player.off(t.LEVEL_UPDATED,i),this.player.off(t.LEVEL_PTS_UPDATED,i),this.player.off(t.AUDIO_TRACKS_UPDATED,s,!1),this.player.off(t.AUDIO_TRACK_SWITCHED,s,!1),this.player.off(t.FRAG_LOADING,n),this.player.off(t.FRAG_LOAD_PROGRESS,n),this.player.off(t.FRAG_LOADED,n),this.player.off(t.FRAG_PARSED,n),this.player.off(t.FRAG_BUFFERED,n),this.player.off(t.FRAG_CHANGED,n),this.player.off(t.FRAG_PARSING_DATA,n),this.id3HandlingEnabled&&this.player.off(t.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(t.ERROR,this.onError)},handleManifestData:function(t){this.bitrateList=this.player.levels;for(var e,i=t.levels,s=i.length,n=[];s--;)e=i[s],n.unshift({name:e.name||null,rate:e.bitrate,width:e.width,height:e.height});n.sort(function(t,e){var i=t.rate,s=e.rate;return i<s?-1:i>s?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:n})},onRequest:function(t,e){this.withCredentials=this.withCredentials||e.indexOf("akamaihd")>-1&&e.indexOf("csmil")>-1,t.withCredentials=this.withCredentials,(this.multiCDNEnabled||-1!==e.indexOf(".m3u8"))&&t.addEventListener("readystatechange",function(i){if(-1!==e.indexOf(".ts")&&t.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled){var s=t.getAllResponseHeaders();this.multiCDNEnabled=-1!==s.indexOf(this.responseHeaders.MULTI_CDN);var n=this.multiCDNEnabled?t.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(e);this.processResponseHeader(n,this.responseHeaders.MULTI_CDN)}}.bind(this))},onLibraryEvent:function(t,e){this.debug&&window.uvpjs.log(this.LIB_DEBUG_ID,t,e);var i=window.Hls.Events;switch(t){case i.MEDIA_ATTACHING:case i.MEDIA_ATTACHED:case i.MEDIA_DETACHING:case i.MANIFEST_LOADING:break;case i.MANIFEST_PARSED:this.handleManifestData(e);break;case i.FPS_DROP:break;case i.MANIFEST_LOADED:this.maxBitrate>-1&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),this.minBitrate>-1&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),this.startBitrate>-1&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case i.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(t,e){this.debug&&window.uvpjs.log(this.LEVEL_DEBUG_ID,t,e);var i=window.Hls.Events;switch(t){case i.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(e.details);break;case i.LEVEL_LOADING:break;case i.LEVEL_UPDATED:e.details&&(this.levelDetails=e.details,this._isHdStreamLive=e.details.live);break;case i.LEVEL_PTS_UPDATED:break;case i.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[e.level].bitrate);break;case i.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[e.level].bitrate)}},onAudioEvent:function(t,e){if(t===window.Hls.Events.AUDIO_TRACKS_UPDATED||t===window.Hls.Events.AUDIO_TRACK_SWITCHED){var i=this.normalizeAudioTrackInfo(this.player.audioTracks,this.mc.HLSJS),s={tracks:i,track:i[this.player.audioTrack],index:this.player.audioTrack};this.resourceProvider.facadeSetAudioTrackInfo(s),this.debug&&window.uvpjs.log(this.DEBUG_ID,"Audio Track switched "+s.track.id)}},onFragmentEvent:function(t,e){var i,s,n=window.Hls.Events;switch(t){case n.FRAG_LOAD_PROGRESS:break;case n.FRAG_PARSING_DATA:"video"===e.type&&(this._playbackFramerate=e.nb/(e.endPTS-e.startPTS));break;case n.FRAG_LOADED:i=8e3*(s=e.stats).loaded/Number(window.performance.now()-s.trequest),this._currentBandwidth=i,this._currentMaxBandwidth=Math.max(i,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case n.FRAG_CHANGED:}},onID3Event:function(t,e){this.resourceProvider.facadeId3Data(e.samples)},onError:function(t,e){var i=!1,s=[window.Hls.ErrorDetails.MANIFEST_LOAD_ERROR,window.Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(e.fatal&&-1===s.indexOf(e.details))switch(this.debug&&window.uvpjs.error(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal),e.type){case window.Hls.ErrorTypes.NETWORK_ERROR:(i=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts)&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),window.uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(i).network());break;case window.Hls.ErrorTypes.MEDIA_ERROR:i=this.tryRecoveryFromMediaError()}else e.details===window.Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&window.parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",e.type,e.details,"isFatal: "+e.fatal),i=this.tryRecoveryFromMediaError(),window.setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100)):this.debug&&window.uvpjs.warn(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal);i||(e.response&&e.response.code&&e.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(window.uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,e.details,e.fatal)),this.debug&&window.uvpjs.warn(this.DEBUG_ID,window.uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(e.type,e.details,e.fatal)))},tryRecoveryFromMediaError:function(){var t=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return t&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),window.uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(t).media()),t},getErrorMsg:function(t){var e=t?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,i=" attempt : ";return{network:function(){return i+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+e+i}.bind(this),media:function(){return i+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+e+i}.bind(this)}},getErrorInfoForType:function(t,e,i){var s=window.uvpjs.ErrorInfo,n=window.Hls.ErrorTypes,r=window.uvpjs.ErrorInfo.errorCodes;switch(t){case n.NETWORK_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_NETWORK_ERROR,message:s.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",e),isFatal:i});case n.MEDIA_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_MEDIA_ERROR,message:s.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",e),isFatal:i});case n.MUX_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_MUX_ERROR,message:s.messages.HLSJS_MUX_ERROR.replace("{INFO}",e),isFatal:i});case n.OTHER_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_OTHER_ERROR,message:s.messages.HLSJS_OTHER_ERROR.replace("{INFO}",e),isFatal:i});case r.RESOURCE_GEOBLOCKED:return new s({errorCode:r.RESOURCE_GEOBLOCKED,hlsjsErrorCode:r.HLSJS_OTHER_ERROR,message:s.messages.RESOURCE_GEOBLOCKED,isFatal:i})}},setErrorRecoveryOverrides:function(t){["network","media"].forEach(function(e){t[e]&&t[e].attempts&&"number"==typeof t[e].attempts&&(this.errorRecovery[e+"RetryAttempts"]=t[e].attempts)}.bind(this))}}),function(t){"use strict";function e(t){if(!window.isNaN(t))return t<1048576?(t/1024).toFixed(2)+"k":t<1073741824?(t/1048576).toFixed(2)+"M":(t/1073741824).toFixed(2)+"G"}window.uvpjs.register("uvpjs").Diagnostic=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(t){var e,i=window.uvpjs.Configuration;this.debug=window.uvpjs.debug,this.debug&&window.uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),t&&(e=t.videoEl,this._videoEl=e,this._containerEl=t.containerEl,this._eventsMgr=t.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":i.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},window.uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),this._diagEl&&this._contentEl?(this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window.")},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=t,this._createDiag(),this._addEventListeners()},_createDiag:function(){var t,e,i,s=window.uvpjs.util,n=this._styleEl,r=this._contentEl;this._template,this._params,r&&((t=window.document.createElement("div")).id=this._diagnosticId,r.insertBefore(t,r.firstChild),(i=window.uvpjs.util.htmlToElement("<span>x</span>")).addEventListener("click",this._handleCloseButton.bind(this),!0),t.appendChild(i),e=window.document.createElement("table"),t.appendChild(e),s.addCSSObject(n,t,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),s.addCSSObject(n,t,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),s.addCSSObject(n,t,{color:"#fff"},"span:hover"),s.addCSSObject(n,t,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),s.addCSSObject(n,t,{background:"transparent"},"table td"),s.addCSSObject(n,t,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),s.addCSSObject(n,t,{width:"60px"},"table td:last-child"),this._diagEl=t,this._diagTableEl=e,this._hideDiagBtn=i)},_removeDiag:function(){var t=this._diagEl,e=this._hideDiagBtn;e&&e.removeEventListener("click",this._handleCloseButton.bind(this)),t&&t.remove()},_hideDiag:function(){var t=this._diagEl,e=this._eventsMgr;t&&(t.style.display="none"),e.dispatchEvent(e.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var t=this._diagEl;t&&(t.style.display="block")},_toggleDiag:function(){var t=this._diagEl;if(t)return"block"===t.style.display?void this._hideDiag():void this._showDiag()},_handleCloseButton:function(){var t=this._eventsMgr;this.debug&&window.uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),t.dispatchEvent(t.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;this._containerEl,e&&t?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),e.addEventListener(i.VIDEO_PROGRESS+t,this._onVideoProgress.bind(this)),e.addEventListener(i.VIDEO_STATE_CHANGE+t,this._onVideoStateChange.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_START+t,this._onVideoTransitionStart.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_COMPLETE+t,this._onVideoTransitionComplete.bind(this))):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;this._containerEl,e&&t?(e.removeEventListener(i.VIDEO_PROGRESS+t),e.removeEventListener(i.VIDEO_STATE_CHANGE+t),e.removeEventListener(i.VIDEO_TRANSITION_START+t),e.removeEventListener(i.VIDEO_TRANSITION_COMPLETE+t)):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners.")},_updateTableHtml:function(){var t,e,i="",s=this._params;for(t in s)null!==(e=s[t])&&void 0!==e&&(i+="<tr><td>"+t+"</td><td>"+e+"</td></tr>");this._diagTableEl.innerHTML=i},_onVideoProgress:function(t){var i=t.payload,s=i.facadeState,n=this._params,r=s.minABRLevel,a=s.maxABRLevel;t.target===this._containerId&&(n["stream type"]=i.streamType,n.duration=i.duration,n["current time"]=i.currentTime.toFixed(2),n["buffer length"]=i.bufferLength.toFixed(2),n["total dropped frames"]=i.droppedFrames>=0&&i.droppedFrames||null,n["average dropped (fps)"]=i.averageDroppedFPS>=0&&i.averageDroppedFPS.toFixed(2)||null,n["playback framerate (fps)"]=i.playbackFramerate>=0&&i.playbackFramerate.toFixed(2)||null,n["current bandwidth (B/s)"]=i.currentBandwidth>=0&&e(i.currentBandwidth)||null,n["switching mode"]=i.switchingMode,n["current index bitrate (B/s)"]=e(s.currentAbr&&s.currentAbr.bitrate),n["start index bitrate (B/s)"]=e(s.startBitrate),void 0!==r&&void 0!==a&&(n["available indexes"]=r+" to "+a),this._updateTableHtml())},_onVideoStateChange:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(i["playback state"]=e.newState,this._updateTableHtml())},_onVideoTransitionStart:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",e),i["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",e),i["transition state"]="complete",this._updateTableHtml())}})}(),function(t){"use strict";window.uvpjs.register("uvpjs").Watermark=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(t){var e;this.debug=window.uvpjs.debug,this.debug&&window.uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){this._imgEl&&this._contentEl?(this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null):this.debug&&window.uvpjs.warn(this.DEBUG,"Unable to remove watermark.")},_createImage:function(){var t;this._contentEl&&((t=window.document.createElement("img")).id=this._watermarkId,t.src=this.IMAGE,t.style.position="absolute",t.style.display="none",this._imgEl=t,this._contentEl.appendChild(t))},_removeImage:function(){var t=this._imgEl;t&&t.parentNode&&t.parentNode.removeChild(t)},_ensureImage:function(){window.document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var t=this._imgEl;t&&(t.style.display="none")},_showImage:function(){var t=this._imgEl;t&&(t.style.display="block")},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.addEventListener(i.AD_START+t,this._hideImage.bind(this)),e.addEventListener(i.CONTENT_START+t,this._showImage.bind(this)),e.addEventListener(i.CONTENT_END+t,this._hideImage.bind(this)),e.addEventListener(i.CONTAINER_RESIZE+t,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),e.addTimedEventCallback(e.HALF_SECOND,t,this._ensureImage.bind(this))):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.removeEventListener(i.AD_START+t),e.removeEventListener(i.CONTENT_START+t),e.removeEventListener(i.CONTENT_END+t),e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeTimedEventCallback(this.TIMER_INTERVAL,t),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(t){t.target===this._containerId&&this._setPosition()},_setPosition:function(){var t,e,i,s,n,r,a,o,l,d,u,h,c,p,f,v,g,_,E,m,A;e=this._contentEl,i=this._videoEl,(t=this._imgEl)&&i&&e&&(c=i.videoHeight,(p=i.videoWidth)&&c&&(r=this.OFFSET,d=this.SIZE,a=i.getBoundingClientRect(),f=e.getBoundingClientRect(),u=(o=a.height)/(l=a.width)/(h=c/p),s=l*h,n=o/h,v=f.bottom-a.bottom,g=f.right-a.right,u>1?(_=(o-s)/2,E=0,A=l*d+"px",m="auto"):(_=0,E=(l-n)/2,A="auto",m=o*d*(this.RATIO/h)+"px"),t.style.width=A,t.style.height=m,t.style.bottom=_+v+r+"px",t.style.right=E+g+r+"px"))}})}(),function(t){"use strict";window.uvpjs.register("uvpjs").Kaleidoscope360=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:window.uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(t){var e;this.debug=window.uvpjs.debug,this.debug&&window.uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){this._360El&&this._kaleidoscopeViewer?(this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null):this.debug&&window.uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360.")},_loadKaleidoscope:function(t){return"function"!=typeof t?void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),window.Kaleidoscope&&window.Kaleidoscope.Video?void this.pluginLoadedCB():(this.codeLoader=new window.uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB)))},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=window.document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.addEventListener(i.CONTAINER_RESIZE+t,this._handleContainerResize.bind(this)),e.addEventListener(i.CONTENT_START+t,this._startKaleidoscopeRender.bind(this))):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeEventListener(i.CONTENT_START+t)):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")}})}(),window.uvpjs.register("uvpjs").ResourceConfigObject=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(t,e,i){this.debug=window.uvpjs.debug,this.validationInfo=null,this.id=e,this.vidContId=i,this.rcoSeed={},this.initialize(t)},initialize:function(t){this.validationInfo=this.validateUserRco(t),this.validationInfo&&(this.rcoSeed=t,this.populateSelf(t))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(t){var e;for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},has:function(t){return!window.uvpjs.util.isEmpty(this[t])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(t){return{error:!1,message:""}}}),window.uvpjs.register("uvpjs").RCO_URL=window.uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t),i=window.uvpjs.util.isDefinedString(t.assetURL);return{error:e.error||!i,message:e.error?e.message:"Invalid assetURL"}}}),window.uvpjs.register("uvpjs").DaiRco=window.uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(t,e,i)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(t){this.cmsRefGuid=t,this.daiParams.daiVideoId=t},canMakePlatformCall:function(t){var e=window.uvpjs.util.isDefinedString(t),i=this.has("selectorCall")&&this.selectorCall||e&&t;return!!i&&(i.indexOf("$PID$")>-1?this.has("pid"):!(i.indexOf("$GUID$")>-1)||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var t=this.daiParams.dfpMediaId,e=this.daiParams.daiVideoId,i=t||e||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return t||e||i},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(t){var e=window.google&&window.google.ima&&window.google.ima.dai,i=this.validateDaiConfig(t),s=this._super(t),n=e?i?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing.";return{error:!((t.useSsb||e)&&i&&!s.error),missingSDK:!e,message:s.error?s.message:n}},populateSelf:function(t){var e,i;for(e in t)(i=t.hasOwnProperty(e))&&void 0!==this.daiParams[e]?this.daiParams[e]=t[e]:i&&(this[e]=t[e]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(t){var e=window.uvpjs.util,i=!e.isEmpty(t.adTagParameters),s=!e.isEmpty(t.contentSourceId),n=!e.isEmpty(t.assetKey);return t.useSsb||n||i&&s?t.useSsb?!e.isEmpty(t.assetURL):n||i&&s:(this.debug&&window.uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),i&&s)},checkCustomAdTagParams:function(){var t,e=window.uvpjs.util,i=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;i&&"string"!=typeof i&&e.isPlainObject(i)&&(t=e.queryStrFromObj(i),this.daiParams.adTagParameters.cust_params=window.encodeURIComponent(t))}}),window.uvpjs.register("uvpjs").RCO_IMA=window.uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=window.google&&window.google.ima,i=this._super(t);return{error:!(e&&!i.error),missingSDK:!e,message:i.error?i.message:"IMA SDK is missing."}}}),window.uvpjs.register("uvpjs").RCO_Mdialog=window.uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t);return{error:e.error||!window.uvpjs.util.isDefinedString(t.assetURL),message:e.err?e.message:"Invalid assetURL"}}}),window.uvpjs.register("uvpjs").RCO_Platform=window.uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=window.uvpjs.util,i=e.isDefinedString(t.pid),s=!i&&e.isDefinedString(t.cmsRefGuid)&&!e.isDefinedString(t.assetURL),n=this._super(t);return{error:!(!n.error&&(i||s||e.isDefinedString(t.selectorCall))),message:n.error?n.message:"Supplied RCO is not valid for type rp_platform"}}}),function(t){"use strict";t.UvpSwfService=window.uvpjs.Class.subClass({init:function(t){this.debugId=t.debugId,this.debug=window.uvpjs.debug,this.containerId=t.containerId,this.dom=t.contentVideoDom,this.playerDom=t.playerDom,this.callback=t.readyCallback,this.id3OwnerIds=t.id3OwnerIds||"",this.capLevelToPlayerSize=t.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=window.uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,window.setTimeout(this.initialize.bind(this),1)},destroy:function(){var t;for(t in this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype,this.windowLabels)window[this.windowLabels[t]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){window.clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=window.setTimeout(this.setSize.bind(this),40)},setSize:function(){var t=this.getContainerSize(),e=t.width,i=t.height;this.swf&&this.swf.setSize(e,i,0,0)},playerReadyHandler:function(){window.clearTimeout(this.initTimeoutHandle),this.swf=-1!==window.navigator.appName.indexOf("Microsoft")?window[this.swfName]:window.document[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&window.uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),window.clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(t){},startTimer:function(){this.initTimeoutHandle=window.setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(t){t.success?this.startTimer():this.callback(null,this.svcC.error.EMBED_FAILED)},embed:function(t){var e=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,t,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:e.jsReady,playerReady:e.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var t,e,i=this.dom;this.svcC.hasFlash()?(this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),(t=window.document.createElement("div")).id=this.swfName,(e=i.querySelector("video")).style.display="none",i.style.height="100%",this.playerDom.style.height="100%",i.insertBefore(t,e),this.embed(t)):this.callback(null,this.svcC.error.FLASH_NOT_DETECTED)}}),t.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"//vidtech.cbsinteractive.com/uvpjs/uvpjsf/js_falback.swf",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},t.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},t.UvpSwfService.hasFlash=function(){var t=this.swfobject.getFlashPlayerVersion().major;return!window.uvpjs.util.isEmpty(t)&&window.parseInt(t)>0},t.UvpSwfService.setWindowMethods=function(t){var e,i,s,n=window.uvpjs.util;for(e in t)i=t[e],s="f_"+n.uid8(),window[s]=i,t[e]=s;return t},t.UvpSwfService.swfobject=function(){function t(){if(!x&&window.document.getElementsByTagName("body")[0]){try{var t,e=f("span");e.style.display="none",(t=N.getElementsByTagName("body")[0].appendChild(e)).parentNode.removeChild(t),t=null,e=null}catch(t){return}x=!0;for(var i=U.length,s=0;s<i;s++)U[s]()}}function e(t){x?t():U[U.length]=t}function i(){var t=B.length;if(t>0)for(var e=0;e<t;e++){var i=B[e].id,o=B[e].callbackFn,l={success:!1,id:i};if(W.pv[0]>0){var d=p(i);if(d)if(!g(B[e].swfVersion)||W.wk&&W.wk<312)if(B[e].expressInstall&&n()){var u={};u.data=B[e].expressInstall,u.width=d.getAttribute("width")||"0",u.height=d.getAttribute("height")||"0",d.getAttribute("class")&&(u.styleclass=d.getAttribute("class")),d.getAttribute("align")&&(u.align=d.getAttribute("align"));for(var h={},c=d.getElementsByTagName("param"),f=c.length,v=0;v<f;v++)"movie"!=c[v].getAttribute("name").toLowerCase()&&(h[c[v].getAttribute("name")]=c[v].getAttribute("value"));r(u,h,i,o)}else a(d),o&&o(l);else E(i,!0),o&&(l.success=!0,l.ref=s(i),l.id=i,o(l))}else if(E(i,!0),o){var _=s(i);_&&typeof _.SetVariable!=I&&(l.success=!0,l.ref=_,l.id=_.id),o(l)}}}function s(t){var e=null,i=p(t);return i&&"OBJECT"===i.nodeName.toUpperCase()&&(e=typeof i.SetVariable!==I?i:i.getElementsByTagName(C)[0]||i),e}function n(){return!G&&g("6.0.65")&&(W.win||W.mac)&&!(W.wk&&W.wk<312)}function r(t,e,i,s){var n=p(i);if(i=c(i),G=!0,S=s||null,b={success:!1,id:i},n){"OBJECT"==n.nodeName.toUpperCase()?(A=o(n),y=null):(A=n,y=i),t.id=M,(typeof t.width==I||!/%$/.test(t.width)&&v(t.width)<310)&&(t.width="310"),(typeof t.height==I||!/%$/.test(t.height)&&v(t.height)<137)&&(t.height="137");var r=W.ie?"ActiveX":"PlugIn",a="MMredirectURL="+window.encodeURIComponent(L.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+r+"&MMdoctitle="+window.encodeURIComponent(N.title.slice(0,47)+" - Flash Player Installation");if(typeof e.flashvars!=I?e.flashvars+="&"+a:e.flashvars=a,W.ie&&4!=n.readyState){var d=f("div");i+="SWFObjectNew",d.setAttribute("id",i),n.parentNode.insertBefore(d,n),n.style.display="none",u(n)}l(t,e,i)}}function a(t){if(W.ie&&4!=t.readyState){t.style.display="none";var e=f("div");t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(o(t),e),u(t)}else t.parentNode.replaceChild(o(t),t)}function o(t){var e=f("div");if(W.win&&W.ie)e.innerHTML=t.innerHTML;else{var i=t.getElementsByTagName(C)[0];if(i){var s=i.childNodes;if(s)for(var n=s.length,r=0;r<n;r++)1==s[r].nodeType&&"PARAM"==s[r].nodeName||8==s[r].nodeType||e.appendChild(s[r].cloneNode(!0))}}return e}function l(t,e,i){var s,n=p(i);if(i=c(i),W.wk&&W.wk<312)return s;if(n){var r,a,o,l=f(W.ie?"div":C);for(o in typeof t.id==I&&(t.id=i),e)e.hasOwnProperty(o)&&"movie"!==o.toLowerCase()&&d(l,o,e[o]);for(r in W.ie&&(l=function(t,e){var i=f("div");return i.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+t+"'>"+e+"</object>",i.firstChild}(t.data,l.innerHTML)),t)t.hasOwnProperty(r)&&("styleclass"===(a=r.toLowerCase())?l.setAttribute("class",t[r]):"classid"!==a&&"data"!==a&&l.setAttribute(r,t[r]));W.ie?j[j.length]=t.id:(l.setAttribute("type",P),l.setAttribute("data",t.data)),n.parentNode.replaceChild(l,n),s=l}return s}function d(t,e,i){var s=f("param");s.setAttribute("name",e),s.setAttribute("value",i),t.appendChild(s)}function u(t){var e=p(t);e&&"OBJECT"==e.nodeName.toUpperCase()&&(W.ie?(e.style.display="none",function t(){if(4==e.readyState){for(var i in e)"function"==typeof e[i]&&(e[i]=null);e.parentNode.removeChild(e)}else window.setTimeout(t,10)}()):e.parentNode.removeChild(e))}function h(t){return t&&t.nodeType&&1===t.nodeType}function c(t){return h(t)?t.id:t}function p(t){if(h(t))return t;var e=null;try{e=N.getElementById(t)}catch(t){}return e}function f(t){return N.createElement(t)}function v(t){return window.parseInt(t,10)}function g(t){t+="";var e=W.pv,i=t.split(".");return i[0]=v(i[0]),i[1]=v(i[1])||0,i[2]=v(i[2])||0,e[0]>i[0]||e[0]==i[0]&&e[1]>i[1]||e[0]==i[0]&&e[1]==i[1]&&e[2]>=i[2]}function _(t,e,i,s){var n=N.getElementsByTagName("head")[0];if(n){var r="string"==typeof i?i:"screen";if(s&&(T=null,D=null),!T||D!=r){var a=f("style");a.setAttribute("type","text/css"),a.setAttribute("media",r),T=n.appendChild(a),W.ie&&typeof N.styleSheets!=I&&N.styleSheets.length>0&&(T=N.styleSheets[N.styleSheets.length-1]),D=r}T&&(typeof T.addRule!=I?T.addRule(t,e):typeof N.createTextNode!=I&&T.appendChild(N.createTextNode(t+" {"+e+"}")))}}function E(t,e){if(V){var i=e?"visible":"hidden",s=p(t);x&&s?s.style.visibility=i:"string"==typeof t&&_("#"+t,"visibility:"+i)}}function m(t){return null!=/[\\\"<>\.;]/.exec(t)&&typeof window.encodeURIComponent!=I?window.encodeURIComponent(t):t}var A,y,S,b,T,D,I="undefined",C="object",R="Shockwave Flash",P="application/x-shockwave-flash",M="SWFObjectExprInst",O="onreadystatechange",L=window,N=window.document,k=window.navigator,w=!1,U=[],B=[],j=[],F=[],x=!1,G=!1,V=!0,H=!1,W=function(){var t=typeof N.getElementById!=I&&typeof N.getElementsByTagName!=I&&typeof N.createElement!=I,e=k.userAgent.toLowerCase(),i=k.platform.toLowerCase(),s=/win/.test(i||e),n=/mac/.test(i||e),r=!!/webkit/.test(e)&&window.parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),a="Microsoft Internet Explorer"===k.appName,o=[0,0,0],l=null;if(typeof k.plugins!=I&&typeof k.plugins[R]==C)(l=k.plugins[R].description)&&typeof k.mimeTypes!=I&&k.mimeTypes[P]&&k.mimeTypes[P].enabledPlugin&&(w=!0,a=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=v(l.replace(/^(.*)\..*$/,"$1")),o[1]=v(l.replace(/^.*\.(.*)\s.*$/,"$1")),o[2]=/[a-zA-Z]/.test(l)?v(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof L.ActiveXObject!=I)try{var d=new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash");d&&(l=d.GetVariable("$version"))&&(a=!0,o=[v((l=l.split(" ")[1].split(","))[0]),v(l[1]),v(l[2])])}catch(t){}return{w3:t,pv:o,wk:r,ie:a,win:s,mac:n}}();return W.w3&&((typeof N.readyState!=I&&("complete"===N.readyState||"interactive"===N.readyState)||typeof N.readyState==I&&(N.getElementsByTagName("body")[0]||N.body))&&t(),x||(typeof N.addEventListener!=I&&N.addEventListener("DOMContentLoaded",t,!1),W.ie&&(N.attachEvent(O,function e(){"complete"==N.readyState&&(N.detachEvent(O,e),t())}),L==window.top&&function e(){if(!x){try{N.documentElement.doScroll("left")}catch(t){return void window.setTimeout(e,0)}t()}}()),W.wk&&function e(){if(!x)return/loaded|complete/.test(N.readyState)?void t():void window.setTimeout(e,0)}())),U[0]=function(){w?function(){var t=N.getElementsByTagName("body")[0],e=f(C);e.setAttribute("style","visibility: hidden;"),e.setAttribute("type",P);var s=t.appendChild(e);if(s){var n=0;!function r(){if(typeof s.GetVariable!=I)try{var a=s.GetVariable("$version");a&&(a=a.split(" ")[1].split(","),W.pv=[v(a[0]),v(a[1]),v(a[2])])}catch(t){W.pv=[8,0,0]}else if(n<10)return n++,void window.setTimeout(r,10);t.removeChild(e),s=null,i()}()}else i()}():i()},W.ie&&window.attachEvent("onunload",function(){for(var t=F.length,e=0;e<t;e++)F[e][0].detachEvent(F[e][1],F[e][2]);for(var i=j.length,s=0;s<i;s++)u(j[s]);for(var n in W)W[n]=null;for(var r in W=null,swfobject)window.swfobject[r]=null;window.swfobject=null}),{registerObject:function(t,e,i,s){if(W.w3&&t&&e){var n={};n.id=t,n.swfVersion=e,n.expressInstall=i,n.callbackFn=s,B[B.length]=n,E(t,!1)}else s&&s({success:!1,id:t})},getObjectById:function(t){if(W.w3)return s(t)},embedSWF:function(t,i,s,a,o,d,u,h,p,f){var v=c(i),_={success:!1,id:v};W.w3&&!(W.wk&&W.wk<312)&&t&&i&&s&&a&&o?(E(v,!1),e(function(){s+="",a+="";var e={};if(p&&typeof p===C)for(var c in p)e[c]=p[c];e.data=t,e.width=s,e.height=a;var m={};if(h&&typeof h===C)for(var A in h)m[A]=h[A];if(u&&typeof u===C)for(var y in u)if(u.hasOwnProperty(y)){var S=H?window.encodeURIComponent(y):y,b=H?window.encodeURIComponent(u[y]):u[y];typeof m.flashvars!=I?m.flashvars+="&"+S+"="+b:m.flashvars=S+"="+b}if(g(o)){var T=l(e,m,i);e.id==v&&E(v,!0),_.success=!0,_.ref=T,_.id=T.id}else{if(d&&n())return e.data=d,void r(e,m,i,f);E(v,!0)}f&&f(_)})):f&&f(_)},switchOffAutoHideShow:function(){V=!1},enableUriEncoding:function(t){H=typeof t===I||t},ua:W,getFlashPlayerVersion:function(){return{major:W.pv[0],minor:W.pv[1],release:W.pv[2]}},hasFlashPlayerVersion:g,createSWF:function(t,e,i){return W.w3?l(t,e,i):void 0},showExpressInstall:function(t,e,i,s){W.w3&&n()&&r(t,e,i,s)},removeSWF:function(t){W.w3&&u(t)},createCSS:function(t,e,i,s){W.w3&&_(t,e,i,s)},addDomLoadEvent:e,addLoadEvent:function(t){if(typeof L.addEventListener!=I)L.addEventListener("load",t,!1);else if(typeof N.addEventListener!=I)N.addEventListener("load",t,!1);else if(typeof L.attachEvent!=I)!function(t,e,i){t.attachEvent(e,i),F[F.length]=[t,e,i]}(L,"onload",t);else if("function"==typeof L.onload){var e=L.onload;L.onload=function(){e(),t()}}else L.onload=t},getQueryParamValue:function(t){var e=N.location.search||N.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return m(e);for(var i=e.split("&"),s=0;s<i.length;s++)if(i[s].substring(0,i[s].indexOf("="))==t)return m(i[s].substring(i[s].indexOf("=")+1))}return""},expressInstallCallback:function(){if(G){var t=p(M);t&&A&&(t.parentNode.replaceChild(A,t),y&&(E(y,!0),W.ie&&(A.style.display="block")),S&&S(b)),G=!1}},version:"2.3"}}()}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.ResourceProvider=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=window.uvpjs.debug,this.vidContId="",this.containers=t.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=t.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=t.p2pClient,this.multiCdnClient=t.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=window.uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(t.rco,t.cviMgr,t.vidContId)},initialize:function(t,i,s){var n;this.debug&&window.uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",t),this.rco=t,this.vidContId=s,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",(n=this.cviModel.contentVideoState).sendResumeEvent=!1,n.startTime=0,n.elapsedTime=0,n.showPreroll=!0,n.playedChapterTime=0,n.previousSessionId="",this.contentDataProxy=new window.uvpjs.ContentDataProxy({cviModel:this.cviModel,eventsManager:this.eventsMgr}),e.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var t=this.eventsMgr;this._removeTimers(),t.addTimedEventCallback(t.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),t.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(t){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(t)},_removeTimers:function(){var t=this.eventsMgr;t.removeTimedEventCallback(t.TENTH_SECOND,this.internalNS),t.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var t=this.rco&&this.rco.rcoSeed;this.debug&&window.uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(t)},cleanUpObjects:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(t){var e=this.cviModel;this.debug&&window.uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),e.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),e.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),e.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=t,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(t){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new window.uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,t)})):this.finishLoadVideoAndBeginPlayback(t),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():window.uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(t,e,i){var s,n=window.uvpjs.ErrorInfo;if(i)return s=new n({errorCode:n.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+i,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:s},this.vidContId);window.setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,t),2)},handleCdnDecision:function(t,e){this.setNewAssetUrlAndCdn(e),this.doFlashCheck(t)},shouldUseFlash:function(){var t=this.mc.systemInfo,e=this.cviModel.getSessionOption("preventFlashPlayback"),i=t.supportsNativeHls||t.isHlsjsEligible,s=!e&&t.isDesktop&&window.uvpjs.UvpSwfService.hasFlash(),n=this.mc.isHlsUrl(this._getAssetUrl()),r=window.uvpjs.Configuration.env;return!("local"!==r&&"dev"!==r&&"stage"!==r||!window.forceFlash||!s)||n&&!i&&s},prepForCaptionEvents:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY,t.SET_CAPTIONS_LANG],i=e.length;i--;)this.eventsMgr.addEventListener(e[i]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY,t.SET_CAPTIONS_LANG],i=e.length;i--;)this.eventsMgr.removeEventListener(e[i]+this.internalNS)},hCaptionEventForUvp:function(t){var e=this.eventsMgr.eventTypes;if(this._hasFacade()&&t.target===this.vidContId)switch(t.type){case e.CAPTIONS_READY:window.uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case e.CONTROL_SHOW_CAPTIONS:window.uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions(t.payload.language);break;case e.CONTROL_HIDE_CAPTIONS:window.uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions();break;case e.SET_CAPTIONS_LANG:window.uvpjs.util.isFunction(this.facade.setCaptionLanguage)&&this.facade.setCaptionLanguage(t.payload.language)}},finishLoadVideoAndBeginPlayback:function(t){var e,i=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),i.incrementMedNum(),this.createFacade(),e=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(e),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),e===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(t){var e,i,s,n=t&&t.providers||null,r=n&&n[0]?n[0]:null,a=r&&r.host||null,o=r&&r.provider||null;a&&(e=this._getAssetUrl(),a!==(i=window.uvpjs.util.parseUrl(e)).host&&(s=i.protocol+"//"+a+i.pathname+i.search,this.cviModel.contentVideoState.assetURL=s)),o&&this.setContentVideoStateCdn(o)},setContentVideoStateCdn:function(t){this.cviModel.contentVideoState.cdn=t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:t},this.vidContId)},getContentVideoStateCdn:function(t){return this.cviModel.contentVideoState.cdn},setModelRcoOverrides:function(){var t=function(t){var e=i.getSessionOption(t);return"boolean"==typeof e?e:void 0!==i.getVideoPlaybackCDOProperty(t)&&i.getVideoPlaybackCDOProperty(t)},e=function(t){var e=i.getSessionOption(t);return"number"==typeof e&&e>=0?e:void 0!==i.getVideoPlaybackCDOProperty(t)?Number(i.getVideoPlaybackCDOProperty(t)):-1},i=this.cviModel,s=e(i.START_BITRATE),n=e(i.MIN_BITRATE),r=e(i.MAX_BITRATE),a=e(i.LIVE_SYNC_DURATION_COUNT),o=t(i.CAP_LEVEL_TO_PLAYER_SIZE),l=t(i.DASHJS_FAST_SWITCH_ABR),d=i.getSessionOption("useDynamicSwitching"),u=i.getSessionOption("errorRecovery"),h=Number(this.rco.startBitrate)||-1,c=Number(this.rco.minBitrate)||-1,p=Number(this.rco.maxBitrate)||-1,f=Number(this.rco.liveSyncDurationCount)||-1,v=this.rco.capLevelToPlayerSize,g=this.rco.enableDashJSFastSwitchABR,_=this.rco.useDynamicSwitching,E=(_=this.rco.useDynamicSwitching,this.rco.errorRecovery);h>-1?(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",h),i.setStartBitrate(h)):i.setStartBitrate(s),c>-1?(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",c),i.setMinBitrate(c)):i.setMinBitrate(n),p>-1?(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",p),i.setMaxBitrate(p)):i.setMaxBitrate(r),f>-1?(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",f),i.setLiveSyncDurationCount(f)):i.setLiveSyncDurationCount(a),"boolean"==typeof v?(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",v),i.setCapLevelToPlayerSize(v)):i.setCapLevelToPlayerSize(o),"boolean"==typeof g?(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",g),i.setDashJSFastSwitchABR(g)):i.setDashJSFastSwitchABR(l),"boolean"==typeof _?(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",_),i.setUseDynamicSwitching(_)):i.setUseDynamicSwitching(d),"object"==typeof E?(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",E),i.setErrorRecovery(E)):i.setErrorRecovery(u)},createId3Parser:function(t){this.id3EventQueue=[];var e={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(t){case this.mc.HLSJS:this.id3Parser=new window.uvpjs.FrameId3Parser(e);break;case this.mc.HTML5:this.id3Parser=new window.uvpjs.TrackId3Parser(e);break;case this.mc.FLASH_HLS:e.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(e)}},handleId3Metadata:function(t){this.id3EventQueue&&this.id3EventQueue.push(t)},checkId3Events:function(t){for(var e,i=this.id3EventQueue,s=i&&i.length||0;s--;)t>=(e=i[s]).pts&&(this.dispatchCuepointEvent(e),this.id3EventQueue.splice(s,1))},dispatchCuepointEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,t,this.vidContId)},createFacade:function(){var t=this.cviModel,e=t.getContentVideoState(),i=this._getAssetUrl(),s={enableId3Handling:this.id3HandlingEnabled,assetURL:i,isMuted:t.isMuted,resourceProvider:this,startTime:e.startTime,startBitrate:t.startBitrate,maxBitrate:t.maxBitrate,minBitrate:t.minBitrate,useDynamicSwitching:t.useDynamicSwitching,liveSyncDurationCount:t.liveSyncDurationCount,volume:t.volume,capLevelToPlayerSize:t.capLevelToPlayerSize,enableDashJSFastSwitchABR:t.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:t.errorRecovery,drm:e.drm};this.debug&&window.uvpjs.log(this.DEBUG_ID,"createFacade",s),this.facade=this.getFacade(i),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(s.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(s.swfService=this.uvpSwfService);var n=this.facade.initialize(s);!n||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:n,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(t.nativeControls)},destroyFacade:function(){var t=this._hasFacade()&&"function"==typeof this.facade.destroy;this.debug&&window.uvpjs.log(this.DEBUG_ID,"destroyFacade"),t?(this.facade.destroy(),this.facade={}):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up.")},muteContentForAdPlay:function(t){var e=this.cviModel,i=this.facade;this._hasFacade()&&(!1!==t?i.muteVideo():e.isMuted||i.unMuteVideo())},getModule:function(t){return this.cviModel.getModule(t)},getModuleParam:function(t,e){return this.cviModel.getModuleParam(t,e)},createWatermark:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var t=this.cviModel.getContentVideoState();this.debug&&window.uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:t},this.vidContId)},dispatchContentEnd:function(){var t=this.cviModel.getContentVideoState();this.debug&&window.uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:t},this.vidContId)},dispatchSeekDone:function(){var t=this.eventsMgr;t.dispatchEvent(t.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var t=this.cviModel&&this.cviModel.contentPlaybackState.fatalError,e=t?"Fatal ERROR encountered":"";this.eventsMgr&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+e),!t&&this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId))},dispatchVideoStateChange:function(t){window.isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:t,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+t,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(t){t&&t.abrInfo&&this.cviModel.setAbrInfo(t.abrInfo)},facadeProgress:function(t){!window.uvpjs.util.isEmpty(t)&&"object"==typeof t&&t.currentTime&&t.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:t.currentTime}),this.setModelDuration(window.parseInt(t.duration)))},facadeDurationChanged:function(t){window.uvpjs.util.isEmpty(t)||"object"!=typeof t||t.duration},setModelDuration:function(t){t>0&&this.cviModel.contentVideoState.duration!==t&&(this.cviModel.setContentVideoStateItems({duration:t}),this.cviModel.setContentPlaybackStateItems({duration:t}))},facadeDone:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"facadeSeeked",t),this._seekFromTime?(this._seekToTime=t.seekToTime,this.dispatchSeekDone()):this.debug&&window.uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE.")},facadeError:function(t){var e,i,s,n,r=window.uvpjs.util,a=this.RPM&&this.RPM.currRP,o=this.eventsMgr,l=this.cviModel,d=!r.isEmpty(l),u=t.isFatal;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+t.message),d&&u&&(i=(e=this.cviModel.getContentVideoState()).playbackStarted,s=r.isDefinedString(e.overrideAssetURL),!i&&s&&!this._overrideAssetUrlFailure))this._handleOverrideAssetURLError(t);else if(d||this.debug&&window.uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),r.isEmpty(o)?this.debug&&window.uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(n=t.eventType||o.eventTypes.VIDEO_PLAYBACK_ERROR,t.eventType=n,o.dispatchEvent(n,{errorInfo:t},this.vidContId)),u){if(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),d&&(l.contentPlaybackState.fatalError=!0),a&&a.rco&&a.rco.type===window.uvpjs.mediaCapabilities.RP_IMA)return void a.imaContentComplete();this.debug&&window.uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp()}},facadePlaybackStateChange:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+t),this.dispatchVideoStateChange(t)},facadeVideoLevelLoaded:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:t},this.vidContId)},facadeVideoTransitionStart:function(t,e){var i=e||(this.cviModel.useDynamicSwitching?"auto":"manual");window.uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+t+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:t,mode:i},this.vidContId)},facadeVideoTransitionComplete:function(t,e){var i=e||(this.cviModel.useDynamicSwitching?"auto":"manual");window.uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+t+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:t,mode:i},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeSetAudioTrackInfo:function(t){this.cviModel.setAudioTrackInfo(t)},facadeId3Data:function(t){this.id3Parser&&this.id3Parser.parse(t)},facadeMinimumBitrateAllowedChanged:function(t){this.cviModel.setMinBitrate(t)},facadeMaximumBitrateAllowedChanged:function(t){this.cviModel.setMaxBitrate(t)},getFacade:function(t){var e,i=this.mc.STREAMING,s=(t=t||this._getAssetUrl(),this.mc.isHlsUrl(t)),n=this.mc.isDashUrl(t),r=this.cviModel.contentVideoState.isFlash;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"getFacade"),(r||s||n)&&this._setDeliveryType(i),!r&&s)this.mc.canPlayHLSJS()&&(e=new window.uvpjs.VPF_HLSJS);else if(!r&&n)if(window.uvpjs.VPF_DASHJS)e=new window.uvpjs.VPF_DASHJS;else{if(!window.uvpjs.VPF_SHAKA)return void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));e=new window.uvpjs.VPF_SHAKA}else r&&(e=new window.uvpjs.VPF_Flash);return e||new window.uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&window.uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",s),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,t.addEventListener(e.CONTROL_SEEK+i,this.onVideoSeekTo.bind(this)),t.addEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i,this.onVideoSeekToLive.bind(this)),t.addEventListener(e.CONTROL_PAUSE+i,this.onPauseVideo.bind(this)),t.addEventListener(e.CONTROL_PLAY+i,this.onPlayVideo.bind(this)),t.addEventListener(e.CONTROL_MUTE+i,this.onMuteVideo.bind(this)),t.addEventListener(e.CONTROL_UNMUTE+i,this.onUnMuteVideo.bind(this)),t.addEventListener(e.CONTROL_VOLUME_SET+i,this.onChangeVideoVolume.bind(this)),t.addEventListener(e.CONTROL_FULLSCREEN+i,this.onFullscreen.bind(this)),t.addEventListener(e.SWITCH_REQUEST+i,this.onSwitchRequest.bind(this)),t.addEventListener(e.USE_DYNAMIC_SWITCHING+i,this.onUseDynamicSwitching.bind(this)),t.addEventListener(e.MAXIMUM_BITRATE_ALLOWED+i,this.onMaximumBitrateAllowed.bind(this)),t.addEventListener(e.MINIMUM_BITRATE_ALLOWED+i,this.onMinimumBitrateAllowed.bind(this)),t.addEventListener(e.CONTAINER_RESIZE+i,this.handleContainerResize.bind(this)),t.addEventListener(e.SWITCH_AUDIO_TRACK+i,this.onSwitchAudioTrack.bind(this)))},_removeUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&window.uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",s),t.removeEventListener(e.CONTROL_SEEK+i),t.removeEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i),t.removeEventListener(e.CONTROL_PAUSE+i),t.removeEventListener(e.CONTROL_PLAY+i),t.removeEventListener(e.CONTROL_MUTE+i),t.removeEventListener(e.CONTROL_UNMUTE+i),t.removeEventListener(e.CONTROL_VOLUME_SET+i),t.removeEventListener(e.SWITCH_REQUEST+i),t.removeEventListener(e.USE_DYNAMIC_SWITCHING+i),t.removeEventListener(e.MAXIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.MINIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.CAPTIONS_READY+i),t.removeEventListener(e.CONTAINER_RESIZE+i),t.removeEventListener(e.SWITCH_AUDIO_TRACK+i)},_getAssetUrl:function(t){var e=window.uvpjs.util,i=t||this.cviModel.getContentVideoState(),s=i.overrideAssetURL,n=e.isDefinedString(s)&&!this._overrideAssetUrlFailure,r=n?s:i.assetURL;return this.debug&&window.uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+n+")",r),r},_setDeliveryType:function(t){this.cviModel.setContentVideoStateItems({deliveryType:t})},_handleOverrideAssetURLError:function(t){var e=window.uvpjs.ErrorInfo,i=this.eventsMgr,s=i.eventTypes.VIDEO_START_ERROR,n=e.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&window.uvpjs.warn(this.DEBUG_ID,n+" Error using overrideAssetURL; will use assetURL."),t.eventType=s,t.message=n,t.isFatal=!1,t.errorCode=e.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,i.dispatchEvent(s,{errorInfo:t},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.bitrate,n=this.cviModel,r=this.facade;if(e===this.vidContId&&s&&this._hasFacade())switch(typeof s){case"string":if("up"===s)n.setUseDynamicSwitching(!1),r.switchUp();else if("down"===s)n.setUseDynamicSwitching(!1),r.switchDown();else{if(s=Number(s),window.isNaN(s))return;n.setUseDynamicSwitching(!1),r.switchToBitrate(s)}break;case"number":n.setUseDynamicSwitching(!1),r.switchToBitrate(s);break;default:this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",s)}},onSwitchAudioTrack:function(t){window.uvpjs.util.isFunction(this.facade.switchAudioTrack)&&this.facade.switchAudioTrack(t.payload.id)},onUseDynamicSwitching:function(t){if(t&&t.target===this.vidContId&&t.payload){var e=t.payload.data;this.cviModel.setUseDynamicSwitching(e),this._hasFacade()&&(this.facade.useDynamicSwitching(e),e&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&window.uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",e)}},onMinimumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,s=this.facade;if(t.target===this.vidContId){if(!i||"number"!=typeof i)return void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i));this.cviModel.setMinBitrate(i),this._hasFacade()&&s.setMinBitrateAllowed(i)}},onMaximumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,s=this.facade;if(t.target===this.vidContId){if(!i||"number"!=typeof i)return void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i));this.cviModel.setMaxBitrate(i),this._hasFacade()&&s.setMaxBitrateAllowed(i)}},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.cviModel.contentVideoState.duration,r=this.cviModel.contentPlaybackState.currentTime,a=this.facade;if("number"==typeof s&&e===this.vidContId){if(s<0||s>n)return void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s));this._seekFromTime=this._seekFromTime||r,this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&a.seekTo(s)}},onVideoSeekToLive:function(){var t=this.facade;this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&t.seekToLive()},facadeVolumeChange:function(t){!e.isNaN(t)&&e.isNumber(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:t},this.vidContId)},facadeLoading:function(t){var e={data:t};t&&(t.bufferLength||t.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,e,this.vidContId)},facadeTimeUpdate:function(t){this.cviModel.setContentPlaybackStateItems({currentTime:t})},onFullscreen:function(t){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(t.payload.isFs)},onPauseVideo:function(t){var e=t&&t.target,i=this.facade;this.debug&&window.uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&i.pauseVideo()},onPlayVideo:function(t){var e=t&&t.target,i=this.facade;this.debug&&window.uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&i.playVideo()},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.vol,n=window.uvpjs.util.inRange(s,0,1),r=this.cviModel.isMuted,a=this.facade;e===this.vidContId&&n&&!r&&this._hasFacade()&&a.setVolume(s)},onMuteVideo:function(t){var e=t&&t.target,i=this.facade;e===this.vidContId&&this._hasFacade()&&i.muteVideo()},onUnMuteVideo:function(t){var e=t&&t.target,i=this.facade;e===this.vidContId&&this._hasFacade()&&i.unMuteVideo()},onUVPJSTimerTick:function(){if(this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING){var t={};this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),t=this.cviModel.getContentVideoState(),!e.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:t},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1);var i=this.getVideoProgressPayload();this.setModelDuration(i.duration),this.id3HandlingEnabled&&this.checkId3Events(i.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,i,this.vidContId)}},checkBuffering:function(t){var e,i=this.cviModel?this.cviModel.contentPlaybackState:null;i&&i.playbackStarted&&i.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(e=t||i.currentTime||0,!this.bufferingDetected&&e<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&e>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=e)},getVideoProgressPayload:function(){var t={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:(this.cviModel.getCurrentVideoState(),this.facade.getDuration()),errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(t),t},setFacadeStateOnProgressPayload:function(t){var e=this.facade,i=this._hasFacade()&&e.getFacadeState();if(!i)return t;t.facadeState=i,t.averageDroppedFPS=e.getAverageDroppedFPS(),t.bufferLength=e.getBuffered()||0,t.currentTime=e.getCurrentTime()||0,t.currentBandwidth=e.getCurrentBandwidth(),t.currentMaxBandwidth=e.getCurrentMaxBandwidth(),t.droppedFrames=e.getDroppedFramesCount(),t.playbackFramerate=e.getPlaybackFramerate(),t.playbackState=e.getPlaybackState(),t.streamType=e.getStreamType(),t.isHDStreamLive=e.isHDStreamLive(),t.isPlayingLive=e.isPlayingLive(),t.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){window.uvpjs.util.supportsLocalStorage()&&(window.localStorage.setItem("UVPJS.resumePid",this.rco.pid),window.localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),window.localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),window.localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var t=this.cviModel.contentVideoState,e=window.localStorage.getItem("UVPJS.resumePid")||null,i=window.localStorage.getItem("UVPJS.resumeContentTime")||null,s=window.localStorage.getItem("UVPJS.resumeEpochTime")||null,n=window.localStorage.getItem("UVPJS.resumeSessionId")||null;window.uvpjs.util.supportsLocalStorage()&&(e&&(t.resumePid=e),i&&(t.resumeContentTime=i),s&&(t.resumeEpochTime=s),n&&(t.resumeSessionId=n))},clearLocalStorageItems:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),window.uvpjs.util.supportsLocalStorage()&&(window.localStorage.setItem("UVPJS.resumePid",""),window.localStorage.setItem("UVPJS.resumeContentTime",0),window.localStorage.setItem("UVPJS.resumeEpochTime",0),window.localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var t=this.cviModel;t&&(t.resetAdVideoState(),t.resetContentVideoState())},_hasFacade:function(){return!window.uvpjs.util.isEmpty(this.facade)}})}(window.uvpjs.register("uvpjs")),function(t){var e=t._,i="pubads.g.doubleclick.net",s="ad.doubleclick.net",n="request.php",r="Request.jsp";t.ContentDataProxy=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(t){this.debug=window.uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=t||{},this.startErrorName=window.uvpjs.EventType.VIDEO_START_ERROR,this.cviModel=this.opts.cviModel,this.eventsMgr=this.opts.eventsManager,this.cviModel.contentVideoStateDefaults&&this.populateDefaults(this.cviModel.contentVideoStateDefaults),this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(t){var e;for(e in t)this.opts[e]=t[e]},getModel:function(){return this.mdl},getProperty:function(t){return this.mdl[t]},setProperty:function(t,e){this.mdl[t]=e},loadData:function(t,e){var i,s="callback=uvpHandleJsonpResult",n=e||this.opts.queryParams,r=!1,a=!window.uvpjs.util.isEmpty(n);if(this.opts.url=t,this.opts.queryParams=e,a)for(i in t+=t.indexOf("?")<0?"?":"&",n)t+=(r?"&":"")+i+"="+n[i],r=!0;t.indexOf(s)<0&&(t+=(t.indexOf("?")<0?"?":"&")+s),this.selectorCall=t,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var t=new window.uvpjs.CodeLoader;this.callAttempts++,this.debug&&window.uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),t.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(t){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(t)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(t){var e,i,s,n,r,a,o,l,d,u=t.getElementsByTagName("ref"),h=null,c=u[0],p=!1,f=this.mdl,v=c&&this.checkForPlatformError(c);if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",t),v&&v.error)return v;if(null===(i=(e=t.getElementsByTagName("switch"))[0]?e[0].getElementsByTagName("video"):t.getElementsByTagName("video"))[0])return{error:!0,errorInfo:new window.uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:window.uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:window.uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(f.chapterTimesString="",c)for(s=0,n=u.length;s<n;s++)o=(r=u[s]).attributes.src.nodeValue,this.isAdCallURL(o)?(!p&&(f.imaAdCall=o),p=!0):h||(h=r,f.assetURL=h.getAttribute("src"),l=r.getElementsByTagName("param")),null!==r.getAttribute("clipEnd")&&(f.chapterTimesString+=r.getAttribute("clipEnd")+",");for(s=0,n=i.length;s<n&&(o=(a=i[s]).attributes.src.nodeValue,h||(h=a,f.assetURL=h.getAttribute("src"),l=a.getElementsByTagName("param"),null!==a.getAttribute("clipEnd")));s++)null!==a.getAttribute("clipEnd")&&(f.chapterTimesString+=a.getAttribute("clipEnd")+",");return d=l&&this.extractParams(l)||{},this.populateModelFromContentNodeAndParams(h,d),{error:!1}},populateModelFromContentNodeAndParams:function(t,e){var i,s,n=this.mdl,r=window.uvpjs.mediaCapabilities,a={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},o={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},l="true";for(q in a)n[q]=t.getAttribute(a[q])||"";for(q in o)n[q]=e[o[q]]||"";n.mediaId=this.getMediaId(e),n.duration=this.getDuration(t),n.sourceOwner=this.getSourceOwner(e),n.cmsRefGuid=t.getAttribute("guid")||t.getAttribute("vid")||"",n.isEmbedable=e.Embeddable===l,n.isLive=e.IsLive===l,n.episodeFlag=e.EpisodeFlag===l,n.useWatermark=e.WatermarkPlayback===l,n.chapterTimesString.length>0?(s=(i=n.chapterTimesString).length-1,i.lastIndexOf(",")===s&&(n.chapterTimesString=i.substring(0,s)),n.chapterStartTimes=this.convertChapterTimesToSeconds(n.chapterTimesString)):n.chapterStartTimes=[],n.assetURL.indexOf(r.M3U)>-1?(n.cdn="",n.fileType=r.M3U):n.assetURL.indexOf(r.MP3)>-1?n.fileType=r.MP3:n.fileType=r.MP4;var d=this.cviModel.getVideoPlaybackCDOProperty("matchPageUrlProtocol")||!1;d&&(n.assetURL=n.assetURL.replace(/^\w*:/,"")),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ContentDataProxy mdl",n,d)},handleData:function(t){var e=t.responseText,i=window.uvpjs.util,s=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),n=this.isValidJsonStr(s)&&JSON.parse(s)||null,r=i.isEmpty(n)?null:n.metafile,a=r&&new window.DOMParser,o=a&&a.parseFromString(r,"application/xml"),l=o&&this.parseSmilXML(o);if(this.callAttempts=0,l){if(l.error)return this.debug&&window.uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+l.errorInfo.message),void this.signalError(l.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&window.uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(t){return"string"==typeof t&&("{"===t.charAt(0)&&"}"===t.charAt(t.length-1)||"["===t.charAt(0)&&"]"===t.charAt(t.length-1))},handleError:function(t){var e,i="ContentDataProxy Error: Unable to load url "+window.uvpjs.util.getErrorMessageForXHRStatus(t.status);this.debug&&window.uvpjs.error(this.DEBUG_ID,i,this.selectorCall),this.shouldRetryCall(t)?(e=this.callDelays[this.callAttempts],this.callAttempts>=1&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:window.uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+e,isFatal:!1})}),window.setTimeout(this.makeSelectorCall.bind(this),e)):(this.callAttempts=0,this.signalError(new window.uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:window.uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:i+" URL: "+this.selectorCall,isFatal:!0,serverCode:t.status})))},shouldRetryCall:function(t){var e=t.status;return this.selectorCall.indexOf("link.theplatform")>-1&&this.callAttempts<this.retryLimit&&500!==e&&404!==e&&403!==e&&0!==e},defineProperties:function(){},checkForPlatformError:function(t){var e=t&&this.parseSmilRefNodeForException(t);return e?{error:!0,errorInfo:new window.uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:window.uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(e),serverCode:e.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new window.uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:window.uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:window.uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(t){var e=t.responseCode||"n/a",i="; PID: "+(this.opts.pid||"n/a")+"; ",s=this.opts&&this.opts.cmsRefGuid+"; "||"",n=t.abstract?t.abstract+" ":"";return"Platform Error; code: "+e+i+s+(t.exception||"Resource Unavailable.")+" "+n},populateDefaults:function(t){!window.uvpjs.util.isEmpty(t)&&e.assign(this.mdl,t)},parseSmilRefNodeForException:function(t){var e,i=t.getElementsByTagName("param"),s={};if(i&&i.length){for(e=i.length;e--;)s[i[e].getAttribute("name")]=i[e].getAttribute("value");if("true"===s.isException)return s.abstract=t.getAttribute("abstract")||"",s}return null},extractParams:function(t){var e,i,s,n,r={};if(window.uvpjs.util.isEmpty(t))return r;for(n=t.length;n--;)i=(e=t[n]).getAttribute("name"),s=e.getAttribute("value"),i&&s&&(r[i]=s);return r},isAdCallURL:function(t){return t.indexOf(s)>-1||t.indexOf(i)>-1||t.indexOf(n)>-1||t.indexOf(r)>-1},getMediaId:function(t){var e,i,s,n="",r=t.trackingData;if(window.uvpjs.util.isEmpty(r))return"";for(i=0,s=(e=r.split("|")).length;i<s;i++)e[i].indexOf("cid=")>-1&&(n=e[i].split("=")[1]);return n},getSourceOwner:function(t){var e=t.Source;return window.uvpjs.util.isEmpty(e)&&"true"===t.WatermarkPlayback?"Entertainment":e||""},getDuration:function(t){var e=window.parseInt(t.getAttribute("dur"))||0;return e>0?.001*e:e},convertChapterTimesToSeconds:function(t){for(var e=[],i=t.split(","),s=i.length,n=function(t){var e=window.parseInt;switch((t=i[s].split(":")).length){case 1:return e(t[0]);case 2:return 60*e(t[0])+e(t[1]);case 3:return 3600*e(t[0])+60*e(t[1])+e(t[2])}};s--;)e.unshift(n(i[s]));return e}})}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.RP_URL=window.uvpjs.ResourceProvider.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this._super(t),this.providerType=window.uvpjs.mediaCapabilities.RP_URL},initialize:function(t,e,i){this._super(t,e,i)},loadData:function(t,i){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),e.isFunction(t)&&e.isFunction(i)?(this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,this.dataLoadErrorCB=i,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS)},loadVideoAndBeginPlayback:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(t)}})}(window.uvpjs.register("uvpjs")),window.uvpjs.register("uvpjs").RP_Platform=window.uvpjs.ResourceProvider.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(t){this._super(t),this.providerType=window.uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(t,e){var i=this.getSelectorCall(),s=i.url||null,n=null;if(i.error)return this.debug&&window.uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+i.message),void("function"==typeof e&&e(new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:window.uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+i.message,isFatal:!0})));this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,window.uvpjs.util.isDefinedString(this.rco.sig)&&(n={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:e}),this.contentDataProxy.loadData(s,n)},loadVideoAndBeginPlayback:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(t)},getSelectorCall:function(){var t,e,i,s,n,r,a,o=this.rco,l=o.has("selectorCall")&&o.selectorCall||null;if(!l){if(i=(l=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"))&&l.indexOf("$PID$")>-1,s=l&&l.indexOf("$GUID$")>-1,t=o.has("pid")&&o.pid||null,e=o.has("cmsRefGuid")&&o.cmsRefGuid||null,(n=!i&&!s)||!t&&!e)return{error:!0,message:"Config error: "+(n?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(i?"pid":"cmsRefGuid"))};r=i?t:e,a=i?/\$PID\$/g:/\$GUID\$/g,l=(l=l.replace(a,r)).replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:l}},onDataProxyComplete:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var t=window.uvpjs.util;t.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),t.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var t,e,i,s,n,r,a,o,l=this.cviModel.contentVideoState,d=this.contentDataProxy,u=this.rco;this.populateContentVideoStateFromLocalStorage(),e=Date.now()-+l.resumeEpochTime,d.setProperty("resumePid",l.resumePid),d.setProperty("resumeEpochTime",+l.resumeEpochTime),d.setProperty("resumeSessionId",l.resumeSessionId),d.setProperty("resumeContentTime",+l.resumeContentTime),d.setProperty("playedChapterTime",+l.playedChapterTime),d.setProperty("showPreroll",l.showPreroll),d.setProperty("sendResumeEvent",!1),d.getProperty("episodeFlag")&&!0!==l.isLive&&(n=!(i=function(){var t=d.getProperty("duration");return!window.uvpjs.util.isEmpty(u.globalResumeTime)&&u.globalResumeTime>0&&t>0&&t-u.globalResumeTime>20}())&&u.pid===l.resumePid,i||n?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"Local"),s=i?u.globalResumeTime:+l.resumeContentTime||0,t=i?0:e||0,o=!i&&e>this.ONE_HOUR_MS,a=i?this.cviModel.sessionId:"",r=this.getPlayedChapterTimeForContentResume(s),d.setProperty("sendResumeEvent",!0),d.setProperty("startTime",s),d.setProperty("elapsedTime",t),d.setProperty("showPreroll",o),d.setProperty("playedChapterTime",r),d.setProperty("previousSessionId",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(n?"local":"global")+"Resume"],startTime:s},this.vidContId)):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(t){var e,i=0,s=this.contentDataProxy.getProperty("chapterStartTimes"),n=s.length||0;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",s),n)for(;n--;)if(t>=(e=s[n])){t-e>=4?i=e:(this.contentDataProxy.setProperty("startTime",t-4),n>0&&(i=s[n-1]));break}return this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",i),i}}),function(t){var e=t._;t.RP_Mdialog=window.uvpjs.ResourceProvider.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=window.uvpjs.debug,this._super(t),this.providerType=window.uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(t,e,i){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",i),this._super(t,e,i)},loadData:function(t,i){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),e.isFunction(t)?(this.dataLoadedCB=t,this.dataLoadErrorCB=i,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS)}})}(window.uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.RP_IMA=window.uvpjs.RP_Platform.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:window.uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_BITRATE_THRESHOLD:2500,AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(t){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(t),this.providerType=window.uvpjs.mediaCapabilities.RP_IMA},initialize:function(t,e,i){var s,n;this.debug&&(window.uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",window.google.ima.VERSION),window.uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",t),window.uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",i)),this.playbackState=this.mc.EMPTY,this.vidContId=i,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=t,this.isContentScenario=!1,this._super(t,e,i),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(s=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(s.eventType,{errorInfo:s},i)):(n=window.document.getElementById(window.uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=window.document.getElementById(this.vidContId),this.contentVideoTag=n.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(t,e){switch(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),!this.mc.isChromecast()&&this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:t();break;case this.PLATFORM:this._super(t,e);break;case this.CONTENT_AND_AD_CALL:t()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,s=window.uvpjs.util.isDefinedString(e.adCall)?e.adCall:null,n=this.imaScenario===this.PLATFORM,r=s||(n?this.imaAdCall:null);this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(i.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(r)):(i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(e),i.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,r)):this.doFlashCheck(r))},finishLoadVideoAndBeginPlayback:function(t){var e="",i=window.uvpjs.adUtil,s=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,s.incrementMedNum(),this.isContentScenario=!0),t?(e=i.populateImaAdCallValues(t,s,this.isContentScenario),this.viewGuid=i.getDwViewGuid(s),this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",e)):this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(e)},dispatchContentStart:function(){this.resetTrueXStatus(),this.stuckAdCheckDisabled=!1,this._super()},requestAdsManagerOrResume:function(t){e.isString(t)&&!e.isEmpty(t)?this._requestAdsManager(t):this._onContentResumeRequested()},setImaAdUrl:function(){var t=this.checkForAdCallOverride();t?(this.contentDataProxy.setProperty("imaAdCall",t),this.imaAdCall=t):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var t=this.cviModel.getModule(this.AD_SETTINGS),i=null!=t&&1==t.enabled,s=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),n=null;return i&&!e.isUndefined(s)&&(n=s),this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(n||"null")),n},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var t,e="",i=this.contentDataProxy,s=i.getProperty("chapterStartTimes");return i.getProperty("showPreroll")||(e="1"),s.length>0&&(t=s.indexOf(i.getProperty("playedChapterTime")))>=0&&(t+=2,e=e.length>0?e+","+String(t):String(t)),this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",e),e},getUnknownImaScenarioError:function(){return new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:window.uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(t){var e=t&&t.id,i=this.trueXInteractionIds;switch(e){case i.CLOSED_BEFORE_CREDIT:case i.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case i.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case i.OPT_OUT:case i.TIME_OUT:this.resetTrueXStatus();break;case i.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStatus:function(){this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1}},assembleAdPodInfo:function(t){var e=this.getAdPodInfo(t),i=e.podIndex,s=0===i?"pre":-1===i?"post":"mid_"+i;if(this.currAdPod=this.APM.getAdPodById(s),void 0===this.currAdPod)return this.debug&&window.uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:window.uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(t)}),adCallUrl:this.adCallUrl},this.vidContId),!1;var n=this.currAdPod;return n.adCount=e.totalAds,n.podDuration=e.maxDuration,n.isBumper=e.isBumper,n.imaPodIndex=e.podIndex,n.timeOffset=e.timeOffset,n.totalAds=e.totalAds,n.imaAdPostion=e.adPosition,this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",i,this.currAdPod),!0},getAdPodInfo:function(t,e){var i=t.getAdPodInfo(),s=e||{};return s.adPosition=i.getAdPosition(),s.isBumper=i.getIsBumper(),s.maxDuration=i.getMaxDuration(),s.podIndex=i.getPodIndex(),s.timeOffset=i.getTimeOffset(),s.totalAds=i.getTotalAds(),s},assembleAdInfo:function(t){return{adId:t.getAdId(),adPodInfo:this.getAdPodInfo(t),adSystem:t.getAdSystem(),advertiserName:t.getAdvertiserName(),apiFramework:t.getApiFramework(),contentType:t.getContentType(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId(),dealId:t.getDealId(),description:t.getDescription(),duration:t.getDuration(),height:t.getHeight(),mediaUrl:t.getMediaUrl(),minSuggestedDuration:t.getMinSuggestedDuration(),skipTimeOffset:t.getSkipTimeOffset(),surveyUrl:t.getSurveyUrl(),title:t.getTitle(),traffickingParams:t.getTraffickingParameters(),traffickingParametersString:t.getTraffickingParametersString(),uiElements:t.getUiElements(),universalAdIdRegistry:t.getUniversalAdIdRegistry(),universalAdIdValue:t.getUniversalAdIdValue(),vastMediaHeight:t.getVastMediaHeight(),vastMediaWidth:t.getVastMediaWidth(),vastMediaBitrate:t.getVastMediaBitrate(),width:t.getWidth(),wrapperAdIds:t.getWrapperAdIds(),wrapperAdSystems:t.getWrapperAdSystems(),wrapperCreativeIds:t.getWrapperCreativeIds(),isLinear:t.isLinear()}},onAdEvent:function(t){var i,s=t.getAdData(),n=t.getAd(),r=window.google.ima.AdEvent.Type;if(t.type!==r.INTERACTION){if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(t.type),t.type){case r.LOADED:if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",n),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(t)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(n))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(n,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this._dispatchAdLoaded(this.assembleAdInfo(n));break;case r.STARTED:var a,o,l=n.getContentType();this.ad=n,this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=n.getDuration(),this._populateAdVideoState(n,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this.cviModel.mergeCDOData(),"application/javascript"!==l&&"application/x-shockwave-flash"!==l||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===l&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(n),this.trackAdEvent(r.STARTED),(a=n.getAdPodInfo())&&(o=a.getTotalAds()),this._dispatchAdStart(o),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case r.AD_BUFFERING:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.AD_BUFFERING"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BUFFERING,{},this.vidContId);break;case r.FIRST_QUARTILE:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case r.MIDPOINT:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case r.THIRD_QUARTILE:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case r.COMPLETE:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case r.ALL_ADS_COMPLETED:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||e.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case r.CLICK:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),(i=this.cviModel.getAdVideoState()).paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:i},this.vidContId);break;case r.PAUSED:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case r.RESUMED:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case r.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case r.SKIPPED:this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,i=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:i,adCallUrl:this.adCallUrl},this.vidContId),window.uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case r.LOG:var d,u=s&&s.adError,h=(window.uvpjs.ErrorInfo,null===n);this.eventsMgr.eventTypes.AD_ERROR,!u&&h?(d=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof d&&d()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(u,n,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),h&&!u&&this.savedSeekToTime>-1&&this.resumeContentPlay();break;default:return void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",r))}}else this.processInteractionEvent(s)},_populateAdVideoState:function(t,i){var s,n;if(e.isObject(t)){if(n=window.uvpjs.adUtil.extractAdStateData(t,window.uvpjs.adUtil.context.IMA),i)for(s in i)n[s]=i[s];this.cviModel.setAdVideoState(n),this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())}else this.debug&&window.uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN")},_requestAdsManager:function(t){var e=this.cviModel;if(this.checkForAdBlocker(),this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",t),this.adStartEventReceived=!1,this.adCallUrl=t,window.uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var i=new window.google.ima.AdsRequest;i.adTagUrl=t,this._updateAdSize(),i.linearAdSlotWidth=this.containerWidth,i.linearAdSlotHeight=this.containerHeight,i.nonLinearAdSlotWidth=this.containerWidth,i.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof i.setAdWillAutoPlay&&(i.setAdWillAutoPlay(e.isAutoplay),i.setAdWillPlayMuted(e.isMuteAtPlayStart&&!e.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(i)},onAdsManagerLoaded:function(t){var i,s,n,r=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,a=window.uvpjs.util;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",t),this._dispatchAdResponse(),a.isEmpty(this.RPM)||a.isEmpty(this.RPM.currRP)||a.isEmpty(this.cviModel))return this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new window.google.ima.AdsRenderingSettings;var o=this.renderSettings;o.bitrate=this.getAdPlaybackBitrate(),o.restoreCustomPlaybackStateOnAdBreakComplete=!1,o.enablePreloading=!1,o.loadVideoTimeout=this._returnIMATimeout(),i=this.adsManager=t.getAdsManager(r,o),this.debug&&(window.uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",i.isCustomPlaybackUsed()),window.uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",i.isCustomClickTrackingUsed()),window.uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",i.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(s=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",s)),this.imaCuePoints=this.adsManager.getCuePoints(),e.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new window.uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,s,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",s),this.APM.initialize(this.vidContId,s,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),n=this.cviModel.isFullscreen?window.google.ima.ViewMode.FULLSCREEN:window.google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,n),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},getAdPlaybackBitrate:function(){var t=this.cviModel.contentPlaybackState.facadeState.currentBitrate,e=900;return!window.uvpjs.util.isEmpty(t)&&t>0&&(e=Math.min(t/1e3,this.AD_BITRATE_THRESHOLD)),e},startAds:function(){var t,e,i=null,s=null;this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(n){this.debug&&window.uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),t=(e=window.uvpjs.ErrorInfo).messages.NO_AD_CONTENT,n&&"function"==typeof n.getMessage&&(t+=": "+n.getMessage(),i=n.getErrorCode(),s=n.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new e({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:e.errorCodes.IMA_AD_ERROR,message:t,imaErrorCode:i,imaVastErrorCode:s,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var t,i=!1;this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),e.isEmpty(this.facade)||(i=this.cviModel.contentVideoState.isLive,!(t=this.imaUsesContentVideoTag())&&this.facade.hideVideo(),i&&!t?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),t&&(this.savedSeekToTime=i?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!e.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),e.isEmpty(this.APM)||!this.APM.isPostRoll(this.currAdPod)){if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:window.uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),e.isEmpty(this.facade))this.debug&&window.uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!e.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),this.savedSeekToTime>-1){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}}else this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN")},facadePlaybackStateChange:function(t){this.seekPending&&t===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(t)},_updateIMAPlaybackState:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",t),t!==this.playbackState&&(this.playbackState=t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(t){var e=this.cviModel.getAdVideoState();this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:t||1,adData:e,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(t){var e;this.uvpjsAdStartOpened&&((e=this.cviModel.getAdVideoState()).skipped=!0===t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:e,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(t){var e="function"==typeof t.getAdData?t.getAdData():{},i="function"==typeof t.getAd?t.getAd():{};return("function"==typeof i.getMediaUrl?i.getMediaUrl():e.mediaUrl)||null},_dispatchAdLoaded:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:t},this.vidContId)},_dispatchAdRequest:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},handleAdPodEnd:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(t,e){var i,s,n;t&&(this.containerWidth=t),e&&(this.containerHeight=e),this.mc.isChromecast()||(i=window.parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),s=window.parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),i===this.containerWidth&&s===this.containerHeight||(this.containerWidth=i,this.containerHeight=s,this.adsManager&&(n=this.cviModel.isFullscreen?window.google.ima.ViewMode.FULLSCREEN:window.google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,n))))},_updateCurrentAdTime:function(){if(this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY){var t=this.adsManager.getRemainingTime();this._checkForStuckAd(t)?this.adsManager.discardAdBreak():(this.currImaAdTime=Math.floor(this.duration-t),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime}))}},_checkForStuckAd:function(t){if(this.stuckAdCheckDisabled)return!1;if(null===this.previousRemainingTime)return this.previousRemainingTime=t,!1;var e=this.previousRemainingTime-t;if(this.debug&&window.uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+e),0===e?(this.stuckIntervals++,this.debug&&window.uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS){var i="Ad playback stuck for "+this.stuckIntervals+" intervals.",s=new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:window.uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:i,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&window.uvpjs.error(this.STUCK_AD_DEBUG_ID,i,s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:s,adCallUrl:this.adCallUrl},this.vidContId),!0}return this.previousRemainingTime=t,!1},_startRemainingTimeInterval:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(t){var e=t&&t.getAd&&t.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(t.getError(),e),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(t){this.dispatchAdErrorEvent(t.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(t){return window.uvpjs.adUtil.extractAdInfo(t,window.uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(t,e,i){var s,n=null,r=null,a=null,o=window.uvpjs.ErrorInfo,l=window.uvpjs.util.isFunction;t&&l(t.getMessage)&&(n=t.getMessage(),n+=" imaErrorCode: "+(r=t.getErrorCode()||"n/a")+"; vastErrorCode: "+(a=t.getVastErrorCode()||"n/a")),t&&l(t.getInnerError)&&(s=t.getInnerError())&&(!n&&(n=""),n+=" Inner error: "+(l(s.getMessage)?s.getMessage():s.message||"n/a")+"; inner error code: "+(l(s.getErrorCode)?s.getErrorCode():"n/a")),this.debug&&window.uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+n),i&&(n=i+" "+n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new o({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:o.errorCodes.IMA_AD_ERROR,message:o.messages.IMA_AD_ERROR_EVENT_RECEIVED+(n||" Unspecified IMA ad error."),isFatal:!1,imaErrorCode:r,imaVastErrorCode:a,adInfo:this.extractAdInfo(e)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:window.uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:window.uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){if(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),e.isEmpty(this.facade))return this.debug&&window.uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA();this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo()},cleanUpRP_IMA:function(){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var t=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(t)}},_cleanUpContentVideoFacade:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(t){var e;this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",t),null===this.adsManager?(this.dynamicMidRollPodCount++,e=window.uvpjs.adUtil.populateImaAdCallValues(t,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=e,this._requestAdsManager(e)):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call")},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(t)))},onPlayVideo:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(t)))},onVideoSeekTo:function(t){var i,s,n,r=this.cviModel.contentPlaybackState.currentTime;return this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",t),t.target!==this.vidContId||e.isEmpty(this.facade)||!this.canSeek(t&&t.payload)?void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")):e.isEmpty(this.APM)||!this.APM.hasMidRoll()?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(t)):(i=t.payload.seekTime,this._seekFromTime=r,s=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(i):i,n=this.APM.returnPrecedingUnplayedAdPod(s),void(e.isEmpty(n)||n.hasPlayed?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(t)):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",n.startTime),this.savedSeekToTime=s,n.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=n.startTime)))},canSeek:function(t){return void 0!==t.seekTime&&null!==t.seekTime&&t.seekTime>=0&&t.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(t){return t},onChangeVideoVolume:function(t){e.has(t,"target")&&t.target===this.vidContId&&!this.cviModel.isMuted&&t.payload.vol>=0&&t.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(t.payload.vol):this._super(t))},onMuteVideo:function(t){e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},onUnMuteVideo:function(t){e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var t,e=this.adsManager,i=window.google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),t=this.onAdEvent,e.addEventListener(window.google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.addEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.addEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.addEventListener(i.LOADED,t),e.addEventListener(i.STARTED,t),e.addEventListener(i.AD_BUFFERING,t),e.addEventListener(i.FIRST_QUARTILE,t),e.addEventListener(i.MIDPOINT,t),e.addEventListener(i.THIRD_QUARTILE,t),e.addEventListener(i.COMPLETE,t),e.addEventListener(i.ALL_ADS_COMPLETED,t),e.addEventListener(i.CLICK,t),e.addEventListener(i.PAUSED,t),e.addEventListener(i.RESUMED,t),e.addEventListener(i.USER_CLOSE,t),e.addEventListener(i.SKIPPED,t),e.addEventListener(i.LOG,t),e.addEventListener(i.VOLUME_CHANGED,t),e.addEventListener(i.VOLUME_MUTED,t),e.addEventListener(i.INTERACTION,t)},_removeAdsManagerEventListeners:function(){var t=this.onAdEvent,e=this.adsManager,i=window.google.ima.AdEvent.Type;e&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),e.removeEventListener(window.google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.removeEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.removeEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.removeEventListener(i.LOADED,t),e.removeEventListener(i.STARTED,t),e.removeEventListener(i.AD_BUFFERING,t),e.removeEventListener(i.FIRST_QUARTILE,t),e.removeEventListener(i.MIDPOINT,t),e.removeEventListener(i.THIRD_QUARTILE,t),e.removeEventListener(i.COMPLETE,t),e.removeEventListener(i.ALL_ADS_COMPLETED,t),e.removeEventListener(i.CLICK,t),e.removeEventListener(i.PAUSED,t),e.removeEventListener(i.RESUMED,t),e.removeEventListener(i.USER_CLOSE,t),e.removeEventListener(i.SKIPPED,t),e.removeEventListener(i.LOG,t),e.removeEventListener(i.VOLUME_CHANGED,t),e.removeEventListener(i.VOLUME_MUTED,t))},onUVPJSTimerTick:function(){var t,e,i,s,n=window.uvpjs.util,r=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,a=!n.isEmpty(this.adsManager),o=!n.isEmpty(this.facade);if(a){var l=this.getAdPlaybackBitrate();l!==this.renderSettings.bitrate&&(this.renderSettings.bitrate=l,this.adsManager.updateAdsRenderingSettings(this.renderSettings))}if(r&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:o?(t=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=t):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return e=(s=a&&r&&(this.cviModel.sessionOptions.adBlockerCallback||null))&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),s&&(i=(new Date).getTime())&&(this.lastAdBlockCheckTime<i||e)&&(this.lastAdBlockCheckTime=i+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();if(this.id3HandlingEnabled&&o&&this.checkId3Events(t),this.playbackState===this.mc.PLAYING){var d=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,d,this.vidContId)}},_checkForCloseToMidrollPod:function(t){var e,i,s,n=this.APM.getMidRollPods();if(t<=0)return!1;for(e=n.length;e--;)if((i=(s=n[e]).startTime-t)>0&&i<1&&!s.hasPlayed&&!s.hasBeenChecked)return s.hasBeenChecked=!0,!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(t){var e=window.uvpjs.util,i=this._getAssetUrl(t),s=e.isDefinedString(t.pid),n=e.isDefinedString(t.cmsRefGuid),r=e.isDefinedString(t.selectorCall),a=e.isDefinedString(t.assetURL);return s||n&&!a||r?this.PLATFORM:e.isDefinedString(i)?this.CONTENT_AND_AD_CALL:e.isDefinedString(t.adCall)?this.AD_CALL_ONLY:(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var t=window.uvpjs.adUtil.checkForAdBlocker(this.cviModel);return t&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),t},_checkForContentPreload:function(){var t=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,e=this.adsManager.isCustomPlaybackUsed(),i=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!e;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&t&&this.duration>5&&i&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var t=-1,e=this.cviModel.getModule(this.AD_SETTINGS),i=e&&e.enabled&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return i&&(t=(t=window.parseInt(i))>0?1e3*t:-1),this.debug&&window.uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+t),t},trackAd:function(){this.adTrackingHandle=window.uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:window.uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&window.uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:window.uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(window.uvpjs.register("uvpjs")),function(t){"use strict";var e,i=(t._,["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"]),s=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];t.DaiResourceProvider=window.uvpjs.RP_Platform.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(t){this.debug=window.uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this.pendingSeekTime=null,this._super(t),this.providerType=window.uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,i,s){var n=window.document.getElementById(window.uvpjs.domConstants.CONTENT_ID_PREFIX+s),r=n.getElementsByTagName("video")[0];!e&&(e=window.google.ima.dai.api),this.debug&&this.log("DAI RP init'ing, IMA version = "+window.google.ima.VERSION),this.streamManager=new e.StreamManager(r),this.adClickElement=this.createAdClickElement(r),this.streamManager.setClickElement(this.adClickElement),this._super(t,i,s),this.resetAdStates(),this.contentVideoDiv=n,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(t,e){var i=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(i)?this._super(t,e):(this.dataLoadedCB=t,this.onDataProxyComplete())},onDataProxyComplete:function(){var t=this.contentDataProxy.getProperty("cmsRefGuid");!window.uvpjs.util.isEmpty(t)&&!this.rco.getVideoId()&&this.rco.setCmsRefGuid(t),this._super()},loadVideoAndBeginPlayback:function(t){var e,i=this.rco,s=this.cviModel,n=this.contentDataProxy.getModel();if(this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),s.setNonDefaultContentVideoStateItems(n),s.setContentVideoStateItems(i),s.mergeCDOData(),this.killDataProxy(),!(e=this.assembleResourceDefinition()))return this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",window.uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0);this.cviMgr.setPlaybackInfoOnModel(),this.requestStream(e)},requestStream:function(t){var i=!window.uvpjs.util.isEmpty(t.assetKey),s=new(i?e.LiveStreamRequest:e.VODStreamRequest);s.apiKey=t.apiKey||null,s.adTagParameters=t.adTagParameters,i?(s.assetKey=t.assetKey,s.attemptPreroll=!0,this.isLiveStream=!0,this.id3HandlingEnabled=!0):(s.contentSourceId=t.contentSourceId,s.videoId=t.videoId),this.streamManager.requestStream(s)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(t){var e=t.getStreamData().url;if(!window.uvpjs.util.isDefinedString(e))return this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,window.uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,window.uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=e,this.cviModel.contentVideoState.isLive=this.isLiveStream,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())},hStreamInitialized:function(t){this.daiStreamId=t.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(t){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(t){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null,this.pendingSeekTime&&(this._hasFacade()&&this.facade.seekTo(this.pendingSeekTime),this.pendingSeekTime=null)},hCuePointsChanged:function(t){this.currAdPod=this.getNewPod(t.getStreamData().cuepoints)},hAdStarted:function(t){var e=t.getAd();this.resetAdStates(),!this.currAdPod&&this.isLiveStream&&(this.currAdPod={played:!0}),this.updateAdModel(e),this.currAd=e,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.trackAdEvent(t.type),this.dispatchAdPodStart()),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(t){var i,s,n,r=t.type,a=e.StreamEvent.Type,o=null;switch(r){case a.FIRST_QUARTILE:o=25;break;case a.MIDPOINT:o=50;break;case a.THIRD_QUARTILE:o=75;break;case a.AD_PROGRESS:(n=(s=(i=t.getStreamData())&&i.adProgressData)&&this.createAdProgressPayload(s))&&this.dispatchVideoProgress(n)}o&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=o,this.dispatchAdQuartile(o))},hStreamError:function(t){var e=t.getStreamData(),i=e&&e.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+i,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,i||"Unknown DAI stream error.",window.uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(t){},hStreamEvent:function(t){this.isAdPlaying()&&this.trackAdEvent(t.type),this[this.hMap[t.type]](t)},onVideoSeekTo:function(t){var e,i=t&&t.target,s=t&&t.payload,n=s&&s.seekTime,r=this.facade,a=this._hasFacade(),o=r.getDuration(),l=this.facade.getCurrentTime();if("number"==typeof n&&i===this.vidContId){if((n=this.streamManager.streamTimeForContentTime(n))<0||n>o)return void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+n));(e=this.getSkippedPod(n))&&(this.pendingSeekTime=n,n=e.startTime-1),this._seekFromTime=this._seekFromTime||l,this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:n,seekFromTime:this._seekFromTime},null,2)),a&&r.seekTo(n)}},getSkippedPod:function(t){var e,i,s,n,r=[];for(e in this.adPods)r.push(this.adPods[e].startTime);for(r.sort(function(t,e){return t-e}),i=r.length;i--;)if((s=r[i])<t)return(n=this.adPods["t_"+s]).hasPlayed?null:n;return null},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_LOADED,{adData:t}),this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new window.uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===s,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new window.uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:window.uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:window.uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(t){var e,i,s=null,n=t&&t.length;for(n&&!this.adPods&&this.createAdPods(t);n--;)e=t[n],i=this.adPods["t_"+e.start],s||i.hasPlayed===e.played||(s=i),i.hasPlayed=e.played;return s},createAdPods:function(t){var e,i,s,n,r=function(t){return l>1&&t===l-1?"post":0===t?"pre":"mid"},a=0,o=[],l=t.length;for(this.adPods={},i=0;i<l;i++)e=t[i],s=r(i),n=e.start,o.push(n),this.adPods["t_"+n]={startTime:n,hasPlayed:!1,adPodId:s+("mid"===s?"_"+a++:"_0"),adCount:0,podDuration:e.end-n};this.cviModel.contentVideoState.chapterStartTimes=o},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(t){var e=t.getAdPodInfo();this.populateAdVideoState(t),e&&this.currAdPod&&(this.currAdPod.adCount=e.getTotalAds(),this.currAdPod.podDuration=e.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(t){var e=window.uvpjs.adUtil.extractAdStateData(t,window.uvpjs.adUtil.context.DAI,this.isLiveStream);e.adBitrate=this.cviModel.getContentPlaybackState().facadeState.currentBitrate,this.cviModel.setAdVideoState(e)},createAdProgressPayload:function(t){var e=this.getVideoProgressPayload(),i=t.currentTime;return e.isAd=!0,e.duration=t.duration,e.currentTime=i,e.absoluteStreamTime=this.facade.getCurrentTime(),e.lastSecondCompleted=Math.floor(i),e.lastPercentageCompleted=this.currAdPercentComplete,e},extractAdInfo:function(t){return window.uvpjs.adUtil.extractAdInfo(t,window.uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=window.uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:window.uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&t!=e.StreamEvent.Type.AD_PROGRESS&&this.facade&&window.uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:window.uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||this.isLiveStream||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var t,e,i;this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying()&&(e=this.facade.getCurrentTime(),this.checkForAdBlocker(e,!1),t=this.streamManager.contentTimeForStreamTime(e),!this.contentStartOpen&&(t>0||this.isLiveStream)&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(t),i=this.createVideoProgressPayload(t,e),this.dispatchVideoProgress(i))},createVideoProgressPayload:function(t,e){var i=this.getVideoProgressPayload();return i.currentTime=t,i.absoluteStreamTime=e,i.duration=this.contentDuration||-1,i},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(t,e){var i=t-this.lastAdBlockCheckTime>this.adBlockCheckInterval,s=e||i,n=s&&window.uvpjs.adUtil.checkForAdBlocker(this.cviModel);return s&&(this.lastAdBlockCheckTime=t),n&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!n},assembleResourceDefinition:function(){var t=this.rco.getAdTagParameters(),e=this.rco.getVideoId(),i=this.rco.getContentSourceId(),s=this.rco.getAssetKey();return s&&t||t&&e&&i?{adTagParameters:t,videoId:e||null,contentSourceId:i||null,assetKey:s||null}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(t){for(var n,r="add"===t?"addEventListener":"removeEventListener",a="addEventListener"===r,o=e.StreamEvent.Type,l=i.length;l--;)n=o[i[l]],a&&(this.hMap[n]=s[l]),!a&&delete this.hMap[n],this.streamManager[r](n,this.hStreamEvent)},createAdClickElement:function(t){var e,i,s,n,r=t.nextSibling;if(r&&"uvpjsDaiContainer"===r.getAttribute("data-role"))return r;for(s in(e=window.document.createElement("div")).setAttribute("data-role","uvpjsDaiContainer"),i={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1},n=e.style,i)n[s]=i[s];return t.insertAdjacentElement("afterend",e),e},onPauseVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onPlayVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.vol,n=window.uvpjs.util.inRange(s,0,1),r=this.cviModel.isMuted;e===this.vidContId&&n&&!r&&this._hasFacade()&&(this.facade.setVolume(s),this.isAdPlaying()&&this.trackAdEvent(t.type))},onMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onUnMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},facadeId3Data:function(t){if(this.streamManager){var e=function(t){this.streamManager.processMetadata("ID3",t.data,t.pts)}.bind(this);t&&t.forEach(e)}},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){this.contentDuration=this.streamManager.contentTimeForStreamTime(t.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(t){this.adClickElement&&(this.adClickElement.style.display=!1!==t?"block":"none")},log:function(t,e,i){window.uvpjs[i||"log"](this.DEBUG_ID,t,e||"")}})}(window.uvpjs.register("uvpjs")),function(t){"use strict";var e={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};t.DaiSsbResourceProvider=window.uvpjs.ResourceProvider.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=window.uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(t),this.providerType=window.uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,e,i){this._super(t,e,i),this.contentVideoDiv=window.document.getElementById(window.uvpjs.domConstants.CONTENT_ID_PREFIX+i),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(t){t()},loadVideoAndBeginPlayback:function(t){var e,i=this.rco,s=this.cviModel;this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),s.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),s.setContentVideoStateItems(i),s.mergeCDOData(),this.killDataProxy(),this.contentDuration=s.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),(e=this.assembleAssetUrl(i))?(this.cviModel.contentVideoState.assetURL=e,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(i.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),!this.suppressFacadePlayOnLoad&&this.facade.playVideo()):this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",window.uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0)},assembleAssetUrl:function(t){var e,i,s=t.assetURL,n=window.uvpjs.util;return n.isEmpty(s)?null:s.indexOf("?")>-1?s:(e=(i=t.getAdTagParameters())?n.queryStrFromObj(i):null,n.isEmpty(e)?s:s+"?"+e)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(t){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(t),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(t){var e=this.getPrerollPod(t);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:e})},dispatchAdPodEnd:function(){var t=this.getPrerollPod();t.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:t})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new window.uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e,isFatal:!0===s,adInfo:null})})},getPrerollPod:function(t){return this.adPod||(this.adPod={startTime:t,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var t=window.uvpjs.adUtil.getAdStateBlank();t.adServerName="dai_ssb",t.duration=this.getPrerollAdDuration(),t.adClipID="pre_0",t.adPosition=1,t.adType="pre",this.cviModel.setAdVideoState(t)},getPrerollAdDuration:function(){var t=this.getAbsoluteDuration();return t>0&&this.contentDuration>0?t-this.contentDuration:-1},getAbsoluteDuration:function(){return this.absoluteDuration||(this.absoluteDuration=this.facade.getDuration()),this.absoluteDuration},createAdProgressPayload:function(){var t,e,i=this.getVideoProgressPayload(),s=this.facade.getCurrentTime(),n=this.getPrerollAdDuration(),r=Math.floor(s/n*100);switch(r){case 25:t=this.quartiles[25],e=25;break;case 50:t=this.quartiles[50],e=50;break;case 75:t=this.quartiles[75],e=75}return e&&!t&&this.dispatchAdQuartile(e),e&&(this.quartiles[String(e)]=1),i.isAd=!0,i.duration=n,i.currentTime=s,i.absoluteStreamTime=this.facade.getCurrentTime(),i.lastSecondCompleted=Math.floor(s),i.lastPercentageCompleted=r,i},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var t,e=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,i=this.isAdPlaying(),s=this.contentStartOpen,n=e&&this.facade.getCurrentTime();e&&(t=i?this.createAdProgressPayload():s?this.createVideoProgressPayload():null,n>1&&!s&&!i&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+n),this.contentStartTime=n,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(n),t&&this.dispatchVideoProgress(t))},createVideoProgressPayload:function(){var t=this.getVideoProgressPayload(),e=this.facade.getCurrentTime(),i=e-this.contentStartTime;return t.currentTime=i,t.absoluteStreamTime=e,t.duration=this.contentDuration||-1,t},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.facade,r=this._hasFacade(),a=r&&(this.absoluteDuration||n.getDuration()),o=this.getPrerollAdDuration(),l=this.facade.getCurrentTime();if("number"==typeof s&&e===this.vidContId&&a){if((s+=o>0?o:0)<0||s>a)return void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s));this._seekFromTime=this._seekFromTime||l,this.debug&&window.uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),r&&n.seekTo(s)}},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){!this.absoluteDuration&&(this.absoluteDuration=t.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.hCueChange=this.hCueChange.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){var t=this.vidEl.textTracks;t.removeEventListener("addtrack",this.hAddTextTrack,!1);for(var e=0,i=t.length;e<i;e++)t[e].removeEventListener("cuechange",this.hCueChange,!1)},hAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(t.track.addEventListener("cuechange",this.hCueChange,!1),t.track.mode="hidden")},hCueChange:function(t){t.target&&t.target.activeCues&&1==t.target.activeCues.length&&this.handleId3Cue(t.target.activeCues[0])},handleId3Cue:function(t){var i,s,n=t.value;"TXXX"===n.key&&(i=""!==n.info?n.info:n.data,(s=e[i])&&this[s](t.startTime))},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},log:function(t,e,i){window.uvpjs[i||"log"](this.DEBUG_ID,t,e||"")}})}(window.uvpjs.register("uvpjs")),function(t){"use strict";t.P2pClient=window.uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var t=window.uvpjs.P2pClient.clientMap[this.clientName];return t&&t.getHlsjsLoader&&(t.getHlsjsLoader()||null)}}),t.P2pClient.debugId=window.uvpjs.DebugManager.configParams.P2P_CLIENT,t.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(t,e){var i;this.getHlsjsLoader()?t():e.apiKey?(i=this.loadHlsLoader.bind(this,t),window.uvpjs.VideoDeliveryPluginService.load(this.sdkPath+e.apiKey,i,2e3)):t(!0)},loadHlsLoader:function(t,e){if(e)return window.uvpjs.debug&&window.uvpjs.log(window.uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",e),void t(!0);window.uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,t,2e3)}}}}(window.uvpjs.register("uvpjs")),function(t){"use strict";t.MultiCdnClient=window.uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null,this.url=window.uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(t){this.inFlight||(this.inFlight=!0,this.decisionCallback=t,this.timeoutHandle=window.setTimeout(this.abortOnTimeout.bind(this),2e3),(new window.uvpjs.CodeLoader).loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(t){window.clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(t.response),this.reset()},handleError:function(){window.clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),t.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(t){return t&&t.customerId&&t.appId?this.decisionUrl.replace("{customerId}",t.customerId).replace("{appId}",t.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(t){t()}}}}(window.uvpjs.register("uvpjs")),function(t){"use strict";t.VideoDeliveryPluginService=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t,e){var i=window.uvpjs.VideoDeliveryPluginService.clientType;this.model=e,this.callback=t,this.staticSvc=window.uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(i.P2P),this.multiCdnClientOptions=this.getClientOptions(i.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var t=null,e=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(t=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(e=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(t,e))},handleMcdnReady:function(t){var e=this.multiCdnClientOptions;!t&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,e.clientName)||(e.canUse=!1,this.debug&&window.uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+e.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var t=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,t.clientName,this.handleMcdnReady.bind(this),t.requiredParams)},handleP2pReady:function(t,e){var i=this.p2pClientOptions;!e&&this.validateScriptLoad(this.staticSvc.clientType.P2P,i.clientName)||(i.canUse=!1,this.debug&&window.uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+i.clientName)),t?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var t=this.p2pClientOptions,e=this.multiCdnClientOptions.canUse;t.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,t.clientName,this.handleP2pReady.bind(this,e),t.requiredParams):e?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(t,e,i,s){var n=this.getClientObject(t,e);n||i(!0),n.loadScripts(i,s)},validateScriptLoad:function(t,e){var i=this.getClientObject(t,e);return i&&i.validateScriptLoad()||!1},createClient:function(t,e){return new t(e)},getClientOptions:function(t){var e,i,s,n,r,a,o,l,d,u=this.model,h=this.getSupportedClients(t),c={canUse:!1,clientName:null};if(t===this.staticSvc.clientType.P2P&&!window.uvpjs.mediaCapabilities.canUseP2p())return c;for(e in h)if((l=(s=h[i=e])&&s.uvpcModuleName)&&u.isModuleEnabled(l)){for(r=(n=s.requiredParams)&&n.length||0,o={},d=!0;r--;){if(a=u.getModuleParam(l,n[r]),window.uvpjs.util.isEmpty(a)){d=!1;break}o[n[r]]=a}return{canUse:d,clientName:i,requiredParams:o}}return c},getSupportedClients:function(t){var e,i,s={},n=t.clientMap;if(!n)return s;for(e in n)i=n[e],s[e]={uvpcModuleName:i.uvpcModuleName,requiredParams:i.requires};return s},getClientObject:function(t,e){return t.clientMap[e]||null}});var e=t.VideoDeliveryPluginService;e.clientType={P2P:window.uvpjs.P2pClient,MULTI_CDN:window.uvpjs.MultiCdnClient},e.load=function(t,e,i){(new window.uvpjs.CodeLoader).loadScript(t,e,i)}}(window.uvpjs.register("uvpjs")),function(t){var e="loadedmetadata";t.FullscreenManager=window.uvpjs.Class.subClass({init:function(t){var e=window.uvpjs.util,i=t||{},s=window.uvpjs.mediaCapabilities;this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.SKIN_MANAGER,i.videoElement&&i.container?(this.videoEl=i.videoElement,this.container=i.container,this.fullscreenChangeCallback=e.isFunction(i.fullscreenChangeCallback)&&i.fullscreenChangeCallback,this.readyCallback=e.isFunction(i.readyCallback)&&i.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=s.getEnterFullscreenMethodName(),this.exitMethod=s.getExitFullscreenMethodName(),this.fsElementName=s.getFullScreenElementName(),this.isFullscreenProperty=s.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()):window.uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.")},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return window.uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?window.document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(t){var e=this.isFullscreen();t.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(e)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener(e,this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:window.navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var t=window.document[this.exitMethod]?window.document:this.videoEl[this.exitMethod]?this.videoEl:null;return t&&window.uvpjs.util.isFunction(t[this.exitMethod])?t:null},validateEntryAndExitMethods:function(){var t=this.fsElement&&this.fsElement[this.enterMethod],e=this.exitScope&&this.exitScope[this.exitMethod],i=window.uvpjs.util;this.hasValidEntryMethod=i.isFunction(t),this.hasValidExitMethod=i.isFunction(e)},initialize:function(){var t,i,s,n=window.uvpjs.mediaCapabilities;this.hasFsApiSupport=n.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(s=n.getFullscreenEventName(),(n.isFirefox()||n.isIE()?window.document:this.container).addEventListener(s,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,t=n.getFullscreenEnterEventName(),i=n.getFullscreenExitEventName(),this.fsElement.addEventListener(t,this.hFullScreenEvent,!1),this.fsElement.addEventListener(i,this.hFullScreenEvent,!1),this.enterEvt=t,this.exitEvt=i),this.validateEntryAndExitMethods(),this.hasValidEntryMethod?(this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener(e,this.hMetadataLoaded,!1),this.debug&&window.uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())):this.debug&&window.uvpjs.log("Fullscreen determined not available",this.getInfo())}}),t.FullscreenManager.hasFullscreenSupport=function(){return!!window.uvpjs.mediaCapabilities.getEnterFullscreenMethodName()}}(window.uvpjs.register("uvpjs")),function(t){"use strict";var e,i,s,n,r=t._;t.SkinManager=window.uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:window.uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:window.uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:window.uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:window.uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:window.uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&window.uvpjs.log(this.DEBUG_ID,"init"),this.vci=t.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=t.skinReadyCallback,this.mc=window.uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._ccEnabledByUser=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this.isAndroidOnHlsjs=this.mc.canPlayHlsjsAndriod(this.vci.CVI_Mgr.cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(t.skinConfig)},destroy:function(){var t=function(){};this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),window.clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=t,this._replayCB=t,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(t){var e=window.uvpjs.util,i=window.uvpjs.Configuration.path,s=this._containerId,n=t.customCSS;this._namespace="."+s+".skin",this._autoPlay=t.isMutedAutoplay||t.isUnmutedAutoplay,this._isMutedAutoplay=t.isMutedAutoplay,this._previewImage=t.previewImage,this._enableReplay=t.enableReplay,this._themeName=t.themeName,this._canFullscreen=window.uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=e.isDefinedString(n)&&n||i+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&window.uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(t)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new window.uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaystate:function(t){this._playbackState=t,this._updatePlaybackStateUI(this._playbackState)},disableButton:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"disableButton",t),r.includes(this._disabledButtons,t)||this._disabledButtons.push(t),this._disableButton(t)},enableButton:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"enableButton",t),r.pull(this._disabledButtons,t),this._enableButton(t)},_handleFullscreenMgrReady:function(t){t&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(t){var e=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),t?(this.vci.fullscreen(!0),e&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),e&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(t){var e=this._queryByElementName(t);this.debug&&window.uvpjs.log(this.DEBUG_ID,"_disableButton",t),this._disable(t),e&&e.setAttribute("disabled","disabled")},_enableButton:function(t){var e=this._queryByElementName(t);this.debug&&window.uvpjs.log(this.DEBUG_ID,"_enableButton",t),r.includes(this._disabledButtons,t)||(this._enable(t),e&&e.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=window.uvpjs.EventType;t.addEventListener(i.AD_START+e,this._onAdStart.bind(this)),t.addEventListener(i.AD_END+e,this._onAdEnd.bind(this)),!this._isIOS&&t.addEventListener(i.CAPTIONS_READY+e,this._onCaptionsReady.bind(this)),t.addEventListener(i.CONTENT_START+e,this._onContentStart.bind(this)),t.addEventListener(i.CONTENT_END+e,this._onContentEnd.bind(this)),t.addEventListener(i.VIDEO_PROGRESS+e,this._onVideoProgress.bind(this)),t.addEventListener(i.VIDEO_STATE_CHANGE+e,this._onVideoStateChange.bind(this)),t.addEventListener(i.VIDEO_LOADING+e,this._onVideoLoading.bind(this)),t.addEventListener(i.CONTROL_MUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.CONTROL_UNMUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.RESOURCE_START+e,this._onResourceStart.bind(this)),t.addEventListener(i.RESOURCE_END+e,this._onResourceEnd.bind(this)),t.addEventListener(i.CONTAINER_RESIZE+e,this._onUVPJSResize.bind(this)),t.addEventListener(i.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+e,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=window.uvpjs.EventType;t&&t instanceof window.uvpjs.VideoControlInterface&&(t.removeEventListener(i.AD_START+e),t.removeEventListener(i.AD_END+e),!this._isIOS&&t.removeEventListener(i.CAPTIONS_READY+e),t.removeEventListener(i.CONTENT_START+e),t.removeEventListener(i.CONTENT_END+e),t.removeEventListener(i.VIDEO_PROGRESS+e),t.removeEventListener(i.VIDEO_STATE_CHANGE+e),t.removeEventListener(i.VIDEO_LOADING+e),t.removeEventListener(i.CONTROL_MUTE+e),t.removeEventListener(i.CONTROL_UNMUTE+e),t.removeEventListener(i.RESOURCE_END+e),t.removeEventListener(i.CONTAINER_RESIZE+e))},_addUIEventListeners:function(){for(var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this.css,s=this.shouldTrapTaps(),n=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],r=n.length;r--;)"_onClosedCaptionBtnClick"===n[r]&&this._isIOS||(this[n[r]]=this[n[r]].bind(this));var a=this._onUVPJSGestureEvent,o=this._hNonTap,l=this._onProgressSliderEvent,d=this._onVolumeSliderEvent,u=this._onVolumeBtnEvent;window.document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",o),e.addEventListener("mouseenter",a,!0),e.addEventListener("mouseleave",a,!0),e.addEventListener("mousemove",a,!0),e.addEventListener("mousedown",a,!1),e.addEventListener("mouseup",a,!1),e.addEventListener("click",a,!1),e.addEventListener("touchstart",a,!0),e.addEventListener("touchend",a,!0),this._previewBtn=this._queryByElementName(i.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",o),!this._isTouch&&this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(i.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),!this._isTouch&&this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(i.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(i.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(i.PROGRESS_SLIDER),this._progressSlider.addEventListener(t,l,!1),this._progressSlider.addEventListener("mousedown",l,!1),this._progressSlider.addEventListener("mouseup",l,!1),this._progressSlider.addEventListener("touchstart",l,!0),this._progressSlider.addEventListener("touchend",l,!0),this._volumeSlider=this._queryByElementName(i.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(t,d,!1),this._volumeSlider.addEventListener("mouseover",d,!1),this._volumeSlider.addEventListener("mouseout",d,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(i.LARGE_PLAY_BTN),!s&&this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(i.PLAYSTATE_BTN),!s&&this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(i.VOLUME_BTN),!s&&this._volumeBtn.addEventListener("click",u,!1),this._volumeBtn.addEventListener("mouseover",u,!1),this._volumeBtn.addEventListener("mouseout",u,!1),this._isIOS||(this._ccBtn=this._queryByElementName(i.CLOSED_CAPTION_BTN),!s&&this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1)),this._settingsBtn=this._queryByElementName(i.SETTINGS_BTN),!s&&this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,i.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(i.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this._hNonTap,s=this._onUVPJSGestureEvent,n=this._onProgressSliderEvent,r=this._onVolumeSliderEvent,a=this._onVolumeBtnEvent;window.document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",i,!1),e.removeEventListener("mouseenter",s,!0),e.removeEventListener("mouseleave",s,!0),e.removeEventListener("mousemove",s,!0),e.removeEventListener("mousedown",s,!1),e.removeEventListener("mouseup",s,!1),e.removeEventListener("click",s,!1),e.removeEventListener("touchstart",s,!0),e.removeEventListener("touchend",s,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",i,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(t,n,!1),this._progressSlider.removeEventListener("mousedown",n,!1),this._progressSlider.removeEventListener("mouseup",n,!1),this._progressSlider.removeEventListener("touchstart",n,!0),this._progressSlider.removeEventListener("touchend",n,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(t,r,!1),this._volumeSlider.removeEventListener("mouseover",r,!1),this._volumeSlider.removeEventListener("mouseout",r,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",a,!1),this._volumeBtn.removeEventListener("mouseover",a,!1),this._volumeBtn.removeEventListener("mouseout",a,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var t=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));window.uvpjs.util.createStyleSheet(t,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(window.uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),window.uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var t=!0;for(var e in this._controlList)this._checkControlOnDOM(this._controlList[e])||(t=!1);return t},_waitForControls:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_waitForControls."),window.setTimeout(function(){if(!(++this._waitCount>100))return this._haveControlsLoaded()?void t.call(this):void this._waitForControls(t)}.bind(this),50)},_clearMouseMoveInterval:function(t){var e=this._getClassName(t,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[e]&&(window.clearInterval(this._intervals[e]),this._intervals[e]=-1)},_clearIntervals:function(){var t,e=this._intervals;for(t in e)-1!==e[t]&&(window.clearInterval(e[t]),e[t]=-1)},_setupDom:function(){var t=this.css;this.debug&&window.uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),e(this._containerEl,this.PRIMARY_BLOCK),e(this._contentEl,this._getClassName(t.CONTENT)),e(this._controlsEl,this._getClassName(t.CONTROLS)),this.debug&&window.uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&e(this._adEl,this._getClassName(t.AD)),this._hide(t.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(t.BUFFERING_FRAME),this._hide(t.LARGE_PLAY_BTN),this._hide(t.CONTROL_BAR),this._hide(t.PROGRESS),this._hide(t.VOLUME_SLIDER),this._show(t.CONTROLS),this._hide(t.BUFFERING_FRAME),this._hide(t.SETTINGS_MENU),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),window.setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(t){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t]=t},_setupControlsContainer:function(){var t=[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(t),this._isIOS&&(this._controlsEl.querySelector(".uvpjs__btn-volume").style.right="45px",this._controlsEl.querySelector(".uvpjs__time").style.right="83px")},_generateSettingsMenu:function(t,e){function i(t,e){var i={};if(!1!==t.enabled)return void 0===t.value?(i.el="SETTINGS_MENU_ITEM",i.type="button",i.label=t.label,i.target=e):(i.el="SETTINGS_MENU_INPUT",i.type="menu",i.label=t.label||t.value,i.value=t.value,i.property=e&&r.last(e.split(":")),i.selected=function(t){var e=t.value,i=t.property,s=i&&f[i];return!((s&&s.toLowerCase())!==(e&&e.toLowerCase()))}(i)),i}var s,n,a,o,l,d,u,h,c=this._queryByElementName(this.css.SETTINGS_MENU),p=this._getClassName(this.css.SETTINGS_MENU_ITEM),f=r.assign({},this._menuSelections,this._getCaptionsStyle()),v=window.document.createRange(),g=window.uvpjs.util,_=[],E=this.shouldTrapTaps();for(h=t&&t.length,u=0;u<h;u++)a=e,(o=(l=t[u]).name)&&(a=g.isDefinedString(e)&&[e,o].join(":")||o),_.push(i(l,a));for(e&&((d=i(this._findMenuItem(e),a=e.split(":").slice(0,-1).join(":"))).cls=p+"--back",_.unshift(d)),v.selectNodeContents(c),v.deleteContents(),c.insertAdjacentHTML("beforeend",this._templateToHTML(_)),s=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),n=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),u=s&&s.length;u--;)!E&&s[u].addEventListener("click",this._onSettingsMenuBtnClick);for(u=n&&n.length;u--;)!E&&n[u].addEventListener("click",this._onSettingsMenuInputClick)},_removeMenuEventListeners:function(){var t,e=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),i=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);for(t=e&&e.length;t--;)e[t].removeEventListener("click",this._onSettingsMenuBtnClick);for(t=i&&i.length;t--;)i[t].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(t){var e={items:this.settingsMenu};if(r.isEmpty(t))return e;var i=this,s=t.split(":");return r(s).each(function(t){i.debug&&window.uvpjs.log(i.DEBUG_ID,"_findMenuItem key",t),e=r.find(e.items,function(e){return e.name===t})}),e},_createAdLearnMoreButton:function(){},_setupPreview:function(){var t=window.uvpjs.util,e=this.css.PREVIEW_BTN,i=this._previewImage,s=this._queryByElementName(e);window.uvpjs.log(this.DEBUG_ID,"_setupPreview",i),t.isDefinedString(i)&&(s.style.backgroundImage="url('"+i+"')"),this._show(e)},_setupReplay:function(){var t=window.uvpjs.util,e=this.css,i=e.REPLAY_BTN,s=this._previewImage,n=this._queryByElementName(i);this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setupReplay"),t.isDefinedString(s)&&(n.style.backgroundImage="url('"+s+"')"),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.BUFFERING_FRAME),this._show(e.CONTROLS),this._hide(e.CONTROL_BAR),this._hide(e.PROGRESS),this._show(i),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var t=this._getClassName(this.css.BUFFERING_FRAME);new Spinner({lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:t,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(this._controlsEl)},_disableInactiveButtons:function(){!this._isIOS&&this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(t){var e=this.css;this._containerId===t.target&&(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(t.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._disableButton(e.SETTINGS_BTN),this._disableButton(e.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(e.PROGRESS),this._hasActive(e.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),t.payload.adData.isCustomClickTrackingUsed||this._disable(e.LARGE_PLAY_BTN))},shouldIgnoreStateChange:function(t){return this.vci.getContentVideoData().isLive&&!!t},_onAdEnd:function(t){this._containerId===t.target&&(this.ignoreVideoStateChange=!1,this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,t.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(t){this._isIOS||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",t),this._captionsLoaded=!0,this._enableCaptions(),this.isAndroidOnHlsjs||this._enableButton(this.css.SETTINGS_BTN))},_onCaptionsUnavailable:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",t),this._isIOS||this._disableCaptions()},_onContentStart:function(t){var e=this.css;this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onContentStart",t),this._containerId===t.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),!this._isLive()&&this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._captionsLoaded&&this._enableButton(e.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(e.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(e.PROGRESS)):this._isStreaming()&&(this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(e.PROGRESS)),!this._isIOS&&this._hasActive(e.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===t.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(t){var e="controlMute"===t.type;this._containerId===t.target&&this._updateVolumeUI(this._volumeSlider.value,e)},_onDiagCloseButton:function(t){this._containerId===t.target&&(window.uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",t),this._menuSelections.debug=null)},_onResourceStart:function(t){(t&&t.target)===this._containerId&&(window.uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(t){var e=t.target,i=0===t.payload.playlistLength;this._containerId===e&&(window.uvpjs.log(this.DEBUG_ID,"_onResourceEnd",t),this._hide(this.css.CONTROLS),this._enableReplay&&i&&this._setupReplay(),this._captionsLoaded&&(this._captionsLoaded=!1,this._disableCaptions()),this._resetProgressSlider())},_onVideoProgress:function(t){var e,i,s=t.payload,n=s.playbackState,r=this.vci.getVolume(),a=this.css.TIME_DURATION,o=this.css.TIME_CURRENT,l=!1;this._containerId===t.target&&(r!==Number(this._volumeSlider.value)&&this._updateVolumeUI(r),n!==this._playbackState&&(this._playbackState=n,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(s),n!==this.mc.PLAYING||this._isSliding||s.duration!==1/0&&(e=this._queryByElementName(a),i=this._queryByElementName(o),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&s.duration>=3600&&(this.durationChecked=l=!0):(this.durationChecked=!0,s.duration>=3600&&(l=!0)),l&&(i.parentNode.style.width="100px"),e.innerHTML=this._formatTimestampByType(a,s.duration),i.innerHTML=this._formatTimestampByType(o,s.currentTime),this._updateProgressUI(s)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(t){r.has(t,"target")&&this._containerId===t.target&&r.isObject(t)&&r.has(t,"payload.data")&&this._updateProgressLoad(t.payload.data)},_onVideoStateChange:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",t),r.isObject(t)&&this._containerId===t.target&&r.isObject(t.payload)&&r.isNumber(window.parseInt(t.payload.newState))&&(!this.ignoreVideoStateChange||e===this.mc.PAUSED||e===this.mc.PLAYING)){var e=t.payload.newState;e!==this._playbackState&&(this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)),e===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)}},monitorMuting:function(t,e,i){null!==t&&(this.isMonitoringMuting=t),e&&window.clearInterval(this.muteMonitorIntervalId),i&&(this.muteMonitorIntervalId=window.setInterval(this.checkMute.bind(this),300))},checkMute:function(){var t=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&t!==this.currVolumeInfo.muted&&(this.currVolumeInfo.muted=t,t?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(t){var e=!1;switch(t.type){case"mouseenter":this._onUVPJSMouseEnter(t);break;case"mouseleave":this._onUVPJSMouseLeave(t);break;case"mousemove":this._onUVPJSMouseMove(t);break;case"mousedown":this._onUVPJSMouseDown(t);break;case"mouseup":this._onUVPJSMouseUp(t);break;case"click":this._showControlBar(t),e=!0;break;case"touchstart":this._onUVPJSTouchStart(t);break;case"touchend":this._onUVPJSTouchEnd(t),e=!0}!this._hasFirstTouch&&e&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(t)))},_getTargetInfo:function(t){var e=t.target;return{isVolumeButton:-1!==e.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==e.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(t){switch(t.type){case"input":case"change":this._onProgressSliderChange(t);break;case"touchstart":case"mousedown":this._onProgressSliderStart(t);break;case"touchend":case"mouseup":this._onProgressSliderEnd(t)}},_onVolumeSliderEvent:function(t){switch(t.type){case"input":case"change":this._onVolumeSliderChange(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onVolumeBtnEvent:function(t){switch(t.type){case"click":case"touchend":this._onVolumeBtnClick(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onUVPJSMouseEnter:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._showControlBar(t))},_onUVPJSMouseDown:function(t){t.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(t){var e,i=this.vci.getCurrentPlaybackState().playbackState;return this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),t.target.getAttribute("disabled")?(t.stopPropagation(),void t.preventDefault()):(this._touchStartTime=t.timeStamp,this._previewCallbackDone?void(this._hasDisabled(this.css.CONTROLS)||i!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),t.target===this._progressSlider&&(e=1-(t.target.clientWidth-t.layerX)/t.target.clientWidth,this._onProgressSliderChange(t,e)))):void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet.")))},_onUVPJSTouchEnd:function(t){var e,i,s,n,r=this.css,a=this._isTap(t.timeStamp),o=[r.CLOSED_CAPTION_BTN,r.VOLUME_BTN,r.PLAYSTATE_BTN,r.SETTINGS_BTN,r.SETTINGS_MENU,r.SETTINGS_MENU_ITEM,r.SETTINGS_MENU_INPUT,r.LARGE_PLAY_BTN,r.FULLSCREEN_BTN],l=o.length,d=t.target.className;if(t.target.getAttribute("disabled"))return t.stopPropagation(),void t.preventDefault();if(!this._hasDisabled(r.CONTROLS)){for(;l--&&!(i=i||d.indexOf(o[l])>-1););if(this.shouldTrapTaps()&&i&&l<o.length-1)return t.stopPropagation(),t.preventDefault(),void this.handleTap(o[l],t);(s=!(i||this._isTouchActive&&a))&&t.preventDefault(),s&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),n=e||s?this.HIDE_DELAY:0,e&&window.clearTimeout(e),e=window.setTimeout(function(){this._hasPaused()||(e=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER))}.bind(this),n)}},handleTap:function(t,e){var i=this.css;if(!this._queryByElementName(t).hasAttribute("disabled"))switch(t){case i.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(e);break;case i.VOLUME_BTN:this._onVolumeBtnEvent(e);break;case i.PLAYSTATE_BTN:case i.LARGE_PLAY_BTN:this._onPlayToggle(e);break;case i.SETTINGS_BTN:this._onSettingsBtnClick(e);break;case i.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(e);break;case i.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(e)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(t){t.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(t){var e=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[e]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[e]=window.setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(t){this._isMouseActive||(this._clearMouseMoveInterval(t),this._removeModifier(t,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(t){t.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var t=this._containerEl.offsetWidth;t>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),t<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(t){var e=this.vci.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(e?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(t){var e=window.parseFloat(t.target.value),i=this.vci.getPlayerMuted();i&&e>0&&this.vci.unMute(),this.vci.setVolume(e),this._updateVolumeUI(e,i)},_onFullscreenBtnClick:function(t){t.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),t.stopPropagation(),t.preventDefault(),this.ignoreVideoStateChange&&this._isLive())this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo());else{var e=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",e),e===this.mc.PAUSED||e===this.mc.EMPTY||e===this.mc.LOADING)return this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),void this.vci.playVideo();e!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo())}},_onPreviewBtn:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),!this._isTouch||this._isTap(t.timeStamp)?(t.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this))):this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback.")},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),t.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),!this._isTouch&&this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),t.stopPropagation();var e=this.css.CLOSED_CAPTION_BTN,i=this._hasActive(e);if(this._ccEnabledByUser=!i,i)return this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions();this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()},_onSettingsBtnClick:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),t.stopPropagation();var e=this.css.SETTINGS_MENU,i=this._hasHidden(e);if(window.uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",i),i)return this._addModifier(e,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(e);this._removeModifier(e,this.ACTIVE_MODIFIER),this._hide(e)},_onSettingsMenuBtnClick:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",t);var e=t.target.getAttribute("data-target");this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",e),t.target.parentNode.setAttribute("data-target",e);var i=this._findMenuItem(e);this._generateSettingsMenu(i.items,e)},_onSettingsMenuInputClick:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",t);var e=t.target.parentNode.getAttribute("data-target");switch(e&&e.split(":")[0]){case"cc":this._onSettingsCaptionsChange(t);break;case"controls":this._onSettingsControlsChange(t);break;case"debug":this._onSettingsDiagWindowChange(t)}},_onSettingsCaptionsChange:function(t){var e=t.target,i=e.parentNode,s=e.getAttribute("data-property"),n=e.getAttribute("data-value").toLowerCase();this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",s,n),r(i.children).each(function(t){t.setAttribute("data-selected","false")}.bind(this)),e.setAttribute("data-selected","true"),"text-position"!==s?this.vci.setCaptionsStyleProperty(s,n):this._setCCPosition(n)},_onSettingsControlsChange:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",t);var e=t.target,i=e.getAttribute("data-property"),s=e.getAttribute("data-value").toLowerCase(),n="#"+this._containerId+" ";if("background-opacity"===i){i="background-color";var r=this._queryByElementName(this.css.CONTROL_BAR),a=window.getComputedStyle(r).getPropertyValue(i);if(-1===a.indexOf("rgba"))return;s=a.split(",").slice(0,-1).join(",")+", "+s+")",this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",s),n+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(n,i,s)},_onSettingsDiagWindowChange:function(t){var e=t.target,i=e.getAttribute("data-property"),s=e.getAttribute("data-value"),n=!("true"===e.getAttribute("data-selected"));this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",t),this._menuSelections[i]=s,e.setAttribute("data-selected",n),n?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(t){!this._isIOS&&this._captionsLoaded&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",t),this.vci.setCaptionsStyle(t))},_setCaptionsStyleProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",t,e),this.vci.setCaptionsStyleProperty(t,e))},_setCueProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&this._videoEl.textTracks&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setCueProperty",t,e),this.vci.setCaptionsCueProperty(t,e))},_setCCPosition:function(t){var e="text-position";!this._isIOS&&this._captionsLoaded&&(t=t||this._getCaptionsStyle()[e],this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",e,t),this.vci.setCaptionsStyleProperty(e,t))},_showControlBar:function(t){var e=this.vci.getCurrentPlaybackState().playbackState,i=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&e!==this.mc.EMPTY&&(r.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[i.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(i.CONTROL_BAR),this.controlsVisible=!0,this._show(i.PROGRESS))},_hideMenu:function(t){this._hasHidden(this.css.SETTINGS_MENU)||t.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(t){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=r.debounce(function(){this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch?this._hideControlBar.hide.cancel():(this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS))},t||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(t){var e,i=this.css;this._hasDisabled(i.VOLUME_BTN)||this._hasDisabled(i.CONTROLS)||(this._hasActive(i.SETTINGS_MENU)&&this._hide(i.SETTINGS_MENU),this._setDataAttribute(this._containerEl,i.VOLUME_SLIDER,!0),this._addModifier(i.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(i.VOLUME_SLIDER),(this.mc.isFirefox()||this.mc.isEdge())&&(e=this._controlsEl.querySelector(".uvpjs__volume-slider"))&&e.setAttribute("style","bottom: 62px"))},_hideVolumeSlider:function(t){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this._isIOS||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._ccEnabledByUser&&(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions()))},_disableCaptions:function(){this._isIOS||(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this._disableButton(this.css.CLOSED_CAPTION_BTN),this._disableButton(this.css.SETTINGS_BTN))},_enableSettingsBtn:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),r.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(t,e){var i,s=window.uvpjs.util,n=this._containerEl;!0===this.vci.getPlayerMuted()?i="mute":t>.85?i="full":s.inRange(t,.5,.85)?i="high":s.inRange(t,.15,.5)?i="medium":s.inRange(t,0,.15)&&(i="low"),this._volumeSlider.value=t||this._videoEl.volume,this._setDataAttribute(n,"volume-level",i),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,t)},_onProgressSliderChange:function(t,e){var i,s,n=this.vci.getContentVideoData(),r=this.vci.getCurrentPlaybackState(),a=this.css.TIME_CURRENT,o=this._queryByElementName(a),l=e||this._progressSlider.value;l=l>1?1:l<0?0:l,i=Math.ceil(l*n.duration*1e4)/1e4,s=Math.abs((r.currentTime-i)/i),this._updateProgressSlider(l),o.innerHTML=this._formatTimestampByType(a,i),this._hasActive(this.css.PROGRESS_SLIDER)||s<=.02||this.vci.seekTo(i)},_onProgressMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(t){var e=this.css;if(this._hasAd()||this._hasDisabled(e.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._addModifier(e.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0},_onProgressSliderEnd:function(t){if(this._hasAd()||this._hasDisabled(this.css.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(t)},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(t){var e;this._isLive()||(e=Math.ceil(t.bufferLength/t.duration*1e4)/1e4,r.isNaN(e)||e===1/0||e<=0||(this._downloaded=e,this._hasAd()||(this._queryByElementName(this.css.PROGRESS_LOADED).value=this._downloaded)))},_updatePlaybackStateUI:function(t){var e=this.css;switch(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",t),t){case this.mc.PLAYING:this._show(e.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(e.PROGRESS);break;case this.mc.PAUSED:this._show(e.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(e.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(e.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(e.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(e.CONTROLS),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.LARGE_PLAY_BTN),this._show(e.BUFFERING_FRAME)}},_updateProgressUI:function(t){var e=Math.ceil(t.currentTime/t.duration*1e4)/1e4;this._updateProgressSlider(e)},_updateSliderUI:function(t,e,i){var s=this,n={};if(!r.isUndefined(this._vendorPrefix)&&!r.isUndefined(t)){if(n.id="#"+this._containerId,n.cls=s._getClass(e),n.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[s._vendorPrefix],this._isMSEdge&&(n.pseudo=""),n.add=function(t,e,i){if(!r.isUndefined(this.pseudo)){var n=this.id+(e||"")+" "+this.cls+(i||"")+this.pseudo;s._addCSSRule(n,"background-size",100*t+"% 100%")}},n.before=function(t,e){var i=s._getClass(s.PRIMARY_BLOCK);e&&(i+=s._getClass(s.PRIMARY_BLOCK,e)),this.add(t,i,null)},n.after=function(t,e){this.add(t,null,e)},e===s.css.VOLUME_SLIDER)return void n.add(i);var a=i*t.offsetWidth,o=(.5-i)*t.offsetHeight,l=a/t.offsetWidth,d=(a+o)/t.offsetWidth;t.value=i;var u=s._hasAd();n.before(l,u?s.AD_MODIFIER:null),u||n.after(d,":hover"),this._isTouch&&n.before(d,s.TOUCH_MODIFIER)}},_checkControlOnDOM:function(t){var e=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t;return!!this._controlCache[e]},_getClassName:function(t,e){var i=this.PRIMARY_BLOCK;return t!==this.PRIMARY_BLOCK&&(i+=this.BLOCK_ELEMENT_DELIMITER+t),e&&(i+=this.ELEMENT_MODIFIER_DELIMITER+e),i},_getClass:function(t,e){return this.CLASS_SELECTOR_PREFIX+this._getClassName(t,e)},_queryByClassName:function(t){var e,i;if(this._containerId)return e=this.ID_SELECTOR_PREFIX+this._containerId,t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),(i=this._controlCache[e]||window.document.querySelector(e))&&(this._controlCache[e]=i),i},_queryAllByClassName:function(t){var e=this.ID_SELECTOR_PREFIX+this._containerId;return t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),window.document.querySelectorAll(e)},_queryByElementName:function(t){return this._queryByClassName(this._getClassName(t))},_queryAllByElementName:function(t){return this._queryAllByClassName(this._getClassName(t))},_show:function(t){if(t===this.css.PROGRESS&&!this._isLive()){var e=this._queryByElementName(t),i=e.querySelector("input"),s=e.querySelector("progress");e&&(e.style.display="block"),i&&(i.style.display="block"),s&&(s.style.display="block")}this._removeModifier(t,this.HIDDEN_MODIFIER)},_hide:function(t){if(t===this.css.PROGRESS){var e=this._queryByElementName(t),i=e.querySelector("input"),s=e.querySelector("progress");e&&(e.style.display="none"),i&&(i.style.display="none"),s&&(s.style.display="none")}this._addModifier(t,this.HIDDEN_MODIFIER)},_enable:function(t){this._removeModifier(t,this.DISABLED_MODIFIER)},_disable:function(t){this._addModifier(t,this.DISABLED_MODIFIER)},_enableMenuItem:function(t){var e;t&&(e=this._findMenuItem(t))&&(e.enabled=!0)},_hasHidden:function(t){return this._hasModifier(t,this.HIDDEN_MODIFIER)},_hasActive:function(t){return this._hasModifier(t,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(t){return this._hasModifier(t,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.PLAYING},_isStreaming:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.STREAMING},_hasModifier:function(t,e){r.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));var s=this._getClassName(t,e),n=this._queryByElementName(t);return!!n&&i(n,s)},_addModifier:function(t,i){r.isArray(i)&&(i=i.join(this.MODIFIER_DELIMETER));var s=this._getClassName(t,i),n=this._queryByElementName(t);n&&e(n,s)},_removeModifier:function(t,e){var i,n=this._queryByElementName(t);r.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER)),i=this._getClassName(t,e),n&&s(n,i)},_toggleModifier:function(t,e){r.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));var i=this._getClassName(t,e),s=this._queryByElementName(t);s&&n(s,i)},_setDataAttribute:function(t,e,i){t.setAttribute("data-"+e,i)},_removeDataAttribute:function(t,e){t.removeAttribute("data-"+e)},_formatTimestamp:function(t){var e,i;return window.uvpjs.util.isEmpty(t)||t===1/0?this.NULL_TIME:(window.isNaN(t)&&(t=0),(e=new Date(null)).setSeconds(Math.round(t)),i=e.toISOString(),t>=3600?i.substr(11,8):i.substr(14,5))},_formatTimestampByType:function(t,e){if(void 0===e||e<0){if(t===this.css.TIME_DURATION)return this.NULL_TIME;if(t===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(e)},_addCSSRule:function(t,e,i){var s=this._styleEl.sheet,n=s.cssRules.length,a=this._cssRules[t];if(!r.isUndefined(a)){var o=s.rules||s.cssRules;if(o.length>0&&o[a])return void(o[a].style[e]=i)}this._cssRules[t]=n,window.uvpjs.util.addCSSRule(this._styleEl,t,e,i)},_setStyleSheet:function(t){var e=!1;this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||window.uvpjs.util.createStyleSheet(function(i){this._styleEl=i,e||"function"!=typeof t||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),e=!0,t())}.bind(this))},_templateToHTML:function(t){if(r.isArray(t)&&!r.isEmpty(t)){var e=function(t){return this._getClassName(this.css[t])}.bind(this),i={button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},s=this._isIOS;return function t(n){var a="";return r(n).each(function(n){n&&("CLOSED_CAPTION_BTN"!==n.el&&"SETTINGS_BTN"!==n.el||!s)&&(n.cls=r.isUndefined(n.cls)?e(n.el):[n.cls,e(n.el)].join(" "),n.children&&(n.children=t(n.children)),a+=r.template(i[n.type],{variable:"o"})(n))}),a}(t)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(t){return!!this._touchStartTime&&t-this._touchStartTime<this.TAP_THRESHOLD}}),i=function(t,e){return!r.isNull(t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)")))},e=function(t,e){i(t,e)||(t.className=(t.className+=" "+e).trim())},s=function(t,e){t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").trim()},n=function(t,n){i(t,n)?s(t,n):e(t,n)}}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.AdPlaylistManager=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=window.uvpjs.debug,this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(t,i,s,n){this.debug&&(window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",t),window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",i),window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",s)),e.isArray(i)?(this.vidContId=t,this._generateAdPods(i,s,n)):this.debug&&window.uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN")},_generateAdPods:function(t,e,i){var s,n,r,a=e.length,o=function(t,e,i){return{hasBeenChecked:!1,startTime:i||0,hasPlayed:!1,adPodId:t,adCount:0,podDuration:0,adCallURL:e}};for(this.debug&&(window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",t),window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",e)),this.adPods={},a>0&&(e.indexOf(0)>-1&&(this.adPods[this.PRE]=o(this.PRE+"_0",i)),e.indexOf(-1)>-1&&(this.adPods[this.POST]=o(this.POST+"_0",i))),s=0;s<a;s++)n=0===e[0]?s:s+1,r=e[s],window.isNaN(r)||0===r||-1===r||(this.adPods[this.MID_+n]=o(this.MID_+n,i,r));this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",t),e.isString(t)){var i=this.adPods[t];return this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",i),i}},getAdPods:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var t=Object.keys(this.adPods).length;return this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",t),t},getMidRollPods:function(){var t,e=[];if(!this.midRollPods){for(t in e=[],this.adPods)t.indexOf(this.MID)>=0&&e.push(this.adPods[t]);this.midRollPods=e}return this.midRollPods},isPreRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.MID)>-1},isPostRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){for(var t in this.adPods)if(t.indexOf(this.MID)>-1)return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(t){var e,i,s,n=null,r="No eligible ad pod found.";for(s in this.adPods)this.adPods.hasOwnProperty(s)&&(e=this.adPods[s],this.isPreRoll(e)||this.isPostRoll(e)||e.startTime<=t&&(n?t-e.startTime<t-n.startTime&&(n=e):n=e));return n&&(i=n.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",r="Found Ad pod; adPodId = "+n.adPodId+"; "+i),this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+t+";  "+r),n}})}(window.uvpjs.register("uvpjs")),function(t){var e,s=t._;t.TrackingManager=window.uvpjs.Class.subClass({debug:window.uvpjs.DebugManager.isEnabled,PLAYER_NAME:window.uvpjs.Configuration.name+"_"+window.uvpjs.Configuration.version,PLAYER_NAME_ONLY:window.uvpjs.Configuration.name,PLAYER_VERSION_ONLY:window.uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",DATAZOOM_MODULE_NAME:"Datazoom",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},_hasAgentInit:!1,init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&window.uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this.resourceStartTime=0,this.contextMetadata={},this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=window.uvpjs.mediaCapabilities,t&&this.initialize(t.vidContId,t.cviMgr)},destroy:function(){for(var t,e=this.agents.length;e--;)this.agents[e]&&"function"==typeof this.agents[e].destroy&&this.agents[e].destroy(),this.agents.splice(e,1);for(t in this.eventCBs)this.eventsMgr.removeEventListener(t+this.internalNS+".agent"),delete this.eventsMgr[t];for(t in this.progressEvents)delete this.progressEvents[t];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this.contextMetadata=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(t,e){this.debug&&window.uvpjs.log(this.DEBUG_ID,"initialize"),s.isString(t)&&s.isObject(e)&&(this.vidContId=t,this.eventsMgr=e.getEventsMgr(),this.cviModel=e.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=window.document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),window.document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._addTrackingEventListeners())},hasTrackingConfigOverrides:function(t){return null!==t&&t.hasOwnProperty("trackingConfigOverrides")&&null!==t.trackingConfigOverrides},getAgentConfig:function(t,e){for(var i=null,s=t.length;s-- >0;){var n=t[s];if(n.name===e){i=n;break}}return i},_overrideUvpc:function(){var t=this.cviModel;if(this.hasTrackingConfigOverrides(t)){for(var e=t.getModules().slice(0),i=e.length;i-- >0;){var s=e[i],n=this.getAgentConfig(t.trackingConfigOverrides,s.name);null!==n&&(e[i]=n)}this.agentConfigs=e}else this.agentConfigs=t.getModules().slice(0)},isTrackingAgentEnabled:function(t){var e,i=this.getAgentConfig(this.agentConfigs,t),s=this.mc.systemInfo.trackingAvailability,n=!1;for(e in window.uvpjs.tracking)if(window.uvpjs.tracking[e]===t&&s[e]){n=!0;break}return this.debug&&i&&i.enabled&&!n&&window.uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",i,s),null!==i&&i.enabled&&n},_createAgentsArray:function(t){var e,i,s,n,r,a,o;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),i=t||this.cviModel,this.debug&&window.uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),n=i.isModuleEnabled.bind(i),r=i.isModuleSet.bind(i),o=this.getPlayerName(),s={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr,playerName:o,playerVersion:this.PLAYER_VERSION_ONLY},this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),s.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,e=new window.uvpjs.AdobeHeartbeatAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),s.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,e=new window.uvpjs.AkamaiAnalyticsAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),s.moduleName=this.COMSCORE_SS_MODULE_NAME,s.playerName=this.getPlayerName("|","_"),e=new window.uvpjs.ComScoreAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),s.moduleName=this.CONVIVA_MODULE_NAME,e=new window.uvpjs.ConvivaAgent(s),this.agents.push(e)),((a=n(this.DW_MODULE_NAME))||n(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),s.moduleName=a?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,s.playerName=this.getPlayerName(";"),e=new window.uvpjs.DWAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),s.moduleName=this.NIELSEN_MODULE_NAME,e=new window.uvpjs.NielsenAgent(s),this.agents.push(e)),r(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME))this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC");else{this.debug&&window.uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent");var l=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME);s.moduleName=this.MUX_MODULE_NAME,s.playerName=this.PLAYER_NAME_ONLY,s.playerVersion=this.PLAYER_VERSION_ONLY,s.useDefaultProperty=!l("propertyKey"),e=new window.uvpjs.MuxAgent(s),this.agents.push(e)}var d=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(d&&d.params&&d.params.length>0)for(var u=d.params.length;u-- >0;)this.beaconEndPoint[d.params[u].name]=d.params[u].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(s.moduleName=this.OZTAM_MODULE_NAME,e=new window.uvpjs.OzTamAgent(s),this.agents.push(e));var h=this.getAgentConfig(this.agentConfigs,this.DATAZOOM_MODULE_NAME);h&&h.enabled&&(s.moduleName=this.DATAZOOM_MODULE_NAME,e=new window.uvpjs.DatazoomAgent(s),this.agents.push(e))},_addTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.addEventListener(e.CONTEXT_METADATA+i,this._onContextMetadata.bind(this)),t.addEventListener(e.VIDEO_STATE_CHANGE+i,this._onVideoStateChange.bind(this)),t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),t.addEventListener(e.RESOURCE_START+i,this._onResourceStart.bind(this)),t.addEventListener(e.PLAYBACK_DURATION_RESUME+i,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.removeEventListener(e.VIDEO_PROGRESS+i),t.removeEventListener(e.AD_QUARTILE+i),t.removeEventListener(e.RESOURCE_START+i)},_initializeAgents:function(){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),s.isEmpty(this.agents))this.debug&&window.uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled.");else{for(var t=this.agents.length;t--;)this.agents[t].initialize();this._addAgentEventListeners()}},fireTrackingPixel:function(t){var e=window.document.createElement("img");e.setAttribute("src",t),e.setAttribute("width","1"),e.setAttribute("height","1"),e.setAttribute("border","0"),e.style.position="absolute",e.style.bottom="0",e.style.right="0",this._beaconElement.appendChild(e)},registerEventCallbacks:function(t){if(s.isPlainObject(t)&&!s.isEmpty(t))for(var e in t)this.eventCBs[e]=this.eventCBs[e]||[],this.eventCBs[e].push(t[e])},registerProgressEvents:function(t){if(s.isPlainObject(t)&&!s.isEmpty(t))for(var e in t)this.debug&&window.uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",e),this.progressEvents[e]=this.progressEvents[e]||[],this.progressEvents[e].push(t[e])},getContentPlayhead:function(){var t=this.cviModel.contentPlaybackState.currentTime;return window.parseInt(t)},getPlayerName:function(t,e){var i=this.PLAYER_NAME;return s.isEmpty(i)?"UVPJS":(t&&(i=i.replace("_",t)),e&&(i=i.replace(/\./g,e)),i)},getAdLength:function(){return this._adLength=e(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=e(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var t in this.eventCBs)this.eventsMgr.addEventListener(t+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(t){if(t.target===this.vidContId){var e,i=this.eventCBs[t.type];if(!s.isEmpty(i)){e=i.length;for(var n=0;n<e;n++)i[n](t)}}},_onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata},_onVideoStateChange:function(t){if(t.payload.newState===this.mc.LOADING&&!this._hasAgentInit){var e,i=this.cviModel.cviMgr.RPM.currRP,s=this.cviModel.cviMgr.RPM.rscProviders;i&&i.rco&&i.rco.uvpc?e=i.rco.uvpc:s&&s.length>0&&(e=s[0].rco.uvpc),e&&e.modules&&this.cviModel.copyModules(e.modules),this._overrideUvpc(),this._createAgentsArray(),this._initializeAgents(),this._hasAgentInit=!0}},_onResourceStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this.resourceStartTime=new Date,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(t){var e,n=this.progressEvents[t];if(!s.isEmpty(n))for(e=n.length,window.i=0;window.i<e;window.i++)n[window.i]()},_onPlaybackDurationResume:function(e){var i=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),s=this.cviModel.getContentVideoState(),n={ts:Math.floor(Date.now()/1e3),contentid:s.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:i("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:s.isPaidContent,affiliate:s.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},r=(new t.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(n).devMode(this.debug).buildUrl();this.fireTrackingPixel(r)},_onVideoProgress:function(t){var e,i=t.payload,n=Math.floor(i.currentTime),r=i.duration;if(n&&r&&!i.isAd&&!(this._lastContentSecondCompleted>=n)){if(this._lastContentSecondCompleted=n,n%15==0&&n<=60||n%60==0){if(this._contentTimeFired[n])return;this._contentTimeFired[n]=!0,this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",n),this._onProgressEvent(this.progressEvents.TIMED)}i.isPlayingLive||r<=10||((e=Math.floor(n/r*100))!==this.percentDone&&(this.percentDone=e),s.inRange(e,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),s.inRange(e,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),e>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),e=function(t,e){var i=e>0?Math.floor(1e3*e):0;return window.uvpjs.util.inRange(t,i-1e3,i+1e3)?t:i}}(window.uvpjs.register("uvpjs")),window.uvpjs.register("uvpjs").TrackingAgent=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==window.uvpjs.Configuration.env,options:null,vo:null,sdkEvent:null,hasSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,isSeekDone:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(t){this.options=t,this.initTime=new Date,this.contextMetadata=t.trackingMgr.contextMetadata||{}},initialize:function(){var t=this.options.eventsMgr.eventTypes,e={};e[t.RESOURCE_START]=this.onResourceStart.bind(this),e[t.CONTENT_START]=this.onContentStart.bind(this),e[t.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),e[t.CONTROL_SEEK]=this.onSeekStart.bind(this),e[t.SEEK_DONE]=this.onSeekDone.bind(this),e[t.RESOURCE_END]=this.onResourceEnd.bind(this),e[t.CONTEXT_METADATA]=this.onContextMetadata.bind(this),e[t.CDN_UPDATED]=this.onCdnUpdated.bind(this),e[t.AD_POD_START]=this.onAdPodStart.bind(this),e[t.AD_POD_END]=this.onAdPodEnd.bind(this),e[t.AD_START]=this.onAdStart.bind(this),e[t.AD_CLICK]=this.onAdClick.bind(this),e[t.AD_END]=this.onAdEnd.bind(this),e[t.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),e[t.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),e[t.USER_GESTURE]=this.onUserGesture.bind(this),e[t.FORCE_TRACK_SESSION_END]=this.onForceTrackSessionEnd.bind(this),this.options.trackingMgr.registerEventCallbacks(e),(e={})[(t=this.options.trackingMgr.progressEvents).FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.FIRST_QUARTILE),e[t.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.MID_QUARTILE),e[t.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(e)},onResourceStart:function(t){this.hasResourceStart||(this.sendTrackEvent(this.sdkEvent.SESSION_START,this.vo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(t){this.trackContentStartEvent=!0,this.hasContentStart&&this.isPaused&&(this.sendTrackEvent(this.sdkEvent.PLAY_RESUME),this.isPaused=!1)},onQuartileProgress:function(t){this.sendTrackEvent(t,this.vo.getQuartileInfo())},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case window.uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.sdkEvent.PAUSE));break;case window.uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.sdkEvent.BUFFER_START));break;case window.uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.sdkEvent.BUFFER_COMPLETE),this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))}},onSeekStart:function(t){this.sendTrackEvent(this.sdkEvent.SEEK_START,this.vo.getSeekInfo())},onSeekDone:function(t){this.sendTrackEvent(this.sdkEvent.SEEK_COMPLETE,this.vo.getSeekInfo()),this.isSeekDone=!0},onResourceEnd:function(t){this.hasContentStart&&this.vo.isCompletedMarker()&&(this.sendTrackEvent(this.sdkEvent.CONTENT_COMPLETE,this.vo.getContentCompleteInfo()),this.sendTrackEvent(this.sdkEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata},onCdnUpdated:function(t){this.sendTrackEvent(this.sdkEvent.CDN_UPDATED,{cdn:t.payload.cdn})},onAdPodStart:function(t){this.sendTrackEvent(this.sdkEvent.AD_BREAK_START,this.vo.getAdBreakInfo())},onAdPodEnd:function(t){this.sendTrackEvent(this.sdkEvent.AD_BREAK_COMPLETE)},onAdStart:function(t){this.sendTrackEvent(this.sdkEvent.AD_START,this.vo.getAdItemInfo())},onAdClick:function(t){this.sendTrackEvent(this.sdkEvent.AD_CLICK)},onAdEnd:function(t){this.sendTrackEvent(this.sdkEvent.AD_COMPLETE)},onVideoTransition:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"bitrate",t.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(t){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.sdkEvent.QOS,this.vo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.hasContentStart||(this.sendTrackEvent(this.sdkEvent.CONTENT_START,this.vo.getContentStartInfo()),this.hasContentStart=!0)),this.isSeekDone&&(this.isSeekDone=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))},onUserGesture:function(t){t.payload.startTime>0&&(this.options.resumeTime=t.payload.startTime)},onForceTrackSessionEnd:function(t){this.onResourceEnd(t)},destroy:function(){this.vo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.vo=null,this.contextMetadata=null}}),function(t){"use strict";var e,i,s,n,r,a;a=t._,t.AdobeHeartbeatAgent=window.uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:window.uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:window.uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",SEGMENT_OWNER_PARAM_NAME:"id3SegmentOwner",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",LIVE_CONTENT_LENGTH:86400,init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=window.uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this._segmentOwner=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata=this.trackingMgr.contextMetadata||{},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._startUpTime=0,this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._segmentOwner=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=window.uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),a.isUndefined(this._visitorData.marketingCloudOrgId)?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."):this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(t,e){var i;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),a.isFunction(t)){i=e?e.sessionOptions:this.cviModel.sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),this._usesTealium=i.usesTealium;var s=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];if(this._usesTealium&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),s=a.without(s,this.scriptPaths.APP_MEASUREMENT)),n()&&!this.isPluginLoaded)return this.codeLoader=new window.uvpjs.CodeLoader,void this.codeLoader.loadScript(s,this.pluginLoadedCB);this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB()}else this.debug&&window.uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!")},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var t=this._qosObject;return e.createQoSObject(t.bitrate,t.startupTime,t.fps,t.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),e=t(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),i=t(this.TRACKING_SERVER_PARAM_NAME);this._segmentOwner=t(this.SEGMENT_OWNER_PARAM_NAME),this.mc.isSecure()&&(a.isString(i)&&0!==i.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(i=this.TRACKING_SERVER_SSL_PREFIX+i),a.isString(e)&&(e=e.replace("heartbeats.omtrdc.net","cbsinteractive.hb.omtrdc.net"))),this._appMeasurementData={account:t(this.ACCOUNT_PARAM_NAME),charSet:t(this.CHAR_SET_PARAM_NAME),trackingServer:i},this._heartbeatData={publisher:t(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:e},this._visitorData={marketingCloudOrgId:t(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:i},this._heartbeatDebug=window.uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var t=this.cviModel.sessionOptions;this._usesTealium=t.usesTealium,a.each({ftag:"ftag",netwk:"Network"},function(e,i){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",e,i);var s=t[i];a.isNull(s)||a.isUndefined(s)||a.isEmpty(s)||(this._sessionMetadata[e]=s)}.bind(this)),this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_POD_END]=this._onAdPodEnd.bind(this),e[t.AD_CLICK]=this._onAdClick.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),e[t.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),e[t.PLAYER_LOADED]=this._updateVideoInfo.bind(this),e[t.RESOURCE_START]=this._updateVideoInfo.bind(this),e[t.VIDEO_RESUME]=this._updateVideoInfo.bind(this),e[t.VIDEO_DONE]=this._updateVideoInfo.bind(this),e[t.VIDEO_CUEPOINT]=this._onVideoCuePoint.bind(this),this._contextMetadataCBSetup||(e[t.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(e)},_setupContextMetadataEventCallback:function(){var t={};t[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t),this._contextMetadataCBSetup=!0},_initializePlugin:function(){function t(t){this._agent=t}var o,l,d,u;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),n())this.debug&&window.uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded.");else if(this._mediaHeartbeat)this.debug&&window.uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used.");else{if(e=window.ADB.va.MediaHeartbeat,i=window.ADB.va.MediaHeartbeatConfig,s=window.ADB.va.MediaHeartbeatDelegate,this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!r(this._s)&&!this._waitForTealium)return this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)l=this._s,this.debug&&window.uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof window.Visitor)return void(this.debug&&window.uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof window.AppMeasurement)return void(this.debug&&window.uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(o=this._appMeasurementData.account,a.isString(o)&&a.isEmpty(o))return this._setupContextMetadataEventCallback(),void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));(u=new window.Visitor(this._visitorData.marketingCloudOrgId)).trackingServer=this._visitorData.trackingServer,u.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),(l=new window.AppMeasurement(o)).visitor=u,l.account=o,l.trackingServer=this._appMeasurementData.trackingServer,l.pageName=this._appMeasurementData.pageName,l.charSet=this._appMeasurementData.charSet,l.visitorID=this._appMeasurementData.visitorID}a.isNull(l)?this.debug&&window.uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."):((d=new i).trackingServer=this._heartbeatData.trackingServer,d.playerName=this._playerName,d.channel=this._heartbeatData.channel,d.debugLogging=this._heartbeatDebug,d.appVersion=this.SDK_VERSION,d.ssl=this.mc.isSecure(),d.ovp="",this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",d),a.extend(t.prototype,s.prototype),t.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},t.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new e(new t(this),d,l),this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad())}},_getTealium:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),r(this._s)||this._waitForTealium?void(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.")):(this._getTealiumTimer||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=window.setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),a.has(window,"s")&&r(window.s)?(this._s=window.s,this._waitForTealium=!0,void this._initializePlugin()):(this.debug&&window.uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void window.setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL)))},_onTealiumTimeout:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&window.uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(t,i){if(a.isNull(this._mediaHeartbeat))this.debug&&window.uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined");else switch(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",t),t){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(e.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(e.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(e.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(e.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(e.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(e.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(i)}},_getContentVideoMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),s=this._contextMetadata,n=this._sessionMetadata,r={};for(t in s)s.hasOwnProperty(t)&&(r[t]=s[t]);for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);if(i.contextMetadata)for(t in e=i.contextMetadata)e.hasOwnProperty(t)&&(r[t]=e[t]);return r.tl=i.videoTitle,r.mediaAutoPlay=this.cviModel.isAutoplay.toString(),r.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),r.mediaIsPaidContent=i.isPaidContent.toString(),this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",r),r},_onContextMetadata:function(t){var e,i=t.payload.contextMetadata;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",t),!a.isEmpty(i)&&(this._contextMetadata=i,this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),a.isEmpty(i[this.PAGE_REPORT_SUITE_ID_KEY]),e=i[this.PAGE_SITE_ACCOUNT_KEY],!a.isEmpty(e))){var s=a.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=e,s&&(this.debug&&window.uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+e),this._initializePlugin())}},_setVideoLoad:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat,this._startUpTime),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:this._startUpTime,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(t){var i,s,n,r,a,o=t.chapterStartTimes,l=o&&o.length||0,d=window.parseInt(t.currentContentSegment);this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",t),window.isNaN(d)&&(d=1),s=(i=d<0?0:d-1)<=0?0:o[i],a=(n=i+1>l?t.duration:o[i+1])-s,this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",n,s),(r={}).name="",r.length=window.isNaN(a)?0:a,r.position=d,r.startTime=o[i],this._chapterObject=e.createChapterObject(r.name,r.position,r.length,r.startTime),this._chapterInfo=r,this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(t){var i,s,n,r,o,l;this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",t),"pre"===(r=(o=(l=t.payload.adData).adClipID.split("_"))[0])?n=1:"mid"===r?n=window.parseInt(o[1])+1:"post"===r&&(n=this.cviModel.getNumberOfAdPods()),(s={}).name=a.isEmpty(l.adVideoTitle)?"na":l.adVideoTitle,s.position=n,s.playerName=this._playerName,s.startTime=this.getCurrentPlaybackTime(),(i={}).id=a.isEmpty(l.adVideoId)?a.isEmpty(l.adVatId)?"na":l.adVatId:l.adVideoId,i.name=s.name,i.length=l.duration,i.position=l.adPosition,this._adObject=e.createAdObject(i.name,i.id,i.position,i.length),this._adBreakObject=e.createAdBreakObject(s.name,s.position,s.startTime),this._adInfo=i,this._adBreakInfo=s,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(t){var e=this.HEARTBEAT_AD_COMPLETE;this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(e)},_onAdClick:function(t){var e=!0===t.payload.adData.paused;this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),e&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(t){var e=t.payload.contentData;this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",e),this._contentStarted=!0,this._startUpTime=Math.abs(new Date-this.trackingMgr.resourceStartTime)/1e3,this._sendInitialPlay(),e.chapterStartTimes.length>0&&(this._setChapterInfo(e),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(t){var e=t.payload.contentData;this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",e),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&e.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(t){var e=this._videoInfo,i=this._contentStarted&&e&&Math.ceil(e.playhead)>=.95*e.length,s=this.cviModel.getContentVideoState().isLive;this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",i),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,!s&&i&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(t){var e=t.payload.newState,i=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",e),this._videoLoaded&&(this._isBuffering||e!==this.mc.BUFFERING?this._isBuffering&&e!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),e===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),i&&e===this.mc.PAUSED&&this._onControlPause(t))},_updateVideoInfo:function(){var t,i=this.cviModel.getCurrentPlaybackState(),s=this.cviModel.getContentVideoState(),n=e.StreamType,r=s.duration,o=s.isLive,l=s.episodeFlag,d={};a.isEmpty(s.cmsRefGuid)?a.isEmpty(s.mediaId)?a.isEmpty(s.pid)?a.isEmpty(s.assetURL)?d.id="na":d.id=s.assetURL:d.id=s.pid:d.id=s.mediaId:d.id=s.cmsRefGuid,d.name=s.videoTitle,d.playerName=this._playerName,d.length=o?this.LIVE_CONTENT_LENGTH:window.isNaN(r)?0:r,d.playhead=i.currentTime,o?t=n.LIVE:(t=n.VOD,t+=":"+(l?this.FULL_EPISODES:this.CLIPS)),d.streamType=t,this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",e),this._mediaObject=e.createMediaObject(d.name,d.id,d.length,d.streamType),this._videoInfo=d,this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(t){var e=t&&t.facadeState,i=this._qosObject;e&&i&&(i.bitrate=e.currentBitrate||0,i.droppedFrames=e.droppedFrames||0,i.fps=e.playbackFramerate||0)},_updatePlayhead:function(t){var e=t.payload;this._videoInfo&&e&&(e.isAd||(this._updateQosObj(e),this._videoInfo.playhead=e.currentTime))},_sendInitialPlay:function(){!this._videoLoaded&&this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)},_onVideoCuePoint:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoCuePoint",t),this._isSegmentOwner(t.payload)){var e=t.payload.data;(e=e.split("|")).length>0&&this._segmentStart({segmentId:e[0],segmentTitle:e[1]})}},_segmentStart:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _segmentStart",t),t.segmentId){this._mediaHeartbeat.trackComplete(),this._mediaHeartbeat.trackSessionEnd(),this._mediaObject.data["a.videoId"]=t.segmentId,this._mediaObject.data["a.name"]=t.segmentTitle;var e=this._getContentVideoMetadata();e.tl=t.segmentTitle,this._mediaHeartbeat.trackSessionStart(this._mediaObject,e),this._mediaHeartbeat.trackPlay()}},_isSegmentOwner:function(t){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _isOwner",this._segmentOwner),t.data&&t.data.indexOf("|")>-1&&t.name===this._segmentOwner}}),n=function(){return"undefined"==typeof window.ADB||"undefined"===a.get(window.ADB,"va.Heartbeat")},r=function(t){return a.isObject(t)&&!a.isEmpty(t)&&a.isFunction(t.isReadyToTrack)}}(window.uvpjs.register("uvpjs")),function(t){var e,i=t._,s=function(t){return(t>0&&t<10?"0":"")+t.toString()},n="*null",r={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"};t.ComScoreAgent=window.uvpjs.Class.subClass({debug:"prod"!==window.uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=window.uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:t("c2")||"3005086",ns_st_pu:t("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.RESOURCE_START]=this._onResourceStart.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),e[t.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){e()?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."):this._setupEventCallbacks()},_createStreamingTag:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",t),this.streamingTag=new window.ns_.ReducedRequirementsStreamingAnalytics(t)},_getContentMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),a=(this.cviModel.getContentPlaybackState(),window.uvpjs.util),o=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),l=this.cviModel.getContentVideoState().isLive,d=window.parseInt(i.episodeNumber),u=window.parseInt(i.seasonNumber),h=(i.seriesTitle,i.videoTitle),c=h&&h.split("-")[1],p=!window.isNaN(d),f=!window.isNaN(u),v=null!==i.contextMetadata&&i.contextMetadata.comscore_c4,g=h;p&&f&&(t=s(d),g+="--"+(e=s(u))+t);var _={ns_st_ci:a.getDefinedString(i.cmsRefGuid,i.mediaId,"0"),ns_st_cl:l?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[r.publisherBrand],ns_st_pr:a.getDefinedString(i.seriesTitle,i.videoTitle),ns_st_ep:c,ns_st_sn:f&&e||n,ns_st_en:p&&t||n,ns_st_ge:i.category||n,ns_st_ia:l?1:0,ns_st_ddt:n,ns_st_tdt:n,ns_st_st:o("c4")||n,ns_st_ce:i.episodeFlag?1:0,c3:o("c3")||this._playerName,c4:v||o("c4")||n,c6:o("c6")||g};return["ns_st_ge","ns_st_st","ns_st_pu","ns_ap_an","ns_st_ddt","ns_st_tdt"].forEach(function(t){var e=o(t);e&&(_[t]=e)}),_},_onAdStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",t),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",t),this._isAd=!1,this._trackStop()},_onContentStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",t);var e=window.ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?e.Live:e.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",t),this._trackStop()},_onControlPlay:function(t){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",t),this.streamingTag?this._isAd?void this._trackAdPlay():void this._trackContentPlay():void(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized"))},_onControlPause:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",t),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",t),this.streamingTag=null},_onLiveSegmentStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",t),this._isLiveEvent(t)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=t.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",t),this._trackStop()},_onVideoProgress:function(t){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_onVideoStateChange:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",t);var e=t.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(e===this._mc.PAUSED?this._onControlPause(t):e===this._mc.PLAYING&&this._onControlPlay(t))},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=t.util.copyObjectWithKeyMap(r).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(t){return this.cviModel.getContentVideoState().isLive&&t.payload&&t.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof t.payload.liveSegmentData},_isSameLiveStation:function(t){return t.stationTitle===this._contentMetadata[r.stationTitle]},_getAdType:function(){var t,e=window.ns_.ReducedRequirementsStreamingAnalytics.AdType,i=this.cviModel.getAdVideoState().adClipID.split("_")[0];return t="pre"===i?e.LinearOnDemandPreRoll:"mid"===i?e.LinearOnDemandMidRoll:e.LinearOnDemandPostRoll,this.cviModel.getContentVideoState().isLive&&(t=e.LinearLive),t}}),e=function(){return"undefined"==typeof window.ns_||i.isUndefined(window.ns_.ReducedRequirementsStreamingAnalytics)}}(window.uvpjs.register("uvpjs")),function(t){"use strict";t.ConvivaAgent=window.uvpjs.Class.subClass({init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",t),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null,this.contextMetadata=this.trackingMgr.contextMetadata||{}},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null,this.contextMetadata=null},initialize:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){if(void 0!==window.Conviva){var t=this.eventTypes,e=this.adEventHandlerMap={};e[t.AD_POD_START]=this.hPodStart.bind(this),e[t.AD_POD_END]=this.hPodEnd.bind(this),e[t.AD_LOADED]=this.hAdLoaded.bind(this),e[t.AD_START]=this.hAdStart.bind(this),e[t.AD_END]=this.hAdEnd.bind(this),e[t.AD_ERROR]=this.hAdError.bind(this),e[t.AD_BUFFERING]=this.hAdBuffering.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client.")))}else this.debug&&window.uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded.")},_getAdType:function(t){var e="string"==typeof t?t.toLowerCase():null,i=window.Conviva.Client.AdPosition,s=window.uvpjs.ConvivaAgent.adPositions;return e?e.indexOf(s.PRE)>=0?i.PREROLL:e.indexOf(s.MID)>=0?i.MIDROLL:e.indexOf(s.POST)>=0?i.POSTROLL:void 0:i.PREROLL},_getArgsForStartAd:function(t){var e=window.Conviva.Client.AdStream,i=window.Conviva.Client.AdPlayer,s="ima"==t.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(t.adType),stream:s?e.SEPARATE:e.CONTENT,player:s?i.SEPARATE:i.CONTENT}},_onAdEvent:function(t){var e=t.type;this.startEvents.content=0,this.hasConvivaSession||e===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[e](t.payload,t)},hPodStart:function(t,e){this.podCount++,this._onContentPaused(e),this.currAdPodInfo=this._buildAdPodInfo(t.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);var i=this._getArgsForStartAd(t);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(i.key,i.stream,i.player,i.pos),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",i),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(t,e){var i=this._buildAdInfo(t);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,i),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(t,e){this.adPodInProgress&&this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(window.Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(t,e){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(t,e){var i=this.currAdPodInfo||{},s=this.convivaSessionKey;this.adPodInProgress=!1,window.uvpjs.util.isEmpty(s)||s===window.Conviva.Client.NO_SESSION_KEY?this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",i),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(t,e){var i=t.errorInfo;this.hasConvivaAdSession?(this._sendError(i.errorCode,window.Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",i)):this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",i)},hAdBuffering:function(t,e){this.hasConvivaAdSession?(this.convivaAdPlayerStateManager.setPlayerState(window.Conviva.PlayerStateManager.PlayerState.BUFFERING),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_BUFFERING")):this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad buffering - no session key")},_onContentEvent:function(t){var e=!1;this.startEvents.ad=0,t.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),!this.hasConvivaSession&&this._createConvivaSession(),e=!0):t.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,e=!0,this.hasContentStarted=!0,this._killConvivaAdSession()),e&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(t){this._setConvivaPlayerState(window.Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlaying:function(t){this._setConvivaPlayerState(window.Conviva.PlayerStateManager.PlayerState.PLAYING)},_onContentBuffering:function(t){!this.isSeekPending&&this._setConvivaPlayerState(window.Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",t),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*t.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(t){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",t),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(t){this.isSeekDone&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",t),this._onContentPlaying(t),this.isSeekDone=!1)},_onVideoEvent:function(t){var e=this.eventTypes;switch(t.type){case e.VIDEO_STATE_CHANGE:var i=t.payload.newState,s=this._getMediaCapabilities();this.hasConvivaAdSession?i===s.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(t):i===s.PAUSED&&this._onAdPaused(t):this.hasConvivaSession&&(i===s.PLAYING?this._onContentPlaying(t):i===s.PAUSED?this._onContentPaused(t):i===s.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(t));break;case e.VIDEO_TRANSITION_COMPLETE:case e.VIDEO_DONE:this._onVideoTransition(t);break;case e.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(t){var e=this.hasConvivaSession?this.convivaSessionKey:window.Conviva.Client.NO_SESSION_KEY,i=new window.Conviva.ContentMetadata;i.defaultResource=this._validateStr(t.payload.cdn,""),this.convivaClient.updateContentMetadata(e,i)},_onError:function(t){var e=t.payload.errorInfo;e.isFatal?(!this.hasConvivaSession&&this._createConvivaSession(),this._sendError(e.errorCode,window.Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(e.errorCode,window.Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==window.Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(t){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(window.Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",t),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(window.Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(t){var e=t.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(e>0&&(e*=.001),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",e),this.convivaPlayerStateManager.setBitrateKbps(e))},_onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata||{}},_createConvivaSession:function(){if(this.convivaClient){var t=this.cviModel,e=(this._getMediaCapabilities(),window.Conviva.PlayerStateManager.PlayerState,{userId:t.getSessionOption("userId"),userPPID:t.getSessionOption("userPPID"),userStatus:t.getSessionOption("userStatus")}),i=new window.Conviva.ContentMetadata;this._setContentMetadata(i,e),this.convivaSessionKey=this.convivaClient.createSession(i),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")}},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(window.Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==window.Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(window.Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(t,e){var i=this.hasConvivaSession?this.convivaSessionKey:window.Conviva.Client.NO_SESSION_KEY;this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",t,e),this.convivaClient&&this.convivaClient.sendCustomEvent(i,t,e)},_sendError:function(t,e,i){if(this.hasConvivaSession){var s="";t=window.uvpjs.mapErrorCode(t).toString(),!0===i?(s=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,t,e)):this.convivaPlayerStateManager.sendError(t,e),this.debug&&window.uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+s+" ERROR: "+t)}},_setConvivaPlayerState:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",t),this.convivaPlayerStateManager.setPlayerState(t))},_setContentMetadata:function(t,e){var i=this.cviModel,s=window.Conviva.ContentMetadata.StreamType,n=i.contentVideoState,r=n.defaultBitrate;t.applicationName=this.playerName,t.assetName=this._validateStr(n.videoTitle,"N/A"),t.defaultBitrateKbps=r&&r>0?r:700,t.defaultResource=this._validateStr(n.cdn,""),t.duration=n.duration,t.streamType=n.isLive?s.LIVE:s.VOD,t.streamUrl=this._validateStr(n.assetURL,"N/A"),t.viewerId=this._validateStr(e.userId,"N/A"),t.custom={accessType:this._validateStr(e.userStatus,"anon"),contentId:this._validateStr(n.cmsRefGuid,"N/A"),contentType:n.isLive?"Live":"VOD",isEpisode:n.episodeFlag?"true":"false",Partner_ID:this._validateStr(i.getSessionOption("partner"),"N/A"),Player_Version:window.uvpjs.Configuration.version,seriesTitle:this._validateStr(n.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._getEpisodeTitle(n),appRegion:this._validateStr(i.sessionOptions.userCountry,"us"),app:window.uvpjs.Configuration.name,appVersion:window.uvpjs.Configuration.name+" "+window.uvpjs.Configuration.version,drm:n.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(n.drm),showId:this.contextMetadata.showId&&this._validateStr(this.contextMetadata.showId.toString(),""),connectionType:this._validateStr(i.sessionOptions.userConnectionType,"unknown")}},_getEpisodeTitle:function(t){if(t.isLive)return t.videoTitle||t.episodeTitle;var e=this._validateStr(t.episodeTitle,t.videoTitle);return e.search(/\w+.*-.*\w+/)>-1&&(e=e.split("-")[1]),e.replace(/^\s+|\s+$/g,"")},_getWinDimension:function(){var t=this.cviModel.contentVideoState.sourceWidth,e=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(t=window.screen.width),window.screen.height&&(e=window.screen.height)),t+"x"+e},_createConvivaClient:function(){var t=this._getConvivaClientSettings();return t?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new window.Conviva.Client(t,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var t,e=this.moduleParams;return this._isValidStr(e.customerKey)&&this._isValidStr(e.serviceUrl)?((t=new window.Conviva.ClientSettings(e.customerKey)).heartbeatInterval=e.heartbeatInterval||this.defaultHeartbeatInterval,t.gatewayUrl=e.serviceUrl,t):(this.debug&&window.uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(t){var e="development"===window.uvpjs.Configuration.env,i=window.Conviva.SystemSettings.LogLevel;t.allowUncaughtExceptions=e,t.logLevel=e?i.WARNING:i.NONE},_createConvivaSystemFactory:function(){var t=new window.Conviva.SystemInterface(new window.uvpjs.ConvivaHtml5Time,new window.uvpjs.ConvivaHtml5Timer,new window.uvpjs.ConvivaHtml5Http,new window.uvpjs.ConvivaHtml5Storage,new window.uvpjs.ConvivaHtml5Metadata,new window.uvpjs.ConvivaHtml5Logging),e=new window.Conviva.SystemSettings;return this._setConvivaSystemProps(e),new window.Conviva.SystemFactory(t,e)},_buildAdPodInfo:function(t){var e,i,s,n={};return window.uvpjs.ConvivaAgent.adPositions,t?(void 0!==t.podDuration&&(n.podDuration=String(t.podDuration)),t.adPodId?(i=(e=t.adPodId.split("_")[0].toLowerCase()).charAt(0).toUpperCase()+e.slice(1),s=String(t.imaPodIndex+1),n.podPosition=i+"-roll",n.podIndex=this.podCount,n.absoluteIndex=s,n):n):null},_buildAdInfo:function(t){var e=new window.Conviva.ContentMetadata,i=t.adData,s=t.imaAdData||{},n=this.cviModel.getSessionOption("partner");if(!t)return null;e.adTitle="("+i.adVideoId+")"+i.adVideoTitle,e.assetName=e.adTitle,e.adClipId=this._validateStr(i.adClipID,"N/A"),e.Partner_ID=this._validateStr(n,"N/A"),e.adServerName=this._validateStr(i.adServerName,"N/A"),e.streamUrl=this._validateStr(i.adAssetUrl,"N/A"),e.duration=i.duration,e.streamType=window.Conviva.ContentMetadata.StreamType.VOD;var r=i.adType;return e.custom={"c3.ad.technology":"Client Side","c3.ad.id":s.adId||i.adVideoId,"c3.ad.system":s.adSystem||i.adServerName,"c3.ad.position":r.charAt(0).toUpperCase()+r.substr(1)+"roll","c3.ad.mediaFileApiFramework":s.apiFramework,"c3.ad.sequence":s.adPodInfo?s.adPodInfo.adPosition:i.adPosition,"c3.ad.creativeId":s.creativeId||i.creativeId,"c3.ad.advertiser":s.advertiserName},this.debug&&window.uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",e),e},_isValidStr:function(t){return window.uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_isDynamicStreaming:function(t){var e=t.split("?");return"mp4"===e[0].substr(e[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return window.uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var t,e=this.cviModel.getModule(this.moduleName).params,i=e.length,s={};i--;)s[(t=e[i]).name]=t.value;this.moduleParams=s},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onAdEvent.bind(this),s=this._onContentEvent.bind(this),n=this._onVideoEvent.bind(this),r=this._onError.bind(this);e[t.AD_POD_START]=i,e[t.AD_LOADED]=i,e[t.AD_START]=i,e[t.AD_END]=i,e[t.AD_POD_END]=i,e[t.AD_ERROR]=i,e[t.AD_BUFFERING]=i,e[t.CONTENT_DATA_LOADED]=s,e[t.CONTENT_START]=s,e[t.CONTENT_END]=s,e[t.VIDEO_STATE_CHANGE]=n,e[t.VIDEO_TRANSITION_COMPLETE]=n,e[t.VIDEO_DONE]=n,e[t.RESOURCE_END]=n,e[t.PLAYER_START_ERROR]=r,e[t.VIDEO_START_ERROR]=r,e[t.VIDEO_PLAYBACK_ERROR]=r,e[t.CDN_UPDATED]=this._onCdnUpdated.bind(this),e[t.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e),window.addEventListener("beforeunload",function(){this.hasConvivaAdSession&&this._killConvivaAdSession(),this._killConvivaSession()}.bind(this),!1)}}),t.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(window.uvpjs.register("uvpjs")),function(t){"use strict";t.NielsenAgent=window.uvpjs.Class.subClass({debug:window.uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},adType:{LINEAR:"1",DYNAMIC:"2"},init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===window.uvpjs.Configuration.env&&this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent init",t),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var t,e,i,s=this.cviModel,n=this._metadata,r=s.sessionOptions.partner,a=s.getModule(this._moduleName).params,o=a.length,l={};for(this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");o--;)""!==(t=a[o]).value&&(l[t.name]=t.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:l[this.NIELSEN_SFCODE_PARAM_NAME],apid:l[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:l[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},r){case"chow":e="us-700144",i="c06";break;case"tvcom":e="us-200330",i="c03";break;case"cbs":case"can":e="us-700144",i="c01";break;case"cbssports":case"cbssports_test":e="us-201669",i="c02";break;case"news":e="us-700144",i="c03";break;case"gamespot":e="us-200330",i="c13";break;case"cnettv":e="us-200330",i="c05";break;default:e="us-700144",i="c01"}n.ci=l.clientid||e,n.c6=l.vcid||i,n.iag_sid=l.iag_sid,n.iag_tfid=l.iag_tfid,n.channelName=l.channelName,n.segB=l.segB||"",this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",l,n)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){e()?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."):(window.NOLBUNDLE&&"function"==typeof window.NOLBUNDLE.nlsQ?this._gg=window.NOLBUNDLE.nlsQ(this._nolggGlobalParams.apid,"_gg"+(new Date).getTime()):(this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams)),this._setupEventCallbacks())},_notifySDK:function(t,e){this._isDisabled()||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",t,e),this._gg.ggPM(t,e))},_onContentDataLoaded:function(t){var e,i,s,n,r,a,o,l,d=window.uvpjs.mediaCapabilities.isMobile(),u=this._metadata;t.payload&&(s=(e=t.payload.vidState).chapterStartTimes.length>0?"lf":"sf",r=e.episodeNumber,a=e.seasonNumber,o=e.seriesTitle,l=e.videoTitle,i=e.duration,n=[l,a,r,s].join("|"),""===a&&(a="0"),""===r&&(r="0"),e.isAffiliateFeed&&(u.tv="true"),(e.isLive||-1===i)&&(i=this.NIELSEN_LIVE_VIDEO_DURATION),u.pc=u.ci+u.c6+u.cmsRefGuid,u.c10="plt,"+(d?"MBL":"DSK"),u.sd=i,u.dur=i,u.cg=o,u.tl=n,u.videotype="content",u.guid=e.cmsRefGuid,u.seriestitle=o,u.episodetitle=l,u.isfullepisode=e.episodeFlag?"y":"n",u.crossId1=e.mediaId,u.iag_pgm=l,u.iag_epi=n,u.iag_pd=window.location.hostname,u.iag_fp=s,u.iag_cte="na",u.iag_oad="na",u.iag_seg=1,this._metadata.adloadtype=e.isLive?this.adType.LINEAR:this.adType.DYNAMIC,this._isRcoTypeDai()&&(this._metadata.adloadtype=this.adType.DYNAMIC),this._metadata.adModel=this._metadata.adloadtype,this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",u))},_onAdStart:function(t){var e,i,s,n,r,a,o,l,d,u,h=this.cviModel.getContentVideoState(),c=t.payload;c&&(this._metadata.hasAds=1,this._adDisplayed=!0,u=window.uvpjs._.clone(this._metadata),n=(i=(e=c.adData).adClipID.split("_"))[0],l=this.cviModel.getNumberOfAdPods(),d="post"===n?l:++i[1],s=["dav0",h.videoTitle,h.seasonNumber,h.episodeNumber].join("-"),o=[l,d,this._numAdsInPod,i[2]].join("_"),r=e.adVatId,a=e.adVideoUrl,""!==r&&(a+="|"+r),u.videotype=n+"roll",u.iag_cte=a,u.iag_pod=o,u.iag_apt="na",u.tl=s,u.c3="st,a","pre"===n&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",u),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,u))},_onAdPodStart:function(t){var e=t.payload;e&&(this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",e.adPod.adCount),this._numAdsInPod=e.adPod.adCount)},_onAdEnd:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(t){var e,i=t.payload;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),i){if(this._metadata.iag_seg&&this._metadata.iag_seg++,(e=t.payload.contentData).duration>0&&Math.abs(e.duration-this._lastContentSecond)<=5)return void this._notifySDK(this.events.END,this._lastContentSecond);this._notifySDK(this.events.STOP,this._lastContentSecond)}},_onControlPlay:function(t){this._adDisplayed||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(t){var e,i=t.payload;if(i&&!((e=Math.floor(i.currentTime))<0)){if(i.isAd){if(this._lastAdSecond===e)return;this._lastAdSecond=e}else{if(this._lastContentSecond===e)return;this._lastContentSecond=e}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,e)}},_onVideoCuepoint:function(t){var e=t.payload,i=e.data;e.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&i&&"string"==typeof i&&this._notifySDK(this.events.SEND_ID3,i)},_hasAds:function(){var t=this.cviModel.getNumberOfAdPods();return-1===t?2:0===t?0:1},_isDisabled:function(){var t=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===t||!0===t},_isRcoTypeDai:function(){var e=this.cviModel.cviMgr.RPM.currRP;return!(null==e)&&e.rco.type===t.mediaCapabilities.RP_DAI}});var e=function(){return void 0===window.NOLCMB}}(window.uvpjs.register("uvpjs")),function(t){var e,i,s,n=t._;t.DWAgent=window.uvpjs.Class.subClass({debug:"prod"!==window.uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"//dw.cbsi.com/levt/video/e.gif?",RESUME_BEACON_URL:"//dw.cbsi.com/levt/beacon/e.gif?",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var t=this._tags.content;this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),t.componentid=this.trackingMgr.componentid,t.device=this._getDevice(),t.mapp=this._playerName,t.part=this.cviModel.getSessionOption("partner"),t.playertime=0,t.siteid=this.trackingMgr.DEFAULT_SITEID,t.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var t=this.cviModel,e=t.getSessionOption("cms"),i=t.getContentVideoState(),s=t.getCurrentPlaybackState(),n=window.uvpjs.mediaCapabilities,r=this._tags.content,a=this._tags.ad,o=this.trackingMgr;a.adastid=e===o.PLATFORM_CMS?"43":"0",(window.uvpjs.util.isEmpty(r.medastid)||0===r.medastid||"0"===r.medastid)&&(i.isLive?i.isAffiliateFeed?r.medastid="cbsnews"===t.getSessionOption("playerId")?"601":"600":s.isHDStreamLive||n.isChromecast()?r.medastid="601":r.medastid="0":r.medastid=e===o.PLATFORM_CMS?"595":"0",this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",r.medastid,a.adastid))},_loadConfigParams:function(){for(var t,e,i,s=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),r=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],a=r.length;a--;)e=r[a],t=this._getTagType(e),i=s(e),n.isUndefined(t)||n.isEmpty(i)||(this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",e,i),this._tags[t][e]=i);this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var t,e,i,s=window.DW&&window.DW.pageParams||{};for(t in this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams"),s)s.hasOwnProperty(t)&&(i=s[t],n.isEmpty(i)||(this._pageParams[t]=i,e=this._getTagType(t),n.isUndefined(e)||(this._tags[e][t]=i)));this.debug&&(window.uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),window.uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_BLOCKED]=this._onAdBlocked.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.AD_ERROR]=this._onAdError.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.USER_GESTURE]=this._onUserGesture.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(e),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var t=this.trackingMgr.progressEvents,e={};e[t.FIRST_QUARTILE]=this._onProgressEvent.bind(this,t.FIRST_QUARTILE),e[t.MID_QUARTILE]=this._onProgressEvent.bind(this,t.MID_QUARTILE),e[t.THIRD_QUARTILE]=this._onProgressEvent.bind(this,t.THIRD_QUARTILE),e[t.TIMED]=this._onProgressEvent.bind(this,t.TIMED),this.trackingMgr.registerProgressEvents(e)},_sendDWEvent:function(t){var e=this._tags.content,n=e.event,r=n===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),e.gestval=window.uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:s(this._gestval),n!==this.events.INIT&&(e.playertime=this._getPlayerTime()),e.ts=+new Date,r+=i(e),t&&(r+="&"+i(this._tags.ad)),this.trackingMgr.fireTrackingPixel(r),this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",r),this._gestval={},e.gestval="",e.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var t=window.location,e=window.uvpjs.mediaCapabilities,i=e.isMobile()?"mobile%20web":"desktop%20web",s=this.cviModel.getSessionOption("userStatus"),r=this.cviModel.getSessionOption("userId"),a=this._tags.content,o=this._pageParams;this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,a.event=this.events.INIT,a.mso=this.trackingMgr.mso,a.pageurl=t.href,a.srchost=t.host,a.ursuid=r,a.v16=o.viewguid,a.v17=o.topic,a.v18=o.topicbrcrm,a.v19=o.pagetype,a.v20=o.assetguid,a.v21=e.isChromecast()?"chromecast":i,a.v23=o.rsid,a.v25=n.isEmpty(s)?"anon":s,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(t){var e=this.trackingMgr.progressEvents,i=this._tags.content,s=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",t),t)switch(t){case e.FIRST_QUARTILE:s.pct=25;break;case e.MID_QUARTILE:s.pct=50;break;case e.THIRD_QUARTILE:s.pct=75}i.event=this.events.PLAY,this._sendDWEvent(),delete s.pct}},_onAdBlocked:function(t){this._tags.ad,this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(t){var e=this._tags.ad,i=t.payload.adData,s=i.adClipID.split("_");this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),e.adid=n.isEmpty(i.adVideoId)?"999":i.adVideoId,e.adnum=this.cviModel.adNum,e.adtime=0,e.adtitle=i.adVideoTitle,e.adtype=i.isLinear?1:2,e.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),e.adbreak="",e.adpos=s[0],e.adpod=s[1],e.adpodpos=s[2],this._sendDWEvent(!0)},_onAdQuartile:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",t),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(t){var e=t.payload.adData;this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",t),this._tags.content.event=this.events.END,this._tags.ad.adtime=e.duration,this._sendDWEvent(!0)},_onAdError:function(t){var e=t.payload.errorInfo.errorCode;this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",t),e===window.uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(t){var e=this.cviModel,i=e.getContentVideoState(),s=this._tags.content,r=this._gestval;this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",t),s.event=this.events.START,s.codec=i.fileType,s.distntwrk=e.getSessionOption("netwk"),s.playersz=this._getPlayerSize(),s.sdlvrytype=this._getStreamType(),s.v22=i.cmsRefGuid,s.medid=i.mediaId,s.medlength=this.trackingMgr.getContentLength()/1e3,s.mednum=e.medNum,s.medrls=i.pid,s.medtitle=i.videoTitle,s.contsessid=i.previousSessionId,n.isEmpty(i.contPlayState)||(r.autoplay=i.contPlayState),r.paywall=i.isPaidContent?"1":"0",r.caption_available=i.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",t),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(t),this._sendDWEvent()},_onContentEnd:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var t=this._tags.content;this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(t.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),t.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(t){var e=t&&t.payload,i=e&&e.seekFromTime,s=e&&e.seekToTime,n=s-i,r=this._tags.content;r.eventdur=Math.floor(Math.abs(n)),r.event=n>0?this.events.FORWARD:this.events.REWIND,this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:i,seekToTime:s,seekDuration:n,event:r.event,eventdur:r.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(t){var e,i,s,r,a,o,l=this._tags.content,d=this._gestval,u=t.payload.gestureInfo,h=this.cviModel.contentVideoState,c=h.elapsedTime,p="",f=window.uvpjs.Type.Gesture;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",t),"string"!=typeof u||-1!==u.indexOf("event=")){if(n.isArray(u)){if(u.length<1)return void window.uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");p=u[0]}if(h=this.cviModel.contentVideoState,"string"==typeof u)a=(r=/event=([^&]*)(?:&gestval=(.*))?/.exec(u))[1],o=r[2],l.event=a,l.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===o?"":o;else if(p===f.GLOBAL_RESUME||p===f.LOCAL_RESUME)d.prevcomponentid=h.previousSessionId,d.eventdur=c>0?Math.round(c/1e3):0,d.paywall=h.isPaidContent?"1":"0",l.event=this.events.RESUME,l.medtime=h.resumeContentTime;else if(p===f.CONT_CANCEL)d.action=this.events.PROMPT;else switch(l.medtime=this.cviModel.contentPlaybackState.currentTime,p){case f.RELATED_OVERLAY:l.event=f.RELATED_OVERLAY;break;case f.RELATED_CLICK_GESTURE:u.length>=2&&(d.related_pid=u[1]),l.event=f.RELATED_CLICK_GESTURE;break;case f.SHARE_OVERLAY:l.event=f.SHARE_OVERLAY;break;case f.SHARE_NETWORK_GESTURE:u.length>=2&&(d.network=u[1]),l.event=f.SHARE_NETWORK_GESTURE;break;case f.SEND_GESTURE:u.length>=2&&(i=(e=u[1].split(",")).shift(),s=e.join(","),d.sender=i,d.recipient=s),l.event=f.SEND_GESTURE;break;case f.EMBED_GESTURE:l.event=f.EMBED_GESTURE;break;case f.LINK_GESTURE:l.event=f.LINK_GESTURE;break;case f.REPLAY_GESTURE:l.event=f.REPLAY_GESTURE;break;case f.END_CARD_OVERLAY:l.event=f.END_CARD_OVERLAY;break;case f.ERROR_OVERLAY:l.event=f.ERROR_OVERLAY;break;case f.RECOMMEND_NOW:u.length>=3?(d.mediaid=u[1],d.pid=u[2]):(d.mediaid="",d.pid=""),l.event=f.RECOMMEND_NOW;break;case f.RECOMMEND_NEXT:u.length>=3?(d.mediaid=u[1],d.pid=u[2]):(d.mediaid="",d.pid=""),l.event=f.RECOMMEND_NEXT;break;case f.RECOMMEND_CLOSE:l.event=f.RECOMMEND_CLOSE;break;default:return void window.uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",p)}this.debug&&(window.uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",l),window.uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",d)),this._sendDWEvent()}else window.uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.")},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(t){return n.has(this._tags.ad,t)?"ad":n.has(this._tags.content,t)?"content":void 0},_getStreamType:function(){var t=this.cviModel.getContentVideoState(),e=window.uvpjs.mediaCapabilities,i=t.deliveryType,s=t.isLive;return i===e.STREAMING?s?5:4:i===e.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var t=this._agentStartTime,e=n.isDate(t)&&window.parseInt((new Date-t)/1e3)||0;return this.debug&&window.uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",e),e},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var t=window.uvpjs.mediaCapabilities,e=window.screen,i={type:(t.getDevice()||"").toLowerCase(),os:(t.getOS()||"").toLowerCase(),ver:t.getOSVersion(),screensz:[e.width,e.height].join("x")};return s(i)},_getPlayerSize:function(){var t=this.cviModel.getContentVideoState();return[t.sourceWidth,t.sourceHeight].join("x")}}),e=function(t,e,i){var s,r,a=[];for(s in t)t.hasOwnProperty(s)&&(r=n.isUndefined(t[s])?"":window.encodeURIComponent(t[s]),a.push([s,r].join(e)));return a.join(i)},i=function(t){return e(t,"=","&")},s=function(t){return e(t,":",";")}}(window.uvpjs.register("uvpjs")),function(t){var e;t._,t.AkamaiAnalyticsAgent=window.uvpjs.Class.subClass({debug:"prod"!==window.uvpjs.Configuration.env,CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(t){this.debug=window.uvpjs.debug,this.DEBUG_ID=window.uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this.buffering=!1,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.buffering=!1,this.akamaiPlugin=null},initialize:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){var t={};this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),e()?this.debug&&window.uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."):(t.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,t.streamHeadPosition=this.getStreamHeadPosition.bind(this),t.streamLength=this.getStreamLength.bind(this),t.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new window.AkaHTML5MediaAnalytics(t),this._setupEventCallbacks())},setAdMetaData:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var t=this.cviModel.adVideoState,e={};e.adTitle=t.adVideoTitle,e.adDuration=t.duration,e.id=t.adVideoId,e.adPartnerId=this.cviModel.sessionOptions.partner,e.adServer=t.adServerName,this.akamaiPlugin.handleAdLoaded(e)},setContentMetaData:function(){var t=this.cviModel,e=t.sessionOptions,i=this.akamaiPlugin,s=t.getContentVideoState(),n=t.getContentPlaybackState();this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),i.setData("viewerId",t.getModuleParam(this._moduleName,"viewerID")),i.setData("partnerId",e.partner),i.setData("playerId",this.trackingMgr.getPlayerName("|")),i.setData("Host",e.host),i.setData("Referrer",e.referrer),i.setData("title",s.title),i.setData("category",s.category),i.setData("subCategory",s.sourceOwner),i.setData("show",s.title),i.setData("contentLength",1e3*n.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",t),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",t.payload),this.akamaiPlugin&&t.payload)switch(t.payload.percent){case 25:this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(t){if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",t),this.akamaiPlugin){var e=t.payload.newState;e!==window.uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),e===window.uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())}},_onResourceEnd:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",t),this.akamaiPlugin&&this.akamaiPlugin.handlePlayEnd("Play.End.Detected")},_onQosMetadata:function(t){var e,i;if(this.debug&&window.uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",t),this.akamaiPlugin&&-1!==t.payload.vendorArray.indexOf(window.uvpjs.Type.QOSVendor.AKAMAI))for(e in i=t.payload.paramsObj)this.akamaiPlugin.setData(e,i[e])}}),e=function(){return"undefined"==typeof window.AkaHTML5MediaAnalytics}}(window.uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.MuxAgent=window.uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(t){this.cviModel=t.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=window.uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&window.uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",t),this.trackingMgr=t.trackingMgr,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.playerVersion=t.playerVersion,this.useDefaultProperty=t.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=window.uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){if(!this.cviModel)return window.uvpjs.debug;var t=this._gatherModuleParams(window.uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!t&&!0===t[window.uvpjs.DebugManager.configParams.MUX_DEBUG]},_initializePlugin:function(){console.log("[MUX] _initializePlugin"),void 0!==window.mux?this.cviModel&&this._setupEventCallbacks():this.debug&&window.uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded.")},_createMuxMonitor:function(){this.videoElement=window.document.getElementById("video_"+this.vidContId);var t=this.cviModel,i=this.moduleParams,s=e.assign({page_type:"",viewer_user_id:t.getSessionOption("userId"),experiment_name:i&&!window.uvpjs.util.isEmpty(i.experimentName)?i.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||window.uvpjs.util.isEmpty(i.subPropertyId)?t.getSessionOption("partner"):i.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:t.initTime},this._getMuxVideoData());return this.useDefaultProperty?s.property_key=this.MUX_DEFAULT_PROPERTY_KEY:s.property_key=i.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:s}),this.videoElement.mux},_getMuxVideoData:function(){var t=this.cviModel.contentVideoState;return{video_id:this._validateStr(t.cmsRefGuid,""),video_title:this._validateStr(t.videoTitle,""),video_series:this._validateStr(t.seriesTitle,""),video_producer:"",video_content_type:t.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:t.duration,video_stream_type:t.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(t.cdn,""),video_source_url:this._validateStr(t.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(t){return window.uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_onContentEvent:function(t){t.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&window.uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(t){if(this.muxMonitor)switch(t.payload.facadeType){case this.mc.HLSJS:this.muxHLSJSMonitoring||(this.muxHLSJSMonitoring=!0,this.muxMonitor.addHLSJS({hlsjs:t.payload.player,Hls:window.Hls}));break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:t.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(t){var e=t.payload.errorInfo;e&&e.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:e.errorCode,player_error_message:e.message}))},_gatherModuleParams:function(t){var e,i=this.cviModel.getModule(t).params,s={};if(!i)return null;for(var n=i.length;n--;)s[(e=i[n]).name]=e.value;return s},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onContentEvent.bind(this),s=this._onPlaybackLibraryLoaded.bind(this),n=this._onError.bind(this),r=this._onAdEvent.bind(this);e[t.CONTENT_DATA_LOADED]=i,e[t.PLAYBACK_LIBRARY_LOADED]=s,e[t.PLAYER_START_ERROR]=n,e[t.VIDEO_START_ERROR]=n,e[t.VIDEO_PLAYBACK_ERROR]=n,e[t.AD_ERROR]=n,e[t.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=r,e[t.AD_PLUGIN_CONTENT_RESUME_REQUEST]=r,e[t.AD_LOADED]=r,e[t.AD_START]=r,e[t.VIDEO_STATE_CHANGE]=r,e[t.AD_SKIPPED]=r,e[t.AD_END]=r,e[t.AD_ERROR]=r,e[t.AD_REQUEST]=r,e[t.AD_RESPONSE]=r,e[t.AD_QUARTILE]=r,this.trackingMgr.registerEventCallbacks(e)},_getMuxAdData:function(t){var e=t.payload.adData?t.payload.adData.adAssetUrl:t.payload.adAssetUrl;return{ad_tag_url:t.payload.adCallUrl,ad_asset_url:e}},_dispatchMuxAdEvent:function(t,e){t&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),e||(e={ad_tag_url:"",ad_asset_url:""}),e.ad_tag_url||(e.ad_tag_url=""),e.ad_asset_url||(e.ad_asset_url=""),window.mux.emit(this.videoElement,t,e))},_dispatchMuxEvent:function(t){window.mux.emit(this.videoElement,t)},_onAdEvent:function(t){var e=this.eventTypes,i=this.MUX_AD_EVENTS,s=this.MUX_EVENTS;switch(t.type){case e.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===window.uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(s.PAUSE),this._dispatchMuxAdEvent(i.AD_BREAK_START);break;case e.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(i.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===window.uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(s.PLAY),this._dispatchMuxEvent(s.PLAYING));break;case e.AD_LOADED:this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t));break;case e.AD_START:this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t));break;case e.VIDEO_STATE_CHANGE:if(!t.payload.isAd)return;var n=t.payload.newState,r=t.payload.currentState;n===this.mc.PAUSED?this._dispatchMuxAdEvent(i.AD_PAUSE,this._getMuxAdData(t)):r==this.mc.PAUSED&&n===this.mc.PLAYING&&(this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t)),this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t)));break;case e.AD_SKIPPED:case e.AD_END:this._dispatchMuxAdEvent(i.AD_ENDED,this._getMuxAdData(t));break;case e.AD_ERROR:this._dispatchMuxAdEvent(i.AD_ERROR,this._getMuxAdData(t));break;case e.AD_REQUEST:this._dispatchMuxAdEvent(i.AD_REQUEST,this._getMuxAdData(t));break;case e.AD_RESPONSE:this._dispatchMuxAdEvent(i.AD_RESPONSE,this._getMuxAdData(t));break;case e.AD_QUARTILE:switch(t.payload.percent){case 25:this._dispatchMuxAdEvent(i.AD_FIRST_QUARTILE,this._getMuxAdData(t));break;case 50:this._dispatchMuxAdEvent(i.AD_MIDPOINT,this._getMuxAdData(t));break;case 75:this._dispatchMuxAdEvent(i.AD_THIRD_QUARTILE,this._getMuxAdData(t))}}}})}(window.uvpjs.register("uvpjs")),window.uvpjs.register("uvpjs").OzTamAgent=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==window.uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isStopped:!1,resumeTime:-1,init:function(t){this.options=t,this.ozTamVo=new window.uvpjs.OzTamVo(this);var e=this.ozTamVo.getConfig();this.ozTamService=new window.OzTAMService(e.publisherId,e.vendorVersion,e.productionMode,e.verboseLogging,e.useHTTPS),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ozTamService",e,this.ozTamService)},initialize:function(){var t=this.options.eventsMgr.eventTypes,e=this.onVideoEvent.bind(this),i={};i[t.RESOURCE_START]=e,i[t.CONTENT_START]=e,i[t.CONTROL_SEEK]=e,i[t.SEEK_DONE]=e,i[t.CONTENT_END]=e,i[t.VIDEO_STATE_CHANGE]=e,i[t.VIDEO_PROGRESS]=e,i[t.USER_GESTURE]=e,this.options.trackingMgr.registerEventCallbacks(i)},onVideoEvent:function(t){var e=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())this.debug&&window.uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out");else switch(t.type){case e.RESOURCE_START:this.onResourceStart(t);break;case e.CONTENT_START:this.onContentStart(t);break;case e.CONTROL_SEEK:this.onSeekStart(t);break;case e.SEEK_DONE:this.onSeekDone(t);break;case e.CONTENT_END:this.onContentEnd(t);break;case e.VIDEO_STATE_CHANGE:this.onVideoStateChange(t);break;case e.VIDEO_PROGRESS:this.onVideoProgress(t);break;case e.USER_GESTURE:this.onUserGesture(t)}},onResourceStart:function(t){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&window.uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(t){this.ozTamService.seekBegin()},onSeekDone:function(t){this.ozTamService.seekComplete(),this.isStopped=!0},onContentEnd:function(t){this.ozTamService.complete()},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case window.uvpjs.mediaCapabilities.PAUSED:case window.uvpjs.mediaCapabilities.BUFFERING:this.isStopped||(this.isStopped=!0,this.ozTamService.haltProgress())}},onVideoProgress:function(t){this.isStopped&&(this.isStopped=!1,this.ozTamService.resumeProgress())},onUserGesture:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"startTime",t.payload.startTime),t.payload.startTime>0&&(this.resumeTime=t.payload.startTime)},destroy:function(){this.ozTamVo.destroy(),this.DEBUG_ID=null,this.options=null,this.ozTamService=null,this.ozTamVo=null,this.mediaInfo=null}}),window.uvpjs.register("uvpjs").DatazoomAgent=window.uvpjs.TrackingAgent.subClass({metadata:{},init:function(t){this._super(t),this.vo=new window.uvpjs.DatazoomVo(this),this.sdkEvent=this.vo.Event,this.metadata={},(new window.uvpjs.CodeLoader).loadScript(this.vo.sdkUrl,this.onSdkReady.bind(this))},onSdkReady:function(){this.debug&&window.uvpjs.log(this.DEBUG_ID,"DatazoomAgent SDK Ready"),this.hasSdk="function"==typeof window.setDatazoomMetadata},sendTrackEvent:function(t,e){if(this.hasSdk){for(var i in this.debug&&window.uvpjs.log(this.DEBUG_ID,"DatazoomAgent "+t),e=e||{})this.metadata[i]=e[i];switch(t){case"content_start":window.setDatazoomMetadata(this.format(this.metadata));break;case"cdn_updated":window.generateDatazoomEvent("CDNChange",this.format(e));break;case"content_complete":this.metadata={}}}},format:function(t){var e=[];for(var i in t)if(t.hasOwnProperty(i)&&t[i]&&"object"!=typeof t[i]){var s={};s[i]=t[i],e.push(s)}return this.debug&&window.uvpjs.log(this.DEBUG_ID,"DatazoomAgent",e),e}}),window.uvpjs.register("uvpjs").DataModelVo=window.uvpjs.Class.subClass({agent:null,channelName:null,apiKey:null,contentInfo:{},getApiKey:function(){return this.apiKey},getPersistentData:function(t){var e=this.agent.options.cviModel,i=e&&e.getContentVideoState(),s=this.agent.contextMetadata;for(var n in(t=t||{}).sessionId=e&&e.sessionId,t.contentAssetId=i&&(i.cmsRefGuid||i.mediaId)||"",t.playheadTime=t.playheadTime||this.getPlayhead(),t.playerTime=this.getPlayerElapsedTime(),s)s.hasOwnProperty(n)&&(t[n]=s[n]);return t},getSessionStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,n=e.isLive?-1:window.isNaN(i)?0:i,r=this.getDrmInfo(e.drm);return this.getPersistentData({adAssetId:t.adVideoState.adClipID,adPodId:t.adVideoState.adVideoId||t.adVideoState.adVatId,adType:t.adVideoState.adType,allowConcurrentPlayback:t.sessionOptions.allowConcurrentPlayback,bitrate:s.currentBitrate,channel:this.channelName,cdn:e.cdn,cms:t.sessionOptions.cms,currentIndex:1,"drm.dash.playreadyURL":r.playreadyURL,"drm.dash.widevineURL":r.widevineURL,"drm.enabled":r.enabled,"drm.fairplay.appCertURL":r.appCertURL,"drm.ticket":r.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(e.drm),enableMutedAutoplay:t.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:t.sessionOptions.enableNativeMobileAutoplay,enableReplay:t.sessionOptions.enableReplay,enableUnmutedAutoplay:t.sessionOptions.enableUnmutedAutoplay,framerate:s.playbackFramerate,fullScreen:t.isFullscreen,isAutoplay:t.isAutoplay,isMultiCDN:t.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:t.isMuteAtPlayStart,isMuted:e.isMuted,isSslRequired:window.location.href.search(/^https/)>-1,length:n,livestream:e.isLive,liveSyncDurationCount:t.sessionOptions.liveSyncDurationCount,maxBitrate:t.maxBitrate,method:"",minBitrate:t.minBitrate,pageProvidesTealium:t.sessionOptions.usesTealium,pagetype:t.dwPageParams.pagetype,partner:t.sessionOptions.partner,pguid:t.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sound:t.volume,startTime:e.startTime,streamType:e.isLive?"Live":"VOD",title:e.videoTitle,totalLength:n,usesIMA:t.sessionOptions.usesIMA,userConnectionType:t.sessionOptions.userConnectionType,userCountry:t.sessionOptions.userCountry,userIsp:t.sessionOptions.userISP,userPpid:t.sessionOptions.userPPID,userStatus:t.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName})},getContentStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,n=e.isLive?-1:window.isNaN(i)?0:i;return this.contentInfo={assetUrl:e.assetURL,assetId:e.cmsRefGuid||e.mediaId,category:e.category,channel:this.channelName,chapterStartTimes:e.chapterStartTimes.join(","),closedCaptionPath:e.closedCaptionPath,cms:t.sessionOptions.cms,cmsRefGuid:e.cmsRefGuid,dfpMediaId:e.dfpMediaId,duration:n,episodeAbstract:e.episodeAbstract,episodeFlag:e.episodeFlag,episode:e.episodeNumber,excludeNielsenTracking:e.excludeNielsenTracking,fileType:e.fileType,genre:e.category,indexPosition:t.contentPlaybackState.currentContentSegment,is360:e.is360,isAffiliateFeed:e.isAffiliateFeed,isEmbedable:e.isEmbedable,isPaidContent:e.isPaidContent,mediaId:e.mediaId,overrideAssetURL:e.overrideAssetURL,program:e.videoTitle.split("-")[0],pguid:t.dwPageParams.pguid,playbackBitrate:s.currentBitrate,playheadTime:this.getContentStartPlayhead(),season:e.seasonNumber,seriesTitle:e.seriesTitle,showPreroll:e.showPreroll,startTime:e.startTime,useWatermark:e.useWatermark,title:e.videoTitle,totalLength:n},this.getPersistentData(this.contentInfo)},getContentCompleteInfo:function(){var t=this.agent.options.cviModel;return this.contentInfo.playbackBitrate=t.contentPlaybackState.facadeState.currentBitrate,this.getPersistentData(this.contentInfo)},getQuartileInfo:function(){return this.agent.options.cviModel.getContentVideoState(),this.getPersistentData()},getQosInfo:function(){var t=this.agent.options.cviModel,e=t.contentPlaybackState,i=t.contentPlaybackState.facadeState;return this.getPersistentData({averageDroppedFPS:e.averageDroppedFPS,bufferLength:e.bufferLength,currentContentSegment:e.currentContentSegment,currentMaxBandwidth:e.currentMaxBandwidth,currentTime:this.getPlayhead(),currentBitrate:i.currentBitrate,droppedFPS:i.droppedFPS,droppedFrames:i.droppedFrames,playbackFramerate:i.playbackFramerate})},getAdBreakInfo:function(){var t=this.agent.options.cviModel,e=t.adVideoState,i=e.adClipID.split("_"),s=1;return"post"===e.adType?s=t.getNumberOfAdPods():"mid"===e.adType&&(s=window.parseInt(i[1])+1),this.getPersistentData({indexPosition:s,startTime:this.getPlayhead(),title:e.adVideoTitle})},getAdItemInfo:function(){var t=this.agent.options.cviModel.adVideoState;return this.getPersistentData({adCallUrl:t.assetURL||t.adAssetUrl||t.adVideoUrl,adParams:t.adParameters,assetId:t.adVideoId||t.adVatId,indexPosition:t.adPosition,isCustomClickTrackingUsed:t.isCustomClickTrackingUsed,title:t.adVideoTitle,totalLength:t.duration})},getSeekInfo:function(){return this.getPersistentData({seekPosition:this.getPlayhead()})},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getContentStartPlayhead:function(){var t=this.getPlayhead();return this.agent.options.resumeTime&&this.agent.options.resumeTime>0&&(t=this.agent.options.resumeTime,this.agent.options.resumeTime=-1),t},getPlayerElapsedTime:function(){return window.parseInt((new Date-this.agent.initTime)/1e3)},getDrmInfo:function(t){return{playreadyURL:t.dash&&t.dash.playreadyURL?t.dash.playreadyURL:"",widevineURL:t.dash&&t.dash.widevineURL?t.dash.widevineURL:"",appCertURL:t.fairplay&&t.fairplay.appCertURL?t.fairplay.appCertURL:"",enabled:t.enabled||!1,ticket:t.ticket||""}},isCompletedMarker:function(){var t=this.agent.options.cviModel.getContentVideoState();return!t.isLive&&this.getPlayhead()>=.95*t.duration},destroy:function(){this.Event=null,this.agent=null,this.channelName=null,this.apiKey=null}}),window.uvpjs.register("uvpjs").DatazoomVo=window.uvpjs.DataModelVo.subClass({Event:{SESSION_START:"session_start",CONTENT_START:"content_start",CONTENT_COMPLETE:"content_complete",CDN_UPDATED:"cdn_updated",PAUSE:"pause",STOP:"stop",BUFFER_START:"buffer_start",BUFFER_COMPLETE:"buffer_complete",SEEK_START:"seek_start",SEEK_COMPLETE:"seek_complete",PLAY_RESUME:"resume",SESSION_END:"session_end",AD_BREAK_START:"ad_break_start",AD_BREAK_COMPLETE:"ad_break_end",AD_START:"ad_start",AD_COMPLETE:"ad_end",AD_CLICK:"ad_click",QOS:"qos",FIRST_QUARTILE:"first_quartile",MID_QUARTILE:"mid_quartile",THIRD_QUARTILE:"third_quartile"},sdkUrl:"//platform.datazoom.io/beacon/v1/config?configuration_id=",init:function(t){this.agent=t;var e=this.agent.options;this.getModuleParam=e.cviModel.getModuleParam.bind(e.cviModel,e.trackingMgr.DATAZOOM_MODULE_NAME),this.sdkUrl+=this.getModuleParam("configId")}}),window.uvpjs.register("uvpjs").OzTamVo=window.uvpjs.Class.subClass({agent:null,init:function(t){this.agent=t;var e=this.agent.options;this.getModuleParam=e.cviModel.getModuleParam.bind(e.cviModel,e.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.getVendorVersion(),productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:window.top.location.href.search(/^https/)>-1}},getVendorVersion:function(){return[this.getModuleParam("platform"),window.uvpjs.mediaCapabilities.isMobile()?"Mobile-Web":"Desktop-Web",this.agent.options.playerVersion].join("_")},getMediaInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=function(){var e=t.getCurrentPlaybackState().currentTime;return this.agent.resumeTime>0&&(e=this.agent.resumeTime,this.agent.resumeTime=-1),e}.bind(this);return{mediaId:e.ozTamMediaId||e.cmsRefGuid||e.mediaId,url:e.assetURL,mediaDuration:e.isLive?-1:window.isNaN(i)?0:i,mediaType:e.isLive?"live":"vod",mediaPositionFunction:function(){return s()}}},getPropertyDictionary:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=t.getSessionOption("userId"),s=this.agent.ozTamService,n={};return e.ozTamMediaId&&(n[s.PROP_ALT_MEDIA_ID]=e.cmsRefGuid||e.mediaId),i&&(n[s.PROP_DEMO1]=i),n},isOzTamOptOut:function(){var t=this.agent.options.cviModel.getContentVideoState();return t.hasOwnProperty("ozTamOptOut")&&t.ozTamOptOut},getValue:function(t){return t.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}}),function(t){var e={prodUrl:"//sparrow.cbs.com",stageUrl:"//stage-sparrow.cbs.com",path:"/streamer/v1.0/ingest/beacon.json"},i=!1,s=null,n=null,r=function(t){return(t=t.replace(/\s/g,"")).search(/^\/\//)>-1?t:"//"+t};t.BeaconBuilder=window.uvpjs.Class.subClass({concurrencyBeacon:function(t){return n=e,t&&t.prodUrl&&t.stageUrl&&(n.prodUrl=r(t.prodUrl),n.stageUrl=r(t.stageUrl)),this},queryParams:function(e){return s=t.util.queryStrFromObj(e,!1),this},devMode:function(t){return i=t,this},buildUrl:function(){return null===n?"Unable to build url.":(i?n.stageUrl:n.prodUrl)+n.path+(null===s?"":"?"+s)}})}(window.uvpjs.register("uvpjs")),function(t){var e=t._;t.FairPlayDRM=window.uvpjs.Class.subClass({DEBUG_ID:window.uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(t){this.debug=window.uvpjs.debug,this.debug&&window.uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=t.drm,this.videoTagRef=t.videoTagRef,this.eventTypes=t.eventTypes,this.errorCallback=t.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destroy:function(){this.removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var t=this.getLicenseServerUrl(this.initData),e=this.getId(t);if(this.drmVendor=this.getDRMVendor(t),e){if(!this.videoTagRef.webkitKeys){var i=this.KEY_SYSTEMS.FPS_1_0;if(!window.WebKitMediaKeys.isTypeSupported(i,"video/mp4"))return void this.onError(window.uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new window.WebKitMediaKeys(i))}if(this.videoTagRef.webkitKeys){var s=this.concatInitDataIdAndCertificate(this.initData,e,this.appCertData),n=this.videoTagRef.webkitKeys.createSession("video/mp4",s);n?(n.contentId=e,n.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,t),!1),n.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),n.addEventListener("webkitkeyerror",this.onError.bind(this,window.uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)):this.onError(window.uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null)}else this.onError(window.uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null)}else this.onError(window.uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null)},loadAppCert:function(){e.isEmpty(this.drm.fairplay.appCertURL)||(new window.uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,window.uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",t),this.appCertData=new Uint8Array(t.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(t){this.webKitNeedKeyCalled=!0,this.initData=t.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(t,e,i){"string"==typeof e&&(e=this.stringToArray(e));var s=0,n=new ArrayBuffer(t.byteLength+4+e.byteLength+4+i.byteLength),r=new window.DataView(n);new Uint8Array(n,s,t.byteLength).set(t),s+=t.byteLength,r.setUint32(s,e.byteLength,!0),s+=4;var a=new Uint8Array(n,s,e.byteLength);return a.set(e),s+=a.byteLength,r.setUint32(s,i.byteLength,!0),s+=4,new Uint8Array(n,s,i.byteLength).set(i),new Uint8Array(n,0,n.byteLength)},onLicenseRequestReady:function(t,e){this.debug&&window.uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+t,e);var i=new XMLHttpRequest;i.session=e.target,i.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),i.addEventListener("error",this.onError.bind(this,window.uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),i.open("POST",t,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?i.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(i.responseType="text");var s="spc="+window.encodeURIComponent(this.base64EncodeUint8Array(e.message))+"&"+i.session.contentId;(i=this.setRequestHeaders(i)).send(s)},onLicenseRequestLoaded:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",t);var i=t.target,s=i.session,n=null;e.inRange(i.status,200,400)||this.onError(window.uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,t),this.drmVendor===this.DRM_VENDORS.DRMTODAY?n=this.base64DecodeUint8Array(i.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(n=new Uint8Array(i.response)),s.update(n)},onError:function(t,e){this.debug&&window.uvpjs.error(this.DEBUG_ID,t,e),this.errorCallback&&this.errorCallback(window.uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,t)},onKeyAdded:function(t){this.debug&&window.uvpjs.log(this.DEBUG_ID,"FairPlayDRM key was added successfully!",t)},getLicenseServerUrl:function(t){var i=null;return i=e.isEmpty(this.drm.fairplay.licenseURL)?"https://"+String.fromCharCode.apply(null,new Uint16Array(t.buffer)).split("://")[1]:this.drm.fairplay.licenseURL,this.appendDRMQueryParams(i)},appendDRMQueryParams:function(t){var e=-1===t.indexOf("?")?"?":"&";return this.drm.sessionId&&(t+=e+"SessionId="+this.drm.sessionId),this.drm.ticket&&(t+="&Ticket="+this.drm.ticket),t},getDRMVendor:function(t){var e=null;return-1!==t.indexOf(this.DRM_VENDORS.DRMTODAY)?e=this.DRM_VENDORS.DRMTODAY:-1!==t.indexOf(this.DRM_VENDORS.IRDETO)&&(e=this.DRM_VENDORS.IRDETO),e},setRequestHeaders:function(t){if(t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!e.isEmpty(this.drm.fairplay.header)){var i=this.drm.fairplay.header;for(var s in i)t.setRequestHeader(s,i[s])}return t},getId:function(t){var e=window.uvpjs.util.objFromQueryStr(t);return e.ContentId||e.contentId||e.assetId||null},base64EncodeUint8Array:function(t){var e=String.fromCharCode.apply(null,t);return window.btoa(e)},base64DecodeUint8Array:function(t){var e=window.atob(t),s=e.length,n=new Uint8Array(new ArrayBuffer(s));for(window.i=0;window.i<s;window.i++)n[window.i]=e.charCodeAt(window.i);return n},stringToArray:function(t){for(var e=new ArrayBuffer(2*t.length),i=new Uint16Array(e),s=0,n=t.length;s<n;s++)i[s]=t.charCodeAt(s);return i}})}(window.uvpjs.register("uvpjs"))}(),window.define("uvp/uvp-3.0.0",function(){}),window.define("third-party/tealium",[],function(){window.CBSNEWS.features.executeWithConsent(["tealium"],"essential",function(){window.require([window.CBSNEWS.tealiumPath])},this)}),window.define("third-party/dai",[],function(){window.CBSNEWS.features.adsDAIloaded=null,window.CBSNEWS.features.executeIfEnabled(["ads","adsDAI"],function(){window.CBSNEWS.features.adsDAIloaded=!1,window.require(["https://imasdk.googleapis.com/js/sdkloader/ima3_dai.js#"],function(){window.CBSNEWS.features.adsDAIloaded=!0})},this)}),window.define("third-party/ima",[],function(){window.CBSNEWS.features.adsIMAloaded=null,window.CBSNEWS.features.executeIfEnabled(["ads","adsIMA"],function(){window.CBSNEWS.features.adsIMAloaded=!1,window.require(["https://imasdk.googleapis.com/js/sdkloader/ima3.js#"],function(){window.CBSNEWS.features.adsIMAloaded=!0})},this)}),window.define("uvp",["uvp/uvp-3.0.0","third-party/tealium","third-party/dai","third-party/ima"],function(){}),window.require(["polyfill!fetch","polyfill!window.CustomEvent","polyfill!element.closest","polyfill!object.assign","uvp"]),window.define("video/common",function(){}),window.define("video/main-embed",[],function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=95)}([function(t,e,i){
/* Riot v3.13.1, @license MIT */
!function(t){"use strict";function e(t,e){return(e||window.document).querySelector(t)}var i,s,n=[],r={},a="yield",o="__global_mixin",l="riot-",d=["ref","data-ref"],u="data-is",h="if",c="each",p="no-reorder",f="show",v="hide",g="key",_="__riot-events__",E="string",m="object",A="undefined",y="function",S="http://www.w3.org/1999/xlink",b="http://www.w3.org/2000/svg",T=/^xlink:(\w+)/,D=typeof window===A?void 0:window,I=/^on/,C=/([-\w]+) ?= ?(?:"([^"]*)|'([^']*)|({[^}]*}))/g,R={viewbox:"viewBox",preserveaspectratio:"preserveAspectRatio"},P=/^(?:disabled|checked|readonly|required|allowfullscreen|auto(?:focus|play)|compact|controls|default|formnovalidate|hidden|ismap|itemscope|loop|multiple|muted|no(?:resize|shade|validate|wrap)?|open|reversed|seamless|selected|sortable|truespeed|typemustmatch)$/,M=0|(D&&D.document||{}).documentMode;function O(t){return"svg"===t?window.document.createElementNS(b,t):window.document.createElement(t)}function L(t,e,i){var s=T.exec(e);s&&s[1]?t.setAttributeNS(S,s[1],i):t.setAttribute(e,i)}var N={},k=!1;D&&(i=function(){var t=O("style"),i=e("style[type=riot]");return L(t,"type","text/css"),i?(i.id&&(t.id=i.id),i.parentNode.replaceChild(t,i)):window.document.head.appendChild(t),t}(),s=i.styleSheet);var w={styleNode:i,add:function(t,e){N[e]=t,k=!0},inject:function(){if(D&&k){k=!1;var t=Object.keys(N).map(function(t){return N[t]}).join("\n");s?s.cssText=t:i.innerHTML=t}},remove:function(t){delete N[t],k=!0}},U=function(){var t=["case","default","do","else","in","instanceof","prefix","return","typeof","void","yield"],e=t.reduce(function(t,e){return t+e.slice(-1)},""),i=/^\/(?=[^*>\/])[^[\/\\]*(?:(?:\\.|\[(?:\\.|[^\]\\]*)*\])[^[\\\/]*)*?\/[gimuy]*/,s=/[$\w]/;function n(t,e){for(;--e>=0&&/\s/.test(t[e]););return e}return function(r,a){var o=/.*/g,l=o.lastIndex=a++,d=o.exec(r)[0].match(i);if(d){var u=l+d[0].length,h=r[l=n(r,l)];if(l<0||~"[{(,;:?=|&!^~>%*/".indexOf(h))return u;if("."===h)"."===r[l-1]&&(a=u);else if("+"===h||"-"===h)(r[--l]!==h||(l=n(r,l))<0||!s.test(r[l]))&&(a=u);else if(~e.indexOf(h)){for(var c=l+1;--l>=0&&s.test(r[l]););~t.indexOf(r.slice(l+1,c))&&(a=u)}}return a}}(),B=function(t){var e,i,s="g",n=/"[^"\\]*(?:\\[\S\s][^"\\]*)*"|'[^'\\]*(?:\\[\S\s][^'\\]*)*'|`[^`\\]*(?:\\[\S\s][^`\\]*)*`/g,r=n.source+"|"+/(?:\breturn\s+|(?:[$\w\)\]]|\+\+|--)\s*(\/)(?![*\/]))/.source+"|"+/\/(?=[^*\/])[^[\/\\]*(?:(?:\[(?:\\.|[^\]\\]*)*\]|\\.)[^[\/\\]*)*?([^<]\/)[gim]*/.source,a=RegExp("[\\x00-\\x1F<>a-zA-Z0-9'\",;\\\\]"),o=/(?=[[\]()*+?.^$|])/g,l=n.source+"|"+/(\/)(?![*\/])/.source,d={"(":RegExp("([()])|"+l,s),"[":RegExp("([[\\]])|"+l,s),"{":RegExp("([{}])|"+l,s)},u="{ }",h=["{","}","{","}",/{[^}]*}/,/\\([{}])/g,/\\({)|{/g,RegExp("\\\\(})|([[({])|(})|"+l,s),u,/^\s*{\^?\s*([$\w]+)(?:\s*,\s*(\S+))?\s+in\s+(\S.*)\s*}/,/(^|[^\\]){=[\S\s]*?}/],c=void 0,p=[];function f(t){return t}function v(t,e){return e||(e=p),new RegExp(t.source.replace(/{/g,e[2]).replace(/}/g,e[3]),t.global?s:"")}function g(t){if(t===u)return h;var e=t.split(" ");if(2!==e.length||a.test(t))throw new Error('Unsupported brackets "'+t+'"');return(e=e.concat(t.replace(o,"\\").split(" ")))[4]=v(e[1].length>1?/{[\S\s]*?}/:h[4],e),e[5]=v(t.length>3?/\\({|})/g:h[5],e),e[6]=v(h[6],e),e[7]=RegExp("\\\\("+e[3]+")|([[({])|("+e[3]+")|"+l,s),e[8]=t,e}function _(t){return t instanceof RegExp?e(t):p[t]}function E(t){(t||(t=u))!==p[8]&&(p=g(t),e=t===u?f:v,p[9]=e(h[9])),c=t}return _.split=function(t,e,i){i||(i=p);var s,n,r,a,o,l,u=[],h=i[6],c=[],f="";for(n=r=h.lastIndex=0;s=h.exec(t);){if(l=h.lastIndex,a=s.index,n){if(s[2]){var v=s[2],g=d[v],_=1;for(g.lastIndex=l;s=g.exec(t);)if(s[1]){if(s[1]===v)++_;else if(!--_)break}else g.lastIndex=m(s.index,g.lastIndex,s[2]);h.lastIndex=_?t.length:g.lastIndex;continue}if(!s[3]){h.lastIndex=m(a,l,s[4]);continue}}s[1]||(E(t.slice(r,a)),r=h.lastIndex,(h=i[6+(n^=1)]).lastIndex=r)}return t&&r<t.length&&E(t.slice(r)),u.qblocks=c,u;function E(t){f&&(t=f+t,f=""),e||n?u.push(t&&t.replace(i[5],"$1")):u.push(t)}function m(i,s,n){return n&&(s=U(t,i)),e&&s>i+2&&(o="⁗"+c.length+"~",c.push(t.slice(i,s)),f+=t.slice(r,i)+o,r=s),s}},_.hasExpr=function(t){return p[4].test(t)},_.loopKeys=function(t){var e=t.match(p[9]);return e?{key:e[1],pos:e[2],val:p[0]+e[3].trim()+p[1]}:{val:t.trim()}},_.array=function(t){return t?g(t):p},Object.defineProperty(_,"settings",{set:function(t){var e;e=(t=t||{}).brackets,Object.defineProperty(t,"brackets",{set:E,get:function(){return c},enumerable:!0}),i=t,E(e)},get:function(){return i}}),_.settings="undefined"!=typeof window.riot&&window.riot.settings||{},_.set=E,_.skipRegex=U,_.R_STRINGS=n,_.R_MLCOMMS=/\/\*[^*]*\*+(?:[^*\/][^*]*\*+)*\//g,_.S_QBLOCKS=r,_.S_QBLOCK2=l,_}(),j=function(){var t={};function e(n,r){return n?(t[n]||(t[n]=function(t){var e=function(t){var e,n=B.split(t.replace(i,'"'),1),r=n.qblocks;if(n.length>2||n[0]){var o,l,d=[];for(o=l=0;o<n.length;++o)(e=n[o])&&(e=1&o?a(e,1,r):'"'+e.replace(/\\/g,"\\\\").replace(/\r\n?|\n/g,"\\n").replace(/"/g,'\\"')+'"')&&(d[l++]=e);e=l<2?d[0]:"["+d.join(",")+'].join("")'}else e=a(n[1],0,r);return r.length&&(e=e.replace(s,function(t,e){return r[e].replace(/\r/g,"\\r").replace(/\n/g,"\\n")})),e}(n);return"try{return "!==e.slice(0,11)&&(e="return "+e),new Function("E",e+";")}())).call(r,function(t,i){t.riotData={tagName:i&&i.__&&i.__.tagName,_riot_id:i&&i._riot_id},e.errorHandler?e.errorHandler(t):"undefined"!=typeof console&&"function"==typeof console.error&&(console.error(t.message),console.log("<%s> %s",t.riotData.tagName||"Unknown tag",this.tmpl),console.log(this.data))}.bind({data:r,tmpl:n})):n}e.hasExpr=B.hasExpr,e.loopKeys=B.loopKeys,e.clearCache=function(){t={}},e.errorHandler=null;var i=/\u2057/g,s=/\u2057(\d+)~/g,n=/^(?:(-?[_A-Za-z\xA0-\xFF][-\w\xA0-\xFF]*)|\u2057(\d+)~):/,r={"(":/[()]/g,"[":/[[\]]/g,"{":/[{}]/g};function a(t,e,i){if(t=t.replace(/\s+/g," ").trim().replace(/\ ?([[\({},?\.:])\ ?/g,"$1")){for(var s,a=[],o=0;t&&(s=t.match(n))&&!s.index;){var l,d,h=/,|([[{(])|$/g;for(t=RegExp.rightContext,l=s[2]?i[s[2]].slice(1,-1).trim().replace(/\s+/g," "):s[1];d=(s=h.exec(t))[1];)c(d,h);d=t.slice(0,s.index),t=RegExp.rightContext,a[o++]=u(d,1,l)}t=o?o>1?"["+a.join(",")+'].join(" ").trim()':a[0]:u(t,e)}return t;function c(e,i){var s,n=1,a=r[e];for(a.lastIndex=i.lastIndex;s=a.exec(t);)if(s[0]===e)++n;else if(!--n)break;i.lastIndex=n?t.length:a.lastIndex}}var o='"in this?this:'+("object"!=typeof window?"global":"window")+").",l=/[,{][\$\w]+(?=:)|(^ *|[^$\w\.{])(?!(?:typeof|true|false|null|undefined|in|instanceof|is(?:Finite|NaN)|void|NaN|new|Date|RegExp|Math)(?![$\w]))([$_A-Za-z][$\w]*)/g,d=/^(?=(\.[$\w]+))\1(?:[^.[(]|$)/;function u(t,e,i){var s;return t=t.replace(l,function(t,e,i,n,r){return i&&(n=s?0:n+t.length,"this"!==i&&"global"!==i&&"window"!==i?(t=e+'("'+i+o+i,n&&(s="."===(r=r[n])||"("===r||"["===r)):n&&(s=!d.test(r.slice(n)))),t}),s&&(t="try{return "+t+"}catch(e){E(e,this)}"),i?t=(s?"function(){"+t+"}.call(this)":"("+t+")")+'?"'+i+'":""':e&&(t="function(v){"+(s?t.replace("return ","v="):"v=("+t+")")+';return v||v===0?v:""}.call(this)'),t}return e.version=B.version="v3.0.8",e}(),F=function(t){t=t||{};var e={},i=Array.prototype.slice;return Object.defineProperties(t,{on:{value:function(i,s){return"function"==typeof s&&(e[i]=e[i]||[]).push(s),t},enumerable:!1,writable:!1,configurable:!1},off:{value:function(i,s){if("*"!=i||s)if(s)for(var n,r=e[i],a=0;n=r&&r[a];++a)n==s&&r.splice(a--,1);else delete e[i];else e={};return t},enumerable:!1,writable:!1,configurable:!1},one:{value:function(e,i){return t.on(e,function s(){t.off(e,s),i.apply(t,arguments)})},enumerable:!1,writable:!1,configurable:!1},trigger:{value:function(s){var n,r,a,o=arguments,l=arguments.length-1,d=new Array(l);for(a=0;a<l;a++)d[a]=o[a+1];for(n=i.call(e[s]||[],0),a=0;r=n[a];++a)r.apply(t,d);return e["*"]&&"*"!=s&&t.trigger.apply(t,["*",s].concat(d)),t},enumerable:!1,writable:!1,configurable:!1}}),t};function x(t,e){return Object.getOwnPropertyDescriptor(t,e)}function G(t){return typeof t===A}function V(t,e){var i=x(t,e);return G(t[e])||i&&i.writable}function H(t){for(var e,i=1,s=arguments,n=s.length;i<n;i++)if(e=s[i])for(var r in e)V(t,r)&&(t[r]=e[r]);return t}function W(t){return Object.create(t)}var K=H(W(B.settings),{skipAnonymousTags:!0,keepValueAttributes:!1,autoUpdate:!0});function z(t,e){return[].slice.call((e||window.document).querySelectorAll(t))}function Y(){return window.document.createTextNode("")}function q(t,e){t.style.display=e?"":"none",t.hidden=!e}function X(t,e){return t.getAttribute(e)}function J(t,e){t.removeAttribute(e)}function Q(t,e,i){if(i){var s=t.ownerDocument.importNode((new DOMParser).parseFromString('<svg xmlns="'+b+'">'+e+"</svg>","application/xml").documentElement,!0);t.appendChild(s)}else t.innerHTML=e}function Z(t,e){if(t)for(var i;i=C.exec(t);)e(i[1].toLowerCase(),i[2]||i[3]||i[4])}function $(){return window.document.createDocumentFragment()}function tt(t,e,i){t.insertBefore(e,i.parentNode&&i)}function et(t){return Object.keys(t).reduce(function(e,i){return e+" "+i+": "+t[i]+";"},"")}function it(t,e,i){if(t){var s,n=e(t,i);if(!1===n)return;for(t=t.firstChild;t;)s=t.nextSibling,it(t,e,n),t=s}}var st=Object.freeze({$$:z,$:e,createDOMPlaceholder:Y,mkEl:O,setAttr:L,toggleVisibility:q,getAttr:X,remAttr:J,setInnerHTML:Q,walkAttrs:Z,createFrag:$,safeInsert:tt,styleObjectToString:et,walkNodes:it});function nt(t){return G(t)||null===t}function rt(t){return nt(t)||""===t}function at(t){return typeof t===y}function ot(t){return t&&typeof t===m}function lt(t){var e=t.ownerSVGElement;return!!e||null===e}function dt(t){return Array.isArray(t)||t instanceof Array}function ut(t){return P.test(t)}function ht(t){return typeof t===E}var ct=Object.freeze({isBlank:rt,isFunction:at,isObject:ot,isSvg:lt,isWritable:V,isArray:dt,isBoolAttr:ut,isNil:nt,isString:ht,isUndefined:G});function pt(t,e){return-1!==t.indexOf(e)}function ft(t,e){for(var i=t?t.length:0,s=0;s<i;s++)e(t[s],s);return t}function vt(t,e){return t.slice(0,e.length)===e}var gt=function(){var t=-1;return function(){return++t}}();function _t(t,e,i,s){return Object.defineProperty(t,e,H({value:i,enumerable:!1,writable:!1,configurable:!0},s)),t}function Et(t){return t.replace(/-(\w)/g,function(t,e){return e.toUpperCase()})}function mt(t){console&&console.warn&&console.warn(t)}var At=Object.freeze({contains:pt,each:ft,getPropDescriptor:x,startsWith:vt,uid:gt,defineProperty:_t,objectCreate:W,extend:H,toCamel:Et,warn:mt});function yt(t,e,i,s,n){var r=t[e],a=dt(r),o=!G(n);if(!r||r!==i)if(!r&&s)t[e]=[i];else if(r)if(a){var l=r.indexOf(i);if(l===n)return;-1!==l&&r.splice(l,1),o?r.splice(n,0,i):r.push(i)}else t[e]=[r,i];else t[e]=i}function St(t){return t.tagName&&r[X(t,u)||X(t,u)||t.tagName.toLowerCase()]}function bt(t,e){var i=St(t),s=!e&&X(t,u);return s&&!j.hasExpr(s)?s:i?i.name:t.tagName.toLowerCase()}function Tt(){return this.parent?H(W(this),this.parent):this}var Dt=/<yield\b/i,It=/<yield\s*(?:\/>|>([\S\s]*?)<\/yield\s*>|>)/gi,Ct=/<yield\s+to=['"]([^'">]*)['"]\s*>([\S\s]*?)<\/yield\s*>/gi,Rt=/<yield\s+from=['"]?([-\w]+)['"]?\s*(?:\/>|>([\S\s]*?)<\/yield\s*>)/gi,Pt={tr:"tbody",th:"tr",td:"tr",col:"colgroup"},Mt=M&&M<10?/^(?:t(?:body|head|foot|[rhd])|caption|col(?:group)?|opt(?:ion|group))$/:/^(?:t(?:body|head|foot|[rhd])|caption|col(?:group)?)$/,Ot="div",Lt="svg";function Nt(t,i,s){var n=t&&t.match(/^\s*<([-\w]+)/),r=n&&n[1].toLowerCase(),a=O(s?Lt:Ot);return t=function(t,e){if(!Dt.test(t))return t;var i={};return e=e&&e.replace(Ct,function(t,e,s){return i[e]=i[e]||s,""}).trim(),t.replace(Rt,function(t,e,s){return i[e]||s||""}).replace(It,function(t,i){return e||i||""})}(t,i),Mt.test(r)?a=function(t,i,s){var n="o"===s[0],r=n?"select>":"table>";if(t.innerHTML="<"+r+i.trim()+"</"+r,r=t.firstChild,n)r.selectedIndex=-1;else{var a=Pt[s];a&&1===r.childElementCount&&(r=e(a,r))}return r}(a,t,r):Q(a,t,s),a}var kt=/^on/;function wt(t){for(var e=t;e.__.isAnonymous&&e.parent;)e=e.parent;return e}function Ut(t,e,i,s){var n,r=function(t,e,i){var s=this.__.parent,n=this.__.item;if(!n)for(;s&&!n;)n=s.__.item,s=s.__.parent;if(V(i,"currentTarget")&&(i.currentTarget=t),V(i,"target")&&(i.target=i.srcElement),V(i,"which")&&(i.which=i.charCode||i.keyCode),i.item=n,e.call(this,i),K.autoUpdate&&!i.preventUpdate){var r=wt(this);r.isMounted&&r.update()}}.bind(s,i,e);i[t]=null,n=t.replace(I,""),pt(s.__.listeners,i)||s.__.listeners.push(i),i[_]||(i[_]={}),i[_][t]&&i.removeEventListener(n,i[_][t]),i[_][t]=r,i.addEventListener(n,r,!1)}function Bt(t,e,i,s){var n=ve(t,e,i),r=e.tagName||bt(e.root,!0),a=wt(s);return _t(n,"parent",a),n.__.parent=s,yt(a.tags,r,n),a!==s&&yt(s.tags,r,n),n}function jt(t,e,i,s){if(dt(t[e])){var n=t[e].indexOf(i);-1!==n&&t[e].splice(n,1),t[e].length?1!==t[e].length||s||(t[e]=t[e][0]):delete t[e]}else t[e]===i&&delete t[e]}function Ft(t,e){var i,s,n=Y(),r=Y(),a=$();for(this.root.insertBefore(n,this.root.firstChild),this.root.appendChild(r),this.__.head=s=n,this.__.tail=r;s;)i=s.nextSibling,a.appendChild(s),this.__.virts.push(s),s=i;e?t.insertBefore(a,e.__.head):t.appendChild(a)}function xt(t,e){if(e.parentNode){var i=$();Ft.call(t,i),e.parentNode.replaceChild(i,e)}}function Gt(t){if(!this.root||!X(this.root,"virtualized")){var e,i=t.dom,s=function(t){return t?(t=t.replace(l,""),R[t]&&(t=R[t]),t):null}(t.attr),n=pt([f,v],s),a=t.root&&"VIRTUAL"===t.root.tagName,o=this.__.isAnonymous,d=i&&(t.parent||i.parentNode),u=K.keepValueAttributes,h="style"===s,c="class"===s,p="value"===s;if(t._riot_id)t.__.wasCreated?t.update():(t.mount(),a&&xt(t,t.root));else{if(t.update)return t.update();var g=n&&!o?Tt.call(this):this,_=!rt(e=j(t.expr,g)),E=ot(e);if(E&&(c?e=j(JSON.stringify(e),this):h&&(e=et(e))),!t.attr||t.wasParsedOnce&&!1!==e&&(_||p&&(!p||u))||J(i,X(i,t.attr)?t.attr:s),t.bool&&(e=!!e&&s),t.isRtag)return function(t,e,i){var s,n=t.tag||t.dom._tag,a=(n?n.__:{}).head,o="VIRTUAL"===t.dom.tagName;n&&t.tagName===i?n.update():(n&&(o&&(s=Y(),a.parentNode.insertBefore(s,a)),n.unmount(!0)),ht(i)&&(t.impl=r[i],t.impl&&(t.tag=n=Bt(t.impl,{root:t.dom,parent:e,tagName:i},t.dom.innerHTML,e),ft(t.attrs,function(t){return L(n.root,t.name,t.value)}),t.tagName=i,n.mount(),o&&xt(n,s||n.root),e.__.onUnmount=function(){var t=n.opts.dataIs;jt(n.parent.tags,t,n),jt(n.__.parent.tags,t,n),n.unmount()})))}(t,this,e);if((!t.wasParsedOnce||t.value!==e)&&(t.value=e,t.wasParsedOnce=!0,!E||c||h||n)){if(_||(e=""),!s)return e+="",void(d&&(t.parent=d,"TEXTAREA"===d.tagName?(d.value=e,M||(i.nodeValue=e)):i.nodeValue=e));switch(!0){case at(e):(function(t){return kt.test(t)})(s)&&Ut(s,e,i,this);break;case n:q(i,s===v?!e:e);break;default:t.bool&&(i[s]=e),p&&i.value!==e?i.value=e:_&&!1!==e&&L(i,s,e),h&&i.hidden&&q(i,!1)}}}}}function Vt(t){ft(t,Gt.bind(this))}function Ht(t,e,i,s,n){if(!t||!i){var r=t?Tt.call(this):e||this;ft(n,function(t){t.expr&&Gt.call(r,t.expr),s[Et(t.name).replace(l,"")]=t.expr?t.expr.value:t.value})}}function Wt(t){if(!t){var e=Object.keys(r);return e+Wt(e)}return t.filter(function(t){return!/[^-\w]/.test(t)}).reduce(function(t,e){var i=e.trim().toLowerCase();return t+",["+u+'="'+i+'"]'},"")}function Kt(t,e){var i=this.name,s=this.tmpl,n=this.css,a=this.attrs,o=this.onCreate;return r[i]||(zt(i,s,n,a,o),r[i].class=this.constructor),ge(t,i,e,this),n&&w.inject(),this}function zt(t,e,i,s,n){return at(s)&&(n=s,/^[\w-]+\s?=/.test(i)?(s=i,i=""):s=""),i&&(at(i)?n=i:w.add(i,t)),t=t.toLowerCase(),r[t]={name:t,tmpl:e,attrs:s,fn:n},t}function Yt(t,e,i,s,n){return i&&w.add(i,t),r[t]={name:t,tmpl:e,attrs:s,fn:n},t}function qt(t,e,i){var s,n,r=[];if(w.inject(),(ot(e)||at(e))&&(i=e,e=0),ht(t)?s=(t="*"===t?n=Wt():t+Wt(t.split(/, */)))?z(t):[]:s=t,"*"===e){if(e=n||Wt(),s.tagName)s=z(e,s);else{var a=[];ft(s,function(t){return a.push(z(e,t))}),s=a}e=0}return function t(s){if(s.tagName){var n,a=X(s,u);e&&a!==e&&(a=e,L(s,u,e)),(n=ge(s,a||s.tagName.toLowerCase(),at(i)?i():i))&&r.push(n)}else s.length&&ft(s,t)}(s),r}var Xt={},Jt=Xt[o]={},Qt=0;function Zt(t,e,i){if(ot(t))Zt("__"+Qt+++"__",t,!0);else{var s=i?Jt:Xt;if(!e){if(G(s[t]))throw new Error("Unregistered mixin: "+t);return s[t]}s[t]=at(e)?H(e.prototype,s[t]||{})&&e:H(s[t]||{},e)}}function $t(){return ft(n,function(t){return t.update()})}function te(t){return w.remove(t),delete r[t]}var ee=Object.freeze({Tag:Kt,tag:zt,tag2:Yt,mount:qt,mixin:Zt,update:$t,unregister:te,version:"v3.13.1"});function ie(t,e){var i,s=this.parent;s&&(dt(i=s.tags[t])?i.splice(e,0,i.splice(i.indexOf(this),1)[0]):yt(s.tags,t,this))}function se(t,e){for(var i,s=this.__.head,n=$();s;)if(i=s.nextSibling,n.appendChild(s),(s=i)===this.__.tail){n.appendChild(s),t.insertBefore(n,e.__.head);break}}function ne(t,e,i){var s={};return s[t.key]=e,t.pos&&(s[t.pos]=i),s}function re(t,e){t.splice(e,1),this.unmount(),jt(this.parent,this,this.__.tagName,!0)}function ae(t,e,i){var s=typeof X(t,p)!==E||J(t,p),n=X(t,g),a=!!n&&j.hasExpr(n),o=bt(t),l=r[o],d=t.parentNode,u=Y(),f=St(t),v=X(t,h),_=[],A=t.innerHTML,y=!r[o],S="VIRTUAL"===t.tagName,b=[];return J(t,c),J(t,g),(i=j.loopKeys(i)).isLoop=!0,v&&J(t,h),d.insertBefore(u,t),d.removeChild(t),i.update=function(){i.value=j(i.val,e);var r=i.value,d=$(),h=!dt(r)&&!ht(r),c=u.parentNode,p=[],g=h&&!!r;if(c){h&&(r=r?Object.keys(r).map(function(t){return ne(i,r[t],t)}):[]);var E=0;ft(r,function(u,T){var D=T-E,I=!g&&i.key?ne(i,u,T):u;if(!v||j(v,H(W(e),I))){var C=function(t,e,i,s){return t?a?j(t,I):e[t]:e}(n,u),R=!h&&s&&typeof u===m||n,P=b.indexOf(C),M=-1===P,O=!M&&R?P:D,L=_[O],N=D>=b.length,k=R&&M||!R&&!L||!_[D];k?((L=ve(l,{parent:e,isLoop:!0,isAnonymous:y,tagName:o,root:t.cloneNode(y),item:I,index:D},A)).mount(),N?function(t,e){e?Ft.call(this,t):t.appendChild(this.root)}.apply(L,[d||c,S]):function(t,e,i){i?Ft.apply(this,[t,e]):tt(t,this.root,e.root)}.apply(L,[c,_[D],S]),N||b.splice(D,0,I),_.splice(D,0,L),f&&yt(e.tags,o,L,!0)):O!==D&&R&&((n||pt(r,b[O]))&&(function(t,e,i){i?se.apply(this,[t,e]):tt(t,this.root,e.root)}.apply(L,[c,_[D],S]),_.splice(D,0,_.splice(O,1)[0]),b.splice(D,0,b.splice(O,1)[0])),i.pos&&(L[i.pos]=D),!f&&L.tags&&function(t){var e=this;ft(Object.keys(this.tags),function(i){ie.apply(e.tags[i],[i,t])})}.call(L,D)),H(L.__,{item:I,index:D,parent:e}),p[D]=C,k||L.update(I)}else E++}),function(t,e,i){for(var s=e.length,n=t.length-i;s>n;)s--,re.apply(e[s],[e,s])}(r,_,E),b=p.slice(),c.insertBefore(d,u)}},i.unmount=function(){ft(_,function(t){t.unmount()})},i}var oe={init:function(t,e,i,s){return this.dom=t,this.attr=i,this.rawValue=s,this.parent=e,this.hasExp=j.hasExpr(s),this},update:function(){var t=this.value,e=this.parent&&wt(this.parent),i=this.dom.__ref||this.tag||this.dom;this.value=this.hasExp?j(this.rawValue,this.parent):this.rawValue,!rt(t)&&e&&jt(e.refs,t,i),!rt(this.value)&&ht(this.value)?(e&&yt(e.refs,this.value,i,null,this.parent.__.index),this.value!==t&&L(this.dom,this.attr,this.value)):J(this.dom,this.attr),this.dom.__ref||(this.dom.__ref=i)},unmount:function(){var t=this.tag||this.dom,e=this.parent&&wt(this.parent);!rt(this.value)&&e&&jt(e.refs,this.value,t)}};function le(t,e,i,s){return W(oe).init(t,e,i,s)}function de(t){ft(t,function(t){t.unmount?t.unmount(!0):t.tagName?t.tag.unmount(!0):t.unmount&&t.unmount()})}var ue={init:function(t,e,i){J(t,h),H(this,{tag:e,expr:i,stub:Y(),pristine:t});var s=t.parentNode;return s.insertBefore(this.stub,t),s.removeChild(t),this},update:function(){this.value=j(this.expr,this.tag),this.stub.parentNode&&(this.value&&!this.current?(this.current=this.pristine.cloneNode(!0),this.stub.parentNode.insertBefore(this.current,this.stub),this.expressions=ce.apply(this.tag,[this.current,!0])):!this.value&&this.current&&(this.unmount(),this.current=null,this.expressions=[]),this.value&&Vt.call(this.tag,this.expressions))},unmount:function(){this.current&&(this.current._tag?this.current._tag.unmount():this.current.parentNode&&this.current.parentNode.removeChild(this.current)),de(this.expressions||[])}};function he(t,e,i){return W(ue).init(t,e,i)}function ce(t,e){var i=this,s=[];return it(t,function(n){var r,a,o=n.nodeType;if((e||n!==t)&&(3===o&&"STYLE"!==n.parentNode.tagName&&j.hasExpr(n.nodeValue)&&s.push({dom:n,expr:n.nodeValue}),1===o)){var l="VIRTUAL"===n.tagName;if(r=X(n,c))return l&&L(n,"loopVirtual",!0),s.push(ae(n,i,r)),!1;if(r=X(n,h))return s.push(he(n,i,r)),!1;if((r=X(n,u))&&j.hasExpr(r))return s.push({isRtag:!0,expr:r,dom:n,attrs:[].slice.call(n.attributes)}),!1;if(a=St(n),l&&(X(n,"virtualized")&&n.parentElement.removeChild(n),a||X(n,"virtualized")||X(n,"loopVirtual")||(a={tmpl:n.outerHTML})),a&&(n!==t||e)){var d=X(n,u);if(!l||d)return d&&l&&mt("Virtual tags shouldn't be used together with the \""+u+'" attribute - https://github.com/riot/riot/issues/2511'),s.push(Bt(a,{root:n,parent:i},n.innerHTML,i)),!1;L(n,"virtualized",!0);var p=ve({tmpl:n.outerHTML},{root:n,parent:i},n.innerHTML);s.push(p)}pe.apply(i,[n,n.attributes,function(t,e){e&&s.push(e)}])}}),s}function pe(t,e,i){var s=this;ft(e,function(e){if(!e)return!1;var n,r=e.name,o=ut(r);pt(d,r)&&t.tagName.toLowerCase()!==a?n=le(t,s,r,e.value):j.hasExpr(e.value)&&(n={dom:t,expr:e.value,attr:r,bool:o}),i(e,n)})}function fe(t){var e=this.__,i=e.isAnonymous,s=e.skipAnonymous;_t(this,"isMounted",t),i&&s||(t?this.trigger("mount"):(this.trigger("unmount"),this.off("*"),this.__.wasCreated=!1))}function ve(t,e,i){void 0===t&&(t={}),void 0===e&&(e={});var s,r=e.context||{},a=e.opts||{},d=e.parent,u=e.isLoop,h=!!e.isAnonymous,c=K.skipAnonymousTags&&h,p=e.item,f=e.index,v=t.tmpl,g=[],E=e.root,m=e.tagName||bt(E),A="virtual"===m,y=!A&&!v;return y||u&&h?s=E:(A||(E.innerHTML=""),s=Nt(v,i,lt(E))),c||F(r),t.name&&E._tag&&E._tag.unmount(!0),_t(r,"__",{impl:t,root:E,skipAnonymous:c,implAttrs:[],isAnonymous:h,instAttrs:[],innerHTML:i,tagName:m,index:f,isLoop:u,isInline:y,item:p,parent:d,listeners:[],virts:[],wasCreated:!1,tail:null,head:null}),[["isMounted",!1],["_riot_id",gt()],["root",E],["opts",a,{writable:!0,enumerable:!0}],["parent",d||null],["tags",{}],["refs",{}],["update",function(t){return function(t,e,i){var s=t.__,n={},r=t.isMounted&&!s.skipAnonymous;return s.isAnonymous&&s.parent&&H(t,s.parent),H(t,e),Ht.apply(t,[s.isLoop,s.parent,s.isAnonymous,n,s.instAttrs]),r&&t.isMounted&&at(t.shouldUpdate)&&!t.shouldUpdate(e,n)?t:(H(t.opts,n),r&&t.trigger("update",e),Vt.call(t,i),r&&t.trigger("updated"),t)}(r,t,g)}],["mixin",function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];return ft(e,function(e){var i,s,n=[],r=["init","__proto__"];e=ht(e)?Zt(e):e,i=at(e)?new e:e;var a=Object.getPrototypeOf(i);do{n=n.concat(Object.getOwnPropertyNames(s||i))}while(s=Object.getPrototypeOf(s||i));ft(n,function(e){if(!pt(r,e)){var s=x(i,e)||x(a,e),n=s&&(s.get||s.set);!t.hasOwnProperty(e)&&n?Object.defineProperty(t,e,s):t[e]=at(i[e])?i[e].bind(t):i[e]}}),i.init&&i.init.bind(t)(t.opts)}),t}.apply(void 0,[r].concat(t))}],["mount",function(){return function(t,e,i,s){var n=t.__,r=n.root;r._tag=t,pe.apply(n.parent,[r,r.attributes,function(e,i){!n.isAnonymous&&oe.isPrototypeOf(i)&&(i.tag=t),e.expr=i,n.instAttrs.push(e)}]),Z(n.impl.attrs,function(t,e){n.implAttrs.push({name:t,value:e})}),pe.apply(t,[r,n.implAttrs,function(t,e){e?i.push(e):L(r,t.name,t.value)}]),Ht.apply(t,[n.isLoop,n.parent,n.isAnonymous,s,n.instAttrs]);var a=Zt(o);if(a&&!n.skipAnonymous)for(var l in a)a.hasOwnProperty(l)&&t.mixin(a[l]);if(n.impl.fn&&n.impl.fn.call(t,s),n.skipAnonymous||t.trigger("before-mount"),ft(ce.apply(t,[e,n.isAnonymous]),function(t){return i.push(t)}),t.update(n.item),!n.isAnonymous&&!n.isInline)for(;e.firstChild;)r.appendChild(e.firstChild);if(_t(t,"root",r),!n.skipAnonymous&&t.parent){var d=wt(t.parent);d.one(d.isMounted?"updated":"mount",function(){fe.call(t,!0)})}else fe.call(t,!0);return t.__.wasCreated=!0,t}(r,s,g,a)}],["unmount",function(t){return function(t,e,i){var s=t.__,r=s.root,a=n.indexOf(t),o=r.parentNode;if(s.skipAnonymous||t.trigger("before-unmount"),Z(s.impl.attrs,function(t){vt(t,l)&&(t=t.slice(l.length)),J(r,t)}),t.__.listeners.forEach(function(t){Object.keys(t[_]).forEach(function(e){t.removeEventListener(e,t[_][e])})}),-1!==a&&n.splice(a,1),s.parent&&!s.isAnonymous){var d=wt(s.parent);s.isVirtual?Object.keys(t.tags).forEach(function(e){return jt(d.tags,e,t.tags[e])}):jt(d.tags,s.tagName,t)}return t.__.virts&&ft(t.__.virts,function(t){t.parentNode&&t.parentNode.removeChild(t)}),de(i),ft(s.instAttrs,function(t){return t.expr&&t.expr.unmount&&t.expr.unmount()}),e?Q(r,""):o&&o.removeChild(r),s.onUnmount&&s.onUnmount(),t.isMounted||fe.call(t,!0),fe.call(t,!1),delete r._tag,t}(r,t,g)}]].reduce(function(t,e){var i=e[0],s=e[1],n=e[2];return _t(r,i,s,n),t},H(r,p))}function ge(t,e,i,s){var a,o=r[e],l=r[e].class,d=s||(l?W(l.prototype):{}),u=t._innerHTML=t._innerHTML||t.innerHTML,h=H({root:t,opts:i,context:d},{parent:i?i.parent:null});return o&&t&&(a=ve(o,h,u)),a&&a.mount&&(a.mount(!0),pt(n,a)||n.push(a)),a}var _e=Object.freeze({arrayishAdd:yt,getTagName:bt,inheritParentProps:Tt,mountTo:ge,selectTags:Wt,arrayishRemove:jt,getTag:St,initChildTag:Bt,moveChildTag:ie,makeReplaceVirtual:xt,getImmediateCustomParentTag:wt,makeVirtual:Ft,moveVirtual:se,unmountAll:de,createIfDirective:he,createRefDirective:le}),Ee=K,me={tmpl:j,brackets:B,styleManager:w,vdom:n,styleNode:w.styleNode,dom:st,check:ct,misc:At,tags:_e},Ae=Kt,ye=zt,Se=Yt,be=qt,Te=Zt,De=$t,Ie=te,Ce=F,Re=H({},ee,{observable:F,settings:Ee,util:me});t.settings=Ee,t.util=me,t.Tag=Ae,t.tag=ye,t.tag2=Se,t.mount=be,t.mixin=Te,t.update=De,t.unregister=Ie,t.version="v3.13.1",t.observable=Ce,t.default=Re,Object.defineProperty(t,"__esModule",{value:!0})}(e)},function(t,e,i){var s,n;s=[e,i(0)],void 0===(n=function(t,e){"use strict";function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e=function(t){return t&&t.__esModule?t:{default:t}}(e),window.location.hash;var s=/development/.test(window.location.hash),n=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._broker={},e.default.observable(this._broker)}return function(t,e,s){e&&i(t.prototype,e)}(t,[{key:"on",value:function(t,e){this._broker.on(t,e)}},{key:"off",value:function(t,e){this._broker.off(t,e)}},{key:"one",value:function(t,e){this._broker.one(t,e)}},{key:"trigger",value:function(){var t=this,e=[].slice.call(arguments);s&&window.console&&console.log('triggered: "'+e[0]+'" with payload:\n',e[1]),window.setTimeout(function(){try{t._broker.trigger.apply(t._broker,e)}catch(t){window.console&&console.error(e,t)}},0)}}]),t}());t.default=n}.apply(e,s))||(t.exports=n)},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof window.self&&window.self.Math==Math?window.self:Function("return this")();"number"==typeof window.__g&&(window.__g=i)},function(t,e,i){var s=i(22)("wks"),n=i(16),r=i(2).Symbol,a="function"==typeof r;(t.exports=function(t){return s[t]||(s[t]=a&&r[t]||(a?r:n)("Symbol."+t))}).store=s},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){var s=i(2),n=i(15),r=i(7),a=i(20),o=i(24),l=function(t,e,i){var d,u,h,c,p=t&l.F,f=t&l.G,v=t&l.S,g=t&l.P,_=t&l.B,E=f?s:v?s[e]||(s[e]={}):(s[e]||{}).prototype,m=f?n:n[e]||(n[e]={}),A=m.prototype||(m.prototype={});for(d in f&&(i=e),i)h=((u=!p&&E&&void 0!==E[d])?E:i)[d],c=_&&u?o(h,s):g&&"function"==typeof h?o(Function.call,h):h,E&&a(E,d,h,t&l.U),m[d]!=h&&r(m,d,c),g&&A[d]!=h&&(A[d]=h)};s.core=n,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},function(t,e,i){var s=i(9),n=i(19);t.exports=i(11)?function(t,e,i){return s.f(t,e,n(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var s=i(42),n=i(44);t.exports=function(t){return s(n(t))}},function(t,e,i){var s=i(10),n=i(39),r=i(23),a=Object.defineProperty;e.f=i(11)?Object.defineProperty:function(t,e,i){if(s(t),e=r(e,!0),s(i),n)try{return a(t,e,i)}catch(t){}if("get"in i||"set"in i)throw window.TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){var s=i(4);t.exports=function(t){if(!s(t))throw window.TypeError(t+" is not an object!");return t}},function(t,e,i){t.exports=!i(17)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,i){var s=i(41),n=i(27);t.exports=Object.keys||function(t){return s(t,n)}},function(t,e,i){i(37)("asyncIterator")},function(t,e,i){"use strict";var s=i(2),n=i(5),r=i(11),a=i(6),o=i(20),l=i(57).KEY,d=i(17),u=i(22),h=i(25),c=i(16),p=i(3),f=i(38),v=i(37),g=i(58),_=i(48),E=i(10),m=i(4),A=i(8),y=i(23),S=i(19),b=i(49),T=i(63),D=i(28),I=i(9),C=i(12),R=D.f,P=I.f,M=T.f,O=s.Symbol,L=s.JSON,N=L&&L.stringify,k=p("_hidden"),w=p("toPrimitive"),U={}.propertyIsEnumerable,B=u("symbol-registry"),j=u("symbols"),F=u("op-symbols"),x=Object.prototype,G="function"==typeof O,V=s.QObject,H=!V||!V.prototype||!V.prototype.findChild,W=r&&d(function(){return 7!=b(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(t,e,i){var s=R(x,e);s&&delete x[e],P(t,e,i),s&&t!==x&&P(x,e,s)}:P,K=function(t){var e=j[t]=b(O.prototype);return e._k=t,e},z=G&&"symbol"==typeof O.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof O},Y=function(t,e,i){return t===x&&Y(F,e,i),E(t),e=y(e,!0),E(i),n(j,e)?(i.enumerable?(n(t,k)&&t[k][e]&&(t[k][e]=!1),i=b(i,{enumerable:S(0,!1)})):(n(t,k)||P(t,k,S(1,{})),t[k][e]=!0),W(t,e,i)):P(t,e,i)},q=function(t,e){E(t);for(var i,s=g(e=A(e)),n=0,r=s.length;r>n;)Y(t,i=s[n++],e[i]);return t},X=function(t){var e=U.call(this,t=y(t,!0));return!(this===x&&n(j,t)&&!n(F,t))&&(!(e||!n(this,t)||!n(j,t)||n(this,k)&&this[k][t])||e)},J=function(t,e){if(t=A(t),e=y(e,!0),t!==x||!n(j,e)||n(F,e)){var i=R(t,e);return!i||!n(j,e)||n(t,k)&&t[k][e]||(i.enumerable=!0),i}},Q=function(t){for(var e,i=M(A(t)),s=[],r=0;i.length>r;)n(j,e=i[r++])||e==k||e==l||s.push(e);return s},Z=function(t){for(var e,i=t===x,s=M(i?F:A(t)),r=[],a=0;s.length>a;)!n(j,e=s[a++])||i&&!n(x,e)||r.push(j[e]);return r};G||(o((O=function(){if(this instanceof O)throw window.TypeError("Symbol is not a constructor!");var t=c(arguments.length>0?arguments[0]:void 0),e=function(i){this===x&&e.call(F,i),n(this,k)&&n(this[k],t)&&(this[k][t]=!1),W(this,t,S(1,i))};return r&&H&&W(x,t,{configurable:!0,set:e}),K(t)}).prototype,"toString",function(){return this._k}),D.f=J,I.f=Y,i(50).f=T.f=Q,i(21).f=X,i(47).f=Z,r&&!i(18)&&o(x,"propertyIsEnumerable",X,!0),f.f=function(t){return K(p(t))}),a(a.G+a.W+a.F*!G,{Symbol:O});for(var $="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),tt=0;$.length>tt;)p($[tt++]);for(var et=C(p.store),it=0;et.length>it;)v(et[it++]);a(a.S+a.F*!G,"Symbol",{for:function(t){return n(B,t+="")?B[t]:B[t]=O(t)},keyFor:function(t){if(!z(t))throw window.TypeError(t+" is not a symbol!");for(var e in B)if(B[e]===t)return e},useSetter:function(){H=!0},useSimple:function(){H=!1}}),a(a.S+a.F*!G,"Object",{create:function(t,e){return void 0===e?b(t):q(b(t),e)},defineProperty:Y,defineProperties:q,getOwnPropertyDescriptor:J,getOwnPropertyNames:Q,getOwnPropertySymbols:Z}),L&&a(a.S+a.F*(!G||d(function(){var t=O();return"[null]"!=N([t])||"{}"!=N({a:t})||"{}"!=N(Object(t))})),"JSON",{stringify:function(t){for(var e,i,s=[t],n=1;arguments.length>n;)s.push(arguments[n++]);if(i=e=s[1],(m(e)||void 0!==t)&&!z(t))return _(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!z(e))return e}),s[1]=e,N.apply(L,s)}}),O.prototype[w]||i(7)(O.prototype,w,O.prototype.valueOf),h(O,"Symbol"),h(Math,"Math",!0),h(s.JSON,"JSON",!0)},function(t,e){var i=t.exports={version:"2.5.7"};"number"==typeof window.__e&&(window.__e=i)},function(t,e){var i=0,s=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+s).toString(36))}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=!1},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,i){var s=i(2),n=i(7),r=i(5),a=i(16)("src"),o=Function.toString,l=(""+o).split("toString");i(15).inspectSource=function(t){return o.call(t)},(t.exports=function(t,e,i,o){var d="function"==typeof i;d&&(r(i,"name")||n(i,"name",e)),t[e]!==i&&(d&&(r(i,a)||n(i,a,t[e]?""+t[e]:l.join(String(e)))),t===s?t[e]=i:o?t[e]?t[e]=i:n(t,e,i):(delete t[e],n(t,e,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[a]||o.call(this)})},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){var s=i(15),n=i(2),r=n["__core-js_shared__"]||(n["__core-js_shared__"]={});(t.exports=function(t,e){return r[t]||(r[t]=void 0!==e?e:{})})("versions",[]).push({version:s.version,mode:i(18)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(t,e,i){var s=i(4);t.exports=function(t,e){if(!s(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!s(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!s(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!s(n=i.call(t)))return n;throw window.TypeError("Can't convert object to primitive value")}},function(t,e,i){var s=i(56);t.exports=function(t,e,i){if(s(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,s){return t.call(e,i,s)};case 3:return function(i,s,n){return t.call(e,i,s,n)}}return function(){return t.apply(e,arguments)}}},function(t,e,i){var s=i(9).f,n=i(5),r=i(3)("toStringTag");t.exports=function(t,e,i){t&&!n(t=i?t:t.prototype,r)&&s(t,r,{configurable:!0,value:e})}},function(t,e,i){var s=i(22)("keys"),n=i(16);t.exports=function(t){return s[t]||(s[t]=n(t))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){var s=i(21),n=i(19),r=i(8),a=i(23),o=i(5),l=i(39),d=Object.getOwnPropertyDescriptor;e.f=i(11)?d:function(t,e){if(t=r(t),e=a(e,!0),l)try{return d(t,e)}catch(t){}if(o(t,e))return n(!s.f.call(t,e),t[e])}},function(t,e,i){var s=i(28),n=i(51),r=i(5),a=i(6),o=i(4),l=i(10);a(a.S,"Reflect",{get:function t(e,i){var a,d,u=arguments.length<3?e:arguments[2];return l(e)===u?e[i]:(a=s.f(e,i))?r(a,"value")?a.value:void 0!==a.get?a.get.call(u):void 0:o(d=n(e))?t(d,i,u):void 0}})},function(t,e,i){var s=i(44);t.exports=function(t){return Object(s(t))}},function(t,e,i){var s=i(6);s(s.S,"Object",{setPrototypeOf:i(64).set})},function(t,e,i){"use strict";var s=i(52),n=i(66),r=i(33),a=i(8);t.exports=i(67)(Array,"Array",function(t,e){this._t=a(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,n(1)):n(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])},"values"),r.Arguments=r.Array,s("keys"),s("values"),s("entries")},function(t,e){t.exports={}},function(t,e,i){"use strict";var s=i(6),n=i(69)(5),r=!0;"find"in[]&&Array(1).find(function(){r=!1}),s(s.P+s.F*r,"Array",{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),i(52)("find")},function(t,e,i){var s,n;s=[e,i(1)],void 0===(n=function(t,e){"use strict";function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFeedAdapter=void 0,e=function(t){return t&&t.__esModule?t:{default:t}}(e);var s=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.constructor===t)throw new TypeError('Abstract class "BaseFeedAdapter" cannot be instantiated directly.');this.event=e.event,this.lastUpdated=null,this.pendingFeeds={},this.isLocked=!0}return function(t,e,s){e&&i(t.prototype,e)}(t,[{key:"getNewFeed",value:function(t){t?t in this.pendingFeeds?e.default.trigger("feed:debounce",{feedUrl:t}):(this.pendingFeeds[t]=1,this.isLocked||this.fetch(t)):e.default.trigger("feed:error",{feedUrl:t,error:"attempted to call a blank feed"})}},{key:"fetch",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){var i=this;window.fetch(t,{credentials:"same-origin"}).then(function(i){if(i.ok)return i;e.default.trigger("feed:error",{feedUrl:t,error:"response is not ok",response:i})}).then(function(t){return i.unifyFormat(t)}).then(function(t){return i.dispatchFeed(t)}).then(function(e){return delete i.pendingFeeds[t]}).catch(function(t){return window.console&&console.error("err: ",t)})})},{key:"unifyFormat",value:function(t){return t.json()}},{key:"dispatchFeed",value:function(t){return e.default.trigger(this.event,{feed:t}),t}},{key:"registerCallbacks",value:function(){var t=this;e.default.on("player:player:initialUrlLoad",function(e){for(var i in t.isLocked=!1,t.pendingFeeds)t.fetch(i)})}}]),t}();t.BaseFeedAdapter=s}.apply(e,s))||(t.exports=n)},function(t,e,i){for(var s=i(32),n=i(12),r=i(20),a=i(2),o=i(7),l=i(33),d=i(3),u=d("iterator"),h=d("toStringTag"),c=l.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=n(p),v=0;v<f.length;v++){var g,_=f[v],E=p[_],m=a[_],A=m&&m.prototype;if(A&&(A[u]||o(A,u,c),A[h]||o(A,h,_),l[_]=c,E))for(g in s)A[g]||r(A,g,s[g],!0)}},function(t,e,i){var s=i(2),n=i(15),r=i(18),a=i(38),o=i(9).f;t.exports=function(t){var e=n.Symbol||(n.Symbol=r?{}:s.Symbol||{});"_"==t.charAt(0)||t in e||o(e,t,{value:a.f(t)})}},function(t,e,i){e.f=i(3)},function(t,e,i){t.exports=!i(11)&&!i(17)(function(){return 7!=Object.defineProperty(i(40)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){var s=i(4),n=i(2).document,r=s(n)&&s(n.createElement);t.exports=function(t){return r?n.createElement(t):{}}},function(t,e,i){var s=i(5),n=i(8),r=i(59)(!1),a=i(26)("IE_PROTO");t.exports=function(t,e){var i,o=n(t),l=0,d=[];for(i in o)i!=a&&s(o,i)&&d.push(i);for(;e.length>l;)s(o,i=e[l++])&&(~r(d,i)||d.push(i));return d}},function(t,e,i){var s=i(43);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==s(t)?t.split(""):Object(t)}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(null==t)throw window.TypeError("Can't call method on  "+t);return t}},function(t,e,i){var s=i(46),n=Math.min;t.exports=function(t){return t>0?n(s(t),9007199254740991):0}},function(t,e){var i=Math.ceil,s=Math.floor;t.exports=function(t){return window.isNaN(t=+t)?0:(t>0?s:i)(t)}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){var s=i(43);t.exports=Array.isArray||function(t){return"Array"==s(t)}},function(t,e,i){var s=i(10),n=i(61),r=i(27),a=i(26)("IE_PROTO"),o=function(){},l=function(){var t,e=i(40)("iframe"),s=r.length;for(e.style.display="none",i(62).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),l=t.F;s--;)delete l.prototype[r[s]];return l()};t.exports=Object.create||function(t,e){var i;return null!==t?(o.prototype=s(t),i=new o,o.prototype=null,i[a]=t):i=l(),void 0===e?i:n(i,e)}},function(t,e,i){var s=i(41),n=i(27).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,n)}},function(t,e,i){var s=i(5),n=i(30),r=i(26)("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=n(t),s(t,r)?t[r]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},function(t,e,i){var s=i(3)("unscopables"),n=Array.prototype;null==n[s]&&i(7)(n,s,{}),t.exports=function(t){n[s][t]=!0}},function(t,e,i){var s;void 0===(s=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCookie=function(t){var e,i,s,n=window.document.cookie.split(";");for(e=0;e<n.length;e++)if(i=(i=n[e].substr(0,n[e].indexOf("="))).replace(/^\s+|\s+$/g,""),s=n[e].substr(n[e].indexOf("=")+1),i==t)return window.unescape(s);return null}}.apply(e,[e]))||(t.exports=s)},function(t,e,i){var s,n;s=[e,i(13),i(14),i(29),i(31),i(34),i(32),i(72),i(1),i(35),i(53)],void 0===(n=function(t,e,i,s,n,r,a,o,l,d,u){"use strict";function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function p(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t,e,i){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var s=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}(t,e);if(s){var n=Object.getOwnPropertyDescriptor(s,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.FusionFeedAdapter=void 0,l=function(t){return t&&t.__esModule?t:{default:t}}(l);var _=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i=p(this,v(e).call(this,{event:"feed:ingested:playlist"})),t.fusionRundown?(i.liveItem={canonicalTitle:t.canonicalTitle,fulltitle:t.fulltitle,title:t.title,url:t.url},i.fusionRundown=t.fusionRundown,i.feedUrl=t.fusionRundown+"&partner=cbsnsite",i.playlist={items:[]},i.liveSource=t.video,i.liveSourceNoAds=t.video2,i.liveSlug=t.slug.replace(/^live-/,""),i.topic=t.topic,i.tracking=t.tracking,i.isLocked=!1,i.registerCallbacks(),i):p(i)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(e,d.BaseFeedAdapter),function(t,e,i){e&&c(t.prototype,e)}(e,[{key:"unifyFormat",value:function(t){var i=this;return f(v(e.prototype),"unifyFormat",this).call(this,t).then(function(t){return i.convertFeed(t)})}},{key:"convertFeed",value:function(t){for(var e=Object.values(t.navigation.rundown.counts).reduce(function(t,e){return t+e}),i={id:"fusion-"+this.liveSlug,slug:this.liveSlug,type:"channel",title:this.liveItem.fulltitle,items:[],url:this.liveItem.url,meta:{fusionRundown:this.feedUrl,dateUpdated:t.navigation.dateUpdated.date,limit:null,itemCount:e,totalCount:e,loadMore:!1,custom:null,image:null,strategy:{method:"replace",startPosition:0,deleteCount:this.playlist.items.length}}},s=0;s<e;s++){var n=t.navigation.data[s];n&&("dvr"!=n.type&&"live"!=n.type||i.items.push({id:n.id,mpxRefId:n.mpxRefId,slug:n.dvr_slug,title:n.headlineshort,fulltitle:n.headline,canonicalTitle:"live"===n.type?this.liveItem.canonicalTitle+" Live Video":n.headlineshort,label:n.slug_label,type:n.type,duration:"live"===n.type?-1:n.duration,timestamp:n.startDate,durationLabel:n.segmentDur,url:n.path,images:{sd:n.images.thumbnail_url_hd,hd:n.images.thumbnail_url_hd},video:"live"===n.type?this.liveSource:n.videoUrl.base,video2:"live"===n.type?this.liveSourceNoAds:n.videoUrl.base,playlist:i,topic:this.topic,suppress:"adsEnabled"in n?!n.adsEnabled:null,allAccessBlock:!1,isUserSubscribed:null,sponsor:n.sponsor,fusionRundown:this.fusionRundown,tracking:this.tracking}),"live"==n.type&&(i.mpxRefId=n.mpxRefId,i.video=this.liveSource,i.video2=this.liveSourceNoAds,i.hasVideo=!0))}return i}},{key:"dispatchFeed",value:function(t){var i=this.playlist.items.find(function(t){return"live"===t.type}),s=t.items.find(function(t){return"live"===t.type});return i&&s&&i.id===s.id&&this.playlist.items.length===t.items.length||(f(v(e.prototype),"dispatchFeed",this).call(this,t),s&&(l.default.trigger("video:video:changed",{video:s}),l.default.trigger("video:video:changed:type-live",{video:s}),l.default.trigger("video:video:changed:type-live:"+s.playlist.id,{video:s}))),t}},{key:"registerCallbacks",value:function(){var t=this,i=JSON.parse((0,u.getCookie)("fly_geo"));(!i||"au"!==i.countryCode&&"nz"!==i.countryCode)&&(f(v(e.prototype),"registerCallbacks",this).call(this),l.default.on("video:data:changed:fusion-"+this.liveSlug,function(e){return t.playlist=e.playlist}),this.getNewFeed(this.feedUrl),window.setInterval(this.getNewFeed.bind(this,this.feedUrl),15e3))}}]),e}();t.FusionFeedAdapter=_}.apply(e,s))||(t.exports=n)},function(t,e,i){var s,n;s=[e,i(13),i(14),i(29),i(31),i(1),i(35)],void 0===(n=function(t,e,i,s,n,r,a){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function d(t,e,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var s=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(s){var n=Object.getOwnPropertyDescriptor(s,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoFeedAdapter=void 0,r=function(t){return t&&t.__esModule?t:{default:t}}(r);var c=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=function(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,u(e).call(this,{event:"feed:ingested:playlist"}))).registerCallbacks(),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(e,a.BaseFeedAdapter),function(t,e,i){e&&l(t.prototype,e)}(e,[{key:"dispatchFeed",value:function(t){return r.default.trigger(this.event,{feed:t,path:this.path}),t}},{key:"registerCallbacks",value:function(){var t=this;d(u(e.prototype),"registerCallbacks",this).call(this);var i=!(-1==window.document.cookie.indexOf("fly_user"));window.CBSNEWS.user.isUserSubscribed&&(i="2"),r.default.on("feed:request:playlist",function(e){e.slug&&e.slug.indexOf("fusion")>-1||!e.type||!e.api||t.getNewFeed(e.api+"?is_logged_in="+ +i)}),r.default.on("feed:request:video",function(e){if("vod"===e.type&&(e.id||e.slug)){var s="0";e.imposter&&(s="1");var n="";e.strategy&&(n="&strategy="+e.strategy);var r="";e.startPosition&&(r="&startPosition="+e.startPosition);var a=e.type;t.getNewFeed("/video/xhr/video/"+a+"/"+(e.id||e.slug)+"/?is_logged_in="+ +i+"&is_imposter="+s+n+r)}}),r.default.on("feed:request:path",function(e){if(e.path){var s="0";e.imposter&&(s="1");var n="";e.strategy&&(n="&strategy="+e.strategy);var r="";e.startPosition&&(r="&startPosition="+e.startPosition),e.type,t.path=e.path,t.getNewFeed("/video/xhr/path"+e.path+"?is_logged_in="+ +i+"&is_imposter="+s+n+r)}})}}]),e}();t.VideoFeedAdapter=c}.apply(e,s))||(t.exports=n)},function(t,e){t.exports=function(t){if("function"!=typeof t)throw window.TypeError(t+" is not a function!");return t}},function(t,e,i){var s=i(16)("meta"),n=i(4),r=i(5),a=i(9).f,o=0,l=Object.isExtensible||function(){return!0},d=!i(17)(function(){return l(Object.preventExtensions({}))}),u=function(t){a(t,s,{value:{i:"O"+ ++o,w:{}}})},h=t.exports={KEY:s,NEED:!1,fastKey:function(t,e){if(!n(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!r(t,s)){if(!l(t))return"F";if(!e)return"E";u(t)}return t[s].i},getWeak:function(t,e){if(!r(t,s)){if(!l(t))return!0;if(!e)return!1;u(t)}return t[s].w},onFreeze:function(t){return d&&h.NEED&&l(t)&&!r(t,s)&&u(t),t}}},function(t,e,i){var s=i(12),n=i(47),r=i(21);t.exports=function(t){var e=s(t),i=n.f;if(i)for(var a,o=i(t),l=r.f,d=0;o.length>d;)l.call(t,a=o[d++])&&e.push(a);return e}},function(t,e,i){var s=i(8),n=i(45),r=i(60);t.exports=function(t){return function(e,i,a){var o,l=s(e),d=n(l.length),u=r(a,d);if(t&&i!=i){for(;d>u;)if((o=l[u++])!=o)return!0}else for(;d>u;u++)if((t||u in l)&&l[u]===i)return t||u||0;return!t&&-1}}},function(t,e,i){var s=i(46),n=Math.max,r=Math.min;t.exports=function(t,e){return(t=s(t))<0?n(t+e,0):r(t,e)}},function(t,e,i){var s=i(9),n=i(10),r=i(12);t.exports=i(11)?Object.defineProperties:function(t,e){n(t);for(var i,a=r(e),o=a.length,l=0;o>l;)s.f(t,i=a[l++],e[i]);return t}},function(t,e,i){var s=i(2).document;t.exports=s&&s.documentElement},function(t,e,i){var s=i(8),n=i(50).f,r={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return a&&"[object Window]"==r.call(t)?function(t){try{return n(t)}catch(t){return a.slice()}}(t):n(s(t))}},function(t,e,i){var s=i(4),n=i(10),r=function(t,e){if(n(t),!s(e)&&null!==e)throw window.TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,s){try{(s=i(24)(Function.call,i(28).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return r(t,i),e?t.__proto__=i:s(t,i),t}}({},!1):void 0),check:r}},function(t,e,i){var s,n;s=[e,i(13),i(14),i(36),i(1),i(54)],void 0===(n=function(t,e,i,s,n,r){"use strict";function a(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoStore=void 0,n=function(t){return t&&t.__esModule?t:{default:t}}(n);var o={},l={},d=1e3,u={};function h(t){var e="video:data:changed",i={_playlist_id:t.__id,playlist:t};n.default.trigger(e,i),t.id&&n.default.trigger("".concat(e,":").concat(t.id),i),t.slug&&n.default.trigger("".concat(e,":").concat(t.slug),i)}function c(t,e){return t.type+"/"+t[e]}function p(t){var e,i=c(t,"id"),s=c(t,"slug");i in l?e=l[i]:s in l?e=l[s]:(e=++d,o[e]={__id:e,__lastUpdated:null,id:null,items:[],itemIndexById:{},meta:{dateUpdated:null,hash:null}});var n=[],a=t.meta.strategy;switch(a.method){case"replace":n=function(t,e,i){var s=o[t].items;return Array.prototype.splice.apply(s,[i.startPosition,i.deleteCount||s.length].concat(e.items)),s}(e,t,a);break;case"inject":n=function(t,e,i){var s=o[t].items;return Array.prototype.splice.apply(s,[i.startPosition,0].concat(e.items)),s}(e,t,a);break;case"append":default:n=function(t,e,i){var s=o[t].items,n=!0,r=!1,a=void 0;try{for(var l,d=e.items[Symbol.iterator]();!(n=(l=d.next()).done);n=!0){var u=l.value;u.id&&u.id in o[t].itemIndexById||s.push(u)}}catch(t){r=!0,a=t}finally{try{n||null==d.return||d.return()}finally{if(r)throw a}}return s}(e,t)}for(var v in t)t[v]&&(o[e][v]=t[v]);o[e].id&&(l[c(o[e],"id")]=e),o[e].slug&&(l[c(o[e],"slug")]=e);for(var g=0,_={},E=0;E<n.length;E++){var m=n[E];"live"!==m.type||u[m.mpxRefId]||(u[m.mpxRefId]=new r.FusionFeedAdapter(m)),"vod"!==m.type&&"dvr"!==m.type&&"live"!==m.type||(m.playlist=o[e]),"playlist"!==m.type&&"listing"!==m.type&&"channel"!==m.type||(p(m),n[E]=f(m.id,m.slug,m.type)||m),m.id&&(_[m.id]=E),m.imposter?g--:g++}o[e].emptyPlaylist=!1,g<1&&(o[e].emptyPlaylist=!0),o[e].items=n,o[e].itemIndexById=_,o[e].__lastUpdated=Date.now(),h(o[e])}function f(t,e,i){var s;if(t?s=l[i+"/"+t]:e&&i&&(s=l[i+"/"+e]),s&&o[s])return o[s]}var v=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.registerCallbacks()}return function(t,e,i){e&&a(t.prototype,e)}(t,[{key:"getVideoInPlaylist",value:function(t,e){var i=this.getPlaylistByIdOrSlug(e);for(var s in i.items){var n=i.items[s];if(n.id==t)return n}return null}},{key:"registerCallbacks",value:function(){n.default.on("feed:ingested:playlist",function(t){return p(t.feed)}),n.default.on("feed:ingested:video",function(t){return function(t){if(t.playlist){var e=f(t.playlist.id,t.playlist.slug,t.playlist.type)||t.playlist;e.items.shift(t),p(e)}}(t.feed)}),n.default.on("register:component",function(t){var e=f(t.id,t.slug,t.type);e&&h(e),e&&e.meta.itemCount===e.meta.totalCount||n.default.trigger("feed:request:playlist",t)})}}]),t}();t.VideoStore=v}.apply(e,s))||(t.exports=n)},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){"use strict";var s=i(18),n=i(6),r=i(20),a=i(7),o=i(33),l=i(68),d=i(25),u=i(51),h=i(3)("iterator"),c=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,i,f,v,g,_){l(i,e,f);var E,m,A,y=function(t){if(!c&&t in D)return D[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},S=e+" Iterator",b="values"==v,T=!1,D=t.prototype,I=D[h]||D["@@iterator"]||v&&D[v],C=I||y(v),R=v?b?y("entries"):C:void 0,P="Array"==e&&D.entries||I;if(P&&(A=u(P.call(new t)))!==Object.prototype&&A.next&&(d(A,S,!0),s||"function"==typeof A[h]||a(A,h,p)),b&&I&&"values"!==I.name&&(T=!0,C=function(){return I.call(this)}),s&&!_||!c&&!T&&D[h]||a(D,h,C),o[e]=C,o[S]=p,v)if(E={values:b?C:y("values"),keys:g?C:y("keys"),entries:R},_)for(m in E)m in D||r(D,m,E[m]);else n(n.P+n.F*(c||T),e,E);return E}},function(t,e,i){"use strict";var s=i(49),n=i(19),r=i(25),a={};i(7)(a,i(3)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=s(a,{next:n(1,i)}),r(t,e+" Iterator")}},function(t,e,i){var s=i(24),n=i(42),r=i(30),a=i(45),o=i(70);t.exports=function(t,e){var i=1==t,l=2==t,d=3==t,u=4==t,h=6==t,c=5==t||h,p=e||o;return function(e,o,f){for(var v,g,_=r(e),E=n(_),m=s(o,f,3),A=a(E.length),y=0,S=i?p(e,A):l?p(e,0):void 0;A>y;y++)if((c||y in E)&&(g=m(v=E[y],y,_),t))if(i)S[y]=g;else if(g)switch(t){case 3:return!0;case 5:return v;case 6:return y;case 2:S.push(v)}else if(u)return!1;return h?-1:d||u?u:S}}},function(t,e,i){var s=i(71);t.exports=function(t,e){return new(s(t))(e)}},function(t,e,i){var s=i(4),n=i(48),r=i(3)("species");t.exports=function(t){var e;return n(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!n(e.prototype)||(e=void 0),s(e)&&null===(e=e[r])&&(e=void 0)),void 0===e?Array:e}},function(t,e,i){var s=i(6),n=i(73)(!1);s(s.S,"Object",{values:function(t){return n(t)}})},function(t,e,i){var s=i(12),n=i(8),r=i(21).f;t.exports=function(t){return function(e){for(var i,a=n(e),o=s(a),l=o.length,d=0,u=[];l>d;)r.call(a,i=o[d++])&&u.push(t?[i,a[i]]:a[i]);return u}}},function(t,e,i){var s,n;s=[e,i(1),i(0),i(75),i(76),i(78),i(79),i(81),i(82)],void 0===(n=function(t,e,i,s,n,r,a,o,l){"use strict";function d(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.beforeInitialTagMount=function(){var t={initialUrlLoad:!0},i=function(i){if(e.default.trigger("player:player:initialUrlLoad",{initialUrlLoad:t.initialUrlLoad,shouldAutoplay:window.CBSNEWS.shouldAutoplay}),t.initialUrlLoad){t.initialUrlLoad=!1;var s=window.CBSNEWS.defaultPayload.items[0],n={video:s,type:s.playlist.type,playlist:s.playlist,initialUrlLoad:!0};e.default.trigger("url:load",n)}},s=window.CBSNEWS.defaultPayload,n=!(!s.meta||!s.meta.view);e.default.on("player:player:init",i),e.default.on("player:player:ready",i),e.default.on("player:video:state",function(t){if(1==t.uvpEvent.payload.newState){window.document.body.classList.add("uvp--overlay-hidden"),window.document.body.classList.add("uvp--is-playing"),window.document.body.classList.remove("uvp--is-not-playing"),window.document.body.classList.remove("uvp--is-paused"),window.document.body.classList.remove("uvp--overlay-closed"),window.CBSNEWS.frameElementContainer&&window.CBSNEWS.frameElementContainer.classList.add("embed--is-playing");var e=new window.CustomEvent("video-embed-event",{detail:{type:"PLAYING",videoShelfType:n&&window.CBSNEWS.defaultPayload.meta.view}});try{window.parent.dispatchEvent(e)}catch(t){}}else window.document.body.classList.remove("uvp--is-playing"),window.document.body.classList.add("uvp--is-not-playing");if(-1==t.uvpEvent.payload.newState){window.document.body.classList.add("uvp--overlay-hidden"),window.document.body.classList.remove("uvp--is-paused"),window.document.body.classList.remove("uvp--overlay-closed"),window.CBSNEWS.frameElementContainer&&window.CBSNEWS.frameElementContainer.classList.add("embed--is-playing");var i=new window.CustomEvent("video-embed-event",{detail:{type:"OPEN",videoShelfType:n&&window.CBSNEWS.defaultPayload.meta.view}});try{window.parent.dispatchEvent(i)}catch(t){}}2==t.uvpEvent.payload.newState&&(window.document.body.classList.remove("uvp--overlay-hidden"),window.document.body.classList.add("uvp--is-paused"))}),e.default.on("player:video:block",function(){window.document.body.classList.add("uvp--overlay-hidden")}),e.default.on("player:player:closed",function(){window.document.body.classList.remove("uvp--overlay-hidden"),window.document.body.classList.add("uvp--overlay-closed");var t=new window.CustomEvent("video-embed-event",{detail:{type:"CLOSE",videoShelfType:n&&window.CBSNEWS.defaultPayload.meta.view}});try{window.parent.dispatchEvent(t)}catch(t){}}),e.default.on("url:click",function(){window.CBSNEWS.frameElementContainer&&window.CBSNEWS.frameElementContainer.classList.add("embed--is-playing")}),e.default.on("url:change",function(t){return e.default.trigger("url:load",t)}),e.default.on("url:load",function(t){var e=t.video.slug;window.document.body.setAttribute("data-slug",e)}),window.CBSNEWS.defaultPayload&&e.default.trigger("feed:ingested:playlist",{feed:window.CBSNEWS.defaultPayload,isDefaultPayload:!0}),window.CBSNEWS.defaultLayout&&e.default.trigger("feed:ingested:layout",{feed:window.CBSNEWS.defaultLayout})},e=d(e),i=d(i),window.riot=i.default,window.isie=-1!=window.navigator.userAgent.indexOf("Edge")||-1!=window.navigator.userAgent.indexOf("MSIE")||-1!=window.navigator.userAgent.indexOf("Trident"),window.istablet=window.matchMedia("(min-width: 36em)").matches&&window.istouch;try{window.document.createEvent("TouchEvent"),window.istouch=!0,window.document.body.classList.add("touch")}catch(t){window.istouch=!1,window.document.body.classList.add("no-touch")}window.needsflash=window.navigator.userAgent.indexOf("Trident/7.0")>0&&window.navigator.userAgent.indexOf("Windows NT 6.1")>0,window.isie&&window.document.body.classList.add("is-ie"),window.CBSNEWS.dispatch=e.default}.apply(e,s))||(t.exports=n)},function(t,e,i){var s,n;s=[i(1)],void 0===(n=function(t){"use strict";function e(t){this._player=t}t=function(t){return t&&t.__esModule?t:{default:t}}(t),e._viewStartTime=Date.now(),e._contentTypes={AD:"ad",CONTENT:"ct"},e._adPositions={PREROLL:"a1",MIDROLL:"a2",POSTROLL:"a3",OVERLAY:"a4",SPECIAL:"a5"},e._videoStates={UNPLAYED:"s1",PLAYED:"s2",STOPPED:"s3",COMPLETED:"s4"},e.prototype.isReady=function(){return!!this._getVideoData("cmsRefGuid")},e.prototype.getTitle=function(){return this._getVideoData("videoTitle")},e.prototype.getVideoPath=function(){return this._getVideoData("cmsRefGuid")},e.prototype.getContentType=function(){return this._getPlaybackState("isAd")?e._contentTypes.AD:e._contentTypes.CONTENT},e.prototype.getAdPosition=function(){return e._adPositions.PREROLL},e.prototype.getTotalDuration=function(){var t=this._getPlaybackState("duration");return-1==t&&(t=300),1e3*t},e.prototype.getState=function(){var t=this._getPlaybackState("playbackState");return 0===t?e._videoStates.STOPPED:1===t?e._videoStates.PLAYED:2===t?e._videoStates.COMPLETED:void 0},e.prototype.getCurrentPlayTime=function(){return 1e3*this._getPlaybackState("currentTime")},e.prototype.getBitrate=function(){var t=this._getPlaybackState("facadeState");return this._getPlaybackState("isAd")?0:t.currentBitrate/1e3},e.prototype.getThumbnailPath=function(){return this._getVideoData("audioPreviewImageUrl")},e.prototype.getPlayerType=function(){return"UVPJS"},e.prototype.getViewStartTime=function(){return Date.now()-e._viewStartTime},e.prototype.getViewPlayTime=function(){return 1e3*this._getPlaybackState("absoluteStreamTime")},e.prototype.getViewAdPlayTime=function(){},e.verify=function(t){return"function"==typeof t.loadAndPlayResource},e.prototype._getPlaybackState=function(t){return this._player.getCurrentPlaybackState()[t]},e.prototype._getVideoData=function(t){return this._player.getContentVideoData()[t]},e.setPlayer=function(t){window._cbv.push(t)},window._cbv=window._cbv||[],window._cbv_strategies=window._cbv_strategies||[],window._cbv_strategies.push(e),window.UvpjsChartbeatAnalytics=e,t.default.on("player:player:ready",function(t){e.setPlayer(t.videoPlayer)}),t.default.on("url:load",function(t){e._viewStartTime=Date.now()})}.apply(e,s))||(t.exports=n)},function(t,e,i){var s,n;s=[i(1),i(77)],void 0===(n=function(t,e){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}t=i(t);var s,n,r=(e=i(e)).default.getInstance();t.default.on("player:resource:start",function(t){n=t.video,r.emit("uvpjs-newvideoplayback",{slug:t.video.slug,componentId:window.CBSNEWS.defaultPayload.id,componentSlug:window.CBSNEWS.defaultPayload.slug,containerId:window.CBSNEWS.uvpContainerId})}),t.default.on("player:video:state",function(t){1==t.uvpEvent.payload.newState&&t.uvpEvent.payload.newState!==s&&r.emit("uvpjs-newvideoplayback",{slug:t.video.slug,componentId:window.CBSNEWS.defaultPayload.id,componentSlug:window.CBSNEWS.defaultPayload.slug,containerId:window.CBSNEWS.uvpContainerId}),s=t.uvpEvent.payload.newState}),r.on("uvpjs-newvideoplayback",function(e){e.containerId&&e.containerId!==window.CBSNEWS.uvpContainerId&&t.default.trigger("player:video:pause",{video:n})}),r.on("uvpjs-viewabilityclosed",function(e){e.containerId==window.CBSNEWS.uvpContainerId&&t.default.trigger("player:video:pause",{video:n})})}.apply(e,s))||(t.exports=n)},function(t,e,i){var s;/*! intercom.js | https://github.com/diy/intercom.js | Apache License (v2) */void 0===(s=function(){var t=function(){};t.createInterface=function(t){return{on:function(e,i){void 0===this[t]&&(this[t]={}),this[t].hasOwnProperty(e)||(this[t][e]=[]),this[t][e].push(i)},off:function(e,i){void 0!==this[t]&&this[t].hasOwnProperty(e)&&n.removeItem(i,this[t][e])},trigger:function(e){if(void 0!==this[t]&&this[t].hasOwnProperty(e))for(var i=Array.prototype.slice.call(arguments,1),s=0;s<this[t][e].length;s++)this[t][e][s].apply(this[t][e][s],i)}}};var e=t.createInterface("_handlers");t.prototype._on=e.on,t.prototype._off=e.off,t.prototype._trigger=e.trigger;var i=t.createInterface("handlers");t.prototype.on=function(){i.on.apply(this,arguments),Array.prototype.unshift.call(arguments,"on"),this._trigger.apply(this,arguments)},t.prototype.off=i.off,t.prototype.trigger=i.trigger;var s=window.localStorage;void 0===s&&(s={getItem:function(){},setItem:function(){},removeItem:function(){}});var n={};n.guid=function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}(),n.throttle=function(t,e){var i=0;return function(){var s=(new Date).getTime();s-i>t&&(i=s,e.apply(this,arguments))}},n.extend=function(t,e){if(void 0!==t&&t||(t={}),"object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},n.removeItem=function(t,e){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1);return e};var r=function(){var t=this,e=(new Date).getTime();this.origin=n.guid(),this.lastMessage=e,this.bindings=[],this.receivedIDs={},this.previousValues={};var i=function(){t._onStorageEvent.apply(t,arguments)};window.attachEvent?window.document.attachEvent("onstorage",i):window.addEventListener("storage",i,!1)};r.prototype._transaction=function(t){var e=this,i=!1,n=!1,r=null,a=function(){if(!i){var d=(new Date).getTime(),u=window.parseInt(s.getItem(l)||0);if(u&&d-u<1e3)return n||(e._on("storage",a),n=!0),void(r=window.setTimeout(a,20));i=!0,s.setItem(l,d),t(),o()}},o=function(){n&&e._off("storage",a),r&&window.clearTimeout(r),s.removeItem(l)};a()},r.prototype._cleanup_emit=n.throttle(100,function(){this._transaction(function(){for(var t=(new Date).getTime()-d,e=0,i=JSON.parse(s.getItem(a)||"[]"),n=i.length-1;n>=0;n--)i[n].timestamp<t&&(i.splice(n,1),e++);e>0&&s.setItem(a,JSON.stringify(i))})}),r.prototype._cleanup_once=n.throttle(100,function(){var t=this;this._transaction(function(){var e,i=JSON.parse(s.getItem(o)||"{}"),n=((new Date).getTime(),0);for(e in i)t._once_expired(e,i)&&(delete i[e],n++);n>0&&s.setItem(o,JSON.stringify(i))})}),r.prototype._once_expired=function(t,e){if(!e)return!0;if(!e.hasOwnProperty(t))return!0;if("object"!=typeof e[t])return!0;var i=e[t].ttl||u,s=(new Date).getTime();return e[t].timestamp<s-i},r.prototype._localStorageChanged=function(t,e){if(t&&t.key)return t.key===e;var i=s.getItem(e);return i!==this.previousValues[e]&&(this.previousValues[e]=i,!0)},r.prototype._onStorageEvent=function(t){t=t||window.event;var e=this;this._localStorageChanged(t,a)&&this._transaction(function(){for(var t=(new Date).getTime(),i=s.getItem(a),n=JSON.parse(i||"[]"),r=0;r<n.length;r++)if(n[r].origin!==e.origin&&!(n[r].timestamp<e.lastMessage)){if(n[r].id){if(e.receivedIDs.hasOwnProperty(n[r].id))continue;e.receivedIDs[n[r].id]=!0}e.trigger(n[r].name,n[r].payload)}e.lastMessage=t}),this._trigger("storage",t)},r.prototype._emit=function(t,e,i){if((i="string"==typeof i||"number"==typeof i?String(i):null)&&i.length){if(this.receivedIDs.hasOwnProperty(i))return;this.receivedIDs[i]=!0}var n={id:i,name:t,origin:this.origin,timestamp:(new Date).getTime(),payload:e},r=this;this._transaction(function(){var i=s.getItem(a)||"[]",o="[]"===i?"":",";i=[i.substring(0,i.length-1),o,JSON.stringify(n),"]"].join(""),s.setItem(a,i),r.trigger(t,e),window.setTimeout(function(){r._cleanup_emit()},50)})},r.prototype.bind=function(t,e){for(var i=0;i<r.bindings.length;i++){var s=r.bindings[i].factory(t,e||null,this);s&&this.bindings.push(s)}},r.prototype.emit=function(t,e){this._emit.apply(this,arguments),this._trigger("emit",t,e)},r.prototype.once=function(t,e,i){if(r.supported){var n=this;this._transaction(function(){var r=JSON.parse(s.getItem(o)||"{}");n._once_expired(t,r)&&(r[t]={},r[t].timestamp=(new Date).getTime(),"number"==typeof i&&(r[t].ttl=1e3*i),s.setItem(o,JSON.stringify(r)),e(),window.setTimeout(function(){n._cleanup_once()},50))})}},n.extend(r.prototype,t.prototype),r.bindings=[],r.supported=void 0!==s;var a="intercom",o="intercom_once",l="intercom_lock",d=5e4,u=36e5;r.destroy=function(){s.removeItem(l),s.removeItem(a),s.removeItem(o)},r.getInstance=function(){var t=null;return function(){return t||(t=new r),t}}();var h=function(t,e,i){if((e=n.extend({id:null,send:!0,receive:!0},e)).receive){var s=[],r=function(n,r){-1===s.indexOf(n)&&(s.push(n),t.on(n,function(t){var s="function"==typeof e.id?e.id(n,t):null,r="function"!=typeof e.receive||e.receive(n,t);(r||"boolean"!=typeof r)&&i._emit(n,t,s)}))};for(var a in i.handlers)for(var o=0;o<i.handlers[a].length;o++)r(a,i.handlers[a][o]);i._on("on",r)}e.send&&i._on("emit",function(i,s){var n="function"!=typeof e.send||e.send(i,s);(n||"boolean"!=typeof n)&&t.emit(i,s)})};return h.factory=function(t,e,i){return void 0!==t.socket&&new h(t,e,i)},r.bindings.push(h),r}.call(e,i,e,t))||(t.exports=s)},function(t,e,i){var s,n;s=[i(1),i(0)],void 0===(n=function(t,e){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}t=i(t),(e=i(e)).default.util.tmpl.errorHandler=function(e){t.default.trigger("riot:tag:error",{tagName:e.riotData.tagName,message:e.message})},e.default.mixin({init:function(e){this.dispatch=t.default,this.opts.dataIs?this.opts.dataIs:this.root.nodeName.toLowerCase()}}),e.default.mixin("formatter",{init:function(t){},getRelativeTime:function(t){if(!t)return"";var e=new Date(t),i=new Date;window.isie&&"string"==typeof t&&(e=Date.parse(t.replace(/( \+)/," UTC$1")));var s=Math.floor((i-e)/1e3);return s<=60?"just now":s<=3600?Math.round(s/60)+"m ago":s<=86400?Math.round(s/3600)+"h ago":this.formatDate(t)},formatDate:function(t){var e=(t=new Date(t)).getMonth(),i=t.getDate(),s=t.getFullYear();return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][e]+" "+i+", "+s}})}.apply(e,s))||(t.exports=n)},function(t,e,i){var s,n;s=[i(1),i(80)],void 0===(n=function(t,e){"use strict";(t=function(t){return t&&t.__esModule?t:{default:t}}(t)).default.on("url:load",function(t){var e=t.video,i=Object.assign({},window.CBSNEWS.tracking),s=e.type;window.hashParams&&window.hashParams.tracking||(window.isembed&&(i.mediaEmbed=!0),"playlist"===e.playlist.type&&(i.collectionId=e.playlist.id,i.collectionName=e.playlist.title),"live"===s||"dvr"===s?(i.articleId="",i.articleTitle="",i.mediaId="",i.mediaTitle="",i.mediaType="",i.pageName="/cbsn",i.pageType="live_streaming_player",i.siteSection=e.topic.slug):(i.articleId=e.id,i.articleTitle=e.fulltitle.toLowerCase(),i.mediaId=e.id,i.mediaTitle=e.fulltitle.toLowerCase(),i.mediaType="content_video",i.pageName=window.location.pathname,i.pageType="video",i.siteSection=e.topic.slug.replace(/-/gi," ")),i.hasVideo=!0,i.pageViewGuid=window.uuid.v4(),i.pageUrl=window.location.href,i.topicId=e.topic.id,i.topicName=e.topic.hierarchy,i.siteHier=e.topic.hierarchy,i.videoTitle=e.fulltitle,i.videoUrl=e.url,window.utag_cfg_ovrd=window.utag_cfg_ovrd||{},window.utag_cfg_ovrd.noview=!1,window.CBSNEWS.tracking=i,window.utag_data=window.CBSNEWS.tracking,window.utag&&window.utag.view(i,function(){var t=new window.CustomEvent("tracking:view",{detail:i});window.dispatchEvent(t)}.bind(void 0)))})}.apply(e,s))||(t.exports=n)},function(t,e,i){var s;void 0===(s=function(){"use strict";window.uuid||(window.uuid={}),void 0===window.uuid.v4&&(window.uuid.v4=function(){var t,e,i="";for(t=0;t<32;t++)e=16*Math.random()|0,8!=t&&12!=t&&16!=t&&20!=t||(i+="-"),i+=(12==t?4:16==t?3&e|8:e).toString(16);return i})}.apply(e,[]))||(t.exports=s)},function(t,e,i){var s,n;s=[i(1)],void 0===(n=function(t){"use strict";var e,i=!1,s={};(t=function(t){return t&&t.__esModule?t:{default:t}}(t)).default.on("url:change",function(t){i=!!t.userInitated}),t.default.on("player:video:start",function(t){i=!1}),t.default.on("player:resource:end",function(n){if(!window.isembed&&!i&&"live"!=n.video.type){for(var r,a=n.video,o=a.playlist,l=o.itemIndexById[a.id]+1;l<o.items.length;){var d=o.items[l];if(["vod","live","dvr"].indexOf(d.type)>-1){r=d;break}l++}var u={userInitated:!1};r?u.video=r:a.fusionRundown in s?u.video=s[a.fusionRundown]:u.video=e||window.CBSNEWS.defaultPayload.items[0],t.default.trigger("url:change",u)}}),t.default.on("video:video:changed:type-live",function(t){s[t.video.fusionRundown]=t.video,"fusion-cbsn"===t.video.playlist.id&&(e=t.video)})}.apply(e,s))||(t.exports=n)},function(t,e,i){var s,n;s=[i(1)],void 0===(n=function(t){"use strict";t=function(t){return t&&t.__esModule?t:{default:t}}(t);var e,i={adHref:null,adSlug:null,pathClicked:null,slugClicked:null};function s(s){t.default.trigger("url:click",s);var n=s.target;if("A"!=!s.target.nodeName&&(n=s.target.closest("a")),n&&"A"==n.nodeName&&(!window.isembed||n.hasAttribute("data-stay-inside-embed"))&&/(cbsnews\.com)/i.test(n.host)&&(n.payload||n.hasAttribute("data-payload")||n.matches('a[href*="/live/"], a[href*="/video/"]')&&!n.matches('a[href^="#"]'))){var r=n.payload;if(!r&&n.hasAttribute("data-payload")&&(r=JSON.parse(n.getAttribute("data-payload"))),r)if("custom"==r.type);else if("playlist"==r.type||"listing"==r.type||"channel"==r.type){s.preventDefault();var a=r.items[0];r.id.indexOf("fusion")>-1&&(a=r.items[r.items.length-1]),t.default.trigger("feed:ingested:playlist",{feed:r}),t.default.trigger("url:change",{type:r.type,playlist:r,video:a,userInitated:!0})}else s.preventDefault(),t.default.trigger("url:change",{type:r.type,playlist:r.playlist,video:r,userInitated:!0});else{s.preventDefault();var o=n.pathname;"/pcs/click"==o&&(o="/video/"+n.href.split(".com/video/")[1]),i.pathClicked=o,t.default.trigger("feed:request:path",{path:o,targetPathname:n.pathname}),e=window.setTimeout(function(){window.clearTimeout(e),window.location.href=n.href},1e3)}}}window.document.body.addEventListener("click",s,!0),window.CBSNEWS.frameElementContainer&&window.CBSNEWS.frameElementContainer.addEventListener("click",s,!0),t.default.on("feed:ingested:playlist",function(s){if(s.feed&&"top-stories"==s.feed.slug){if(i.pathClicked&&i.pathClicked==s.path){window.clearTimeout(e);var n=s.feed.items[0];s={type:n.type,playlist:n.playlist,video:n,userInitated:!0},t.default.trigger("url:change",s),i.slugClicked=null}if(i.adSlug==s.feed.items[0].slug){var r=s.feed.items[0];i.adHref.payload={type:r.type,playlist:r.playlist,video:r,userInitated:!0,isInjectedAd:!0},i.adSlug=null}}}),window.addEventListener("ads:slotRenderEnded",function(e){var s=e.detail.adUnit.code,n=window.document.getElementById(s).querySelector("a");if(n){var r=function(t){if(t.indexOf("cbsnews.com")>-1){var e=/\/(live)\/([A-Za-z0-9\-]*)?/;if(null!=(i=t.match(e)))return[i[1],i[2]||""];var i;e=/\/video\/([A-Za-z0-9\-]*)/;return["vod",(i=t.match(e))[1]]}return!1}(n.href);i.adHref=n,i.adSlug=r[1];var a=3;window.CBSNEWS.defaultPayload.items[0].isImposter&&a++,t.default.trigger("feed:request:video",{type:r[0],slug:r[1],imposter:!0,strategy:"inject",startPosition:a})}})}.apply(e,s))||(t.exports=n)},function(t,e,i){var s,n;s=[i(32),i(84),i(53)],void 0===(n=function(t,e,s){"use strict";i(0).tag2("uvpjs",'<div id="{containerId}"><div id="content_{containerId}"><video id="video_{containerId}" playsinline></video></div><div id="ad_{containerId}"></div><div id="controls_{containerId}" ref="controls"></div><div class="player-overlay__container is-visible" ref="controlsOverlay"><yield></yield></div><div if="{geoBlock}" class="player-overlay__container is-visible" ref="geoBlockOverlay" riot-style="background-image: url({video && video.images.hd})"><div class="player-overlay player-overlay--geo-block"><svg viewbox="0 0 33 34" class="player-overlay__icon player-overlay__icon--eye" aria-hidden="true"><use xlink:href="#icon-eye"></use></svg><p class="player-overlay__message">Sorry, this content is not available in your region.</p><a class="player-overlay__button" href="/video/">More CBS News Videos</a></div></div><div if="{allAccessBlock}" class="player-overlay__container is-visible" ref="allAccessBlockOverlay" riot-style="background-image: url({video && video.images.hd})"><div class="player-overlay player-overlay--all-access-block"><svg viewbox="0 0 134 16" class="player-overlay__icon player-overlay__icon--all-access" aria-hidden="true"><use xlink:href="#logo-cbs-all-access"></use></svg><p class="player-overlay__message">This video is available on CBS&nbsp;All&nbsp;Access</p><a class="player-overlay__button" href="{video.cbsAllAccessRedirect}" target="_top">Watch Now</a><p class="player-overlay__message player-overlay__message--sm ">60 Minutes All Access subscribers <a href="https://{CBSNEWS.host.secure}/user/login/?appId=1503&amp;redirectUrl={encodeURIComponent(inIframe() ? document.referrer : window.location)}" target="_blank" class="popup-link">CLICK&nbsp;HERE</a></p><p class=" player-overlay__message player-overlay__message--sticky"><a href="{video.cbsAllAccessRedirect}" target="_top">Watch Now</a><a href="https://{CBSNEWS.host.secure}/user/login/?appId=1503&amp;redirectUrl={encodeURIComponent(inIframe() ? document.referrer : window.location)}" target="_blank" class="popup-link">LOG&nbsp;IN</a></p></div></div><div if="{embedBlock}" class="player-overlay__container is-visible" ref="embedBlockOverlay" riot-style="background-image: url({video && video.images.hd})"><div class="player-overlay player-overlay--embed-block"><svg viewbox="0 0 33 34" class="player-overlay__icon player-overlay__icon--eye" aria-hidden="true"><use xlink:href="#icon-eye"></use></svg><p class="player-overlay__message">Sorry, you are not authorized to embed this stream.</p><a class="player-overlay__button" href="/video/" target="blank">More CBS News Videos</a></div></div><div class="player-overlay__container player-overlay--draggable"><div class="player-overlay"><svg class="player-overlay--icon-grid"><use xlink:href="#player-icon-drag"></use></svg><span class="player-overlay__title" if="{video}">{video.title}</span><button class="player-overlay__button player-overlay__button--close" data-target="" aria-label="Disable small player"><svg class="player-overlay__button--icon player-overlay__button--icon-close"><use xlink:href="#player-icon-close"></use></svg></button></div></div></div><div class="player-overlay--draggable-handle"></div>',"",'class="{opts.component}"',function(t){var e=this;window.CBSNEWS.uvpContainerId=this.containerId="uvpjs-container-"+Date.now(),this.eventNamespace=".cbsnewsVideoBundle",this.partner="cbsnews",this.ppProp="desktop"==window.CBSNEWS.device?"&pp=vpaid_js":"&pp=ssai",this.types={dai:window.uvpjs.mediaCapabilities.RP_DAI,live:window.uvpjs.mediaCapabilities.RP_IMA,dvr:window.uvpjs.mediaCapabilities.RP_URL,vod:window.uvpjs.mediaCapabilities.RP_IMA},this.mediaIds={live:"305276483626",dvr:"320600643969",vod:null},this.videoStates={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120},this.systemInfo={},this.isPlayerReady=!1,this.playQueue=null,this.shouldAutoplay=window.CBSNEWS.shouldAutoplay&&window.CBSNEWS.features.isFeatureEnabled("autoplay"),this.playlist=null,this.video=window.CBSNEWS.defaultPayload.items[0],this.geoBlock=null,this.allAccessBlock=null,this.embedBlock=null,this.controlsOverlay,this.geoBlockOverlay,this.allAccessBlockOverlay,this.geo,this.cbsLocalComscoreC3={"newyork.cbslocal.com":"CBSLocalNY","losangeles.cbslocal.com":"CBSLocalLA","boston.cbslocal.com":"CBSLocalBoston","sacramento.cbslocal.com":"CBSLocalSacramentoCA","sanfrancisco.cbslocal.com":"CBSLocalSanFran","denver.cbslocal.com":"CBSLocalDenver","miami.cbslocal.com":"CBSLocalMiami","chicago.cbslocal.com":"CBSLocalChicago","baltimore.cbslocal.com":"CBSLocalBaltimore","detroit.cbslocal.com":"CBSLocalDetroit","minnesota.cbslocal.com":"CBSLocalMinnesota","philadelphia.cbslocal.com":"CBSLocalPhiladelphia","pittsburgh.cbslocal.com":"CBSLocalPittsburgh","dfw.cbslocal.com":"CBSLocalDallas","www.msn.com":"MSN"},this.comscoreC3="CBSNewsBrowser",window.isembed&&window.CBSNEWS.referrerHostname in this.cbsLocalComscoreC3&&(this.comscoreC3=this.cbsLocalComscoreC3[window.CBSNEWS.referrerHostname]),this.uvpcModules={SiteCatalyst:{name:"SiteCatalyst",category:"qos",enabled:!0,params:[{name:"heartbeatAdobePublisherId",value:"10D31225525FF5790A490D4D@AdobeOrg"},{name:"heartbeatVisitorMarketingCloudOrgId",value:"10D31225525FF5790A490D4D@AdobeOrg"},{name:"heartbeatTrackingServer",value:"https://cbsinteractive.hb.omtrdc.net"},{name:"partnerID",value:"cbsnews"}]},ComScore_ss:{name:"ComScore_ss",category:"qos",enabled:!0,params:[{name:"partnerID",value:"cbs"},{name:"c2",value:this.video.tracking.comscore.c2},{name:"c3",value:this.comscoreC3},{name:"c4",value:this.video.tracking.comscore.c4},{name:"c6",value:this.video.tracking.comscore.c6},{name:"ns_st_ge",value:"news"},{name:"ns_ap_an",value:"N/A"}]},MuxQOSPluginJS:{name:"MuxQOSPluginJS",category:"qos",enabled:!0,params:[{name:"propertyKey",value:this.video.muxPropertyKey}]}},this.on("mount",function(){e.dispatch.on("player:player:init",function(t){return e.initVideoPlayer(t.uvpEvent.payload.player)}),e.dispatch.on("player:video:error",e.handleVideoError),e.dispatch.on("player:video:pause",e.pause),e.dispatch.on("player:video:state",e.onVideoResume),e.dispatch.on("player:video:recover",e.play),e.dispatch.on("url:load",e.play),e.dispatch.on("url:change",e.enableAutoplay),window.CBSNEWS.features.executeWithConsent(["uvp"],"essential",e.initPlayer,e),e.controlsOverlay=e.refs.controlsOverlay.parentNode.removeChild(e.refs.controlsOverlay),e.geoBlockOverlay=e.refs.geoBlockOverlay,e.allAccessBlockOverlay=e.refs.allAccessBlockOverlay,e.geo=JSON.parse((0,s.getCookie)("fly_geo"))}),this.onVideoManagerReady=function(t){this.systemInfo=t;var e={enableUnmutedAutoplay:!1};this.shouldAutoplay&&t.supportsUnmutedAutoplay&&(e.enableUnmutedAutoplay=!0),this.dispatch.trigger("player:manager:ready",{systemInfo:t,videoOptions:e});var i=window.uvpjs.EventType;this.videoManager.addEventListener(i.PLAYER_INIT+this.eventNamespace,this.onPlayerInit),this.videoManager.addEventListener(i.PLAYER_START_ERROR+this.eventNamespace,this.onPlayerStartError),this.videoManager.addEventListener(i.VIDEO_START_ERROR+this.eventNamespace,this.onVideoStartError),this.videoManager.addEventListener(i.VIDEO_PLAYBACK_ERROR+this.eventNamespace,this.onVideoPlaybackError),this.videoManager.addEventListener(i.AD_ERROR+this.eventNamespace,this.onAdError),this.videoManager.addEventListener(i.AD_BLOCKED+this.eventNamespace,this.onAdBlocked),this.videoManager.createVideoPlayer(this.containerId,this.onVideoPlayerReady,e)}.bind(this),this.onVideoManagerError=function(t){this.dispatch.trigger("player:manager:error",{uvpEvent:t})}.bind(this),this.initPlayer=function(){this.dispatch.trigger("player:init",{});var t={classes:[],modules:[]};(window.CBSNEWS.features.isFeatureDisabled("consent")||!0===window.CBSNEWS.consentStates.performance)&&t.modules.push(this.uvpcModules.SiteCatalyst,this.uvpcModules.ComScore_ss,this.uvpcModules.MuxQOSPluginJS);var e={netwk:"CBSNEWS",partner:this.partner,uvpc:[t],id3OwnerIds:"com.cbsinteractive.vtg,com.cbsinteractive.cbsnews.cuepoint",usesIMA:!1!==window.CBSNEWS.features.adsIMA,usesTealium:!0,previewImage:null,skin:!0,themeName:"cbsnews-video",customCSS:"data:text/css;base64,LyogdGhpcyBmaWxlIGlzIG9ubHkgbmVlZGVkIHdoaWxlIFVWUC5qcyBkb2VzIG5vdCBzdXBwb3J0IGxvYWRpbmcgd2l0aG91dCBleHRlcm5hbCBDU1MgZGVwZW5kZW5jeSAqLw==",minBitrate:1e5,capLevelToPlayerSize:!0,playsInline:!0,enableReplay:window.isembed,enableMutedAutoplay:!1,enableUnmutedAutoplay:this.shouldAutoplay};window.uvpjs.Configuration.path=window.requirejs.s.contexts._.config.baseUrl+"uvp/",this.videoManager=new window.uvpjs.VideoManager,this.videoManager.initialize(e,this.onVideoManagerReady,this.onVideoManagerError)}.bind(this),this.initVideoPlayer=function(t){if(!this.videoPlayer){this.videoPlayer=t,this.refs.controls.appendChild(this.controlsOverlay);var e=window.uvpjs.EventType;t.addEventListener(e.RESOURCE_START+this.eventNamespace,this.onResourceStart),t.addEventListener(e.AD_START+this.eventNamespace,this.onAdStart),t.addEventListener(e.AD_END+this.eventNamespace,this.onAdEnd),t.addEventListener(e.NO_AD_CONTENT+this.eventNamespace,this.onAdNoContent),t.addEventListener(e.CONTENT_DATA_LOADED+this.eventNamespace,this.onContentDataLoaded),t.addEventListener(e.CONTENT_START+this.eventNamespace,this.onVideoStart),t.addEventListener(e.CONTENT_END+this.eventNamespace,this.onVideoEnd),t.addEventListener(e.VIDEO_DONE+this.eventNamespace,this.onVideoDone),t.addEventListener(e.VIDEO_ERROR+this.eventNamespace,this.onVideoError),t.addEventListener(e.VIDEO_STATE_CHANGE+this.eventNamespace,this.onVideoStateChange),t.addEventListener(e.RESOURCE_END+this.eventNamespace,this.onResourceEnd),this.videoPlayer.canOverrideUserGesture()&&this.videoPlayer.overrideUserGesture()}}.bind(this),this.onVideoPlayerReady=function(t){this.isPlayerReady=!0,this.initVideoPlayer(t),this.dispatch.trigger("player:player:ready",{videoPlayer:t,eventNamespace:this.eventNamespace}),this.playQueue&&this.play(this.playQueue)}.bind(this),this.enableAutoplay=function(t){this.playQueue=null,!1===this.systemInfo.supportsUnmutedAutoplay&&this.videoPlayer.onPreviewButton(this.videoPlayer.onVCIReady.bind(this.videoPlayer)),this.videoPlayer.handleFirstGesture()}.bind(this),this.play=function(t){if(!this.isPlayerReady||t.initialUrlLoad&&!this.shouldAutoplay)return this.playQueue=t,void this.dispatch.trigger("player:player:not-ready",[t,this.isPlayerReady,t.initialUrlLoad,this.shouldAutoplay]);if(1==this.videoPlayer.getCurrentPlaybackState().playbackStarted&&this.video==t.video)this.videoPlayer.playVideo();else if(this.isPlayerReady=!0,this.videoPlayer.destroyPlaylist(),this.videoPlayer.setPageContextMetadata(window.om.getHbParams()),this.video=t.video,!this.shouldShowBlocker(this.video)){var e={};this.addVideoToRco(this.video,e),this.addAdToRco(this.video,e),this.videoPlayer.loadAndPlayResource(e),this.dispatch.trigger("player:player:rco",e)}}.bind(this),this.pause=function(){this.videoPlayer&&this.videoPlayer.pauseVideo()}.bind(this),this.stop=function(){this.videoPlayer.destroyPlaylist()}.bind(this),this.addAdToRco=function(t,e){if(this.shouldShowAd(t)){var i=null;window.CBSNEWS.features.isFeatureEnabled("consent")&&window.cbsoptanon&&window.cbsoptanon.ads.getNpaFlag(function(t){i=t}),"live"!==t.type&&!0===window.CBSNEWS.features.adsIMAloaded?(e.type=window.uvpjs.mediaCapabilities.RP_IMA,e.adCall="//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu="+this.adSlotTargeting(t)+"&ciu_szs=728x90&impl=s&gdfp_req=1&env=vp&output=xml_vmap1&unviewed_position_start=1&url=[referrer_url]&correlator=[timestamp]&vid="+this.adVideoPid(t)+"&cust_params="+window.encodeURIComponent(this.adCustParams(t))+"&cmsid=2289"+this.ppProp,null!==i&&(e.adCall+="&npa="+i)):t.daiAssetId&&!0===window.CBSNEWS.features.adsDAIloaded&&!window.needsflash?(e.type=this.types.dai,e.assetKey=t.daiAssetId,e.adTagParameters={iu:this.adSlotTargeting(t),cust_params:this.adCustParams(t),sz:t.isLocalStream?"320x240":"640x480",ciu_szs:"728x90"},null!==i&&(e.adTagParameters.npa=i),delete e.assetURL,delete e.overrideAssetURL):(e.assetURL+="?iu="+this.adSlotTargeting(t),e.overrideAssetURL+="?iu="+this.adSlotTargeting(t))}}.bind(this),this.addVideoToRco=function(t,e){var i=t.video;if(window.needsflash&&"live"===t.type&&(i=t.video2),e.cmsRefGuid=t.mpxRefId,e.duration=window.parseInt(t.duration),e.type=this.types[t.type],e.mediaId=this.mediaIds[t.type],e.partner=this.partner,e.episodeAbstract=t.dek,e.episodeNumber=t.episode,e.seasonNumber=t.season,e.episodeFlag=null!==t.episode,e.seriesTitle=t.topic.parentTopicName,e.hierarchyByName=t.topic.hierarchyByName.join("/"),e.closedCaptionPath=t.captions,e.isLive="live"===t.type,e.assetURL=i,e.overrideAssetURL=i,window.CBSNEWS.features.isFeatureDisabled("consent")||window.CBSNEWS.consentStates.targeting)for(var s in e.uvpc={},e.uvpc.modules=this.uvpcModules,e.uvpc.modules.ComScore_ss.params){var n=e.uvpc.modules.ComScore_ss.params[s];t.tracking.comscore[n.name]&&(n.value=t.tracking.comscore[n.name])}e.videoTitle=t.fulltitle,e.audioPreviewImageUrl=t.images.hd}.bind(this),this.adVideoPid=function(t){return t.sponsor&&t.sponsor.mpx_id?t.sponsor.mpx_id:t.mpxRefId}.bind(this),this.adCustParams=function(t,e){var i=Object.assign({vid:this.adVideoPid(t),partner:this.partner},window.CBSNEWS.ad.gpt.targeting,e);return Object.keys(i).map(function(t){return t+"="+i[t]}).join("&")}.bind(this),this.adSlotTargeting=function(t){if(t&&t.iu)return t.iu;var e="mobile_web",i="cbsnews_mobile";return"desktop"==window.CBSNEWS.device&&(e="desktop",i="cbsnews"),window.isembed&&"can"!=window.CBSNEWS.tracking.mediaPartnerId&&(i=window.CBSNEWS.tracking.mediaPartnerId.replace(".com","")),["",window.CBSNEWS.ad.gpt.slotVars.network,"vaw-can",e,i].join("/").replace(/ /g,"-")}.bind(this),this.onVideoResume=function(t){"live"!==t.video.type||t.uvpEvent.payload.isAd||t.uvpEvent.payload.newState!==this.videoStates.PLAYING||(this.videoPlayer.seekToLive(),this.dispatch.trigger("player:video:seekToLive",t))}.bind(this),this.adDistanceCount=3,this.adDistanceMicroseconds=48e4,this.adLastTimestamp=0,this.adRotator=0,this.shouldShowAd=function(t){var e=Date.now();"dvr"===t.type?this.adRotator=this.adRotator%this.adDistanceCount+1:this.adRotator=0;var i=!("dvr"===t.type&&!0===t.suppress||"dvr"===t.type&&(null===t.sponsor||null===t.sponsor.mpx_id)&&1!==this.adRotator&&(0===this.adLastTimestamp||e-this.adLastTimestamp<this.adDistanceMicroseconds)||"vod"===t.type&&!0===t.isUserSubscribed&&/^60-minutes/.test(t.topic.slug));return i&&(this.adLastTimestamp=e),this.dispatch.trigger("ad:video:"+i,{adRotator:this.adRotator,time:e-this.adLastTimestamp,type:t.type}),i}.bind(this),this.shouldShowBlocker=function(t){return this.update({geoBlock:!1,allAccessBlock:!0===t.allAccessBlock,embedBlock:window.CBSNEWS.whitelistFailed}),this.dispatch.trigger("player:video:block",{video:t,allAccessBlock:this.allAccessBlock,embedBlock:this.embedBlock,geoBlock:this.geoBlock,geo:this.geo}),this.geoBlock||this.allAccessBlock||this.embedBlock}.bind(this),this.handleVideoError=function(t){var e=t.uvpError,i=t.video;"videoStartError"!==e.type||e.payload.errorInfo.errorCode!==window.uvpjs.ErrorInfo.errorCodes.DAI_SDK_MISSING&&e.payload.errorInfo.errorCode!==window.uvpjs.ErrorInfo.errorCodes.IMA_SDK_MISSING||!i.daiAssetId||(this.types.dai=window.uvpjs.mediaCapabilities.RP_URL,this.types.live=window.uvpjs.mediaCapabilities.RP_URL,i.daiAssetId=void 0,this.dispatch.trigger("player:video:recover",{video:i}))}.bind(this),this.onPlayerInit=function(t){this.dispatch.trigger("player:player:init",{video:this.video,uvpEvent:t})}.bind(this),this.onAdStart=function(t){this.dispatch.trigger("player:ad:start",{video:this.video,uvpEvent:t})}.bind(this),this.onAdPlay=function(t){this.dispatch.trigger("player:ad:play",{video:this.video,uvpEvent:t})}.bind(this),this.onAdNoContent=function(t){this.dispatch.trigger("player:ad:no-content",{video:this.video,uvpEvent:t})}.bind(this),this.onAdEnd=function(t){this.dispatch.trigger("player:ad:end",{video:this.video,uvpEvent:t})}.bind(this),this.onContentDataLoaded=function(t){this.dispatch.trigger("player:content:loaded",{video:this.video,uvpEvent:t})}.bind(this),this.onResourceStart=function(t){this.dispatch.trigger("player:resource:start",{video:this.video,uvpEvent:t})}.bind(this),this.onResourceEnd=function(t){this.dispatch.trigger("player:resource:end",{video:this.video,uvpEvent:t})}.bind(this),this.onVideoDone=function(t){this.dispatch.trigger("player:video:done",{video:this.video,uvpEvent:t})}.bind(this),this.onVideoEnd=function(t){this.dispatch.trigger("player:video:end",{video:this.video,uvpEvent:t})}.bind(this),this.onVideoError=function(t){this.dispatch.trigger("player:video:error",{video:this.video,uvpEvent:t})}.bind(this),this.onVideoProgress=function(t){this.dispatch.trigger("player:video:progress",{video:this.video,uvpEvent:t})}.bind(this),this.onVideoStart=function(t){this.dispatch.trigger("player:video:start",{video:this.video,uvpEvent:t})}.bind(this),this.onVideoStateChange=function(t){this.dispatch.trigger("player:video:state",{video:this.video,uvpEvent:t})}.bind(this),this.onPlayerStartError=function(t){this.dispatch.trigger("player:start:error",{video:this.video,uvpError:t})}.bind(this),this.onVideoStartError=function(t){this.dispatch.trigger("player:video:error",{video:this.video,uvpError:t})}.bind(this),this.onVideoPlaybackError=function(t){this.dispatch.trigger("player:video:error",{video:this.video,uvpError:t})}.bind(this),this.onAdError=function(t){this.dispatch.trigger("player:ad:error",{video:this.video,uvpError:t})}.bind(this),this.onAdBlocked=function(t){this.dispatch.trigger("player:ad:error",{video:this.video,uvpError:t})}.bind(this),window.getVideoAdSessionValues=function(){var t="",i=JSON.parse((0,s.getCookie)(window.CBSNEWS.ad.cookieName)),n=i&&i.session,r=+(null==(0,s.getCookie)("first_page_today")||void 0!==window.firstpgvar&&1==window.firstpgvar),a=window.location.search.slice(1).split("&").reduce(function(t,e){return t[(e=e.split("="))[0]]=window.decodeURIComponent(e[1]),t},{});for(var o in n&&(t+="&session="+n),e.video.suppress&&(t+="&feat=killad"),window.CBSNEWS.ad.useFirstPageTargeting&&(t+="&firstpg="+r),t+="&ptype="+window.CBSNEWS.tracking.pageType,a){var l=o.match(/adTargeting_(.+)/);l&&l[1]&&(t+="&"+l[1]+"="+a[o])}return t.replace(/^&/,"")},this.inIframe=function(){try{return window.self!==window.top}catch(t){return!0}}.bind(this)})}.apply(e,s))||(t.exports=n)},function(t,e,i){var s=i(30),n=i(12);i(85)("keys",function(){return function(t){return n(s(t))}})},function(t,e,i){var s=i(6),n=i(15),r=i(17);t.exports=function(t,e){var i=(n.Object||{})[t]||Object[t],a={};a[t]=e(i),s(s.S+s.F*r(function(){i(1)}),"Object",a)}},function(t,e,i){var s;void 0===(s=function(){"use strict";i(0).tag2("metadata",'<span class="card__label card__label--type-short card__label--type-time-duration">{(opts.isplaying && playerState) ? nowPlayingLabel : label}</span><span class="card__label card__label--type-long card__label--type-time-duration">{(opts.isplaying && playerState) ? nowPlayingLabelLong : liveLabelLong}</span><span class="card__label card__label--type-relative">{riot.mixin(\'formatter\').getRelativeTime(item.timestamp)}</span><span if="{item.type == \'playlist\'}" class="card__label card__label--type-count">{label} video{label !== 1 ? \'s\' : \'\'}</span>',"","",function(t){var e=this;this.item=t.item,this.nowPlayingLabel="now playing",this.nowPlayingLabelLong="now playing",this.parent.parent.root.classList.contains("carousel--slug-ott-live")&&(this.nowPlayingLabel="playing"),window.istouch?this.playerState=!0:this.playerState=null,this.on("mount",function(){e.getLabel(e.item)}),this.dispatch.on("player:video:state",function(t){e.playerState=!0,e.update()}),this.getLabel=function(t){if("live"==t.type){var e=new Date;this.label=this.formatTime(e)}else"vod"==t.type||"dvr"==t.type?this.label=t.durationLabel:"playlist"==t.type?this.label=t.meta.totalCount:"listing"==t.type&&(this.liveLabelLong="live: "+t.title,this.label="live");this.update()}.bind(this),this.formatTime=function(t,e){if(e);else t=new Date(t);if(t.getHours()>12)var i=t.getHours()-12;else i=t.getHours();if(t.getHours()<12)var s="am";else s="pm";return i+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+" "+s}.bind(this)})}.apply(e,[]))||(t.exports=s)},function(t,e,i){var s;void 0===(s=function(){"use strict";i(0).tag2("thumbnail",'<span class="{opts.class}-img img"><img data-srcset="{opts.images.sd} 1x, {opts.images.hd} 2x" riot-src="{opts.images.sd}" srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEAAAAALAAAAAABAAEAAAI=" alt="{opts.alt}" class="lazyload"></span><svg viewbox="0 0 32 32" class="{opts.class}--icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-video"></use></svg>',"","",function(t){})}.apply(e,[]))||(t.exports=s)},function(t,e,i){var s,n;s=[i(34)],void 0===(n=function(t){"use strict";var e=i(0);e.tag2("card",'<a ref="anchor" if="{item.type.indexOf(\'html\') === -1}" class="card__container" href="{item.url}" target="_blank" rel="{relData}"><thumbnail if="{item.images.sd || item.images.hd}" class="card__thumb" images="{item.images}" alt="{title}"></thumbnail><div class="card__heading-wrapper"><h3 if="{title}" class="card__title">{title}</h3></div><span class="card__link" if="{item.linkText}" href="{item.linkUrl}" aria-label="{item.linkText}">{item.linkText}</span><metadata isplaying="{isPlaying}" class="label" component="card" item="{item}" type="{item.type}" relativetime="true"></metadata></a>',"","class=\"card card--type-{item.type} card--type-{imposter} card--type-{opts.classes} card--slug-{item.slug} {'card--is-playing': isPlaying} {'card--is-active': isActive}\"",function(t){var i=this;this.item=t.item,this.title=t.item.title,this.dataIs=null,this.isActive=!1,this.isPlaying=!1,this.relData,1==this.item.isImposter&&(this.imposter="is-imposter"),1==this.item.isExternal&&(this.relData="noopener nofollow"),this.isSheAnAd=function(t){return t.type.indexOf("html")>-1}.bind(this),this.changeOttLiveTitle=function(){if(this.item.items){var t=this.item.items.find(function(t){return"live"===t.type});t&&this.update({title:t.title})}}.bind(this),"ott-live"===this.parent.playlist.slug&&this.item.items&&this.changeOttLiveTitle(),this.dispatch.on("video:video:changed:type-live:"+this.item.id,function(t){i.title!==t.video.title&&i.update({title:t.video.title})}),this.dispatch.on("url:load",function(t){i.update({isActive:t.video&&t.video.id===i.item.id||"live"===t.video.type&&t.video.mpxRefId===i.item.mpxRefId})}),this.dispatch.on("player:video:state",function(t){i.update({isPlaying:("live"===t.video.type&&t.video.mpxRefId===i.item.mpxRefId||"live"!==t.video.type&&t.video.id===i.item.id)&&1===t.uvpEvent.payload.newState})}),this.on("update",function(e){"current"==t.type&&(i.item=t.item),i.refs.anchor&&(i.refs.anchor.payload=i.item)}),this.on("mount",function(){if(i.isSheAnAd(i.item)){var t="html"+Date.now(),s=e.tag(t,i.item.body.replace(/({|})/g,"\\$1"),null,'class="html-container"'),n=window.document.createElement(s);i.root.appendChild(n),e.mount(s)}else i.refs.anchor&&(i.refs.anchor.payload=i.item);"related"===i.parent.opts.component&&i.update({isActive:i.item.id===window.CBSNEWS.defaultPayload.items[0].id})})})}.apply(e,s))||(t.exports=n)},function(t,e,i){var s,n;s=[i(13),i(14),i(36),i(90)],void 0===(n=function(t,e,s,n){"use strict";n=function(t){return t&&t.__esModule?t:{default:t}}(n),i(0).tag2("carousel",'<h2 if="{playlistItems.length && playlist.title}" class="carousel__title" aria-label="{playlist.title}"> {playlist.title} </h2><ad display="{opts.type === \'playlist\' && opts.component === \'hero\'}" slot="sponsor-playlist-logo" categoryslug="{playlist.slug}"></ad><div class="show_{rowsVisible} card__wrapper" ref="list"><ad if="{opts.index === 1}" display="{opts.index === 1}" slot="native-video-shelf" categoryslug="{playlist.slug}" class="card card--type-html-native-ad" index="{opts.index}"></ad><card if="{playlistItems.length}" each="{item, i in playlistItems}" item="{item}" index="{i}" ref="card"></card></div><button if="{playlistItems.length && playlist.id}" aria-role="button" class="carousel__button" ref="loadmore" aria-label="more {playlist.title}" onclick="{handleLoadMore}"> More + </button>',"","id=\"{playlist.slug}\" class=\"carousel carousel--slug-{playlist.slug} carousel--component-{opts.component} carousel--view-{playlist.meta.view} carousel--type-{playlist.type} {'carousel--empty ': isEmpty} {dupe ? 'carousel--is-playing' : ''}\" tabindex=\"0\"",function(t){var e=this;window.addEventListener("resize",(0,n.default)(function(t){return e.dispatch.trigger("window:resize")},250)),this.playlist={id:null,type:t.type,title:null,items:[],meta:{view:null}},this.playlistItems=[],this.defaultRowsVisible=2,this.rowsVisible=window.parseInt(t.rowsvisible)||2,this.dupe=!1,this.isLoadMoreHidden=!0,this.registerComponent=function(){(t.plid||t.slug)&&t.type&&this.playlist.id!==t.plid&&this.dispatch.trigger("register:component",t.playlist)}.bind(this),this.scrollToShelf=function(){if(window.CBSNEWS.originalUrl&&this.playlist.slug&&""!=window.CBSNEWS.originalUrl.hash){var t=window.CBSNEWS.originalUrl.hash.replace(/^#/,""),e=window.document.querySelector(window.CBSNEWS.originalUrl.hash);e&&t===this.playlist.slug&&(window.needsflash?e.scrollIntoView():e.scrollIntoView({behavior:"smooth"}))}}.bind(this),this.showHideLoadMore=function(){if(this.playlist.id&&this.refs.list&&!(this.refs.list.childElementCount<=0)){var t=!1,e=this.refs.list.getElementsByClassName("card");if(e&&e.length>0){var i=!0,s=!1,n=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var o=r.value;if(0===o.offsetWidth&&0===o.offsetHeight){if(o.classList.contains("card--type-html-native-ad")||o.classList.contains("card--is-playing")||o.classList.contains("card--type-is-imposter"))continue;t=!0;break}}}catch(t){s=!0,n=t}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}}this.refs.loadmore&&(t?this.refs.loadmore.classList.remove("carousel__button--hidden"):this.refs.loadmore.classList.add("carousel__button--hidden"))}}.bind(this),this.isDuplicate=function(e){e.video.playlist.id==t.plid!==this.dupe&&this.update({dupe:e.video.playlist.id==t.plid})}.bind(this),this.dispatch.on("player:ad:start",this.isDuplicate),this.dispatch.on("player:video:start",this.isDuplicate),this.dispatch.on("url:load",this.isDuplicate),this.dispatch.on("window:resize",this.showHideLoadMore),this.dispatch.on("video:data:changed",function(i){if(i.playlist.id===t.plid){var s={};e.playlist.id&&t.plid===e.playlist.id||(s=e.setDefaultRowsVisible(i.playlist.meta.view)),s.playlist=i.playlist,s.playlistItems=e.getItems(i.playlist),e.isEmpty=i.playlist.emptyPlaylist,e.update(s)}}),this.on("mount",this.registerComponent),this.on("update",this.registerComponent),this.on("updated",this.showHideLoadMore),this.on("updated",this.scrollToShelf),this.on("updated",function(){e.dispatch.trigger("video:data:rendered",{playlist:e.playlist,playlistItems:e.playlistItems})}),this.handleLoadMore=function(t){t.preventUpdate=!0;var e=this.rowsVisible;this.rowsVisible<8&&"all"!=this.rowsVisible?e+=this.defaultRowsVisible:e="all",this.update({rowsVisible:e})}.bind(this),this.setDefaultRowsVisible=function(e){var i={};return"playlists"===e?(i.defaultRowsVisible=1,i.rowsVisible=1):"slider"==t.component?i.rowsVisible="all":(i.defaultRowsVisible=2,i.rowsVisible=2),i}.bind(this),this.getItems=function(e){return"slider"===t.component||"hero"===t.component?e.items.filter(function(t){return-1===t.type.indexOf("html")}).filter(function(t){return!0!==t.isImposter}):e.items.filter(function(t){return!0!==t.isImposter})}.bind(this)})}.apply(e,s))||(t.exports=n)},function(t,e){t.exports=function(t,e){var i=null;return function(){window.clearTimeout(i);var s=arguments,n=this;i=window.setTimeout(function(){t.apply(n,s)},e)}}},function(t,e,i){var s;void 0===(s=function(){"use strict";i(0).tag2("slider",'<button hide="{lessThanLimit}" class="slider__controls slider__controls--prev" onclick="{previous}" ref="prevBtn"><svg width="47" height="47" viewbox="0 0 47 47" xmlns="http://www.w3.org/2000/svg"><title>buttons/button-playertray-right</title><g fill="none" fill-rule="evenodd"><path d="M0 4.007C0 1.794 1.785 0 4.007 0H47v47H4.007C1.794 47 0 45.215 0 42.993V4.007z" fill="#F5F5F5"></path><path stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M22 17l7 6.776L22 30"></path></g></svg></button><button hide="{lessThanLimit}" class="slider__controls slider__controls--next" onclick="{next}" ref="nextBtn"><svg width="47" height="47" viewbox="0 0 47 47" xmlns="http://www.w3.org/2000/svg"><title>buttons/button-playertray-right</title><g fill="none" fill-rule="evenodd"><path d="M0 4.007C0 1.794 1.785 0 4.007 0H47v47H4.007C1.794 47 0 45.215 0 42.993V4.007z" fill="#F5F5F5"></path><path stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M22 17l7 6.776L22 30"></path></g></svg></button><carousel ref="slider" if="{playlist.id}" component="{opts.component}" plid="{playlist.id}" slug="{playlist.slug}" type="{playlist.type}" playlist="{playlist}"></carousel>',"",'class="slider slider--slug-{playlist.slug}"',function(t){var e=this;this.playlist={id:null,slug:"ott-latest",items:[]},this.limit=window.parseInt(t.limit),this.margin=window.parseInt(t.margin),this.lessThanLimit=!0,this.dispatch.on("url:load",function(t){e.update({playlist:t.video.playlist})}),"related"===t.component&&(this.update({playlist:window.CBSNEWS.defaultPayload}),this.dispatch.on("url:change",function(t){e.scrollToCard(e.wrapper,t.video.slug)})),this.dispatch.on("player:player:fullscreen",function(){var t=e.playlist.id;if(t){var i=e.refs.slider.refs.list;e.scrollOver(i,t,e.playlist.items.length,e.isFullScreen())}}),this.dispatch.on("video:data:changed",function(t){if(!e.playlist||e.playlist.id===t.playlist.id){e.update({playlist:t.playlist,lessThanLimit:e.playlist.items.length<=e.limit});var i=e.playlist.id;if(i){var s=e.refs.slider.refs.list;e.scrollOver(s,i,t.playlist.items.length,e.isFullScreen())}}}),this.isFullScreen=function(){return!!(window.document.fullscreenElement||window.document.webkitFullscreenElement||window.document.mozFullScreenElement||window.document.msFullscreenElement)}.bind(this),this._getTranslateValue=function(t){var e=window.getComputedStyle(t).transform;return"none"===e?"none":+e.split("(")[1].split(")")[0].split(",")[4]}.bind(this),this.on("updated",function(){e.playlist&&e.refs.slider&&e.tags.carousel.on("updated",function(){if(e.refs.slider.refs.list&&e.root.querySelector(".card")){var t=e.refs.slider.root.querySelectorAll(".card__wrapper .card");Math.round(e.root.querySelector(".card").offsetWidth),e.margin;t.length,e.limit,e.playlist.id;try{Math.round(e.root.querySelector(".card").offsetWidth),e.wrapper=e.refs.slider.root.querySelector(".card__wrapper")}catch(t){}}})}),this.scrollToCard=function(t,e){if(t&&e){var i=this.wrapper.querySelector(".card--slug-"+e);if(i){this.refs.nextBtn.classList.remove("slider__controls--hidden"),this.refs.prevBtn.classList.remove("slider__controls--hidden"),t.style.transform="translateX(-"+i.offsetLeft+"px)";var s=window.parseInt(i.getAttribute("index"))+1;this.playlist.items.length-s<=this.limit&&this.refs.nextBtn.classList.add("slider__controls--hidden"),1===s&&this.refs.prevBtn.classList.add("slider__controls--hidden")}}}.bind(this),this.scrollOver=function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t){var n=this.root.querySelector(".card");if(n)var r=Math.round(n.offsetWidth)+this.margin;else r=335;var a=window.document.body.offsetWidth,o=r*i,l=o-r*this.limit;if(this._getTranslateValue(t),this.refs.nextBtn.classList.remove("slider__controls--hidden"),this.refs.prevBtn.classList.remove("slider__controls--hidden"),this.update({lessThanLimit:s&&o<a}),0===e.indexOf("fusion-")){s&&(l=o-window.document.body.offsetWidth);try{t.style.transform="translateX(-"+l+"px)",this.refs.nextBtn.classList.add("slider__controls--hidden")}catch(t){}}else try{t.style.transform="translateX(0)",this.refs.prevBtn.classList.add("slider__controls--hidden")}catch(t){}}}.bind(this),this.scrollTo=function(t,e){var i=window.document.fullscreenElement||window.document.webkitFullscreenElement||window.document.mozFullScreenElement||window.document.msFullscreenElement,s=this.refs.slider.root.querySelectorAll(".card__wrapper .card"),n=Math.round(this.root.querySelector(".card").offsetWidth)+this.margin,r=n*s.length,a=this._getTranslateValue(t),o=0;this.refs.nextBtn.classList.remove("slider__controls--hidden"),this.refs.prevBtn.classList.remove("slider__controls--hidden");var l=r+a-n*this.limit;i&&(l=r+a-i.offsetWidth);var d=Math.abs(a);"previous"==e?(Math.abs(a)<450?(o=n-Math.abs(a),i&&d<=n&&(this.refs.prevBtn.classList.add("slider__controls--hidden"),o=0),d===n&&this.refs.prevBtn.classList.add("slider__controls--hidden")):Math.abs(a)<1005?(o=2*n-Math.abs(a),i&&d<=2*n&&(this.refs.prevBtn.classList.add("slider__controls--hidden"),o=0),d===2*n&&this.refs.prevBtn.classList.add("slider__controls--hidden")):(o=3*n-Math.abs(a),d===3*n&&this.refs.prevBtn.classList.add("slider__controls--hidden")),t.style.transform="translateX("+o+"px)"):(l<400?(o=n-a,i&&l<450&&(this.refs.nextBtn.classList.add("slider__controls--hidden"),o=d+l),l===n&&this.refs.nextBtn.classList.add("slider__controls--hidden")):l<1005?(o=2*n-a,i&&l<1005&&(this.refs.nextBtn.classList.add("slider__controls--hidden"),o=d+l),l===2*n&&this.refs.nextBtn.classList.add("slider__controls--hidden")):(o=3*n-a,l===3*n&&this.refs.nextBtn.classList.add("slider__controls--hidden")),t.style.transform="translateX(-"+o+"px)")}.bind(this),this.whichTransitionEvent=function(){var t,e=window.document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in i)if(void 0!==e.style[t])return i[t]}.bind(this),this.previous=function(){var t=this.whichTransitionEvent(),e=this;this.refs.prevBtn.classList.add("slider__controls--disable"),this.wrapper.addEventListener(t,function(){e.refs.prevBtn.classList.remove("slider__controls--disable")}),this.scrollTo(this.wrapper,"previous")}.bind(this),this.next=function(){var t=this.whichTransitionEvent(),e=this;this.refs.nextBtn.classList.add("slider__controls--disable"),this.wrapper.addEventListener(t,function(){e.refs.nextBtn.classList.remove("slider__controls--disable")}),this.scrollTo(this.wrapper,"next")}.bind(this)})}.apply(e,[]))||(t.exports=s)},function(t,e,i){var s;void 0===(s=function(){"use strict";i(0).tag2("inline-overlay",'<a if="{video}" class="overlay" ref="overlay" href="{video.url}" draggable="false" ondragstart="return false;" data-stay-inside-embed><div class="overlay__preview"><video class="lazyload" ref="videoPreview" muted="{true}" autoplay playsinline data-poster="{video.images.hd}" loop="{video.type === \'vod\'}" data-hls-wrapper data-preview-url="{previewUrl}"><source type="{video.type == \'live\' ? \'application/vnd.apple.mpegURL\' : \'video/mp4\'}"></video></div><div class="overlay__gradient"></div><div class="overlay__wrapper"><div show="{video.type === \'live\'}" class="overlay__title">{liveStreamTitle}</div><div class="overlay__play"><svg viewbox="0 0 32 32" aria-hidden="true" class="icon icon--play"><use xlink:href="#icon-video"></use></svg><svg viewbox="0 0 32 32" aria-hidden="true" class="icon icon--unmute"><use xlink:href="#icon-unmute"></use></svg></div><h3 class="overlay__hed" data-is="overlay-headline" title="{video.title}" slug="{video.slug}" type="{video.type}"> {video.title} </h3><span class="overlay__metadata"><span if="{video.type !== \'live\'}" class="overlay__timestamp"> {riot.mixin(\'formatter\').getRelativeTime(video.timestamp)} </span><span hide="{video.type === \'live\'}" class="overlay__duration"><span class="icon icon--video"><svg viewbox="0 0 32 32" aria-hidden="true"><use xlink:href="#icon-video"></use></svg></span> {video.durationLabel} </span></span></div></a><button class="overlay__button overlay__button--close" aria-label="Stop video and close player" onclick="{closePlayer}"><svg viewbox="0 0 32 32" class="overlay__button--icon overlay__button--icon-close"><use xlink:href="#icon-close"></use></svg></button>',"","",function(t){var e=this;this.video=null,this.previewUrl=null,this.previewImage=null,this.componentTitle,this.liveStreamTitle="CBSN Live",this.closePlayer=function(){this.dispatch.trigger("player:video:pause",{video:this.video}),this.dispatch.trigger("player:player:closed",{video:this.video})}.bind(this),this.dispatch.on("url:load",function(t){e.update({previewUrl:t.video.previewUrl,previewImage:t.video.images.hd,video:t.video}),e.refs.videoPreview.classList.add("lazyload"),e.refs.overlay.payload=t.video})})}.apply(e,[]))||(t.exports=s)},function(t,e,i){var s;void 0===(s=function(){"use strict";i(0).tag2("overlay-headline","<virtual> {headline} </virtual>","","",function(t){var e=this;this.headline=t.title,this.slug=t.slug,this.type=t.type,this.onLiveItemChange=function(t){console.log("update:live",t.video),this.update({headline:t.video.title})}.bind(this),this.on("mount",function(){"live"==e.type&&e.dispatch.on("video:video:changed:type-live",e.onLiveItemChange)})})}.apply(e,[]))||(t.exports=s)},function(t,e,i){var s;void 0===(s=function(){"use strict";i(0).tag2("raw","<span></span>","","",function(t){this.root.innerHTML=t.html||"",this.on("update",function(){this.root.innerHTML=t.html||""})})}.apply(e,[]))||(t.exports=s)},function(t,e,i){t.exports=i(96)},function(t,e,i){var s,n;s=[i(1),i(0),i(55),i(65),i(74),i(83),i(86),i(87),i(88),i(89),i(91),i(92),i(93),i(94)],void 0===(n=function(t,e,i,s,n,r,a,o,l,d,u,h,c,p){"use strict";function f(t){return t&&t.__esModule?t:{default:t}}t=f(t),e=f(e),r=f(r),a=f(a),o=f(o),l=f(l),d=f(d),u=f(u),h=f(h),c=f(c),p=f(p);var v=window.CBSNEWS.defaultPayload,g=v.items[0],_=(window.hashParams.autoplay,0==window.hashParams.autoplay),E=!(!v.meta||!v.meta.view),m=E&&/^video_shelf/.test(window.CBSNEWS.defaultPayload.meta.view),A=/^(60-minutes|48-hours)/.test(g.topic.slug),y="live"==g.type;new s.VideoStore,y||(new i.VideoFeedAdapter,A&&_||E&&!m||t.default.trigger("feed:request:playlist",v)),(0,n.beforeInitialTagMount)(),e.default.mount("inline-overlay"),e.default.mount("uvpjs"),window.hashParams.tracking.articleType&&"content_article"===window.hashParams.tracking.articleType&&"lead"===window.hashParams.tracking.mediaPositionType&&e.default.mount("slider",{component:"related",limit:4,margin:20})}.apply(e,s))||(t.exports=n)}])}),window.CBSNEWS.features.executeWithConsent(["chartbeat"],"performance",function(){window._sf_startpt=window._sf_startpt||(new Date).getTime(),window._sf_async_config=window._sf_async_config||{},window._sf_async_config.uid="64660",window._sf_async_config.domain="cbsnews.com",window._sf_async_config.autoDetect=!1;var t=function(){window._sf_async_config.flickerControl=!1,window._sf_async_config.useCanonical=!0,window._sf_async_config.authors=window.CBSNEWS.tracking.articleAuthorName,window===window.top&&(window._sf_async_config.playerdomain=window.location.hostname),"app"===window.CBSNEWS.device&&(window._sf_async_config.mobileApp=!0),window._sf_async_config.sections=window.CBSNEWS.tracking.siteHier,window._sf_async_config.sections=["page-"+window.CBSNEWS.tracking.pageType].concat(window.CBSNEWS.tracking.siteHier,window.CBSNEWS.tracking.allTopics||[],window.CBSNEWS.tracking.collectionName||[],window.CBSNEWS.tracking.hasVideo?[]:"novideo").map(function(t){return t.replace(/\s+/g,"-")}).filter(function(t,e,i){return i.indexOf(t)===e}).join(","),window._sf_async_config.type=window.CBSNEWS.tracking.pageType,window._sf_async_config.virtual_page_path=window.location.pathname,window._sf_async_config.virtual_page_title=window.document.title};window.CBSNEWS.tracking.noViewTrack||(t(),window.addEventListener("tracking:view",function(){t(),window.pSUPERFLY&&window.pSUPERFLY.virtualPage(window._sf_async_config.virtual_page_path,window._sf_async_config.virtual_page_title)})),/(front_door|collection_door|show_door|topic_door)/.test(window.CBSNEWS.tracking.pageType)&&window===window.top?window.require(["https://static.chartbeat.com/js/chartbeat_mab.js#"],function(){window.require(["https://static.chartbeat.com/js/chartbeat_video.js#"],function(){window._sf_endpt=(new Date).getTime()})}):window.require(["https://static.chartbeat.com/js/chartbeat_video.js#"],function(){window._sf_endpt=(new Date).getTime()})}),window.define("third-party/chartbeat",function(){}),window.CBSNEWS.features.executeIfEnabled(["mpulse"],function(){var t=window.CBSNEWS.mpulse.keys,e=/(\w+\.\w+)$/.exec(window.location.host),i=t["cbsnews.com"];if(e&&e[0]&&e[0]in t&&(i=t[e[0]]),!(window.BOOMR&&(window.BOOMR.version||window.BOOMR.snippetExecuted)||/MRA58N/i.test(window.navigator.userAgent))){window.BOOMR=window.BOOMR||{},window.BOOMR.snippetStart=(new Date).getTime(),window.BOOMR.snippetExecuted=!0,window.BOOMR.snippetVersion=12,window.BOOMR_config=window.BOOMR_config||{},window.BOOMR_config.History={enabled:!1},/(Android 6\.0\.1|Lighthouse)/i.test(window.navigator.userAgent)&&(window.BOOMR_config.Errors=window.BOOMR_config.Errors||{},window.BOOMR_config.Errors.monitorTimeout=!1,window.BOOMR_config.Errors.monitorEvents=!1),window.BOOMR.url="https://c.go-mpulse.net/boomerang/"+i;var s=window.document.currentScript||window.document.getElementsByTagName("script")[0],n=!1,r=window.document.createElement("link");r.relList&&"function"==typeof r.relList.supports&&r.relList.supports("preload")&&"as"in r?(window.BOOMR.snippetMethod="p",r.href=window.BOOMR.url,r.rel="preload",r.as="script",r.addEventListener("load",function(){if(!n){var t=window.document.createElement("script");t.id="boomr-scr-as",t.src=window.BOOMR.url,t.async=!0,s.parentNode.appendChild(t),n=!0}}),r.addEventListener("error",function(){a(!0)}),window.setTimeout(function(){n||a(!0)},3e3),window.BOOMR_lstart=(new Date).getTime(),s.parentNode.appendChild(r)):a(!1),window.addEventListener?window.addEventListener("load",o,!1):window.attachEvent&&window.attachEvent("onload",o)}function a(t){n=!0;var e,i,r,a,o=window.document,l=window;if(window.BOOMR.snippetMethod=t?"if":"i",i=function(t,e){var i=o.createElement("script");i.id=e||"boomr-if-as",i.src=window.BOOMR.url,window.BOOMR_lstart=(new Date).getTime(),(t=t||o.body).appendChild(i)},!window.addEventListener&&window.attachEvent&&window.navigator.userAgent.match(/MSIE [67]\./))return window.BOOMR.snippetMethod="s",void i(s.parentNode,"boomr-async");(r=window.document.createElement("IFRAME")).src="about:blank",r.title="",r.role="presentation",r.loading="eager",(a=(r.frameElement||r).style).width=0,a.height=0,a.border=0,a.display="none",s.parentNode.appendChild(r);try{l=r.contentWindow,o=l.document.open()}catch(t){e=window.document.domain,r.src="javascript:var d=document.open();d.domain='"+e+"';void(0);",l=r.contentWindow,o=l.document.open()}e?(o._boomrl=function(){this.domain=e,i()},o.write("<body onload='document._boomrl();'>")):(l._boomrl=function(){i()},l.addEventListener?l.addEventListener("load",l._boomrl,!1):l.attachEvent&&l.attachEvent("onload",l._boomrl)),o.close()}function o(t){window.BOOMR_onload=t&&t.timeStamp||(new Date).getTime()}}),window.define("third-party/mpulse",function(){}),window.require(["fly/libs/uuid.v4"],function(){window.CBSNEWS.tracking.pageViewGuid=window.uuid.v4()}),window.require(["common/consent"]),window.require(["common/lazysizes"]),window.require(["video/common","video/main-embed"]),window.require(["third-party/chartbeat"]),window.require(["third-party/mpulse"]),window.define("main.video-embed",function(){}); })();