a
b
a
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
x
xxx
<!DOCTYPE html>
<script>

/*

This omni stringifier works in a multi step way

Reads: This is handled in a single step way, mostly like JSON.stringify, only difference being, it also handles functions, symbols and custom objects
Writes: 
This has two steps 
step 1: You don't actually stringify the object, you replace every reference inside the object with an object id, and return a new object 
example: {1:d} => {1:{__dynId: 2}}, a = > {__dynId: 4};

step 2: You iterate through the object, and convert every id into the actual path, or if no id is there, you simply stringify it like before

*/


(function() {
  var scope,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype; return child; };

  scope = this;

  var objectToId = new WeakMap();
  var idToObject = new Map();


  var tracer; 
  var objectUID = 1;

function createXPathFromElement(elm) { 
    // var allNodes = document.getElementsByTagName('*'); 
    for (var segs = []; elm && (elm.nodeType == 1 || elm.nodeType == 3); elm = elm.parentNode) 
    { 
        /*if (elm.hasAttribute && elm.hasAttribute('id')) { 
                var uniqueIdCount = 0; 
                for (var n=0;n < allNodes.length;n++) { 
                    if (allNodes[n].hasAttribute('id') && allNodes[n].id == elm.id) uniqueIdCount++; 
                    if (uniqueIdCount > 1) break; 
                }; 
                if ( uniqueIdCount == 1) { 
                    segs.unshift('id("' + elm.getAttribute('id') + '")'); 
                    return segs.join('/'); 
                } else { 
                    segs.unshift(elm.localName.toLowerCase() + '[@id="' + elm.getAttribute('id') + '"]'); 
                } 
        } else if (elm.hasAttribute && elm.hasAttribute('class')) { 
            segs.unshift(elm.localName.toLowerCase() + '[@class="' + elm.getAttribute('class') + '"]'); 
        } else { */
          if (elm.localName) {
            for (i = 1, sib = elm.previousSibling; sib; sib = sib.previousSibling) { 
                if (sib.localName == elm.localName)  i++; }; 
                segs.unshift(elm.localName.toLowerCase() + '[' + i + ']'); 
          } else {
            for (i = 1, sib = elm.previousSibling; sib; sib = sib.previousSibling) { 
                if (sib.nodeType == 3)  i++; }; 
                segs.unshift("text()" + '[' + i + ']'); 
          }
        // }; 
    }; 
    return segs.length ? '/' + segs.join('/') : null; 
}; 

function lookupElementByXPath(path) { 
    var evaluator = new XPathEvaluator(); 
    var result = evaluator.evaluate(path, document.documentElement, null,XPathResult.FIRST_ORDERED_NODE_TYPE, null); 
    return  result.singleNodeValue; 
} 


  function stringify(obj) {
        try {
            return JSON.stringify(obj, function (key, value) {
              if (value && value.__isProxy)
                    value = value.__target;
              var fnBody;
              if (value instanceof Function || typeof value == 'function') {

                if ((/\{\s*\[native code\]\s*\}/).test(value.toString())) {
                    return value.name;
                }
                fnBody = value.toString();

                if (fnBody.length < 8 || fnBody.substring(0, 8) !== 'function') { /*this is ES6 Arrow Function*/
                  return '_NuFrRa_' + fnBody;
                }
                return fnBody;
              }
              if (value instanceof RegExp) {
                return '_PxEgEr_' + value;
              }
              return value;
            });
        } catch(e){
            return e;
        }
    };

  (function(definition) {
      return scope.Omni = definition();
  })(function() {
    var ContextResolver, Omni, MultiResolver, Resolver, Util;
    Util = {
      d2h: function(d) {
        return d.toString(16);
      },
      h2d: function(h) {
        return window.__tracerParseInt(h, 16);
      },
      supportsProto: {}.__proto__ != null,
      supportsFunctionNames: typeof (function() {}).name === "string"
    };
    Util.functionName = Util.supportsFunctionNames ? function(func) {
        if (func)
            return func.name;
        else return func
    } : function(func) {
      var _ref;
      return (_ref = func.toString().match(/function ([^(]*)/)) != null ? _ref[1] : void 0;
    };
    Util.isArray = Array.isArray ? Array.isArray : function(arr) {
      return Object.prototype.toString.call(arr) === "[object Array]";
    };
    Omni = (function() {

      Omni.name = 'Omni';

      Omni.NonPrototypeFunctionError = (function(_super) {

        __extends(NonPrototypeFunctionError, _super);

        NonPrototypeFunctionError.name = 'NonPrototypeFunctionError';

        function NonPrototypeFunctionError(object, name) {
          this.object = object;
          this.name = name;
          this.message = "[OMNI] Couldn't serialize object; had non-prototype function '" + this.name + "'";
        }

        return NonPrototypeFunctionError;

      })(Error);

      Omni.PrototypeNotFoundError = (function(_super) {

        __extends(PrototypeNotFoundError, _super);

        PrototypeNotFoundError.name = 'PrototypeNotFoundError';

        function PrototypeNotFoundError(object, cons_id) {
          this.object = object;
          this.cons_id = cons_id;
          this.message = "[OMNI] Prototype not found for object; looked for " + this.cons_id;
        }

        return PrototypeNotFoundError;

      })(Error);

      Omni.AnonymousConstructorError = (function(_super) {

        __extends(AnonymousConstructorError, _super);

        AnonymousConstructorError.name = 'AnonymousConstructorError';

        function AnonymousConstructorError(object) {
          this.object = object;
          this.message = "[OMNI]Couldn't resolve constructor name; seems it has an anonymous constructor and object's prototype has no #constructor_name property to provide hints";
        }

        return AnonymousConstructorError;

      })(Error);

      Omni.VersionInstancePropertyError = (function(_super) {

        __extends(VersionInstancePropertyError, _super);

        VersionInstancePropertyError.name = 'VersionInstancePropertyError';

        function VersionInstancePropertyError(object) {
          this.object = object;
          this.message = "[OMNI]Objects can't have versions on the instances; can only be on the prototype";
        }

        return VersionInstancePropertyError;

      })(Error);

      Omni.DOMConstructorError = (function(_super) {

        __extends(DOMConstructorError, _super);

        DOMConstructorError.name = 'DOMConstructorError';

        function DOMConstructorError(object) {
          this.object = object;
          this.message = "[OMNI] can't serialize dom|cssom objects";
        }

        return DOMConstructorError;

      })(Error);

      Omni.DOMXMLPathError = (function(_super) {
        __extends(DOMXMLPathError,_super);

        DOMXMLPathError.name = 'DOMXMLPathError';
        function DOMXMLPathError(object){
          this.object = object;
          this.message = "[OMNI] can't find dom using xml path";
        }
        return DOMXMLPathError;
      })(Error)

      function Omni(resolver) {
        this.resolver = resolver != null ? resolver : null;
        if (!(this.resolver != null)) {
          if (typeof window === "undefined") {
            throw new Error("[OMNI] A context-resolver is required in non-browser environments");
          }
          this.resolver = new ContextResolver(scope);
        }
        this.errorHandler = function(e) {
          throw e;
        };
        this.migrations = {};
      }

      var isDOMInheritedProperty = function(method){
        return method && (method instanceof EventTarget || method instanceof HTMLCollection || method instanceof NodeList || method.readState
            /*|| method.click || method.appendData*/) /*&& (method && method.self != method)*/
      }


      Omni.prototype.assignId = function(obj){
        if (!obj) return;
        var _id = objectToId.get(obj);
        if (!_id) {
            // Object.defineProperty(obj, "__Omni_id", {
            //     value : Util.d2h(this.counter++),
            //     writable: false,
            //     configurable: false, 
            //     enumerable: false
            // })
            _id = Util.d2h(this.counter++);
            objectToId.set(obj, _id);
        }
        return _id;
      }

      var handleProxyObjs = function(obj){
        var objId = __tracer.getIdFromProxy(obj);
        if (objId == null) return;
        var nodeId = obj.__debug || __tracer.getShadowStackHead();
        if (!nodeId) return;
        var writeLog = __tracer.getInvocationToWrites();
        if (!writeLog[nodeId])
          writeLog[nodeId] = [];
        var isBrokenReference;
        if (writeLog[nodeId]){
          writeLog[nodeId].forEach((entry)=>{
            if (entry[0] == "broken-reference" && entry[1]== objId)
              isBrokenReference = true;
          })
        }
        if (isBrokenReference)
          return null;
        writeLog[nodeId].push([obj.__isProxy, objId]);
        return {__dynId:objId, state: obj.__isProxy, nodeId: obj.__debug};
      }

      var handleProxyIds = function(id,state,nodeId){
        var path = __tracer.getPathFromProxyId(id,state,nodeId);
        if (path)
           return {__dynPath: path};
      }

      Omni.prototype.counter = 0;

      var OMNI_SIZE_LIMIT=10000;
      Omni.prototype.size = 0;

      var customStringify = function(input){
        var ignoreLSKeys = ["fnCacheExists","keyMap","signature"]
        return JSON.stringify(input, function(key, value){
            if (ignoreLSKeys.indexOf(key)<0)
              return value;
        })
      }

      function isNative(fn) {
        return (/\{\s*\[native code\]\s*\}/).test('' + fn);
      }

      function exposeClosureScope(input, closureStringifier, seen_objs){
        var clObj = input.__getScope__ && input.__getScope__();
        if (!clObj){
          //If global function, then alright to not have scope exposed since it
          // is not a closure function. Otherwise, error 
          if (input.name && window[input.name] == input)
            return "";
          else throw new Error("Closure scope could not be exposed"); 
        }
        var closureStr = {};
        Object.keys(clObj).forEach((k)=>{
          if (k.indexOf("set")>=0 || k == "__isClosureObj"
            || input == clObj[k]) return;
          closureStr[k] = clObj[k];
          // closureStr += " var " + k + " = " + stringifier(clObj[k],"read",2) + ";";
        })
        return closureStringifier.stringify(closureStr,"write",2, seen_objs);
      }

      /*
        Returns a an array where the first index is the stringified value is non primitive
        otherwise the value itself. The second indicates whether the input was a primitive data
        type
      */
      Omni.prototype.stringify = function(input,state,stage, seen_objs) {
        try {

          var arr, i, result, output,_id;

          var seen_objs;
          if (!seen_objs)
            seen_objs = new Set();
          else seen_objs = seen_objs;
          this.size = 0;
          this.processed_inputs = [];
          var strDelim = ";;&;;";
          var emptyFn = function(a){return a};
          var stringify = state == "read" || stage == 2 ? function(o,skipMD){
            var str = JSON.stringify(o);
            if (state != "read" || skipMD)
              return str;
            var finalStr;
            if (o && Array.isArray(o)){
              finalStr = str + strDelim + "array" + strDelim + Object.keys(o).length + strDelim + o.__proto__.constructor.name;
            } else if( o && typeof o == "object")
              finalStr = str + strDelim + typeof o + strDelim + Object.keys(o).length + strDelim + o.__proto__.constructor.name;
            else if (o) finalStr = str + strDelim + typeof o + strDelim + o.__proto__.constructor.name;
            else finalStr = str;
            return finalStr;
          }: emptyFn; 
          var primStringify = state == "read" || stage == 2 ? function (a){
            return [a + strDelim + typeof a,true];
          } : function (a){
            return a;
          };
          var _encodeURI = state == "read" || stage == 2 ? encodeURI : emptyFn; 

          if (state == "write" && stage == 1 && input && input.__isProxy){
            var _ret = handleProxyObjs(input);
            if (_ret) return stringify(_ret);
          } else if (state == "write" && stage == 2 && input && input.__dynId){
            var _ret = handleProxyIds(input.__dynId, input.state, input.nodeId);
            if (_ret) return stringify(_ret);
          }

          if (input && input.__isProxy)
              input = input.__target;

          if (input && input instanceof Storage)
            return customStringify(input);

          result = (function() {
            var _i, _len;
            switch (typeof input) {
              case "number":
              case "boolean":
                return primStringify(input);
              case "string":
                return primStringify((input));
              case "symbol":
                if (state == "write") 
                  throw new Error("[OMNI] can't serialize symbols");
                else return "";
                break;
              case "function":
                // if (state == "write") 
                //   throw new Error("[OMNI] can't serialize functions");
                if (state == "read") return "__func__source";
              default:
                if (state == "write")
                  _id = this.assignId(input);
                if (isDOMInheritedProperty(input)){
                  __tracer.updateDC();
                  var dom2json = {};
                  dom2json.xpath = createXPathFromElement(input);
                  /*Not an accurate check since some documents objects don't
                   satisfy this condition, hence commenting*/
                  if (input.__proto__.constructor.name == "HTMLDocument") {
                    // dom2json = domJSON.toJSON(input,{
                    //   deep: false,
                    //   attributes : ['id'],
                    //   domProperties: false,
                    // });
                    if (state == "write") 
                      dom2json.document = true;
                  }
                  if (state == "write") {
                    dom2json.__Omni_id = _id;
                    dom2json.__Omni_type = "DOM";
                  }
                
                  return stringify(dom2json,true);
                }
                // try {
                //   var __s =  JSON.stringify(input);
                // } catch (e){
                //   if (e.name == "TypeError")
                //     throw new Error("circular Object error");
                // }
                if (Util.isArray(input)) {
                  seen_objs.add(input);
                  arr = [];
                  for (_i = 0, _len = input.length; _i < _len; _i++) {
                    i = input[_i];
                    arr.push(this.analyze(i,state,seen_objs,stage));
                  }
                  // if (state == "write") 
                    // arr.push({__Omni_id:_id});
                  // arr.__Omni_id = input.__Omni_id;
                  return stringify(arr);
                } else {
                  // seen_objs.add(input);
                  output = this.analyze(input,state,seen_objs,stage);
                  if (output == null)
                    return primStringify(output);
                  return stringify(output);
                }
            }
          }).call(this);
          return result;
        } catch (e){
            return e;
        }
      };

      Omni.prototype.cleanAfterStringify = function() {
        var input, _i, _len, _ref;
        _ref = this.processed_inputs;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          input = _ref[_i];
          if (input) {
            delete input.__Omni_id;
          } 
          // if (Util.isArray(input)){
          //   input.pop();
          // }
        }
        return true;
      };

      Omni.prototype.analyze = function(input,state,seen_objs,stage) {
        if (this.size>OMNI_SIZE_LIMIT){
          throw new Error("[OMNI] Object size exceeded omni limit");
        }
        if (state == "write" && stage == 1 && input && input.__isProxy){
            var _ret = handleProxyObjs(input);
            if (_ret) return _ret;
          } else if (state == "write" && stage == 2 && input && input.__dynId != null){
            var _ret = handleProxyIds(input.__dynId,input.state, input.nodeId);
            if (_ret) return _ret;
        }
        if (input && input.__isProxy)
              input = input.__target;
        var cons, i, k, output, v, _i, _len,_id;
        switch (typeof input) {
          case "number":
             this.size += 8;
            return input;
          case "string":
            this.size+=input.length*2;
            return input
          case "boolean":
            this.size += 4;
            return input;
          case "symbol":
            if (state == "write") 
              return this.errorHandler(new Error("[OMNI] can't serialize symbols"));
            else return "";
          case "undefined":
            return void 0;
          case "function":
            // if (state == "write") 
            //   return this.errorHandler(new Error("[OMNI] can't serialize functions"));
            if (state == "read") return "__func__source";
          default:
            if (input === null) {
              return null;
            } else {
              if (isDOMInheritedProperty(input)){
                  if (state == "write") 
                    _id = this.assignId(input);
                  __tracer.updateDC();
                  var dom2json = {};
                  dom2json.xpath = createXPathFromElement(input);
                  if (input.__proto__.constructor.name == "HTMLDocument") {
                    // dom2json = domJSON.toJSON(input,{
                    //   deep: false,
                    //   attributes : ['id'],
                    //   domProperties: false,
                    // });
                    if (state == "write")
                      dom2json.document = true;
                  } 
                  if (state == "write") {
                    dom2json.__Omni_id = _id;
                    dom2json.__Omni_type = "DOM";
                  }
                
                  return (dom2json);
              } else if (Util.isArray(input)) {
              if (seen_objs.has(input))
                throw new Error("circular Object error");
              seen_objs.add(input);
              if (state == "write")
                _id = this.assignId(input);
              output = [];
              for (i = _i = 0, _len = input.length; _i < _len; i = ++_i) {
                v = input[i];
                output[i] = this.analyze(v,state,seen_objs,stage);
              }
              seen_objs.delete(input);
              // if (state == "write") 
                // output.push({__Omni_id : _id});
              // output.__Omni_id == input.__Omni_id;
              return output;
            } else { 
                    if (seen_objs.has(input))
                      throw new Error("circular object error");
                    seen_objs.add(input);
                    if (state == "write")
                      _id = this.assignId(input);
                    // input.__Omni_id = _id;
                    // this.processed_inputs.push(input);
                    output = new Object;
                    for (k in input) {
                      v = input[k];
                      if (Object.hasOwnProperty.call(input, k) && k != "__getScope__") {
                        output[k] = this.analyze(v,state,seen_objs,stage);
                      }
                    }
                    seen_objs.delete(input);
                    // if (state == "write") 
                      // output.__Omni_id = _id;
                    cons = Util.functionName(input.constructor);
                    if (cons === "" && !Object.hasOwnProperty.call(input, "constructor_name")) {
                      cons = input.constructor_name;
                    }
                    if (!(cons != null)) {
                      this.errorHandler(new Omni.AnonymousConstructorError(input));
                    }
                    if (cons != null && ( cons.indexOf("CSS")>=0 || cons.indexOf("HTML")>=0))
                        this.errorHandler(new Omni.DOMConstructorError(input))
                    if (cons !== "Object") {
                      if (state == "write") {
                        output.__Omni_cons = cons;
                        if (cons == "Function") {
                          /*If serializing function, store the function body*/
                          if (isNative(input))
                            return this.errorHandler(new Error("[OMNI] can't serialize native functions"));
                          output.__body__ = input.toString()
                          output.__scope__ = exposeClosureScope(input, this, seen_objs);
                          if (output.__scope__ && output.__scope__.stack)
                            throw new Error("Closure scope could not be exposed");
                        }
                      } else {
                        switch (cons){
                          case "Map": output =  Array.from(input.entries()); break;
                          case "Set": output =  Array.from(input.values()); break;
                          case "RegExp": output =  input.source; break;
                        }
                      }
                    }
                    // if (input.hasOwnProperty("version")) {
                    //   this.errorHandler(new Omni.VersionInstancePropertyError(input));
                    // }
                    // if (input.version != null) {
                    //   output.version = input.version;
                    // }
                    return output;
                }
            }
        }
      };

      Omni.prototype.setErrorHandler = function(errorHandler) {
        this.errorHandler = errorHandler;
      };

      Omni._refMatcher = /__Omni_ref_(.*)/;

      Omni.prototype.parse = function(input, params) {
        try {
          var l, o,_o, obj, obj_key, ref_id, reference, _i, _len, _ref;
          this.identified_objects = [];
          this.references_to_resolve = [];
          try {
           _o = JSON.parse(input);
         } catch (e){
            return input;
         }
          o = this.fixTree(_o,params);
          if (Util.isArray(o) || ((o != null) && typeof o === "object") && !_o.__Omni_type) {
            l = o.length;
            if (o != null) {
              _ref = this.references_to_resolve;
              for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                reference = _ref[_i];
                obj = reference[0], obj_key = reference[1], ref_id = reference[2];
                // obj[obj_key] = this.identified_objects[ref_id];
                obj[obj_key] = idToObject.get(ref_id);
              }
              // this.clean(o);
            }
          }
          return o;
        } catch (e){
          throw e;
        }
      };

      Omni.prototype.fixTree = function(obj,params) {
        var k, k2, m, proto, t, tmp, v, v2, _i, _len;
        if (obj && obj.__Omni_id) {
            var corObj = idToObject.get(Util.h2d(obj.__Omni_id));
            if (corObj)
                return corObj;
        }

        if (params && obj && obj.__dynPath){
          var obj = __tracer.traversePath(obj.__dynPath,params);
          return obj;
        }

        if (obj && obj.__Omni_type == "DOM"){
          if (obj.document)
            return document;
          // var o = domJSON.toDOM(obj);
          var o = lookupElementByXPath(obj.xpath);
          if (!o){
            this.errorHandler(new Omni.DOMXMLPathError(obj));
          }
          // idToObject.set(Util.h2d(obj.__Omni_id), o);
          return o;
        }

        if (Util.isArray(obj)) {
            // if (obj[obj.length - 1].__Omni_id){
            //     var _id = obj[obj.length - 1].__Omni_id;
            //     var corObj = idToObject.get(Util.h2d(_id));
            //     if (corObj)
            //         return corObj;
            //     else {
            //         idToObject.set(Util.h2d(_id), obj);
            //     }
            //     obj.pop();
            // }
          for (k = _i = 0, _len = obj.length; _i < _len; k = ++_i) {
            v = obj[k];
            v = this.fixTree(v,params);
            if (v === "__Omni_undef") {
              obj[k] = void 0;
            /*} else if (typeof v === "string" && (m = v.match(Omni._refMatcher))) {
              k2 = Util.h2d(m[1]);
              this.references_to_resolve.push([obj, k, k2]);
            } else if ( (k == _len -1) && v.__Omni_id) {
                idToObject.set(Util.h2d(v.__Omni_id), obj);
            */} else {
              obj[k] = v;
            }
          }
        } else if (obj === "__Omni_undef") {
          obj = void 0;
        } else if ((obj != null) && typeof obj === "object") {
          __id = obj.__Omni_id;
          if (obj && (obj.__Omni_cons != null)) {
            proto = this.resolvePrototype(obj.__Omni_cons);
            if (proto != null) {
              if (Util.supportsProto) {
                if (obj.__Omni_cons != "Function")
                  t = new proto;
                else {
                  var body = obj.__body__;
                  var scopeObj = __tracer.omni.parse(obj.__scope__);
                  with (scopeObj){
                    // t = new Function(' return ' + body)()
                    eval("t=" + body);
                  }
                }
                for (k in obj) {
                  v = obj[k];
                  if (obj.hasOwnProperty(k) && k != "__Omni_cons" && k != "__body__" 
                    && k != "__scope__") {
                    t[k] = v;
                  }
                }
                // idToObject.set(Util.h2d(obj.__Omni_id), t);
                obj = t;
              }
            } else {
              this.errorHandler(new Omni.PrototypeNotFoundError(obj, obj.__Omni_cons));
            }
          }
          for (k in obj) {
            v = obj[k];
            if (obj.hasOwnProperty(k)) {
              v = this.fixTree(v,params);
              if (k === "__Omni_id") {
                v2 = Util.h2d(v);
                // this.identified_objects[v2] = obj;
                // idToObject.set(v2, obj);
              } else if (v === "__Omni_undef") {
                obj[k] = void 0;
              } else if (typeof v === "string" && (m = v.match(Omni._refMatcher))) {
                k2 = Util.h2d(m[1]);
                this.references_to_resolve.push([obj, k, k2]);
              } else {
                obj[k] = v;
              }
            }
          }
        // idToObject.set(Util.h2d(__id), obj);
        } else if (typeof obj == "string")
            return (obj);
        return obj;
      };

      Omni.prototype.resolvePrototype = function(cons_id) {
        if (!(this.resolver != null)) {
          throw new Error("No Omni resolver found -- you should specify one in the Omni constructor!");
        }
        return this.resolver.resolve(cons_id);
      };

      Omni.prototype.clean = function(o, cleaned) {
        var i, k, migrations, num, v, _i, _j, _len, _ref, _ref1;
        // if (cleaned == null) {
        //   cleaned = [];
        // }
        if (o === null || typeof o !== "object") {
          return true;
        }
        // if (!Util.isArray(o) && cleaned.indexOf(o) > -1) {
        //   return true;
        // }
        /*migrations = this.migrations[o.__Omni_cons];
        if ((o.version != null) && (migrations != null) && o.version < migrations.length) {
          for (num = _i = _ref = o.version, _ref1 = migrations.length - 1; _ref <= _ref1 ? _i <= _ref1 : _i >= _ref1; num = _ref <= _ref1 ? ++_i : --_i) {
            migrations[num].call(o);
          }
          // delete o.version;
        }*/

        if (o && o.__Omni_type){
          delete o.__Omni_type;
          return;
        }

        // cleaned.push(o);
        if (Util.isArray(o)) {
          // if (o.find(el=>el.__Omni_id))
          //   o.pop();
          for (_j = 0, _len = o.length; _j < _len; _j++) {
            i = o[_j];
            this.clean(i);
          }
        } else {
          for (k of Object.getOwnPropertyNames(o)) {
            v = o[k];
            if (k === "__Omni_id" || k === "__Omni_cons" || k == "__body__") {
              delete o[k];
            } else {
              this.clean(v);
            }
          }
        }
        return true;
      };

      Omni.prototype.migration = function(klass, index, callback) {
        var all_versions;
        switch (typeof klass) {
          case "function":
            klass = klass.name;
            if (klass === "") {
              this.errorHandler(new Omni.AnonymousConstructorError(klass));
            }
            break;
          case "string":
            null;

            break;
          default:
            throw new Error("invalid class passed in; pass a function or a string");
        }
        all_versions = this.migrations[klass];
        if (!(all_versions != null)) {
          all_versions = this.migrations[klass] = [];
        }
        all_versions[index - 1] = callback;
        return true;
      };

      return Omni;

    })();
    Resolver = (function() {

      Resolver.name = 'Resolver';

      function Resolver() {}

      Resolver.prototype.resolve = function(cons_id) {
        throw new Error("abstract");
      };

      return Resolver;

    })();
    ContextResolver = (function(_super) {

      __extends(ContextResolver, _super);

      ContextResolver.name = 'ContextResolver';

      function ContextResolver(context) {
        this.context = context;
      }

      ContextResolver.prototype.resolve = function(cons_id) {
        var v;
        v = this.context[cons_id];
        if (v != null) {
          return v;
        } else {
          return null;
        }
      };

      return ContextResolver;

    })(Resolver);
    MultiResolver = (function(_super) {

      __extends(MultiResolver, _super);

      MultiResolver.name = 'MultiResolver';

      function MultiResolver(resolvers) {
        this.resolvers = resolvers != null ? resolvers : [];
      }

      MultiResolver.prototype.resolve = function(cons_id) {
        var proto, res, _i, _len, _ref;
        _ref = this.resolvers;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          res = _ref[_i];
          proto = res.resolve(cons_id);
          if (proto != null) {
            return proto;
          }
        }
        return null;
      };

      return MultiResolver;

    })(Resolver);
    Omni.Util = Util;
    Omni.Resolver = Resolver;
    Omni.ContextResolver = ContextResolver;
    Omni.MultiResolver = MultiResolver;
    return Omni;
  });

}).call(this);
/*
 * Copyright (c) 2012 Massachusetts Institute of Technology, Adobe Systems
 * Incorporated, and other contributors. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 *
 */

/*
The source of source-map is included below on the line beginning with "var sourceMap",
and its license is as follows:

Copyright (c) 2009-2011, Mozilla Foundation and contributors
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

* Redistributions of source code must retain the above copyright notice, this
  list of conditions and the following disclaimer.

* Redistributions in binary form must reproduce the above copyright notice,
  this list of conditions and the following disclaimer in the documentation
  and/or other materials provided with the distribution.

* Neither the names of the Mozilla Foundation nor the names of project
  contributors may be used to endorse or promote products derived from this
  software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED T, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

/*
Keywords to manage code base better

TODO - code sections need to be reimplemented or handled better
SUPPRESS - caught exceptions which our suppressed - need to be handled better
LOG - log statements which are used to debug

TODO

    - Fine tracking of arguments
        - Instead of stringifying the entire argument object, only track object level changes (read, write) to the individual object
    - Signature Propagation
        - While trying to build the call graph, some nodes are not found: Is it because I am deleting nodes while stringifying?
*/

if (typeof window != "undefined"){
    if (typeof window.top.setupStateTime == "undefined") {
        window.top.setupStateTime = {};
        window.top.setupStateCounter=0;
    }
}

if (typeof window.__tracer === 'undefined') {
__tracer = new __declTracerObject__(window);
function __declTracerObject__(window) {
    var setupStateStartTime = performance.now();
    var e2eTesting = false;
    var trackOnlyLeaf = false;
    var functions = new Set();
    var invocations = {};
    var customLocalStorage = {}; /* Use this in place of the localstorage API for faster access. */
    var counter = 0;
    var shadowStack = [];
    var _shadowStackHead;
    var processedSignature = {};
    var callGraph = {};
    var parentNodes = [];
    var nonLeafNodes = [];
    var functionsSeen = [];
    var pageRecorded = false;
    var simpleReplay = true;
    var cacheStats = {hits: [], misses: {error:[], empty:[], mismatch:[]}};
    var functionStats = {noarg:[], prim: [], prim_objects:[], function: []};
    var nonCacheableNodes = {};
    var invocationsIndName = {};
    var invocationsIndState = {};
    var invocationToArgProxy = {};
    var invocationToThisProxy = {}
    var invocationToClosureProxy = {};
    var keysToStdKeys = {};
    var cacheableSignature = {};
    var pageLoaded = true;;
    var oldPageLoaded = [];
    var INVOCATION_LIMIT = 5000000;;
    var domCounter =0;
    var invocationToWrites = {};
    var ND = [];
    var curRoot = null;
    var functionToScopes = {};
    var omniStringifier = Omni ? new Omni() : "";
    // var parse = omniStringifier.parse;
    var rootInvocs = [];
    var sigSizeLimit = 500; // Number of reads and writes allowed per invocations
    var OMNI_SIZE_LIMIT=10000; //Length of string allowed to be read or written
    var instrumentationPattern = "cg";
    var invocationList = [];
    var timingInfo = {};
    var sigSizes = {};
    var PMD = {};
    var runtimeInfo = {runtimeInfo};
    var runTimePurged = 0;
    var writeStateProcessed = new Map();

    /*
    For efficient recording, constraint the size of certain objects
    - signature length should be less than 50 entries
    - during stringification the object length should be less than certain bytes*TODO
    */

    window.objStrCount = {
        argument_reads:0,
        argument_writes:0,
        closure_reads:0,
        closure_writes:0,
        global_writes:0,
        global_reads:0,
        this_reads:0,
        this_writes:0
    };

    //Define all your custom methods, before they are overwritten
    //by user javascript
    // Declare all the custom prototype methods here
    var customMethods = {getOwnPropertyDescriptor: Object.getOwnPropertyDescriptor, getOwnProperyNames: Object.getOwnProperyNames, ownKeys: Reflect.ownKeys}

    //temporary hack to store non stringifiable functions
    // var nodesByProperties = {
    //     "NOGSNOARG":[], "GS_f":[], "GS":[],
    //     "Function":{}, "RTI":{RTI},
    //     "antiLocal":{antiLocal},"ND":{ND}, "DOM":{DOM}
    // };

    var eraseCookies = function () {
        var cookies = document.cookie.split("; ");
        for (var c = 0; c < cookies.length; c++) {
            var d = window.location.hostname.split(".");
            while (d.length > 0) {
                var cookieBase = encodeURIComponent(cookies[c].split(";")[0].split("=")[0]) + '=; expires=Thu, 01-Jan-1970 00:00:01 GMT; domain=' + d.join('.') + ' ;path=';
                var p = location.pathname.split('/');
                document.cookie = cookieBase + '/';
                while (p.length > 0) {
                    document.cookie = cookieBase + p.join('/');
                    p.pop();
                };
                d.shift();
            }
        }
    }

    var fnCacheExists = false;
    try {
        if (fnCacheExists = localStorage.getItem("fnCacheExists")){
            console.log("Fn cache exists, skippping function executions..");
            keysToStdKeys = JSON.parse(localStorage.getItem("keyMap"));

            var _processedSignature = JSON.parse(localStorage.getItem("signature"));
            Object.keys(_processedSignature).forEach((key)=>{
                processedSignature[key] = JSON.parse(_processedSignature[key], true);
            })
            console.log("Function signatures loaded..");
            pageLoaded = true;

            //Restore cookies
            eraseCookies();
            var prevCookie = localStorage.getItem("cookieVal");
            document.cookie = prevCookie;
        } else {
            localStorage.setItem("cookieVal",document.cookie);
        }
    } catch (e){
        console.error("error while reading local storage " + e);
    }

    window.addEventListener("load", function(){
        if (!pageRecorded) {
            console.log("PROXY STATS");
            console.log(window.proxyReadCount, window.proxyWriteCount);
            /*Delete performance shims since we need all the entries now
            However only do this when the top level page fires
            Some iframe with a sep*/
            // delete window.performance.getEntries
            // delete window.performance.getEntriesByType
        } else {
            console.log("Page successfully replayed");
        }
        // if (window.top == window)
        //     debugger;
        // if (instrumentationPattern == "replay")
        //     debugger;

    })

    var processFinalSignature = function(){
        // First process the global state of every function
        var proxyPrivates = globalProxyHandler.accessToPrivates();
        // Process the signature to construct meaningful paths
        var sigProcessor = new SignatureProcessor(customLocalStorage, proxyPrivates.ObjectTree, callGraph, "global");
        sigProcessor.process();
        // sigProcessor.postProcess();
        // sigProcessor.signaturePropogate();
        processedSignature = sigProcessor.processedSig;

        Object.keys(customLocalStorage).forEach((invocationId)=>{
            var invocationSignature = {};
            invocationSignature[invocationId] = processedSignature[invocationId];
            if (!invocationSignature[invocationId]) return;
            //For each invocation get all the scopes it touches
            functionToScopes[invocationId] && functionToScopes[invocationId].forEach((i_scope)=>{
                var closureProxyHandler = invocationToClosureProxy[i_scope];
                var proxyPrivates = closureProxyHandler.accessToPrivates();
                var sigProcessor = new SignatureProcessor(invocationSignature, proxyPrivates.ObjectTree, callGraph, `closure_${i_scope}`);
                sigProcessor.process();
                // sigProcessor.postProcess();
                processedSignature[invocationId] = sigProcessor.processedSig[invocationId];
            })
        })

        //Now individual iterate the invocations and convert object ids to strings
        // Object.keys(invocationToArgProxy).forEach((invocationId)=>{
        //      // Return if not leaf node
        //     if (trackOnlyLeaf &&  callGraph[invocationId].length) {
        //         nonCacheableNodes[invocationId] = "non-leaf";
        //         return;
        //     }
        //     if (invocationId in nonCacheableNodes) return;
        //     var argProxyHandler = invocationToArgProxy[invocationId];
        //     var proxyPrivates = argProxyHandler.accessToPrivates();
        //     var invocationSignature = {};
        //     invocationSignature[invocationId] = processedSignature[invocationId];
        //     if (!invocationSignature[invocationId]) return;
        //     var sigProcessor = new SignatureProcessor(invocationSignature, proxyPrivates.ObjectTree, callGraph, "argument");
        //     sigProcessor.process();
        //     // sigProcessor.postProcess();
        //     processedSignature[invocationId] = sigProcessor.processedSig[invocationId];
        // })

        // Object.keys(invocationToThisProxy).forEach((invocationId)=>{
        //     // Return if not leaf node
        //     if (trackOnlyLeaf && callGraph[invocationId].length) return;
        //     if (invocationId in nonCacheableNodes) return;
        //     var thisProxyHandler = invocationToThisProxy[invocationId];
        //     var proxyPrivates = thisProxyHandler.accessToPrivates();
        //     var invocationSignature = {};
        //     invocationSignature[invocationId] = processedSignature[invocationId];
        //     if (!invocationSignature[invocationId]) return;
        //     var sigProcessor = new SignatureProcessor(invocationSignature, proxyPrivates.ObjectTree, callGraph, "this");
        //     sigProcessor.process();
        //     // sigProcessor.postProcess();
        //     processedSignature[invocationId] = sigProcessor.processedSig[invocationId];
        // })

        // Object.keys(invocationToClosureProxy).forEach((invocationId)=>{
        //     // Return if not leaf node
        //     if (trackOnlyLeaf && callGraph[invocationId].length) return;
        //     if (invocationId in nonCacheableNodes) return;
        //     var closureProxyHandler = invocationToClosureProxy[invocationId];
        //     var proxyPrivates = closureProxyHandler.accessToPrivates();
        //     var invocationSignature = {};
        //     invocationSignature[invocationId] = processedSignature[invocationId];
        //     if (!invocationSignature[invocationId]) return;
        //     var sigProcessor = new SignatureProcessor(invocationSignature, proxyPrivates.ObjectTree, callGraph, "closure");
        //     sigProcessor.process();
        //     // sigProcessor.postProcess();
        //     processedSignature[invocationId] = sigProcessor.processedSig[invocationId];
        // })

        // constructCacheReadKey();

        console.log("Done processing final signature\nStarting propagation...\n")

        //garbage cleaning
        // delete invocationToArgProxy;
        // delete globalProxyHandler;
        delete customLocalStorage;
        // delete invocationToClosureProxy;

        // sigProcessor.setPropagationData(PMD, {i2a:invocationToArgProxy, i2c:invocationToClosureProxy
        //     ,i2t: invocationToThisProxy, gph:globalProxyHandler}, processedSignature, nonCacheableNodes);
        // sigProcessor.signaturePropagate()

        console.log("Done propagating signatures..\nPurging expensive signatures");
        // purgeExpensiveSignatures();

    }


    var purgeExpensiveSignatures = function(){
        var topNodeInfo = runtimeInfo.filter(e=>e[2]>=0);
        var topNodes = topNodeInfo.map(e=>e[0]);
        var PERBYTEOVERHEAD = 1; //microsecond
        var node2invocations = {}, perInvocationTime = {};
        Object.keys(processedSignature).forEach((invoc)=>{
            var [n,count] = invoc.split("_count");
            if ( !(n in node2invocations) )
                node2invocations[n] = [];
            node2invocations[n].push(invoc);
        })

        topNodes.forEach((tN,ind)=>{
            var invocs = node2invocations[tN];
            if (!invocs){
                //the function never got instrumented for some reason
                return;
            }
            perInvocationTime[tN] = topNodeInfo[ind][2]*1000/invocs.length; //convert to microseconds
            invocs.forEach((i)=>{
                var sig = processedSignature[i];
                var sigSize = sig.reduce((acc, cur)=>{
                        var len =0;
                        if (typeof cur[1] == "string")
                            len += cur[1].length
                        if (cur[2] && typeof cur[2] == "string")
                            len += cur[2].length;
                        return len + acc},0);
                var predictedTime = PERBYTEOVERHEAD*sigSize;
                if (predictedTime > perInvocationTime[tN]){
                    runTimePurged += perInvocationTime[tN];
                    delete processedSignature[i];
                }
            })
        })
    }

    var _constructCacheReadKey = function(signature){
        var readString = "";
        // var readKeys = Object.keys(signature).filter(e=>e.indexOf("reads")>=0);
        var readKeys = [...new Set(signature.filter(e=>e[0].indexOf("reads")>0).map(e=>e[0]))];

        var constructReadKey = function(root, readArr){
            var key = "[`", props=readArr[1].split(";;;;"), value = readArr[2];
            props.forEach((p, ind)=>{
                if (ind === 0) return;
                key += p + "`]";
                if (ind != props.length-1) key +="[`"
            })
            //Special case window read
            if (readArr[0].indexOf(readArr[1])>=0){
                return "JSON.stringify(" + root + key + ") == " + ((root + key).split("[`self")[0]);
            }
            return "JSON.stringify(" + root + key + ") == " + value;
        }

        readKeys.forEach((readType,ind) =>{
            var _type = readType.split("_")[0];
            var root = "";
            switch(_type){
                case "argument":
                    root = "arg";
                    break;
                case "closure":
                    root = "closure";
                    break;
                case "this":
                    root = "thisObj";
                    break;
                case "global":
                    root = "window";
                    break;
            }
            signature.filter(e=>e[0]==readType).forEach((readArr,ind)=>{
                var r = constructReadKey(root, readArr);
                readString += r + " && ";
            })

        })

        return readString + " true";
    }

    var constructCacheReadKey = function(){
        Object.keys(processedSignature).forEach((invocId)=>{
            if (invocId in nonCacheableNodes) return;
            processedSignature[invocId].push(["finalRead", _constructCacheReadKey(processedSignature[invocId])]);
        })
    }

    var combineMultiSigs = function(sig, keyMap){
        var prevSig = JSON.parse(localStorage.getItem("signature"));
        var prevKeyMap = JSON.parse(localStorage.getItem("keyMap"));

        Object.keys(prevSig).forEach((key)=>{
            sig[key] = prevSig[key];
        })
        Object.keys(prevKeyMap).forEach((key)=>{
            keyMap[key] = prevKeyMap[key];
        })

    }

    var createSigProcWorker = function(procSig){
        var WORKERLIMIT = 8, workerList = [], workloads = [], len=Object.keys(procSig).length;
        var workloadSize = Math.floor(len/WORKERLIMIT), workerId=1;
        if (!workloadSize) {
            workloadSize = len, WORKERLIMIT=1;
        }
        console.log("Preparing data for workers...");
        for (var i=0;i<WORKERLIMIT*workloadSize;i+=workloadSize){
            var _wl = {}, _wlkeys;
            if ( i + workloadSize < WORKERLIMIT*workloadSize)
                _wlkeys = Object.keys(procSig).slice(i,i+workloadSize);
            else _wlkeys = Object.keys(procSig).slice(i, len);
            _wlkeys.forEach((k)=>{
                _wl[k] = procSig[k];
            })
            workloads.push(_wl);

            var worker  = new Worker("http://goelayu4929.eecs.umich.edu:99/hostSrc/signatureWorker.js");
            worker.addEventListener('message', function(e){
                var _id = workerId++;
                console.log("Data processed by worker " + _id);
                Object.keys(e.data.keymap).forEach((k)=>{
                    keysToStdKeys[k] = e.data.keymap[k];
                })
                // keysToStdKeys = keysToStdKeys.concat(e.data.keymap);
                Object.keys(e.data.sig).forEach((k)=>{
                    cacheableSignature[k] = e.data.sig[k];
                })

                if (_id == WORKERLIMIT){

                    var cacheExists = localStorage.getItem("fnCacheExists");
                    if (cacheExists){
                        combineMultiSigs(cacheableSignature, keysToStdKeys);
                    }
                    //Store the signature in local storage
                    localStorage.setItem("signature", JSON.stringify(cacheableSignature));
                    //store the uniq keys map
                    localStorage.setItem("keyMap", JSON.stringify(keysToStdKeys));
                    //store a small key to check whether a signature is available or not
                    localStorage.setItem("fnCacheExists",1);

                    //only the top window object should send the final alert
                    if (window.top == window)
                        console.log("Cache saved..");
                }
            })
            workerList.push(worker);
        }
        console.log("Data prepared, launching workers");
        workerList.forEach((w,i)=>{
            w.postMessage(workloads[i]);
        });


    }

    var storeSignature = function(){
        var strSignature = {};
        Object.keys(processedSignature).forEach((invocId)=>{
            if (invocId in nonCacheableNodes) return;
            processedSignature[invocId].IBF && (processedSignature[invocId].push(["IBF"].concat(processedSignature[invocId].IBF)) );
            (processedSignature[invocId].returnValue != null) && (processedSignature[invocId].push(["returnValue"].concat(processedSignature[invocId].returnValue)) );
            var strSig = JSON.stringify(processedSignature[invocId]);
            if (strSig && strSig instanceof Error) {
                nonCacheableNodes[invocId] = strSig.message;
                return;
            }
            else if (processedSignature[invocId] == "NonLeafNode") return;

            //convert the original signature in the string format, to do a memory comparison
            strSignature[invocId] = strSig;

        })

        createSigProcWorker(strSignature);

        // console.log(Object.keys(processedSignature).length + " coalesced into " + Object.keys(cacheableSignature).length);
    }

    this.storeSignature = storeSignature;

    this.processFinalSignature = processFinalSignature;

    // this.omni = omniStringifier;

    this.getKeysToStdKeys = function(){
        return keysToStdKeys;
    }

    this.getPMD = function(){
        return PMD;
    }

    this.getND = function(){
        return ND;
    }

    this.getCurRoot = function(){
        return curRoot;
    }

    this.addND = function(f){
        ND.push(f);
    }

    this.getRootInvocs = function(){
        return rootInvocs;
    }

    this.getRuntimePurged = function(){
        return runTimePurged;
    }

    this.getStoredSignature = function(){
        return cacheableSignature;
    }

    this.getInvocationToWrites = function(){
        return invocationToWrites;
    }

    var processInvocationProperties = function(){
        //Iterate processed signature instead of customLocalStorage object
        Object.keys(processedSignature).forEach((nodeId)=>{
            var propertyObj = processedSignature[nodeId];
            // if (!propertyObj.reads.length && !propertyObj.writes.length && !propertyObj.argProp) {
            //     // if (nodesByProperties.DOM.indexOf(nodeId)<0 && nodesByProperties.antiLocal.indexOf(nodeId)<0)
            //         nodesByProperties.NOGSNOARG.push(nodeId);
            // } else if ( (propertyObj.reads && propertyObj.reads.length) || ( propertyObj.writes && propertyObj.writes.length) ) {
            //     if (propertyObj.argProp && getFunctionStat(propertyObj.argProp) == "function")
            //         nodesByProperties.GS_f.push(nodeId);
            //     else nodesByProperties.GS.push(nodeId);
            // }
            // else {
            //     var argType = getFunctionStat(propertyObj.argProp);
            //     nodesByProperties.Function[argType].push(nodeId);
            // }
            if (nodesByProperties.antiLocal.indexOf(nodeId) < 0) {
                if (propertyObj.isFunction)
                    nodesByProperties.function.push(nodeId)
                else nodesByProperties.nonFunction.push(nodeId);
            }
        });
    }

    /* Proxy object handler */
    window.proxyReadCount =0; window.proxyWriteCount = 0;

    /*
    Declare your own inbuilt functions
    so that your instrumentation, doesn't end up calling the
    actual user defined code in cases when the user defined code
    has rewritten the in built functions
    */

    window.__tracerEval = window.eval;
    window.__tracerParseInt = window.parseInt;
    window.__tracerParseFloat = window.parseFloat;


    /*
    Rewrite inbuilt javascript APIs
    to support the use of proxy objects.
    Since lots of objects are wrapped in proxy,
    these objects can end up inside function calls outside my instrumented code
    And therefore we need to rewrite these definitions

    However, we don't need to rewrite these definitions during replay, when the page is
    replaying function signature from cache, since there are no proxy objects in memory

    */

    if (!pageLoaded) {


        function customShims(self){
            let _setProtoTypeof = Object.setPrototypeOf;
            self.Object.setPrototypeOf = function (obj, prototype) {
                if (prototype && prototype.__isProxy)
                    prototype = prototype.__target;
                return _setProtoTypeof(obj, prototype);
            }

            var _create = Object.create;
            self.Object.create = function(){
                var thisObj = this;
                for (var i=0;i<arguments.length;i++){
                    var arg = arguments[i];
                    if (arg && arg.__isProxy)
                        arguments[i] = arg.__target;
                }
                if (thisObj && thisObj.__isProxy)
                    thisObj = thisObj.__target;
                return _create.apply(thisObj,arguments);
            }

            var _encodeURI = window.encodeURI;
            self.window.encodeURI = function(uri){
                var _t;
                if (uri && (_t = uri.__target))
                    uri = _t;
                return _encodeURI.call(this, uri);
            }

            var _encodeURIComponent = window.encodeURIComponent;
            self.window.encodeURIComponent = function(uri){
                var _t;
                if (uri && (_t = uri.__target))
                    uri = _t;
                return _encodeURIComponent.call(this, uri);
            };

            var _getComputedStyle = window.getComputedStyle;
            self.window.getComputedStyle = function(){
                var thisObj = this;
                for (var i=0;i<arguments.length;i++){
                    var arg = arguments[i];
                    if (arg && arg.__isProxy)
                        arguments[i] = arg.__target;
                }
                if (thisObj && thisObj.__isProxy)
                    thisObj = thisObj.__target;
                return _getComputedStyle.apply(thisObj,arguments);
            };

            var _defineProperty = Object.defineProperty;
            self.Object.defineProperty = function(){
                for (var i=0;i<arguments.length;i++){
                    var arg = arguments[i];
                    if (arg && arg.value && arg.value.__isProxy)
                        arg.value = arg.value.__target;
                    if (arg && arg.__isProxy)
                        arguments[i] = arg.__target;
                }
                return _defineProperty.apply(this, arguments);
            }

            // var _toString = Object.prototype.toString;
            // self.Object.prototype.toString = function(){
            //     var thisObj = this;
            //     for (var i=0;i<arguments.length;i++){
            //         var arg = arguments[i];
            //         if (arg && arg.__isProxy)
            //             arguments[i] = arg.__target;
            //     }
            //     if (thisObj && thisObj.__isProxy)
            //         thisObj = thisObj.__target;
            //     return _toString.apply(thisObj,arguments);
            // }


            window.___ranCUSTOMSHIMS___ = true;
        };

        customShims(window);

        // --------------------------------------------------
        /***** HORCRUX *****/
        const DOMAccessHandler = {
            get: function(target, property, receiver) {
                if (property == '__isDOMNode') return true;

                const oldValue = Reflect.get(target, property);
                console.log(`called: ${property} on ${target} -> ${oldValue}`);
                return oldValue;
            }
        };

        const createDOMProxy = function(domObject, attachedToDOMTree) {
            if (pageLoaded || _shadowStackHead in nonCacheableNodes) return domObject;
            var nodeId = _shadowStackHead ? _shadowStackHead : null;
            if (!nodeId) {
                console.error('nodeId is null: THIS SHOULD NOT HAPPEN FOR HORCRUX!');
                return domObject;
            }
            if (domObject.__isProxy) {
                console.log('domObj is already a proxy!!');
                domObject = domObject.__target;
            }
            // console.log(`DOM Node: ${domObject}, attached: ${attachedToDOMTree}`);
            var proxyHandler = proxyEncapsulation(domObject, "DOM_NODE", null, attachedToDOMTree);
            var domProxy = new Proxy(domObject, proxyHandler);
            // TODO (Shaghayegh): Test/confirm if I should keep track of created DOM proxies!
            return domProxy;
        }

        // --------------------------------------------------

        /*Creates shim for every dom methods
        The purpose of the shim is to check for proxy argument types*/
        function createShimForDOMMethods(self){
            var HTMLNames = [
                "HTMLDocument", "HTMLLinkElement", "HTMLElement", "HTMLHtmlElement",
                "HTMLDivElement", "HTMLAnchorElement", "HTMLSelectElement",
                "HTMLOptionElement", "HTMLInputElement", "HTMLHeadElement",
                "HTMLSpanElement", "XULElement", "HTMLBodyElement", "HTMLTableElement",
                "HTMLTableCellElement", "HTMLTextAreaElement", "HTMLScriptElement",
                "HTMLAudioElement", "HTMLMediaElement", "HTMLParagraphElement", "DOMImplementation",
                "HTMLButtonElement", "HTMLLIElement", "HTMLUListElement", "HTMLIFrameElement",
                "HTMLFormElement", "HTMLHeadingElement", "HTMLImageElement", "IntersectionObserver",
                "HTMLStyleElement", "HTMLTableRowElement", "HTMLTableSectionElement", "PerformanceObserver",
                "HTMLBRElement", "Node", "EventTarget", "HTMLCollection", "MutationObserver", "Document",
                "HTMLCanvasElement", "CanvasRenderingContext2D", "CanvasGradient", "CanvasPattern",
                "ImageBitMap", "ImageData", "TextMetrics", "Path2D", "CSSCounterStyleRule", "Element",
                "RegExp", "Crypto", "Object", "Map", "MediaDevices","StorageManager","CacheStorage",
                "NodeList", "ChildNode"
            ];

            const DOMReadAPIs = ["getElementById", "getElementsByTagName",
                "getElementsByClassName", "getElementsByTagNameNS",
                "querySelector", "querySelectorAll",
                "compareDocumentPosition", "contains"
            ];

            // TODO: Handle "write", "writeln":
            // Wouldn't be useful to wrap the return value in a proxy, but at least should mark DOM_write
            const DOMWriteAPIs = ["insertBefore",
                "appendChild", "replaceChild", "removeChild", "remove",
                "insertAdjacentElement", "insertAdjacentHTML", "insertAdjacentText"
            ];

            HTMLNames.forEach((_class)=>{
                self[_class] && self[_class].prototype && Object.getOwnPropertyNames(self[_class].prototype).forEach((classKey)=>{
                    try {
                        if (typeof self[_class].prototype[classKey] == "function") {
                            var origMethod = self[_class].prototype[classKey];
                            if (classKey == "constructor") return;
                            self[_class].prototype[classKey] = function() {
                                var thisObj = this;
                                /***** HORCRUX *****/
                                // indicating whether the retVal is a node already attached to DOM tree or not
                                let attachedToDOMTree = false;
                                if (DOMWriteAPIs.includes(origMethod.name)) {
                                    // this object is attached to DOM tree.
                                    // so any changes to it affects the DOM  tree.
                                    if (thisObj && thisObj.__isAttachedToDOMTree) {
                                        customLocalStorage[_shadowStackHead]["DOM_write"] = true;
                                        attachedToDOMTree = true;
                                    }
                                    // TODO: change the corresponding field of arg proxy
                                    // if thisObject is already attached, the given arg is also getting
                                    // attached to the tree after this call
                                }

                                if (DOMReadAPIs.includes(origMethod.name))  {
                                    console.log(_shadowStackHead);
                                    customLocalStorage[_shadowStackHead]["DOM_read"] = true;
                                    attachedToDOMTree = true;
                                }
                                if (thisObj && thisObj.__isProxy)
                                    thisObj = thisObj.__target;
                                for (var i=0; i < arguments.length; i++){
                                    var arg = arguments[i];
                                    if (arg && arg.__isProxy)
                                        arguments[i] = arg.__target;
                                }

                                /*If regex testing, return the original method*/
                                if ( (origMethod.name == "test" || origMethod.name =="exec") && arguments[0] && arguments[0].__isShimmed__)
                                    arguments[0] = arguments[0].__orig__;

                                const retVal = origMethod.apply(thisObj, arguments);
                                /* For methods like "compareDocumentPosition" and "contains"
                                the returned value type is bitmask and boolean, respectively, so
                                it does not need to be wrapped in proxy! */
                                if (retVal && typeof retVal === "object") { //&& retVal.nodeType
                                    return createDOMProxy(retVal, attachedToDOMTree);
                                }
                                return retVal;
                            };
                            self[_class].prototype[classKey].__isShimmed__ = true
                            self[_class].prototype[classKey].__orig__ = origMethod;
                        }
                    } catch (e){};
                });
            });
        };
        createShimForDOMMethods(window);

        this.createShimForDOMMethods = createShimForDOMMethods;
        this.customShims = customShims;

        // Since we are modifying content of scripts, if scripts have dynamically created integrity attribute
        // the script won't be fetch as the hash match would fail, therefore make the integrity field non writable
        Object.defineProperty(HTMLScriptElement.prototype, "integrity",{value:"", writable:false})

        if (Error.captureStackTrace){
            var _captureStackTrace = Error.captureStackTrace;
            Error.captureStackTrace = function(){
                var args = arguments;
                if (args[0] && args[0].__target)
                    args[0] = args[0].__target;
                if (args[1] && args[1].__target)
                    args[1] = args[1].__target;
                return _captureStackTrace.apply(this, args);
            }
        }

        var _xmlSend = XMLHttpRequest.prototype.send;
            // override the native send()
        XMLHttpRequest.prototype.send = function(){
            if (_shadowStackHead){
                nonCacheableNodes[_shadowStackHead] = "xml";
                // console.log("xml request sent from " + _shadowStackHead);
            }
            // call the native send()
            _xmlSend.apply(this, arguments);
        }

        var origSetTimeout = window.setTimeout;
        // window.setTimeout = function(){
        //     if (arguments.length > 1 && !isNaN(Number.parseFloat(arguments[1]))){
        //         if (arguments[1] === 0){
        //             arguments[1] = 500;
        //         }
        //         arguments[1] = arguments[1]*4;
        //     }
        //     var thisArg = this;
        //     if (this && this.__isProxy){
        //         thisArg = this.__target;
        //     }
        //     return origSetTimeout.apply(thisArg, arguments);
        // }


        /*
        This takes care of every inbuild api invocation where
        the argument causes a different behavior due to the proxy wrapping
        for example: Object.prototype.toString.call(o);
        here if o is wrapped in proxy, it will always return object type
        */

        /*Not sure why we need these call exceptions*/
        var callExceptions = [/*"hasOwnProperty","toString","toLocaleString","isPrototypeOf"*/];
        var origCall = Function.prototype.call;
        Function.prototype.call = function() {
            var _t,n = this.__isProxy ? this.__target.name : this.name;
            if (arguments[0] && arguments[0].__isProxy)
                arguments[0] = arguments[0].__target;
            return origCall.apply(this, arguments);
        }
    } else {
        /*
        Even if the page is not loaded, increase the setTimeout value
        This is specially useful for the callgraph generation, where every function is instrumented
        Not needed anymore, since callgraph generation only uses tentative leaf nodes now

        */
        // var origSetTimeout = window.setTimeout;
        // window.setTimeout = function(){
        //     if (arguments.length > 1 && !isNaN(Number.parseFloat(arguments[1]))){
        //         if (arguments[1] === 0){
        //             arguments[1] = 500;
        //         }
        //         arguments[1] = arguments[1]*4;
        //     }
        //     return origSetTimeout.apply(this, arguments);
        // }
    }

    /*Create shim for performance entries so that all the other timers values are not returned*/

    // var _pGetEntries = window.performance.getEntries;
    // window.performance.getEntries = function() {
    //     var entries = _pGetEntries.apply(this, arguments);
    //     var relevantEntries = entries.filter(e=>e.name.indexOf("_count")<0);
    //     return relevantEntries;
    // }

    // var _pGetEntriesByType = window.performance.getEntriesByType;
    // window.performance.getEntriesByType = function(type){
    //     var entries = _pGetEntriesByType.apply(this, arguments);
    //     var relevantEntries = entries.filter(e=>e.name.indexOf("_count")<0);
    //     return relevantEntries;
    // }

    this.isPageLoaded = function(){
            return pageLoaded;
    }

    // use hacks to detect if a method is a DOM object or not
    // as sometimes even document objets are not instances of these parent objects
    // for reasons unknown
    // Despite window satisfying this criteria have this function return false for window
    // object specifically
    // Sometimes Node instances like character data or other nodes don't satisfy the instanceof check
    // therefore use specific methods like click and appendata
    var isDOMInheritedProperty = function(method){
        return method && (method instanceof EventTarget || method instanceof HTMLCollection || method instanceof NodeList || method.readState
            || method.click || method.appendData) &&  !(method instanceof HTMLDocument) /*&& (method && method.self != method)*/
    }

    /*Proxyobj is either a proxy object, or the window object when the this refers to window*/
    var handlePropagatedProxy = function(proxyObj,argInd, transferState, stackHead){
        var state = proxyObj.__isProxy || "global";
        var parentNodeId = proxyObj.__debug, proxyMap;
        switch (state) {
            case "argument" :
                proxyMap = invocationToArgProxy; break;
            case "global" :
                proxyMap = globalProxyHandler; break;
            case "this" :
                proxyMap = invocationToThisProxy; break;
            case "closure":
                proxyMap = invocationToClosureProxy; break;
        }
        var proxyPrivates = state == "global" ? globalProxyHandler : proxyMap[parentNodeId];
        if (!proxyPrivates) {
            /*Maybe the parent exists in different iframe*/
            nonCacheableNodes[parentNodeId] = "propagation error | can't store metadata"
            return;
        }
        var objId = proxyObj.__target != null ? proxyPrivates.accessToPrivates().getObjectId(proxyObj.__target) : [0]
        if (objId == null){
            console.error("Error while trying to propagate object from " + stackHead + " to " + parentNodeId);
            nonCacheableNodes[parentNodeId] = "propagation error | can't store metadata"
        }
        PMD[stackHead][transferState].push([argInd,objId[0],state]) // transferState(arguments or this) -> [objId of parent Object, argInd in case the object was passed as a specific index, state (which parent state it belonged to)]
    }

    // closure_id is only applicable when the type is closure
    var proxyEncapsulation =  function(rootObject, type, closure_id, attached) {

        var ObjectTree = {};
        var objectIdCounter = 1;
        var methodToProxy = new WeakMap();
        var proxyToMethod = new WeakMap();
        var ObjectToId = new WeakMap();
        var idToObject = {};
        var objectToPath;
        var parentFunctionId = null;
        var rootType = type;
        if (rootType == "argument" || rootType == "this" || rootType == "closure")
            parentFunctionId = _shadowStackHead;
        /***** HORCRUX *****/
        let isDOMNode = (rootType == "DOM_NODE");
        let attachedToDOMTree = !!attached;
        /* Initialize the object tree with window as the root object*/
        ObjectToId.set(rootObject,0);
        idToObject[0] = rootObject;
        ObjectTree[0] = {};

        var closureScope;
        if (type == "closure"){
            closureScope = `closure_${closure_id}`;
        }

        var appendObjectTree = function(rootId, key, childId){
            var _edge = ObjectTree[rootId];
            if (typeof key == "symbol")
                var ekey = "e_" + key.toString();
            else var ekey = "e_" + key;
            if (_edge) {
                if (!_edge[ekey])
                    _edge[ekey] = [];
                if (_edge[ekey].indexOf(childId)<0)
                    _edge[ekey].push(childId);
            }
            else {
                ObjectTree[rootId]  = {};
                var edge = ObjectTree[rootId];
                edge[ekey] = [];
                edge[ekey].push(childId);
            }
        }

        var stateAlreadyLogged = function(nodeId, logTup, logType){
            var otherLogType = logType.indexOf("reads")>=0 ? rootType+"_writes" : rootType +"_reads";
            var stateLogged = false;
            if (logType.indexOf("reads")>=0){
                //Test whether the value read is written inside the current function itself
                if (customLocalStorage[nodeId][otherLogType]) {
                    customLocalStorage[nodeId][otherLogType].forEach((el)=>{
                        if (el[0] == logTup[0] && el[1] == logTup[1])
                            stateLogged = true;
                    });
                    if (stateLogged) return stateLogged;
                }
            }

            customLocalStorage[nodeId][logType].forEach((tupEntry)=>{
                if (JSON.stringify(tupEntry) == JSON.stringify(logTup))
                    stateLogged = true;
            })
            return stateLogged;
        }

        var hasObjectId = function(obj){
            return ObjectToId.get(obj);
        }

        var getObjectId = function(obj){
            if (obj.__isClosureObj){
                return [0, false];
            }
            var rootId = ObjectToId.get(obj);
            if (rootId != null) return [rootId, false];
            rootId = objectIdCounter;
            objectIdCounter++;
            ObjectToId.set(obj, rootId);
            idToObject[rootId] =  obj;
            return [rootId,true];
        }

        var redundantStateConsumed = ["__isProxy", "top", "parent","toString","toJSON"];

        var loggerFunction = function(target, key, value, logType){
            var retCode = 0;

            var nodeId = _shadowStackHead ? _shadowStackHead : null;

            var stringifier = omniStringifier;
            var state = logType.split("_")[1] == "reads"  ? "read" : "write";
            if ( (!nodeId && logType.indexOf("global")<0 ) || (nodeId &&
                nonCacheableNodes[nodeId]) )
                return 1;

            var rootId = getObjectId(target)[0];

            if (state == "read"){
                if (value && value.__isProxy)
                    value = value.__target;
            }

            // if (logType.indexOf("argument")>=0 || logType.indexOf("this")>=0 || logType.indexOf("closure")>=0)
            //     nodeId = parentFunctionId;

            //This check implies that the function where the proxy is being accessed
            // is different from where it was created
            // therefore, add the log in both function signatures
            var currentObjectTree = null;
            var remoteLogType = "";
            // if (_shadowStackHead != nodeId) {
            //     // console.error("shadow stack head doesn't point to proxy creating head");
            //     //Check how in the current function, it is being accessed: as closure,argument, or this
            //     if ( invocationToArgProxy[_shadowStackHead] ){
            //         var remotePrivates = invocationToArgProxy[_shadowStackHead].accessToPrivates();
            //         if (remotePrivates.hasObjectId(target)) {
            //             currentObjectTree = remotePrivates.getObjectId;
            //             var remoteRootId = currentObjectTree(target);
            //             remoteLogType += "argument_" + logType.split('_')[1];
            //         }
            //     }
            //     if (!currentObjectTree && invocationToClosureProxy[_shadowStackHead]) {
            //         var remotePrivates = invocationToClosureProxy[_shadowStackHead].accessToPrivates();
            //         if (remotePrivates.hasObjectId(target)) {
            //             currentObjectTree = remotePrivates.getObjectId;
            //             var remoteRootId = currentObjectTree(target);
            //             remoteLogType += "closure_" + logType.split('_')[1];
            //         }
            //     }
            //     if (!currentObjectTree && invocationToThisProxy[_shadowStackHead]){
            //         var remotePrivates = invocationToThisProxy[_shadowStackHead].accessToPrivates();
            //         if (remotePrivates.hasObjectId(target)) {
            //             currentObjectTree = remotePrivates.getObjectId;
            //             var remoteRootId = currentObjectTree(target);
            //             remoteLogType += "this_" + logType.split('_')[1];
            //         }
            //     }
            // }

            var childId, childLogStr;
            if ((value instanceof Object) || (typeof value == "object" && value != null) || typeof value == "function") {
                var _childId = getObjectId(value);
                childId = _childId[0];

                // Only add to tree if the value is type object and it is a new object
                _childId[1] && appendObjectTree(rootId, key, childId);
                // if (currentObjectTree) {
                //     var remoteChildId = currentObjectTree(value);
                //     remotePrivates.appendObjectTree(remoteRootId, key, remoteChildId);
                // }

                if ( (logType.indexOf("reads")>=0) && typeof value != "function") {
                    childLogStr = childId;
                }

                if (state == "write"){
                    if (_shadowStackHead && (!value || !value.__isProxy)){
                        if (!invocationToWrites[_shadowStackHead])
                            invocationToWrites[_shadowStackHead] = []
                        invocationToWrites[_shadowStackHead].push(["broken-reference", childId ]);
                    }
                }
            }

            if (redundantStateConsumed.indexOf(key)>=0 || typeof key == "symbol")
                return 0;

            //HACK
            if (state == "write" && logType.indexOf("argument")>=0 && rootId === 0
                && value === null)
                return;


            // The only time when not having a nodeId is allowed, is when the logger function is closed for a
            // global read or write. However since the nodeId is not there, we won't be adding to any signature
            //only appending the object in the tree.
            //update: reads are important even when the value is undefined
            if (!nodeId ||  (_shadowStackHead != nodeId)) return 0;

            //if the value is the window object itself, log a special signature
            if (value && value.self == value) {
                customLocalStorage[nodeId].push([logType, rootId, key, childLogStr,0 ]);
                return 0;
            }

            // if (customLocalStorage[nodeId].length > sigSizeLimit){
            //     nonCacheableNodes[nodeId] = "signature size exceeds limit";
            // }


            // Doesn't make sense to log function reads, as I currently don't have a correct way of stringifying them
            if (!customLocalStorage[nodeId][logType])
                customLocalStorage[nodeId][logType]=[];
            if (logType.indexOf("reads")>=0) {
                if (logType.indexOf('closure') >=0 ) {
                    logType = `${closureScope}_reads`;
                    childLogStr = stringifier.stringify(value, state, 1);
                    if (childLogStr && childLogStr instanceof Error){
                        nonCacheableNodes[nodeId] = childLogStr.message;
                        return 1;
                    }
                    console.log(`---closure_reads value: ${childLogStr}---`);
                }
                var log = [logType, rootId, key, childLogStr, childId];
                customLocalStorage[nodeId].readKeys.add(logType);
                customLocalStorage[nodeId].push(log);
                // customLocalStorage[nodeId][logType].push(log);
            } else {
                if (logType.indexOf('closure')>=0)
                    logType = `${closureScope}_writes`;
                customLocalStorage[nodeId].writeKeys.add(logType);
                var log = [logType, rootId, key, childLogStr ];
                customLocalStorage[nodeId].push(log);
                // customLocalStorage[nodeId][logType].push(log);
                // if (customLocalStorage[nodeId].filter(e=>e[0].indexOf("reads")>=0 && e[3] === rootId).length)
                //     freezeReadState(nodeId);
            }
            return 0;
        }


        var _handleSymbolKey = function(target, key){
            if (!Reflect.get(target, key)){
                switch (key.toString()){
                    case 'Symbol(Symbol.toPrimitive)':
                        if (+target) return +target;
                        if (''+target) return ''+target;
                }
            }
        }

        var handleNonConfigurableProperty = function(target, key){
            var method = Reflect.get(target,key);
            // if (typeof method == "function")
            //     method = method.bind
            // if (_shadowStackHead)
            //     nonCacheableNodes[_shadowStackHead] = "non-configurable;" + key;
             return method;
        }

        var handleMetaProperties = function(target, key){
            switch(key){
                case 'apply' :
                    return Reflect.get(target, key);
                    break;
                case 'call':
                    return Reflect.get(target, key);
                    break;
                case 'bind':
                    return Reflect.get(target, key);
                    break;
            }
        }

        /*You can set the prototype of an object, there fore you need to track changes to prototype*/
        var outOfScopeProperties = [/*"location", "body", */"Promise", "top", "parent", "__proto__", "self",
        "getRegistration","digest", "query","getBattery"];

        var specialSetKets = ["prototype", "constructor","__proto__"];

        var applyTargetSpcl = ["RegExp", "DOMTokenList", "Performance", "CSSStyleDeclaration" ,"FontFace","Storage","String"];

        var nonConfigurableOnly = ["window"];

        var isWindow = function(obj,cors){
            if (obj && obj.self == obj){
                try{
                    if (obj.__isProxy) return obj;
                    var proxyPrivates = globalProxyHandler.accessToPrivates();
                    var _proxyMethod = proxyPrivates.methodToProxy.get(obj);
                    if (_proxyMethod) return _proxyMethod;
                    var proxyMethod = new Proxy(obj, handler);
                    proxyPrivates.methodToProxy.set(obj, proxyMethod);
                    return proxyMethod;
                } catch (e){
                    cors.v = true;
                    return obj;
                }
            }
        }

        // function isArguments( item ) {
        //     if (item && item.__isProxy)
        //         item = item.__target;
        //     return Object.prototype.toString.call( item ) === '[object Arguments]';
        // }

        function isArguments(thisArg, target){
            if (thisArg && thisArg.__target)
                thisArg = thisArg.__target;

            if (!thisArg.length) return false;


            return Array.from(thisArg).indexOf(target)>=0;
        }

        var handler = {
          get(target, key, receiver) {

            if (key == "__isProxy") return rootType;
            if (key == "__target") return target;
            if (key == "__debug") return parentFunctionId;
            if (key == "__isClosureObj") return target[key];
            /***** HORCRUX *****/
            if (key == "__isDOMNode") return isDOMNode;
            if (key == "__isAttachedToDOMTree") return attachedToDOMTree;

            var method = Reflect.get(target,key);

            /*Overwrites the custom toJson implementation, which might be doing something else
            instead of simply returning the original object*/
            if (key == "toJSON") return method;

            if (outOfScopeProperties.includes(key)) return method;
            var desc = customMethods.getOwnPropertyDescriptor(target, key);
            if (desc && desc.configurable == false && desc.writable == false/*&& nonConfigurableOnly.indexOf(key)>=0*/) {
                return handleNonConfigurableProperty(target, key);
            }
            // var isWinObj,cors={};
            // if (isWinObj = isWindow(method,cors)){
            //     // if (!cors.v) loggerFunction(target, key, method, rootType+"_reads");
            //     return isWinObj;
            // }

            /***** HORCRUX *****/
            /* Added the condition to filter out the reads related to local DOM nodes! */
            if (rootType != "DOM_NODE")
                _ret = loggerFunction(target, key, method, rootType + "_reads");

            if (method && method.__isProxy) {
                // if (rootType == "global" || method.__isProxy == "global")
                //     return method;

                // method = method.__target;
                // Sometimes the toString method doesn't exist on certain objects
                if (Object.prototype.toString.call(target).indexOf("Arguments")>=0 && _shadowStackHead)
                    handlePropagatedProxy(method,key, "argument",_shadowStackHead)
                method = method.__target
                //     return method;
                //     var actualMethod = method.__target;
                //     var childId = getObjectId(actualMethod);
                //     appendObjectTree(0, key, childId, ObjectTree);
                // } else if (target.__isClosureProxy) {
                //     var actualMethod = method.__target;
                //     var childId = getObjectId(actualMethod);
                //     appendObjectTree(0, key, childId, ObjectTree);

                // return method;
            }
            /* If method type if function, don't wrap in proxy for now */
            if (method && (typeof method === 'object' || typeof method === "function") && !outOfScopeProperties.includes(key)) {
                // if (isDOMInheritedProperty(method)) {
                // if (_shadowStackHead)
                //     nonCacheableNodes[_shadowStackHead] = "DOM";
                // return method;
                // }
              var desc = customMethods.getOwnPropertyDescriptor(target, key);
              if (desc && ! desc.configurable && !desc.writable) return handleNonConfigurableProperty(target, key);
              window.proxyReadCount++;
              // if (window.proxyReadCount % 1000000 == 0)
              //   alert("window.Proxyreadcount is " + window.proxyReadCount);
              // if (typeof method == "function") {
              //   var _method = method._bind(target);
              //   Object.setPrototypeOf(_method, method);
              //   if (!isNative(method))
              //       Object.assign(_method, method);
              //   return new Proxy(_method,);
              // }
              /*
              The following check is kind of inconsequental, cause even if you have a proxy around the method call or apply, the apply handler
              will be anyway called
              */
              if (key == "apply" || key == "call") return method;
              // console.log("Calling get of " + key + " and setting this to ");
              // console.log(target);
              var _proxyMethod = methodToProxy.get(method);
              if (_proxyMethod) return _proxyMethod;
                /***** HORCRUX *****/
                /* Example: if target is a DOM collection and key is an index
                returned element should also be a DOM node -- set isDOMNode and attachedToDOMTree
                */
                if (receiver.__isDOMNode && receiver.__isAttachedToDOMTree) {
                    customLocalStorage[_shadowStackHead]["DOM_read"] = true;
                    // TODO (Shaghayegh)? I'm not sure if I have to add this to the DOM map and if type DOM_NODE is ok
                    // test this with local variables
                    // var proxyHandler = proxyEncapsulation(method, "DOM_NODE", null, attachedToDOMTree);
                    // proxyMethod = new Proxy(method, proxyHandler);
                }
              // var proxyHandler = rootType == "global"  ? handler : _shadowStackHead ? invocationToProxy[_shadowStackHead][1] : handler;
              var proxyMethod = new Proxy(method, handler);
              methodToProxy.set(method, proxyMethod);
              return proxyMethod;
            } else {
              return method;
            }
          },
          set(target, key, value, receiver) {
            var cors={}, method;
            /***** HORCRUX *****/
            /* Added the second condition: filter out the writes related to local DOM nodes! */
            if (!isWindow(value, cors) && rootType != "DOM_NODE")
                loggerFunction(target, key, value, rootType + "_writes");
            window.proxyWriteCount++;
            if (specialSetKets.indexOf(key)>=0 && value && value.__isProxy){
                value = value.__target;
                return Reflect.set(target, key, value);
            }
            /* Example: if node is a global var, we want to capture: node.textContent = "..." */
            if (receiver.__isDOMNode && receiver.__isAttachedToDOMTree) {
                // console.log(`Updating the value of ${key} for an attached DOM node (${target.nodeName})!`);
                customLocalStorage[_shadowStackHead]["DOM_write"] = true;
            }
            /*The final value set should always be the actual value*/
            if (value && value.__isProxy) {
                // TODO (Shaghayegh):
                if (value.__isDOMNode) {
                    attachedToDOMTree = value.__isAttachedToDOMTree;
                    isDOMNode = value.__isDOMNode;
                }
                value = value.__target;
            }
            /*if rewriting closure object, rewrite the underlying object as well*/
            if (target.__isClosureObj){
                var setter = "set_"+key;
                target[setter](value);
            }
            return Reflect.set(target, key, value);
          },

          /*
          Let p be a proxy object. The following event handler will be called :
           - if p if a function itself, p(arg) : target -> p, thisArg -> window, args = args
           - if you do p.call or p.apply, first you go inside the get handler, read the value, and then go inside the apply handler

           We need function calls to be wrapped in proxy so that the thisArg can be properly handled.
           if target.name exists, then simply call the target using thisArg[target](...args) // Doesn't work because target.name might not a property of thisArg,
           otherwise follow the already implemented routine
          */

          apply (target, thisArg, args) {
                /*
                    If no thisArg, call it in the context of window ( this happens by default )
                    If the thisArg is a proxy object however it has no corresponding target method, call apply on the proxy object itself.
                    If the thisArg is not a proxy object, call the method on the thisArg itself.
                */

                // if (thisArg && (thisArg.__isClosureObj || isArguments(thisArg) ))
                //     thisArg = window
                // TODO
                // only remove proxies if the target is an inbuilt function
                // cause otherwise the propagation metadata would be incorrect
                if (args.length){
                        args.forEach((arg,_i)=>{
                            if (arg && arg.__isProxy)
                                args[_i] = arg.__target;
                        })
                }

                // if (target && target.name && thisArg[target.name])
                //     return thisArg[target.name](...args);

                if (thisArg && thisArg.__proto__ && ((thisArg.__proto__.constructor &&
                    applyTargetSpcl.indexOf(thisArg.__proto__.constructor.name)>=0) ||
                     thisArg.__target && thisArg.self == thisArg.__target) ){
                    // if (args.length){
                    //     args.forEach((arg,_i)=>{
                    //         if (arg && arg.__isProxy)
                    //             args[_i] = arg.__target;
                    //     })
                    // }
                    if (thisArg && thisArg.__target)
                        thisArg = thisArg.__target;
                }

                if (Reflect.apply.__isProxy)
                    Reflect.apply = Reflect.apply.__target;

                /*If target is indexed inside arguments, that means arguments was set as the
                thisObj due to instrumentation*/
                if (thisArg && (thisArg.__isClosureObj ))
                    thisArg = window

                /*Try catch can't catch certain errors, handle separately
                - thisArg of type permissions*/
                /*Permissions object*/
                if (thisArg && thisArg.__isProxy && thisArg.query)
                    thisArg = thisArg.__target;
                if (thisArg && thisArg.__isProxy && thisArg.getRegistration)
                    thisArg = thisArg.__target;
                if (thisArg && thisArg.__isProxy && thisArg.getBattery)
                    thisArg = thisArg.__target;
                if (thisArg && thisArg.__isProxy && thisArg.digest)
                    thisArg = thisArg.__target;

                if ( (target.name == "valueOf"  || target.name == "toString"  ||
                    target == Function.prototype.toString) && thisArg && thisArg.__target)
                    thisArg = thisArg.__target;

                try {
                    return Reflect.apply(target, thisArg, args);
                } catch (e){
                    if (thisArg && thisArg.__target)
                        return Reflect.apply(target, thisArg.__target, args);
                    throw e;
                }
          },
          construct (target, args, newPrototype) {
              if (newPrototype && newPrototype.__target)
                newPrototype = newPrototype.__target;
              return Reflect.construct(target, args, newPrototype);
          },
          setPrototypeOf (target, prototype) {
            if (prototype && prototype.__isProxy)
                prototype = prototype.__target;
            return Reflect.setPrototypeOf(target, prototype);
          },
          getPrototypeOf (target) {
            return Reflect.getPrototypeOf(target);
          },
          // getOwnPropertyDescriptor (target, propertyKey) {
          //   var r =  Reflect.getOwnPropertyDescriptor(target, propertyKey);
          //   loggerFunction(target, propertyKey, r, rootType + "_reads");
          //   return r;
          // },
          ownKeys (target) {
            return Reflect.ownKeys(target)
          },
          has (target, propertyKey) {
            return Reflect.has(target, propertyKey);
          },
          isExtensible (target) {
            return Reflect.isExtensible(target)
          },
          defineProperty (target, propertyKey, attributes) {
            if (attributes && attributes.__isProxy)
                attributes = attributes.__target;
            return Reflect.defineProperty(target, propertyKey, attributes);
          },
          deleteProperty (target, propertyKey) {
            return Reflect.deleteProperty(target, propertyKey);
          },
          preventExtensions (target) {
            return  Reflect.preventExtensions(target);
          },
          accessToPrivates (){
            return {ObjectTree: ObjectTree,getObjectId:getObjectId, appendObjectTree:appendObjectTree, hasObjectId:hasObjectId,
                    methodToProxy:methodToProxy, idToObject: idToObject}
          },

          getProcessedSignature (){
            var sigProcessor = new SignatureProcessor();
            sigProcessor.process();
            sigProcessor.postProcess();

            // // //Commenting out signature propogation for now
            // // //TODO
            sigProcessor.signaturePropogate();
            return sigProcessor.processedSig;
          }

        }

        return handler;
    }

    var globalProxyHandler = proxyEncapsulation(window,"global");

    var {proxy, revoke} = Proxy.revocable(window, globalProxyHandler);
    // Flag to disable proxy
    window.window = proxy;
    // window.window = window;
    globalProxyHandler.accessToPrivates().methodToProxy.set(window, proxy);

    if (pageLoaded){
        window.window = window;
    }

    this.getShadowStackHead = function(){
        return _shadowStackHead;
    }

    this.getNonCacheableFunctions = function() {
        // return Array.from(new Set(nonCacheableNodes));
        return nonCacheableNodes;
    }

    this.getCallGraph = function() {
        return callGraph;
    }

    this.getParentNodes = function(){
        return parentNodes;
    }

    this.getNonLeafNodes=function(){
        return nonLeafNodes;
    }

    this.getDC = function(){
        return domCounter;
    }

    this.updateDC = function(){
        domCounter++;
    }
    this.getInvocationProperties = function() {
        return nodesByProperties;
    }

    this.getTimingInfo = function(){
        return timingInfo;
    }

    this.getSigSizes = function(){
        return sigSizes;
    }

    this.setMutationContext = function(command, nodeId) {
        currentMutationContext = nodeId;
    }

	this.setGlobal = function (gthis) {
		globalThis = gthis;
	}

    this.getFunctions = function () {
        return functions;
    }

    this.getInvocations = function() {
        return invocationList;
    }

    this.getCacheStats = function () {
        return cacheStats;
    }

    this.getCustomCache = function() {
        return customLocalStorage;
    }

    this.getProcessedSignature = function() {
        return processedSignature;
    }

    this.setCustomCache = function(customCache) {
        this.customLocalStorage = customCache;
    }

    this.getObjectTree = function(){
        return ObjectTree;
    }

    this.getObjectToPath = function() {
        return objectToPath;
    }

    this.getObjectToId = function(){
        return ObjectToId;
    }

    var accumulateCache = function(nodeId) {
        var aggrCache = {};
        var lCallees = calleeMap[nodeId];

        var traverseChildren = function(nodeId) {
            var lCallees = calleeMap[nodeId];
            if (lCallees) {
                lCallees.forEach(function(callee){

                });
            }
        }
    }

    this.handleProtoAssignments = function(targetPrototype) {
        if (pageLoaded) return targetPrototype;
        if (targetPrototype && targetPrototype.__isProxy)
            return targetPrototype.__target;
        else return targetPrototype;
    }

    this.handleAssignments = function(assignment, assignee){
        return assignee;
    }

    this.handleTypeOf = function(obj){
        if (pageLoaded || _shadowStackHead in nonCacheableNodes)  return obj;
        var state,proxyMap,readInd, type;
        // return type;
        if (!pageLoaded && _shadowStackHead && obj && (state = obj.__isProxy)){
            switch (state) {
                case "argument" :
                    proxyMap = invocationToArgProxy; break;
                case "global" :
                    proxyMap = globalProxyHandler; break;
                case "this" :
                    proxyMap = invocationToThisProxy; break;
                case "closure":
                    proxyMap = invocationToClosureProxy; break;
            };
            var proxyPrivates = state == "global" ? globalProxyHandler : proxyMap[_shadowStackHead];
            if (!proxyPrivates) return obj;
            var objId = proxyPrivates.accessToPrivates().getObjectId(obj.__target);
            // if (objId[1]) throw new Error("typeof argument has no object id");
            if (objId[1]) return obj;
            type = typeof obj;
            customLocalStorage[_shadowStackHead].push([state+"_reads",objId[0], "typeof", type, type]);
            // if ( (readInd = customLocalStorage[_shadowStackHead].findIndex(e=>e[3]===objId[0])) >= 0)
                // customLocalStorage[_shadowStackHead].splice(readInd,1);

            return obj;
        }
        return obj;
    }

    this.handleComparison = function(obj, operator, value){
        if (pageLoaded || _shadowStackHead in nonCacheableNodes) return obj;
        var state, proxymap, type, readInd,cmpDelim = ";&;";
        if (_shadowStackHead && obj && (state = obj.__isProxy)){
            switch (state) {
                case "argument" :
                    proxyMap = invocationToArgProxy; break;
                case "global" :
                    proxyMap = globalProxyHandler; break;
                case "this" :
                    proxyMap = invocationToThisProxy; break;
                case "closure":
                    proxyMap = invocationToClosureProxy; break;
            };
            var proxyPrivates = state == "global" ? globalProxyHandler : proxyMap[_shadowStackHead];
            if (!proxyPrivates) return obj;
            var objId = proxyPrivates.accessToPrivates().getObjectId(obj.__target);
            if (objId[1]) return obj;

            var result;
            switch (operator){
                case "==": result = obj == value; break;
                case "===": result = obj === value; break;
                case "!=": result = obj != value; break;
                case "!==": result = obj !== value; break;
                case "instanceof": obj = target instanceof value; break;
                case "in": result = obj in value; break;
            }
            customLocalStorage[_shadowStackHead].push([state+"_reads",objId[0], operator+cmpDelim+result, value, value]);
            // if ( (readInd = customLocalStorage[_shadowStackHead].findIndex(e=>e[3]===objId[0])) >= 0)
            //     customLocalStorage[_shadowStackHead].splice(readInd,1);

            if (obj && obj.__isProxy) return obj.__target;
            else return obj;
        }
        if (obj && obj.__isProxy) return obj.__target;
        else return obj;
    }

    this.traversePath = function(path,params){
        var param,
            pathDelim = ";;;;";
        var state = path.split(pathDelim)[0],proxyMap;
            switch (state) {
                case "argument" :
                    param = params[0];break;
                case "global" :
                     param = window; break;
                case "this" :
                     param = params[2]; break;
                case "closure":
                    param = params[1];break;
            }
        path.split(pathDelim).forEach((prop, ind)=>{
            if (ind === 0) return;
            var len = path.split(pathDelim).length;
            if (param)
                param = param[prop];
        })
        return param;
    }

    this.getIdFromProxy = function(obj){
        if (pageLoaded) return null;
        var state, proxyMap;
        if (state = obj.__isProxy){
            switch (state) {
                case "argument" :
                    proxyMap = invocationToArgProxy; break;
                case "global" :
                    proxyMap = globalProxyHandler; break;
                case "this" :
                    proxyMap = invocationToThisProxy; break;
                case "closure":
                    proxyMap = invocationToClosureProxy; break;
            };
            var proxyPrivates = state == "global" ? globalProxyHandler : proxyMap[_shadowStackHead];
            if (!proxyPrivates) return;
            var objId = proxyPrivates.accessToPrivates().getObjectId(obj.__target);
            if (objId[1]) return null;

            return objId[0];
        }
    }

    this.getPathFromProxyId = function(id,state,nodeId){
        var proxyMap;
        switch (state) {
            case "argument" :
                proxyMap = invocationToArgProxy; break;
            case "global" :
                proxyMap = globalProxyHandler; break;
            case "this" :
                proxyMap = invocationToThisProxy; break;
            case "closure":
                proxyMap = invocationToClosureProxy; break;
        };
        var proxyPrivates = state == "global" ? globalProxyHandler : proxyMap[nodeId];
        var objectTree = proxyPrivates.accessToPrivates().ObjectTree;
        var objectToPath = {0:state};

        var constructPath = function(objectId){
            if (objectToPath[objectId]) return objectToPath[objectId];
            var path = "",  pathDelim = ";;;;";
            for (var nodeId in objectTree){
                for (var edge in objectTree[nodeId]) {
                    var _id = objectTree[nodeId][edge].indexOf(parseInt(objectId));
                    if (_id>=0) {
                        var parentPath = constructPath(nodeId);
                        path = parentPath + pathDelim + edge.substr(2);
                        objectToPath[objectId] = path;
                        return path;
                    }
                }
            }
            return path;
        }
        return constructPath(id);
    }

    this.handleProxyComparisons = function(...rhs){
        if (!rhs[0]) return rhs[0];
        if (rhs.length > 1 ) return rhs[rhs.length - 1];
        else if (rhs[0] && rhs[0].__isProxy) return rhs[0].__target;
        else return rhs[0];
    }

    this.isProxy = function(obj){
        if (pageLoaded) return obj;
        try {
            if (!obj || (typeof obj != "function" && typeof obj !="object")) return obj;
            if (obj.__isProxy) return obj.__target
            else return obj;
        } catch (e){
            return obj;
        }
    }

    this.logWrite = function(functionIdentifier, rhs, variableName, listOfProperties ){
        var key = variableName;
        if (listOfProperties.length > 0)
            key = _patchLogString(variableName, listOfProperties);
        customLocalStorage[functionIdentifier]["writes"][key] = rhs;
        return rhs;
    }

    var _patchLogString = function(input, varArray){
        var count = 0;
        var output = input.replace(/(\[).(\])/g, function(match, g1, g2, offset, string){
            var replaceString = varArray[count]
            if (typeof varArray[count] == "symbol")
                replaceString = varArray[count].toString();
            count++;
            return g1 + replaceString + g2;
        });
        return output
    }

    this.logRead = function(functionIdentifier, readArray, listOfProperties){
        var key = readArray[0]
        if (listOfProperties.length > 0)
            key = _patchLogString(readArray[0],listOfProperties)
        customLocalStorage[functionIdentifier]["reads"][key] = readArray[1];
        return readArray[1];
    }

    this.logThrowStatement = function(throwArg){
        var cacheIndex = _shadowStackHead ? _shadowStackHead : null;
        if (pageLoaded || !cacheIndex || nonCacheableNodes[cacheIndex]) return throwArg;
        var evalArg="";
        if (throwArg instanceof Error){
            evalArg += "new Error(" + JSON.stringify(escapeRegExp(throwArg.message)) + ")";
        } else evalArg = throwArg;
        var throwString = "throw " + evalArg;
        customLocalStorage[cacheIndex]["IBF"] += "\n" + throwString + "\n";
        return throwArg;
    }

    var cleanUpReturnValue = function(ret,ind, seenObjs){
        try {
            switch (typeof ret) {
                case "object" :
                    if (!ret || seenObjs.indexOf(ret)>=0)
                        return;
                    /*check for window object*/
                    if (ret && ret.self == ret)
                        return;
                    if (ind === -1) {
                        seenObjs.push(ret);
                    } else {
                        if (!ret[ind] || ret[ind].self == ret[ind]){
                            return;
                        }
                        else if (ret[ind].__isProxy)
                            ret[ind] = ret[ind].__target;
                        seenObjs.push(ret[ind]);
                        ret = ret[ind];
                    }
                        if (Array.isArray(ret)){
                        for (var _i = 0, _len = ret.length; _i < _len; _i++) {
                            cleanUpReturnValue(ret,_i, seenObjs);
                        }
                    } else {
                        /*o.keys returns enumerable properties only
                        not sure if we need to rewrite non enumerable properties as well*/
                        var propNames = Object.keys(ret);
                        for (var k of propNames ){
                            cleanUpReturnValue(ret,k, seenObjs);
                        }
                    }
                    break;
                case "function":
                    if (ind === -1) {
                    } else if (ret[ind] && ret[ind].__isProxy)
                        ret[ind] = ret[ind].__target;
                default: break;
            }
            return;
        } catch (e){
            return;
        }
    }

    this.logReturnValue = function(functionIdentifier, returnValue, params) {
        var cacheIndex = functionIdentifier + "_count" + invocationsIndName[functionIdentifier];
        var cacheIndex = _shadowStackHead ? _shadowStackHead : null;
        if (pageLoaded || !cacheIndex || nonCacheableNodes[cacheIndex]) return returnValue;
        // if (isDOMInheritedProperty(returnValue)){
        //     nonCacheableNodes[cacheIndex] = "DOM";
        //     //Don't need to reset shadow stack head as the exit function is already called
        //     // hence the shadow stack head no longer points to the current function
        //     // _shadowStackHead = null;
        //     // this.exitFunction(functionIdentifier, params);
        //     return returnValue;
        // }
        // return returnValue;
        // var _retString = omniStringifier.stringify(returnValue,"read",2);
        // if (_retString && _retString instanceof Error) {
        //         nonCacheableNodes[cacheIndex] = _retString.message;
        // }
        // /*If the return value couldn't be stringified, doesn't matter. The function is marked as uncacheable anyway*/
        // if (customLocalStorage[cacheIndex]) customLocalStorage[cacheIndex]["returnValue"] = _retString;

        var seenObjs = [];
        if (returnValue && returnValue.__isProxy)
            returnValue = returnValue.__target;
        return cleanUpReturnValue(returnValue, -1,seenObjs), returnValue;
    }

    var logNonProxyParams = function(nodeId,params){
        for(var i in params) {
                if (params[i] != null && !params[i].__isProxy && typeof params[i] != "function")
                    var strParam =  stringify(params[i]);
                 if (strParam && strParam.__proto__.__proto__ == "Error") return
                 customLocalStorage[nodeId].arguments.before[i] = strParam;
        }
    }


    var mergeObjects = function(src, dst){
        for (var property in src) {
            dst[property] = src[property];
        }
    }

    var replay_arg = (log, arg,cmp,params) => {
        var result = true;
        var prop = log[1], value = log[2];
        // if (!cmp){
        //     if (typeof value == "object")
        //         value = value[0];
        //     else value = omniStringifier.parse(value,params);
        // }
        result = result && traverseToTarget(arg, prop, value,cmp);
        return result;
    };

    var getChildAccessor = function(log, params, path2function){
        var fnRoot;
        var fnScope = path2function.split(';;;;')[0],fnKey = path2function.split(';;;;').slice(1,);
        switch (fnScope){
            case "global": fnRoot = window; break;
            case "argument":fnRoot = params[0];break;
            case "closure":fnRoot = params[1];break;
            case "this": fnRoot = params[2];break;
        }
        var fnkeyLen = fnKey.length;
        fnKey.forEach((key)=>{
            fnRoot = fnRoot[key];
        })
        return fnRoot;
    }

    var replay_childClosure = function(log,arg,cmp,params){
        var tokens = log[1].split(";&;")
        var [path2function,prop] = [tokens.slice(0,tokens.length-1),tokens[tokens.length-1]],
            value = log[2], fnRoot;
        // if (!cmp) {
        //     if (typeof value != "object")
        //         throw new Error("Can't replay child closure where value is a reference");
        //     value = value[0]
        // }
        var newParams = [...params];
        var fnRoot;
        path2function.forEach((path)=>{
            fnRoot = getChildAccessor(log, newParams, path);
            var scopeObj = fnRoot.__getScope__();
            //update the closure scope
            //if path2function has more than 2 entries, then the second one
            // has to be a closure, so update the closure params
            newParams[1] = scopeObj
        })
        var accessor = cmp ? "__get__" : "__set__";
        return fnRoot[accessor](prop,value)
    }

    var replay_childIBF = function(log, params){
        var fnRoot = getChildAccessor(log, params);
        fnRoot["__replayIBF__"](log[2]);
    }

    var replay_closure = (write_array, closure,cmp) => {
        var result = true;
        write_array.forEach((write_log)=>{
            var prop = write_log[0], value = write_log[1];
            result = result &&  traverseToTarget(closure, prop, value,cmp);
            // target = omniStringifier.parse(value);
            // eval(write_log);
        })
        return result;
    };
    var replay_this = (write_array, thisObj,cmp) => {
        var result = true;
        write_array.forEach((write_log)=>{
            var prop = write_log[0], value = write_log[1];
            result = result &&  traverseToTarget(thisObj, prop, value,cmp);
            // target = omniStringifier.parse(value);
            // eval(write_log);
        })
        return result;
    }
    var replay_global = (write_array, global,cmp) => {
        var result = true;
        write_array.forEach((write_log)=>{
            var prop = write_log[0], value = write_log[1];
            result = result &&  traverseToTarget(global, prop, value,cmp);
            // target = omniStringifier.parse(value);
            // eval(write_log);
        })
        return result;
    }

    var replay_IBF = (IBFs, arg, closure, thisObj) => {
        eval(IBFs);
    }

    this.replay_IBF = replay_IBF;

    var comparisonOperators = ["==","!=","===","!==","instanceof","in"]

    var specialMatchingPaths = ["localStorage","cookie"]

    var traverseToTarget  = function(root, path,value,cmp){
        var target = root,
            pathDelim = ";;;;", result = !cmp, opIndex = -1,
            cmpDelim = ";&;";
        path.split(pathDelim).forEach((prop, ind)=>{
            if (ind==0) return;
            var len = path.split(pathDelim).length;
            if ( target && (ind == len-1 || prop == "typeof")) {
                if (cmp){
                    if (specialMatchingPaths.indexOf(prop)>=0)
                        result = true;
                    else if (prop == "typeof")
                        result = typeof target == value;
                    else if (prop == "self")
                        result = target[prop] == target;
                    else if (prop.indexOf(cmpDelim)>=0) {
                        if ((opIndex = comparisonOperators.indexOf(prop.split(cmpDelim)[0]))>=0) {
                            var cmpOut = prop.split(cmpDelim)[1] === 'true';
                            switch (comparisonOperators[opIndex]){
                                case "==": result = (target == value) == cmpOut; break;
                                case "===": result = (target === value) == cmpOut; break;
                                case "!=": result = (target != value) == cmpOut; break;
                                case "!==": result = (target !== value) == cmpOut; break;
                                case "instanceof": result = (target instanceof value) == cmpOut; break;
                                case "in": result = (target in value) == cmpOut; break;
                            }
                        }
                    }
                    else {
                        if (typeof value == "string"){
                            var [Ovalue, Otype, Olen] = value.split(';;&;;');
                            if (Otype){
                                Olen = Number.parseInt(Olen);
                                if (Otype == "array" ) {
                                    if (!Array.isArray(target[prop]))
                                        result = false;
                                    else if (Olen != target[prop].length)
                                        result = false;
                                    else {
                                        var [tval,_,__] = omniStringifier.stringify(target[prop],"read").split(';;&;;');
                                        result = tval == Ovalue;
                                    }
                                } else if (Otype == "object"){
                                    if (typeof target[prop] != "object")
                                        result = false;
                                    else if (target[prop] && Object.keys(target[prop]).length != Olen)
                                        result = false;
                                    else {
                                        var [tval,_,__] = omniStringifier.stringify(target[prop],"read").split(';;&;;');
                                        result = tval == Ovalue;
                                    }
                                }
                            }
                            else {
                                var tval = omniStringifier.stringify(target[prop],"read")
                                if (typeof tval == "string")
                                    result = tval.split(';;&;;')[0] == Ovalue;
                                else result = target[prop] == Ovalue;
                            }
                        }
                        else {
                            result = target[prop] == value[0];
                        }
                    }
                }
                else {
                    if (target.__isClosureObj){
                        target["set"+prop](value)

                    } else {
                        target[prop] = (value);
                    }
                    result = true;
                }
            } else if (target)
                target = target[prop];
        })
        return result;
    }

    this.traverseToTarget = traverseToTarget;

    var verifyAndReplayCache = function(cacheIndex,writeObj) {
        //Replay all the non global writes speculatively
        var sig = processedSignature[cacheIndex];
        if (Object.prototype.toString.call(writeObj).indexOf("Arguments")>=0)
            replay_arg(sig.argument_writes, writeObj);
        else if (writeObj.__isClosureProxy)
            replay_closure(sig.closure_writes, writeObj);
        else replay_this(sig.this_writes, writeObj);
    }

    var getArgTypes = function(args, delim){
        var argTypes = "";
        for (var a of args)
            argTypes += typeof a + delim;
        return argTypes;
    }

    var exceedsInvocationLimit = function(nodeId){
        return nodeId.split("_count")[1] > INVOCATION_LIMIT;
    }

    this.cacheInit = function(nodeId, isRoot){
        if (invocationsIndName[nodeId] != null)
            invocationsIndName[nodeId]++;
        else invocationsIndName[nodeId] = 0;

        var cacheIndex = nodeId + "_count" + invocationsIndName[nodeId];
        // invocationList.push(cacheIndex);


        // if (instrumentationPattern == "cg"){
        //     var _e = new Error;
        //     var sd = _e.stack.split('\n');
        //     if (sd.length == 4)
        //         isRoot = true;
        // }
        // if (isRoot)
        //     rootInvocs.push(cacheIndex);

        // timingInfo[cacheIndex].push(window.performance.now());
        if (instrumentationPattern == "record" || instrumentationPattern == "replay") {

            callGraph[cacheIndex] = [];
            customLocalStorage[cacheIndex] = []

            if (_shadowStackHead) {
                callGraph[_shadowStackHead].push(cacheIndex)
                // insert placeholder for children signature
                // if (customLocalStorage[_shadowStackHead])
                customLocalStorage[_shadowStackHead].push(cacheIndex)
                // Before entering child function, freeze the state of the parent function
                // freezeReadState(_shadowStackHead);
            } else {
                parentNodes.push(cacheIndex);
            }

            shadowStack.push(cacheIndex);
            _shadowStackHead = cacheIndex;

            PMD[cacheIndex] = {argument:[],this:[],closure:[]}

            // if (invocationsIndName[nodeId] > INVOCATION_LIMIT ){
            //     nonCacheableNodes[cacheIndex] = "INVOCLIMIT";
            //     // _shadowStackHead = null;
            //     // window.performance.mark(cacheIndex);
            //     // timingInfo[cacheIndex].push(window.performance.now());
            //     return;
            // }
            customLocalStorage[cacheIndex]["IBF"] = "";
            customLocalStorage[cacheIndex].CFG = [];
            customLocalStorage[cacheIndex]["ec"] = window && window.document ?
                window.document.location.href : null;
            customLocalStorage[cacheIndex].readKeys = new Set();
            customLocalStorage[cacheIndex].writeKeys = new Set();
            // customLocalStorage[cacheIndex].startTime = window.performance.now();
        } else {
            // if (!(cacheIndex in callGraph))
            timingInfo[cacheIndex] = [];
            timingInfo[cacheIndex].push(window.performance.now());

            callGraph[cacheIndex] = [];
            if (_shadowStackHead) {
                callGraph[_shadowStackHead].push(cacheIndex)
            } else {
                rootInvocs.push(cacheIndex);
                curRoot = cacheIndex;
            }


            shadowStack.push(cacheIndex);
            _shadowStackHead = cacheIndex;
        }
        // window.performance.mark(cacheIndex);
    }

    var checkForCacheHit = function(sig,arg,closure,thisObj){
        try {
            var evalString = sig.filter(e=>e[0]=="finalRead")[0][1];
            // evalString = evalString.split("&&").slice(0,2).join("&&");
            var CHF = new Function('arg,closure,thisObj','return ' + evalString);
            return CHF(arg,closure,thisObj) && false;
            return false;
        } catch (e) {
            throw new Error("Error while determining cache hit status");
        }
    }

    /*
    Depending on value of cmp, will compare of execute the given state
    if cmp is true will compare and return the result otherwise execute
    state : Signature of the function who's state has to be compared
    Returns true when executing state, and for compare will return the result of comparing the state
    */
    var compareOrExecuteState = function(sig,cmp, ...params){
        var fn = replay_arg, param = null
            result = true;
        var delim = cmp ? "_reads" : "_writes";
        // var sig = sig.filter(e=>e[0].indexOf(delim)>=0);
        var keys = [...new Set(sig.map(e=>e[0]))];
        var scInd = 0, ind=0; //short-circuit index;
        for (entry of sig){
        // sig.forEach((entry,ind)=>{
            var type = entry[0];
            var state = entry[0].split(delim)[0],proxyMap;
            fn = replay_arg;
            switch (state) {
                case "argument" :
                    param = params[0];break;
                case "global" :
                     param = window; break;
                case "this" :
                     param = params[2]; break;
                case "closure":
                    param = params[1];break;
                case "childClosure":
                    fn = replay_childClosure;break
            }
            result = result && fn(entry,param, cmp,params);
            ind++;
            scInd = ind;
            if (cmp && !result)
                return [result,scInd];
        }

        return [result,scInd];
    }

    var preProcessWrites = function(writeSig, returnValue, params){
        writeSig.forEach((entry)=>{
            if (typeof entry[2] == "object")
                entry[2] = entry[2][0];
            else entry[2] = omniStringifier.parse(entry[2],params);
        })

        if (returnValue && returnValue.length != 3){
            returnValue[1] =  omniStringifier.parse(returnValue[1],params);
        }
    }

    /*
    Returns an array
    [cacheHit, return value]
    params : argument, closure, this
    */

    this.cacheAndReplay = function(nodeId, ...params){
        // return [false,null];
        // var cacheIndex = _shadowStackHead ? _shadowStackHead : null;
        var cacheIndex = nodeId + "_count" + invocationsIndName[nodeId];
        // if (skipReplay){
        //     cacheStats.misses.empty.push(cacheIndex);
        //     return [false, null]
        // }
        if (invocationsIndName[nodeId] > INVOCATION_LIMIT){
            cacheStats.misses.empty.push(cacheIndex);
            return [false,null];
        }
        var sig, returnValue = [];
        // return [false,null];
        // timingInfo[cacheIndex]=[];
        // timingInfo[cacheIndex].push(window.performance.now());
        if (sig = processedSignature[keysToStdKeys[cacheIndex]]) {
            // return []
            if (!sig.length){
                cacheStats.misses.empty.push(cacheIndex);
                // timingInfo[cacheIndex].push(window.performance.now());
                return [false, null];
            }
            try {
                /*Iterate sig once and seperate different parts*/
                var ibf, childIBF, _ret, readSig=[], writeSig=[],ret;
                for (_e of sig){
                    if (_e[0].indexOf("_reads")>=0)
                        readSig.push(_e);
                    else if (_e[0].indexOf("_writes")>=0)
                        writeSig.push(_e);
                    else if (_e[0] == "IBF")
                        ibf = _e;
                    else if (_e[0]== "childIBF")
                        childIBF = _e;
                    else if (_e[0] == "returnValue")
                        _ret = _e;
                }
                var readStateMatch = compareOrExecuteState(readSig,true,...params);
                if (readStateMatch[0]) {
                    // cacheStats.hits.push(cacheIndex);
                    // timingInfo[cacheIndex].push(window.performance.now());
                    var _wP = writeStateProcessed.get(sig);
                    if (_wP === undefined){
                        try {
                            preProcessWrites(writeSig, _ret, params);
                        } catch (e){
                            writeStateProcessed.set(sig, false);
                            throw e;
                        }
                    } else if (_wP === false){
                        cacheStats.misses.mismatch.push(cacheIndex);
                        return [false, null];
                    }
                    writeStateProcessed.set(sig, true);
                    compareOrExecuteState(writeSig,false,...params)
                    // _i = sig.filter(e=>e[0] == "IBF");
                    if (ibf){
                        // return [false, null];
                        replay_IBF(ibf[1],...params);
                    }
                    // _i = sig.filter(e=>e[0] == "childIBF")
                    if (childIBF)
                        replay_childIBF(childIBF[1],params)
                    // compareOrExecuteState(sig,false,...params)
                    // var _ret = sig.filter(e=>e[0] == "returnValue"),ret;
                    if (_ret){
                        // if (_ret.length == 3)
                        ret = _ret[1];
                        // else ret = omniStringifier.parse(_ret[1],params);
                    }
                    cacheStats.hits.push(cacheIndex);
                    // timingInfo[cacheIndex].push(window.performance.now());
                    // sigSizes[cacheIndex]=sig.reduce((acc, cur)=>{
                    //     var len =0;
                    //     if (typeof cur[1] == "string")
                    //         len += cur[1].length
                    //     if (cur[2] && typeof cur[2] == "string")
                    //         len += cur[2].length;
                    //     return len + acc},0);
                    return [true,ret];
                } else {
                    cacheStats.misses.mismatch.push(cacheIndex);
                    // timingInfo[cacheIndex].push(window.performance.now());
                    // var _ind = readStateMatch[1];
                    // sigSizes[cacheIndex]=sig.slice(0,_ind).reduce((acc, cur)=>{
                    //     var len =0;
                    //     if (typeof cur[1] == "string")
                    //         len += cur[1].length
                    //     if (cur[2] && typeof cur[2] == "string")
                    //         len += cur[2].length;
                    //     return len + acc},0);
                    return [false, null];
                }
            } catch (e) {
                if (ibf && ibf.length && ibf[0][1].indexOf("throw ")>=0){
                    cacheStats.hits.push(cacheIndex);
                    // timingInfo[cacheIndex].push(window.performance.now());
                    // sigSizes[cacheIndex]=sig.reduce((acc, cur)=>{
                    //     var len =0;
                    //     if (typeof cur[1] == "string")
                    //         len += cur[1].length
                    //     if (cur[2] && typeof cur[2] == "string")
                    //         len += cur[2].length;
                    //     return len + acc},0);
                    throw e;
                }
                cacheStats.misses.error.push([cacheIndex,e.message]);

                // if (e.message && e.message.indexOf("OMNI")<0) throw e;
                // cacheStats.hits.pop();
                // timingInfo[cacheIndex].push(window.performance.now());
                return [false,null];
            }
        }
        cacheStats.misses.empty.push(cacheIndex);
        // timingInfo[cacheIndex].push(window.performance.now());
        return [false,null];
    }

    var getRootIds = function(readArr){
        var ids = [];
        /*If the 4th index is string, it means the read has been processed already
        however if the logType is write, then add it regardless*/
        readArr.forEach((read)=>{
            if (typeof read[3] != "string" ||
                read[3].indexOf("__func__source")>=0 ||
                read[0].indexOf("_write")>=0)
                ids.push(read[1]);
        })
        // return [...new Set(ids)];
        return ids;
    }

    var filterSignature = function(e, roots, writes, key){
        if (e[0] != key) return true;
        var rootInd = roots.indexOf(e[4]);
        if (rootInd>=0){
            roots.splice(rootInd, 1);
            return false;
        }
        var writeInd = writes.indexOf(e[4]);
        if (writeInd>=0){
            writes.splice(writeInd,1);
            return false;
        }
        return true;
    }

    var uniqueSignature = function(sig){
        var strSig = sig.map(e=>JSON.stringify(e));
        var uS = new Set(strSig);
        var uniqueArr = [...uS].map(e=>JSON.parse(e));
        return uniqueArr;
    }

    var freezeReadState = function(nodeId){
        if (nodeId in nonCacheableNodes) return;
        var signature = customLocalStorage[nodeId];
        if (signature == null) return;
        if (signature.length > sigSizeLimit) {
            nonCacheableNodes[nodeId]="signature size exceeded capacity";
            return;
        }
        // signature = uniqueSignature(signature);
        // var readKeys = [...new Set(signature.filter(e=>e[0].indexOf("reads")>0).map(e=>e[0]))];
        var readKeys = signature.readKeys;
        readKeys.forEach((key)=>{
            var state = key.split("_reads")[0],proxyMap;
            var currStateWrites = invocationToWrites[nodeId] ? invocationToWrites[nodeId].filter(e=>e[0]==state).map(e=>e[1]) : [];
            switch (state) {
                case "argument" :
                    proxyMap = invocationToArgProxy; break;
                case "global" :
                    proxyMap = globalProxyHandler; break;
                case "this" :
                    proxyMap = invocationToThisProxy; break;
                case "closure":
                    proxyMap = invocationToClosureProxy; break;
            }
            var rootObjects = getRootIds(signature.filter(e=>e[0].split("_")[0]==state));
            // customLocalStorage[nodeId] = signature.filter((e)=> { return e[0] != key ||
            //     (rootObjects.indexOf(e[4])<0 && currStateWrites.indexOf(e[4])<0)} );
            //Disable filtering of signature entriesinde
            // customLocalStorage[nodeId] = signature.filter((e)=>{return filterSignature(e, rootObjects, currStateWrites, key)});
            (signature.returnValue != null) && (customLocalStorage[nodeId].returnValue = signature.returnValue)
            signature.IBF && (customLocalStorage[nodeId].IBF = signature.IBF)
            customLocalStorage[nodeId].ec = signature.ec
            customLocalStorage[nodeId].readKeys = signature.readKeys;
            customLocalStorage[nodeId].writeKeys = signature.writeKeys;
            signature = customLocalStorage[nodeId];
            signature.forEach((readArr,ind)=>{
                if (typeof readArr[3] == "number" && readArr[0] == key){
                    var proxyPrivates = state == "global" ? globalProxyHandler : proxyMap[nodeId];
                    var obj = proxyPrivates.accessToPrivates().idToObject[readArr[3]];
                    if (!obj) console.error("Object not found during freezing read state");
                    var str = omniStringifier.stringify(obj,"read",1);
                    if (str){
                        if (str instanceof Error){
                            nonCacheableNodes[nodeId] = str.message;
                            return 1;
                        }
                        if (str.length > OMNI_SIZE_LIMIT){
                            nonCacheableNodes[nodeId] = "Value exceeded OMNI_SIZE_LIMIT";
                            return 1;
                        }
                    }
                    signature[ind] = [readArr[0], readArr[1], readArr[2], str, null];
                }
            })
        })
    }

    this.exitFunction = function(nodeId, enableRecord){
        // var cacheIndexExp = nodeId + "_count" + invocationsIndName[nodeId];
        var cacheIndex = _shadowStackHead ? _shadowStackHead : null;
        if (!cacheIndex) return;

        if (instrumentationPattern == "cg")
                timingInfo[cacheIndex].push(window.performance.now());

        if (instrumentationPattern == "replay")
            return;
        shadowStack.pop();
        if (shadowStack.length)
            _shadowStackHead = shadowStack[shadowStack.length - 1];
        else {
            _shadowStackHead = null;
        }

    }

    this.logBranchTaken = function(nodeId, branchInfo){
        var cacheIndex = _shadowStackHead ? _shadowStackHead : null;
        if (!cacheIndex) return;
        customLocalStorage[cacheIndex].CFG.push(branchInfo);
    }

    this.updateClosureCache = function(cacheIndex, closureObj){
        Object.keys(closureObj).forEach((k)=>{
            if (typeof closureObj[k] != "object"){
                var writeAr = [0, k, closureObj[k]];
                customLocalStorage[cacheIndex]["closure_writes"].push(writeAr);
            }
        })
        return;
    }

    this.dumpArguments = function(nodeId, params) {
        // functionTimerE[nodeId] = performance.now();
        // window.sigStack[nodeId].push(functionTimerE[nodeId] - functionTimerS[nodeId]);
        // return;
        if (customLocalStorage[nodeId]["arguments"])
            customLocalStorage[nodeId]["arguments"]["after"] = params;
        shadowStack.pop();
    }

    this.logCallee = function(callee, calleeRes){
        if (callee && callee.toString){
            var _isNative = isNative(callee.toString());
            if(!_isNative){
                if (!_shadowStackHead)
                    throw new Error("no shadow stack found");
                nonLeafNodes.push(_shadowStackHead);
            }
        } else {
            console.error(callee + " no toString method for object");
        }
        return calleeRes;
    }

    this.logIBF = function(functionId, IBF, callee, IBFStrDecl, IBFStrCall, argStrs, argVals){
        if (callee && callee.toString){
            var actualCallee = callee;
            if (callee.__isProxy) actualCallee = callee.__target;
            var _isNative = isNative(Object.prototype.toString.call(actualCallee));
            if (!_isNative && !actualCallee.__isShimmed__) {
                if (callee.__isProxy){
                    var childLen = callGraph[_shadowStackHead].length;
                    if (childLen) {
                        var stackHead = callGraph[_shadowStackHead][childLen-1]
                        handlePropagatedProxy(callee, null, "closure",stackHead)
                    }
                }
                return IBF;
            }
        } else {
            // TODO callee has no string method, can't store metedata information
            // console.error("Callee has no toString method")
        }
        var ibfStr = IBFStrCall, argsConverted = [],val;
        // var cacheIndex = functionId + "_count" + invocationsIndName[functionId];
        var cacheIndex = _shadowStackHead ? _shadowStackHead : null;
        if (!cacheIndex || nonCacheableNodes[cacheIndex] || pageLoaded)
            return IBF;

        // if ((IBFStrDecl != null && IBFStrDecl.indexOf("createElement")>=0 )){
        //     nonCacheableNodes[cacheIndex] = "DOM element being created";
        //     return IBF;
        // }
        /*
        Commented the bottom part, because all the arguments are being statically handled
        However moving forward, we need to dynamically handle these, as static analysis
        doesn't completely create everything we need.
        */
        var stringificationErr = false;
        // argVals.forEach((arg,i)=>{
        //     var _argStr = omniStringifier.stringify(arg,"write",2);
        //     if (_argStr && _argStr instanceof Error){
        //         nonCacheableNodes[cacheIndex] = _argStr.message;
        //         stringificationErr = true;
        //     }
        //     if (typeof _argStr == "object") {
        //         val = _argStr[0];
        //     } else val  = " omniStringifier.parse(\"" + escapeRegExp(_argStr) + "\");\n";

        //     if (typeof arg == "string" && (arg.indexOf("arg[")>=0 || arg.indexOf("closure.")>=0))
        //         ibfStr += argStrs[i] + " = " + arg + ";\n"
        //     else ibfStr +=  argStrs[i]+ ' = ' + val + ";\n";
        // })
        // if (stringificationErr)
        //     return IBF;

        // ibfStr += IBFStrCall;
        if (customLocalStorage[cacheIndex]["IBF"] == null)
            customLocalStorage[cacheIndex]["IBF"] = ""
        customLocalStorage[cacheIndex]["IBF"] += "\n" + ibfStr + "\n";

        return IBF;
    }

    this.createArgumentProxy = function(argObj){
        if (pageLoaded || _shadowStackHead in nonCacheableNodes) return argObj;
        var nodeId = _shadowStackHead ? _shadowStackHead : null;
        if (!nodeId) return argObj;
        if (!argObj.length) return argObj;
        if (argObj.__isProxy) argObj = argObj.__target;
        var proxyHandler = proxyEncapsulation(argObj,"argument");
        var argProxy = new Proxy(argObj, proxyHandler);
        // proxyHandler.accessToPrivates().proxyToMethod.set(argProxy, argObj);
        if (invocationToArgProxy[nodeId]) console.error("invocation already has a previous proxy");
        invocationToArgProxy[nodeId] = proxyHandler;
        return argProxy
    }

    this.createClosureProxy = function(closureObj, scopeId){
        if (pageLoaded || _shadowStackHead in nonCacheableNodes) return closureObj;
        var nodeId = _shadowStackHead ? _shadowStackHead : null;
        if (!nodeId ) return closureObj;
        if (!Object.keys(closureObj).length) return closureObj;
        if (closureObj.__isProxy) closureObj = closureObj.__target;
        var proxyHandler;
        if (!(nodeId in functionToScopes))
            functionToScopes[nodeId] = [];
        if (functionToScopes[nodeId].indexOf(scopeId)<0)
            functionToScopes[nodeId].push(scopeId);
        if (scopeId in invocationToClosureProxy)
            proxyHandler = invocationToClosureProxy[scopeId];
        else {
            proxyHandler = proxyEncapsulation(closureObj,"closure", scopeId);
            invocationToClosureProxy[scopeId] = proxyHandler;
        }
        var closureProxy = new Proxy(closureObj, proxyHandler);
        // proxyHandler.accessToPrivates().proxyToMethod.set(closureProxy, closureObj);
        return closureProxy;
    }

    /*
    thisProxy is separate from argument Proxy, as the target object itself could
    be a proxy object, and we don't want to wrap a proxy on top a proxy
    therefore, first we check if it already is a proxy and get rid of it, before wrapping
    it up in a proxy.
    */
    this.createThisProxy = function(thisObj){
        if (pageLoaded || !thisObj || (typeof thisObj != "function" && typeof thisObj != "object")
         || _shadowStackHead in nonCacheableNodes ) return thisObj;
        if (thisObj.withCredentials != null) {
            nonCacheableNodes[_shadowStackHead] = "This: XMLHttpRequest"
            return thisObj;
        }
        var nodeId = _shadowStackHead ? _shadowStackHead : null;
        if (!nodeId) return thisObj;
        if (thisObj.__isProxy || thisObj == window) {
            handlePropagatedProxy(thisObj, null, "this",_shadowStackHead)
            thisObj = thisObj.__target != null ? thisObj.__target : window
        }
        var proxyHandler = proxyEncapsulation(thisObj,"this");
        var thisProxy = new Proxy(thisObj, proxyHandler);
        // proxyHandler.accessToPrivates().proxyToMethod.set(thisProxy, thisObj);
        if (invocationToThisProxy[nodeId]) console.error("invocation already has a previous proxy");
        invocationToThisProxy[nodeId] =   proxyHandler;
        return thisProxy;
    }

    var escapeRegExp = function(str) {
        return str.replace(/[\"]/g, "\\$&");
    }

    function isNative(fn) {
        return (/\{\s*\[native code\]\s*\}/).test('' + fn);
    }

    function stringify(obj) {
        try {
            return JSON.stringify(obj, function (key, value) {
              if (value && value.__isProxy)
                    value = value.__target;
              var fnBody;
              if (value instanceof Function || typeof value == 'function') {
                return "";
                if ((/\{\s*\[native code\]\s*\}/).test(value.toString())) {
                    return value.name;
                }
                fnBody = value.toString();

                if (fnBody.length < 8 || fnBody.substring(0, 8) !== 'function') { /*this is ES6 Arrow Function*/
                  return '_NuFrRa_' + fnBody;
                }
                return fnBody;
              }
              if (value instanceof RegExp) {
                return '_PxEgEr_' + value;
              }
              return value;
            });
        } catch(e){
            return e;
        }
    };

    function parse(str, date2obj) {

    var iso8061 = date2obj ? /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/ : false;

    return JSON.parse(str, function (key, value) {
        var prefix;

        if (typeof value != 'string') {
        return value;
        }
        if (value.length < 8) {
        return value;
        }

        prefix = value.substring(0, 8);

        if (iso8061 && value.match(iso8061)) {
            return new Date(value);
        }
        if (prefix === 'function') {
            // if ((/\{\s*\[native code\]\s*\}/).test(value))
            //     return nativeObjectsStore[key]
            return eval('(' + value + ')');
        }
        if (prefix === '_PxEgEr_') {
            return eval(value.slice(8));
        }
        if (prefix === '_NuFrRa_') {
            return eval(value.slice(8));
        }

        return value;
        });
    };

    class SignatureProcessor{

            //ptype - specifies the type of processing to do, by pointing to the node
            ///TODO
            // Clean the logic with objecttopathPerOT , since we aren't keeping it per ot
            constructor(signature, ObjectTree, callGraph, pType){
                this.signature = signature;
                this.objectTree = ObjectTree;
                this.processedSig = {};
                this.objectToPathPerOT = {"this":{}};
                this.callGraph = callGraph;
                this.logType = pType;
                this.pathDelim = ";;;;";
            }

            process(){
                var objectToPathPerOT = this.objectToPathPerOT;
                var objectTreeThis = this.objectTree;
                var signature = this.signature;
                var processedSig = this.processedSig;
                var reverseObjectToId = {};
                var logType = this.logType;
                var callGraph = this.callGraph;
                var pathDelim = this.pathDelim;

                var init = function(){
                    // switch(logType){
                    //     case  "global" :
                    //         objectToPathPerOT.this[0] = "window";
                    //         break;
                    //     case "argument" :
                    //         objectToPathPerOT.this[0] = "arg"
                    //         break;
                    //     case "closure":
                    //         objectToPathPerOT.this[0] = "closure"
                    //         break;
                    //     case "this" :
                    //         objectToPathPerOT.this[0] = "thisObj";
                    //         break;
                    // }
                    objectToPathPerOT.this[0] = "";
                }

                var stringify = function (obj) {

                    return JSON.stringify(obj, function (key, value) {
                      if (value.__isProxy)
                        value = value.__target;
                      var fnBody;
                      if (value instanceof Function || typeof value == 'function') {
                        return "";
                      //   return value.toString();

                      //   if ((/\{\s*\[native code\]\s*\}/).test(value.toString())) {
                      //       return {};
                      //   }
                      //   fnBody = value.toString();

                      //   if (fnBody.length < 8 || fnBody.substring(0, 8) !== 'function') { //this is ES6 Arrow Function
                      //     return '_NuFrRa_' + fnBody;
                      //   }
                      //   return fnBody;
                      // }
                      // if (value instanceof RegExp) {
                      //   return '_PxEgEr_' + value;
                      }
                      return value;
                    });
                };

                var _removeRedundantReads = function(nodeId, writeArray){
                    var readLength = signature[nodeId].reads.length;
                    if (readLength) {
                        while (readLength--){
                            if ( signature[nodeId].reads[readLength][0] == writeArray[0] && signature[nodeId].reads[readLength][1] == writeArray[1] )
                                signature[nodeId].reads.splice(readLength, 1);
                        }
                    }
                }
                var removeReduntantReads = function(){
                    for (var nodeId in signature){
                        if (signature[nodeId].writes.length) {
                            signature[nodeId].writes.forEach(function(write){
                                _removeRedundantReads(nodeId, write);
                            })
                        }
                    }
                }

                /*
                While constructing paths instead of using the dot operator for properties
                we use the bracket operators for two reasons
                - If the property is a number
                - if the property has special symbols like dot itlelf or spaces
                */

                var constructPath = function(objectId, OT="this"){
                    if (!objectToPathPerOT[OT]) objectToPathPerOT[OT] = {0:"arguments"};
                    if (objectToPathPerOT[OT][objectId] == "" || objectToPathPerOT[OT][objectId]) return objectToPathPerOT[OT][objectId];
                    var path = "";
                    var objectTree = OT == "this" ? objectTreeThis : invocationToArgProxy[OT].accessToPrivates().ObjectTree;
                    for (var nodeId in objectTree){
                        for (var edge in objectTree[nodeId]) {
                            var _id = objectTree[nodeId][edge].indexOf(parseInt(objectId));
                            if (_id>=0) {
                                var parentPath = constructPath(nodeId, OT);
                                // path = parentPath + "['" + edge.substr(2) + "']";
                                path = parentPath + pathDelim + edge.substr(2);
                                objectToPathPerOT[OT][objectId] = path;
                                return path;
                            }
                        }
                    }
                    console.error("NO PATH FOUND FOR OBJECT ID: " + objectId);
                }

                var reverseLookup = function(objectId) {
                    if (reverseObjectToId[objectId]) return reverseObjectToId[objectId];

                }

                var preProcess = function(OT){
                    var objectTree = OT == "this" ? objectTreeThis : invocationToArgProxy[OT].accessToPrivates().ObjectTree;
                    for (var nodeId in objectTree) {
                        var parentPath = constructPath(nodeId, OT);
                        if (!parentPath && parentPath != "") console.error("NO PARENT PATH FOUND WHILE PREPROCESSING " + nodeId );
                        for (var edge in objectTree[nodeId]) {
                            objectTree[nodeId][edge].forEach(function(objectId){
                                 if (!objectToPathPerOT.this[objectId]) {
                                    // var path = parentPath + "['" + edge.substr(2) + "']";
                                    var path = parentPath + pathDelim + edge.substr(2);
                                    objectToPathPerOT.this[objectId] = path;
                                }
                            })
                        }
                    }
                }

                var fetchValue = function(log){
                    var _id = parseInt(log);
                    if (!isNaN(_id))
                        return idToObject.get(_id);
                    else
                        return log.substr(2);
                }

                var getRootIds = function(readArr){
                    var ids = [];
                    readArr.forEach((read)=>{
                        ids.push(read[1]);
                    })
                    return [...new Set(ids)];
                }

                var getAllChildren = function(rootId,key){
                    var objectTreeNode = objectTreeThis[rootId];
                    if (!objectTreeNode) return [];

                    var children = objectTreeNode['e_' + key];
                    // FIX
                    /*all future reads from this object should be removed*/
                    return children || [];
                    return [];
                }

                var process = function(nodeId){
                    var arr = signature[nodeId], roots = [];
                    var writeObjs = {}, prunedInds = [], readsSeen = [],
                        writeObjsCh = [], readObjs = {};
                    arr.forEach(function(entry,ind){
                        //skip child placeholders
                        if (typeof entry == "string") return;
                        var type = entry[0];
                        if (type.indexOf(logType)<0) return;
                        var isWrite = type.indexOf("_reads")<0
                        var state = isWrite ? "write" : "read";
                        if (isWrite){
                            if (!writeObjs[entry[1]]){
                                writeObjs[entry[1]] = [];
                            }
                            writeObjs[entry[1]].push(entry[2]);
                            writeObjsCh = writeObjsCh.concat(getAllChildren(entry[1],entry[2]));
                        }
                        else if (writeObjs[entry[1]] && (writeObjs[entry[1]].indexOf(entry[2])>=0)
                            || writeObjsCh.indexOf(entry[1])>=0) {
                            prunedInds.push(ind);
                            return;
                        }
                        var sig = [type];
                        var OT = "this"
                        if (OT != "this")
                            preProcess(OT);
                        var parentPath = objectToPathPerOT[OT][entry[1]]
                        if (!parentPath && parentPath != "") console.log("no parent path found for object id:" + JSON.stringify(entry) + " " + nodeId);
                        try {
                            var str;
                            if (typeof entry[2] == 'symbol')
                                str = entry[2].toString()
                            else str = entry[2] + '';
                            var path = parentPath + pathDelim + str;
                            var val = entry[3];
                            // if (state == "write")
                            //     val = omniStringifier.stringify(val, state, 2);
                            sig[1] = path;
                            sig[2] = val;

                            //Special case while reading window
                            if (entry[4] === 0 && !isWrite) {
                                sig[1] += pathDelim + "self";
                                sig[2] = path;
                            }
                        } catch (e) {
                            //TODO
                            //suppressing for now
                            //SUPPRESS
                            throw e;
                            console.log("Error while trying to stringify path: " + e + e.stack);
                        }
                        if (sig) {
                            if (sig[0].indexOf("reads")>=0){
                                if (readsSeen.indexOf(sig[1])>=0)
                                    prunedInds.push(ind);
                                else readsSeen.push(sig[1]);
                            }
                            // if (detectProperty(readVal)) processedSig[nodeId].isFunction = true;
                            processedSig[nodeId][ind] = sig;
                        }
                    })
                    for (var i=prunedInds.length - 1;i>=0;i--)
                        processedSig[nodeId].splice(prunedInds[i],1);
                }

                var processWrite = function(nodeId){
                    var writeArray = signature[nodeId].filter(e=>e[0]==logType+"_writes");
                    writeArray.forEach(function(write){
                        var writeSignature = [logType+"_writes"];
                        var OT = "this"
                        if (OT != "this")
                            preProcess(OT);
                        var parentPath = objectToPathPerOT[OT][write[1]];
                        if (!parentPath && parentPath != "") console.log("no parent path found for object id:" + JSON.stringify(write) + " " + nodeId);
                        if (typeof write[2] == "symbol")
                            var path = parentPath + pathDelim + write[2].toString();
                        else var path = parentPath + pathDelim + write[2];
                        try {
                            var writeVal = write[3];
                            // writeSignature = path + " = omniStringifier.parse(`" + escapeRegExp(writeVal) +"`)";
                            writeSignature[1] = path;
                            writeSignature[2] = writeVal;
                        } catch (e) {
                            //TODO
                            //suppressing for now
                            //SUPPRESS
                            console.log("Error while stringifying path: " + e + e.stack);
                        }
                        if (writeSignature) {
                            // if (detectProperty(writeVal)) processedSig[nodeId].isFunction = true;
                            processedSig[nodeId].push(writeSignature);
                        }
                    })

                }

                //Generic function to detect a specific property of the signature
                var detectProperty = function(obj, property="function"){
                    if (typeof obj == "string")
                        return obj.split(';;').indexOf(property) >=0;
                    else if (typeof obj == property) return true;
                    else return false;
                }

                init();
                preProcess("this");
                //cleanup signatures ie remove a read after write
                // removeReduntantReads();

                Object.keys(this.signature).forEach(function(nodeId){
                    // Return if not leaf node
                    if (trackOnlyLeaf &&  callGraph[nodeId].length) {
                        // processedSig[nodeId] = "NonLeafNode";
                        return;
                    }
                    if (nodeId in nonCacheableNodes) return;
                    processedSig[nodeId] = signature[nodeId];
                    if (signature[nodeId].length)
                        process(nodeId)

                    //Remove redundant reads, ie reads with same keys

                    if (logType == "global"){
                        if (signature[nodeId].returnValue !== undefined) {
                            // var _ret = omniStringifier.stringify(signature[nodeId].returnValue,"write",2);
                            var _ret = signature[nodeId].returnValue
                            if (!(_ret instanceof Error)) {
                                processedSig[nodeId].push(['returnValue',_ret]);
                                // processedSig[nodeId].returnValue = _ret;
                            }
                            else delete processedSig[nodeId];

                        }
                        /***** HORCRUX *****/
                        signature[nodeId] &&  signature[nodeId].DOM_read && processedSig[nodeId] &&
                        (processedSig[nodeId].push(['DOM_read', signature[nodeId].DOM_read]));

                        signature[nodeId] &&  signature[nodeId].DOM_write && processedSig[nodeId] &&
                        (processedSig[nodeId].push(['DOM_write', signature[nodeId].DOM_write]));

                        signature[nodeId] &&  signature[nodeId].IBF && processedSig[nodeId] && (
                            processedSig[nodeId].push(['IBF',signature[nodeId].IBF]));

                        signature[nodeId] &&  signature[nodeId].ec && processedSig[nodeId] && (
                            processedSig[nodeId].push(['ec', signature[nodeId].ec]));

                        signature[nodeId] &&  signature[nodeId].CFG && processedSig[nodeId] && (
                            processedSig[nodeId].push(['CFG', signature[nodeId].CFG]));
                        // signature[nodeId] &&  signature[nodeId].startTime && processedSig[nodeId] && (
                        //     processedSig[nodeId].push(['startTime', signature[nodeId].startTime]));
                        // signature[nodeId] &&  signature[nodeId].endTime && processedSig[nodeId] && (
                        //     processedSig[nodeId].push(['endTime', signature[nodeId].endTime]));
                    }

                    // Object.keys(signature[nodeId]).forEach((key)=>{
                    //     if (!processedSig[nodeId][key]) {
                    //         // if (detectProperty(signature[nodeId][key])) processedSig[nodeId].isFunction = true;
                    //         processedSig[nodeId][key] = signature[nodeId][key];
                    //     }
                    // })
                });

            }

            postProcess() {
                var processedSig = this.processedSig;
                var callGraph = this.callGraph;
                var logType = this.logType;
                var _removeRedundantReads = function(keyArray){
                    var redundantIndices = [];
                    keyArray.forEach(key => {
                        var indices = keyArray.keys();
                        for (var i of indices) {
                            if (key.trim().indexOf(keyArray[i].trim()) >= 0 && keyArray[i].trim() != key.trim())
                                redundantIndices.push(i);
                        }
                    });

                    return [...(new Set(redundantIndices))]
                }

                var removeReduntantReads = function(nodeId){
                    var readArray = processedSig[nodeId][logType+"_reads"];
                    var keys = readArray.map(key => key.split('=')[0].trim());
                    var redundantIndices = _removeRedundantReads(keys);
                    for (var index = redundantIndices.length-1; index >= 0; index--)
                        readArray.splice(redundantIndices[index],1);
                    // redundantIndices.forEach(index => {
                    //     readArray.splice(index, 1);
                    // });
                }

                var removeReduntantReadsSimple = function(nodeId){
                    var readArray = processedSig[nodeId][logType+"_reads"];
                    processedSig[nodeId][logType+"_reads"] = [...new Set(readArray.map(e=>JSON.stringify(e)))].map(e=>JSON.parse(e));
                }

                Object.keys(processedSig).forEach(function(nodeId){
                    if (trackOnlyLeaf && callGraph[nodeId].length) return;
                    if (processedSig[nodeId][logType+"_reads"])
                        removeReduntantReadsSimple(nodeId);
                    // var readArray = processedSig[nodeId].reads;
                    // if (readArray && readArray.length) {
                    //     readArray = new Set(readArray);
                    //     processedSig[nodeId].reads = readArray;
                    // }
                    // var writeArray = processedSig[nodeId].writes;
                    // if (writeArray && writeArray.length) {
                    //     writeArray = new Set(writeArray);
                    //     processedSig[nodeId].writes = writeArray;
                    // }

                });
            }

            setPropagationData(pmd, proxyData, processedSig, nonCacheableNodes){
                this.PMD = pmd;
                this.proxyData = proxyData;
                this.processedSig = processedSig
                this.nonCacheableNodes = nonCacheableNodes;
            }
            /*
            Pseudo code
            - Traverse bottom up, for
            */
            signaturePropagate() {
                //Copy the call graph since we will be mutating it
                var callGraph = Object.assign({},this.callGraph);
                var processedSig = this.processedSig;
                var logType = this.logType;
                var pmd = this.PMD;
                var proxyData = this.proxyData;
                var nonCacheableNodes = this.nonCacheableNodes;

                var object2pathmem;
                var _getPathFromId = function(objectId, objectTree){
                    if (object2pathmem[objectId] != null) return object2pathmem[objectId];
                    for (var nodeId in objectTree){
                        for (var edge in objectTree[nodeId]) {
                            var _id = objectTree[nodeId][edge].indexOf(parseInt(objectId));
                            if (_id>=0) {
                                var parentPath = _getPathFromId(nodeId, objectTree);
                                // path = parentPath + "['" + edge.substr(2) + "']";
                                var path = parentPath + ";;;;" + edge.substr(2);
                                object2pathmem[objectId] = path;
                                return path;
                            }
                        }
                    }
                }

                var getPathFromId = function(objectId, functionId, stateType){
                    var proxyMap, newPath;
                    switch (stateType) {
                        case "argument" :
                            proxyMap = proxyData.i2a; break;
                        case "global" :
                            proxyMap = proxyData.gph; break;
                        case "this" :
                            proxyMap = proxyData.i2t; break;
                        case "closure":
                            proxyMap = proxyData.i2c; break;
                    }
                    var _proxyPrivates = (stateType == "global" ? globalProxyHandler : proxyMap[functionId])
                    if (!_proxyPrivates)
                        return new Error("Path not found while translating signature")
                    var proxyPrivates = _proxyPrivates.accessToPrivates();
                    object2pathmem = {0:""};
                    newPath = _getPathFromId(objectId, proxyPrivates.ObjectTree);
                    if (newPath == null){
                        return new Error("Path not found while translating signature")
                    }
                    return newPath
                }


                var translateSigInParentScope = function(parentNode, childNode, sigEntry, sigType){
                    var metadata = pmd[childNode];
                    var sigCat = sigEntry[0].split("_")[1];
                    if (sigType == "global" || sigType == "IBF") return Object.assign([],sigEntry);
                    if (!metadata[sigType] || !metadata[sigType].length)
                        return null;
                    var translatedEntry = [];
                    if (sigType == "argument") {
                        var mainArg = sigEntry[1].split(';;;;')[1];
                        var _matchMD = metadata[sigType].find(e=>e[0]==mainArg)
                        if (!_matchMD) return null;
                    } else
                        var _matchMD = metadata[sigType][0]
                    var newPath = getPathFromId(_matchMD[1],parentNode, _matchMD[2])
                    if (newPath && newPath.stack)
                        return newPath;
                    var newArg = _matchMD[2] + "_" + sigCat,
                        newKey = sigType == "argument" ? [newPath].concat(sigEntry[1].split(';;;;').slice(2,)).join(";;;;") :
                            newPath + sigEntry[1]
                    return [newArg, newKey, sigEntry[2]];
                }

                var rewriteKey = function(translatedSig, origSig, alreadyChildClosure){
                    var newKey = translatedSig[1].replace(origSig[1],"");
                    if (!alreadyChildClosure)
                        newKey = translatedSig[0].split("_")[0]  +  newKey   + ";&;" + origSig[1];
                    else newKey = translatedSig[0].split("_")[0]  +  newKey
                    return newKey;
                }

                //sigType = read or write
                var insertClosureSig = function(parentSig, insertInd, translatedSig, sigType, origSig, alreadyChildClosure){
                    var newSigType = sigType == "reads" ? "childClosure_reads" :
                        sigType == "IBF" ? "childIBF" : "childClosure_writes";
                    var newKey = rewriteKey(translatedSig, origSig,alreadyChildClosure);
                    var finalSig = [newSigType,newKey,translatedSig[2]];
                    parentSig.splice(insertInd,0,finalSig);
                }


                var _propagateHelper = function(sigEntry, parentNode, insertInd, childNode){
                    var sigType = sigEntry[0].split("_")[0],
                        parentSig = processedSig[parentNode];
                    switch(sigType){
                        case "global": parentSig.splice(insertInd, 0, sigEntry); break;
                        case "argument":
                        case "this":
                        case "closure":
                        case "IBF":
                            /*Handling IBF propagation similar to closure propagation*/
                            if (sigType == "IBF")
                                var translatedSig = translateSigInParentScope(parentNode, childNode, sigEntry, "closure")
                            else var translatedSig = translateSigInParentScope(parentNode, childNode, sigEntry, sigType)
                            if (translatedSig && !translatedSig.stack){
                                if (sigType == "closure"){
                                    insertClosureSig(parentSig, insertInd, translatedSig, sigEntry[0].split("_")[1], sigEntry)
                                    break;
                                } else if (sigType == "IBF"){
                                    insertClosureSig(parentSig, insertInd, translatedSig, "IBF", sigEntry)
                                    break;
                                }
                                parentSig.splice(insertInd, 0, translatedSig);
                            } else if (translatedSig && translatedSig.stack)
                                nonCacheableNodes[parentNode] = "translatedSig.message"
                            break;
                        case "childClosure":
                        case "childIBF":
                            var [childRef, actualKey] = sigEntry[1].split(';&;');
                            var dummySigType = childRef.split(';;;;')[0]+"_"+sigEntry[0].split("_")[1];
                            /*
                            if child accessed it through closure, simply append the key
                            however if the child accessed it through arguments or global, translate it accordingly
                            */
                            var childAccessor = "closure";
                            if (dummySigType.indexOf("argument")>=0 || dummySigType.indexOf("global")>=0){
                                childAccessor = "argument";
                                var dummySigEntry = [dummySigType, childRef.replace(childRef.split(';;;;')[0],""), sigEntry[2]];
                            }
                            else
                                var dummySigEntry = [dummySigType, "", sigEntry[2]];
                            var translatedSig = translateSigInParentScope(parentNode, childNode, dummySigEntry, childRef.split(';;;;')[0])
                            if (translatedSig && !translatedSig.stack){
                                    //fix the original reference part and the key part
                                    // translatedSig[1] = rewriteKey(translatedSig, dummySigEntry);
                                    //mimic the closure category, modify the key to include actualKey, without the state part
                                    if (childAccessor == "closure")
                                        translatedSig[1] += ';&;' + sigEntry[1];
                                    else dummySigEntry[1] = actualKey;
                                    //tweak the originalSig to simply reuse the insertClosureSig function
                                    // dummySigEntry[1]= actua.lKey
                                    var rwType = sigEntry[0].split("_")[1];
                                    if (sigType == "childIBF")
                                        rwType = "IBF"

                                    if (childAccessor == "closure")
                                        insertClosureSig(parentSig, insertInd, translatedSig, rwType, dummySigEntry, true)
                                    else
                                        insertClosureSig(parentSig, insertInd, translatedSig, rwType, dummySigEntry)
                            }

                    }
                }

                var propagateSig = function(parentNode, childNode){
                    var parentSig = processedSig[parentNode],
                        childSig = processedSig[childNode];
                    if (!parentSig || !childSig) return;
                    var phInd = parentSig.findIndex(e=>e==childNode),
                        cpPhInd = phInd;

                    if (phInd<0){
                        console.error("Parent node: " + parentNode + " has no placeholder for " + childNode );
                        return;
                    }
                    //Make space to insert childsig into parent sig
                    parentSig.splice(phInd,1)
                    childSig.forEach((sigEntry)=>{
                        var inserted = _propagateHelper(sigEntry,parentNode, phInd, childNode);
                        if (inserted)
                            phInd++
                    })
                    if (childSig.IBF){
                        var sigEntry = ["IBF", "", childSig.IBF]
                        var inserted = _propagateHelper(sigEntry,parentNode, phInd, childNode);
                        if (inserted)
                            phInd++
                    }
                    //Run optimizer after updating parent sig
                    // RWOpt(parentSig, cpPhInd);
                }

                var RWOpt = function(parentSig){
                    var cat2w = {}, //category to write
                        prunedInds = [],
                        readsSeen = {};
                    parentSig.forEach((entry,indx)=>{
                        var state = entry[0].split("_")[0];
                        if (!readsSeen[state])
                            readsSeen[state] = []
                        if (entry[0].indexOf("writes")>=0 ){
                            readsSeen[state].push(entry[1])
                            if (!cat2w[state])
                                cat2w[state] = [];
                            cat2w[state].push([entry[1],indx]) // state -> [key written to, index of the signature]
                        } else {
                            if (readsSeen[state].indexOf(entry[1])>=0 && prunedInds.indexOf(indx)<0)
                                prunedInds.push(indx)
                            else readsSeen[state].push(entry[1]);
                        }
                    })

                    parentSig.forEach((entry, indx)=>{
                            if (entry[0].indexOf("reads")>=0) {
                                var state = entry[0].split("_")[0];
                                if (!(state in cat2w)) return;
                                for (var write of cat2w[state]) {
                                    if (write[1] < indx && write[0].indexOf(entry[1])>=0 && prunedInds.indexOf(indx) < 0) {
                                        prunedInds.push(indx)
                                        break
                                    }
                                }
                            }
                    })
                    // Removing all the reads after writes
                    prunedInds = prunedInds.sort((b,a)=>{return b-a})
                    for (var i=prunedInds.length - 1;i>=0;i--)
                        parentSig.splice(prunedInds[i],1);

                }

                var updatedNodes = [];
                var visitChildren = function(parentNode){
                    if (updatedNodes.indexOf(parentNode)>=0) return;
                    var children = callGraph[parentNode];

                    for (var child of children){
                        visitChildren(child);
                        // console.log("Propagating " + child + " signature to " + parentNode)
                        if (child in nonCacheableNodes){
                            var childReason = nonCacheableNodes[child],
                                parentReason = "";
                            if (childReason.indexOf(";;")>=0){
                                parentReason = childReason;
                            } else {
                                parentReason += childReason + ";;parent-of-nc";
                            }
                            nonCacheableNodes[parentNode]=parentReason;
                            delete processedSig[parentNode]
                            updatedNodes.push(parentNode)
                            return;
                        }
                        propagateSig(parentNode,child);
                    }
                    updatedNodes.push(parentNode)
                }

                Object.keys(processedSig).forEach((parentNode)=>{
                    visitChildren(parentNode);
                })
                Object.keys(processedSig).forEach((parentNode)=>{
                    RWOpt(processedSig[parentNode]);
                })


            }
    }
    var setupStateEndTime = performance.now();
    window.top.setupStateTime[window.top.setupStateCounter++] = setupStateEndTime - setupStateStartTime;

    /*Set page loaded to true, since the initialization has happened
    and we need to turn off tracking for unnecessary functions*/
    // pageLoaded = false;
};

} /*else {
    __tracer = window.top.__tracer
}*/

/*if (typeof window === "undefined"){
    var globalProxyHandler = window.top.proxyEncapsulation(window,"global");

    var {proxy, revoke} = Proxy.revocable(window, globalProxyHandler);
    // Flag to disable proxy
    window = proxy;*
}*/

// (function () { __tracer.setGlobal(this); })();



</script>
<html lang="en-US"><head><meta charSet="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="3IJ1Uj50nUpQyq_EpWZzvZZsvN2t9pp9FgjJ1JoKtVY" name="google-site-verification"/><title>Starbucks Coffee Company</title><meta content="Starbucks Coffee Company" property="og:title"/><meta content="https://www.starbucks.com/" property="og:url"/><meta content="More than just great coffee. Explore the menu, sign up for Starbucks Rewards, manage your gift card and more." name="description"/><meta content="More than just great coffee. Explore the menu, sign up for Starbucks Rewards, manage your gift card and more." property="og:description"/><meta name="next-head-count" content="8"/><meta content="ie=edge" http-equiv="x-ua-compatible"/><meta content="summary" property="twitter:card"/><meta content="@starbucks" property="twitter:site"/><meta content="@starbucksprtnrs" property="twitter:creator"/><meta content="/next_static/icons/summary_square.png" data-hid="image" property="og:image"/><meta content="company" property="og:type"/><link href="/next_static/icons/favicon-16x16.png" rel="icon"/><link href="/next_static/icons/favicon-32x32.png" rel="icon"/><link href="/next_static/icons/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/><link href="/next_static/icons/pwa-icon-192.png" rel="icon" sizes="192x192" type="image/png"/><link href="/manifest.json" rel="manifest"/><link color="#008046" href="/next_static/icons/safari-pinned-tab.svg" rel="mask-icon"/><meta content="Starbucks" name="apple-mobile-web-app-title"/><meta content="Starbucks" name="application-name"/><meta content="#242221" name="msapplication-TileColor"/><meta content="/next_static/icons/mstile-144x144.png" name="msapplication-TileImage"/><meta content="/browserconfig.xml" name="msapplication-config"/><meta content="#006341" name="theme-color"/><script>
(function(){if (typeof __tracer == 'undefined' && typeof window != 'undefined')
                 { __tracer = window.top.__tracer;
                 }
                })();
window.NREUM||(NREUM={}),__nr_require=function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-44-2-308",false);
function r(n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-60-2-209",false);
if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-131-2-175",false);
var o=t[n][1][e];return r(o||e)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-131-2-175",true);
 }},o,o.exports)}return e[n].exports
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-60-2-209",true);
 }}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-44-2-308",true);
 }}({1:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-313-2-806",false);
function r(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-329-2-384",false);
try{c.console&&console.log(t)}catch(e){}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-329-2-384",true);
 }}var o,i=t("ee"),a=t(20),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-635-2-658",false);
r(t.stack)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-635-2-658",true);
 }}),c.dev&&i.on("fn-err",function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-681-2-708",false);
r(n.stack)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-681-2-708",true);
 }}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-768-2-791",false);
return t
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-768-2-791",true);
 }}).join(", ")))
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-313-2-806",true);
 }},{}],2:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-814-2-1698",false);
function r(t,e,n,r,c){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-830-2-1005",false);
try{h?h-=1:o(c||new UncaughtException(t,e,n),!0)}catch(f){try{i("ierr",[f,s.now(),!0])}catch(d){}}return"function"==typeof u&&u.apply(this,a(arguments))
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-830-2-1005",true);
 }}function UncaughtException(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1005-2-1132",false);
this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1005-2-1132",true);
 }}function o(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1132-2-1184",false);
var n=e?null:s.now();i("err",[t,n])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1132-2-1184",true);
 }}var i=t("handle"),a=t(21),c=t("ee"),s=t("loader"),f=t("gos"),u=window.onerror,d=!1,p="nr@seenError",h=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(l){"stack"in l&&(t(13),t(12),"addEventListener"in window&&t(6),s.xhrWrappable&&t(14),d=!0)}c.on("fn-start",function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1461-2-1487",false);
d&&(h+=1)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1461-2-1487",true);
 }}),c.on("fn-err",function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1503-2-1579",false);
d&&!n[p]&&(f(n,p,function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1536-2-1556",false);
return!0
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1536-2-1556",true);
 }}),this.thrown=!0,o(n))
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1503-2-1579",true);
 }}),c.on("fn-end",function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1595-2-1635",false);
d&&!this.thrown&&h>0&&(h-=1)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1595-2-1635",true);
 }}),c.on("internal-error",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1659-2-1696",false);
i("ierr",[t,s.now(),!0])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1659-2-1696",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-814-2-1698",true);
 }},{}],3:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1706-2-1750",false);
t("loader").features.ins=!0
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1706-2-1750",true);
 }},{}],4:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1758-2-2951",false);
function r(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1774-2-1816",false);
M++,S=y.hash,this[u]=b.now()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1774-2-1816",true);
 }}function o(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1816-2-1905",false);
M--,y.hash!==S&&i(0,!0);var t=b.now();this[l]=~~this[l]+t-this[u],this[d]=t
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1816-2-1905",true);
 }}function i(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1905-2-1947",false);
E.emit("newURL",[""+y,e])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1905-2-1947",true);
 }}function a(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1947-2-1999",false);
t.on(e,function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-1970-2-1997",false);
this[e]=b.now()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1970-2-1997",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1947-2-1999",true);
 }}var c="-start",s="-end",f="-body",u="fn"+c,d="fn"+s,p="cb"+c,h="cb"+s,l="jsTime",m="fetch",v="addEventListener",w=window,y=w.location,b=t("loader");if(w[v]&&b.xhrWrappable){var g=t(10),x=t(11),E=t(8),P=t(6),O=t(13),R=t(7),T=t(14),L=t(9),j=t("ee"),N=j.get("tracer");t(15),b.features.spa=!0;var S,M=0;j.on(u,r),j.on(p,r),j.on(d,o),j.on(h,o),j.buffer([u,d,"xhr-done","xhr-resolved"]),P.buffer([u]),O.buffer(["setTimeout"+s,"clearTimeout"+c,u]),T.buffer([u,"new-xhr","send-xhr"+c]),R.buffer([m+c,m+"-done",m+f+c,m+f+s]),E.buffer(["newURL"]),g.buffer([u]),x.buffer(["propagate",p,h,"executor-err","resolve"+c]),N.buffer([u,"no-"+u]),L.buffer(["new-jsonp","cb-start","jsonp-error","jsonp-end"]),a(T,"send-xhr"+c),a(j,"xhr-resolved"),a(j,"xhr-done"),a(R,m+c),a(R,m+"-done"),a(L,"new-jsonp"),a(L,"jsonp-end"),a(L,"cb-start"),E.on("pushState-end",i),E.on("replaceState-end",i),w[v]("hashchange",i,!0),w[v]("load",i,!0),w[v]("popstate",function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-2925-2-2945",false);
i(0,M>1)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-2925-2-2945",true);
 }},!0)}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-1758-2-2951",true);
 }},{}],5:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-2959-2-4327",false);
function r(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-2975-2-2990",false);

 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-2975-2-2990",true);
 }}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(13),c=t(12),s="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",p="resource",h="-start",l="-end",m="fn"+h,v="fn"+l,w="bstTimer",y="pushState",b=t("loader");b.features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-3350-2-3415",false);
var n=t[0];n instanceof g&&(this.bstStart=b.now())
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-3350-2-3415",true);
 }}),o.on(v,function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-3424-2-3502",false);
var n=t[0];n instanceof g&&i("bst",[n,e,this.bstStart,b.now()])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-3424-2-3502",true);
 }}),a.on(m,function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-3511-2-3564",false);
this.bstStart=b.now(),this.bstType=n
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-3511-2-3564",true);
 }}),a.on(v,function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-3573-2-3631",false);
i(w,[e,this.bstStart,b.now(),this.bstType])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-3573-2-3631",true);
 }}),c.on(m,function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-3640-2-3673",false);
this.bstStart=b.now()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-3640-2-3673",true);
 }}),c.on(v,function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-3682-2-3751",false);
i(w,[e,this.bstStart,b.now(),"requestAnimationFrame"])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-3682-2-3751",true);
 }}),o.on(y+h,function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-3762-2-3839",false);
this.time=b.now(),this.startPath=location.pathname+location.hash
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-3762-2-3839",true);
 }}),o.on(y+l,function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-3850-2-3934",false);
i("bstHist",[location.pathname+location.hash,this.startPath,this.time])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-3850-2-3934",true);
 }}),f in window.performance&&(window.performance["c"+s]?window.performance[f](u,function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-4012-2-4098",false);
i(d,[window.performance.getEntriesByType(p)]),window.performance["c"+s]()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-4012-2-4098",true);
 }},!1):window.performance[f]("webkit"+u,function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-4136-2-4228",false);
i(d,[window.performance.getEntriesByType(p)]),window.performance["webkitC"+s]()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-4136-2-4228",true);
 }},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-2959-2-4327",true);
 }},{}],6:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-4335-2-5079",false);
function r(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-4351-2-4437",false);
for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-4351-2-4437",true);
 }}function o(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-4437-2-4476",false);
c.inPlace(t,[u,d],"-",i)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-4437-2-4476",true);
 }}function i(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-4476-2-4504",false);
return t[1]
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-4476-2-4504",true);
 }}var a=t("ee").get("events"),c=t(23)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-4770-2-5023",false);
var n=t[1],r=s(n,"nr@wrapped",function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-4814-2-5001",false);
function t(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-4825-2-4914",false);
if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-4825-2-4914",true);
 }}var e={object:t,"function":n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-4814-2-5001",true);
 }});this.wrapped=t[1]=r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-4770-2-5023",true);
 }}),a.on(d+"-start",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5041-2-5077",false);
t[1]=this.wrapped||t[1]
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5041-2-5077",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-4335-2-5079",true);
 }},{}],7:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5087-2-5750",false);
function r(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5103-2-5340",false);
var r=t[e];"function"==typeof r&&(t[e]=function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5160-2-5338",false);
var t=r.apply(this,arguments);return o.emit(n+"start",arguments,t),t.then(function(e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5245-2-5293",false);
return o.emit(n+"end",[null,e],t),e
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5245-2-5293",true);
 }},function(e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5294-2-5336",false);
throw o.emit(n+"end",[e],t),e
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5294-2-5336",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5160-2-5338",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5103-2-5340",true);
 }}var o=t("ee").get("fetch"),i=t(20);e.exports=o;var a=window,c="fetch-",s=c+"body-",f=["arrayBuffer","blob","json","text","formData"],u=a.Request,d=a.Response,p=a.fetch,h="prototype";u&&d&&p&&(i(f,function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5536-2-5574",false);
r(u[h],e,s),r(d[h],e,s)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5536-2-5574",true);
 }}),r(a,"fetch",c),o.on(c+"end",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5604-2-5747",false);
var n=this;e?e.clone().arrayBuffer().then(function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5660-2-5722",false);
n.rxSize=t.byteLength,o.emit(c+"done",[null,e],n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5660-2-5722",true);
 }}):o.emit(c+"done",[t],n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5604-2-5747",true);
 }}))
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5087-2-5750",true);
 }},{}],8:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5758-2-5885",false);
var r=t("ee").get("history"),o=t(23)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5758-2-5885",true);
 }},{}],9:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5893-2-7147",false);
function r(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5909-2-6517",false);
function e(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-5923-2-6032",false);
s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5923-2-6032",true);
 }}function n(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-6032-2-6168",false);
s.emit("jsonp-error",[],p),s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-6032-2-6168",true);
 }}var r=t&&"string"==typeof t.nodeName&&"script"===t.nodeName.toLowerCase();if(r){var o="function"==typeof t.addEventListener;if(o){var a=i(t.src);if(a){var u=c(a),d="function"==typeof u.parent[u.key];if(d){var p={};f.inPlace(u.parent,[u.key],"cb-",p),t.addEventListener("load",e,!1),t.addEventListener("error",n,!1),s.emit("new-jsonp",[t.src],p)}}}}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5909-2-6517",true);
 }}function o(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-6517-2-6564",false);
return"addEventListener"in window
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-6517-2-6564",true);
 }}function i(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-6564-2-6614",false);
var e=t.match(u);return e?e[1]:null
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-6564-2-6614",true);
 }}function a(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-6614-2-6685",false);
var n=t.match(p),r=n[1],o=n[3];return o?a(o,e[r]):e[r]
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-6614-2-6685",true);
 }}function c(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-6685-2-6793",false);
var e=t.match(d);return e&&e.length>=3?{key:e[2],parent:a(e[1],window)}:{key:t,parent:window}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-6685-2-6793",true);
 }}var s=t("ee").get("jsonp"),f=t(23)(s);if(e.exports=s,o()){var u=/[?&](?:callback|cb)=([^&#]+)/,d=/(.*).([^.]+)/,p=/^(w+)(.|$)(.*)$/,h=["appendChild","insertBefore","replaceChild"];f.inPlace(HTMLElement.prototype,h,"dom-"),f.inPlace(HTMLHeadElement.prototype,h,"dom-"),f.inPlace(HTMLBodyElement.prototype,h,"dom-"),s.on("dom-start",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7124-2-7144",false);
r(t[0])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7124-2-7144",true);
 }})}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-5893-2-7147",true);
 }},{}],10:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7156-2-7386",false);
var r=t("ee").get("mutation"),o=t(23)(r),i=NREUM.o.MO;e.exports=r,i&&(window.MutationObserver=function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7266-2-7345",false);
return this instanceof i?new i(o(t,"fn-")):i.apply(this,arguments)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7266-2-7345",true);
 }},MutationObserver.prototype=i.prototype)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7156-2-7386",true);
 }},{}],11:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7395-2-8927",false);
function r(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7411-2-7555",false);
var e=a.context(),n=c(t,"executor-",e),r=new f(n);return a.context(r).getCtx=function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7502-2-7522",false);
return e
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7502-2-7522",true);
 }},a.emit("new-promise",[r,e],e),r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7411-2-7555",true);
 }}function o(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7555-2-7580",false);
return e
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7555-2-7580",true);
 }}var i=t(23),a=t("ee").get("promise"),c=i(a),s=t(20),f=NREUM.o.PR;e.exports=a,f&&(window.Promise=r,["all","race"].forEach(function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7701-2-7939",false);
var e=f[t];f[t]=function(n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7729-2-7938",false);
function r(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7741-2-7814",false);
return function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7762-2-7813",false);
a.emit("propagate",[null,!o],i),o=o||!t
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7762-2-7813",true);
 }}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7741-2-7814",true);
 }}var o=!1;s(n,function(e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7827-2-7885",false);
Promise.resolve(n).then(r("all"===t),r(!1))
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7827-2-7885",true);
 }});var i=e.apply(f,arguments),c=f.resolve(i);return c
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7729-2-7938",true);
 }}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7701-2-7939",true);
 }}),["resolve","reject"].forEach(function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7970-2-8083",false);
var e=f[t];f[t]=function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-7998-2-8082",false);
var n=e.apply(f,arguments);return t!==n&&a.emit("propagate",[t,!0],n),n
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7998-2-8082",true);
 }}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7970-2-8083",true);
 }}),f.prototype["catch"]=function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8106-2-8143",false);
return this.then(null,t)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8106-2-8143",true);
 }},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8239-2-8278",false);
try{r[e]=f[e]}catch(n){}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8239-2-8278",true);
 }}),a.on("executor-start",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8302-2-8372",false);
t[0]=c(t[0],"resolve-",this),t[1]=c(t[1],"resolve-",this)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8302-2-8372",true);
 }}),a.on("executor-err",function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8394-2-8418",false);
t[1](n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8394-2-8418",true);
 }}),c.inPlace(f.prototype,["then"],"then-",o),a.on("then-start",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8480-2-8557",false);
this.promise=e,t[0]=c(t[0],"cb-",this),t[1]=c(t[1],"cb-",this)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8480-2-8557",true);
 }}),a.on("then-end",function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8575-2-8658",false);
this.nextPromise=n;var r=this.promise;a.emit("propagate",[r,!0],n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8575-2-8658",true);
 }}),a.on("cb-end",function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8674-2-8734",false);
a.emit("propagate",[n,!0],this.nextPromise)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8674-2-8734",true);
 }}),a.on("propagate",function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8753-2-8890",false);
this.getCtx&&!e||(this.getCtx=function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8799-2-8888",false);
if(t instanceof Promise)var e=a.context(t);return e&&e.getCtx?e.getCtx():this
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8799-2-8888",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8753-2-8890",true);
 }}),r.toString=function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8903-2-8925",false);
return""+f
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8903-2-8925",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-7395-2-8927",true);
 }},{}],12:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-8936-2-9137",false);
var r=t("ee").get("raf"),o=t(23)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9104-2-9135",false);
t[0]=o(t[0],"fn-")
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9104-2-9135",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-8936-2-9137",true);
 }},{}],13:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9146-2-9552",false);
function r(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9162-2-9206",false);
t[0]=a(t[0],"fn-",null,n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9162-2-9206",true);
 }}function o(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9206-2-9303",false);
this.method=n,this.timerDuration=isNaN(t[1])?0:+t[1],t[0]=a(t[0],"fn-",this,n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9206-2-9303",true);
 }}var i=t("ee").get("timer"),a=t(23)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9146-2-9552",true);
 }},{}],14:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9561-2-10686",false);
function r(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9577-2-9637",false);
d.inPlace(e,["onreadystatechange"],"fn-",c)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9577-2-9637",true);
 }}function o(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9637-2-9772",false);
var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,y,"fn-",c)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9637-2-9772",true);
 }}function i(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9772-2-9836",false);
b.push(t),l&&(x?x.then(a):v?v(a):(E=-E,P.data=E))
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9772-2-9836",true);
 }}function a(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9836-2-9904",false);
for(var t=0;t<b.length;t++)r([],b[t]);b.length&&(b=[])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9836-2-9904",true);
 }}function c(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9904-2-9929",false);
return e
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9904-2-9929",true);
 }}function s(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-9929-2-9979",false);
for(var n in t)e[n]=t[n];return e
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9929-2-9979",true);
 }}t(6);var f=t("ee"),u=f.get("xhr"),d=t(23)(u),p=NREUM.o,h=p.XHR,l=p.MO,m=p.PR,v=p.SI,w="readystatechange",y=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],b=[];e.exports=u;var g=window.XMLHttpRequest=function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-10213-2-10357",false);
var e=new h(t);try{u.emit("new-xhr",[e],e),e.addEventListener(w,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-10213-2-10357",true);
 }};if(s(h,g),g.prototype=h.prototype,d.inPlace(g.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-10463-2-10489",false);
r(t,e),i(e)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-10463-2-10489",true);
 }}),u.on("open-xhr-start",r),l){var x=m&&m.resolve();if(!v&&!m){var E=1,P=document.createTextNode(E);new l(a).observe(P,{characterData:!0})}}else f.on("fn-end",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-10647-2-10684",false);
t[0]&&t[0].type===w||a()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-10647-2-10684",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-9561-2-10686",true);
 }},{}],15:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-10695-2-13480",false);
function r(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-10711-2-11177",false);
var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=a.now()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var s=t.getResponseHeader("X-NewRelic-App-Data");s&&(e.cat=s.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-10711-2-11177",true);
 }}function o(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-11177-2-11333",false);
var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return l(r)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-11177-2-11333",true);
 }}function i(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-11333-2-11448",false);
var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-11333-2-11448",true);
 }}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(16),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,p=t("id"),h=t(19),l=t(18),m=window.XMLHttpRequest;a.features.xhr=!0,t(14),f.on("new-xhr",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-11658-2-11863",false);
var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||h<10)||window.opera||t.addEventListener("progress",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-11826-2-11858",false);
e.lastSize=t.loaded
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-11826-2-11858",true);
 }},!1)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-11658-2-11863",true);
 }}),f.on("open-xhr-start",function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-11887-2-11954",false);
this.params={method:t[0]},i(this,t[1]),this.metrics={}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-11887-2-11954",true);
 }}),f.on("open-xhr-end",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-11976-2-12123",false);
"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-11976-2-12123",true);
 }}),f.on("send-xhr-start",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-12147-2-12538",false);
var n=this.metrics,r=t[0],o=this;if(n&&r){var i=l(r);i&&(n.txSize=i)}this.startTime=a.now(),this.listener=function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-12267-2-12475",false);
try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-12267-2-12475",true);
 }};for(var c=0;c<d;c++)e.addEventListener(u[c],this.listener,!1)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-12147-2-12538",true);
 }}),f.on("xhr-cb-time",function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-12559-2-12718",false);
this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-12559-2-12718",true);
 }}),f.on("xhr-load-added",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-12742-2-12847",false);
var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-12742-2-12847",true);
 }}),f.on("xhr-load-removed",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-12873-2-12981",false);
var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-12873-2-12981",true);
 }}),f.on("addEventListener-end",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-13011-2-13095",false);
e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-13011-2-13095",true);
 }}),f.on("removeEventListener-end",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-13128-2-13214",false);
e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-13128-2-13214",true);
 }}),f.on("fn-start",function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-13232-2-13366",false);
e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-13232-2-13366",true);
 }}),f.on("fn-end",function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-13382-2-13477",false);
this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,e],e)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-13382-2-13477",true);
 }})}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-10695-2-13480",true);
 }},{}],16:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-13489-2-14044",false);
e.exports=function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-13515-2-14043",false);
var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-13515-2-14043",true);
 }}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-13489-2-14044",true);
 }},{}],17:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-14053-2-15153",false);
function r(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-14069-2-14083",false);

 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-14069-2-14083",true);
 }}function o(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-14083-2-14191",false);
return function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-14108-2-14190",false);
return i(t,[f.now()].concat(c(arguments)),e?null:this,n),e?void 0:this
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-14108-2-14190",true);
 }}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-14083-2-14191",true);
 }}var i=t("handle"),a=t(20),c=t(21),s=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",h=p+"ixn-";a(d,function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-14459-2-14494",false);
u[e]=o(p+e,!0,"api")
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-14459-2-14494",true);
 }}),u.addPageAction=o(p+"addPageAction",!0),u.setCurrentRouteName=o(p+"routeName",!0),e.exports=newrelic,u.interaction=function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-14611-2-14642",false);
return(new r).get()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-14611-2-14642",true);
 }};var l=r.prototype={createTracer:function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-14675-2-14958",false);
var n={},r=this,o="function"==typeof e;return i(h+"tracer",[f.now(),t,n],r),function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-14765-2-14957",false);
if(s.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return e.apply(this,arguments)}catch(t){throw s.emit("fn-err",[arguments,this,t],n),t}finally{s.emit("fn-end",[f.now()],n)}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-14765-2-14957",true);
 }}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-14675-2-14958",true);
 }}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-15033-2-15059",false);
l[e]=o(h+e)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-15033-2-15059",true);
 }}),newrelic.noticeError=function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-15082-2-15152",false);
"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-15082-2-15152",true);
 }}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-14053-2-15153",true);
 }},{}],18:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-15162-2-15548",false);
e.exports=function(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-15188-2-15547",false);
if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-15188-2-15547",true);
 }}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-15162-2-15548",true);
 }},{}],19:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-15557-2-15656",false);
var r=0,o=navigator.userAgent.match(/Firefox[/s](d+.d+)/);o&&(r=+o[1]),e.exports=r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-15557-2-15656",true);
 }},{}],20:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-15665-2-15820",false);
function r(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-15681-2-15770",false);
var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-15681-2-15770",true);
 }}var o=Object.prototype.hasOwnProperty;e.exports=r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-15665-2-15820",true);
 }},{}],21:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-15829-2-15991",false);
function r(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-15845-2-15979",false);
e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-15845-2-15979",true);
 }}e.exports=r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-15829-2-15991",true);
 }},{}],22:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16000-2-16164",false);
e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16000-2-16164",true);
 }},{}],23:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16173-2-17259",false);
function r(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16189-2-16253",false);
return!(t&&t instanceof Function&&t.apply&&!t[a])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16189-2-16253",true);
 }}var o=t("ee"),i=t(21),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16340-2-17258",false);
function n(t,e,n,o){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16354-2-16681",false);
function nrWrapper(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16374-2-16615",false);
var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){p([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16374-2-16615",true);
 }}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16354-2-16681",true);
 }}function f(t,e,o,i){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16681-2-16808",false);
o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16681-2-16808",true);
 }}function u(n,r,o){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16808-2-16896",false);
if(!s||e){var i=s;s=!0;try{t.emit(n,r,o,e)}catch(a){p([a,n,r,o])}s=i}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16808-2-16896",true);
 }}function d(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16896-2-17163",false);
if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-16992-2-17094",false);
Object.defineProperty(e,n,{get:function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17035-2-17058",false);
return t[n]
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17035-2-17058",true);
 }},set:function(e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17063-2-17091",false);
return t[n]=e,e
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17063-2-17091",true);
 }}})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16992-2-17094",true);
 }}),e}catch(r){p([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16896-2-17163",true);
 }}function p(e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17163-2-17219",false);
try{t.emit("internal-error",e)}catch(n){}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17163-2-17219",true);
 }}return t||(t=o),n.inPlace=f,n.flag=a,n
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16340-2-17258",true);
 }}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-16173-2-17259",true);
 }},{}],ee:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17268-2-17963",false);
function r(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17284-2-17298",false);

 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17284-2-17298",true);
 }}function o(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17298-2-17798",false);
function e(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17312-2-17368",false);
return t&&t instanceof r?t:t?s(t,c,i):i()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17312-2-17368",true);
 }}function n(n,r,o,i){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17368-2-17524",false);
if(!p.aborted||i){t&&t(n,r,o);for(var a=e(o),c=l(n),s=c.length,f=0;f<s;f++)c[f].apply(a,r);var d=u[y[n]];return d&&d.push([b,n,r,a]),a}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17368-2-17524",true);
 }}function h(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17524-2-17560",false);
w[t]=l(t).concat(e)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17524-2-17560",true);
 }}function l(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17560-2-17590",false);
return w[t]||[]
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17560-2-17590",true);
 }}function m(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17590-2-17627",false);
return d[t]=d[t]||o(n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17590-2-17627",true);
 }}function v(t,e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17627-2-17703",false);
f(t,function(t,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17647-2-17701",false);
e=e||"feature",y[n]=e,e in u||(u[e]=[])
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17647-2-17701",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17627-2-17703",true);
 }}var w={},y={},b={on:h,emit:n,get:m,listeners:l,context:e,buffer:v,abort:a,aborted:!1};return b
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17298-2-17798",true);
 }}function i(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17798-2-17824",false);
return new r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17798-2-17824",true);
 }}function a(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17824-2-17887",false);
(u.api||u.feature)&&(p.aborted=!0,u=p.backlog={})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17824-2-17887",true);
 }}var c="nr@context",s=t("gos"),f=t(20),u={},d={},p=e.exports=o();p.backlog=u
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17268-2-17963",true);
 }},{}],gos:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17973-2-18234",false);
function r(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-17989-2-18184",false);
if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17989-2-18184",true);
 }}var o=Object.prototype.hasOwnProperty;e.exports=r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-17973-2-18234",true);
 }},{}],handle:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18247-2-18360",false);
function r(t,e,n,r){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18263-2-18313",false);
o.buffer([t],r),o.emit(t,e,n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18263-2-18313",true);
 }}var o=t("ee").get("handle");e.exports=r,r.ee=o
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18247-2-18360",true);
 }},{}],id:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18369-2-18540",false);
function r(t){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18385-2-18499",false);
var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18475-2-18497",false);
return o++
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18475-2-18497",true);
 }})
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18385-2-18499",true);
 }}var o=1,i="nr@id",a=t("gos");e.exports=r
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18369-2-18540",true);
 }},{}],loader:[function(t,e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18553-2-19813",false);
function r(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18569-2-18905",false);
if(!x++){var t=g.info=NREUM.info,e=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(y,function(e,n){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18740-2-18769",false);
t[e]||(t[e]=n)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18740-2-18769",true);
 }}),s("mark",["onload",a()+g.offset],null,"api");var n=p.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18569-2-18905",true);
 }}function o(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18905-2-18949",false);
"complete"===p.readyState&&i()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18905-2-18949",true);
 }}function i(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-18949-2-19011",false);
s("mark",["domContent",a()+g.offset],null,"api")
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18949-2-19011",true);
 }}function a(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-0-function-2-19011-2-19133",false);
return E.exists&&performance.now?Math.round(performance.now()):(c=Math.max((new Date).getTime(),c))-g.offset
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-19011-2-19133",true);
 }}var c=(new Date).getTime(),s=t("handle"),f=t(20),u=t("ee"),d=window,p=d.document,h="addEventListener",l="attachEvent",m=d.XMLHttpRequest,v=m&&m.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-spa-1173.min.js"},b=m&&v&&v[h]&&!/CriOS/.test(navigator.userAgent),g=e.exports={offset:c,now:a,origin:w,features:{},xhrWrappable:b};t(17),p[h]?(p[h]("DOMContentLoaded",i,!1),d[h]("load",r,!1)):(p[l]("onreadystatechange",o),d[l]("onload",r)),s("mark",["firstbyte",c],null,"api");var x=0,E=t(22)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-0-function-2-18553-2-19813",true);
 }},{}]},{},["loader",2,15,5,3,4]);
      ;NREUM.info={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",licenseKey:"671cca5e0f",applicationID:"24549142",sa:1}</script><script>
(function(){if (typeof __tracer == 'undefined' && typeof window != 'undefined')
                 { __tracer = window.top.__tracer;
                 }
                })();
(function () { 
 try {__tracer.cacheInit("www.starbucks.com/-script-1-function-5-9-8-9",false);

          window.dataLayer = window.dataLayer || [];
          window.dataLayer.push({"platform":"Starbucks Global Web Platform","event":"datalayer-initialized"});
        
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-1-function-5-9-8-9",true);
 }})();</script><link rel="preload" href="/_next/static/css/e2d9451f2bdf4267.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e2d9451f2bdf4267.css" data-n-g=""/><link rel="preload" href="/_next/static/css/d54ed43fc54bc83b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d54ed43fc54bc83b.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </script><script src="/_next/static/chunks/webpack-342e47b961ca189f.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </script><script src="/_next/static/chunks/framework-92a30048c40f1e0e.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </script><script src="/_next/static/chunks/main-f53159a7794c9bac.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </script><script src="/_next/static/chunks/pages/_app-ba0b3e5b64bc9a2e.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </script><script src="/_next/static/chunks/29107295-28eb33936020e97e.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </script><script src="/_next/static/chunks/619-d60db8af194f74f3.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </script><script src="/_next/static/chunks/60-87b164e7984032ed.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </script><script src="/_next/static/chunks/pages/%5B%5B...page%5D%5D-07192cf04b03bc6f.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </script><script src="/_next/static/VuGUCotQyEWd5t22HvGS5/_buildManifest.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </script><script src="/_next/static/VuGUCotQyEWd5t22HvGS5/_ssgManifest.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </script><script src="/_next/static/VuGUCotQyEWd5t22HvGS5/_middlewareManifest.js" defer="">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </script>
<script>(window.BOOMR_mq=window.BOOMR_mq||[]).push(["addVar",{"rua.upush":"true","rua.cpush":"true","rua.upre":"true","rua.cpre":"true","rua.uprl":"false","rua.cprl":"false","rua.cprf":"false","rua.trans":"SJ-60edfcd1-3def-4e8c-9423-367317fd75e6","rua.cook":"false","rua.ims":"false","rua.ufprl":"false","rua.cfprl":"false","rua.isuxp":"false","rua.texp":"norulematch"}]);</script>
                              <script>
(function(){if (typeof __tracer == 'undefined' && typeof window != 'undefined')
                 { __tracer = window.top.__tracer;
                 }
                })();
!function(a){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-15-function-11-39-11-3057",false);
var e="https://s.go-mpulse.net/boomerang/",t="addEventListener";if("False"=="True")a.BOOMR_config=a.BOOMR_config||{},a.BOOMR_config.PageParams=a.BOOMR_config.PageParams||{},a.BOOMR_config.PageParams.pci=!0,e="https://s2.go-mpulse.net/boomerang/";if(window.BOOMR_API_key="HHB3F-A7T87-EXZWT-MGPRQ-KZYBS",function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-15-function-11-353-11-1269",false);
function n(e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-15-function-11-364-11-430",false);
a.BOOMR_onload=e&&e.timeStamp||(new Date).getTime()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-15-function-11-364-11-430",true);
 }}if(!a.BOOMR||!a.BOOMR.version&&!a.BOOMR.snippetExecuted){a.BOOMR=a.BOOMR||{},a.BOOMR.snippetExecuted=!0;var i,_,o,r=document.createElement("iframe");if(a[t])a[t]("load",n,!1);else if(a.attachEvent)a.attachEvent("onload",n);r.src="javascript:void(0)",r.title="",r.role="presentation",(r.frameElement||r).style.cssText="width:0;height:0;border:0;display:none;",o=document.getElementsByTagName("script")[0],o.parentNode.insertBefore(r,o);try{_=r.contentWindow.document}catch(O){i=document.domain,r.src="javascript:var d=document.open();d.domain='"+i+"';void(0);",_=r.contentWindow.document}_.open()._l=function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-15-function-11-1029-11-1212",false);
var a=this.createElement("script");if(i)this.domain=i;a.id="boomr-if-as",a.src=e+"HHB3F-A7T87-EXZWT-MGPRQ-KZYBS",BOOMR_lstart=(new Date).getTime(),this.body.appendChild(a)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-15-function-11-1029-11-1212",true);
 }},_.write("<bo"+'dy onload="document._l();">'),_.close()}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-15-function-11-353-11-1269",true);
 }}(),"".length>0)if(a&&"performance"in a&&a.performance&&"function"==typeof a.performance.setResourceTimingBufferSize)a.performance.setResourceTimingBufferSize();!function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-15-function-11-1430-11-3054",false);
if(BOOMR=a.BOOMR||{},BOOMR.plugins=BOOMR.plugins||{},!BOOMR.plugins.AK){var e="true"=="true"?1:0,t="",n="tusyiediokkb6y5ybzka-f-678792b42-clientnsv4-s.akamaihd.net",i="false"=="true"?2:1,_={"ak.v":"34","ak.cp":"609049","ak.ai":parseInt("372024",10),"ak.ol":"0","ak.cr":43,"ak.ipv":4,"ak.proto":"http/1.1","ak.rid":"6a5b221f","ak.r":34883,"ak.a2":e,"ak.m":"a","ak.n":"essl","ak.bpcip":"157.37.132.0","ak.cport":33090,"ak.gh":"49.44.141.93","ak.quicv":"","ak.tlsv":"tls1.3","ak.0rtt":"","ak.csrc":"-","ak.acc":"reno","ak.t":"1673006676","ak.ak":"hOBiQwZUYzCg5VSAfCLimQ==40cLoSLbK7kd2Gsv6SksZdM7COf4AiptQQVl0CzCGhtUVJumn6jEP3QQLldKS0kTPMIiqkipX3jytXaAS/iHOgUG3k9Vmhj9QbPkzRocsR98YCTf4WEfgpwMx/xGDhKo8lWLMVBpzM6xlHhJMNcCh90b2D0xoikCa+lUG4Vz2Qxp5dXjkMDstOnMDXgeJrkKQfmG0+w0VyFhK62QkMreT3Be58HHQOhaF0+rlEfyXOWrOrPbbOQy0mq3WjJpWfYDj2C++L2o2dO+kMqvEMVAkHNgG57M/3bLBPOQBYLGKjW5gDOAeF8AegDA7O+cCjXFS9yUy+buUcdi/xg6d+gaeGlAnlpkTZOTegPIgogSIBvuJx8T6Pam3XrbQ4+JSIWCoic/Nr+UdZhu94L2ymjt9ZhrPFCV/czODoV1unhC27E=","ak.pv":"411","ak.dpoabenc":"","ak.tf":i};if(""!==t)_["ak.ruds"]=t;var o={i:!1,av:function(e){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-15-function-11-2521-11-2644",false);
var t="http.initiator";if(e&&(!e[t]||"spa_hard"===e[t]))_["ak.feo"]=void 0!==a.aFeoApplied?1:0,BOOMR.addVar(_)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-15-function-11-2521-11-2644",true);
 }},rv:function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-15-function-11-2648-11-2838",false);
var a=["ak.bpcip","ak.cport","ak.cr","ak.csrc","ak.gh","ak.ipv","ak.m","ak.n","ak.ol","ak.proto","ak.quicv","ak.tlsv","ak.0rtt","ak.r","ak.acc","ak.t","ak.tf"];BOOMR.removeVar(a)
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-15-function-11-2648-11-2838",true);
 }}};BOOMR.plugins.AK={akVars:_,akDNSPreFetchDomain:n,init:function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-15-function-11-2894-11-3018",false);
if(!o.i){var a=BOOMR.subscribe;a("before_beacon",o.av,null,null),a("onbeacon",o.rv,null,null),o.i=!0}return this
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-15-function-11-2894-11-3018",true);
 }},is_complete:function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-15-function-11-3031-11-3051",false);
return!0
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-15-function-11-3031-11-3051",true);
 }}}}
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-15-function-11-1430-11-3054",true);
 }}()
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-15-function-11-39-11-3057",true);
 }}(window);</script></head><body><script async="" src="//consent.trustarc.com/notice?domain=app.starbucks.com&amp;gtm=1&amp;ostype=mobile&amp;pcookie&amp;oc=1&amp;c=teconsent&amp;text=true&amp;js=nj&amp;noticeType=bb&amp;pn=1&amp;country=us" type="text/javascript">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                
                         
                      
                                                    
                                                                                                              
             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </script><div id="consent_blackbar"></div><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-P37KWTP" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>
(function(){if (typeof __tracer == 'undefined' && typeof window != 'undefined')
                 { __tracer = window.top.__tracer;
                 }
                })();
(function(w,d,s,l,i){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-17-function-11-3525-15-3",false);
w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-17-function-11-3525-15-3",true);
 }})(window,document,'script','dataLayer','GTM-P37KWTP');</script><div id="__next" data-reactroot=""><div><div class="sb-skipLinkWrapper invisible"><a class="inline-block bg-greenAccent color-textWhite text-bold text-noUnderline sb-skipLink visible" href="#primary-content">Skip to main content</a></div></div><header class="sb-globalNav" style="z-index:3"><nav aria-label="Global" class="sb-globalNav__nav bg-white"><div class="sb-global-gutters sb-global-gutters--maxWidthLayout sb-globalNav--relative"><div class="flex items-center"><div><div class="sb-globalNav__logo my3 mr3 md-mr4 lg-mr6 md-my3 lg-my4 sb-globalNav--maxWidthLogo"><a class="block" href="https://www.starbucks.com"><svg class="block" focusable="false" height="100%" viewBox="0 0 62 62" width="100%" xmlns="http://www.w3.org/2000/svg"><circle cx="31" cy="31" fill="#fff" r="30.002"></circle><path d="M34.017 13.969c-.263-.047-1.531-.26-3.017-.26s-2.754.212-3.017.26c-.151.027-.209-.121-.094-.207.104-.077 3.11-2.365 3.11-2.365l3.109 2.365c.117.086.06.234-.091.207zm-5.194 14.856s-.159.057-.201.197c.63.484 1.064 1.585 2.378 1.585s1.748-1.101 2.377-1.585c-.041-.141-.2-.197-.2-.197s-.823.194-2.177.194-2.177-.194-2.177-.194zm2.177-1.853c-.365 0-.445-.138-.694-.137-.237.001-.697.19-.797.363.007.088.039.167.103.237.532.08.772.376 1.389.376s.856-.296 1.389-.376c.062-.07.096-.148.103-.237-.099-.173-.56-.361-.798-.363-.25-.002-.331.137-.695.137zm29.956 5.673c-.038.717-.102 1.428-.19 2.131-3.396.562-4.61-2.464-8.089-2.312.208.738.377 1.49.507 2.258 2.869-.002 4.025 2.68 7.217 2.285-.168.82-.37 1.629-.603 2.426-2.524.248-3.413-2.26-6.334-2.191.024.416.037.836.037 1.26l-.012.701 5.672 2.164c-.297.807-.629 1.596-.991 2.369-1.705-.094-2.293-2.281-4.887-2.107-.078.561-.177 1.115-.295 1.662 2.253-.158 2.738 1.916 4.352 2.084-.411.75-.854 1.48-1.325 2.191-.956-.512-1.785-2.057-3.598-2.152.186-.574.349-1.156.487-1.748-1.608 0-3.447-.627-4.989-2.031.5-2.846-3.917-5.744-3.917-7.828 0-2.264 1.145-3.517 1.145-6.569 0-2.265-1.1-4.722-2.759-6.401-.321-.326-.65-.59-1.028-.827 1.524 1.886 2.694 4.122 2.694 6.712 0 2.874-1.337 4.391-1.337 7.044 0 2.652 3.88 4.947 3.88 7.682 0 1.076-.344 2.127-1.478 4.191 1.742 1.74 4.011 2.689 5.475 2.689.475 0 .73-.145.9-.518.146-.322.285-.648.416-.977 1.577.061 2.299 1.494 3.172 2.066-.479.643-.982 1.264-1.509 1.865-.585-.648-1.371-1.738-2.522-2.041-.206.4-.424.795-.653 1.182.991.27 1.669 1.27 2.194 1.928-.566.586-1.155 1.148-1.768 1.688-.383-.596-.979-1.352-1.647-1.76-.247.334-.504.66-.769.977.568.385 1.069 1.078 1.396 1.643-.708.568-1.44 1.107-2.198 1.611-.374-3.047-4.533-5.135-3.412-8.67-.368.623-.807 1.402-.807 2.34 0 2.559 2.726 4.59 2.943 7.133-.565.338-1.143.656-1.732.957-.098-2.795-2.984-5.854-2.984-8.148 0-2.561 3.354-5.133 3.354-8.156 0-3.025-3.87-5.119-3.87-7.775 0-2.654 1.646-4.181 1.646-7.583 0-2.492-1.184-5.014-3.013-6.625-.324-.286-.643-.513-1.026-.712 1.725 2.069 2.725 3.946 2.725 6.794 0 3.199-1.886 4.975-1.886 8.107 0 3.133 3.798 4.875 3.798 7.795s-3.535 5.381-3.535 8.381c0 2.729 3.116 5.453 3.162 8.691-.681.297-1.375.568-2.081.814.396-3.271-3.111-6.645-3.111-9.314 0-2.918 3.667-5.426 3.667-8.572 0-3.148-3.728-4.611-3.728-7.842 0-3.229 2.287-5.017 2.287-8.585 0-2.781-1.373-5.282-3.379-6.832l-.127-.096c-.189-.14-.345.029-.211.195 1.42 1.773 2.179 3.566 2.179 6.221 0 3.264-2.627 5.916-2.627 9.078 0 3.732 3.528 4.799 3.528 7.861 0 3.061-3.783 5.51-3.783 8.76 0 3.014 3.58 6.359 2.966 9.838-.718.186-1.446.348-2.185.48.672-4.332-2.84-7.443-2.84-10.277 0-3.068 3.918-5.803 3.918-8.801 0-2.828-2.812-3.752-3.182-6.645-.051-.395-.368-.688-.805-.615-.571.104-1.303.48-2.453.48s-1.882-.377-2.454-.48c-.436-.072-.753.221-.804.615-.369 2.893-3.183 3.816-3.183 6.645 0 2.998 3.919 5.732 3.919 8.801 0 2.834-3.512 5.945-2.841 10.277-.738-.133-1.467-.295-2.185-.48-.614-3.479 2.967-6.824 2.967-9.838 0-3.25-3.784-5.699-3.784-8.76 0-3.062 3.529-4.129 3.529-7.861 0-3.162-2.628-5.813-2.628-9.078 0-2.654.759-4.447 2.18-6.221.133-.166-.022-.335-.212-.195l-.126.096c-2.004 1.546-3.376 4.047-3.376 6.828 0 3.568 2.287 5.356 2.287 8.585 0 3.23-3.728 4.693-3.728 7.842 0 3.146 3.667 5.654 3.667 8.572 0 2.67-3.507 6.043-3.11 9.314-.707-.246-1.401-.518-2.082-.814.047-3.238 3.161-5.963 3.161-8.691 0-3-3.533-5.461-3.533-8.381s3.796-4.662 3.796-7.795c0-3.132-1.885-4.908-1.885-8.107 0-2.848.999-4.725 2.724-6.794-.384.199-.702.426-1.025.712-1.829 1.611-3.012 4.133-3.012 6.625 0 3.402 1.646 4.929 1.646 7.583 0 2.656-3.87 4.75-3.87 7.775 0 3.023 3.354 5.596 3.354 8.156 0 2.295-2.888 5.354-2.985 8.148-.589-.301-1.167-.619-1.732-.957.218-2.543 2.943-4.574 2.943-7.133 0-.938-.438-1.717-.807-2.34 1.121 3.535-3.038 5.623-3.412 8.67-.758-.504-1.491-1.043-2.198-1.611.326-.564.827-1.258 1.396-1.643-.266-.316-.522-.643-.769-.977-.669.408-1.266 1.164-1.648 1.76-.611-.539-1.201-1.102-1.767-1.688.525-.658 1.203-1.658 2.194-1.928-.229-.387-.447-.781-.653-1.182-1.151.303-1.938 1.393-2.522 2.041-.527-.602-1.031-1.223-1.509-1.865.873-.572 1.595-2.006 3.171-2.066.132.328.271.654.417.977.17.373.426.518.9.518 1.464 0 3.732-.949 5.475-2.689-1.134-2.064-1.478-3.115-1.478-4.191 0-2.734 3.88-5.029 3.88-7.682 0-2.653-1.337-4.17-1.337-7.044 0-2.59 1.17-4.826 2.694-6.712-.378.237-.707.501-1.028.827-1.659 1.68-2.759 4.136-2.759 6.401 0 3.052 1.146 4.305 1.146 6.569 0 2.084-4.418 4.982-3.918 7.828-1.542 1.404-3.381 2.031-4.99 2.031.14.592.303 1.174.487 1.748-1.812.096-2.641 1.641-3.598 2.152-.472-.711-.914-1.441-1.325-2.191 1.613-.168 2.099-2.242 4.353-2.084-.118-.547-.218-1.102-.296-1.662-2.594-.174-3.182 2.014-4.887 2.107-.362-.773-.694-1.562-.991-2.369l5.673-2.164-.012-.701c0-.424.013-.844.036-1.26-2.921-.068-3.81 2.439-6.334 2.191-.232-.797-.435-1.605-.602-2.426 3.19.395 4.347-2.287 7.217-2.285.13-.768.299-1.52.506-2.258-3.479-.151-4.693 2.875-8.088 2.312-.089-.703-.152-1.414-.19-2.131 3.947.441 5.427-2.804 9.021-2.407.339-.859.733-1.69 1.177-2.49-4.506-.792-6.036 2.976-10.23 2.397.453-16.171 13.706-29.143 29.989-29.143s29.536 12.972 29.989 29.147c-4.195.579-5.725-3.188-10.23-2.397.443.8.837 1.631 1.177 2.49 3.592-.398 5.072 2.848 9.02 2.407zm-42.852-12.583c-2.209-.903-4.883-.695-7.167.772-.354-2.125-1.507-4.013-3.149-5.152-.227-.157-.463-.008-.442.255.347 4.49-2.278 8.389-5.506 11.816 3.327 1 6.159-3.284 10.474-1.789 1.548-2.305 3.514-4.308 5.79-5.902zm12.896-2.716c-2.785 0-5.118 1.575-5.729 3.61-.047.156.017.257.197.176.501-.225 1.071-.333 1.69-.333 1.136 0 2.137.417 2.729 1.143.262.864.284 2.115-.012 2.829-.468-.105-.636-.467-1.093-.467s-.811.321-1.586.321c-.774 0-.865-.366-1.374-.366-.599 0-.709.617-.709 1.313 0 3.103 2.852 7.373 5.886 7.373 3.033 0 5.885-4.27 5.885-7.373 0-.696-.143-1.292-.769-1.373-.312.225-.599.426-1.313.426-.775 0-.989-.321-1.445-.321-.551 0-.496 1.162-1.15 1.227-.436-1.048-.457-2.392-.095-3.589.593-.726 1.593-1.143 2.729-1.143.619 0 1.193.109 1.689.333.181.081.244-.021.197-.176-.61-2.035-2.942-3.61-5.727-3.61zm4.434 4.452c-.668 0-1.451.205-1.943.753-.051.149-.051.371.021.519 1.211-.415 2.279-.431 2.795.146.275-.25.363-.475.363-.736 0-.403-.41-.682-1.236-.682zm-9.741 1.418c.584-.585 1.815-.56 3.094-.088.056-.636-1.083-1.331-2.221-1.331-.827 0-1.236.279-1.236.683 0 .261.088.487.363.736zm19.194-10.504c-2.199.157-4.109.912-5.654 2.17.656-1.86 1.489-3.487 2.545-5.064-2.8.297-5.141 1.321-6.849 3.071l-1.337-3.505 2.968-2.621-3.974-.281-1.586-3.696-1.587 3.696-3.974.281 2.968 2.621-1.336 3.505c-1.709-1.75-4.05-2.774-6.848-3.071 1.054 1.578 1.887 3.205 2.543 5.064-1.544-1.259-3.454-2.014-5.653-2.17 1.319 1.696 2.488 3.504 3.354 5.448.098.219.308.291.535.178 3.012-1.497 6.406-2.339 9.997-2.339s6.984.843 9.998 2.339c.227.113.437.041.534-.178.867-1.944 2.036-3.752 3.356-5.448zm4.801 13.254c4.313-1.495 7.146 2.788 10.473 1.789-3.228-3.427-5.852-7.326-5.505-11.816.021-.263-.216-.413-.442-.255-1.643 1.139-2.796 3.027-3.149 5.152-2.285-1.467-4.958-1.676-7.167-.772 2.273 1.592 4.24 3.595 5.79 5.902z" fill="#006341"></path><g fill="#006341"><path d="M53.595 57.01h-1.526v4.105h-.547v-4.105h-1.522v-.51h3.595v.51zM54.236 56.5h.811l1.57 3.618h.011l1.574-3.618h.798v4.615h-.551v-3.869h-.012l-1.653 3.869h-.333l-1.659-3.869h-.011v3.869h-.545v-4.615z"></path></g></svg><span class="hiddenVisually">Starbucks Coffee Company</span></a></div></div><div class="sb-globalNav__wrapper hidden"><div class="flex-shrink-none"><ul><li class="sb-globalNav__desktopListItem"><a class="sb-globalNav__desktopLink md-py5 lg-py6 inline-block text-noUnderline text-xxs text-upper text-bold " href="https://www.starbucks.com/menu">Menu</a></li><li class="sb-globalNav__desktopListItem"><a class="sb-globalNav__desktopLink md-py5 lg-py6 inline-block text-noUnderline text-xxs text-upper text-bold " href="https://www.starbucks.com/rewards">Rewards</a></li><li class="sb-globalNav__desktopListItem"><a class="sb-globalNav__desktopLink md-py5 lg-py6 inline-block text-noUnderline text-xxs text-upper text-bold " href="https://www.starbucks.com/gift">Gift Cards</a></li></ul></div><div class="ml-auto flex-shrink-none sb-auxiliaryNav"><div class="ml6 flex items-center"><a class="sb-textLink text-noUnderline text-semibold sb-findAStorePin inline-block mr6 " href="https://www.starbucks.com/store-locator"><svg aria-hidden="true" class="valign-middle pr2" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M12,11.475 C10.5214286,11.475 9.32142857,10.299 9.32142857,8.85 C9.32142857,7.401 10.5214286,6.225 12,6.225 C13.4785714,6.225 14.6785714,7.401 14.6785714,8.85 C14.6785714,10.299 13.4785714,11.475 12,11.475 M12,1.5 C7.85357143,1.5 4.5,4.7865 4.5,8.85 C4.5,14.3625 12,22.5 12,22.5 C12,22.5 19.5,14.3625 19.5,8.85 C19.5,4.7865 16.1464286,1.5 12,1.5"></path></svg>Find a store</a><a class="sb-button sb-button--default sb-button--black mr3" href="https://www.starbucks.com/account/signin?ReturnUrl=%2F" style="min-width:0;min-height:0">Sign in</a><a class="sb-button sb-button--positive sb-button--black" href="https://www.starbucks.com/account/create" style="min-width:0;min-height:0">Join now</a></div></div></div><div class="sb-globalNav__menuButton sb-global-gutters--margin"><span class="absoluteCenter-y"><button aria-label="Open menu" class="sb-iconButton relative color-textBlackSoft" style="min-width:44px;min-height:44px"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:24px;height:24px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path class="sb-hamburgerButton-middleLine-CLOSED sb-hamburgerButton-animation" d="M21,12.9H3c-0.5,0-0.9-0.4-0.9-0.9s0.4-0.9,0.9-0.9h18c0.5,0,0.9,0.4,0.9,0.9S21.5,12.9,21,12.9z"></path><path class="sb-hamburgerButton-topLine-CLOSED sb-hamburgerButton-animation sb-hamburgerButton-animation-outer-lines" d="M21,6.9H3C2.5,6.9,2.1,6.5,2.1,6S2.5,5.1,3,5.1h18c0.5,0,0.9,0.4,0.9,0.9S21.5,6.9,21,6.9z"></path><path class="sb-hamburgerButton-bottomLine-CLOSED sb-hamburgerButton-animation sb-hamburgerButton-animation-outer-lines" d="M21,18.9H3c-0.5,0-0.9-0.4-0.9-0.9s0.4-0.9,0.9-0.9h18c0.5,0,0.9,0.4,0.9,0.9S21.5,18.9,21,18.9z"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></button></span></div></div></div><div><div class="sb-hamburgerNav bg-white pt5 hidden" id="primary-hamburger-nav-panel"><div><ul><li class=""><button aria-label="Expand Menu sub-menu" class="text-noUnderline text-md py3 px5 sb-hamburgerNav-pushViewButton-right" id="hamburger-nav-push-view-btn-Menu-right"><svg aria-hidden="true" class="valign-middle " focusable="false" preserveAspectRatio="xMidYMid meet" style="width:24px;height:24px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M8.902 17.656c-.293.293-.293.768 0 1.06.293.294.768.294 1.06 0L16.38 12.3c.293-.293.293-.768 0-1.06L9.86 4.72c-.293-.293-.767-.293-1.06 0-.293.293-.293.767 0 1.06l5.99 5.99L8.9 17.656z"></path></svg><span>Menu</span></button></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://www.starbucks.com/rewards">Rewards</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://www.starbucks.com/gift">Gift Cards</a></li></ul><hr aria-hidden="true" class="sb-rule pt3 pb5 px5"/><div class="inline-block px4"><div class="ml-auto flex-shrink-none sb-auxiliaryNav"><div class=""><a class="sb-button sb-button--default sb-button--black mr3" href="https://www.starbucks.com/account/signin?ReturnUrl=%2F" style="min-width:0;min-height:0">Sign in</a><a class="sb-button sb-button--positive sb-button--black" href="https://www.starbucks.com/account/create" style="min-width:0;min-height:0">Join now</a><a class="sb-textLink text-noUnderline text-semibold sb-findAStorePin block mt3 " href="https://www.starbucks.com/store-locator" style="min-width:0;min-height:0"><svg aria-hidden="true" class="valign-middle pr2" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M12,11.475 C10.5214286,11.475 9.32142857,10.299 9.32142857,8.85 C9.32142857,7.401 10.5214286,6.225 12,6.225 C13.4785714,6.225 14.6785714,7.401 14.6785714,8.85 C14.6785714,10.299 13.4785714,11.475 12,11.475 M12,1.5 C7.85357143,1.5 4.5,4.7865 4.5,8.85 C4.5,14.3625 12,22.5 12,22.5 C12,22.5 19.5,14.3625 19.5,8.85 C19.5,4.7865 16.1464286,1.5 12,1.5"></path></svg>Find a store</a></div></div></div></div></div></div><div class="sb-hamburgerNav bg-white hidden" id="secondary-hamburger-nav-panel-Menu"><ul><li class=""><button aria-label="Back to Main Menu" class="text-noUnderline text-md py3 px5 bg-neutralCool text-center size12of12 sb-hamburgerNav-pushViewButton-left py3" id="hamburger-nav-push-view-btn-Menu-left"><svg aria-hidden="true" class="valign-middle sb-hamburgerNav-pushViewButton-left-arrow" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:24px;height:24px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M15.098 5.78c.292-.293.292-.767 0-1.06-.293-.293-.768-.293-1.06 0L7.62 11.137c-.293.293-.293.768 0 1.06l6.52 6.52c.292.293.767.293 1.06 0 .293-.293.293-.768 0-1.06l-5.99-5.99L15.1 5.78z"></path></svg><span>Menu</span></button></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://www.starbucks.com/menu">All products</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://www.starbucks.com/menu/featured">Featured</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://www.starbucks.com/menu/previous">Previous Orders</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://www.starbucks.com/menu/favorites">Favorite Products</a></li></ul></div><div class="sb-hamburgerNav bg-white hidden" id="secondary-hamburger-nav-panel-Account"><ul><li class=""><button aria-label="Back to Main Menu" class="text-noUnderline text-md py3 px5 bg-neutralCool text-center size12of12 sb-hamburgerNav-pushViewButton-left py3" id="hamburger-nav-push-view-btn-Account-left"><svg aria-hidden="true" class="valign-middle sb-hamburgerNav-pushViewButton-left-arrow" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:24px;height:24px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M15.098 5.78c.292-.293.292-.767 0-1.06-.293-.293-.768-.293-1.06 0L7.62 11.137c-.293.293-.293.768 0 1.06l6.52 6.52c.292.293.767.293 1.06 0 .293-.293.293-.768 0-1.06l-5.99-5.99L15.1 5.78z"></path></svg><span>Account</span></button></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://app.starbucks.com/account/cards">Card management</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://app.starbucks.com/account/rewards">My Rewards</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://app.starbucks.com/account/history">History</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://app.starbucks.com/account/personal">Personal info</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://app.starbucks.com/account/payment-method">Payment methods</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://app.starbucks.com/account/settings/privacy">Privacy and data</a></li><li class=""><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://app.starbucks.com/account/settings">Settings</a></li><li class="sb-hamburgerNav-navItem-rule"><a class="block text-noUnderline text-left text-md px5 py3 size12of12" href="https://www.starbucks.com/account/signout?ReturnUrl=%2F">Sign out</a></li></ul></div></nav></header><div><main class="relative shell_primaryContent__Aoh08" id="primary-content"><div><div class="sb-contentColumn sb-global-gutters mx-auto sb-contentColumn--xlarge px0 mb5" id="137-82560"><div class="sb-contentColumn__inner"><div class="flex justify-center text-center py5" style="background-color:#d4e9e2"><div class="content-block_innerContentContainer__uIrJV content-block_maxWidth60__5ZIUb textBlockGutter"><h1 class="sb-heading text-semibold md" tabindex="-1" style="color:#1e3932"><span class="text-semibold md rich-text_text__02jRf rich-text_width__0GHdb">Start fresh with Starbucks Rewards</span></h1><div class="sm rich-text_text__02jRf rich-text_width__0GHdb" style="color:#1e3932"><a href="https://starbucks.app.link/23P2Qm5Nbtb">Join</a> today to earn your way to free coffee and treats.*</div></div></div></div></div></div><div><div class="sb-contentColumn sb-global-gutters mx-auto sb-contentColumn--xlarge px0 my5" id="137-82561"><div class="sb-contentColumn__inner"><div class="md-flex image-content-block_flexRowReverse__AEmTi"><div class="flex justify-center items-center md-size6of12" style="background-color:#3d7170"><img alt="Coffee drink in a tall glass with thick layer of foam on top." class="block" src="https://content-prod-live.cert.starbucks.com/binary/v2/asset/137-82556.jpg"/></div><div class="py5 flex items-center justify-center text-center md-size6of12 textBlockGutter" style="background-color:#3d7170"><div class="image-content-block_copyBlockMaxWidth__sOh9S"><h2 class="sb-heading mb4 xl text-semibold" tabindex="-1" style="color:#ffffff"><span class="rich-text_text__02jRf rich-text_width__0GHdb rich-text_greenLinks__BNG4d">New year, cool new brew</span></h2><div class="md rich-text_text__02jRf rich-text_width__0GHdb rich-text_greenLinks__BNG4d" style="color:#ffffff">Introducing Pistachio Cream Cold Brewbold, smooth coffee topped with pistachio cream cold foam.</div><a class="sb-button sb-button--default sb-button--white mt5" href="https://www.starbucks.com/menu/product/2123702/iced" style="min-width:0;min-height:0">Try it now</a></div></div></div></div></div></div><div><div class="sb-contentColumn sb-global-gutters mx-auto sb-contentColumn--xlarge px0 my5" id="137-82562"><div class="sb-contentColumn__inner"><div class="md-flex"><div class="flex justify-center items-center md-size6of12" style="background-color:#f4c5a1"><img alt="Coffee with a foamy top in a short glass mug with a handle." class="block" src="https://content-prod-live.cert.starbucks.com/binary/v2/asset/137-82557.jpg"/></div><div class="py5 flex items-center justify-center text-center md-size6of12 textBlockGutter" style="background-color:#f4c5a1"><div class="image-content-block_copyBlockMaxWidth__sOh9S"><h2 class="sb-heading mb4 xl text-semibold" tabindex="-1" style="color:#1e3932"><span class="rich-text_text__02jRf rich-text_width__0GHdb rich-text_greenLinks__BNG4d">Long walks with pistachio</span></h2><div class="md rich-text_text__02jRf rich-text_width__0GHdb rich-text_greenLinks__BNG4d" style="color:#1e3932">Keep it cozy with a Pistachio Latte finished with a brown-buttery topping.</div><a class="sb-button sb-button--default sb-button--houseGreen mt5" href="https://www.starbucks.com/menu/product/2123404/hot" style="min-width:0;min-height:0">Order now</a></div></div></div></div></div></div><div><div class="sb-contentColumn sb-global-gutters mx-auto sb-contentColumn--xlarge px0 my5" id="137-82563"><div class="sb-contentColumn__inner"><div class="md-flex image-content-block_flexRowReverse__AEmTi"><div class="flex justify-center items-center md-size6of12" style="background-color:#8b323e"><img alt="A breakfast wrap cut in half and stacked on top of itself, displaying mix of ingredients inside." class="block" src="https://content-prod-live.cert.starbucks.com/binary/v2/asset/137-82558.jpg"/></div><div class="py5 flex items-center justify-center text-center md-size6of12 textBlockGutter" style="background-color:#8b323e"><div class="image-content-block_copyBlockMaxWidth__sOh9S"><h2 class="sb-heading mb4 xl text-semibold" tabindex="-1" style="color:#ffffff"><span class="rich-text_text__02jRf rich-text_width__0GHdb rich-text_greenLinks__BNG4d">Wrap your day</span></h2><div class="md rich-text_text__02jRf rich-text_width__0GHdb rich-text_greenLinks__BNG4d" style="color:#ffffff">Savory ingredients come together in our Bacon, Sausage &amp; Egg Wrap for a satisfying meal on the go.</div><a class="sb-button sb-button--default sb-button--white mt5" href="https://www.starbucks.com/menu/product/2123181/single" style="min-width:0;min-height:0">Order now</a></div></div></div></div></div></div><div><div class="sb-contentColumn sb-global-gutters mx-auto sb-contentColumn--xlarge px0 mt5" id="137-82565"><div class="sb-contentColumn__inner"><div class="flex justify-center text-center py5" style="background-color:#ffffff"><div class="content-block_innerContentContainer__uIrJV content-block_maxWidth60__5ZIUb textBlockGutter"><div class="xs rich-text_text__02jRf rich-text_width__0GHdb" style="color:#000000">*At participating stores.</div></div></div></div></div></div></main><div><footer class="py4 relative footer_footer__ruM_4"><nav aria-label="Global footer" class="sb-global-gutters sb-global-gutters--maxWidthLayout"><div class="lg-flex"><div class="lg-hidden"><div class="cursor-pointer flex justify-between items-center py2 mb2 sm-mb3"><h2 class="sb-heading text-sm" tabindex="-1">About Us</h2><button aria-label="Expand About Us" class="sb-iconButton relative" style="min-width:44px;min-height:44px" aria-expanded="false"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.96 15.5c-.206 0-.402-.084-.546-.232l-5.188-5.33c-.3-.31-.3-.81 0-1.12.3-.31.79-.31 1.093 0l4.64 4.767 4.723-4.853c.3-.31.79-.31 1.09 0 .303.31.303.812.002 1.122l-5.27 5.414c-.145.148-.34.232-.546.232"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></button></div><div class="sb-expander relative" style="height:0px" id="caretExpander50691"><div class="hidden sb-expander__pushdownContent"><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/about-us/">Our Company</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/coffee/">Our Coffee</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://stories.starbucks.com/">Stories and News</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://archive.starbucks.com/">Starbucks Archive</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://investor.starbucks.com">Investor Relations</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://customerservice.starbucks.com/">Customer Service</a></li></ul></div></div></div><div class="sb-footer-columnWidth hidden lg-inline-block "><h2 class="sb-heading text-sm mb4" tabindex="-1">About Us</h2><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/about-us/">Our Company</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/coffee/">Our Coffee</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://stories.starbucks.com/">Stories and News</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://archive.starbucks.com/">Starbucks Archive</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://investor.starbucks.com">Investor Relations</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://customerservice.starbucks.com/">Customer Service</a></li></ul></div><div class="lg-hidden"><div class="cursor-pointer flex justify-between items-center py2 mb2 sm-mb3"><h2 class="sb-heading text-sm" tabindex="-1">Careers</h2><button aria-label="Expand Careers" class="sb-iconButton relative" style="min-width:44px;min-height:44px" aria-expanded="false"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.96 15.5c-.206 0-.402-.084-.546-.232l-5.188-5.33c-.3-.31-.3-.81 0-1.12.3-.31.79-.31 1.093 0l4.64 4.767 4.723-4.853c.3-.31.79-.31 1.09 0 .303.31.303.812.002 1.122l-5.27 5.414c-.145.148-.34.232-.546.232"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></button></div><div class="sb-expander relative" style="height:0px" id="caretExpander50692"><div class="hidden sb-expander__pushdownContent"><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/careers/working-at-starbucks/culture-and-values/">Culture and Values</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://stories.starbucks.com/stories/inclusion-diversity/">Inclusion, Diversity, and Equity</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/careers/working-at-starbucks/education/">College Achievement Plan</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://alumni.starbucks.com/">Alumni Community</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/careers/">U.S. Careers</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/careers/international-careers/">International Careers</a></li></ul></div></div></div><div class="sb-footer-columnWidth hidden lg-inline-block lg-ml5"><h2 class="sb-heading text-sm mb4" tabindex="-1">Careers</h2><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/careers/working-at-starbucks/culture-and-values/">Culture and Values</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://stories.starbucks.com/stories/inclusion-diversity/">Inclusion, Diversity, and Equity</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/careers/working-at-starbucks/education/">College Achievement Plan</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://alumni.starbucks.com/">Alumni Community</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/careers/">U.S. Careers</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/careers/international-careers/">International Careers</a></li></ul></div><div class="lg-hidden"><div class="cursor-pointer flex justify-between items-center py2 mb2 sm-mb3"><h2 class="sb-heading text-sm" tabindex="-1">Social Impact</h2><button aria-label="Expand Social Impact" class="sb-iconButton relative" style="min-width:44px;min-height:44px" aria-expanded="false"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.96 15.5c-.206 0-.402-.084-.546-.232l-5.188-5.33c-.3-.31-.3-.81 0-1.12.3-.31.79-.31 1.093 0l4.64 4.767 4.723-4.853c.3-.31.79-.31 1.09 0 .303.31.303.812.002 1.122l-5.27 5.414c-.145.148-.34.232-.546.232"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></button></div><div class="sb-expander relative" style="height:0px" id="caretExpander50693"><div class="hidden sb-expander__pushdownContent"><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://starbucks.com/responsibility/people/">People</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://starbucks.com/responsibility/planet/">Planet</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/responsibility/reporting-hub/">Environmental and Social Impact Reporting</a></li></ul></div></div></div><div class="sb-footer-columnWidth hidden lg-inline-block lg-ml5"><h2 class="sb-heading text-sm mb4" tabindex="-1">Social Impact</h2><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://starbucks.com/responsibility/people/">People</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://starbucks.com/responsibility/planet/">Planet</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/responsibility/reporting-hub/">Environmental and Social Impact Reporting</a></li></ul></div><div class="lg-hidden"><div class="cursor-pointer flex justify-between items-center py2 mb2 sm-mb3"><h2 class="sb-heading text-sm" tabindex="-1">For Business Partners</h2><button aria-label="Expand For Business Partners" class="sb-iconButton relative" style="min-width:44px;min-height:44px" aria-expanded="false"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.96 15.5c-.206 0-.402-.084-.546-.232l-5.188-5.33c-.3-.31-.3-.81 0-1.12.3-.31.79-.31 1.093 0l4.64 4.767 4.723-4.853c.3-.31.79-.31 1.09 0 .303.31.303.812.002 1.122l-5.27 5.414c-.145.148-.34.232-.546.232"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></button></div><div class="sb-expander relative" style="height:0px" id="caretExpander50694"><div class="hidden sb-expander__pushdownContent"><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/business/landlord-faq/">Landlord Support Center</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/business/suppliers/">Suppliers</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbuckscardb2b.com/" target="_blank">Corporate Gift Card Sales</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.nestlecoffeepartnerssl.com/our-brands/we-proudly-serve-starbucks-coffee-program">Office and Foodservice Coffee</a></li></ul></div></div></div><div class="sb-footer-columnWidth hidden lg-inline-block lg-ml5"><h2 class="sb-heading text-sm mb4" tabindex="-1">For Business Partners</h2><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/business/landlord-faq/">Landlord Support Center</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/business/suppliers/">Suppliers</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbuckscardb2b.com/" target="_blank">Corporate Gift Card Sales</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.nestlecoffeepartnerssl.com/our-brands/we-proudly-serve-starbucks-coffee-program">Office and Foodservice Coffee</a></li></ul></div><div class="lg-hidden"><div class="cursor-pointer flex justify-between items-center py2 mb0"><h2 class="sb-heading text-sm" tabindex="-1">Order and Pickup</h2><button aria-label="Expand Order and Pickup" class="sb-iconButton relative" style="min-width:44px;min-height:44px" aria-expanded="false"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.96 15.5c-.206 0-.402-.084-.546-.232l-5.188-5.33c-.3-.31-.3-.81 0-1.12.3-.31.79-.31 1.093 0l4.64 4.767 4.723-4.853c.3-.31.79-.31 1.09 0 .303.31.303.812.002 1.122l-5.27 5.414c-.145.148-.34.232-.546.232"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></button></div><div class="sb-expander relative" style="height:0px" id="caretExpander50695"><div class="hidden sb-expander__pushdownContent"><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/rewards/mobile-apps/">Order on the App</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/menu">Order on the Web</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://delivery.starbucks.com/" target="_blank">Delivery</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/ways-to-order/">Order and Pickup Options</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://athome.starbucks.com/?utm_source=starbucks.com&amp;utm_medium=referral&amp;utm_campaign=footer" target="_blank">Explore and Find Coffee for Home</a></li></ul></div></div></div><div class="sb-footer-columnWidth hidden lg-inline-block lg-ml5"><h2 class="sb-heading text-sm mb4" tabindex="-1">Order and Pickup</h2><ul class="inline-block"><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/rewards/mobile-apps/">Order on the App</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/menu">Order on the Web</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://delivery.starbucks.com/" target="_blank">Delivery</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://www.starbucks.com/ways-to-order/">Order and Pickup Options</a></li><li class=""><a class="block mb2 py2 text-noUnderline sb-footer-primaryLinks null-pr0" href="https://athome.starbucks.com/?utm_source=starbucks.com&amp;utm_medium=referral&amp;utm_campaign=footer" target="_blank">Explore and Find Coffee for Home</a></li></ul></div></div><hr aria-hidden="true" class="sb-rule py5"/><ul class="flex sb-footer-iconMarginAdjust"><li class="sm-mr1"><a aria-label="spotify" class="sb-iconButton relative inline-block" href="https://open.spotify.com/user/starbucks" style="min-width:44px;min-height:44px"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M12,0 C18.6274131,0 24,5.37261901 24,12.0000716 C24,18.627381 18.6274131,24 12,24 C5.37258694,24 0,18.627381 0,12.0000716 C0,5.37261901 5.37258694,0 12,0 Z M11.0669976,14 C9.95068692,14.0009568 8.6027256,14.1878544 7.49869423,14.4956294 C7.1391459,14.5957759 6.94143571,14.9349663 7.01538732,15.323911 C7.08630361,15.6969088 7.39839046,15.9206437 7.74883281,15.8300653 C8.54008748,15.6259451 9.33810265,15.4781174 10.1468794,15.4098647 C11.1130794,15.3282166 12.0741744,15.3684028 13.0286469,15.5672606 C14.1176396,15.7941848 15.1397171,16.2280998 16.0883949,16.8908526 C16.3912378,17.1024678 16.747061,16.996421 16.9174532,16.6588253 C17.0846722,16.3276084 16.9922326,15.9219194 16.6909074,15.7184371 C16.4242125,15.5382372 16.1546202,15.3615456 15.8770258,15.205585 C14.3588102,14.3530642 12.7453957,14.0017542 11.0669976,14 Z M10.1375115,11.0003442 L9.77055252,11.0048078 C8.68426674,11.0479717 7.61755495,11.2034929 6.57584646,11.49243 C6.14064634,11.6131584 5.91075895,11.9889467 6.03234638,12.3691822 C6.15507681,12.7528185 6.57698947,12.9458793 7.02147652,12.8358765 C7.38895345,12.7448397 7.75828776,12.6556341 8.1321941,12.5915421 C9.5848138,12.3422374 11.0434343,12.3367438 12.5037693,12.5345134 C14.0365424,12.7419621 15.4914481,13.1568596 16.8266238,13.8930018 C17.2083883,14.103459 17.6680202,13.9939794 17.8937642,13.6477519 C18.1073637,13.320098 17.9912056,12.8938209 17.614156,12.6938277 C17.2519655,12.5018134 16.8857744,12.313069 16.5065817,12.1523159 C14.6039028,11.3459341 12.5917809,11.001407 10.504792,11.0032382 C10.2600455,11.0032382 10.0148704,10.9949978 9.77055252,11.0048078 Z M11.0635356,7.01538228 C10.2184059,6.97905829 9.3745573,7.0079312 8.53227456,7.09284241 C7.5586031,7.1912587 6.59774312,7.36511712 5.66051317,7.67557859 C5.1689799,7.83857086 4.89609567,8.38560397 5.0370218,8.90997339 C5.18164902,9.44769266 5.68015742,9.75008213 6.17923521,9.59003924 C7.37155569,9.20770594 8.59405429,9.0489049 9.83078786,9.00947629 C11.1386962,8.96771922 12.4379213,9.07187905 13.7249043,9.33685791 C15.0971547,9.61953308 16.4163087,10.0659767 17.6311204,10.8388705 C17.7602315,10.9209876 17.918809,10.947532 18.0638633,11 C18.0668526,10.9917728 18.0701267,10.9835455 18.0732584,10.9753183 C18.1337569,10.9681777 18.195252,10.9664702 18.2544694,10.9528099 C18.6473544,10.8626208 18.9228009,10.5436216 18.9889935,10.1064919 C19.0467875,9.72508998 18.8742597,9.30969253 18.5354676,9.11099719 C18.0779559,8.84244802 17.6178819,8.57219131 17.1390177,8.35455782 C15.1965147,7.47176064 13.154794,7.1054161 11.0635356,7.01538228 Z"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></a></li><li class="sm-mr1"><a aria-label="facebook" class="sb-iconButton relative inline-block" href="https://facebook.com/starbucks" style="min-width:44px;min-height:44px"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.9997802,0 C18.6169827,0 24,5.38345699 24,12.0002198 C24,18.6169827 18.6169827,24 11.9997802,24 C5.38301731,24 0,18.6169827 0,12.0002198 C0,5.38345699 5.38301731,0 11.9997802,0 Z M15.4043684,4.8 L12.7777895,4.8 C11.2364211,4.8 9.98636842,5.96104896 9.98636842,7.39365487 L9.98636842,9.44903723 L8.59515789,9.44903723 C8.48763158,9.44903723 8.4,9.53002017 8.4,9.6303686 L8.4,11.7623327 C8.4,11.862241 8.48763158,11.9432239 8.59515789,11.9432239 L9.98636842,11.9432239 L9.98636842,19.0186686 C9.98636842,19.1190171 10.074,19.2 10.1815263,19.2 L12.9639474,19.2 C13.0719474,19.2 13.1591053,19.1190171 13.1591053,19.0186686 L13.1591053,11.9432239 L15.1765263,11.9432239 C15.2778947,11.9432239 15.3626842,11.8714836 15.3707368,11.7772969 L15.5649474,9.64533284 C15.5748947,9.53970292 15.4844211,9.44903723 15.3702632,9.44903723 L13.1591053,9.44903723 L13.1591053,7.93632863 C13.1591053,7.58202824 13.4688947,7.29462681 13.8502105,7.29462681 L15.4043684,7.29462681 C15.5123684,7.29462681 15.6,7.21320374 15.6,7.11329543 L15.6,4.98133138 C15.6,4.88142307 15.5123684,4.8 15.4043684,4.8 Z"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></a></li><li class="sm-mr1"><a aria-label="pinterest" class="sb-iconButton relative inline-block" href="https://www.pinterest.com/starbucks/" style="min-width:44px;min-height:44px"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.9997802,0 C18.6169827,0 24,5.38345699 24,12.0002198 C24,18.6169827 18.6169827,24 11.9997802,24 C5.38301731,24 0,18.6169827 0,12.0002198 C0,5.38345699 5.38301731,0 11.9997802,0 Z M16.7437635,9.80095875 C16.4076853,7.09999459 13.974973,5.72453915 11.3823151,6.04599103 C9.33308638,6.29999351 7.2896388,8.13734924 7.20446304,10.7614723 C7.15898457,12.1352202 7.45420918,13.2152643 8.40655904,13.7079011 C8.73839766,13.8799397 9.11455851,13.647282 9.1538704,13.2438663 C9.21707776,12.5937053 8.71874171,12.2918906 8.62315986,11.6344724 C8.11827183,8.17406221 12.2275208,5.81162572 14.3781126,8.22870476 C15.8661833,9.90298663 14.8864693,15.0504856 12.4865168,14.5160131 C10.1875419,14.0041661 13.6123015,9.9059749 11.7765903,9.10213176 C10.2854362,8.44855564 9.49303183,11.1017076 10.2002605,12.420386 C9.82795373,14.4553941 9.06985087,16.3845322 9.18046374,18.814845 C9.19780722,19.1905125 9.62831098,19.3377913 9.8410577,19.0449414 C10.5737235,18.0396038 10.8832083,16.5651088 11.1456729,15.0398132 C11.7349659,15.4359717 12.0506173,15.8487791 12.8017828,15.9128133 C15.5732712,16.14974 17.121466,12.8489885 16.7437635,9.80095875 Z"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></a></li><li class="sm-mr1"><a aria-label="instagram" class="sb-iconButton relative inline-block" href="https://instagram.com/starbucks" style="min-width:44px;min-height:44px"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.9997802,0 C18.6169827,0 24,5.38345699 24,12.0002198 C24,18.6169827 18.6169827,24 11.9997802,24 C5.38301731,24 0,18.6169827 0,12.0002198 C0,5.38345699 5.38301731,0 11.9997802,0 Z M15,5 L9,5 C6.790861,5 5,6.790861 5,9 L5,9 L5,15 C5,17.209139 6.790861,19 9,19 L9,19 L15,19 C17.209139,19 19,17.209139 19,15 L19,15 L19,9 C19,6.790861 17.209139,5 15,5 L15,5 Z M14.7647059,6.23529412 C16.4215601,6.23529412 17.7647059,7.57843987 17.7647059,9.23529412 L17.7647059,9.23529412 L17.7647059,14.7647059 L17.7596132,14.9409787 C17.6683668,16.5157859 16.3623868,17.7647059 14.7647059,17.7647059 L14.7647059,17.7647059 L9.23529412,17.7647059 L9.05902133,17.7596132 C7.48421408,17.6683668 6.23529412,16.3623868 6.23529412,14.7647059 L6.23529412,14.7647059 L6.23529412,9.23529412 L6.24038681,9.05902133 C6.33163324,7.48421408 7.63761323,6.23529412 9.23529412,6.23529412 L9.23529412,6.23529412 Z M11.7941176,8.70588235 C9.86112102,8.70588235 8.29411765,10.2728857 8.29411765,12.2058824 C8.29411765,14.138879 9.86112102,15.7058824 11.7941176,15.7058824 C13.7271143,15.7058824 15.2941176,14.138879 15.2941176,12.2058824 C15.2941176,10.2728857 13.7271143,8.70588235 11.7941176,8.70588235 Z M11.7941176,9.94117647 C13.0448802,9.94117647 14.0588235,10.9551198 14.0588235,12.2058824 C14.0588235,13.4566449 13.0448802,14.4705882 11.7941176,14.4705882 C10.5433551,14.4705882 9.52941176,13.4566449 9.52941176,12.2058824 C9.52941176,10.9551198 10.5433551,9.94117647 11.7941176,9.94117647 Z M15.7058824,7.47058824 C15.2510596,7.47058824 14.8823529,7.83929491 14.8823529,8.29411765 C14.8823529,8.74894038 15.2510596,9.11764706 15.7058824,9.11764706 C16.1607051,9.11764706 16.5294118,8.74894038 16.5294118,8.29411765 C16.5294118,7.83929491 16.1607051,7.47058824 15.7058824,7.47058824 Z"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></a></li><li class="sm-mr1"><a aria-label="youtube" class="sb-iconButton relative inline-block" href="https://www.youtube.com/starbucks" style="min-width:44px;min-height:44px"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.9997802,0 C18.6169827,0 24,5.38345699 24,12.0002198 C24,18.6169827 18.6169827,24 11.9997802,24 C5.38301731,24 0,18.6169827 0,12.0002198 C0,5.38345699 5.38301731,0 11.9997802,0 Z M16.1700158,7 L8.82998416,7 C7.26701245,7 6,8.25308368 6,9.79887301 L6,13.201127 C6,14.7469163 7.26701245,16 8.82998416,16 L16.1700158,16 C17.7329875,16 19,14.7469163 19,13.201127 L19,9.79887301 C19,8.25308368 17.7329875,7 16.1700158,7 Z M11.3262463,9.28078768 L14.5709798,11.3486057 C14.7141036,11.4390048 14.689657,11.6696954 14.5443107,11.7571306 L11.3218015,13.7217059 C11.1822335,13.8056832 11.0555556,13.6925608 11.0555556,13.5162084 L11.0555556,9.4838152 C11.0555556,9.30499291 11.1857894,9.19236451 11.3262463,9.28078768 Z"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></a></li><li class="sm-mr1"><a aria-label="twitter" class="sb-iconButton relative inline-block" href="https://twitter.com/starbucks/" style="min-width:44px;min-height:44px"><svg aria-hidden="true" class="valign-middle absoluteCenter" focusable="false" preserveAspectRatio="xMidYMid meet" style="width:32px;height:32px;overflow:visible;fill:currentColor" viewBox="0 0 24 24"><path d="M11.9997256,5.63636363e-05 C18.6169281,5.63636363e-05 23.9999455,5.38351336 23.9999455,12.0002762 C23.9999455,18.6170391 18.6169281,24.0000564 11.9997256,24.0000564 C5.38296277,24.0000564 -5.4545455e-05,18.6170391 -5.4545455e-05,12.0002762 C-5.4545455e-05,5.38351336 5.38296277,5.63636363e-05 11.9997256,5.63636363e-05 Z M13.9328526,6.00566601 C13.5495281,6.03127502 13.1735596,6.14210744 12.8335533,6.32472904 C12.4927297,6.50777046 12.1882769,6.76218124 11.946758,7.0690695 C11.6958398,7.38645324 11.5111249,7.7613523 11.4167241,8.15892163 C11.3251839,8.5426369 11.3329485,8.92173415 11.3885264,9.30964762 C11.3971083,9.37388005 11.3913871,9.38269626 11.3349918,9.37388005 C9.19237982,9.04642063 7.41674584,8.25883873 5.9745796,6.57116325 C5.9120544,6.49769479 5.8781355,6.49769479 5.82705282,6.5766209 C5.19607955,7.54808386 5.50216697,9.10897377 6.2904749,9.8759845 C6.39550089,9.9780007 6.50297885,10.0804367 6.61944736,10.1736367 C6.57735523,10.1824529 6.0530426,10.124098 5.58553391,9.8759845 C5.5230087,9.83526198 5.49154177,9.85835207 5.48582051,9.93140071 C5.48009925,10.0363556 5.4890898,10.1329142 5.50298429,10.2471052 C5.62394808,11.2315825 6.28761427,12.1425914 7.19688598,12.497759 C7.3047726,12.544359 7.42410175,12.5855013 7.5401616,12.6056527 C7.33337891,12.6522527 7.12005763,12.6858382 6.52586389,12.6379788 C6.45189617,12.6232851 6.42369853,12.6614887 6.45189617,12.7341175 C6.89856313,13.983921 7.86218682,14.3558813 8.58347427,14.5678903 C8.67991837,14.5851029 8.77677113,14.5851029 8.87362389,14.6086128 C8.86749397,14.617429 8.86218137,14.617429 8.85646011,14.6262452 C8.6169845,15.0007245 7.78740177,15.2799046 7.40121671,15.4184451 C6.69831902,15.6711766 5.93289613,15.784528 5.18994963,15.7093802 C5.07102915,15.691328 5.04650946,15.6925874 5.0142252,15.7093802 C4.98153229,15.7299514 5.01013859,15.758919 5.0481441,15.7908253 C5.19894018,15.8932613 5.35218822,15.9839424 5.50870555,16.0712649 C5.98030086,16.3281946 6.47192058,16.5326468 6.98642534,16.6783243 C9.64190741,17.4319008 12.6333092,16.8781585 14.627577,14.8428722 C16.1935677,13.2446184 16.7424,11.0405645 16.7424,8.833572 C16.7424,8.74708913 16.8417047,8.69964949 16.9009607,8.65388914 C17.3083961,8.33944413 17.632056,7.96328561 17.9356914,7.54304602 C17.9906155,7.46747846 17.9987836,7.39862802 17.9998539,7.35648483 L17.9999455,7.31844244 C17.9999455,7.28317758 18.0043466,7.29367307 17.9512206,7.31844244 C17.5380639,7.5107199 17.0836323,7.62700997 16.6377827,7.70383699 C16.8494693,7.66731267 17.161278,7.27394155 17.2859197,7.11482985 C17.476356,6.87217402 17.634508,6.59551279 17.7231875,6.29660111 C17.7350387,6.27351103 17.7432119,6.24412364 17.7207355,6.22649121 C17.6921292,6.21473626 17.6737395,6.22061374 17.6512631,6.23236869 C17.1535134,6.50609118 16.6390087,6.70508575 16.0914023,6.84572538 C16.0460409,6.85706051 16.0125307,6.84572538 15.9839244,6.81633799 C15.9381543,6.76386052 15.8956535,6.71432179 15.8474315,6.67317945 C15.6173551,6.47166596 15.3705235,6.31381373 15.0918164,6.19752365 C14.7260644,6.04428943 14.3268022,5.97963719 13.9328526,6.00566601 Z"></path><circle class="sb-icon-hover" cx="50%" cy="50%" fill="transparent" r="75%"></circle></svg></a></li></ul><ul class="inline-block mt3 lg-mb1 lg-flex"><li class="items-center lg-flex lg-text-center"><a class="block sb-footer-secondaryLinks mb1 py2 lg-mb0 lg-py0 lg-pr3" href="https://www.starbucks.com/terms/privacy-policy/">Privacy Notice</a></li><li class="items-center lg-flex lg-text-center"><span aria-hidden="true" class="color-textBlackSoft px2 hidden lg-inline">|</span><a class="block sb-footer-secondaryLinks mb1 py2 lg-mb0 lg-py0 lg-px3" href="https://www.starbucks.com/terms/starbucks-terms-of-use/">Terms of Use</a></li><li class="items-center lg-flex lg-text-center"><span aria-hidden="true" class="color-textBlackSoft px2 hidden lg-inline">|</span><a class="block sb-footer-secondaryLinks mb1 py2 lg-mb0 lg-py0 lg-px3" href="https://www.starbucks.com/personal-information" id="personal-information">Do Not Share My Personal Information</a></li><li class="items-center lg-flex lg-text-center"><span aria-hidden="true" class="color-textBlackSoft px2 hidden lg-inline">|</span><a class="block sb-footer-secondaryLinks mb1 py2 lg-mb0 lg-py0 lg-px3" href="https://globalassets.starbucks.com/assets/A2A072E3411C4A6ABAEB8D6BCF286F43.pdf">CA Supply Chain Act</a></li><li class="items-center lg-flex lg-text-center"><span aria-hidden="true" class="color-textBlackSoft px2 hidden lg-inline">|</span><button class="block sb-footer-secondaryLinks mb1 py2 lg-mb0 lg-py0 lg-px3">Cookie Preferences</button></li></ul><p class="color-textBlackSoft py3 text-xxs"> 2023 Starbucks Coffee Company. All rights reserved.</p></nav></footer></div></div><div id="modal"></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteStructure":{"id":"137-8256-4","url":null,"displayName":"Homepage","target":null,"typeName":"StructureGroup","published":null,"path":"/home","items":[{"id":"137-56883-64","url":"https://eapi.starbucks.com/content/v3/pages/137-56883-64","displayName":"Homepage","target":null,"typeName":"Page","published":"2023-01-03T01:54:54Z","path":"/home/","items":[],"visibleInNav":false}],"visibleInNav":true},"baseStructureGroup":{"id":"137-8256-4","url":null,"displayName":"Homepage","target":null,"typeName":"StructureGroup","published":null,"path":"/home","items":[{"id":"137-56883-64","url":"https://eapi.starbucks.com/content/v3/pages/137-56883-64","displayName":"Homepage","target":null,"typeName":"Page","published":"2023-01-03T01:54:54Z","path":"/home/","items":[],"visibleInNav":false}],"visibleInNav":true},"resourceLabels":{"items":[{"module":"core","labels":{"readMoreLinkText":"Read More","toggleNavigationText":"Toggle Navigation","sectionErrorMessage":"A problem occurred while rendering this section","todayText":"Today","yesterdayText":"Yesterday","xDaysAgoText":"{0} days ago","showingItemsText":"Showing items {0} to {1}","addressHeadingText":"Address","placeContactHeadingText":"Contact Details","teleponeCaptionText":"Telephone:","faxCaptionText":"Fax:","emailCaptionText":"Email:","directionsLinkText":"Directions to this location","largeMapLinkText":"View Large Map","visitUsSocialLinkTitle":"Visit us on {0}","shareOnSocialCaption":"Share:","shareOnSocialLinkTitle":"Share this page on {0}","redirectEditorHintText":"Edit redirect URL in page metadata","defaultPageTitle":"Starbucks Coffee Company","pageTitlePostfix":" | Starbucks Coffee Company","pageTitleSeparator":""}},{"module":"goldsites","labels":{"watchVideoButtonText":"Watch Video","instagramFollowButtonText":"Follow Us on Instagram","searchModuleButtonText":"Search","searchModulePlaceholder":"Search","footerCopyright":" {{year}} Starbucks","changeRegion":"Change Region","profanityFilterName":"you","nextButtonAccessible":"Next","previousButtonAccessible":"Previous","error500PageTitle":"Something went wrong","error500DecorativePageTitle":"Oops!","error500PageSubtitle":"The site had an error it couldn't recover from, please click below.","error500ResetAppButtonText":"Reset app","error404PageTitle":"Page not found","error404DecorativePageTitle":"Oops!","error404PageSubtitle":"We can't find the page that you were looking for.","error404DescriptiveText":"You might try retyping the URL","subnavMenuHomeLinksAccessible":"Home","subnavSectionMenuAccessible":"{{section}} menu","siteTitle":"Starbucks Coffee Company","skipLink":"Skip to main content","heroRegionLabelAccessible":"hero","accessibleModalTitle":"Starbucks video player","accessibleCloseButton":"Close"}},{"module":"access-control","labels":{"privateAssets":false,"groups":["akamai","www-gold","martech"]}}]},"locale":"en-US","publicationRef":"www/us/en","pagePath":"/home","id":"137-56883-64","metadata":{"metaDescription":"More than just great coffee. Explore the menu, sign up for Starbucks Rewards, manage your gift card and more.","designTheme":null},"pageContent":[{"contentItem":{"id":"137-82560","url":"https://eapi.starbucks.com/content/v3/content/137-82560","displayName":"Spot 1 | ENUS - SR - Acquisition | live on 01/03","typeId":"137-56834-8","typeName":"Content Block","version":3,"updated":"2022-12-28T03:22:56","metadata":{"style":{"copyBlockBackgroundColor":"#d4e9e2","headlineTextColor":"#1e3932","bodyTextColor":"#1e3932","headlineTag":"h1","headlineSize":"md","bodyCopySize":"sm","horizontalAlignment":"center","ctaStyle":"FilledBlack-WhiteText"},"mimeType":"application/json"},"content":{"title":"Start fresh with Starbucks Rewards","body":"\u003ca href=\"https://starbucks.app.link/23P2Qm5Nbtb\"\u003eJoin\u003c/a\u003e today to earn your way to free coffee and treats.*"}},"contentLayout":{"id":"137-56837-32","title":"Content Block[Content]","updated":"2019-11-06T02:44:08.33","metadata":{"view":"GoldSites:ContentBlock","regionView":"GoldSites:Content"}},"isDynamic":true},{"contentItem":{"id":"137-82561","url":"https://eapi.starbucks.com/content/v3/content/137-82561","displayName":"Spot 2 | ENUS - Pistachio Cream Cold Brew | live on 01/03","typeId":"137-56832-8","typeName":"Image Content Block","version":2,"updated":"2022-12-28T03:28:03","metadata":{"style":{"copyBlockBackgroundColor":"#3D7170","imageBlockBackgroundColor":"#3D7170","headlineTextColor":"#FFFFFF","bodyTextColor":"#FFFFFF","headlineTag":"h2","headlineSize":"xl","bodyCopySize":"md","horizontalAlignment":"center","ctaStyle":"GhostWhite-WhiteText"},"mimeType":"application/json"},"content":{"image":{"id":"137-82556","url":"https://content-prod-live.cert.starbucks.com/binary/v2/asset/137-82556.jpg","filename":"W23Hom_PistachioColdBrew_US_CA.jpg","version":1,"updated":"2022-12-28T03:13:30.123","metadata":{"altText":"Coffee drink in a tall glass with thick layer of foam on top.","mimeType":"image/jpeg"}},"title":"New year, cool new brew","body":"Introducing Pistachio Cream Cold Brewbold, smooth coffee topped with pistachio cream cold foam.","link":{"linkText":"Try it now","externalLink":"https://www.starbucks.com/menu/product/2123702/iced","alternateText":"Order a Pistachio Cream Cold Brew now"}}},"contentLayout":{"id":"137-56838-32","title":"Image Right [Content]","updated":"2019-11-06T02:44:08.44","metadata":{"view":"GoldSites:ImageContentBlockImageRight","regionView":"GoldSites:Content"}},"isDynamic":true},{"contentItem":{"id":"137-82562","url":"https://eapi.starbucks.com/content/v3/content/137-82562","displayName":"Spot 3 | ENUS - Pistachio Latte | live on 01/03","typeId":"137-56832-8","typeName":"Image Content Block","version":2,"updated":"2022-12-28T03:34:30","metadata":{"style":{"copyBlockBackgroundColor":"#F4C5A1","imageBlockBackgroundColor":"#F4C5A1","headlineTextColor":"#1E3932","bodyTextColor":"#1E3932","headlineTag":"h2","headlineSize":"xl","bodyCopySize":"md","horizontalAlignment":"center","ctaStyle":"GhostHouseGreen-HouseGreenText"},"mimeType":"application/json"},"content":{"image":{"id":"137-82557","url":"https://content-prod-live.cert.starbucks.com/binary/v2/asset/137-82557.jpg","filename":"W23Hom_PistachioLatte_US_CA.jpg","version":1,"updated":"2022-12-28T03:14:01.673","metadata":{"altText":"Coffee with a foamy top in a short glass mug with a handle.","mimeType":"image/jpeg"}},"title":"Long walks with pistachio","body":"Keep it cozy with a Pistachio Latte finished with a brown-buttery topping.","link":{"linkText":"Order now","externalLink":"https://www.starbucks.com/menu/product/2123404/hot","alternateText":"Order a Pistachio Latte now"}}},"contentLayout":{"id":"137-56833-32","title":"Image Left [Content]","updated":"2019-11-06T02:44:07.987","metadata":{"view":"GoldSites:ImageContentBlockImageLeft","regionView":"GoldSites:Content"}},"isDynamic":true},{"contentItem":{"id":"137-82563","url":"https://eapi.starbucks.com/content/v3/content/137-82563","displayName":"Spot 4 | ENUS - Breakfast Wrap | live on 01/03","typeId":"137-56832-8","typeName":"Image Content Block","version":2,"updated":"2022-12-28T03:40:28","metadata":{"style":{"copyBlockBackgroundColor":"#8B323E","imageBlockBackgroundColor":"#8B323E","headlineTextColor":"#FFFFFF","bodyTextColor":"#FFFFFF","headlineTag":"h2","headlineSize":"xl","bodyCopySize":"md","horizontalAlignment":"center","ctaStyle":"GhostWhite-WhiteText"},"mimeType":"application/json"},"content":{"image":{"id":"137-82558","url":"https://content-prod-live.cert.starbucks.com/binary/v2/asset/137-82558.jpg","filename":"W23Hom_BcnSausgEggWrap_US_CA.jpg","version":1,"updated":"2022-12-28T03:14:39.08","metadata":{"altText":"A breakfast wrap cut in half and stacked on top of itself, displaying mix of ingredients inside.","mimeType":"image/jpeg"}},"title":"Wrap your day","body":"Savory ingredients come together in our Bacon, Sausage \u0026amp; Egg Wrap for a satisfying meal on the go.","link":{"linkText":"Order now","externalLink":"https://www.starbucks.com/menu/product/2123181/single","alternateText":"Order the Bacon, Sausage \u0026 Egg Wrap now"}}},"contentLayout":{"id":"137-56838-32","title":"Image Right [Content]","updated":"2019-11-06T02:44:08.44","metadata":{"view":"GoldSites:ImageContentBlockImageRight","regionView":"GoldSites:Content"}},"isDynamic":true},{"contentItem":{"id":"137-82565","url":"https://eapi.starbucks.com/content/v3/content/137-82565","displayName":"Legal Spot | ENUS - SR Legal | live on 01/03","typeId":"137-56834-8","typeName":"Content Block","version":2,"updated":"2022-12-28T03:53:23","metadata":{"style":{"copyBlockBackgroundColor":"#ffffff","headlineTextColor":"#000000","bodyTextColor":"#000000","headlineTag":"h2","headlineSize":"xxs","bodyCopySize":"xs","horizontalAlignment":"center","ctaStyle":"FilledBlack-WhiteText"},"mimeType":"application/json"},"content":{"body":"*At participating stores."}},"contentLayout":{"id":"137-56837-32","title":"Content Block[Content]","updated":"2019-11-06T02:44:08.33","metadata":{"view":"GoldSites:ContentBlock","regionView":"GoldSites:Content"}},"isDynamic":true}],"pageLayout":{"id":"137-56839-128","title":"Single column - full width","updated":"2021-02-26T01:59:49.85","metadata":{"includes":["/system/include/global-header.html","/system/include/global-footer.html"],"view":"GoldSites:FullWidth"}},"includes":{"Global Header":{"id":"137-46819-64","url":"https://eapi.starbucks.com/content/v3/pages/137-46819-64","displayName":"GoldSites:Global Header","typeId":"137-193-128","typeName":"Include Page","version":3,"updated":"2019-01-10T11:04:28","fileName":"global-header","metadata":{"includePageViewName":"Global Header"},"pageContent":[{"contentItem":{"id":"137-156","url":"https://eapi.starbucks.com/content/v3/content/137-156","displayName":"Navigation Configuration","typeId":"137-155-8","typeName":"Navigation Configuration","version":1,"updated":"2019-08-02T00:05:36","metadata":{"navigationType":"simple","externalLinkTemplate":"Redirect Page","navigationTextFieldPaths":"standardMeta/name, headline","mimeType":"application/json"},"content":{}},"contentLayout":{"id":"137-41562-32","title":"Header Navigation [Nav]","updated":"2018-08-28T11:26:02.767","metadata":{"view":"GoldSites:HeaderNavigation","regionView":"GoldSites:Nav"}},"isDynamic":true}],"pageLayout":{"id":"137-193-128","title":"Include Page","updated":"2017-01-25T16:15:25.46","metadata":{"view":"IncludePage"}}},"Global Footer":{"id":"137-41573-64","url":"https://eapi.starbucks.com/content/v3/pages/137-41573-64","displayName":"GoldSites:Global Footer","typeId":"137-41534-128","typeName":"Include Page","version":1,"updated":"2019-01-15T13:44:15","fileName":"global-footer","metadata":{"includePageViewName":"Global Footer"},"pageContent":[{"contentItem":{"id":"137-41384","url":"https://eapi.starbucks.com/content/v3/content/137-41384","displayName":"Footer Link Group","typeId":"137-364-8","typeName":"Link List","version":3,"updated":"2019-01-15T13:46:58","metadata":{"mimeType":"application/json"},"content":{"link":[{"linkText":"Our Menu","externalLink":"https://www.starbucks.com/menu","alternateText":"Our Menu"},{"linkText":"Cards","externalLink":"https://www.starbucks.com/card","alternateText":"Cards"},{"linkText":"Rewards","externalLink":"https://www.starbucks.com/rewards","alternateText":"Rewards"},{"linkText":"Stores","externalLink":"https://www.starbucks.com/store-locator","alternateText":"Stores"}]}},"contentLayout":{"id":"137-41565-32","title":"Link Group [Global Footer]","updated":"2018-08-28T11:26:03.36","metadata":{"view":"GoldSites:LinkGroup","regionView":"GoldSites:GlobalFooter"}},"isDynamic":true},{"contentItem":{"id":"137-43243","url":"https://eapi.starbucks.com/content/v3/content/137-43243","displayName":"Footer Link Group Column 2","typeId":"137-364-8","typeName":"Link List","version":3,"updated":"2018-09-14T13:39:31","metadata":{"mimeType":"application/json"},"content":{"link":[{"linkText":"Company","externalLink":"https://www.starbucks.com/about-us/","target":"_self"},{"linkText":"Careers","externalLink":"https://www.starbucks.com/careers/","target":"_self"},{"linkText":"Newsroom","externalLink":"https://news.starbucks.com/"}]}},"contentLayout":{"id":"137-41565-32","title":"Link Group [Global Footer]","updated":"2018-08-28T11:26:03.36","metadata":{"view":"GoldSites:LinkGroup","regionView":"GoldSites:GlobalFooter"}},"isDynamic":true},{"contentItem":{"id":"137-41523","url":"https://eapi.starbucks.com/content/v3/content/137-41523","displayName":"Legal Links","typeId":"137-364-8","typeName":"Link List","version":4,"updated":"2018-09-14T13:40:05","metadata":{"mimeType":"application/json"},"content":{"link":[{"linkText":"Web Accessibility","externalLink":"https://www.starbucks.com/about-us/company-information/online-policies/web-accessibility","alternateText":"Web Accessibility"},{"linkText":"Privacy Policy","externalLink":"https://www.starbucks.com/about-us/company-information/online-policies/privacy-policy","alternateText":"Privacy Policy"},{"linkText":"Terms of Use","externalLink":"https://www.starbucks.com/about-us/company-information/online-policies/terms-of-use","alternateText":"Terms of Use"}]}},"contentLayout":{"id":"137-41548-32","title":"Legal Links [Global Footer]","updated":"2018-08-28T11:25:59.063","metadata":{"view":"GoldSites:LegalLinks","regionView":"GoldSites:GlobalFooter"}},"isDynamic":true}],"pageLayout":{"id":"137-41534-128","title":"Include Page","updated":"2018-08-28T11:25:55.723","metadata":{"view":"Starbucks:IncludePage"}}}},"updated":"2022-12-30T15:13:52","coreAppBaseUrl":"https://app.starbucks.com","legacyBaseUrl":"https://www.starbucks.com","googleSiteVerification":{"enabled":true,"content":"3IJ1Uj50nUpQyq_EpWZzvZZsvN2t9pp9FgjJ1JoKtVY"},"trustArc":{"enabled":true,"domain":"app.starbucks.com"}},"__N_SSG":true},"page":"/[[...page]]","query":{"page":["home"]},"buildId":"VuGUCotQyEWd5t22HvGS5","runtimeConfig":{"localeConfig":{"en-US":{"coreAppBaseUrl":"https://app.starbucks.com","legacyBaseUrl":"https://www.starbucks.com","trustArc":{"enabled":true,"domain":"app.starbucks.com"},"googleSiteVerification":{"enabled":true,"content":"3IJ1Uj50nUpQyq_EpWZzvZZsvN2t9pp9FgjJ1JoKtVY"},"excludedRoutes":["/rewards","/rewards/comingsoon/placeholder","/policies/placeholder","/email/placeholder","/bff/proxy/orchestra/get-user","/careers/speed/p1","/careers/speed/p2","/careers/speed/p3","/careers/speed/p4","/careers/speed/p5","/careers/speed/p6","/careers/speed/p7","/careers/speed/p8"]},"en-CA":{"coreAppBaseUrl":"https://app.starbucks.ca","legacyBaseUrl":"https://www.starbucks.ca","trustArc":{"enabled":false},"googleSiteVerification":{"enabled":false},"excludedRoutes":["/rewards","/email/placeholder","/policies/placeholder","/bff/proxy/orchestra/get-user"]},"fr-CA":{"coreAppBaseUrl":"https://app.starbucks.ca","legacyBaseUrl":"https://fr.starbucks.ca","isOrderingEnabled":true,"trustArc":{"enabled":false},"googleSiteVerification":{"enabled":true,"content":"qmE_Ca7RhdZCJjiRYTJ7c-y3LgOfrNQuSaOhr5BoeaI"},"excludedRoutes":["/recompenses","/politiques/placeholder","/courriel/placeholder","/bff/proxy/orchestra/get-user","/delivery","/ways-to-order/pickup"]}}},"isFallback":false,"gsp":true,"locale":"en-US","locales":["en-US","en-CA","fr-CA"],"defaultLocale":"en-US","scriptLoader":[]}</script><script type="text/javascript">
(function(){if (typeof __tracer == 'undefined' && typeof window != 'undefined')
                 { __tracer = window.top.__tracer;
                 }
                })();
var __dispatched__ = {}; var __i__ = self.postMessage && setInterval(function(){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-19-function-15-66601-15-66867",false);
 if(self.PrivacyManagerAPI && __i__){ var apiObject = {  PrivacyManagerAPI: {  action:"getConsentDecision", timestamp: new Date().getTime(), self: self.location.host }}; self.top.postMessage(JSON.stringify(apiObject),"*"); __i__ = clearInterval(__i__); }
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-19-function-15-66601-15-66867",true);
 }},50); self.addEventListener("message", function(e, d){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-19-function-15-66906-15-67363",false);
 try{ if(e.data && (d= JSON.parse(e.data)) && (d = d.PrivacyManagerAPI) && d.capabilities && d.action=="getConsentDecision"){ var newDecision = self.PrivacyManagerAPI.callApi("getGDPRConsentDecision",self.location.host).consentDecision; newDecision && newDecision.forEach(function(label){ 
 try {__tracer.cacheInit("www.starbucks.com/-script-19-function-15-67193-15-67344",false);
 if(!__dispatched__[label]){ self.dataLayer && self.dataLayer.push({"event":"GDPR Pref Allows "+label}); __dispatched__[label] = 1; } 
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-19-function-15-67193-15-67344",true);
 }}); } }catch(xx){} 
 
 } finally {__tracer.exitFunction("www.starbucks.com/-script-19-function-15-66906-15-67363",true);
 }});</script></body></html>
z
End
